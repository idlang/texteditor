/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.1.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function y(e){return $(e).replace(/<.*?>/g,"").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;")}function w(e){return $(e).replace(/<.*?>/g,"").replace(/\s/g,"%20").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29")}function $(e){return h(e.replace(/\s+/g," "))}var i=(window,document,new TE.HTML(e)),o=i.ui,l=i.is,a=l.o,f=function(e){return!l.x(e)},u=l.s,s=i._,c=s.extend,p=s.x,d=s.pattern,h=s.trim,g=s.edge,v=s.format,b=s.i,m="\t";i.update(c({extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{tools:{sup:["Footnote",i.config.languages.tools.sub[1]]},modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}},t),0),i.type="Markdown";var k=i.config,x=k.states,_=k.languages,E=k.formats,T=k.tab,C=_.placeholders,S=0,L=k.extra,z="( +["+p(E.ul).join("")+"] )";return L||(k["advance_pre,code"]=0),i.mark=function(e,t,r,n){a(e)||(e=[e]),f(r)||(r=" "),f(n)||(n="");var o=i[0]().$(),l=e[0]+n,u=n+(f(e[1])?e[1]:e[0]),s=o.value,c=p(l),h=p(u),g=d("^"+c+"([\\s\\S]*?)"+h+"$"),v=d(c+"$"),b=d("^"+h),m=o.before,y=o.after;return s?r=!1:i.insert(C[""]),i.toggle(t?!g.test(s):!v.test(m)&&!b.test(y),[function(e){e.unwrap(l,u,1).tidy(/<[^\/<>]+?>$/.test(m)?"":r,/^<\/[^<>]+?>/.test(y)?"":r).wrap(l,u,t)[1]()},function(e){e.unwrap(l,u,t)[1]()}])},c(o.tools,{b:{click:function(e,t){return t.i().mark(E.b[0]),!1}},i:{click:function(e,t){return t.i().mark(E.i[0]),!1}},u:0,s:L?{click:function(e,t){return t.i().mark(E.s),!1}}:0,a:{click:function(e,t){var c,p,d,g,v,b,m,r=t.$(),n=r.before,i=r.value,o=r.after,l=t.get(),a=/^ {0,3}\[[^\^]+?\]:/.test(l.split("\n").pop())?"\n":"\n\n",f=l.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=_.modals.a,s=u.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(i))return t.tidy(" ").mark(["<",">"],1),!1;for(m in f)m=" "+h(f[m]).replace(/^\[|\]:$/g,""),x.a[m]=1;return c=x.a,t.record().ui.prompt(["a[href]",u.title[0]],s,0,function(e,t,l){var m=""===l;l=w(l),t[0](),c[l]?(t.trim(h(n)?" ":"",/^\n+ {0,3}\*?\[/.test(o)?!1:" ").mark(["[","]["+l+"]"],0,!1),g=f.indexOf(" ["+l+"]:"),-1===g&&1!==c[l]&&(r=t.$(),n=r.before,v=r.start,b=r.end,t.set(n+r.value+h(r.after,1)+a+" ["+(l||h(i)||C[""])+"]: "+(m?"":c[l][0]+(c[l][1]?' "'+c[l][1]+'"':""))).select(v,b),m&&t.focus(!0).insert(s))):(p=l,t.blur().ui.prompt(["a[title]",u.title[1]],u.placeholder[1],0,function(e,t,r){d=y(r),i||t.insert(C[""]),t.i().trim(h(n)?" ":"",h(o)?/^\n+ {0,3}\*?\[/.test(o)?"\n\n ":" ":"").wrap("[","]("+p+(d?' "'+d+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var p,d,g,v,b,m,$,r=t.$(),n=r.value,i=r.before,o=r.after,l=t.get(),a=/^ {0,3}\[[^\^]+?\]:/.test(l.split("\n").pop())?"\n":"\n\n",f=l.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=_.modals.img,s=/^\n* {0,3}\[.+?\]:/.test(o)?" ":"",c=h(o);for($ in f)$=" "+h(f[$]).replace(/^\[|\]:$/g,""),!x.img[$]&&(x.img[$]=1);return p=x.img,t.ui.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,o){o=w(o),d=o,n||(n=d.split(/[\/\\\\]/).pop()),n=y(n),t[0]().trim(h(i)?"\n\n":"",s),p[o]?(t.insert("!["+n+"]["+o+"]\n\n",-1,1),s&&t.select(t.$().start),v=f.indexOf(" ["+o+"]:"),-1===v&&(r=t.$(),i=r.before,b=r.start,m=r.end,t.set(i+r.value+r.after+(c?a:"")+" ["+o+"]: "+p[o][0]+(p[o][1]?' "'+p[o][1]+'"':"")).select(b,m))):t.blur().ui.prompt(["img[title]",u.title[1]],u.placeholder[1],0,function(e,t,r){g=y(r),t.insert("!["+n+"]("+d+(g?' "'+g+'"':"")+")\n\n",-1,1),s&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:L?{i:"thumb-tack",click:function(e,t){var s,r=t.$(),n=r.before,i=r.after,o=_.modals.sup,l=t.get(),a=/^ {0,3}\[\^.+?\]:/.test(h(l).split("\n").pop())?"\n":"\n\n",f=l.match(/^ {0,3}\[\^.+?\]:/gm)||[],u=0;for(u in f)f[u]=" "+h(f[u]);return u=f.length+1,t.ui.prompt(["sup[id]",o.title],r.value||o.placeholder||u,0,function(e,t,r,o){r=h(r||o)||u,s=f.indexOf(" [^"+r+"]:"),-1!==s?(u=l.indexOf(f[s])+3,t.select(u,u+r.length)):t.trim(h(n)?" ":"",!h(i)||/^[\t ]*\n+[\t ]*/.test(i)?"\n\n":" ").insert("[^"+r+"]").set(h(t.get(),1)+a+" [^"+r+"]: ").focus(!0).insert(C[""])}),!1}}:0,abbr:L?{click:function(e,t){var r=t.$(),n=h(r.value),i=_.modals.abbr,o=t.get(),l=$(n||C[""]),a=/^ {0,3}\*\[.+?\]:/.test(o.split("\n").pop())?"\n":"\n\n",f=o.match(/^ {0,3}\*\[.+?\]:/gm)||[],u=x.abbr,s=0;for(s in f)f[s]=" "+h(f[s]);return s=f.indexOf(" *["+l+"]:"),n&&-1!==s?(s=o.indexOf(f[s])+3,t.select(s,s+l.length),!1):(t.record().ui.prompt(["abbr[title]",i.title],u[l]||i.placeholder,!u[n],function(e,t,i,o){if(i=y(i),t[0]().set(h(t.get(),1)+(r.before||n?a:"")+" *["+l+"]: ").focus(!0).insert(i||o),l===C[""]){var f=t.$().start;t.select(f-3-l.length,f-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(C[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){S>5?S=0:S++;var r=t.$(),n=k["advance_h1,h2"],i="\\s?["+p(E.h1[0]+E.h2[0])+"]+\\s*",o=p(E.h1[1]),l=r.before.replace(d("["+o+"\\s]+$"),""),a=$(r.value).replace(d("^["+o+"\\s]+|["+o+"\\s]+$","g"),"").replace(d(i+"$"),"")||C[""],f=r.after.replace(d("^["+o+"\\s]+"),"").replace(d("^"+i),""),u=["",E.h1[n?0:1],E.h2[n?0:1],E.h3,E.h4,E.h5,E.h6];return t[0]().set(l+a+f).select(l.length,(l+a).length).tidy("\n\n"),0===S||(3>S&&n?t.wrap("","\n"+a.replace(/./g,u[S])):t.wrap(u[S]+" ",k["close_h1,h2,h3,h4,h5,h6"]?" "+u[S]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,i=E.blockquote;return n===C[""]?(t.select(),!1):n?(t.tidy(d(i+" $").test(r.before)?!1:"\n\n")[d("^"+i).test(n)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",-1).insert(C[""])[1](),!1)}},"pre,code":{click:function(e,t){var r=t.$(),n=r.before,i=r.value,o=k["advance_pre,code"],l=E.code,a=l[1]||l[0];a=a+a+a,!u(o)&&o?o=a:u(o)&&-1!==o.indexOf("%1")&&(o=v(o,[a]));var f="( {4,}|\\t"+(u(o)?"|"+p(o):"")+")";if(d("(^|\\n)"+f+"?$").test(n)){if(o)return t.mark([o,o.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(o=T===m?m:"    ",!i){t[0]().tidy("\n\n");var s=t.$().start,c=o+C[""];return t.insert(c).select(s+o.length,s+c.length)[1](),!1}return i===C[""]&&d(f+"$").test(n)?(t.select(r.start-o.length,r.end),!1):(t.tidy("\n\n")[d("^"+f).test(i)?"outdent":"indent"](o),!1)}return t.mark(l[0]),!1}},ul:{click:function(e,t){var m,r=t.$(),n=r.value,i=r.before,o=r.after,l=E.ul[0],a=E.ol[0],f=p(l),u=v(p(a),["\\d+"]),s=d("(^|\\n)([\\t ]*) "+f+" (.*)$"),c=d("^(.*) "+f+" ","gm"),h=d("(^|\\n)([\\t ]*) "+u+" (.*)$"),g=d("^(.*) "+u+" ","gm"),b=C[""];return n?(n===b?t.select():g.test(n)?t.replace(g,"$1 "+l+" "):c.test(n)?t.replace(c,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+l+" $2"),!1):i&&o?(m=h.test(i)?i.replace(h,"$1$2 "+l+" $3"):s.test(i)?i.replace(s,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+l+" $3"),t.set(m+o).select(m.length),!1):(t[0]().tidy("\n\n").insert(" "+l+" ",-1).insert(b)[1](),!1)}},ol:{click:function(e,t){var w,r=t.$(),n=r.value,i=r.before,o=r.after,l=E.ul[0],a=E.ol[0],f=v(a,[1]),u=p(l),s=v(p(a),["\\d+"]),c=d("(^|\\n)([\\t ]*) "+u+" (.*)$"),h=d("^(.*) "+u+" ","gm"),g=d("(^|\\n)([\\t ]*) "+s+" (.*)$"),b=d("^(.*) "+s+" ","gm"),m=C[""],y=0;return n?(n===m?t.select():h.test(n)?t.replace(h,function(e,t,r){return++y,t+" "+v(a,[y])+" "}):b.test(n)?t.replace(b,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++y,t+" "+v(a,[y])+" "+r}),!1):i&&o?(w=c.test(i)?i.replace(c,"$1$2 "+f+" $3"):g.test(i)?i.replace(g,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+f+" $3"),t.set(w+o).select(w.length),!1):(t[0]().tidy("\n\n").insert(" "+f+" ",-1).insert(m)[1](),!1)}},table:L?function(e,t){var f,u,s,r=x.tr,n=x.td,i=_.modals.table,o=_.placeholders.table,l=v(o[0],[1,1]),a=[];return t.$().value===l?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,c,p){u=g(b(c)||p,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,i){s=g(b(n)||i,r[0],r[1]);var c,p,d,h,m,y;for(c=0;s>c;++c){for(f="|",p=0;u>p;++p)f+=" "+v(o[1],[c+1,p+1])+" |";a.push(f)}for(a=a.join("\n"),f="|",d=0;u>d;++d)f+=" "+v(o[0],[d+1,d+1]).replace(/./g,"-")+" |";for(a=f+"\n"+a,f="|",h=0;u>h;++h)f+=" "+v(o[0],[1,h+1])+" |";a=f+"\n"+a,k.close_tr||(a=a.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(a),m=t.$(),y=m.start+m.value.indexOf(l),t.select(y,y+l.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(E.hr[0]+"\n\n",-1),!1}}}),c(o.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=k.advance_br;return!u(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",-1).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=E.blockquote,o=(E.ul[0],E.ol[0]),l=v(p(o),["\\d+"]),a="(("+p(n)+" )+|"+z+"| +("+l+") )",f=d("^"+a+".*$","gm").exec(r.before.split("\n").pop());if(f){if(f[0]===f[1])return t.outdent(d(a)),!1;if(d("\\s*"+l+"\\s*").test(f[1])){var u=b(h(f[1]));return t.insert("\n"+f[1].replace(/\d+/,u+1),-1).scroll(!0),!1}return t.insert("\n"+f[1],-1).scroll(!0),!1}},"shift+tab":function(e,t){var b,r=t.$(),n=r.before,i=r.value,l=r.after,a=E.ol[0],f=p(a),u=v(f,["\\d+"]),s=p(E.blockquote),c=d("  "+z+"$"),h=d("   ( ?"+u+" )$"),g="("+s+" |"+z+"| +"+u+" )";if(i){if(i&&(b=i.match(d("(^|\\n)"+g,"g"))))return t.outdent(d(g)),!1}else{if(b=n.match(d(s+" $")))return t.outdent(b[0]),!1;if(b=n.match(c))return n=n.replace(c,"$1"),t.set(n+l).select(n.length),!1;if(b=n.match(h))return n=n.replace(h,"$1"),t.set(n+l).select(n.length),!1}return o.tools.outdent.click(e,t)},tab:function(e,t){var g,r=t.$(),n=r.before,i=r.value,l=r.after,a=E.ol[0],f=E.blockquote,u=p(a),s=p(f),c=d(z+"$"),h=d(" ?"+v(u,["\\d+"])+" $");if(i){if(d("^"+s+" ").test(i))return t.indent(f+" "),!1}else{if(g=n.match(d(s+" $")))return t.insert(g[0],-1),!1;if(g=n.match(c))return n=n.replace(c,"  $1"),t.set(n+l).select(n.length),!1;if(g=n.match(h))return n=n.replace(h,"    "+v(a,[1])+" "),t.set(n+l).select(n.length),!1}return o.tools.indent.click(e,t)}}),i.update({},0)};