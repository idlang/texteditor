/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function y(e){return h(e.replace(/\s+/g," "))}function k(e){return y(e).replace(/<.*?>/g,"").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;")}function w(e){return y(e).replace(/<.*?>/g,"").replace(/\s/g,"%20").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\[/g,"%5B").replace(/\]/g,"%5D")}var i=(window,document,new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}})),o=i.ui,l=i.is,a=l.o,s=function(e){return!l.x(e)},f=l.s,u=i._,c=u.extend,p=u.x,d=u.pattern,h=u.trim,g=u.edge,b=u.format,m=u.i,v="\t";i.update(c({languages:{tools:{sup:["Footnote",i.config.languages.tools.sub[1]]}}},t),0),i.type="Markdown";var x=i.config,$=x.states,T=x.languages,E=x.formats,_=x.tab,q=T.placeholders,L=0,C=x.extra,O="( +["+p(E.ul).join("")+"] )";return C||(x["advance_pre,code"]=0),i.mark=function(e,t,r,n){a(e)||(e=[e]),s(r)||(r=" "),s(n)||(n="");var o=i[0]().$(),l=e[0]+n,f=n+(s(e[1])?e[1]:e[0]),u=o.value,c=p(l),h=p(f),g=d("^"+c+"([\\s\\S]*?)"+h+"$"),b=d(c+"$"),m=d("^"+h),v=o.before,y=o.after;return u?r=!1:i.insert(q[""]),i.toggle(t?!g.test(u):!b.test(v)&&!m.test(y),[function(e){e.unwrap(l,f,1).tidy(/<[^\/<>]+?>$/.test(v)?"":r,/^<\/[^<>]+?>/.test(y)?"":r).wrap(l,f,t)[1]()},function(e){e.unwrap(l,f,t)[1]()}])},c(o.tools,{b:{click:function(e,t){return t.i().mark(E.b[0]),!1}},i:{click:function(e,t){return t.i().mark(E.i[0]),!1}},u:0,s:C?{click:function(e,t){return t.i().mark(E.s),!1}}:0,a:{click:function(e,t){var c,p,d,g,b,m,v,r=t.$(),n=r.before,i=r.value,o=r.after,l=t.get(),a=/^ {0,3}\[[^\^]+?\]:/.test(l.split("\n").pop())?"\n":"\n\n",s=l.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],f=T.modals.a,u=f.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(i))return t.tidy(" ").mark(["<",">"],1),!1;for(v in s)v=" "+h(s[v]).replace(/^\[|\]:$/g,""),$.a[v]=1;return c=$.a,t.record().ui.prompt(["a[href]",f.title[0]],u,0,function(e,t,l){var v=""===l;l=w(l),t[0](),c[l]?(t.trim(h(n)?" ":"",/^\n+ {0,3}\*?\[/.test(o)?!1:" ").mark(["[","]["+l+"]"],0,!1),g=s.indexOf(" ["+l+"]:"),-1===g&&1!==c[l]&&(r=t.$(),n=r.before,b=r.start,m=r.end,t.set(n+i+h(r.after,1)+a+" ["+(l||h(i)||q[""])+"]: "+(v?"":c[l][0]+(c[l][1]?' "'+c[l][1]+'"':""))).select(b,m),v&&t.focus(!0).insert(u))):(p=l,t.blur().ui.prompt(["a[title]",f.title[1]],f.placeholder[1],0,function(e,t,r){d=k(r),i||t.insert(q[""]),t.i().trim(h(n)?" ":"",h(o)?/^\n+ {0,3}\*?\[/.test(o)?"\n\n ":" ":"").wrap("[","]("+p+(d?' "'+d+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var d,g,b,m,v,y,x,r=t.$(),n=r.value,i=n,o=r.before,l=r.after,a=t.get(),s=/^ {0,3}\[[^\^]+?\]:/.test(a.split("\n").pop())?"\n":"\n\n",f=a.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=T.modals.img,c=/^\n* {0,3}\[.+?\]:/.test(l)?" ":"",p=h(l);for(x in f)x=" "+h(f[x]).replace(/^\[|\]:$/g,""),!$.img[x]&&($.img[x]=1);return d=$.img,t.ui.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,l){l=w(l),g=l,i||(i=g.split(/[\/\\\\]/).pop()),i=k(i),t[0]().trim(h(o)?"\n\n":"",c),d[l]?(t.insert("!["+i+"]["+l+"]\n\n",-1,1),c&&t.select(t.$().start),m=f.indexOf(" ["+l+"]:"),-1===m&&(r=t.$(),o=r.before,v=r.start,y=r.end,t.set(o+n+r.after+(p?s:"")+" ["+l+"]: "+d[l][0]+(d[l][1]?' "'+d[l][1]+'"':"")).select(v,y))):t.blur().ui.prompt(["img[title]",u.title[1]],u.placeholder[1],0,function(e,t,r){b=k(r),t.insert("!["+i+"]("+g+(b?' "'+b+'"':"")+")\n\n",-1,1),c&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:C?{i:"thumb-tack",click:function(e,t){var u,r=t.$(),n=r.before,i=r.after,o=T.modals.sup,l=t.get(),a=/^ {0,3}\[\^.+?\]:/.test(h(l).split("\n").pop())?"\n":"\n\n",s=l.match(/^ {0,3}\[\^.+?\]:/gm)||[],f=0;for(f in s)s[f]=" "+h(s[f]);return f=s.length+1,t.ui.prompt(["sup[id]",o.title],r.value||o.placeholder||f,0,function(e,t,r,o){r=h(r||o)||f,u=s.indexOf(" [^"+r+"]:"),-1!==u?(f=l.indexOf(s[u])+3,t.select(f,f+r.length)):t.trim(h(n)?" ":"",!h(i)||/^[\t ]*\n+[\t ]*/.test(i)?"\n\n":" ").insert("[^"+r+"]").set(h(t.get(),1)+a+" [^"+r+"]: ").focus(!0).insert(q[""])}),!1}}:0,abbr:C?{click:function(e,t){var r=t.$(),n=h(r.value),i=T.modals.abbr,o=t.get(),l=y(n||q[""]),a=/^ {0,3}\*\[.+?\]:/.test(o.split("\n").pop())?"\n":"\n\n",s=o.match(/^ {0,3}\*\[.+?\]:/gm)||[],f=$.abbr,u=0;for(u in s)s[u]=" "+h(s[u]);return u=s.indexOf(" *["+l+"]:"),n&&-1!==u?(u=o.indexOf(s[u])+3,t.select(u,u+l.length),!1):(t.record().ui.prompt(["abbr[title]",i.title],f[l]||i.placeholder,!f[n],function(e,t,i,o){if(i=k(i),t[0]().set(h(t.get(),1)+(r.before||n?a:"")+" *["+l+"]: ").focus(!0).insert(i||o),l===q[""]){var s=t.$().start;t.select(s-3-l.length,s-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(q[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){L>5?L=0:L++;var r=t.$(),n=x["advance_h1,h2"],i="\\s?["+p(E.h1[0]+E.h2[0])+"]+\\s*",o=p(E.h1[1]),l=r.before.replace(d("["+o+"\\s]+$"),""),a=y(r.value).replace(d("^["+o+"\\s]+|["+o+"\\s]+$","g"),"").replace(d(i+"$"),"")||q[""],s=r.after.replace(d("^["+o+"\\s]+"),"").replace(d("^"+i),""),f=["",E.h1[n?0:1],E.h2[n?0:1],E.h3,E.h4,E.h5,E.h6];return t[0]().set(l+a+s).select(l.length,(l+a).length).tidy("\n\n"),0===L||(3>L&&n?t.wrap("","\n"+a.replace(/./g,f[L])):t.wrap(f[L]+" ",x["close_h1,h2,h3,h4,h5,h6"]?" "+f[L]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,i=E.blockquote;return n===q[""]?(t.select(),!1):n?(t.tidy(d(i+" $").test(r.before)?!1:"\n\n")[d("^"+i).test(n)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",-1).insert(q[""])[1](),!1)}},"pre,code":{click:function(e,t){var r=t.$(),n=r.before,i=r.value,o=x["advance_pre,code"],l=E.code,a=l[1]||l[0];a=a+a+a,!f(o)&&o?o=a:f(o)&&-1!==o.indexOf("%1")&&(o=b(o,[a]));var s="( {4,}|\\t"+(f(o)?"|"+p(o):"")+")";if(d("(^|\\n)"+s+"?$").test(n)){if(o)return t.mark([o,o.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(o=_===v?v:"    ",!i){t[0]().tidy("\n\n");var u=t.$().start,c=o+q[""];return t.insert(c).select(u+o.length,u+c.length)[1](),!1}return i===q[""]&&d(s+"$").test(n)?(t.select(r.start-o.length,r.end),!1):(t.tidy("\n\n")[d("^"+s).test(i)?"outdent":"indent"](o),!1)}return t.mark(l[0]),!1}},ul:{click:function(e,t){var v,r=t.$(),n=r.value,i=r.before,o=r.after,l=E.ul[0],a=E.ol[0],s=p(l),f=b(p(a),["\\d+"]),u=d("(^|\\n)([\\t ]*) "+s+" (.*)$"),c=d("^(.*) "+s+" ","gm"),h=d("(^|\\n)([\\t ]*) "+f+" (.*)$"),g=d("^(.*) "+f+" ","gm"),m=q[""];return n?(n===m?t.select():g.test(n)?t.replace(g,"$1 "+l+" "):c.test(n)?t.replace(c,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+l+" $2"),!1):i&&o?(v=h.test(i)?i.replace(h,"$1$2 "+l+" $3"):u.test(i)?i.replace(u,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+l+" $3"),t.set(v+o).select(v.length),!1):(t[0]().tidy("\n\n").insert(" "+l+" ",-1).insert(m)[1](),!1)}},ol:{click:function(e,t){var k,r=t.$(),n=r.value,i=r.before,o=r.after,l=E.ul[0],a=E.ol[0],s=b(a,[1]),f=p(l),u=b(p(a),["\\d+"]),c=d("(^|\\n)([\\t ]*) "+f+" (.*)$"),h=d("^(.*) "+f+" ","gm"),g=d("(^|\\n)([\\t ]*) "+u+" (.*)$"),m=d("^(.*) "+u+" ","gm"),v=q[""],y=0;return n?(n===v?t.select():h.test(n)?t.replace(h,function(e,t,r){return++y,t+" "+b(a,[y])+" "}):m.test(n)?t.replace(m,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++y,t+" "+b(a,[y])+" "+r}),!1):i&&o?(k=c.test(i)?i.replace(c,"$1$2 "+s+" $3"):g.test(i)?i.replace(g,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+s+" $3"),t.set(k+o).select(k.length),!1):(t[0]().tidy("\n\n").insert(" "+s+" ",-1).insert(v)[1](),!1)}},table:C?function(e,t){var s,f,u,r=$.tr,n=$.td,i=T.modals.table,o=T.placeholders.table,l=b(o[0],[1,1]),a=[];return t.$().value===l?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,c,p){f=g(m(c)||p,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,i){u=g(m(n)||i,r[0],r[1]);var c,p,d,h,v,y;for(c=0;u>c;++c){for(s="|",p=0;f>p;++p)s+=" "+b(o[1],[c+1,p+1])+" |";a.push(s)}for(a=a.join("\n"),s="|",d=0;f>d;++d)s+=" "+b(o[0],[d+1,d+1]).replace(/./g,"-")+" |";for(a=s+"\n"+a,s="|",h=0;f>h;++h)s+=" "+b(o[0],[1,h+1])+" |";a=s+"\n"+a,x.close_tr||(a=a.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(a),v=t.$(),y=v.start+v.value.indexOf(l),t.select(y,y+l.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(E.hr[0]+"\n\n",-1),!1}}}),c(o.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=x.advance_br;return!f(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",-1).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=E.blockquote,o=(E.ul[0],E.ol[0]),l=b(p(o),["\\d+"]),a="(("+p(n)+" )+|"+O+"| +("+l+") )",s=d("^"+a+".*$","gm").exec(r.before.split("\n").pop());if(s){if(s[0]===s[1])return t.outdent(d(a)),!1;if(d("\\s*"+l+"\\s*").test(s[1])){var f=m(h(s[1]));return t.insert("\n"+s[1].replace(/\d+/,f+1),-1).scroll(!0),!1}return t.insert("\n"+s[1],-1).scroll(!0),!1}},"shift+tab":function(e,t){var m,r=t.$(),n=r.before,i=r.value,l=r.after,a=E.ol[0],s=p(a),f=b(s,["\\d+"]),u=p(E.blockquote),c=d("  "+O+"$"),h=d("   ( ?"+f+" )$"),g="("+u+" |"+O+"| +"+f+" )";if(i){if(i&&(m=i.match(d("(^|\\n)"+g,"g"))))return t.outdent(d(g)),!1}else{if(m=n.match(d(u+" $")))return t.outdent(m[0]),!1;if(m=n.match(c))return n=n.replace(c,"$1"),t.set(n+l).select(n.length),!1;if(m=n.match(h))return n=n.replace(h,"$1"),t.set(n+l).select(n.length),!1}return o.tools.outdent.click(e,t)},tab:function(e,t){var g,r=t.$(),n=r.before,i=r.value,l=r.after,a=E.ol[0],s=E.blockquote,f=p(a),u=p(s),c=d(O+"$"),h=d(" ?"+b(f,["\\d+"])+" $");if(i){if(d("^"+u+" ").test(i))return t.indent(s+" "),!1}else{if(g=n.match(d(u+" $")))return t.insert(g[0],-1),!1;if(g=n.match(c))return n=n.replace(c,"  $1"),t.set(n+l).select(n.length),!1;if(g=n.match(h))return n=n.replace(h,"    "+b(a,[1])+" "),t.set(n+l).select(n.length),!1}return o.tools.indent.click(e,t)}}),i.update({},0)};