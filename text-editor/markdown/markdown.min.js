TE.Markdown=function(e,t){function $(e){return b(e.replace(/\s+/g," "))}function w(e){return h($(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function y(e){return h($(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var i=(window,document,new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}})),l=i.ui,a=i.is,o=a.o,s=function(e){return!a.x(e)},c=a.s,u=i._,f=u.extend,p=u.x,d=u.pattern,h=u.replace,b=u.trim,m=u.edge,g=u.format,v=u.i,k="	";i.update(f({languages:{tools:{sup:["Footnote",i.config.languages.tools.sub[1]]}}},t),0),i.type="Markdown";var q=i.config,_=q.states,x=q.languages,T=q.formats,L=q.tab,C=x.placeholders,E=0,B=q.extra,H="( +["+p(T.ul).join("")+"] )";return B||(q["advance_pre,code"]=0),i.mark=function(e,t,r,n){o(e)||(e=[e]),s(r)||(r=" "),s(n)||(n="");var l=i[0]().$(),a=e[0]+n,c=n+(s(e[1])?e[1]:e[0]),u=l.value,f=p(a),h=p(c),b=d("^"+f+"([\\s\\S]*?)"+h+"$"),m=d(f+"$"),g=d("^"+h),v=l.before,k=l.after;return u?r=!1:i.insert(C[""]),i.toggle(t?!b.test(u):!m.test(v)&&!g.test(k),[function(e){e.unwrap(a,c,1).tidy(/<[^\/<>]+?>$/.test(v)?"":r,/^<\/[^<>]+?>/.test(k)?"":r).wrap(a,c,t)[1]()},function(e){e.unwrap(a,c,t)[1]()}])},f(l.tools,{b:{click:function(e,t){return t.i().mark(T.b[0]),!1}},i:{click:function(e,t){return t.i().mark(T.i[0]),!1}},u:0,s:B?{click:function(e,t){return t.i().mark(T.s),!1}}:0,a:{click:function(e,t){var f,p,d,h,m,g,v,r=t.$(),n=r.before,i=r.value,l=r.after,a=t.get(),o=/^ {0,3}\[[^\^]+?\]:/.test(a.split("\n").pop())?"\n":"\n\n",s=a.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],c=x.modals.a,u=c.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(i))return t.tidy(" ").mark(["<",">"],1),!1;for(v in s)v=" "+b(s[v]).replace(/^\[|\]:$/g,""),_.a[v]=1;return f=_.a,t.record().ui.prompt(["a[href]",c.title[0]],u,0,function(e,t,a){var v=""===a;a=y(a),t[0](),f[a]?(t.trim(b(n)?" ":"",/^\n+ {0,3}\*?\[/.test(l)?!1:" ").mark(["[","]["+a+"]"],0,!1),h=s.indexOf(" ["+a+"]:"),-1===h&&1!==f[a]&&(r=t.$(),n=r.before,m=r.start,g=r.end,t.set(n+i+b(r.after,1)+o+" ["+(a||b(i)||C[""])+"]: "+(v?"":f[a][0]+(f[a][1]?' "'+f[a][1]+'"':""))).select(m,g),v&&t.focus(!0).insert(u))):(p=a,t.blur().ui.prompt(["a[title]",c.title[1]],c.placeholder[1],0,function(e,t,r){d=w(r),i||t.insert(C[""]),t.i().trim(b(n)?" ":"",b(l)?/^\n+ {0,3}\*?\[/.test(l)?"\n\n ":" ":"").wrap("[","]("+p+(d?' "'+d+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var h,m,g,v,k,$,q,r=t.$(),n=r.value,i=n,a=r.before,o=r.after,s=t.get(),c=/^ {0,3}\[[^\^]+?\]:/.test(s.split("\n").pop())?"\n":"\n\n",u=s.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],f=x.modals.img,p=/^\n* {0,3}\[.+?\]:/.test(o)?" ":"",d=b(o);for(q in u)q=" "+b(u[q]).replace(/^\[|\]:$/g,""),!_.img[q]&&(_.img[q]=1);return h=_.img,l.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,l){l=y(l),m=l,i||(i=m.split(/[\/\\\\]/).pop()),i=w(i),t[0]().trim(b(a)?"\n\n":"",p),h[l]?(t.insert("!["+i+"]["+l+"]\n\n",0,1),p&&t.select(t.$().start),v=u.indexOf(" ["+l+"]:"),-1===v&&(r=t.$(),a=r.before,k=r.start,$=r.end,t.set(a+n+r.after+(d?c:"")+" ["+l+"]: "+h[l][0]+(h[l][1]?' "'+h[l][1]+'"':"")).select(k,$))):t.blur().ui.prompt(["img[title]",f.title[1]],f.placeholder[1],0,function(e,t,r){g=w(r),t.insert("!["+i+"]("+m+(g?' "'+g+'"':"")+")\n\n",0,1),p&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:B?{i:"thumb-tack",click:function(e,t){var f,r=t.$(),n=r.before,i=r.after,a=x.modals.sup,o=t.get(),s=/^ {0,3}\[\^.+?\]:/.test(b(o).split("\n").pop())?"\n":"\n\n",c=o.match(/^ {0,3}\[\^.+?\]:/gm)||[],u=0;for(u in c)c[u]=" "+b(c[u]);return u=c.length+1,l.prompt(["sup[id]",a.title],r.value||a.placeholder||u,0,function(e,t,r,l){r=b(r||l)||u,f=c.indexOf(" [^"+r+"]:"),-1!==f?(u=o.indexOf(c[f])+3,t.select(u,u+r.length)):t.trim(b(n)?" ":"",!b(i)||/^[\t ]*\n+[\t ]*/.test(i)?"\n\n":" ").insert("[^"+r+"]").set(b(t.get(),1)+s+" [^"+r+"]: ").focus(!0).insert(C[""])}),!1}}:0,abbr:B?{click:function(e,t){var r=t.$(),n=b(r.value),i=x.modals.abbr,l=t.get(),a=$(n||C[""]),o=/^ {0,3}\*\[.+?\]:/.test(l.split("\n").pop())?"\n":"\n\n",s=l.match(/^ {0,3}\*\[.+?\]:/gm)||[],c=_.abbr,u=0;for(u in s)s[u]=" "+b(s[u]);return u=s.indexOf(" *["+a+"]:"),n&&-1!==u?(u=l.indexOf(s[u])+3,t.select(u,u+a.length),!1):(t.record().ui.prompt(["abbr[title]",i.title],c[a]||i.placeholder,!c[n],function(e,t,i,l){if(i=w(i),t[0]().set(b(t.get(),1)+(r.before||n?o:"")+" *["+a+"]: ").focus(!0).insert(i||l),a===C[""]){var s=t.$().start;t.select(s-3-a.length,s-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(C[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){E>5?E=0:E++;var r=t.$(),n=q["advance_h1,h2"],i="\\s?["+p(T.h1[0]+T.h2[0])+"]+\\s*",l=p(T.h1[1]),a=r.before.replace(d("["+l+"\\s]+$"),""),o=$(r.value).replace(d("^["+l+"\\s]+|["+l+"\\s]+$","g"),"").replace(d(i+"$"),"")||C[""],s=r.after.replace(d("^["+l+"\\s]+"),"").replace(d("^"+i),""),c=["",T.h1[n?0:1],T.h2[n?0:1],T.h3,T.h4,T.h5,T.h6];return t[0]().set(a+o+s).select(a.length,(a+o).length).tidy("\n\n"),0===E||(3>E&&n?t.wrap("","\n"+o.replace(/./g,c[E])):t.wrap(c[E]+" ",q["close_h1,h2,h3,h4,h5,h6"]?" "+c[E]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,i=T.blockquote;return n===C[""]?(t.select(),!1):n?(t.tidy(d(i+" $").test(r.before)?!1:"\n\n")[d("^"+i).test(n)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",0).insert(C[""])[1](),!1)}},"pre,code":{click:function(e,t){var r=t.$(),n=r.before,i=r.value,l=q["advance_pre,code"],a=T.code,o=a[1]||a[0];o=o+o+o,!c(l)&&l?l=o:c(l)&&-1!==l.indexOf("%1")&&(l=g(l,[o]));var s="( {4,}|\\t"+(c(l)?"|"+p(l):"")+")";if(d("(^|\\n)"+s+"?$").test(n)){if(l)return t.mark([l,l.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(l=L===k?k:"    ",!i){t[0]().tidy("\n\n");var u=t.$().start,f=l+C[""];return t.insert(f).select(u+l.length,u+f.length)[1](),!1}return i===C[""]&&d(s+"$").test(n)?(t.select(r.start-l.length,r.end),!1):(t.tidy("\n\n")[d("^"+s).test(i)?"outdent":"indent"](l),!1)}return t.mark(a[0]),!1}},ul:{click:function(e,t){var v,r=t.$(),n=r.value,i=r.before,l=r.after,a=T.ul[0],o=T.ol[0],s=p(a),c=g(p(o),["\\d+"]),u=d("(^|\\n)([\\t ]*) "+s+" (.*)$"),f=d("^(.*) "+s+" ","gm"),h=d("(^|\\n)([\\t ]*) "+c+" (.*)$"),b=d("^(.*) "+c+" ","gm"),m=C[""];return n?(n===m?t.select():b.test(n)?t.replace(b,"$1 "+a+" "):f.test(n)?t.replace(f,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+a+" $2"),!1):i&&l?(v=h.test(i)?i.replace(h,"$1$2 "+a+" $3"):u.test(i)?i.replace(u,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+a+" $3"),t.set(v+l).select(v.length),!1):(t[0]().tidy("\n\n").insert(" "+a+" ",0).insert(m)[1](),!1)}},ol:{click:function(e,t){var $,r=t.$(),n=r.value,i=r.before,l=r.after,a=T.ul[0],o=T.ol[0],s=g(o,[1]),c=p(a),u=g(p(o),["\\d+"]),f=d("(^|\\n)([\\t ]*) "+c+" (.*)$"),h=d("^(.*) "+c+" ","gm"),b=d("(^|\\n)([\\t ]*) "+u+" (.*)$"),m=d("^(.*) "+u+" ","gm"),v=C[""],k=0;return n?(n===v?t.select():h.test(n)?t.replace(h,function(e,t,r){return++k,t+" "+g(o,[k])+" "}):m.test(n)?t.replace(m,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++k,t+" "+g(o,[k])+" "+r}),!1):i&&l?($=f.test(i)?i.replace(f,"$1$2 "+s+" $3"):b.test(i)?i.replace(b,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+s+" $3"),t.set($+l).select($.length),!1):(t[0]().tidy("\n\n").insert(" "+s+" ",0).insert(v)[1](),!1)}},table:B?function(e,t){var s,c,u,r=_.tr,n=_.td,i=x.modals.table,l=x.placeholders.table,a=g(l[0],[1,1]),o=[];return t.$().value===a?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,f,p){c=m(v(f)||p,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,i){u=m(v(n)||i,r[0],r[1]);var f,p,d,h,b,k;for(f=0;u>f;++f){for(s="|",p=0;c>p;++p)s+=" "+g(l[1],[f+1,p+1])+" |";o.push(s)}for(o=o.join("\n"),s="|",d=0;c>d;++d)s+=" "+g(l[0],[d+1,d+1]).replace(/./g,"-")+" |";for(o=s+"\n"+o,s="|",h=0;c>h;++h)s+=" "+g(l[0],[1,h+1])+" |";o=s+"\n"+o,q.close_tr||(o=o.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(o),b=t.$(),k=b.start+b.value.indexOf(a),t.select(k,k+a.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(T.hr[0]+"\n\n",0),!1}}}),f(l.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=q.advance_br;return!c(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",0).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=T.blockquote,l=(T.ul[0],T.ol[0]),a=g(p(l),["\\d+"]),o="(("+p(n)+" )+|"+H+"| +("+a+") )",s=d("^"+o+".*$","gm").exec(r.before.split("\n").pop());if(s){if(s[0]===s[1])return t.outdent(d(o)),!1;if(d("\\s*"+a+"\\s*").test(s[1])){var c=v(b(s[1]));return t.insert("\n"+s[1].replace(/\d+/,c+1),0).scroll(!0),!1}return t.insert("\n"+s[1],0).scroll(!0),!1}},"shift+tab":function(e,t){var m,r=t.$(),n=r.before,i=r.value,a=r.after,o=T.ol[0],s=p(o),c=g(s,["\\d+"]),u=p(T.blockquote),f=d("  "+H+"$"),h=d("   ( ?"+c+" )$"),b="("+u+" |"+H+"| +"+c+" )";if(i){if(i&&(m=i.match(d("(^|\\n)"+b,"g"))))return t.outdent(d(b)),!1}else{if(m=n.match(d(u+" $")))return t.outdent(m[0]),!1;if(m=n.match(f))return n=n.replace(f,"$1"),t.set(n+a).select(n.length),!1;if(m=n.match(h))return n=n.replace(h,"$1"),t.set(n+a).select(n.length),!1}return l.tools.outdent.click(e,t)},tab:function(e,t){var b,r=t.$(),n=r.before,i=r.value,a=r.after,o=T.ol[0],s=T.blockquote,c=p(o),u=p(s),f=d(H+"$"),h=d(" ?"+g(c,["\\d+"])+" $");if(i){if(d("^"+u+" ").test(i))return t.indent(s+" "),!1}else{if(b=n.match(d(u+" $")))return t.insert(b[0],0),!1;if(b=n.match(f))return n=n.replace(f,"  $1"),t.set(n+a).select(n.length),!1;if(b=n.match(h))return n=n.replace(h,"    "+g(o,[1])+" "),t.set(n+a).select(n.length),!1}return l.tools.indent.click(e,t)}}),i.update({},0)};