/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function b(e){return h(e.replace(/\s+/g," "))}function v(e){return p(b(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function k(e){return p(b(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var r=new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),n=r.ui,l=r.is,s=l.o,a=function(e){return!l.x(e)},i=l.s,f=r._,c=f.extend,o=f.x,u=f.pattern,p=f.replace,h=f.trim,d=f.edge,$=f.format,g=f.i,m="	";r.update(c({languages:{tools:{sup:["Footnote",r.config.languages.tools.sub[1]]}}},t),0),r.type="Markdown";var y=r.config,_=y.states,x=y.languages,w=y.formats,q=y.tab,O=x.placeholders,S=0,T=y.extra,D="( +["+o(w.ul).join("")+"] )";return T||(y["advance_pre,code"]=0),r.mark=function(e,t,n,l){s(e)||(e=[e]),a(n)||(n=" "),a(l)||(l="");var i=r[0]().$(),f=e[0]+l,c=l+(a(e[1])?e[1]:e[0]),p=i.value,h=o(f),d=o(c),$=u("^"+h+"([\\s\\S]*?)"+d+"$"),g=u(h+"$"),m=u("^"+d),b=i.before,v=i.after;return p?n=!1:r.insert(O[""]),r.toggle(t?!$.test(p):!g.test(b)&&!m.test(v),[function(e){e.unwrap(f,c,1).tidy(/<[^\/<>]+?>$/.test(b)?"":n,/^<\/[^<>]+?>/.test(v)?"":n).wrap(f,c,t)[1]()},function(e){e.unwrap(f,c,t)[1]()}])},c(n.tools,{b:{click:function(e,t){return t.i().mark(w.b[0]),!1}},i:{click:function(e,t){return t.i().mark(w.i[0]),!1}},u:0,s:T?{click:function(e,t){return t.i().mark(w.s),!1}}:0,a:{click:function(e,t){var p,d,$,g,m,b,y,r=t.$(),l=r.before,s=r.value,a=r.after,i=t.get(),f=/^ {0,3}\[[^\^]+?\]:/.test(i.split("\n").pop())?"\n":"\n\n",c=i.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],o=x.modals.a,u=o.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(s))return t.tidy(" ").mark(["<",">"],1),!1;for(y in c)y=" "+h(c[y]).replace(/^\[|\]:$/g,""),_.a[y]=1;return p=_.a,t.record().ui.prompt(["a[href]",o.title[0]],u,0,function(e,t,i){var y=""===i;i=k(i),t[0](),p[i]?(t.trim(h(l)?" ":"",/^\n+ {0,3}\*?\[/.test(a)?!1:" ").mark(["[","]["+i+"]"],0,!1),g=c.indexOf(" ["+i+"]:"),-1===g&&1!==p[i]&&(r=t.$(),l=r.before,m=r.start,b=r.end,t.set(l+s+h(r.after,1)+f+" ["+(i||h(s)||O[""])+"]: "+(y?"":p[i][0]+(p[i][1]?' "'+p[i][1]+'"':""))).select(m,b),y&&t.focus(!0).insert(u))):(d=i,n.prompt(["a[title]",o.title[1]],o.placeholder[1],0,function(e,t,r){$=v(r),s||t.insert(O[""]),t.i().trim(h(l)?" ":"",h(a)?/^\n+ {0,3}\*?\[/.test(a)?"\n\n ":" ":"").wrap("[","]("+d+($?' "'+$+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var $,g,m,b,y,w,q,r=t.$(),l=r.value,s=l,a=r.before,i=r.after,f=t.get(),c=/^ {0,3}\[[^\^]+?\]:/.test(f.split("\n").pop())?"\n":"\n\n",o=f.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=x.modals.img,p=/^\n* {0,3}\[.+?\]:/.test(i)?" ":"",d=h(i);for(q in o)q=" "+h(o[q]).replace(/^\[|\]:$/g,""),!_.img[q]&&(_.img[q]=1);return $=_.img,n.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,i){i=k(i),g=i,s||(s=g.split(/[\/\\\\]/).pop()),s=v(s),t[0]().trim(h(a)?"\n\n":"",p),$[i]?(t.insert("!["+s+"]["+i+"]\n\n",0,1),p&&t.select(t.$().start),b=o.indexOf(" ["+i+"]:"),-1===b&&(r=t.$(),a=r.before,y=r.start,w=r.end,t.set(a+l+r.after+(d?c:"")+" ["+i+"]: "+$[i][0]+($[i][1]?' "'+$[i][1]+'"':"")).select(y,w))):n.prompt(["img[title]",u.title[1]],u.placeholder[1],0,function(e,t,r){m=v(r),t.insert("!["+s+"]("+g+(m?' "'+m+'"':"")+")\n\n",0,1),p&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:T?{i:"thumb-tack",click:function(t,r){var p,l=r.$(),s=l.before,a=l.after,i=x.modals.sup,f=r.get(),c=/^ {0,3}\[\^.+?\]:/.test(h(f).split("\n").pop())?"\n":"\n\n",o=f.match(/^ {0,3}\[\^.+?\]:/gm)||[],u=0;for(u in o)o[u]=" "+h(o[u]);return u=o.length+1,n.prompt(["sup[id]",i.title],l.value||i.placeholder||u,0,function(t,r,n,l){n=h(n||l)||u,p=o.indexOf(" [^"+n+"]:"),-1!==p?(u=f.indexOf(o[p])+3,r.select(u,u+n.length),e.scrollTop=r.$(1).caret[0].y):r.trim(h(s)?" ":"",!h(a)||/^[\t ]*\n+[\t ]*/.test(a)?"\n\n":" ").insert("[^"+n+"]").set(h(r.get(),1)+c+" [^"+n+"]: ").focus(!0).insert(O[""])}),!1}}:0,abbr:T?{click:function(t,r){var n=r.$(),l=h(n.value),s=x.modals.abbr,a=r.get(),i=b(l||O[""]),f=/^ {0,3}\*\[.+?\]:/.test(a.split("\n").pop())?"\n":"\n\n",c=a.match(/^ {0,3}\*\[.+?\]:/gm)||[],o=_.abbr,u=0;for(u in c)c[u]=" "+h(c[u]);return u=c.indexOf(" *["+i+"]:"),l&&-1!==u?(u=a.indexOf(c[u])+3,r.select(u,u+i.length),e.scrollTop=r.$(1).caret[0].y,!1):(r.record().ui.prompt(["abbr[title]",s.title],o[i]||s.placeholder,!o[l],function(e,t,r,s){if(r=v(r),t[0]().set(h(t.get(),1)+(n.before||l?f:"")+" *["+i+"]: ").focus(!0).insert(r||s),i===O[""]){var a=t.$().start;t.select(a-3-i.length,a-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(O[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){S>5?S=0:S++;var r=t.$(),n=y["advance_h1,h2"],l="\\s?["+o(w.h1[0]+w.h2[0])+"]+\\s*",s=o(w.h1[1]),a=r.before.replace(u("["+s+"\\s]+$"),""),i=b(r.value).replace(u("^["+s+"\\s]+|["+s+"\\s]+$","g"),"").replace(u(l+"$"),"")||O[""],f=r.after.replace(u("^["+s+"\\s]+"),"").replace(u("^"+l),""),c=["",w.h1[n?0:1],w.h2[n?0:1],w.h3,w.h4,w.h5,w.h6];return t[0]().set(a+i+f).select(a.length,(a+i).length).tidy("\n\n"),0===S||(3>S&&n?t.wrap("","\n"+i.replace(/./g,c[S])):t.wrap(c[S]+" ",y["close_h1,h2,h3,h4,h5,h6"]?" "+c[S]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,l=w.blockquote;return n===O[""]?(t.select(),!1):n?(t.tidy(u(l+" $").test(r.before)?!1:"\n\n")[u("^"+l).test(n)?"outdent":"indent"](l+" "),!1):(t[0]().tidy("\n\n").insert(l+" ",0).insert(O[""])[1](),!1)}},"pre,code":{click:function(e,t){var r=t.$(),n=r.before,l=r.value,s=y["advance_pre,code"],a=w.code,f=a[1]||a[0];f=f+f+f,!i(s)&&s?s=f:i(s)&&-1!==s.indexOf("%1")&&(s=$(s,[f]));var c="( {4,}|\\t"+(i(s)?"|"+o(s):"")+")";if(u("(^|\\n)"+c+"?$").test(n)){if(s)return t.mark([s,s.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(s=q===m?m:"    ",!l){t[0]().tidy("\n\n");var p=t.$().start,h=s+O[""];return t.insert(h).select(p+s.length,p+h.length)[1](),!1}return l===O[""]&&u(c+"$").test(n)?(t.select(r.start-s.length,r.end),!1):(t.tidy("\n\n")[u("^"+c).test(l)?"outdent":"indent"](s),!1)}return t.mark(a[0]),!1}},ul:{click:function(e,t){var b,r=t.$(),n=r.value,l=r.before,s=r.after,a=w.ul[0],i=w.ol[0],f=o(a),c=$(o(i),["\\d+"]),p=u("(^|\\n)([\\t ]*) "+f+" (.*)$"),h=u("^(.*) "+f+" ","gm"),d=u("(^|\\n)([\\t ]*) "+c+" (.*)$"),g=u("^(.*) "+c+" ","gm"),m=O[""];return n?(n===m?t.select():g.test(n)?t.replace(g,"$1 "+a+" "):h.test(n)?t.replace(h,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+a+" $2"),!1):s&&l&&("\n"!==s[0]||"\n"!==l.slice(-1))?(b=d.test(l)?l.replace(d,"$1$2 "+a+" $3"):p.test(l)?l.replace(p,"$1$2$3"):l.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+a+" $3"),t.set(b+s).select(b.length),!1):(t[0]().tidy("\n\n").insert(" "+a+" ",0).insert(m)[1](),!1)}},ol:{click:function(e,t){var k,r=t.$(),n=r.value,l=r.before,s=r.after,a=w.ul[0],i=w.ol[0],f=$(i,[1]),c=o(a),p=$(o(i),["\\d+"]),h=u("(^|\\n)([\\t ]*) "+c+" (.*)$"),d=u("^(.*) "+c+" ","gm"),g=u("(^|\\n)([\\t ]*) "+p+" (.*)$"),m=u("^(.*) "+p+" ","gm"),b=O[""],v=0;return n?(n===b?t.select():d.test(n)?t.replace(d,function(e,t,r){return++v,t+" "+$(i,[v])+" "}):m.test(n)?t.replace(m,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++v,t+" "+$(i,[v])+" "+r}),!1):s&&l&&("\n"!==s[0]||"\n"!==l.slice(-1))?(k=h.test(l)?l.replace(h,"$1$2 "+f+" $3"):g.test(l)?l.replace(g,"$1$2$3"):l.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+f+" $3"),t.set(k+s).select(k.length),!1):(t[0]().tidy("\n\n").insert(" "+f+" ",0).insert(b)[1](),!1)}},table:T?function(e,t){var c,o,u,r=_.tr,l=_.td,s=x.modals.table,a=x.placeholders.table,i=$(a[0],[1,1]),f=[];return t[0]().$().value===i?(t.select(),!1):(n.prompt(["table>td",s.title[0]],s.placeholder[0],0,function(e,t,p,h){o=d(g(p)||h,l[0],l[1]),n.prompt(["table>tr",s.title[1]],s.placeholder[1],0,function(e,t,n,l){u=d(g(n)||l,r[0],r[1]);var s,p,h,m,b,v;for(s=0;u>s;++s){for(c="|",p=0;o>p;++p)c+=" "+$(a[1],[s+1,p+1])+" |";f.push(c)}for(f=f.join("\n"),c="|",h=0;o>h;++h)c+=" "+$(a[0],[h+1,h+1]).replace(/./g,"-")+" |";for(f=c+"\n"+f,c="|",m=0;o>m;++m)c+=" "+$(a[0],[1,m+1])+" |";f=c+"\n"+f,y.close_tr||(f=f.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(f),b=t.$(),v=b.start+b.value.indexOf(i),t.select(v,v+i.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(w.hr[0]+"\n\n",0),!1}}}),c(n.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=y.advance_br;return!i(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",0).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=w.blockquote,s=(w.ul[0],w.ol[0]),a=$(o(s),["\\d+"]),i="(("+o(n)+" )+|"+D+"| +("+a+") )",f=u("^"+i+".*$","gm").exec(r.before.split("\n").pop());if(f){if(f[0]===f[1])return t.outdent(u(i)),!1;if(u("\\s*"+a+"\\s*").test(f[1])){var c=g(h(f[1]));return t.insert("\n"+f[1].replace(/\d+/,c+1),0).scroll(!0),!1}return t.insert("\n"+f[1],0).scroll(!0),!1}},"shift+tab":function(e,t){var m,r=t.$(),l=r.before,s=r.value,a=r.after,i=w.ol[0],f=o(i),c=$(f,["\\d+"]),p=o(w.blockquote),h=u("  "+D+"$"),d=u("   ( ?"+c+" )$"),g="("+p+" |"+D+"| +"+c+" )";if(s){if(s&&(m=s.match(u("(^|\\n)"+g,"g"))))return t.outdent(u(g)),!1}else{if(m=l.match(u(p+" $")))return t.outdent(m[0]),!1;if(m=l.match(h))return l=l.replace(h,"$1"),t.set(l+a).select(l.length),!1;if(m=l.match(d))return l=l.replace(d,"$1"),t.set(l+a).select(l.length),!1}return n.tools.outdent.click(e,t)},tab:function(e,t){var g,r=t.$(),l=r.before,s=r.value,a=r.after,i=w.ol[0],f=w.blockquote,c=o(i),p=o(f),h=u(D+"$"),d=u(" ?"+$(c,["\\d+"])+" $");if(s){if(u("^"+p+" ").test(s))return t.indent(f+" "),!1}else{if(g=l.match(u(p+" $")))return t.insert(g[0],0),!1;if(g=l.match(h))return l=l.replace(h,"  $1"),t.set(l+a).select(l.length),!1;if(g=l.match(d))return l=l.replace(d,"    "+$(i,[1])+" "),t.set(l+a).select(l.length),!1}return n.tools.indent.click(e,t)}}),r.update({},0)};