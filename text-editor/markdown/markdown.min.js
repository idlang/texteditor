/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function $(e){return h(e.replace(/\s+/g," "))}function v(e){return p($(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function k(e){return p($(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var r=new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),n=r.ui,l=r.is,a=l.o,i=function(e){return!l.x(e)},s=l.s,o=r._,c=o.extend,f=o.x,u=o.pattern,p=o.replace,h=o.trim,d=o.edge,b=o.format,g=o.i,m="	";r.update(c({languages:{tools:{sup:["Footnote",r.config.languages.tools.sub[1]]}}},t),0),r.type="Markdown";var w=r.config,y=w.states,_=w.languages,q=w.formats,x=w.tab,T=_.placeholders,L=0,O=w.extra,I="( +["+f(q.ul).join("")+"] )";return O||(w["advance_pre,code"]=0),r.mark=function(e,t,n,l){a(e)||(e=[e]),i(n)||(n=" "),i(l)||(l="");var s=r[0]().$(),o=e[0]+l,c=l+(i(e[1])?e[1]:e[0]),p=s.value,h=f(o),d=f(c),b=u("^"+h+"([\\s\\S]*?)"+d+"$"),g=u(h+"$"),m=u("^"+d),$=s.before,v=s.after;return p?n=!1:r.insert(T[""]),r.toggle(t?!b.test(p):!g.test($)&&!m.test(v),[function(e){e.unwrap(o,c,1).tidy(/<[^\/<>]+?>$/.test($)?"":n,/^<\/[^<>]+?>/.test(v)?"":n).wrap(o,c,t)[1]()},function(e){e.unwrap(o,c,t)[1]()}])},c(n.tools,{b:{click:function(e,t){return t.i().mark(q.b[0]),!1}},i:{click:function(e,t){return t.i().mark(q.i[0]),!1}},u:0,s:O?{click:function(e,t){return t.i().mark(q.s),!1}}:0,a:{click:function(e,t){var p,d,b,g,m,$,w,r=t.$(),l=r.before,a=r.value,i=r.after,s=t.get(),o=/^ {0,3}\[[^\^]+?\]:/.test(s.split("\n").pop())?"\n":"\n\n",c=s.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],f=_.modals.a,u=f.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(a))return t.tidy(" ").mark(["<",">"],1),!1;for(w in c)w=" "+h(c[w]).replace(/^\[|\]:$/g,""),y.a[w]=1;return p=y.a,t.record().ui.prompt(["a[href]",f.title[0]],u,0,function(e,t,s){var w=""===s;s=k(s),t[0](),p[s]?(t.trim(h(l)?" ":"",/^\n+ {0,3}\*?\[/.test(i)?!1:" ").mark(["[","]["+s+"]"],0,!1),g=c.indexOf(" ["+s+"]:"),-1===g&&1!==p[s]&&(r=t.$(),l=r.before,m=r.start,$=r.end,t.set(l+a+h(r.after,1)+o+" ["+(s||h(a)||T[""])+"]: "+(w?"":p[s][0]+(p[s][1]?' "'+p[s][1]+'"':""))).select(m,$),w&&t.focus(!0).insert(u))):(d=s,n.prompt(["a[title]",f.title[1]],f.placeholder[1],0,function(e,t,r){b=v(r),a||t.insert(T[""]),t.i().trim(h(l)?" ":"",h(i)?/^\n+ {0,3}\*?\[/.test(i)?"\n\n ":" ":"").wrap("[","]("+d+(b?' "'+b+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var b,g,m,$,w,q,x,r=t.$(),l=r.value,a=l,i=r.before,s=r.after,o=t.get(),c=/^ {0,3}\[[^\^]+?\]:/.test(o.split("\n").pop())?"\n":"\n\n",f=o.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=_.modals.img,p=/^\n* {0,3}\[.+?\]:/.test(s)?" ":"",d=h(s);for(x in f)x=" "+h(f[x]).replace(/^\[|\]:$/g,""),!y.img[x]&&(y.img[x]=1);return b=y.img,n.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,s){s=k(s),g=s,a||(a=g.split(/[\/\\\\]/).pop()),a=v(a),t[0]().trim(h(i)?"\n\n":"",p),b[s]?(t.insert("!["+a+"]["+s+"]\n\n",0,1),p&&t.select(t.$().start),$=f.indexOf(" ["+s+"]:"),-1===$&&(r=t.$(),i=r.before,w=r.start,q=r.end,t.set(i+l+r.after+(d?c:"")+" ["+s+"]: "+b[s][0]+(b[s][1]?' "'+b[s][1]+'"':"")).select(w,q))):n.prompt(["img[title]",u.title[1]],u.placeholder[1],0,function(e,t,r){m=v(r),t.insert("!["+a+"]("+g+(m?' "'+m+'"':"")+")\n\n",0,1),p&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:O?{i:"thumb-tack",click:function(t,r){var p,l=r.$(),a=l.before,i=l.after,s=_.modals.sup,o=r.get(),c=/^ {0,3}\[\^.+?\]:/.test(h(o).split("\n").pop())?"\n":"\n\n",f=o.match(/^ {0,3}\[\^.+?\]:/gm)||[],u=0;for(u in f)f[u]=" "+h(f[u]);return u=f.length+1,n.prompt(["sup[id]",s.title],l.value||s.placeholder||u,0,function(t,r,n,l){n=h(n||l)||u,p=f.indexOf(" [^"+n+"]:"),-1!==p?(u=o.indexOf(f[p])+3,r.select(u,u+n.length),e.scrollTop=r.$(1).caret[0].y):r.trim(h(a)?" ":"",!h(i)||/^[\t ]*\n+[\t ]*/.test(i)?"\n\n":" ").insert("[^"+n+"]").set(h(r.get(),1)+c+" [^"+n+"]: ").focus(!0).insert(T[""])}),!1}}:0,abbr:O?{click:function(t,r){var n=r.$(),l=h(n.value),a=_.modals.abbr,i=r.get(),s=$(l||T[""]),o=/^ {0,3}\*\[.+?\]:/.test(i.split("\n").pop())?"\n":"\n\n",c=i.match(/^ {0,3}\*\[.+?\]:/gm)||[],f=y.abbr,u=0;for(u in c)c[u]=" "+h(c[u]);return u=c.indexOf(" *["+s+"]:"),l&&-1!==u?(u=i.indexOf(c[u])+3,r.select(u,u+s.length),e.scrollTop=r.$(1).caret[0].y,!1):(r.record().ui.prompt(["abbr[title]",a.title],f[s]||a.placeholder,!f[l],function(e,t,r,a){if(r=v(r),t[0]().set(h(t.get(),1)+(n.before||l?o:"")+" *["+s+"]: ").focus(!0).insert(r||a),s===T[""]){var i=t.$().start;t.select(i-3-s.length,i-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(T[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){L>5?L=0:L++;var r=t.$(),n=w["advance_h1,h2"],l="\\s?["+f(q.h1[0]+q.h2[0])+"]+\\s*",a=f(q.h1[1]),i=r.before.replace(u("["+a+"\\s]+$"),""),s=$(r.value).replace(u("^["+a+"\\s]+|["+a+"\\s]+$","g"),"").replace(u(l+"$"),"")||T[""],o=r.after.replace(u("^["+a+"\\s]+"),"").replace(u("^"+l),""),c=["",q.h1[n?0:1],q.h2[n?0:1],q.h3,q.h4,q.h5,q.h6];return t[0]().set(i+s+o).select(i.length,(i+s).length).tidy("\n\n"),0===L||(3>L&&n?t.wrap("","\n"+s.replace(/./g,c[L])):t.wrap(c[L]+" ",w["close_h1,h2,h3,h4,h5,h6"]?" "+c[L]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,l=q.blockquote;return n===T[""]?(t.select(),!1):n?(t.tidy(u(l+" $").test(r.before)?!1:"\n\n")[u("^"+l).test(n)?"outdent":"indent"](l+" "),!1):(t[0]().tidy("\n\n").insert(l+" ",0).insert(T[""])[1](),!1)}},"pre,code":{click:function(e,t){var r=t.$(),n=r.before,l=r.value,a=w["advance_pre,code"],i=q.code,o=i[1]||i[0];o=o+o+o,!s(a)&&a?a=o:s(a)&&-1!==a.indexOf("%1")&&(a=b(a,[o]));var c="( {4,}|\\t"+(s(a)?"|"+f(a):"")+")";if(u("(^|\\n)"+c+"?$").test(n)){if(a)return t.mark([a,a.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(a=x===m?m:"    ",!l){t[0]().tidy("\n\n");var p=t.$().start,h=a+T[""];return t.insert(h).select(p+a.length,p+h.length)[1](),!1}return l===T[""]&&u(c+"$").test(n)?(t.select(r.start-a.length,r.end),!1):(t.tidy("\n\n")[u("^"+c).test(l)?"outdent":"indent"](a),!1)}return t.mark(i[0]),!1}},ul:{click:function(e,t){var $,r=t.$(),n=r.value,l=r.before,a=r.after,i=q.ul[0],s=q.ol[0],o=f(i),c=b(f(s),["\\d+"]),p=u("(^|\\n)([\\t ]*) "+o+" (.*)$"),h=u("^(.*) "+o+" ","gm"),d=u("(^|\\n)([\\t ]*) "+c+" (.*)$"),g=u("^(.*) "+c+" ","gm"),m=T[""];return n?(n===m?t.select():g.test(n)?t.replace(g,"$1 "+i+" "):h.test(n)?t.replace(h,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+i+" $2"),!1):l&&a?($=d.test(l)?l.replace(d,"$1$2 "+i+" $3"):p.test(l)?l.replace(p,"$1$2$3"):l.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+i+" $3"),t.set($+a).select($.length),!1):(t[0]().tidy("\n\n").insert(" "+i+" ",0).insert(m)[1](),!1)}},ol:{click:function(e,t){var k,r=t.$(),n=r.value,l=r.before,a=r.after,i=q.ul[0],s=q.ol[0],o=b(s,[1]),c=f(i),p=b(f(s),["\\d+"]),h=u("(^|\\n)([\\t ]*) "+c+" (.*)$"),d=u("^(.*) "+c+" ","gm"),g=u("(^|\\n)([\\t ]*) "+p+" (.*)$"),m=u("^(.*) "+p+" ","gm"),$=T[""],v=0;return n?(n===$?t.select():d.test(n)?t.replace(d,function(e,t,r){return++v,t+" "+b(s,[v])+" "}):m.test(n)?t.replace(m,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++v,t+" "+b(s,[v])+" "+r}),!1):l&&a?(k=h.test(l)?l.replace(h,"$1$2 "+o+" $3"):g.test(l)?l.replace(g,"$1$2$3"):l.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+o+" $3"),t.set(k+a).select(k.length),!1):(t[0]().tidy("\n\n").insert(" "+o+" ",0).insert($)[1](),!1)}},table:O?function(e,t){var c,f,u,r=y.tr,l=y.td,a=_.modals.table,i=_.placeholders.table,s=b(i[0],[1,1]),o=[];return t[0]().$().value===s?(t.select(),!1):(n.prompt(["table>td",a.title[0]],a.placeholder[0],0,function(e,t,p,h){f=d(g(p)||h,l[0],l[1]),n.prompt(["table>tr",a.title[1]],a.placeholder[1],0,function(e,t,n,l){u=d(g(n)||l,r[0],r[1]);var a,p,h,m,$,v;for(a=0;u>a;++a){for(c="|",p=0;f>p;++p)c+=" "+b(i[1],[a+1,p+1])+" |";o.push(c)}for(o=o.join("\n"),c="|",h=0;f>h;++h)c+=" "+b(i[0],[h+1,h+1]).replace(/./g,"-")+" |";for(o=c+"\n"+o,c="|",m=0;f>m;++m)c+=" "+b(i[0],[1,m+1])+" |";o=c+"\n"+o,w.close_tr||(o=o.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(o),$=t.$(),v=$.start+$.value.indexOf(s),t.select(v,v+s.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(q.hr[0]+"\n\n",0),!1}}}),c(n.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=w.advance_br;return!s(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",0).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=q.blockquote,a=(q.ul[0],q.ol[0]),i=b(f(a),["\\d+"]),s="(("+f(n)+" )+|"+I+"| +("+i+") )",o=u("^"+s+".*$","gm").exec(r.before.split("\n").pop());if(o){if(o[0]===o[1])return t.outdent(u(s)),!1;if(u("\\s*"+i+"\\s*").test(o[1])){var c=g(h(o[1]));return t.insert("\n"+o[1].replace(/\d+/,c+1),0).scroll(!0),!1}return t.insert("\n"+o[1],0).scroll(!0),!1}},"shift+tab":function(e,t){var m,r=t.$(),l=r.before,a=r.value,i=r.after,s=q.ol[0],o=f(s),c=b(o,["\\d+"]),p=f(q.blockquote),h=u("  "+I+"$"),d=u("   ( ?"+c+" )$"),g="("+p+" |"+I+"| +"+c+" )";if(a){if(a&&(m=a.match(u("(^|\\n)"+g,"g"))))return t.outdent(u(g)),!1}else{if(m=l.match(u(p+" $")))return t.outdent(m[0]),!1;if(m=l.match(h))return l=l.replace(h,"$1"),t.set(l+i).select(l.length),!1;if(m=l.match(d))return l=l.replace(d,"$1"),t.set(l+i).select(l.length),!1}return n.tools.outdent.click(e,t)},tab:function(e,t){var g,r=t.$(),l=r.before,a=r.value,i=r.after,s=q.ol[0],o=q.blockquote,c=f(s),p=f(o),h=u(I+"$"),d=u(" ?"+b(c,["\\d+"])+" $");if(a){if(u("^"+p+" ").test(a))return t.indent(o+" "),!1}else{if(g=l.match(u(p+" $")))return t.insert(g[0],0),!1;if(g=l.match(h))return l=l.replace(h,"  $1"),t.set(l+i).select(l.length),!1;if(g=l.match(d))return l=l.replace(d,"    "+b(s,[1])+" "),t.set(l+i).select(l.length),!1}return n.tools.indent.click(e,t)}}),r.update({},0)};