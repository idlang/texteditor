/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function p(e){return L(e.replace(/\s+/g," "))}function N(e){return I(p(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function T(e){return I(p(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var n=new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:["~~"],h1:["=","#"],h2:["-","##"],h3:["###"],h4:["####"],h5:["#####"],h6:["######"],blockquote:[">"],code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),r=n.ui,i="	",o=n.is,l=o.o,a=function(e){return!o.x(e)},s=o.s,f=n._,u=f.edge,c=f.x,A=f.extend,E=f.format,O=f.i,R=f.pattern,I=f.replace,L=f.trim;n.update(A({languages:{tools:{sup:["Footnote",n.config.languages.tools.sub[1]]}}},t),0),n.type="Markdown";var d=n.config,S=d.extra,h=d.formats,F=d.languages,C=d.states,b=d.tab,G=F.placeholders,g="( +["+c(h.ul).join("")+"] )",m=0;return S||(d["advance_pre,code"]=0),n.mark=function(e,t,r,i){l(e)||(e=[e]),a(r)||(r=" "),a(i)||(i="");var o=n.h,s=n[0]().$(),f=e[0]+i,u=i+(a(e[1])?e[1]:e[0]),A=s.value,E=c(f),O=c(u),I=R("^"+E+"([\\s\\S]*?)"+O+"$"),L=R(E+"$"),p=R("^"+O),N=s.before,T=s.after;return A?r=!1:n.insert(G[""]),n.toggle(t?!I.test(A):!L.test(N)&&!p.test(T),[function(e){e.unwrap(f,u,1).tidy(/<[^\/<>]+?>$/.test(N)?"":r,/^<\/[^<>]+?>/.test(T)?"":r).wrap(f,u,t)},function(e){e.unwrap(f,u,t)}])[1]()[o]()},A(r.tools,{b:{click:function(e,t){return t.i().mark(h.b[0]),!1}},i:{click:function(e,t){return t.i().mark(h.i[0]),!1}},u:0,s:S?{click:function(e,t){return t.i().mark(h.s[0]),!1}}:0,a:{click:function(e,t){var A,E,O,R,I,p,d,n=t.$(),i=n.before,o=n.value,l=n.after,a=t.get(),s=/^ {0,3}\[[^\^]+?\]:/.test(a.split("\n").pop())?"\n":"\n\n",f=a.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=F.modals.a,c=u.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(o))return t.tidy(" ").mark(["<",">"],1),!1;for(d in f)d=" "+L(f[d]).replace(/^\[|\]:$/g,""),C.a[d]=1;return A=C.a,t.record().ui.prompt(["a[href]",u.title[0]],c,0,function(e,t,a){var d=""===a;a=T(a),t[0](),A[a]?(t.trim(L(i)?" ":"",/^\n+ {0,3}\*?\[/.test(l)?!1:" ").mark(["[","]["+a+"]"],0,!1),R=f.indexOf(" ["+a+"]:"),-1===R&&1!==A[a]&&(n=t.$(),i=n.before,I=n.start,p=n.end,t.set(i+o+L(n.after,1)+s+" ["+(a||L(o)||G[""])+"]: "+(d?"":A[a][0]+(A[a][1]?' "'+A[a][1]+'"':""))).select(I,p),d&&t.focus(!0).insert(c))):(E=a,r.prompt(["a[title]",u.title[1]],u.placeholder[1],0,function(e,t,n){O=N(n),o||t.insert(G[""]),t.i().trim(L(i)?" ":"",L(l)?/^\n+ {0,3}\*?\[/.test(l)?"\n\n ":" ":"").wrap("[","]("+E+(O?' "'+O+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var O,R,I,p,d,S,h,n=t.$(),i=n.value,o=i,l=n.before,a=n.after,s=t.get(),f=/^ {0,3}\[[^\^]+?\]:/.test(s.split("\n").pop())?"\n":"\n\n",u=s.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],c=F.modals.img,A=/^\n* {0,3}\[.+?\]:/.test(a)?" ":"",E=L(a);for(h in u)h=" "+L(u[h]).replace(/^\[|\]:$/g,""),!C.img[h]&&(C.img[h]=1);return O=C.img,r.prompt(["img[src]",c.title[0]],c.placeholder[0],1,function(e,t,a){a=T(a),R=a,o||(o=R.split(/[\/\\\\]/).pop()),o=N(o),t[0]().trim(L(l)?"\n\n":"",A),O[a]?(t.insert("!["+o+"]["+a+"]\n\n",0,1),A&&t.select(t.$().start),p=u.indexOf(" ["+a+"]:"),-1===p&&(n=t.$(),l=n.before,d=n.start,S=n.end,t.set(l+i+n.after+(E?f:"")+" ["+a+"]: "+O[a][0]+(O[a][1]?' "'+O[a][1]+'"':"")).select(d,S))):r.prompt(["img[title]",c.title[1]],c.placeholder[1],0,function(e,t,n){I=N(n),t.insert("!["+o+"]("+R+(I?' "'+I+'"':"")+")\n\n",0,1),A&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:S?{i:"thumb-tack",click:function(t,n){var A,i=n.$(),o=i.before,l=i.after,a=F.modals.sup,s=n.get(),f=/^ {0,3}\[\^.+?\]:/.test(L(s).split("\n").pop())?"\n":"\n\n",u=s.match(/^ {0,3}\[\^.+?\]:/gm)||[],c=0;for(c in u)u[c]=" "+L(u[c]);return c=u.length+1,r.prompt(["sup[id]",a.title],i.value||a.placeholder||c,0,function(t,n,r,i){r=L(r||i)||c,A=u.indexOf(" [^"+r+"]:"),-1!==A?(c=s.indexOf(u[A])+3,n.select(c,c+r.length),e.scrollTop=n.$(1).caret[0].y):n.trim(L(o)?" ":"",!L(l)||/^[\t ]*\n+[\t ]*/.test(l)?"\n\n":" ").insert("[^"+r+"]").set(L(n.get(),1)+f+" [^"+r+"]: ").focus(!0).insert(G[""])}),!1}}:0,abbr:S?{click:function(t,n){var r=n.$(),i=L(r.value),o=F.modals.abbr,l=n.get(),a=p(i||G[""]),s=/^ {0,3}\*\[.+?\]:/.test(l.split("\n").pop())?"\n":"\n\n",f=l.match(/^ {0,3}\*\[.+?\]:/gm)||[],u=C.abbr,c=0;for(c in f)f[c]=" "+L(f[c]);return c=f.indexOf(" *["+a+"]:"),i&&-1!==c?(c=l.indexOf(f[c])+3,n.select(c,c+a.length),e.scrollTop=n.$(1).caret[0].y,!1):(n.record().ui.prompt(["abbr[title]",o.title],u[a]||o.placeholder,!u[i],function(e,t,n,o){if(n=N(n),t[0]().set(L(t.get(),1)+(r.before||i?s:"")+" *["+a+"]: ").focus(!0).insert(n||o),a===G[""]){var l=t.$().start;t.select(l-3-a.length,l-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(G[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){m>5?m=0:m++;var n=t.$(),r=d["advance_h1,h2"],i="\\s?["+c(h.h1[0]+h.h2[0])+"]+\\s*",o=c(h.h1[1]),l=n.before.replace(R("["+o+"\\s]+$"),""),a=p(n.value).replace(R("^["+o+"\\s]+|["+o+"\\s]+$","g"),"").replace(R(i+"$"),"")||G[""],s=n.after.replace(R("^["+o+"\\s]+"),"").replace(R("^"+i),""),f=["",h.h1[r?0:1],h.h2[r?0:1],h.h3[0],h.h4[0],h.h5[0],h.h6[0]];return t[0]().set(l+a+s).select(l.length,(l+a).length).tidy("\n\n"),0===m||(3>m&&r?t.wrap("","\n"+a.replace(/./g,f[m])):t.wrap(f[m]+" ",d["close_h1,h2,h3,h4,h5,h6"]?" "+f[m]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var n=t.$(),r=n.value,i=h.blockquote[0];return r===G[""]?(t.select(),!1):r?(t.tidy(R(i+" $").test(n.before)?!1:"\n\n")[R("^"+i).test(r)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",0).insert(G[""])[1](),!1)}},"pre,code":{click:function(e,t){var u,A,O,n=t.$(),r=n.before,o=n.value,l=d["advance_pre,code"],a=h.code,f=a[1]||a[0];return f=f+f+f,!s(l)&&l?l=f:s(l)&&-1!==l.indexOf("%")&&(l=E(l,[f])),u="( {4,}|\\t"+(s(l)?"|"+c(l):"")+")",R("(^|\\n)"+u+"?$").test(r)?l?(t.mark([l,l.split(/\s+/)[0]],0,"\n\n","\n"),!1):(l=b===i?i:"    ",o?o===G[""]&&R(u+"$").test(r)?(t.select(n.start-l.length,n.end),!1):(t.tidy("\n\n")[R("^"+u).test(o)?"outdent":"indent"](l),!1):(t[0]().tidy("\n\n"),A=t.$().start,O=l+G[""],t.insert(O).select(A+l.length,A+O.length)[1](),!1)):(t.mark(a[0]),!1)}},ul:{click:function(e,t){var p,n=t.$(),r=n.value,i=n.before,o=n.after,l=h.ul[0],a=h.ol[0],s=c(l),f=E(c(a),["\\d+"]),u=R("(^|\\n)([\\t ]*) "+s+" (.*)$"),A=R("^(.*) "+s+" ","gm"),O=R("(^|\\n)([\\t ]*) "+f+" (.*)$"),I=R("^(.*) "+f+" ","gm"),L=G[""];return r?(r===L?t.select():I.test(r)?t.replace(I,"$1 "+l+" "):A.test(r)?t.replace(A,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+l+" $2"),!1):o&&i&&("\n"!==o[0]||"\n"!==i.slice(-1))?(p=O.test(i)?i.replace(O,"$1$2 "+l+" $3"):u.test(i)?i.replace(u,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+l+" $3"),t.set(p+o).select(p.length),!1):(t[0]().tidy("\n\n").insert(" "+l+" ",0).insert(L)[1](),!1)}},ol:{click:function(e,t){var T,n=t.$(),r=n.value,i=n.before,o=n.after,l=h.ul[0],a=h.ol[0],s=E(a,[1]),f=c(l),u=E(c(a),["\\d+"]),A=R("(^|\\n)([\\t ]*) "+f+" (.*)$"),O=R("^(.*) "+f+" ","gm"),I=R("(^|\\n)([\\t ]*) "+u+" (.*)$"),L=R("^(.*) "+u+" ","gm"),p=G[""],N=0;return r?(r===p?t.select():O.test(r)?t.replace(O,function(e,t,n){return++N,t+" "+E(a,[N])+" "}):L.test(r)?t.replace(L,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,n){return++N,t+" "+E(a,[N])+" "+n}),!1):o&&i&&("\n"!==o[0]||"\n"!==i.slice(-1))?(T=A.test(i)?i.replace(A,"$1$2 "+s+" $3"):I.test(i)?i.replace(I,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+s+" $3"),t.set(T+o).select(T.length),!1):(t[0]().tidy("\n\n").insert(" "+s+" ",0).insert(p)[1](),!1)}},table:S?function(e,t){var f,c,A,n=C.tr,i=C.td,o=F.modals.table,l=F.placeholders.table,a=E(l[0],[1,1]),s=[];return t[0]().$().value===a?(t.select(),!1):(r.prompt(["table>td",o.title[0]],o.placeholder[0],0,function(e,t,R,I){c=u(O(R)||I,i[0],i[1]),r.prompt(["table>tr",o.title[1]],o.placeholder[1],0,function(e,t,r,i){A=u(O(r)||i,n[0],n[1]);var o,R,I,L,p,N;for(o=0;A>o;++o){for(f="|",R=0;c>R;++R)f+=" "+E(l[1],[o+1,R+1])+" |";s.push(f)}for(s=s.join("\n"),f="|",I=0;c>I;++I)f+=" "+E(l[0],[I+1,I+1]).replace(/./g,"-")+" |";for(s=f+"\n"+s,f="|",L=0;c>L;++L)f+=" "+E(l[0],[1,L+1])+" |";s=f+"\n"+s,d.close_tr||(s=s.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(s),p=t.$(),N=p.start+p.value.indexOf(a),t.select(N,N+a.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(h.hr[0]+"\n\n",0),!1}}}),A(r.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var n=d.advance_br;return!s(n)&&n&&(n="  \n"),t.trim().insert(n||"\n",0),!1},enter:function(e,t){var n=t.$(),r=h.blockquote[0],o=(h.ul[0],h.ol[0]),l=E(c(o),["\\d+"]),a="(("+c(r)+" )+|"+g+"| +("+l+") )",s=R("^"+a+".*$","gm").exec(n.before.split("\n").pop());if(s){if(s[0]===s[1])return t.outdent(R(a)),!1;if(R("\\s*"+l+"\\s*").test(s[1])){var f=O(L(s[1]));return t.insert("\n"+s[1].replace(/\d+/,f+1),0),!1}return t.insert("\n"+s[1],0),!1}},"shift+tab":function(e,t){var L,n=t.$(),i=n.before,o=n.value,l=n.after,a=h.ol[0],s=c(a),f=E(s,["\\d+"]),u=c(h.blockquote[0]),A=R("  "+g+"$"),O=R("   ( ?"+f+" )$"),I="("+u+" |"+g+"| +"+f+" )";if(o){if(o&&(L=o.match(R("(^|\\n)"+I,"g"))))return t.outdent(R(I)),!1}else{if(L=i.match(R(u+" $")))return t.outdent(L[0]),!1;if(L=i.match(A))return i=i.replace(A,"$1"),t.set(i+l).select(i.length),!1;if(L=i.match(O))return i=i.replace(O,"$1"),t.set(i+l).select(i.length),!1}return r.tools.outdent.click(e,t)},tab:function(e,t){var I,n=t.$(),i=n.before,o=n.value,l=n.after,a=h.ol[0],s=h.blockquote[0],f=c(a),u=c(s),A=R(g+"$"),O=R(" ?"+E(f,["\\d+"])+" $");if(o){if(R("^"+u+" ").test(o))return t.indent(s+" "),!1}else{if(I=i.match(R(u+" $")))return t.insert(I[0],0),!1;if(I=i.match(A))return i=i.replace(A,"  $1"),t.set(i+l).select(i.length),!1;if(I=i.match(O))return i=i.replace(O,"    "+E(a,[1])+" "),t.set(i+l).select(i.length),!1}return r.tools.indent.click(e,t)}}),n.update({},0)};