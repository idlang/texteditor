/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function k(e){return d(e.replace(/\s+/g," "))}function v(e){return p(k(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function y(e){return p(k(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var n=new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),o=n.ui,i=n.is,r=i.o,l=function(e){return!i.x(e)},c=i.s,s=n._,f=s.extend,u=s.x,a=s.pattern,p=s.replace,d=s.trim,b=s.edge,h=s.format,g=s.i,m="	";n.update(f({languages:{tools:{sup:["Footnote",n.config.languages.tools.sub[1]]}}},t),0),n.type="Markdown";var $=n.config,x=$.states,w=$.languages,T=$.formats,_=$.tab,q=w.placeholders,E=0,L=$.extra,z="( +["+u(T.ul).join("")+"] )";return L||($["advance_pre,code"]=0),n.mark=function(e,t,o,i){r(e)||(e=[e]),l(o)||(o=" "),l(i)||(i="");var c=n.$(),s=e[0]+i,f=i+(l(e[1])?e[1]:e[0]),p=c.value,d=u(s),b=u(f),h=a("^"+d+"([\\s\\S]*?)"+b+"$"),g=a(d+"$"),m=a("^"+b),k=c.before,v=c.after;return p?o=!1:n.insert(q[""]).loss(),n.toggle(t?!h.test(p):!g.test(k)&&!m.test(v),[function(e){e.unwrap(s,f,1).tidy(/<[^\/<>]+?>$/.test(k)?"":o,/^<\/[^<>]+?>/.test(v)?"":o).loss().wrap(s,f,t)},function(e){e.unwrap(s,f,t)}])},f(o.tools,{b:{click:function(e,t){return t.i().mark(T.b[0]),!1}},i:{click:function(e,t){return t.i().mark(T.i[0]),!1}},u:0,s:L?{click:function(e,t){return t.i().mark(T.s),!1}}:0,a:{click:function(e,t){var p,b,h,g,m,k,$,n=t.$(),i=n.before,r=n.value,l=n.after,c=t.get(),s=/^ {0,3}\[[^\^]+?\]:/.test(c.split("\n").pop())?"\n":"\n\n",f=c.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=w.modals.a,a=u.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(r))return t.tidy(" ").mark(["<",">"],1),!1;for($ in f)$=" "+d(f[$]).replace(/^\[|\]:$/g,""),x.a[$]=1;return p=x.a,t.record().ui.prompt(["a[href]",u.title[0]],a,0,function(e,t,c){var $=""===c;c=y(c),t[0](),p[c]?(t.trim(d(i)?" ":"",/^\n+ {0,3}\*?\[/.test(l)?!1:" ").mark(["[","]["+c+"]"],0,!1),g=f.indexOf(" ["+c+"]:"),-1===g&&1!==p[c]&&(n=t.$(),i=n.before,m=n.start,k=n.end,t.set(i+r+d(n.after,1)+s+" ["+(c||d(r)||q[""])+"]: "+($?"":p[c][0]+(p[c][1]?' "'+p[c][1]+'"':""))).select(m,k),$&&t.focus(!0).insert(a))):(b=c,o.prompt(["a[title]",u.title[1]],u.placeholder[1],0,function(e,t,n){h=v(n),r||t.insert(q[""]),t.i().trim(d(i)?" ":"",d(l)?/^\n+ {0,3}\*?\[/.test(l)?"\n\n ":" ":"").wrap("[","]("+b+(h?' "'+h+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var h,g,m,k,$,T,_,n=t.$(),i=n.value,r=i,l=n.before,c=n.after,s=t.get(),f=/^ {0,3}\[[^\^]+?\]:/.test(s.split("\n").pop())?"\n":"\n\n",u=s.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],a=w.modals.img,p=/^\n* {0,3}\[.+?\]:/.test(c)?" ":"",b=d(c);for(_ in u)_=" "+d(u[_]).replace(/^\[|\]:$/g,""),!x.img[_]&&(x.img[_]=1);return h=x.img,o.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,c){c=y(c),g=c,r||(r=g.split(/[\/\\\\]/).pop()),r=v(r),t[0]().trim(d(l)?"\n\n":"",p),h[c]?(t.insert("!["+r+"]["+c+"]\n\n",0,1),p&&t.select(t.$().start),k=u.indexOf(" ["+c+"]:"),-1===k&&(n=t.$(),l=n.before,$=n.start,T=n.end,t.set(l+i+n.after+(b?f:"")+" ["+c+"]: "+h[c][0]+(h[c][1]?' "'+h[c][1]+'"':"")).select($,T))):o.prompt(["img[title]",a.title[1]],a.placeholder[1],0,function(e,t,n){m=v(n),t.insert("!["+r+"]("+g+(m?' "'+m+'"':"")+")\n\n",0,1),p&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:L?{i:"thumb-tack",click:function(t,n){var p,i=n.$(),r=i.before,l=i.after,c=w.modals.sup,s=n.get(),f=/^ {0,3}\[\^.+?\]:/.test(d(s).split("\n").pop())?"\n":"\n\n",u=s.match(/^ {0,3}\[\^.+?\]:/gm)||[],a=0;for(a in u)u[a]=" "+d(u[a]);return a=u.length+1,o.prompt(["sup[id]",c.title],i.value||c.placeholder||a,0,function(t,n,o,i){o=d(o||i)||a,p=u.indexOf(" [^"+o+"]:"),-1!==p?(a=s.indexOf(u[p])+3,n.select(a,a+o.length),e.scrollTop=n.$(1).caret[0].y):n.trim(d(r)?" ":"",!d(l)||/^[\t ]*\n+[\t ]*/.test(l)?"\n\n":" ").insert("[^"+o+"]").set(d(n.get(),1)+f+" [^"+o+"]: ").focus(!0).insert(q[""])}),!1}}:0,abbr:L?{click:function(t,n){var o=n.$(),i=d(o.value),r=w.modals.abbr,l=n.get(),c=k(i||q[""]),s=/^ {0,3}\*\[.+?\]:/.test(l.split("\n").pop())?"\n":"\n\n",f=l.match(/^ {0,3}\*\[.+?\]:/gm)||[],u=x.abbr,a=0;for(a in f)f[a]=" "+d(f[a]);return a=f.indexOf(" *["+c+"]:"),i&&-1!==a?(a=l.indexOf(f[a])+3,n.select(a,a+c.length),e.scrollTop=n.$(1).caret[0].y,!1):(n.record().ui.prompt(["abbr[title]",r.title],u[c]||r.placeholder,!u[i],function(e,t,n,r){if(n=v(n),t[0]().set(d(t.get(),1)+(o.before||i?s:"")+" *["+c+"]: ").focus(!0).insert(n||r),c===q[""]){var l=t.$().start;t.select(l-3-c.length,l-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(q[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){E>5?E=0:E++;var n=t.$(),o=$["advance_h1,h2"],i="\\s?["+u(T.h1[0]+T.h2[0])+"]+\\s*",r=u(T.h1[1]),l=n.before.replace(a("["+r+"\\s]+$"),""),c=k(n.value).replace(a("^["+r+"\\s]+|["+r+"\\s]+$","g"),"").replace(a(i+"$"),"")||q[""],s=n.after.replace(a("^["+r+"\\s]+"),"").replace(a("^"+i),""),f=["",T.h1[o?0:1],T.h2[o?0:1],T.h3,T.h4,T.h5,T.h6];return t[0]().set(l+c+s).select(l.length,(l+c).length).tidy("\n\n"),0===E||(3>E&&o?t.wrap("","\n"+c.replace(/./g,f[E])):t.wrap(f[E]+" ",$["close_h1,h2,h3,h4,h5,h6"]?" "+f[E]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var n=t.$(),o=n.value,i=T.blockquote;return o===q[""]?(t.select(),!1):o?(t.tidy(a(i+" $").test(n.before)?!1:"\n\n")[a("^"+i).test(o)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",0).insert(q[""])[1](),!1)}},"pre,code":{click:function(e,t){var n=t.$(),o=n.before,i=n.value,r=$["advance_pre,code"],l=T.code,s=l[1]||l[0];s=s+s+s,!c(r)&&r?r=s:c(r)&&-1!==r.indexOf("%1")&&(r=h(r,[s]));var f="( {4,}|\\t"+(c(r)?"|"+u(r):"")+")";if(a("(^|\\n)"+f+"?$").test(o)){if(r)return t.mark([r,r.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(r=_===m?m:"    ",!i){t[0]().tidy("\n\n");var p=t.$().start,d=r+q[""];return t.insert(d).select(p+r.length,p+d.length)[1](),!1}return i===q[""]&&a(f+"$").test(o)?(t.select(n.start-r.length,n.end),!1):(t.tidy("\n\n")[a("^"+f).test(i)?"outdent":"indent"](r),!1)}return t.mark(l[0]),!1}},ul:{click:function(e,t){var k,n=t.$(),o=n.value,i=n.before,r=n.after,l=T.ul[0],c=T.ol[0],s=u(l),f=h(u(c),["\\d+"]),p=a("(^|\\n)([\\t ]*) "+s+" (.*)$"),d=a("^(.*) "+s+" ","gm"),b=a("(^|\\n)([\\t ]*) "+f+" (.*)$"),g=a("^(.*) "+f+" ","gm"),m=q[""];return o?(o===m?t.select():g.test(o)?t.replace(g,"$1 "+l+" "):d.test(o)?t.replace(d,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+l+" $2"),!1):r&&i&&("\n"!==r[0]||"\n"!==i.slice(-1))?(k=b.test(i)?i.replace(b,"$1$2 "+l+" $3"):p.test(i)?i.replace(p,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+l+" $3"),t.set(k+r).select(k.length),!1):(t[0]().tidy("\n\n").insert(" "+l+" ",0).insert(m)[1](),!1)}},ol:{click:function(e,t){var y,n=t.$(),o=n.value,i=n.before,r=n.after,l=T.ul[0],c=T.ol[0],s=h(c,[1]),f=u(l),p=h(u(c),["\\d+"]),d=a("(^|\\n)([\\t ]*) "+f+" (.*)$"),b=a("^(.*) "+f+" ","gm"),g=a("(^|\\n)([\\t ]*) "+p+" (.*)$"),m=a("^(.*) "+p+" ","gm"),k=q[""],v=0;return o?(o===k?t.select():b.test(o)?t.replace(b,function(e,t,n){return++v,t+" "+h(c,[v])+" "}):m.test(o)?t.replace(m,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,n){return++v,t+" "+h(c,[v])+" "+n}),!1):r&&i&&("\n"!==r[0]||"\n"!==i.slice(-1))?(y=d.test(i)?i.replace(d,"$1$2 "+s+" $3"):g.test(i)?i.replace(g,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+s+" $3"),t.set(y+r).select(y.length),!1):(t[0]().tidy("\n\n").insert(" "+s+" ",0).insert(k)[1](),!1)}},table:L?function(e,t){var f,u,a,n=x.tr,i=x.td,r=w.modals.table,l=w.placeholders.table,c=h(l[0],[1,1]),s=[];return t[0]().$().value===c?(t.select(),!1):(o.prompt(["table>td",r.title[0]],r.placeholder[0],0,function(e,t,p,d){u=b(g(p)||d,i[0],i[1]),o.prompt(["table>tr",r.title[1]],r.placeholder[1],0,function(e,t,o,i){a=b(g(o)||i,n[0],n[1]);var r,p,d,m,k,v;for(r=0;a>r;++r){for(f="|",p=0;u>p;++p)f+=" "+h(l[1],[r+1,p+1])+" |";s.push(f)}for(s=s.join("\n"),f="|",d=0;u>d;++d)f+=" "+h(l[0],[d+1,d+1]).replace(/./g,"-")+" |";for(s=f+"\n"+s,f="|",m=0;u>m;++m)f+=" "+h(l[0],[1,m+1])+" |";s=f+"\n"+s,$.close_tr||(s=s.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(s),k=t.$(),v=k.start+k.value.indexOf(c),t.select(v,v+c.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(T.hr[0]+"\n\n",0),!1}}}),f(o.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var n=$.advance_br;return!c(n)&&n&&(n="  \n"),t.trim().insert(n||"\n",0).scroll(!0),!1},enter:function(e,t){var n=t.$(),o=T.blockquote,r=(T.ul[0],T.ol[0]),l=h(u(r),["\\d+"]),c="(("+u(o)+" )+|"+z+"| +("+l+") )",s=a("^"+c+".*$","gm").exec(n.before.split("\n").pop());if(s){if(s[0]===s[1])return t.outdent(a(c)),!1;if(a("\\s*"+l+"\\s*").test(s[1])){var f=g(d(s[1]));return t.insert("\n"+s[1].replace(/\d+/,f+1),0).scroll(!0),!1}return t.insert("\n"+s[1],0).scroll(!0),!1}},"shift+tab":function(e,t){var m,n=t.$(),i=n.before,r=n.value,l=n.after,c=T.ol[0],s=u(c),f=h(s,["\\d+"]),p=u(T.blockquote),d=a("  "+z+"$"),b=a("   ( ?"+f+" )$"),g="("+p+" |"+z+"| +"+f+" )";if(r){if(r&&(m=r.match(a("(^|\\n)"+g,"g"))))return t.outdent(a(g)),!1}else{if(m=i.match(a(p+" $")))return t.outdent(m[0]),!1;if(m=i.match(d))return i=i.replace(d,"$1"),t.set(i+l).select(i.length),!1;if(m=i.match(b))return i=i.replace(b,"$1"),t.set(i+l).select(i.length),!1}return o.tools.outdent.click(e,t)},tab:function(e,t){var g,n=t.$(),i=n.before,r=n.value,l=n.after,c=T.ol[0],s=T.blockquote,f=u(c),p=u(s),d=a(z+"$"),b=a(" ?"+h(f,["\\d+"])+" $");if(r){if(a("^"+p+" ").test(r))return t.indent(s+" "),!1}else{if(g=i.match(a(p+" $")))return t.insert(g[0],0),!1;if(g=i.match(d))return i=i.replace(d,"  $1"),t.set(i+l).select(i.length),!1;if(g=i.match(b))return i=i.replace(b,"    "+h(c,[1])+" "),t.set(i+l).select(i.length),!1}return o.tools.indent.click(e,t)}}),n.update({},0)};