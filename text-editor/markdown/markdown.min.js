/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function y(e){return b(e.replace(/\s+/g," "))}function w(e){return h(y(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function $(e){return h(y(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var i=(window,document,new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}})),o=i.ui,l=i.is,a=l.o,s=function(e){return!l.x(e)},f=l.s,u=i._,c=u.extend,p=u.x,d=u.pattern,h=u.replace,b=u.trim,g=u.edge,m=u.format,v=u.i,k="	";i.update(c({languages:{tools:{sup:["Footnote",i.config.languages.tools.sub[1]]}}},t),0),i.type="Markdown";var x=i.config,T=x.states,_=x.languages,E=x.formats,q=x.tab,L=_.placeholders,C=0,H=x.extra,O="( +["+p(E.ul).join("")+"] )";return H||(x["advance_pre,code"]=0),i.mark=function(e,t,r,n){a(e)||(e=[e]),s(r)||(r=" "),s(n)||(n="");var o=i[0]().$(),l=e[0]+n,f=n+(s(e[1])?e[1]:e[0]),u=o.value,c=p(l),h=p(f),b=d("^"+c+"([\\s\\S]*?)"+h+"$"),g=d(c+"$"),m=d("^"+h),v=o.before,k=o.after;return u?r=!1:i.insert(L[""]),i.toggle(t?!b.test(u):!g.test(v)&&!m.test(k),[function(e){e.unwrap(l,f,1).tidy(/<[^\/<>]+?>$/.test(v)?"":r,/^<\/[^<>]+?>/.test(k)?"":r).wrap(l,f,t)[1]()},function(e){e.unwrap(l,f,t)[1]()}])},c(o.tools,{b:{click:function(e,t){return t.i().mark(E.b[0]),!1}},i:{click:function(e,t){return t.i().mark(E.i[0]),!1}},u:0,s:H?{click:function(e,t){return t.i().mark(E.s),!1}}:0,a:{click:function(e,t){var c,p,d,h,g,m,v,r=t.$(),n=r.before,i=r.value,o=r.after,l=t.get(),a=/^ {0,3}\[[^\^]+?\]:/.test(l.split("\n").pop())?"\n":"\n\n",s=l.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],f=_.modals.a,u=f.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(i))return t.tidy(" ").mark(["<",">"],1),!1;for(v in s)v=" "+b(s[v]).replace(/^\[|\]:$/g,""),T.a[v]=1;return c=T.a,t.record().ui.prompt(["a[href]",f.title[0]],u,0,function(e,t,l){var v=""===l;l=$(l),t[0](),c[l]?(t.trim(b(n)?" ":"",/^\n+ {0,3}\*?\[/.test(o)?!1:" ").mark(["[","]["+l+"]"],0,!1),h=s.indexOf(" ["+l+"]:"),-1===h&&1!==c[l]&&(r=t.$(),n=r.before,g=r.start,m=r.end,t.set(n+i+b(r.after,1)+a+" ["+(l||b(i)||L[""])+"]: "+(v?"":c[l][0]+(c[l][1]?' "'+c[l][1]+'"':""))).select(g,m),v&&t.focus(!0).insert(u))):(p=l,t.blur().ui.prompt(["a[title]",f.title[1]],f.placeholder[1],0,function(e,t,r){d=w(r),i||t.insert(L[""]),t.i().trim(b(n)?" ":"",b(o)?/^\n+ {0,3}\*?\[/.test(o)?"\n\n ":" ":"").wrap("[","]("+p+(d?' "'+d+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var d,h,g,m,v,k,y,r=t.$(),n=r.value,i=n,o=r.before,l=r.after,a=t.get(),s=/^ {0,3}\[[^\^]+?\]:/.test(a.split("\n").pop())?"\n":"\n\n",f=a.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=_.modals.img,c=/^\n* {0,3}\[.+?\]:/.test(l)?" ":"",p=b(l);for(y in f)y=" "+b(f[y]).replace(/^\[|\]:$/g,""),!T.img[y]&&(T.img[y]=1);return d=T.img,t.ui.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,l){l=$(l),h=l,i||(i=h.split(/[\/\\\\]/).pop()),i=w(i),t[0]().trim(b(o)?"\n\n":"",c),d[l]?(t.insert("!["+i+"]["+l+"]\n\n",-1,1),c&&t.select(t.$().start),m=f.indexOf(" ["+l+"]:"),-1===m&&(r=t.$(),o=r.before,v=r.start,k=r.end,t.set(o+n+r.after+(p?s:"")+" ["+l+"]: "+d[l][0]+(d[l][1]?' "'+d[l][1]+'"':"")).select(v,k))):t.blur().ui.prompt(["img[title]",u.title[1]],u.placeholder[1],0,function(e,t,r){g=w(r),t.insert("!["+i+"]("+h+(g?' "'+g+'"':"")+")\n\n",-1,1),c&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:H?{i:"thumb-tack",click:function(e,t){var u,r=t.$(),n=r.before,i=r.after,o=_.modals.sup,l=t.get(),a=/^ {0,3}\[\^.+?\]:/.test(b(l).split("\n").pop())?"\n":"\n\n",s=l.match(/^ {0,3}\[\^.+?\]:/gm)||[],f=0;for(f in s)s[f]=" "+b(s[f]);return f=s.length+1,t.ui.prompt(["sup[id]",o.title],r.value||o.placeholder||f,0,function(e,t,r,o){r=b(r||o)||f,u=s.indexOf(" [^"+r+"]:"),-1!==u?(f=l.indexOf(s[u])+3,t.select(f,f+r.length)):t.trim(b(n)?" ":"",!b(i)||/^[\t ]*\n+[\t ]*/.test(i)?"\n\n":" ").insert("[^"+r+"]").set(b(t.get(),1)+a+" [^"+r+"]: ").focus(!0).insert(L[""])}),!1}}:0,abbr:H?{click:function(e,t){var r=t.$(),n=b(r.value),i=_.modals.abbr,o=t.get(),l=y(n||L[""]),a=/^ {0,3}\*\[.+?\]:/.test(o.split("\n").pop())?"\n":"\n\n",s=o.match(/^ {0,3}\*\[.+?\]:/gm)||[],f=T.abbr,u=0;for(u in s)s[u]=" "+b(s[u]);return u=s.indexOf(" *["+l+"]:"),n&&-1!==u?(u=o.indexOf(s[u])+3,t.select(u,u+l.length),!1):(t.record().ui.prompt(["abbr[title]",i.title],f[l]||i.placeholder,!f[n],function(e,t,i,o){if(i=w(i),t[0]().set(b(t.get(),1)+(r.before||n?a:"")+" *["+l+"]: ").focus(!0).insert(i||o),l===L[""]){var s=t.$().start;t.select(s-3-l.length,s-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(L[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){C>5?C=0:C++;var r=t.$(),n=x["advance_h1,h2"],i="\\s?["+p(E.h1[0]+E.h2[0])+"]+\\s*",o=p(E.h1[1]),l=r.before.replace(d("["+o+"\\s]+$"),""),a=y(r.value).replace(d("^["+o+"\\s]+|["+o+"\\s]+$","g"),"").replace(d(i+"$"),"")||L[""],s=r.after.replace(d("^["+o+"\\s]+"),"").replace(d("^"+i),""),f=["",E.h1[n?0:1],E.h2[n?0:1],E.h3,E.h4,E.h5,E.h6];return t[0]().set(l+a+s).select(l.length,(l+a).length).tidy("\n\n"),0===C||(3>C&&n?t.wrap("","\n"+a.replace(/./g,f[C])):t.wrap(f[C]+" ",x["close_h1,h2,h3,h4,h5,h6"]?" "+f[C]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,i=E.blockquote;return n===L[""]?(t.select(),!1):n?(t.tidy(d(i+" $").test(r.before)?!1:"\n\n")[d("^"+i).test(n)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",-1).insert(L[""])[1](),!1)}},"pre,code":{click:function(e,t){var r=t.$(),n=r.before,i=r.value,o=x["advance_pre,code"],l=E.code,a=l[1]||l[0];a=a+a+a,!f(o)&&o?o=a:f(o)&&-1!==o.indexOf("%1")&&(o=m(o,[a]));var s="( {4,}|\\t"+(f(o)?"|"+p(o):"")+")";if(d("(^|\\n)"+s+"?$").test(n)){if(o)return t.mark([o,o.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(o=q===k?k:"    ",!i){t[0]().tidy("\n\n");var u=t.$().start,c=o+L[""];return t.insert(c).select(u+o.length,u+c.length)[1](),!1}return i===L[""]&&d(s+"$").test(n)?(t.select(r.start-o.length,r.end),!1):(t.tidy("\n\n")[d("^"+s).test(i)?"outdent":"indent"](o),!1)}return t.mark(l[0]),!1}},ul:{click:function(e,t){var v,r=t.$(),n=r.value,i=r.before,o=r.after,l=E.ul[0],a=E.ol[0],s=p(l),f=m(p(a),["\\d+"]),u=d("(^|\\n)([\\t ]*) "+s+" (.*)$"),c=d("^(.*) "+s+" ","gm"),h=d("(^|\\n)([\\t ]*) "+f+" (.*)$"),b=d("^(.*) "+f+" ","gm"),g=L[""];return n?(n===g?t.select():b.test(n)?t.replace(b,"$1 "+l+" "):c.test(n)?t.replace(c,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+l+" $2"),!1):i&&o?(v=h.test(i)?i.replace(h,"$1$2 "+l+" $3"):u.test(i)?i.replace(u,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+l+" $3"),t.set(v+o).select(v.length),!1):(t[0]().tidy("\n\n").insert(" "+l+" ",-1).insert(g)[1](),!1)}},ol:{click:function(e,t){var y,r=t.$(),n=r.value,i=r.before,o=r.after,l=E.ul[0],a=E.ol[0],s=m(a,[1]),f=p(l),u=m(p(a),["\\d+"]),c=d("(^|\\n)([\\t ]*) "+f+" (.*)$"),h=d("^(.*) "+f+" ","gm"),b=d("(^|\\n)([\\t ]*) "+u+" (.*)$"),g=d("^(.*) "+u+" ","gm"),v=L[""],k=0;return n?(n===v?t.select():h.test(n)?t.replace(h,function(e,t,r){return++k,t+" "+m(a,[k])+" "}):g.test(n)?t.replace(g,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++k,t+" "+m(a,[k])+" "+r}),!1):i&&o?(y=c.test(i)?i.replace(c,"$1$2 "+s+" $3"):b.test(i)?i.replace(b,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+s+" $3"),t.set(y+o).select(y.length),!1):(t[0]().tidy("\n\n").insert(" "+s+" ",-1).insert(v)[1](),!1)}},table:H?function(e,t){var s,f,u,r=T.tr,n=T.td,i=_.modals.table,o=_.placeholders.table,l=m(o[0],[1,1]),a=[];return t.$().value===l?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,c,p){f=g(v(c)||p,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,i){u=g(v(n)||i,r[0],r[1]);var c,p,d,h,b,k;for(c=0;u>c;++c){for(s="|",p=0;f>p;++p)s+=" "+m(o[1],[c+1,p+1])+" |";a.push(s)}for(a=a.join("\n"),s="|",d=0;f>d;++d)s+=" "+m(o[0],[d+1,d+1]).replace(/./g,"-")+" |";for(a=s+"\n"+a,s="|",h=0;f>h;++h)s+=" "+m(o[0],[1,h+1])+" |";a=s+"\n"+a,x.close_tr||(a=a.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(a),b=t.$(),k=b.start+b.value.indexOf(l),t.select(k,k+l.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(E.hr[0]+"\n\n",-1),!1}}}),c(o.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=x.advance_br;return!f(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",-1).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=E.blockquote,o=(E.ul[0],E.ol[0]),l=m(p(o),["\\d+"]),a="(("+p(n)+" )+|"+O+"| +("+l+") )",s=d("^"+a+".*$","gm").exec(r.before.split("\n").pop());if(s){if(s[0]===s[1])return t.outdent(d(a)),!1;if(d("\\s*"+l+"\\s*").test(s[1])){var f=v(b(s[1]));return t.insert("\n"+s[1].replace(/\d+/,f+1),-1).scroll(!0),!1}return t.insert("\n"+s[1],-1).scroll(!0),!1}},"shift+tab":function(e,t){var g,r=t.$(),n=r.before,i=r.value,l=r.after,a=E.ol[0],s=p(a),f=m(s,["\\d+"]),u=p(E.blockquote),c=d("  "+O+"$"),h=d("   ( ?"+f+" )$"),b="("+u+" |"+O+"| +"+f+" )";if(i){if(i&&(g=i.match(d("(^|\\n)"+b,"g"))))return t.outdent(d(b)),!1}else{if(g=n.match(d(u+" $")))return t.outdent(g[0]),!1;if(g=n.match(c))return n=n.replace(c,"$1"),t.set(n+l).select(n.length),!1;if(g=n.match(h))return n=n.replace(h,"$1"),t.set(n+l).select(n.length),!1}return o.tools.outdent.click(e,t)},tab:function(e,t){var b,r=t.$(),n=r.before,i=r.value,l=r.after,a=E.ol[0],s=E.blockquote,f=p(a),u=p(s),c=d(O+"$"),h=d(" ?"+m(f,["\\d+"])+" $");if(i){if(d("^"+u+" ").test(i))return t.indent(s+" "),!1}else{if(b=n.match(d(u+" $")))return t.insert(b[0],-1),!1;if(b=n.match(c))return n=n.replace(c,"  $1"),t.set(n+l).select(n.length),!1;if(b=n.match(h))return n=n.replace(h,"    "+m(a,[1])+" "),t.set(n+l).select(n.length),!1}return o.tools.indent.click(e,t)}}),i.update({},0)};