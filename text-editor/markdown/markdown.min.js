/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function $(e){return g(e.replace(/\s+/g," "))}function v(e){return m($(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function k(e){return m($(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var r=new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:["~~"],h1:["=","#"],h2:["-","##"],h3:["###"],h4:["####"],h5:["#####"],h6:["######"],blockquote:[">"],code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),n=r.ui,l="	",a=r.is,i=a.o,s=function(e){return!a.x(e)},o=a.s,c=r._,f=c.edge,u=c.x,p=c.extend,h=c.format,d=c.i,b=c.pattern,m=c.replace,g=c.trim;r.update(p({languages:{tools:{sup:["Footnote",r.config.languages.tools.sub[1]]}}},t),0),r.type="Markdown";var _=r.config,y=_.extra,w=_.formats,q=_.languages,x=_.states,T=_.tab,O=q.placeholders,L="( +["+u(w.ul).join("")+"] )",I=0;return y||(_["advance_pre,code"]=0),r.mark=function(e,t,n,l){i(e)||(e=[e]),s(n)||(n=" "),s(l)||(l="");var a=r.$(),o=e[0]+l,c=l+(s(e[1])?e[1]:e[0]),f=a.value,p=u(o),h=u(c),d=b("^"+p+"([\\s\\S]*?)"+h+"$"),m=b(p+"$"),g=b("^"+h),$=a.before,v=a.after;return f?n=!1:r.insert(O[""]).loss(),r.toggle(t?!d.test(f):!m.test($)&&!g.test(v),[function(e){e.unwrap(o,c,1).tidy(/<[^\/<>]+?>$/.test($)?"":n,/^<\/[^<>]+?>/.test(v)?"":n).loss().wrap(o,c,t)},function(e){e.unwrap(o,c,t)}])},p(n.tools,{b:{click:function(e,t){return t.i().mark(w.b[0]),!1}},i:{click:function(e,t){return t.i().mark(w.i[0]),!1}},u:0,s:y?{click:function(e,t){return t.i().mark(w.s[0]),!1}}:0,a:{click:function(e,t){var p,h,d,b,m,$,_,r=t.$(),l=r.before,a=r.value,i=r.after,s=t.get(),o=/^ {0,3}\[[^\^]+?\]:/.test(s.split("\n").pop())?"\n":"\n\n",c=s.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],f=q.modals.a,u=f.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(a))return t.tidy(" ").mark(["<",">"],1),!1;for(_ in c)_=" "+g(c[_]).replace(/^\[|\]:$/g,""),x.a[_]=1;return p=x.a,t.record().ui.prompt(["a[href]",f.title[0]],u,0,function(e,t,s){var _=""===s;s=k(s),t[0](),p[s]?(t.trim(g(l)?" ":"",/^\n+ {0,3}\*?\[/.test(i)?!1:" ").mark(["[","]["+s+"]"],0,!1),b=c.indexOf(" ["+s+"]:"),-1===b&&1!==p[s]&&(r=t.$(),l=r.before,m=r.start,$=r.end,t.set(l+a+g(r.after,1)+o+" ["+(s||g(a)||O[""])+"]: "+(_?"":p[s][0]+(p[s][1]?' "'+p[s][1]+'"':""))).select(m,$),_&&t.focus(!0).insert(u))):(h=s,n.prompt(["a[title]",f.title[1]],f.placeholder[1],0,function(e,t,r){d=v(r),a||t.insert(O[""]),t.i().trim(g(l)?" ":"",g(i)?/^\n+ {0,3}\*?\[/.test(i)?"\n\n ":" ":"").wrap("[","]("+h+(d?' "'+d+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var d,b,m,$,_,y,w,r=t.$(),l=r.value,a=l,i=r.before,s=r.after,o=t.get(),c=/^ {0,3}\[[^\^]+?\]:/.test(o.split("\n").pop())?"\n":"\n\n",f=o.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],u=q.modals.img,p=/^\n* {0,3}\[.+?\]:/.test(s)?" ":"",h=g(s);for(w in f)w=" "+g(f[w]).replace(/^\[|\]:$/g,""),!x.img[w]&&(x.img[w]=1);return d=x.img,n.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,s){s=k(s),b=s,a||(a=b.split(/[\/\\\\]/).pop()),a=v(a),t[0]().trim(g(i)?"\n\n":"",p),d[s]?(t.insert("!["+a+"]["+s+"]\n\n",0,1),p&&t.select(t.$().start),$=f.indexOf(" ["+s+"]:"),-1===$&&(r=t.$(),i=r.before,_=r.start,y=r.end,t.set(i+l+r.after+(h?c:"")+" ["+s+"]: "+d[s][0]+(d[s][1]?' "'+d[s][1]+'"':"")).select(_,y))):n.prompt(["img[title]",u.title[1]],u.placeholder[1],0,function(e,t,r){m=v(r),t.insert("!["+a+"]("+b+(m?' "'+m+'"':"")+")\n\n",0,1),p&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:y?{i:"thumb-tack",click:function(t,r){var p,l=r.$(),a=l.before,i=l.after,s=q.modals.sup,o=r.get(),c=/^ {0,3}\[\^.+?\]:/.test(g(o).split("\n").pop())?"\n":"\n\n",f=o.match(/^ {0,3}\[\^.+?\]:/gm)||[],u=0;for(u in f)f[u]=" "+g(f[u]);return u=f.length+1,n.prompt(["sup[id]",s.title],l.value||s.placeholder||u,0,function(t,r,n,l){n=g(n||l)||u,p=f.indexOf(" [^"+n+"]:"),-1!==p?(u=o.indexOf(f[p])+3,r.select(u,u+n.length),e.scrollTop=r.$(1).caret[0].y):r.trim(g(a)?" ":"",!g(i)||/^[\t ]*\n+[\t ]*/.test(i)?"\n\n":" ").insert("[^"+n+"]").set(g(r.get(),1)+c+" [^"+n+"]: ").focus(!0).insert(O[""])}),!1}}:0,abbr:y?{click:function(t,r){var n=r.$(),l=g(n.value),a=q.modals.abbr,i=r.get(),s=$(l||O[""]),o=/^ {0,3}\*\[.+?\]:/.test(i.split("\n").pop())?"\n":"\n\n",c=i.match(/^ {0,3}\*\[.+?\]:/gm)||[],f=x.abbr,u=0;for(u in c)c[u]=" "+g(c[u]);return u=c.indexOf(" *["+s+"]:"),l&&-1!==u?(u=i.indexOf(c[u])+3,r.select(u,u+s.length),e.scrollTop=r.$(1).caret[0].y,!1):(r.record().ui.prompt(["abbr[title]",a.title],f[s]||a.placeholder,!f[l],function(e,t,r,a){if(r=v(r),t[0]().set(g(t.get(),1)+(n.before||l?o:"")+" *["+s+"]: ").focus(!0).insert(r||a),s===O[""]){var i=t.$().start;t.select(i-3-s.length,i-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(O[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){I>5?I=0:I++;var r=t.$(),n=_["advance_h1,h2"],l="\\s?["+u(w.h1[0]+w.h2[0])+"]+\\s*",a=u(w.h1[1]),i=r.before.replace(b("["+a+"\\s]+$"),""),s=$(r.value).replace(b("^["+a+"\\s]+|["+a+"\\s]+$","g"),"").replace(b(l+"$"),"")||O[""],o=r.after.replace(b("^["+a+"\\s]+"),"").replace(b("^"+l),""),c=["",w.h1[n?0:1],w.h2[n?0:1],w.h3[0],w.h4[0],w.h5[0],w.h6[0]];return t[0]().set(i+s+o).select(i.length,(i+s).length).tidy("\n\n"),0===I||(3>I&&n?t.wrap("","\n"+s.replace(/./g,c[I])):t.wrap(c[I]+" ",_["close_h1,h2,h3,h4,h5,h6"]?" "+c[I]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,l=w.blockquote[0];return n===O[""]?(t.select(),!1):n?(t.tidy(b(l+" $").test(r.before)?!1:"\n\n")[b("^"+l).test(n)?"outdent":"indent"](l+" "),!1):(t[0]().tidy("\n\n").insert(l+" ",0).insert(O[""])[1](),!1)}},"pre,code":{click:function(e,t){var f,p,d,r=t.$(),n=r.before,a=r.value,i=_["advance_pre,code"],s=w.code,c=s[1]||s[0];return c=c+c+c,!o(i)&&i?i=c:o(i)&&-1!==i.indexOf("%")&&(i=h(i,[c])),f="( {4,}|\\t"+(o(i)?"|"+u(i):"")+")",b("(^|\\n)"+f+"?$").test(n)?i?(t.mark([i,i.split(/\s+/)[0]],0,"\n\n","\n"),!1):(i=T===l?l:"    ",a?a===O[""]&&b(f+"$").test(n)?(t.select(r.start-i.length,r.end),!1):(t.tidy("\n\n")[b("^"+f).test(a)?"outdent":"indent"](i),!1):(t[0]().tidy("\n\n"),p=t.$().start,d=i+O[""],t.insert(d).select(p+i.length,p+d.length)[1](),!1)):(t.mark(s[0]),!1)}},ul:{click:function(e,t){var $,r=t.$(),n=r.value,l=r.before,a=r.after,i=w.ul[0],s=w.ol[0],o=u(i),c=h(u(s),["\\d+"]),f=b("(^|\\n)([\\t ]*) "+o+" (.*)$"),p=b("^(.*) "+o+" ","gm"),d=b("(^|\\n)([\\t ]*) "+c+" (.*)$"),m=b("^(.*) "+c+" ","gm"),g=O[""];return n?(n===g?t.select():m.test(n)?t.replace(m,"$1 "+i+" "):p.test(n)?t.replace(p,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+i+" $2"),!1):a&&l&&("\n"!==a[0]||"\n"!==l.slice(-1))?($=d.test(l)?l.replace(d,"$1$2 "+i+" $3"):f.test(l)?l.replace(f,"$1$2$3"):l.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+i+" $3"),t.set($+a).select($.length),!1):(t[0]().tidy("\n\n").insert(" "+i+" ",0).insert(g)[1](),!1)}},ol:{click:function(e,t){var k,r=t.$(),n=r.value,l=r.before,a=r.after,i=w.ul[0],s=w.ol[0],o=h(s,[1]),c=u(i),f=h(u(s),["\\d+"]),p=b("(^|\\n)([\\t ]*) "+c+" (.*)$"),d=b("^(.*) "+c+" ","gm"),m=b("(^|\\n)([\\t ]*) "+f+" (.*)$"),g=b("^(.*) "+f+" ","gm"),$=O[""],v=0;return n?(n===$?t.select():d.test(n)?t.replace(d,function(e,t,r){return++v,t+" "+h(s,[v])+" "}):g.test(n)?t.replace(g,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++v,t+" "+h(s,[v])+" "+r}),!1):a&&l&&("\n"!==a[0]||"\n"!==l.slice(-1))?(k=p.test(l)?l.replace(p,"$1$2 "+o+" $3"):m.test(l)?l.replace(m,"$1$2$3"):l.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+o+" $3"),t.set(k+a).select(k.length),!1):(t[0]().tidy("\n\n").insert(" "+o+" ",0).insert($)[1](),!1)}},table:y?function(e,t){var c,u,p,r=x.tr,l=x.td,a=q.modals.table,i=q.placeholders.table,s=h(i[0],[1,1]),o=[];return t[0]().$().value===s?(t.select(),!1):(n.prompt(["table>td",a.title[0]],a.placeholder[0],0,function(e,t,b,m){u=f(d(b)||m,l[0],l[1]),n.prompt(["table>tr",a.title[1]],a.placeholder[1],0,function(e,t,n,l){p=f(d(n)||l,r[0],r[1]);var a,b,m,g,$,v;for(a=0;p>a;++a){for(c="|",b=0;u>b;++b)c+=" "+h(i[1],[a+1,b+1])+" |";o.push(c)}for(o=o.join("\n"),c="|",m=0;u>m;++m)c+=" "+h(i[0],[m+1,m+1]).replace(/./g,"-")+" |";for(o=c+"\n"+o,c="|",g=0;u>g;++g)c+=" "+h(i[0],[1,g+1])+" |";o=c+"\n"+o,_.close_tr||(o=o.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(o),$=t.$(),v=$.start+$.value.indexOf(s),t.select(v,v+s.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(w.hr[0]+"\n\n",0),!1}}}),p(n.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=_.advance_br;return!o(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",0).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=w.blockquote[0],a=(w.ul[0],w.ol[0]),i=h(u(a),["\\d+"]),s="(("+u(n)+" )+|"+L+"| +("+i+") )",o=b("^"+s+".*$","gm").exec(r.before.split("\n").pop());if(o){if(o[0]===o[1])return t.outdent(b(s)),!1;if(b("\\s*"+i+"\\s*").test(o[1])){var c=d(g(o[1]));return t.insert("\n"+o[1].replace(/\d+/,c+1),0).scroll(!0),!1}return t.insert("\n"+o[1],0).scroll(!0),!1}},"shift+tab":function(e,t){var g,r=t.$(),l=r.before,a=r.value,i=r.after,s=w.ol[0],o=u(s),c=h(o,["\\d+"]),f=u(w.blockquote[0]),p=b("  "+L+"$"),d=b("   ( ?"+c+" )$"),m="("+f+" |"+L+"| +"+c+" )";if(a){if(a&&(g=a.match(b("(^|\\n)"+m,"g"))))return t.outdent(b(m)),!1}else{if(g=l.match(b(f+" $")))return t.outdent(g[0]),!1;if(g=l.match(p))return l=l.replace(p,"$1"),t.set(l+i).select(l.length),!1;if(g=l.match(d))return l=l.replace(d,"$1"),t.set(l+i).select(l.length),!1}return n.tools.outdent.click(e,t)},tab:function(e,t){var m,r=t.$(),l=r.before,a=r.value,i=r.after,s=w.ol[0],o=w.blockquote[0],c=u(s),f=u(o),p=b(L+"$"),d=b(" ?"+h(c,["\\d+"])+" $");if(a){if(b("^"+f+" ").test(a))return t.indent(o+" "),!1}else{if(m=l.match(b(f+" $")))return t.insert(m[0],0),!1;if(m=l.match(p))return l=l.replace(p,"  $1"),t.set(l+i).select(l.length),!1;if(m=l.match(d))return l=l.replace(d,"    "+h(s,[1])+" "),t.set(l+i).select(l.length),!1}return n.tools.indent.click(e,t)}}),r.update({},0)};