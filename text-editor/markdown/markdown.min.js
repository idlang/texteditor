/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(e,t){function v(e){return d(e.replace(/\s+/g," "))}function k(e){return p(v(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function $(e){return p(v(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var r=new TE.HTML(e,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:"~~",h1:["=","#"],h2:["-","##"],h3:"###",h4:"####",h5:"#####",h6:"######",blockquote:">",code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),n=r.ui,i=r.is,o=i.o,l=function(e){return!i.x(e)},a=i.s,u=r._,s=u.extend,c=u.x,f=u.pattern,p=u.replace,d=u.trim,h=u.edge,b=u.format,m=u.i,g="	";r.update(s({languages:{tools:{sup:["Footnote",r.config.languages.tools.sub[1]]}}},t),0),r.type="Markdown";var w=r.config,y=w.states,x=w.languages,_=w.formats,q=w.tab,T=x.placeholders,E=0,L=w.extra,C="( +["+c(_.ul).join("")+"] )";return L||(w["advance_pre,code"]=0),r.mark=function(e,t,n,i){o(e)||(e=[e]),l(n)||(n=" "),l(i)||(i="");var a=r[0]().$(),u=e[0]+i,s=i+(l(e[1])?e[1]:e[0]),p=a.value,d=c(u),h=c(s),b=f("^"+d+"([\\s\\S]*?)"+h+"$"),m=f(d+"$"),g=f("^"+h),v=a.before,k=a.after;return p?n=!1:r.insert(T[""]),r.toggle(t?!b.test(p):!m.test(v)&&!g.test(k),[function(e){e.unwrap(u,s,1).tidy(/<[^\/<>]+?>$/.test(v)?"":n,/^<\/[^<>]+?>/.test(k)?"":n).wrap(u,s,t)[1]()},function(e){e.unwrap(u,s,t)[1]()}])},s(n.tools,{b:{click:function(e,t){return t.i().mark(_.b[0]),!1}},i:{click:function(e,t){return t.i().mark(_.i[0]),!1}},u:0,s:L?{click:function(e,t){return t.i().mark(_.s),!1}}:0,a:{click:function(e,t){var p,h,b,m,g,v,w,r=t.$(),i=r.before,o=r.value,l=r.after,a=t.get(),u=/^ {0,3}\[[^\^]+?\]:/.test(a.split("\n").pop())?"\n":"\n\n",s=a.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],c=x.modals.a,f=c.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(o))return t.tidy(" ").mark(["<",">"],1),!1;for(w in s)w=" "+d(s[w]).replace(/^\[|\]:$/g,""),y.a[w]=1;return p=y.a,t.record().ui.prompt(["a[href]",c.title[0]],f,0,function(e,t,a){var w=""===a;a=$(a),t[0](),p[a]?(t.trim(d(i)?" ":"",/^\n+ {0,3}\*?\[/.test(l)?!1:" ").mark(["[","]["+a+"]"],0,!1),m=s.indexOf(" ["+a+"]:"),-1===m&&1!==p[a]&&(r=t.$(),i=r.before,g=r.start,v=r.end,t.set(i+o+d(r.after,1)+u+" ["+(a||d(o)||T[""])+"]: "+(w?"":p[a][0]+(p[a][1]?' "'+p[a][1]+'"':""))).select(g,v),w&&t.focus(!0).insert(f))):(h=a,n.prompt(["a[title]",c.title[1]],c.placeholder[1],0,function(e,t,r){b=k(r),o||t.insert(T[""]),t.i().trim(d(i)?" ":"",d(l)?/^\n+ {0,3}\*?\[/.test(l)?"\n\n ":" ":"").wrap("[","]("+h+(b?' "'+b+'"':"")+")")})),t[1]()}),!1}},img:{click:function(e,t){var b,m,g,v,w,_,q,r=t.$(),i=r.value,o=i,l=r.before,a=r.after,u=t.get(),s=/^ {0,3}\[[^\^]+?\]:/.test(u.split("\n").pop())?"\n":"\n\n",c=u.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],f=x.modals.img,p=/^\n* {0,3}\[.+?\]:/.test(a)?" ":"",h=d(a);for(q in c)q=" "+d(c[q]).replace(/^\[|\]:$/g,""),!y.img[q]&&(y.img[q]=1);return b=y.img,n.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,a){a=$(a),m=a,o||(o=m.split(/[\/\\\\]/).pop()),o=k(o),t[0]().trim(d(l)?"\n\n":"",p),b[a]?(t.insert("!["+o+"]["+a+"]\n\n",0,1),p&&t.select(t.$().start),v=c.indexOf(" ["+a+"]:"),-1===v&&(r=t.$(),l=r.before,w=r.start,_=r.end,t.set(l+i+r.after+(h?s:"")+" ["+a+"]: "+b[a][0]+(b[a][1]?' "'+b[a][1]+'"':"")).select(w,_))):n.prompt(["img[title]",f.title[1]],f.placeholder[1],0,function(e,t,r){g=k(r),t.insert("!["+o+"]("+m+(g?' "'+g+'"':"")+")\n\n",0,1),p&&t.select(t.$().start)}),t[1]()}),!1}},sub:0,sup:L?{i:"thumb-tack",click:function(e,t){var f,r=t.$(),i=r.before,o=r.after,l=x.modals.sup,a=t.get(),u=/^ {0,3}\[\^.+?\]:/.test(d(a).split("\n").pop())?"\n":"\n\n",s=a.match(/^ {0,3}\[\^.+?\]:/gm)||[],c=0;for(c in s)s[c]=" "+d(s[c]);return c=s.length+1,n.prompt(["sup[id]",l.title],r.value||l.placeholder||c,0,function(e,t,r,n){r=d(r||n)||c,f=s.indexOf(" [^"+r+"]:"),-1!==f?(c=a.indexOf(s[f])+3,t.select(c,c+r.length)):t.trim(d(i)?" ":"",!d(o)||/^[\t ]*\n+[\t ]*/.test(o)?"\n\n":" ").insert("[^"+r+"]").set(d(t.get(),1)+u+" [^"+r+"]: ").focus(!0).insert(T[""])}),!1}}:0,abbr:L?{click:function(e,t){var r=t.$(),n=d(r.value),i=x.modals.abbr,o=t.get(),l=v(n||T[""]),a=/^ {0,3}\*\[.+?\]:/.test(o.split("\n").pop())?"\n":"\n\n",u=o.match(/^ {0,3}\*\[.+?\]:/gm)||[],s=y.abbr,c=0;for(c in u)u[c]=" "+d(u[c]);return c=u.indexOf(" *["+l+"]:"),n&&-1!==c?(c=o.indexOf(u[c])+3,t.select(c,c+l.length),!1):(t.record().ui.prompt(["abbr[title]",i.title],s[l]||i.placeholder,!s[n],function(e,t,i,o){if(i=k(i),t[0]().set(d(t.get(),1)+(r.before||n?a:"")+" *["+l+"]: ").focus(!0).insert(i||o),l===T[""]){var u=t.$().start;t.select(u-3-l.length,u-3)}t[1]()}),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(T[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){E>5?E=0:E++;var r=t.$(),n=w["advance_h1,h2"],i="\\s?["+c(_.h1[0]+_.h2[0])+"]+\\s*",o=c(_.h1[1]),l=r.before.replace(f("["+o+"\\s]+$"),""),a=v(r.value).replace(f("^["+o+"\\s]+|["+o+"\\s]+$","g"),"").replace(f(i+"$"),"")||T[""],u=r.after.replace(f("^["+o+"\\s]+"),"").replace(f("^"+i),""),s=["",_.h1[n?0:1],_.h2[n?0:1],_.h3,_.h4,_.h5,_.h6];return t[0]().set(l+a+u).select(l.length,(l+a).length).tidy("\n\n"),0===E||(3>E&&n?t.wrap("","\n"+a.replace(/./g,s[E])):t.wrap(s[E]+" ",w["close_h1,h2,h3,h4,h5,h6"]?" "+s[E]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var r=t.$(),n=r.value,i=_.blockquote;return n===T[""]?(t.select(),!1):n?(t.tidy(f(i+" $").test(r.before)?!1:"\n\n")[f("^"+i).test(n)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",0).insert(T[""])[1](),!1)}},"pre,code":{click:function(e,t){var r=t.$(),n=r.before,i=r.value,o=w["advance_pre,code"],l=_.code,u=l[1]||l[0];u=u+u+u,!a(o)&&o?o=u:a(o)&&-1!==o.indexOf("%1")&&(o=b(o,[u]));var s="( {4,}|\\t"+(a(o)?"|"+c(o):"")+")";if(f("(^|\\n)"+s+"?$").test(n)){if(o)return t.mark([o,o.split(/\s+/)[0]],0,"\n\n","\n"),!1;if(o=q===g?g:"    ",!i){t[0]().tidy("\n\n");var p=t.$().start,d=o+T[""];return t.insert(d).select(p+o.length,p+d.length)[1](),!1}return i===T[""]&&f(s+"$").test(n)?(t.select(r.start-o.length,r.end),!1):(t.tidy("\n\n")[f("^"+s).test(i)?"outdent":"indent"](o),!1)}return t.mark(l[0]),!1}},ul:{click:function(e,t){var v,r=t.$(),n=r.value,i=r.before,o=r.after,l=_.ul[0],a=_.ol[0],u=c(l),s=b(c(a),["\\d+"]),p=f("(^|\\n)([\\t ]*) "+u+" (.*)$"),d=f("^(.*) "+u+" ","gm"),h=f("(^|\\n)([\\t ]*) "+s+" (.*)$"),m=f("^(.*) "+s+" ","gm"),g=T[""];return n?(n===g?t.select():m.test(n)?t.replace(m,"$1 "+l+" "):d.test(n)?t.replace(d,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+l+" $2"),!1):i&&o?(v=h.test(i)?i.replace(h,"$1$2 "+l+" $3"):p.test(i)?i.replace(p,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+l+" $3"),t.set(v+o).select(v.length),!1):(t[0]().tidy("\n\n").insert(" "+l+" ",0).insert(g)[1](),!1)}},ol:{click:function(e,t){var $,r=t.$(),n=r.value,i=r.before,o=r.after,l=_.ul[0],a=_.ol[0],u=b(a,[1]),s=c(l),p=b(c(a),["\\d+"]),d=f("(^|\\n)([\\t ]*) "+s+" (.*)$"),h=f("^(.*) "+s+" ","gm"),m=f("(^|\\n)([\\t ]*) "+p+" (.*)$"),g=f("^(.*) "+p+" ","gm"),v=T[""],k=0;return n?(n===v?t.select():h.test(n)?t.replace(h,function(e,t,r){return++k,t+" "+b(a,[k])+" "}):g.test(n)?t.replace(g,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,r){return++k,t+" "+b(a,[k])+" "+r}),!1):i&&o?($=d.test(i)?i.replace(d,"$1$2 "+u+" $3"):m.test(i)?i.replace(m,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+u+" $3"),t.set($+o).select($.length),!1):(t[0]().tidy("\n\n").insert(" "+u+" ",0).insert(v)[1](),!1)}},table:L?function(e,t){var s,c,f,r=y.tr,i=y.td,o=x.modals.table,l=x.placeholders.table,a=b(l[0],[1,1]),u=[];return t.$().value===a?(t.select(),!1):(t[0]().ui.prompt(["table>td",o.title[0]],o.placeholder[0],0,function(e,t,p,d){c=h(m(p)||d,i[0],i[1]),n.prompt(["table>tr",o.title[1]],o.placeholder[1],0,function(e,t,n,i){f=h(m(n)||i,r[0],r[1]);var o,p,d,g,v,k;for(o=0;f>o;++o){for(s="|",p=0;c>p;++p)s+=" "+b(l[1],[o+1,p+1])+" |";u.push(s)}for(u=u.join("\n"),s="|",d=0;c>d;++d)s+=" "+b(l[0],[d+1,d+1]).replace(/./g,"-")+" |";for(u=s+"\n"+u,s="|",g=0;c>g;++g)s+=" "+b(l[0],[1,g+1])+" |";u=s+"\n"+u,w.close_tr||(u=u.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(u),v=t.$(),k=v.start+v.value.indexOf(a),t.select(k,k+a.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(_.hr[0]+"\n\n",0),!1}}}),s(n.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(e,t){var r=w.advance_br;return!a(r)&&r&&(r="  \n"),t.trim().insert(r||"\n",0).scroll(!0),!1},enter:function(e,t){var r=t.$(),n=_.blockquote,o=(_.ul[0],_.ol[0]),l=b(c(o),["\\d+"]),a="(("+c(n)+" )+|"+C+"| +("+l+") )",u=f("^"+a+".*$","gm").exec(r.before.split("\n").pop());if(u){if(u[0]===u[1])return t.outdent(f(a)),!1;if(f("\\s*"+l+"\\s*").test(u[1])){var s=m(d(u[1]));return t.insert("\n"+u[1].replace(/\d+/,s+1),0).scroll(!0),!1}return t.insert("\n"+u[1],0).scroll(!0),!1}},"shift+tab":function(e,t){var g,r=t.$(),i=r.before,o=r.value,l=r.after,a=_.ol[0],u=c(a),s=b(u,["\\d+"]),p=c(_.blockquote),d=f("  "+C+"$"),h=f("   ( ?"+s+" )$"),m="("+p+" |"+C+"| +"+s+" )";if(o){if(o&&(g=o.match(f("(^|\\n)"+m,"g"))))return t.outdent(f(m)),!1}else{if(g=i.match(f(p+" $")))return t.outdent(g[0]),!1;if(g=i.match(d))return i=i.replace(d,"$1"),t.set(i+l).select(i.length),!1;if(g=i.match(h))return i=i.replace(h,"$1"),t.set(i+l).select(i.length),!1}return n.tools.outdent.click(e,t)},tab:function(e,t){var m,r=t.$(),i=r.before,o=r.value,l=r.after,a=_.ol[0],u=_.blockquote,s=c(a),p=c(u),d=f(C+"$"),h=f(" ?"+b(s,["\\d+"])+" $");if(o){if(f("^"+p+" ").test(o))return t.indent(u+" "),!1}else{if(m=i.match(f(p+" $")))return t.insert(m[0],0),!1;if(m=i.match(d))return i=i.replace(d,"  $1"),t.set(i+l).select(i.length),!1;if(m=i.match(h))return i=i.replace(h,"    "+b(a,[1])+" "),t.set(i+l).select(i.length),!1}return n.tools.indent.click(e,t)}}),r.update({},0)};