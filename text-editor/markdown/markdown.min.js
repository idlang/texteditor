/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.Markdown=function(A,e){function C(A){return a(A.replace(/\s+/g," "))}function s(A){return l(C(A),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function G(A){return l(C(A),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var E=new TE.HTML(A,{extra:0,auto_p:0,auto_close:{"`":"`"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:["~~"],h1:["=","#"],h2:["-","##"],h3:["###"],h4:["####"],h5:["#####"],h6:["######"],blockquote:[">"],code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),t=E.ui,O="	",R=E.is,I=R.o,L=function(A){return!R.x(A)},n=R.s,N=E._,r=N.edge,T=N.x,i=N.extend,S=N.format,o=N.i,F=N.pattern,l=N.replace,a=N.trim;E.update(i({languages:{tools:{sup:["Footnote",E.config.languages.tools.sub[1]]}}},e),0),E.type="Markdown";var f=E.config,c=f.extra,u=f.formats,D=f.languages,H=f.states,M=f.tab,U=D.placeholders,B="( +["+T(u.ul).join("")+"] )",P=0;return c||(f["advance_pre,code"]=0),E.mark=function(A,e,t,O){I(A)||(A=[A]),L(t)||(t=" "),L(O)||(O="");var R=E.$(),n=A[0]+O,N=O+(L(A[1])?A[1]:A[0]),r=R.value,i=T(n),S=T(N),o=F("^"+i+"([\\s\\S]*?)"+S+"$"),l=F(i+"$"),a=F("^"+S),C=R.before,s=R.after;return r?t=!1:E.insert(U[""]).loss(),E.toggle(e?!o.test(r):!l.test(C)&&!a.test(s),[function(A){A.unwrap(n,N,1).tidy(/<[^\/<>]+?>$/.test(C)?"":t,/^<\/[^<>]+?>/.test(s)?"":t).loss().wrap(n,N,e)},function(A){A.unwrap(n,N,e)}])},i(t.tools,{b:{click:function(A,e){return e.i().mark(u.b[0]),!1}},i:{click:function(A,e){return e.i().mark(u.i[0]),!1}},u:0,s:c?{click:function(A,e){return e.i().mark(u.s[0]),!1}}:0,a:{click:function(A,e){var i,S,o,F,l,C,f,E=e.$(),O=E.before,R=E.value,I=E.after,L=e.get(),n=/^ {0,3}\[[^\^]+?\]:/.test(L.split("\n").pop())?"\n":"\n\n",N=L.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],r=D.modals.a,T=r.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(R))return e.tidy(" ").mark(["<",">"],1),!1;for(f in N)f=" "+a(N[f]).replace(/^\[|\]:$/g,""),H.a[f]=1;return i=H.a,e.record().ui.prompt(["a[href]",r.title[0]],T,0,function(A,e,L){var f=""===L;L=G(L),e[0](),i[L]?(e.trim(a(O)?" ":"",/^\n+ {0,3}\*?\[/.test(I)?!1:" ").mark(["[","]["+L+"]"],0,!1),F=N.indexOf(" ["+L+"]:"),-1===F&&1!==i[L]&&(E=e.$(),O=E.before,l=E.start,C=E.end,e.set(O+R+a(E.after,1)+n+" ["+(L||a(R)||U[""])+"]: "+(f?"":i[L][0]+(i[L][1]?' "'+i[L][1]+'"':""))).select(l,C),f&&e.focus(!0).insert(T))):(S=L,t.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(A,e,E){o=s(E),R||e.insert(U[""]),e.i().trim(a(O)?" ":"",a(I)?/^\n+ {0,3}\*?\[/.test(I)?"\n\n ":" ":"").wrap("[","]("+S+(o?' "'+o+'"':"")+")")})),e[1]()}),!1}},img:{click:function(A,e){var o,F,l,C,f,c,u,E=e.$(),O=E.value,R=O,I=E.before,L=E.after,n=e.get(),N=/^ {0,3}\[[^\^]+?\]:/.test(n.split("\n").pop())?"\n":"\n\n",r=n.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],T=D.modals.img,i=/^\n* {0,3}\[.+?\]:/.test(L)?" ":"",S=a(L);for(u in r)u=" "+a(r[u]).replace(/^\[|\]:$/g,""),!H.img[u]&&(H.img[u]=1);return o=H.img,t.prompt(["img[src]",T.title[0]],T.placeholder[0],1,function(A,e,L){L=G(L),F=L,R||(R=F.split(/[\/\\\\]/).pop()),R=s(R),e[0]().trim(a(I)?"\n\n":"",i),o[L]?(e.insert("!["+R+"]["+L+"]\n\n",0,1),i&&e.select(e.$().start),C=r.indexOf(" ["+L+"]:"),-1===C&&(E=e.$(),I=E.before,f=E.start,c=E.end,e.set(I+O+E.after+(S?N:"")+" ["+L+"]: "+o[L][0]+(o[L][1]?' "'+o[L][1]+'"':"")).select(f,c))):t.prompt(["img[title]",T.title[1]],T.placeholder[1],0,function(A,e,E){l=s(E),e.insert("!["+R+"]("+F+(l?' "'+l+'"':"")+")\n\n",0,1),i&&e.select(e.$().start)}),e[1]()}),!1}},sub:0,sup:c?{i:"thumb-tack",click:function(e,E){var i,O=E.$(),R=O.before,I=O.after,L=D.modals.sup,n=E.get(),N=/^ {0,3}\[\^.+?\]:/.test(a(n).split("\n").pop())?"\n":"\n\n",r=n.match(/^ {0,3}\[\^.+?\]:/gm)||[],T=0;for(T in r)r[T]=" "+a(r[T]);return T=r.length+1,t.prompt(["sup[id]",L.title],O.value||L.placeholder||T,0,function(e,E,t,O){t=a(t||O)||T,i=r.indexOf(" [^"+t+"]:"),-1!==i?(T=n.indexOf(r[i])+3,E.select(T,T+t.length),A.scrollTop=E.$(1).caret[0].y):E.trim(a(R)?" ":"",!a(I)||/^[\t ]*\n+[\t ]*/.test(I)?"\n\n":" ").insert("[^"+t+"]").set(a(E.get(),1)+N+" [^"+t+"]: ").focus(!0).insert(U[""])}),!1}}:0,abbr:c?{click:function(e,E){var t=E.$(),O=a(t.value),R=D.modals.abbr,I=E.get(),L=C(O||U[""]),n=/^ {0,3}\*\[.+?\]:/.test(I.split("\n").pop())?"\n":"\n\n",N=I.match(/^ {0,3}\*\[.+?\]:/gm)||[],r=H.abbr,T=0;for(T in N)N[T]=" "+a(N[T]);return T=N.indexOf(" *["+L+"]:"),O&&-1!==T?(T=I.indexOf(N[T])+3,E.select(T,T+L.length),A.scrollTop=E.$(1).caret[0].y,!1):(E.record().ui.prompt(["abbr[title]",R.title],r[L]||R.placeholder,!r[O],function(A,e,E,R){if(E=s(E),e[0]().set(a(e.get(),1)+(t.before||O?n:"")+" *["+L+"]: ").focus(!0).insert(E||R),L===U[""]){var I=e.$().start;e.select(I-3-L.length,I-3)}e[1]()}),!1)}}:0,p:{click:function(A,e){return e.$().length?(e.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(e.tidy("\n\n").insert(U[""]),!1)}},"p,h1,h2,h3,h4,h5,h6":{click:function(A,e){P>5?P=0:P++;var E=e.$(),t=f["advance_h1,h2"],O="\\s?["+T(u.h1[0]+u.h2[0])+"]+\\s*",R=T(u.h1[1]),I=E.before.replace(F("["+R+"\\s]+$"),""),L=C(E.value).replace(F("^["+R+"\\s]+|["+R+"\\s]+$","g"),"").replace(F(O+"$"),"")||U[""],n=E.after.replace(F("^["+R+"\\s]+"),"").replace(F("^"+O),""),N=["",u.h1[t?0:1],u.h2[t?0:1],u.h3[0],u.h4[0],u.h5[0],u.h6[0]];return e[0]().set(I+L+n).select(I.length,(I+L).length).tidy("\n\n"),0===P||(3>P&&t?e.wrap("","\n"+L.replace(/./g,N[P])):e.wrap(N[P]+" ",f["close_h1,h2,h3,h4,h5,h6"]?" "+N[P]:"")),e[1](),!1}},"blockquote,q":{click:function(A,e){var E=e.$(),t=E.value,O=u.blockquote[0];return t===U[""]?(e.select(),!1):t?(e.tidy(F(O+" $").test(E.before)?!1:"\n\n")[F("^"+O).test(t)?"outdent":"indent"](O+" "),!1):(e[0]().tidy("\n\n").insert(O+" ",0).insert(U[""])[1](),!1)}},"pre,code":{click:function(A,e){var r,i,o,E=e.$(),t=E.before,R=E.value,I=f["advance_pre,code"],L=u.code,N=L[1]||L[0];return N=N+N+N,!n(I)&&I?I=N:n(I)&&-1!==I.indexOf("%")&&(I=S(I,[N])),r="( {4,}|\\t"+(n(I)?"|"+T(I):"")+")",F("(^|\\n)"+r+"?$").test(t)?I?(e.mark([I,I.split(/\s+/)[0]],0,"\n\n","\n"),!1):(I=M===O?O:"    ",R?R===U[""]&&F(r+"$").test(t)?(e.select(E.start-I.length,E.end),!1):(e.tidy("\n\n")[F("^"+r).test(R)?"outdent":"indent"](I),!1):(e[0]().tidy("\n\n"),i=e.$().start,o=I+U[""],e.insert(o).select(i+I.length,i+o.length)[1](),!1)):(e.mark(L[0]),!1)}},ul:{click:function(A,e){var C,E=e.$(),t=E.value,O=E.before,R=E.after,I=u.ul[0],L=u.ol[0],n=T(I),N=S(T(L),["\\d+"]),r=F("(^|\\n)([\\t ]*) "+n+" (.*)$"),i=F("^(.*) "+n+" ","gm"),o=F("(^|\\n)([\\t ]*) "+N+" (.*)$"),l=F("^(.*) "+N+" ","gm"),a=U[""];return t?(t===a?e.select():l.test(t)?e.replace(l,"$1 "+I+" "):i.test(t)?e.replace(i,"$1"):e.replace(/^(\s*)(\S.*)$/gm,"$1 "+I+" $2"),!1):R&&O&&("\n"!==R[0]||"\n"!==O.slice(-1))?(C=o.test(O)?O.replace(o,"$1$2 "+I+" $3"):r.test(O)?O.replace(r,"$1$2$3"):O.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+I+" $3"),e.set(C+R).select(C.length),!1):(e[0]().tidy("\n\n").insert(" "+I+" ",0).insert(a)[1](),!1)}},ol:{click:function(A,e){var G,E=e.$(),t=E.value,O=E.before,R=E.after,I=u.ul[0],L=u.ol[0],n=S(L,[1]),N=T(I),r=S(T(L),["\\d+"]),i=F("(^|\\n)([\\t ]*) "+N+" (.*)$"),o=F("^(.*) "+N+" ","gm"),l=F("(^|\\n)([\\t ]*) "+r+" (.*)$"),a=F("^(.*) "+r+" ","gm"),C=U[""],s=0;return t?(t===C?e.select():o.test(t)?e.replace(o,function(A,e,E){return++s,e+" "+S(L,[s])+" "}):a.test(t)?e.replace(a,"$1"):e.replace(/^(\s*)(\S.*)$/gm,function(A,e,E){return++s,e+" "+S(L,[s])+" "+E}),!1):R&&O&&("\n"!==R[0]||"\n"!==O.slice(-1))?(G=i.test(O)?O.replace(i,"$1$2 "+n+" $3"):l.test(O)?O.replace(l,"$1$2$3"):O.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+n+" $3"),e.set(G+R).select(G.length),!1):(e[0]().tidy("\n\n").insert(" "+n+" ",0).insert(C)[1](),!1)}},table:c?function(A,e){var N,T,i,E=H.tr,O=H.td,R=D.modals.table,I=D.placeholders.table,L=S(I[0],[1,1]),n=[];return e[0]().$().value===L?(e.select(),!1):(t.prompt(["table>td",R.title[0]],R.placeholder[0],0,function(A,e,F,l){T=r(o(F)||l,O[0],O[1]),t.prompt(["table>tr",R.title[1]],R.placeholder[1],0,function(A,e,t,O){i=r(o(t)||O,E[0],E[1]);var R,F,l,a,C,s;for(R=0;i>R;++R){for(N="|",F=0;T>F;++F)N+=" "+S(I[1],[R+1,F+1])+" |";n.push(N)}for(n=n.join("\n"),N="|",l=0;T>l;++l)N+=" "+S(I[0],[l+1,l+1]).replace(/./g,"-")+" |";for(n=N+"\n"+n,N="|",a=0;T>a;++a)N+=" "+S(I[0],[1,a+1])+" |";n=N+"\n"+n,f.close_tr||(n=n.replace(/^\|\s*|\s*\|$/gm,"")),e.tidy("\n\n").insert(n),C=e.$(),s=C.start+C.value.indexOf(L),e.select(s,s+L.length)[1]()})}),!1)}:0,hr:{click:function(A,e){return e.tidy("\n\n","").insert(u.hr[0]+"\n\n",0),!1}}}),i(t.keys,{"control+u":0,"control+arrowup":"sup","control+arrowdown":"sup","control+shift+?":"abbr","shift+enter":function(A,e){var E=f.advance_br;return!n(E)&&E&&(E="  \n"),e.trim().insert(E||"\n",0),!1},enter:function(A,e){var E=e.$(),t=u.blockquote[0],R=(u.ul[0],u.ol[0]),I=S(T(R),["\\d+"]),L="(("+T(t)+" )+|"+B+"| +("+I+") )",n=F("^"+L+".*$","gm").exec(E.before.split("\n").pop());if(n){if(n[0]===n[1])return e.outdent(F(L)),!1;if(F("\\s*"+I+"\\s*").test(n[1])){var N=o(a(n[1]));return e.insert("\n"+n[1].replace(/\d+/,N+1),0),!1}return e.insert("\n"+n[1],0),!1}},"shift+tab":function(A,e){var a,E=e.$(),O=E.before,R=E.value,I=E.after,L=u.ol[0],n=T(L),N=S(n,["\\d+"]),r=T(u.blockquote[0]),i=F("  "+B+"$"),o=F("   ( ?"+N+" )$"),l="("+r+" |"+B+"| +"+N+" )";if(R){if(R&&(a=R.match(F("(^|\\n)"+l,"g"))))return e.outdent(F(l)),!1}else{if(a=O.match(F(r+" $")))return e.outdent(a[0]),!1;if(a=O.match(i))return O=O.replace(i,"$1"),e.set(O+I).select(O.length),!1;if(a=O.match(o))return O=O.replace(o,"$1"),e.set(O+I).select(O.length),!1}return t.tools.outdent.click(A,e)},tab:function(A,e){var l,E=e.$(),O=E.before,R=E.value,I=E.after,L=u.ol[0],n=u.blockquote[0],N=T(L),r=T(n),i=F(B+"$"),o=F(" ?"+S(N,["\\d+"])+" $");if(R){if(F("^"+r+" ").test(R))return e.indent(n+" "),!1}else{if(l=O.match(F(r+" $")))return e.insert(l[0],0),!1;if(l=O.match(i))return O=O.replace(i,"  $1"),e.set(O+I).select(O.length),!1;if(l=O.match(o))return O=O.replace(o,"    "+S(L,[1])+" "),e.set(O+I).select(O.length),!1}return t.tools.indent.click(A,e)}}),E.update({},0)};