/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.7
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function W(e){return e.split(I("("+M[3]+")+"))[0]}function y(e){return k=e.match(/(?:^|\n)([\t ]*).*$/),k&&k[1]||""}function w(e,t,n){var O,r=c.$(),i=r.value,o=r.before,l=F[t]||t,a=F[n]||n,s=W(l),f=W(a),u=y(o),A=P[""];return $=l,c[0](),i&&i!==A?(c.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,m[0]+m[2]+f+m[1]+"\n"+g+m[0]+a+m[1]).wrap(m[0]+l+m[1]+"\n"+g+m[0]+a+m[1],m[0]+m[2]+f+m[1]+"\n"+m[0]+m[2]+s+m[1]+"\n\n",1).replace(I("\\n"+E(g)+D[0]+E(a)+D[1]+"\\s*"+D[0]+D[2]+E(f)+D[1]+"\\n","g"),"\n"+m[0]+m[2]+s+m[1]+"\n\n"+m[0]+l+m[1]+"\n").select(c.$().end),h&&L.tools.p.click(e,c)):(O=o.match(I("(?:^|\\n)[\\t ]+"+D[0]+"("+D[2]+"?)(?:"+E(W(F.ul))+"|"+E(W(F.ol))+")"+U+D[1]+"\\s*$")))?c.insert("\n"+u+(O[1]?"":g),0):(O=o.match(I(D[0]+E(f)+v+D[1]+".*?$")))?I(D[0]+D[2]+E(f)+D[1]+"\\s*$").test(o)?c.tidy("\n"+u,!1).insert(A).wrap(m[0]+f+O[1]+m[1],m[0]+m[2]+f+m[1]):I(D[1]+"\\s*$").test(o)?c.insert(A).wrap("\n"+u+g+m[0]+l+m[1]+"\n"+u+g+g+m[0]+f+O[1]+m[1],m[0]+m[2]+f+m[1]+"\n"+u+g+m[0]+m[2]+s+m[1]+"\n"+u):c.insert(m[0]+m[2]+f+m[1]+"\n"+u+m[0]+f+O[1]+m[1],0).insert(A):I(D[0]+D[2]+E(f)+D[1]+"\\s*$").test(o)?c.insert(A).wrap("\n"+u+m[0]+a+m[1],m[0]+m[2]+f+m[1]):c.tidy("\n\n").insert(A).wrap(m[0]+l+m[1]+"\n"+g+m[0]+a+m[1],m[0]+m[2]+f+m[1]+"\n"+m[0]+m[2]+s+m[1]),c[1](),!1}function K(e,t){return!t.get(0)&&h&&L.tools.p.click(e,t),t}function Y(e){return p(e.replace(/\s+/g," "))}function x(e){return T(Y(e),[I(D[0]+".*?"+D[1],"g"),'"',"'"],["","&#34;","&#39;"])}function _(e){return T(Y(e),[I(D[0]+".*?"+D[1],"g"),/\s/g,'"'],["","%20","%22"])}var $,k,n="–",r="…",i="↑",o="↓",l="↵",a="⌘",s="✘",f="⇧",c=new TE(e),u=c._,A=u.edge,E=u.x,O=u.extend,R=u.i,I=u.pattern,p=u.trim,L=c.ui(O({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+s],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+o],sup:["Superscript",a+"+"+i],abbr:["Abbreviation",a+"+"+f+"+?"],p:["Paragraph",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),N=u.format,T=u.replace,d=c.config,h=d.auto_p,F=(d.classes,d.formats),b=d.languages,C=d.states,G=d.suffix,g=d.tab,m=d.unit[0][0],H=d.unit[0][1],D=d.unit[1][0],M=d.unit[1][1],U="(?:"+M[3]+"[^"+D[0]+D[1]+"]*?)?",v="(|"+M[3]+"[^"+D[0]+D[1]+"]*?)",B="([\\s\\S]*?)",P=b.placeholders;return c.type="HTML",O(L.tools,{clear:{i:"eraser",click:function(e,t){var l,n=t[0]().$(),r=n.before,i=n.after,o=n.value,a=D[0]+"[^"+D[0]+D[1]+"]+?"+D[1],s=D[0]+"[^"+D[2]+D[0]+D[1]+"]+?"+D[1],f=D[0]+D[2]+"[^"+D[0]+D[1]+"]+?"+D[1];return!o&&i&&(l=I("^"+a)).test(i)?(t.replace(l,"",1),!1):(I(a).test(o)||r.slice(-1)===m[1]||i[0]===m[0]?t.replace(I(a,"g"),"").unwrap(I(s),I(f)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return K(e,t).i().format(F.b),!1}},i:{i:"italic",click:function(e,t){return K(e,t).i().format(F.i),!1}},u:{i:"underline",click:function(e,t){return K(e,t).i().format(F.u),!1}},s:{i:"strikethrough",click:function(e,t){return K(e,t).i().format(N(F.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=F.a,r=b.modals.a;return L.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,l){l=_(l),i=l;var s,f,a=location.host;-1!==i.indexOf("://")&&(s=1),""!==a&&-1!==i.indexOf("://"+a)&&(s=0),/^([.\/?&#]|javascript:)/.test(i)&&(s=0),L.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=x(r),K(e,t).$().length||t.insert(P[""]),f=d.advance_a&&s?H[3]+"rel"+H[0]+H[1]+"nofollow"+H[2]+H[3]+"target"+H[0]+H[1]+"_blank"+H[2]:"",t.i().format(n+H[3]+"href"+H[0]+H[1]+i+H[2]+(o?H[3]+"title"+H[0]+H[1]+o+H[2]:"")+f)})}).record(),!1}},img:{i:"image",click:function(e,t){var f,c,n=t.$(),r=F.img,i=F.figure,o=F.figcaption,l=n.value,a=b.modals.img,s=d.advance_img;return L.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,n){n=_(n),f=n,L.prompt(["img[title]",a.title[s?2:1]],a.placeholder[s?2:1],0,function(e,t,n){c=x(n),l||(l=f.split(/[\/\\\\]/).pop()),l=x(l),t[0](),s&&c?(t.tidy("\n\n","").insert(m[0]+i+m[1]+"\n"+g+m[0]+r+H[3]+"alt"+H[0]+H[1]+l+H[2]+H[3]+"src"+H[0]+H[1]+f+H[2]+G+"\n"+g+m[0]+o+m[1]+c+m[0]+m[2]+W(o)+m[1]+"\n"+m[0]+m[2]+W(i)+m[1]+"\n\n",0,1),h&&L.tools.p.click(e,t)):K(e,t).tidy(I(D[0]+"[^"+D[0]+D[1]+D[2]+"]+?"+D[1]+"\\s*$").test(t.$().before)?"":" ","").insert(m[0]+r+H[3]+"alt"+H[0]+H[1]+l+H[2]+H[3]+"src"+H[0]+H[1]+f+H[2]+(c?H[3]+"title"+H[0]+H[1]+c+H[2]:"")+G+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=F.sub,r=F.sup,i=W(r);return K(e,t)[0]().unwrap(I(D[0]+E(i)+U+D[1]),m[0]+m[2]+i+m[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=F.sub,r=F.sup,i=W(n);return K(e,t)[0]().unwrap(I(D[0]+E(i)+U+D[1]),m[0]+m[2]+i+m[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var O,R,n=t.$(),r=p(n.value),i=b.modals.abbr,o=t.get(),l=p(r||P[""]),a=F.abbr,s=W(a),f=D[0]+E(a)+v+D[1],c=D[0]+E(a)+U+D[1],u=D[0]+D[2]+E(s)+D[1],A=I(f+B+u);return o.replace(A,function(e,t,n){(n=p(n))&&(C.abbr[n]=(t.match(I(M[3]+"+title"+M[0]+M[1]+"\\s*(.*?)\\s*"+M[2]))||["",""])[1])}),O=C.abbr,r&&O[r]?(t.i().format(a+H[3]+"title"+H[0]+H[1]+O[r]+H[2]),!1):(L.prompt(["abbr[title]",i.title],O[l]||i.placeholder,!O[r],function(e,t,n,i){n=x(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(R in O)if(x(O[R])===n){t.insert(R);break}K(e,t).unwrap(I(c),I(u)).unwrap(I(c),I(u),1).i().format(a+H[3]+"title"+H[0]+H[1]+n+H[2])[1]()}).record(),!1)}},p:{i:"paragraph",click:function(e,t){var A,n=t.$(),r=n.value,i=F.p,o=F.br,l=W(i),a=W(o),s=n.before,f=n.after,c=y(s),u=P[""];if(t[0](),r&&-1!==r.indexOf("\n")){var O=I("^(?:\\s*"+D[0]+E(l)+U+D[1]+"\\s*)+"+B+"(?:\\s*"+D[0]+D[2]+E(l)+D[1]+"\\s*)+$");O.test(r)?t.replace(O,"$1").replace(I("\\s*"+D[0]+D[2]+E(l)+D[1]+"\\s*"+D[0]+E(l)+U+D[1]+"\\s*","g"),"\n\n").replace(I("\\s*"+D[0]+E(a)+U+D[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+m[0]+o+G+"\n").replace(I("(\\s*"+D[0]+E(a)+U+G+"\\s*){2,}","g"),m[0]+m[2]+l+m[1]+"\n"+m[0]+i+m[1]).wrap(m[0]+i+m[1],m[0]+m[2]+l+m[1],1).replace(I("("+D[0]+E(l)+U+D[1]+")+","g"),"$1").replace(I("("+D[0]+D[2]+E(l)+D[1]+")+","g"),"$1").tidy("\n")}else I("^\\s*"+D[0]+D[2]+E(l)+D[1]).test(f)?I(D[0]+E(l)+U+D[1]+"\\s*$").test(s)?t.unwrap(I("\\s*"+D[0]+E(l)+U+D[1]+"\\s*"),I("\\s*"+D[0]+D[2]+E(l)+D[1])).replace(u,"").tidy("\n","\n"+c):(A=s.match(I(D[0]+E(l)+v+D[1]+".*?$")))&&t.wrap(m[0]+m[2]+l+m[1]+"\n"+c+m[0]+l+A[1]+m[1],"").insert(u):t.tidy("\n\n").format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var o,l,n=t.$(),r=[F.p,F.h1,F.h2,F.h3,F.h4,F.h5,F.h6],i=[];for(o in r)i[o]=W(r[o]);var s=(E(r).join("|"),E(i).join("|")),f="\\s*"+D[0]+"("+s+")"+v+D[1]+"\\s*",c=I("\\s*"+D[0]+"(?:"+s+")"+U+D[1]+"\\s*"),u=I("\\s*"+D[0]+D[2]+"(?:"+s+")"+D[1]+"\\s*"),A=n.value.match(I("^"+f));return A||(A=n.before.match(I(f+"$"))||[]),l=A[2]||"",o=+(A[1]||"h0").slice(1),t[0]().unwrap(c,u).unwrap(c,u,1).i().tidy("\n\n").format(o>5?i[0]+l:i[o+1]+l,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var u,n=t.$(),r=n.value,i=F.blockquote,o=F.q,l=F.p,a=W(l),s=E(a),f=I(D[0]+D[2]+s+D[1]),c=P[""];return/(^|\n)$/.test(n.before)?(h&&!f.test(r)&&L.tools.p.click(e,t),n=t.$(),r=n.value,!f.test(r)&&h&&t.select(n.start-(m[0]+l+m[1]).length,n.end+(m[0]+m[2]+a+m[1]).length),r!==c&&h?(t[0]().tidy("\n\n").insert(m[0]+i+m[1]+"\n"+t.$().value.replace(I("^(\\s*"+D[0]+")","gm"),g+"$1")+"\n"+m[0]+m[2]+W(i)+m[1]+"\n\n",0,1),h&&L.tools.p.click(e,t)):(t[0]().format(i,0,"\n\n","\n").loss().replace(I("^(\\s*"+D[0]+")","gm"),g+"$1"),h&&(n=t.$(),u=n.start+(m[0]+l+m[1]+g).length,t.select(u,u+c.length))),t[1]()):t.i().format(o),!1}},"pre,code":{i:"code",click:function(e,t){function R(e){return i?T(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function p(e){return i?T(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=d.auto_encode_html,o=F.pre,l=F.code,a=W(o),s=W(l),f=D[0]+E(a)+U+D[1]+"\\s*"+D[0]+E(s)+U+D[1]+"\\s*",c="\\s*"+D[0]+D[2]+E(s)+D[1]+"\\s*"+D[0]+D[2]+E(a)+D[1],u=I(f+"\\s*$"),A=I("^\\s*"+c),O=I("^"+B+"$");return I("(^|\\n|"+f+")$").test(n.before)?u.test(n.before)&&A.test(n.after)?t[0]().unwrap(I(u),I(A)).replace(O,p)[1]():t[0]().tidy("\n\n").wrap(m[0]+o+m[1]+m[0]+l+m[1],m[0]+m[2]+s+m[1]+m[0]+m[2]+a+m[1]).insert(r||P[""]).replace(O,R)[1]():t[0]().format(l).replace(O,function(e){return Y(I("^\\s*"+D[0]+D[2]+E(s)+D[1]).test(t.$().after)?R(e):p(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=F.ol,r=F.ul,i=W(n),o=W(r),l="("+E(o)+"|"+E(i)+")";return t.match(I(D[0]+l+U+D[1]+B+D[0]+D[2]+l+D[1]))?t[0]().replace(I(D[0]+E(i)+v+D[1],"g"),m[0]+o+"$1"+m[1]).replace(I(D[0]+D[2]+E(i)+D[1],"g"),m[0]+m[2]+o+m[1])[1]():w(e,r,F.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=F.ol,r=F.ul,i=W(n),o=W(r),l="("+E(o)+"|"+E(i)+")";return t.match(I(D[0]+l+U+D[1]+B+D[0]+D[2]+l+D[1]))?t[0]().replace(I(D[0]+E(o)+v+D[1],"g"),m[0]+i+"$1"+m[1]).replace(I(D[0]+D[2]+E(o)+D[1],"g"),m[0]+m[2]+i+m[1])[1]():w(e,n,F.li),!1}},table:function(e,t){var P,$,k,y,n=C.tr,r=C.td,i=b.modals.table,o=b.placeholders.table,l=p(N(o[0],[1,1])),a=d.advance_table?g:"",s=F.table,f=F.caption,c=F.thead,u=F.tbody,E=F.tfoot,O=F.tr,I=F.th,T=F.td,h=W(s),S=W(f),G=W(c),H=W(u),D=W(E),M=W(O),U=W(I),v=W(T),B=[];return t[0]().$().value===l?(t.select(),!1):(L.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,d,F){$=A(R(d)||F,r[0],r[1]),L.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,d){k=A(R(r)||d,n[0],n[1]),L.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,A,R,d,F,r="";for(y=Y(n),i=0;k>i;++i){for(P=a+g+m[0]+O+m[1]+"\n",A=0;$>A;++A)P+=a+g+g+m[0]+T+m[1]+p(N(o[1],[i+1,A+1]))+m[0]+m[2]+v+m[1]+"\n";P+=a+g+m[0]+m[2]+M+m[1],B.push(P)}for(B=B.join("\n"),P=g+(a?m[0]+c+m[1]+"\n"+g+g+m[0]+O+m[1]:m[0]+M+m[1])+"\n",R=0;$>R;++R)P+=a+g+g+m[0]+I+m[1]+p(N(o[0],[1,R+1]))+m[0]+m[2]+U+m[1]+"\n";if(a){for(r+=g+m[0]+E+m[1]+"\n",r+=g+g+m[0]+O+m[1]+"\n",R=0;$>R;++R)r+=g+g+g+m[0]+T+m[1]+p(N(o[2],[1,R+1]))+m[0]+m[2]+v+m[1]+"\n";r+=g+g+m[0]+m[2]+O+m[1]+"\n",r+=g+m[0]+m[2]+D+m[1]+"\n"}P+=a+g+m[0]+m[2]+M+m[1]+(a?"\n"+g+m[0]+m[2]+G+m[1]+"\n"+r+g+m[0]+u+m[1]:"")+"\n",B=P+B+(a?"\n"+g+m[0]+m[2]+H+m[1]:"")+"\n",t.tidy("\n\n").insert(m[0]+s+m[1]+"\n"+(y&&f?g+m[0]+f+m[1]+y+m[0]+m[2]+S+m[1]+"\n":"")+B+m[0]+m[2]+h+m[1]),d=t.$(),F=d.start+d.value.indexOf(l),t.select(F,F+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){return k=y(t.$().before),t.tidy("\n\n","").insert(k+m[0]+F.hr+G+"\n\n",0),!1}}}),d.keys&&O(L.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){return k=y(t.$().before),t.tidy("\n","").insert(k+m[0]+F.br+G+"\n",0),!1},enter:function(e,t){var A,O,R,n=t.$(),r=n.value,i=t.get(),o=F.p,l=F.li,a=W(o),s=W(l),c=(y(n.before),P[""]),u=L.tools;if(!r||r===c){if(A=n.after.match(I("^\\s*"+D[0]+D[2]+"("+E(a)+"|"+E(s)+")"+D[1])))O=A[1],(u[O===s?$:O]||u.ul).click(e,t);else{if(!(h&&o&&p(i)&&n.end===i.length&&I("^\\s*[^"+D[0]+"\\n]*?[^"+D[1]+"]\\s*$").test(i)))return;i=m[0]+o+m[1]+i+m[0]+m[2]+a+m[1]+"\n"+m[0]+o+m[1],R=c+m[0]+m[2]+a+m[1],t.set(i+R).select(i.length,(i+c).length)}return!1}},tab:function(e,t){var n=t.$(),r=F.li,i=W(r),o=y(n.before);return I(D[0]+D[2]+E(i)+D[1]).test(n.after)?(t[0]().wrap("\n"+o+g+m[0]+(F[$]||$)+m[1]+"\n"+o+g+g+m[0]+r+m[1],m[0]+m[2]+i+m[1]+"\n"+o+g+m[0]+m[2]+$+m[1]+"\n"+o).insert(P[""])[1](),!1):L.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,l=n.after,a=D[0]+"[^"+D[0]+D[1]+"]+?"+D[1];return!r&&I(a+"$").test(o)?(i=o.split(m[0]).pop().match(I("^([^"+D[2]+"\\s]+).*?"+D[1]+"$")),i=i&&i[1]||0,i&&I("^\\s*"+D[0]+D[2]+E(i)+D[1]).test(l)?t.unwrap(I(D[0]+E(i)+U+D[1]),I("\\s*"+D[0]+D[2]+E(i)+D[1])):t.outdent(I(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),c.update({},0)};