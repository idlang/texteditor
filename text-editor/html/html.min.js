/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function N(e){return e.split(/\s+/)[0]}function A(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function F(e,t,r){var h,n=p.$(),i=n.value,l=n.before,a=T[t],o=T[r]||r,s=N(a),c=N(o),u=A(l),f=z[""];return B=a,p[0](),i&&i!==f?(console.log("\\n"+C+O[0]+o+O[1]+"\\s*"+O[0]+O[2]+c+O[1]+"\\n"),p.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,H[0]+H[2]+c+H[1]+"\n"+C+H[0]+o+H[1]).wrap(H[0]+a+H[1]+"\n"+C+H[0]+o+H[1],H[0]+H[2]+c+H[1]+"\n"+H[0]+H[2]+s+H[1]+"\n\n",1).replace($("\\n"+C+O[0]+o+O[1]+"\\s*"+O[0]+O[2]+c+O[1]+"\\n","g"),"\n"+H[0]+H[2]+s+H[1]+"\n\n"+H[0]+a+H[1]+"\n").select(p.$().end),M&&w.tools.p.click(e,p),p[1](),!1):void((h=l.match($("(?:^|\\n)[\\t ]+"+O[0]+"("+O[2]+"?)(?:"+N(T.ul)+"|"+N(T.ol)+")"+S+O[1]+"\\s*$")))?p.insert("\n"+u+(h[1]?"":C),-1):(h=l.match($(O[0]+c+R+O[1]+".*?$")))?$(O[0]+O[2]+c+O[1]+"\\s*$").test(l)?p.tidy("\n"+u,!1).insert(f).wrap(H[0]+c+h[1]+H[1],H[0]+H[2]+c+H[1]):$(O[1]+"\\s*$").test(l)?p.insert(f).wrap("\n"+u+C+H[0]+a+H[1]+"\n"+u+C+C+H[0]+c+h[1]+H[1],H[0]+H[2]+c+H[1]+"\n"+u+C+H[0]+H[2]+s+H[1]+"\n"+u):p.insert(H[0]+H[2]+c+H[1]+"\n"+u+H[0]+c+h[1]+H[1],-1).insert(f):$(O[0]+O[2]+c+O[1]+"\\s*$").test(l)?p.insert(f).wrap("\n"+u+H[0]+o+H[1],H[0]+H[2]+c+H[1]):p.tidy("\n\n").insert(f).wrap(H[0]+a+H[1]+"\n"+C+H[0]+o+H[1],H[0]+H[2]+c+H[1]+"\n"+H[0]+H[2]+s+H[1]))}function Q(e,t){return!t.get(0)&&M&&w.tools.p.click(e,t),t}function P(e){return K(e).replace($(O[0]+".*?"+O[1],"g"),"").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;")}function D(e){return K(e).replace($(O[0]+".*?"+O[1],"g"),"").replace(/\s/g,"%20").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29")}function K(e){return m(e.replace(/\s+/g," "))}var B,r="–",n="…",i="↑",l="↓",a="↵",o="⌘",s="✘",c="⇧",u=window,p=(document,new TE(e)),h=p._,d=h.extend,b=h.each,g=h.x,m=h.trim,v=h.edge,$=h.pattern,k=h.i,w=p.ui(d({suffix:"%2",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",o+"+B"],i:["Italic",o+"+I"],u:["Underline",o+"+U"],s:["Strike",o+"+"+s],a:["Link",o+"+L"],img:["Image",o+"+G"],sub:["Subscript",o+"+"+l],sup:["Superscript",o+"+"+i],abbr:["Abbreviation",o+"+"+c+"+?"],p:["Paragraph",o+"+"+a],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",o+"+H"],"blockquote,q":["Quote",o+"+Q"],"pre,code":["Code",o+"+K"],ul:["Unordered List",o+"+-"],ol:["Ordered List",o+"++"],table:["Table",o+"+T"],hr:["Horizontal Rule",o+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),y=h.format,_=p.config,x=_.states,q=_.languages,T=_.formats,C=(_.classes,_.tab),H=_.union.unit,E=_.union.data,O=_.union_x.unit,I=_.union_x.data,U=y(_.suffix,H),S="(?:"+I[3]+"[^"+O[0]+O[1]+"]*?)?",R="(|"+I[3]+"[^"+O[0]+O[1]+"]*?)",j="([\\s\\S]*?)",z=q.placeholders,M=_.auto_p;return p.type="HTML",d(w.tools,{clear:{i:"eraser",click:function(e,t){var r=t[0]().$(),n=r.value;return $(O[0]+"[^"+O[0]+O[1]+"]+?"+O[1]).test(n)||r.before.slice(-1)===H[1]||r.after[0]===H[0]?t.replace($(O[0]+"[^"+O[0]+O[1]+"]+?"+O[1],"g"),"").unwrap($(O[0]+"[^"+O[2]+O[0]+O[1]+"]+?"+O[1]),$(O[0]+O[2]+"[^"+O[0]+O[1]+"]+?"+O[1])):t.insert(""),t[1](),!!r.after}},b:{i:"bold",click:function(e,t){return Q(e,t).i().format(T.b),!1}},i:{i:"italic",click:function(e,t){return Q(e,t).i().format(T.i),!1}},u:{i:"underline",click:function(e,t){return Q(e,t).i().format(T.u),!1}},s:{i:"strikethrough",click:function(e,t){return Q(e,t).i().format(y(T.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,l,r=T.a,n=q.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,a){a=D(a),i=a;var s,c,o=u.location.host;-1!==i.indexOf("://")&&(s=1),""!==o&&-1!==i.indexOf("://"+o)&&(s=0),/^([.\/?&#]|javascript:)/.test(i)&&(s=0),t.blur().ui.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){l=P(n),Q(e,t).$().length||t.insert(z[""]),c=_.advance_a&&s?y("%4rel%1%2nofollow%3%4target%1%2_blank%3",E):"",t.i().format(y(r+"%4href%1%2"+i+"%3",E)+(l?y("%4title%1%2"+l+"%3",E):"")+c)})}),!1}},img:{i:"image",click:function(e,t){var c,u,r=t.$(),n=T.img,i=T.figure,l=T.figcaption,a=r.value,o=q.modals.img,s=_.advance_img;return t.ui.prompt(["img[src]",o.title[0]],o.placeholder[0],1,function(e,t,r){r=D(r),c=r,t.blur().ui.prompt(["img[title]",o.title[s?2:1]],o.placeholder[s?2:1],0,function(e,t,r){u=P(r),a||(a=c.split(/[\/\\\\]/).pop()),a=P(a),t[0](),s&&u?(t.tidy("\n\n","").insert(H[0]+i+H[1]+"\n"+C+H[0]+n+y("%4alt%1%2"+a+"%3%4src%1%2"+c+"%3",E)+U+"\n"+C+H[0]+l+H[1]+u+H[0]+H[2]+N(l)+H[1]+"\n"+H[0]+H[2]+N(i)+H[1]+"\n\n",-1,1),M&&w.tools.p.click(e,t)):Q(e,t).tidy($(O[0]+"[^"+O[0]+O[1]+O[2]+"]+?"+O[1]+"\\s*$").test(t.$().before)?"":" ","").insert(H[0]+n+y("%4alt%1%2"+a+"%3%4src%1%2"+c+"%3",E)+(u?y("%4title%1%2"+u+"%3",E):"")+U+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=T.sub,n=T.sup,i=N(n);return Q(e,t)[0]().unwrap($(O[0]+i+S+O[1]),H[0]+H[2]+i+H[1]).i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=T.sub,n=T.sup,i=N(r);return Q(e,t)[0]().unwrap($(O[0]+i+S+O[1]),H[0]+H[2]+i+H[1]).i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var h,d,r=t.$(),n=m(r.value),i=q.modals.abbr,l=t.get(),a=m(n||z[""]),o=T.abbr,s=N(o),c=O[0]+g(o)+R+O[1],u=O[0]+g(o)+S+O[1],f=O[0]+O[2]+s+O[1],p=$(c+j+f);return l.replace(p,function(e,t,r){(r=m(r))&&(x.abbr[r]=(t.match($(y("%4+title%1%2\\s*(.*?)\\s*%3",I)))||["",""])[1])}),h=x.abbr,n&&h[n]?(t.i().format(o+y("%4title%1%2"+h[n]+"%3",E)),!1):(t.record().ui.prompt(["abbr[title]",i.title],h[a]||i.placeholder,!h[n],function(e,t,r,i){r=P(r||i),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(d in h)if(P(h[d])===r){t.insert(d);break}Q(e,t).unwrap($(u),$(f)).unwrap($(u),$(f),1).i().format(o+y("%4title%1%2"+r+"%3",E))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,r=t.$(),n=r.value,i=T.p,l=T.br,a=N(i),o=N(l),s=r.before,c=r.after,u=A(s),f=z[""];if(t[0](),n&&-1!==n.indexOf("\n")){var h=$("^(?:\\s*"+O[0]+a+S+O[1]+"\\s*)+"+j+"(?:\\s*"+O[0]+O[2]+a+O[1]+"\\s*)+$");h.test(n)?t.replace(h,"$1").replace($("\\s*"+O[0]+O[2]+a+O[1]+"\\s*"+O[0]+a+S+O[1]+"\\s*","g"),"\n\n").replace($("\\s*"+O[0]+o+S+O[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+H[0]+l+U+"\n").replace($("(\\s*"+O[0]+o+S+U+"\\s*){2,}","g"),H[0]+H[2]+a+H[1]+"\n"+H[0]+i+H[1]).wrap(H[0]+i+H[1],H[0]+H[2]+a+H[1],1).replace($("("+O[0]+a+S+O[1]+")+","g"),"$1").replace($("("+O[0]+O[2]+a+O[1]+")+","g"),"$1").tidy("\n")}else $("^\\s*"+O[0]+O[2]+a+O[1]).test(c)?$(O[0]+a+S+O[1]+"\\s*$").test(s)?t.unwrap($("\\s*"+O[0]+a+S+O[1]+"\\s*"),$("\\s*"+O[0]+O[2]+a+O[1])).replace(f,"").tidy("\n","\n"+u):(p=s.match($(O[0]+a+R+O[1]+".*?$")))&&t.wrap(H[0]+H[2]+a+H[1]+"\n"+u+H[0]+a+p[1]+H[1],"").insert(f):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[T.p,T.h1,T.h2,T.h3,T.h4,T.h5,T.h6],i=[];b(n,function(e,t){i[t]=N(e)});var a=(g(n).join("|"),g(i).join("|")),o="\\s*"+O[0]+"("+a+")"+R+O[1]+"\\s*",s=$("\\s*"+O[0]+"(?:"+a+")"+S+O[1]+"\\s*"),c=$("\\s*"+O[0]+O[2]+"(?:"+a+")"+O[1]+"\\s*"),u=r.value.match($("^"+o));u||(u=r.before.match($(o+"$"))||[]);var f=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(s,c).unwrap(s,c,1).i().tidy("\n\n").format(p>5?i[0]+f:i[p+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var r=t.$(),n=r.value,i=T.blockquote,l=T.q,a=T.p,o=N(a),s=O[0]+o+S+O[1];if($("(^|\\n|"+s+")$").test(r.before)){if(M&&(n===z[""]||$("("+s+")$").test(r.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),M&&(!n||t.match($("^[^"+O[0]+"\\n]*?[^"+O[1]+"]$"))?t.wrap(C+H[0]+a+H[1],H[0]+H[2]+o+H[1]):t[$("((^|\\n)"+C+")+").test(n)?"outdent":"indent"](C)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function d(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function b(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,i=_.auto_encode_html,l=T.pre,a=T.code,o=N(l),s=N(a),c=O[0]+o+S+O[1]+"\\s*"+O[0]+s+S+O[1]+"\\s*",u="\\s*"+O[0]+O[2]+s+O[1]+"\\s*"+O[0]+O[2]+o+O[1],f=$(c+"\\s*$"),p=$("^\\s*"+u),h=$("^"+j+"$");return $("(^|\\n|"+c+")$").test(r.before)?f.test(r.before)&&p.test(r.after)?t[0]().unwrap($(f),$(p)).replace(h,b)[1]():t[0]().tidy("\n\n").wrap(H[0]+l+H[1]+H[0]+a+H[1],H[0]+H[2]+s+H[1]+H[0]+H[2]+o+H[1]).insert(n||z[""]).replace(h,d)[1]():t[0]().format(a).loss().replace(h,function(e){return K($("^"+O[0]+O[2]+s+O[1]).test(t.$().after)?d(e):b(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=T.ol,n=T.ul,i=N(r),l=N(n),a="("+g(l)+"|"+g(i)+")";return t.match($(O[0]+a+S+O[1]+j+O[0]+O[2]+a+O[1]))?t[0]().replace($(O[0]+i+R+O[1],"g"),H[0]+l+"$1"+H[1]).replace($(O[0]+O[2]+i+O[1],"g"),H[0]+H[2]+l+H[1])[1]():F(e,n,T.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=T.ol,n=T.ul,i=N(r),l=N(n),a="("+g(l)+"|"+g(i)+")";return t.match($(O[0]+a+S+O[1]+j+O[0]+O[2]+a+O[1]))?t[0]().replace($(O[0]+l+R+O[1],"g"),H[0]+i+"$1"+H[1]).replace($(O[0]+O[2]+l+O[1],"g"),H[0]+H[2]+i+H[1])[1]():F(e,r,T.li),!1}},table:function(e,t){var R,j,z,M,r=x.tr,n=x.td,i=q.modals.table,l=q.placeholders.table,a=m(y(l[0],[1,1])),o=_.advance_table?C:"",s=T.table,c=T.caption,u=T.thead,f=T.tbody,p=T.tfoot,h=T.tr,d=T.th,b=T.td,g=N(s),$=N(c),w=N(u),L=N(f),E=N(p),O=N(h),I=N(d),U=N(b),S=[];return t.$().value===a?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,_,x){j=v(k(_)||x,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,_){z=v(k(n)||_,r[0],r[1]),t.blur().ui.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,r){var i,v,k,x,q,n="";for(M=K(r),i=0;z>i;++i){for(R=o+C+H[0]+h+H[1]+"\n",v=0;j>v;++v)R+=o+C+C+H[0]+b+H[1]+m(y(l[1],[i+1,v+1]))+H[0]+H[2]+U+H[1]+"\n";R+=o+C+H[0]+H[2]+O+H[1],S.push(R)}for(S=S.join("\n"),R=C+(o?H[0]+u+H[1]+"\n"+C+C+H[0]+h+H[1]:H[0]+O+H[1])+"\n",k=0;j>k;++k)R+=o+C+C+H[0]+d+H[1]+m(y(l[0],[1,k+1]))+H[0]+H[2]+I+H[1]+"\n";if(o){for(n+=C+H[0]+p+H[1]+"\n",n+=C+C+H[0]+h+H[1]+"\n",k=0;j>k;++k)n+=C+C+C+H[0]+b+H[1]+m(y(l[2],[1,k+1]))+H[0]+H[2]+U+H[1]+"\n";n+=C+C+H[0]+H[2]+h+H[1]+"\n",n+=C+H[0]+H[2]+E+H[1]+"\n"}R+=o+C+H[0]+H[2]+O+H[1]+(o?"\n"+C+H[0]+H[2]+w+H[1]+"\n"+n+C+H[0]+f+H[1]:"")+"\n",S=R+S+(o?"\n"+C+H[0]+H[2]+L+H[1]:"")+"\n",t.tidy("\n\n").insert(H[0]+s+H[1]+"\n"+(M&&c?C+H[0]+c+H[1]+M+H[0]+H[2]+$+H[1]+"\n":"")+S+H[0]+H[2]+g+H[1],0),x=t.$(),q=x.start+x.value.indexOf(a),t.select(q,q+a.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=A(t.$().before);return t.tidy("\n\n","").insert(r+H[0]+T.hr+U+"\n\n",-1),!1}}}),_.keys&&d(w.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=A(t.$().before);return t.tidy("\n","").insert(r+H[0]+T.br+U+"\n",-1),!1},enter:function(e,t){var f,p,h,r=t.$(),n=r.value,i=t.get(),l=T.p,a=T.li,o=N(l),s=N(a),u=(A(r.before),z[""]);if(!n||n===u){if(f=r.after.match($("^\\s*"+O[0]+O[2]+"("+o+"|"+s+")"+O[1])))p=f[1],w.tools["li"===p?B:p].click(e,t);else{if(!(M&&l&&m(i)&&r.end===i.length&&$("^\\s*[^"+O[0]+"\\n]*?[^"+O[1]+"]\\s*$").test(i)))return;i=H[0]+l+H[1]+i+H[0]+H[2]+o+H[1]+"\n"+H[0]+l+H[1],h=u+H[0]+H[2]+o+H[1],t.set(i+h).select(i.length,(i+u).length)}return!1}},tab:function(e,t){var r=t.$(),n=T.li,i=N(n),l=A(r.before);return $(O[0]+O[2]+n+O[1]).test(r.after)?(t[0]().wrap("\n"+l+C+H[0]+(T[B]||B)+H[1]+"\n"+l+C+C+H[0]+n+H[1],H[0]+H[2]+i+H[1]+"\n"+l+C+H[0]+H[2]+B+H[1]+"\n"+l).insert(z[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var i,r=t.$(),n=r.value,l=r.before,a=r.after,o=O[0]+"[^"+O[0]+O[1]+"]+?"+O[1];return!n&&$(o+"$").test(l)?(i=l.split(H[0]).pop().match($("^([^"+O[2]+"\\s]+).*?"+O[1]+"$")),i=i&&i[1]||0,i&&$("^\\s*"+O[0]+O[2]+i+O[1]).test(a)?t.unwrap($(O[0]+i+S+O[1]),$("\\s*"+O[0]+O[2]+i+O[1])):t.outdent($(o)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),p.update({},0)};