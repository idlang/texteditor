/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function j(e){return e.split(g("("+H[3]+")+"))[0]}function R(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function A(e,t,r){var d,n=c.$(),i=n.value,o=n.before,l=_[t]||t,a=_[r]||r,u=j(l),s=j(a),f=R(o),p=I[""];return U=l,c[0](),i&&i!==p?(c.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,L[0]+L[2]+s+L[1]+"\n"+E+L[0]+a+L[1]).wrap(L[0]+l+L[1]+"\n"+E+L[0]+a+L[1],L[0]+L[2]+s+L[1]+"\n"+L[0]+L[2]+u+L[1]+"\n\n",1).replace(g("\\n"+h(E)+B[0]+h(a)+B[1]+"\\s*"+B[0]+B[2]+h(s)+B[1]+"\\n","g"),"\n"+L[0]+L[2]+u+L[1]+"\n\n"+L[0]+l+L[1]+"\n").select(c.$().end),M&&k.tools.p.click(e,c),c[1](),!1):void((d=o.match(g("(?:^|\\n)[\\t ]+"+B[0]+"("+B[2]+"?)(?:"+h(j(_.ul))+"|"+h(j(_.ol))+")"+S+B[1]+"\\s*$")))?c.insert("\n"+f+(d[1]?"":E),0):(d=o.match(g(B[0]+h(s)+D+B[1]+".*?$")))?g(B[0]+B[2]+h(s)+B[1]+"\\s*$").test(o)?c.tidy("\n"+f,!1).insert(p).wrap(L[0]+s+d[1]+L[1],L[0]+L[2]+s+L[1]):g(B[1]+"\\s*$").test(o)?c.insert(p).wrap("\n"+f+E+L[0]+l+L[1]+"\n"+f+E+E+L[0]+s+d[1]+L[1],L[0]+L[2]+s+L[1]+"\n"+f+E+L[0]+L[2]+u+L[1]+"\n"+f):c.insert(L[0]+L[2]+s+L[1]+"\n"+f+L[0]+s+d[1]+L[1],0).insert(p):g(B[0]+B[2]+h(s)+B[1]+"\\s*$").test(o)?c.insert(p).wrap("\n"+f+L[0]+a+L[1],L[0]+L[2]+s+L[1]):c.tidy("\n\n").insert(p).wrap(L[0]+l+L[1]+"\n"+E+L[0]+a+L[1],L[0]+L[2]+s+L[1]+"\n"+L[0]+L[2]+u+L[1]))}function N(e,t){return!t.get(0)&&M&&k.tools.p.click(e,t),t}function F(e){return b(e.replace(/\s+/g," "))}function P(e){return w(F(e),[g(B[0]+".*?"+B[1],"g"),'"',"'"],["","&#34;","&#39;"])}function Y(e){return w(F(e),[g(B[0]+".*?"+B[1],"g"),/\s/g,'"'],["","%20","%22"])}var U,r="–",n="…",i="↑",o="↓",l="↵",a="⌘",u="✘",s="⇧",c=new TE(e),f=c._,p=f.extend,d=f.each,h=f.x,b=f.trim,m=f.edge,g=f.pattern,v=f.i,k=c.ui(p({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",u],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+u],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+o],sup:["Superscript",a+"+"+i],abbr:["Abbreviation",a+"+"+s+"+?"],p:["Paragraph",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),$=f.format,w=f.replace,y=c.config,x=y.states,q=y.languages,_=y.formats,E=(y.classes,y.tab),L=y.unit[0][0],C=y.unit[0][1],B=y.unit[1][0],H=y.unit[1][1],z=y.suffix,S="(?:"+H[3]+"[^"+B[0]+B[1]+"]*?)?",D="(|"+H[3]+"[^"+B[0]+B[1]+"]*?)",O="([\\s\\S]*?)",I=q.placeholders,M=y.auto_p;return c.type="HTML",p(k.tools,{clear:{i:"eraser",click:function(e,t){var r=t[0]().$(),n=r.value;return g(B[0]+"[^"+B[0]+B[1]+"]+?"+B[1]).test(n)||r.before.slice(-1)===L[1]||r.after[0]===L[0]?t.replace(g(B[0]+"[^"+B[0]+B[1]+"]+?"+B[1],"g"),"").unwrap(g(B[0]+"[^"+B[2]+B[0]+B[1]+"]+?"+B[1]),g(B[0]+B[2]+"[^"+B[0]+B[1]+"]+?"+B[1])):t.insert(""),t[1](),!!r.after}},b:{i:"bold",click:function(e,t){return N(e,t).i().format(_.b),!1}},i:{i:"italic",click:function(e,t){return N(e,t).i().format(_.i),!1}},u:{i:"underline",click:function(e,t){return N(e,t).i().format(_.u),!1}},s:{i:"strikethrough",click:function(e,t){return N(e,t).i().format($(_.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,r=_.a,n=q.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,l){l=Y(l),i=l;var u,s,a=location.host;-1!==i.indexOf("://")&&(u=1),""!==a&&-1!==i.indexOf("://"+a)&&(u=0),/^([.\/?&#]|javascript:)/.test(i)&&(u=0),k.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){o=P(n),N(e,t).$().length||t.insert(I[""]),s=y.advance_a&&u?$("%4rel%1%2nofollow%3%4target%1%2_blank%3",C):"",t.i().format($(r+"%4href%1%2"+i+"%3",C)+(o?$("%4title%1%2"+o+"%3",C):"")+s)})}),!1}},img:{i:"image",click:function(e,t){var s,c,r=t.$(),n=_.img,i=_.figure,o=_.figcaption,l=r.value,a=q.modals.img,u=y.advance_img;return k.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,r){r=Y(r),s=r,k.prompt(["img[title]",a.title[u?2:1]],a.placeholder[u?2:1],0,function(e,t,r){c=P(r),l||(l=s.split(/[\/\\\\]/).pop()),l=P(l),t[0](),u&&c?(t.tidy("\n\n","").insert(L[0]+i+L[1]+"\n"+E+L[0]+n+$("%4alt%1%2"+l+"%3%4src%1%2"+s+"%3",C)+z+"\n"+E+L[0]+o+L[1]+c+L[0]+L[2]+j(o)+L[1]+"\n"+L[0]+L[2]+j(i)+L[1]+"\n\n",0,1),M&&k.tools.p.click(e,t)):N(e,t).tidy(g(B[0]+"[^"+B[0]+B[1]+B[2]+"]+?"+B[1]+"\\s*$").test(t.$().before)?"":" ","").insert(L[0]+n+$("%4alt%1%2"+l+"%3%4src%1%2"+s+"%3",C)+(c?$("%4title%1%2"+c+"%3",C):"")+z+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=_.sub,n=_.sup,i=j(n);return N(e,t)[0]().unwrap(g(B[0]+h(i)+S+B[1]),L[0]+L[2]+i+L[1]).i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=_.sub,n=_.sup,i=j(r);return N(e,t)[0]().unwrap(g(B[0]+h(i)+S+B[1]),L[0]+L[2]+i+L[1]).i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var d,m,r=t.$(),n=b(r.value),i=q.modals.abbr,o=t.get(),l=b(n||I[""]),a=_.abbr,u=j(a),s=B[0]+h(a)+D+B[1],c=B[0]+h(a)+S+B[1],f=B[0]+B[2]+h(u)+B[1],p=g(s+O+f);return o.replace(p,function(e,t,r){(r=b(r))&&(x.abbr[r]=(t.match(g($("%4+title%1%2\\s*(.*?)\\s*%3",H)))||["",""])[1])}),d=x.abbr,n&&d[n]?(t.i().format(a+$("%4title%1%2"+d[n]+"%3",C)),!1):(t.record().ui.prompt(["abbr[title]",i.title],d[l]||i.placeholder,!d[n],function(e,t,r,i){r=P(r||i),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(m in d)if(P(d[m])===r){t.insert(m);break}N(e,t).unwrap(g(c),g(f)).unwrap(g(c),g(f),1).i().format(a+$("%4title%1%2"+r+"%3",C))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,r=t.$(),n=r.value,i=_.p,o=_.br,l=j(i),a=j(o),u=r.before,s=r.after,c=R(u),f=I[""];if(t[0](),n&&-1!==n.indexOf("\n")){var d=g("^(?:\\s*"+B[0]+h(l)+S+B[1]+"\\s*)+"+O+"(?:\\s*"+B[0]+B[2]+h(l)+B[1]+"\\s*)+$");d.test(n)?t.replace(d,"$1").replace(g("\\s*"+B[0]+B[2]+h(l)+B[1]+"\\s*"+B[0]+h(l)+S+B[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+B[0]+h(a)+S+B[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+L[0]+o+z+"\n").replace(g("(\\s*"+B[0]+h(a)+S+z+"\\s*){2,}","g"),L[0]+L[2]+l+L[1]+"\n"+L[0]+i+L[1]).wrap(L[0]+i+L[1],L[0]+L[2]+l+L[1],1).replace(g("("+B[0]+h(l)+S+B[1]+")+","g"),"$1").replace(g("("+B[0]+B[2]+h(l)+B[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+B[0]+B[2]+h(l)+B[1]).test(s)?g(B[0]+h(l)+S+B[1]+"\\s*$").test(u)?t.unwrap(g("\\s*"+B[0]+h(l)+S+B[1]+"\\s*"),g("\\s*"+B[0]+B[2]+h(l)+B[1])).replace(f,"").tidy("\n","\n"+c):(p=u.match(g(B[0]+h(l)+D+B[1]+".*?$")))&&t.wrap(L[0]+L[2]+l+L[1]+"\n"+c+L[0]+l+p[1]+L[1],"").insert(f):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[_.p,_.h1,_.h2,_.h3,_.h4,_.h5,_.h6],i=[];d(n,function(e,t){i[t]=j(e)});var l=(h(n).join("|"),h(i).join("|")),a="\\s*"+B[0]+"("+l+")"+D+B[1]+"\\s*",u=g("\\s*"+B[0]+"(?:"+l+")"+S+B[1]+"\\s*"),s=g("\\s*"+B[0]+B[2]+"(?:"+l+")"+B[1]+"\\s*"),c=r.value.match(g("^"+a));c||(c=r.before.match(g(a+"$"))||[]);var f=c[2]||"",p=+(c[1]||"h0").slice(1);return t[0]().unwrap(u,s).unwrap(u,s,1).i().tidy("\n\n").format(p>5?i[0]+f:i[p+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var r=t.$(),n=r.value,i=_.blockquote,o=_.q,l=_.p,a=j(l),u=B[0]+h(a)+S+B[1];if(g("(^|\\n|"+u+")$").test(r.before)){if(M&&(n===I[""]||g("("+u+")$").test(r.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),M&&(!n||t.match(g("^[^"+B[0]+"\\n]*?[^"+B[1]+"]$"))?t.wrap(E+L[0]+l+L[1],L[0]+L[2]+a+L[1]):t[g("((^|\\n)"+h(E)+")+").test(n)?"outdent":"indent"](E)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function b(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function m(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,i=y.auto_encode_html,o=_.pre,l=_.code,a=j(o),u=j(l),s=B[0]+h(a)+S+B[1]+"\\s*"+B[0]+h(u)+S+B[1]+"\\s*",c="\\s*"+B[0]+B[2]+h(u)+B[1]+"\\s*"+B[0]+B[2]+h(a)+B[1],f=g(s+"\\s*$"),p=g("^\\s*"+c),d=g("^"+O+"$");return g("(^|\\n|"+s+")$").test(r.before)?f.test(r.before)&&p.test(r.after)?t[0]().unwrap(g(f),g(p)).replace(d,m)[1]():t[0]().tidy("\n\n").wrap(L[0]+o+L[1]+L[0]+l+L[1],L[0]+L[2]+u+L[1]+L[0]+L[2]+a+L[1]).insert(n||I[""]).replace(d,b)[1]():t[0]().format(l).loss().replace(d,function(e){return F(g("^\\s*"+B[0]+B[2]+h(u)+B[1]).test(t.$().after)?b(e):m(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=_.ol,n=_.ul,i=j(r),o=j(n),l="("+h(o)+"|"+h(i)+")";return t.match(g(B[0]+l+S+B[1]+O+B[0]+B[2]+l+B[1]))?t[0]().replace(g(B[0]+h(i)+D+B[1],"g"),L[0]+o+"$1"+L[1]).replace(g(B[0]+B[2]+h(i)+B[1],"g"),L[0]+L[2]+o+L[1])[1]():A(e,n,_.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=_.ol,n=_.ul,i=j(r),o=j(n),l="("+h(o)+"|"+h(i)+")";return t.match(g(B[0]+l+S+B[1]+O+B[0]+B[2]+l+B[1]))?t[0]().replace(g(B[0]+h(o)+D+B[1],"g"),L[0]+i+"$1"+L[1]).replace(g(B[0]+B[2]+h(o)+B[1],"g"),L[0]+L[2]+i+L[1])[1]():A(e,r,_.li),!1}},table:function(e,t){var I,M,U,R,r=x.tr,n=x.td,i=q.modals.table,o=q.placeholders.table,l=b($(o[0],[1,1])),a=y.advance_table?E:"",u=_.table,s=_.caption,c=_.thead,f=_.tbody,p=_.tfoot,d=_.tr,h=_.th,g=_.td,w=j(u),T=j(s),C=j(c),B=j(f),H=j(p),z=j(d),S=j(h),D=j(g),O=[];return t.$().value===l?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,y,x){M=m(v(y)||x,n[0],n[1]),k.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,y){U=m(v(n)||y,r[0],r[1]),k.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,r){var i,m,v,y,x,n="";for(R=F(r),i=0;U>i;++i){for(I=a+E+L[0]+d+L[1]+"\n",m=0;M>m;++m)I+=a+E+E+L[0]+g+L[1]+b($(o[1],[i+1,m+1]))+L[0]+L[2]+D+L[1]+"\n";I+=a+E+L[0]+L[2]+z+L[1],O.push(I)}for(O=O.join("\n"),I=E+(a?L[0]+c+L[1]+"\n"+E+E+L[0]+d+L[1]:L[0]+z+L[1])+"\n",v=0;M>v;++v)I+=a+E+E+L[0]+h+L[1]+b($(o[0],[1,v+1]))+L[0]+L[2]+S+L[1]+"\n";if(a){for(n+=E+L[0]+p+L[1]+"\n",n+=E+E+L[0]+d+L[1]+"\n",v=0;M>v;++v)n+=E+E+E+L[0]+g+L[1]+b($(o[2],[1,v+1]))+L[0]+L[2]+D+L[1]+"\n";n+=E+E+L[0]+L[2]+d+L[1]+"\n",n+=E+L[0]+L[2]+H+L[1]+"\n"}I+=a+E+L[0]+L[2]+z+L[1]+(a?"\n"+E+L[0]+L[2]+C+L[1]+"\n"+n+E+L[0]+f+L[1]:"")+"\n",O=I+O+(a?"\n"+E+L[0]+L[2]+B+L[1]:"")+"\n",t.tidy("\n\n").insert(L[0]+u+L[1]+"\n"+(R&&s?E+L[0]+s+L[1]+R+L[0]+L[2]+T+L[1]+"\n":"")+O+L[0]+L[2]+w+L[1]),y=t.$(),x=y.start+y.value.indexOf(l),t.select(x,x+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=R(t.$().before);return t.tidy("\n\n","").insert(r+L[0]+_.hr+z+"\n\n",0),!1}}}),y.keys&&p(k.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=R(t.$().before);return t.tidy("\n","").insert(r+L[0]+_.br+z+"\n",0),!1},enter:function(e,t){var p,d,m,r=t.$(),n=r.value,i=t.get(),o=_.p,l=_.li,a=j(o),u=j(l),c=(R(r.before),I[""]),f=k.tools;if(!n||n===c){if(p=r.after.match(g("^\\s*"+B[0]+B[2]+"("+h(a)+"|"+h(u)+")"+B[1])))d=p[1],(f[d===u?U:d]||f.ul).click(e,t);else{if(!(M&&o&&b(i)&&r.end===i.length&&g("^\\s*[^"+B[0]+"\\n]*?[^"+B[1]+"]\\s*$").test(i)))return;i=L[0]+o+L[1]+i+L[0]+L[2]+a+L[1]+"\n"+L[0]+o+L[1],m=c+L[0]+L[2]+a+L[1],t.set(i+m).select(i.length,(i+c).length)}return!1}},tab:function(e,t){var r=t.$(),n=_.li,i=j(n),o=R(r.before);return g(B[0]+B[2]+h(i)+B[1]).test(r.after)?(t[0]().wrap("\n"+o+E+L[0]+(_[U]||U)+L[1]+"\n"+o+E+E+L[0]+n+L[1],L[0]+L[2]+i+L[1]+"\n"+o+E+L[0]+L[2]+U+L[1]+"\n"+o).insert(I[""])[1](),!1):k.tools.indent.click(e,t)},backspace:function(e,t){var i,r=t.$(),n=r.value,o=r.before,l=r.after,a=B[0]+"[^"+B[0]+B[1]+"]+?"+B[1];return!n&&g(a+"$").test(o)?(i=o.split(L[0]).pop().match(g("^([^"+B[2]+"\\s]+).*?"+B[1]+"$")),i=i&&i[1]||0,i&&g("^\\s*"+B[0]+B[2]+h(i)+B[1]).test(l)?t.unwrap(g(B[0]+h(i)+S+B[1]),g("\\s*"+B[0]+B[2]+h(i)+B[1])):t.outdent(g(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),c.update({},0)};