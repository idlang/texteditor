/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function A(e){return e.split(g("("+U[3]+")+"))[0]}function B(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function F(e,t,r){var h,n=u.$(),l=n.value,a=n.before,i=T[t]||t,o=T[r]||r,s=A(i),c=A(o),f=B(a),p=z[""];return E=i,u[0](),l&&l!==p?(u.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,H[0]+H[2]+c+H[1]+"\n"+x+H[0]+o+H[1]).wrap(H[0]+i+H[1]+"\n"+x+H[0]+o+H[1],H[0]+H[2]+c+H[1]+"\n"+H[0]+H[2]+s+H[1]+"\n\n",1).replace(g("\\n"+b(x)+I[0]+b(o)+I[1]+"\\s*"+I[0]+I[2]+b(c)+I[1]+"\\n","g"),"\n"+H[0]+H[2]+s+H[1]+"\n\n"+H[0]+i+H[1]+"\n").select(u.$().end),P&&$.tools.p.click(e,u),u[1](),!1):void((h=a.match(g("(?:^|\\n)[\\t ]+"+I[0]+"("+I[2]+"?)(?:"+b(A(T.ul))+"|"+b(A(T.ol))+")"+R+I[1]+"\\s*$")))?u.insert("\n"+f+(h[1]?"":x),0):(h=a.match(g(I[0]+b(c)+j+I[1]+".*?$")))?g(I[0]+I[2]+b(c)+I[1]+"\\s*$").test(a)?u.tidy("\n"+f,!1).insert(p).wrap(H[0]+c+h[1]+H[1],H[0]+H[2]+c+H[1]):g(I[1]+"\\s*$").test(a)?u.insert(p).wrap("\n"+f+x+H[0]+i+H[1]+"\n"+f+x+x+H[0]+c+h[1]+H[1],H[0]+H[2]+c+H[1]+"\n"+f+x+H[0]+H[2]+s+H[1]+"\n"+f):u.insert(H[0]+H[2]+c+H[1]+"\n"+f+H[0]+c+h[1]+H[1],0).insert(p):g(I[0]+I[2]+b(c)+I[1]+"\\s*$").test(a)?u.insert(p).wrap("\n"+f+H[0]+o+H[1],H[0]+H[2]+c+H[1]):u.tidy("\n\n").insert(p).wrap(H[0]+i+H[1]+"\n"+x+H[0]+o+H[1],H[0]+H[2]+c+H[1]+"\n"+H[0]+H[2]+s+H[1]))}function M(e,t){return!t.get(0)&&P&&$.tools.p.click(e,t),t}function N(e){return d(e.replace(/\s+/g," "))}function Q(e){return w(N(e),[g(I[0]+".*?"+I[1],"g"),'"',"'"],["","&#34;","&#39;"])}function D(e){return w(N(e),[g(I[0]+".*?"+I[1],"g"),/\s/g,'"'],["","%20","%22"])}var E,r="–",n="…",l="↑",a="↓",i="↵",o="⌘",s="✘",c="⇧",u=new TE(e),f=u._,p=f.extend,h=f.each,b=f.x,d=f.trim,m=f.edge,g=f.pattern,v=f.i,$=u.ui(p({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",o+"+B"],i:["Italic",o+"+I"],u:["Underline",o+"+U"],s:["Strike",o+"+"+s],a:["Link",o+"+L"],img:["Image",o+"+G"],sub:["Subscript",o+"+"+a],sup:["Superscript",o+"+"+l],abbr:["Abbreviation",o+"+"+c+"+?"],p:["Paragraph",o+"+"+i],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",o+"+H"],"blockquote,q":["Quote",o+"+Q"],"pre,code":["Code",o+"+K"],ul:["Unordered List",o+"+-"],ol:["Ordered List",o+"++"],table:["Table",o+"+T"],hr:["Horizontal Rule",o+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),k=f.format,w=f.replace,q=u.config,y=q.states,_=q.languages,T=q.formats,x=(q.classes,q.tab),H=q.unit[0][0],C=q.unit[0][1],I=q.unit[1][0],U=q.unit[1][1],O=q.suffix,R="(?:"+U[3]+"[^"+I[0]+I[1]+"]*?)?",j="(|"+U[3]+"[^"+I[0]+I[1]+"]*?)",S="([\\s\\S]*?)",z=_.placeholders,P=q.auto_p;return u.type="HTML",p($.tools,{clear:{i:"eraser",click:function(e,t){var i,r=t[0]().$(),n=r.before,l=r.after,a=r.value,o=I[0]+"[^"+I[0]+I[1]+"]+?"+I[1],s=I[0]+"[^"+I[2]+I[0]+I[1]+"]+?"+I[1],c=I[0]+I[2]+"[^"+I[0]+I[1]+"]+?"+I[1];return!a&&l&&(i=g("^"+o)).test(l)?(t.replace(i,"",1),!1):(g(o).test(a)||n.slice(-1)===H[1]||l[0]===H[0]?t.replace(g(o,"g"),"").unwrap(g(s),g(c)):t.insert(""),t[1](),!!l)}},b:{i:"bold",click:function(e,t){return M(e,t).i().format(T.b),!1}},i:{i:"italic",click:function(e,t){return M(e,t).i().format(T.i),!1}},u:{i:"underline",click:function(e,t){return M(e,t).i().format(T.u),!1}},s:{i:"strikethrough",click:function(e,t){return M(e,t).i().format(k(T.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var l,a,r=T.a,n=_.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,i){i=D(i),l=i;var s,c,o=location.host;-1!==l.indexOf("://")&&(s=1),""!==o&&-1!==l.indexOf("://"+o)&&(s=0),/^([.\/?&#]|javascript:)/.test(l)&&(s=0),$.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){a=Q(n),M(e,t).$().length||t.insert(z[""]),c=q.advance_a&&s?k("%4rel%1%2nofollow%3%4target%1%2_blank%3",C):"",t.i().format(k(r+"%4href%1%2"+l+"%3",C)+(a?k("%4title%1%2"+a+"%3",C):"")+c)})}),!1}},img:{i:"image",click:function(e,t){var c,u,r=t.$(),n=T.img,l=T.figure,a=T.figcaption,i=r.value,o=_.modals.img,s=q.advance_img;return $.prompt(["img[src]",o.title[0]],o.placeholder[0],1,function(e,t,r){r=D(r),c=r,$.prompt(["img[title]",o.title[s?2:1]],o.placeholder[s?2:1],0,function(e,t,r){u=Q(r),i||(i=c.split(/[\/\\\\]/).pop()),i=Q(i),t[0](),s&&u?(t.tidy("\n\n","").insert(H[0]+l+H[1]+"\n"+x+H[0]+n+k("%4alt%1%2"+i+"%3%4src%1%2"+c+"%3",C)+O+"\n"+x+H[0]+a+H[1]+u+H[0]+H[2]+A(a)+H[1]+"\n"+H[0]+H[2]+A(l)+H[1]+"\n\n",0,1),P&&$.tools.p.click(e,t)):M(e,t).tidy(g(I[0]+"[^"+I[0]+I[1]+I[2]+"]+?"+I[1]+"\\s*$").test(t.$().before)?"":" ","").insert(H[0]+n+k("%4alt%1%2"+i+"%3%4src%1%2"+c+"%3",C)+(u?k("%4title%1%2"+u+"%3",C):"")+O+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=T.sub,n=T.sup,l=A(n);return M(e,t)[0]().unwrap(g(I[0]+b(l)+R+I[1]),H[0]+H[2]+l+H[1]).i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=T.sub,n=T.sup,l=A(r);return M(e,t)[0]().unwrap(g(I[0]+b(l)+R+I[1]),H[0]+H[2]+l+H[1]).i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var h,m,r=t.$(),n=d(r.value),l=_.modals.abbr,a=t.get(),i=d(n||z[""]),o=T.abbr,s=A(o),c=I[0]+b(o)+j+I[1],u=I[0]+b(o)+R+I[1],f=I[0]+I[2]+b(s)+I[1],p=g(c+S+f);return a.replace(p,function(e,t,r){(r=d(r))&&(y.abbr[r]=(t.match(g(k("%4+title%1%2\\s*(.*?)\\s*%3",U)))||["",""])[1])}),h=y.abbr,n&&h[n]?(t.i().format(o+k("%4title%1%2"+h[n]+"%3",C)),!1):(t.record().ui.prompt(["abbr[title]",l.title],h[i]||l.placeholder,!h[n],function(e,t,r,l){r=Q(r||l),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(m in h)if(Q(h[m])===r){t.insert(m);break}M(e,t).unwrap(g(u),g(f)).unwrap(g(u),g(f),1).i().format(o+k("%4title%1%2"+r+"%3",C))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,r=t.$(),n=r.value,l=T.p,a=T.br,i=A(l),o=A(a),s=r.before,c=r.after,u=B(s),f=z[""];if(t[0](),n&&-1!==n.indexOf("\n")){var h=g("^(?:\\s*"+I[0]+b(i)+R+I[1]+"\\s*)+"+S+"(?:\\s*"+I[0]+I[2]+b(i)+I[1]+"\\s*)+$");h.test(n)?t.replace(h,"$1").replace(g("\\s*"+I[0]+I[2]+b(i)+I[1]+"\\s*"+I[0]+b(i)+R+I[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+I[0]+b(o)+R+I[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+H[0]+a+O+"\n").replace(g("(\\s*"+I[0]+b(o)+R+O+"\\s*){2,}","g"),H[0]+H[2]+i+H[1]+"\n"+H[0]+l+H[1]).wrap(H[0]+l+H[1],H[0]+H[2]+i+H[1],1).replace(g("("+I[0]+b(i)+R+I[1]+")+","g"),"$1").replace(g("("+I[0]+I[2]+b(i)+I[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+I[0]+I[2]+b(i)+I[1]).test(c)?g(I[0]+b(i)+R+I[1]+"\\s*$").test(s)?t.unwrap(g("\\s*"+I[0]+b(i)+R+I[1]+"\\s*"),g("\\s*"+I[0]+I[2]+b(i)+I[1])).replace(f,"").tidy("\n","\n"+u):(p=s.match(g(I[0]+b(i)+j+I[1]+".*?$")))&&t.wrap(H[0]+H[2]+i+H[1]+"\n"+u+H[0]+i+p[1]+H[1],"").insert(f):t.format(l,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[T.p,T.h1,T.h2,T.h3,T.h4,T.h5,T.h6],l=[];h(n,function(e,t){l[t]=A(e)});var i=(b(n).join("|"),b(l).join("|")),o="\\s*"+I[0]+"("+i+")"+j+I[1]+"\\s*",s=g("\\s*"+I[0]+"(?:"+i+")"+R+I[1]+"\\s*"),c=g("\\s*"+I[0]+I[2]+"(?:"+i+")"+I[1]+"\\s*"),u=r.value.match(g("^"+o));u||(u=r.before.match(g(o+"$"))||[]);var f=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(s,c).unwrap(s,c,1).i().tidy("\n\n").format(p>5?l[0]+f:l[p+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var r=t.$(),n=r.value,l=T.blockquote,a=T.q,i=T.p,o=A(i),s=I[0]+b(o)+R+I[1];if(g("(^|\\n|"+s+")$").test(r.before)){if(P&&(n===z[""]||g("("+s+")$").test(r.before)))return t.select(),!1;t[0]().format(l,0,"\n\n","\n"),P&&(!n||t.match(g("^[^"+I[0]+"\\n]*?[^"+I[1]+"]$"))?t.wrap(x+H[0]+i+H[1],H[0]+H[2]+o+H[1]):t[g("((^|\\n)"+b(x)+")+").test(n)?"outdent":"indent"](x)),t[1]()}else t.i().format(a);return!1}},"pre,code":{i:"code",click:function(e,t){function d(e){return l?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function m(e){return l?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,l=q.auto_encode_html,a=T.pre,i=T.code,o=A(a),s=A(i),c=I[0]+b(o)+R+I[1]+"\\s*"+I[0]+b(s)+R+I[1]+"\\s*",u="\\s*"+I[0]+I[2]+b(s)+I[1]+"\\s*"+I[0]+I[2]+b(o)+I[1],f=g(c+"\\s*$"),p=g("^\\s*"+u),h=g("^"+S+"$");return g("(^|\\n|"+c+")$").test(r.before)?f.test(r.before)&&p.test(r.after)?t[0]().unwrap(g(f),g(p)).replace(h,m)[1]():t[0]().tidy("\n\n").wrap(H[0]+a+H[1]+H[0]+i+H[1],H[0]+H[2]+s+H[1]+H[0]+H[2]+o+H[1]).insert(n||z[""]).replace(h,d)[1]():t[0]().format(i).loss().replace(h,function(e){return N(g("^\\s*"+I[0]+I[2]+b(s)+I[1]).test(t.$().after)?d(e):m(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=T.ol,n=T.ul,l=A(r),a=A(n),i="("+b(a)+"|"+b(l)+")";return t.match(g(I[0]+i+R+I[1]+S+I[0]+I[2]+i+I[1]))?t[0]().replace(g(I[0]+b(l)+j+I[1],"g"),H[0]+a+"$1"+H[1]).replace(g(I[0]+I[2]+b(l)+I[1],"g"),H[0]+H[2]+a+H[1])[1]():F(e,n,T.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=T.ol,n=T.ul,l=A(r),a=A(n),i="("+b(a)+"|"+b(l)+")";return t.match(g(I[0]+i+R+I[1]+S+I[0]+I[2]+i+I[1]))?t[0]().replace(g(I[0]+b(a)+j+I[1],"g"),H[0]+l+"$1"+H[1]).replace(g(I[0]+I[2]+b(a)+I[1],"g"),H[0]+H[2]+l+H[1])[1]():F(e,r,T.li),!1}},table:function(e,t){var z,P,E,B,r=y.tr,n=y.td,l=_.modals.table,a=_.placeholders.table,i=d(k(a[0],[1,1])),o=q.advance_table?x:"",s=T.table,c=T.caption,u=T.thead,f=T.tbody,p=T.tfoot,h=T.tr,b=T.th,g=T.td,w=A(s),L=A(c),C=A(u),I=A(f),U=A(p),O=A(h),R=A(b),j=A(g),S=[];return t[0]().$().value===i?(t.select(),!1):($.prompt(["table>td",l.title[0]],l.placeholder[0],0,function(e,t,q,y){P=m(v(q)||y,n[0],n[1]),$.prompt(["table>tr",l.title[1]],l.placeholder[1],0,function(e,t,n,q){E=m(v(n)||q,r[0],r[1]),$.prompt(["table>caption",l.title[2]],l.placeholder[2],0,function(e,t,r){var l,m,v,q,y,n="";for(B=N(r),l=0;E>l;++l){for(z=o+x+H[0]+h+H[1]+"\n",m=0;P>m;++m)z+=o+x+x+H[0]+g+H[1]+d(k(a[1],[l+1,m+1]))+H[0]+H[2]+j+H[1]+"\n";z+=o+x+H[0]+H[2]+O+H[1],S.push(z)}for(S=S.join("\n"),z=x+(o?H[0]+u+H[1]+"\n"+x+x+H[0]+h+H[1]:H[0]+O+H[1])+"\n",v=0;P>v;++v)z+=o+x+x+H[0]+b+H[1]+d(k(a[0],[1,v+1]))+H[0]+H[2]+R+H[1]+"\n";if(o){for(n+=x+H[0]+p+H[1]+"\n",n+=x+x+H[0]+h+H[1]+"\n",v=0;P>v;++v)n+=x+x+x+H[0]+g+H[1]+d(k(a[2],[1,v+1]))+H[0]+H[2]+j+H[1]+"\n";n+=x+x+H[0]+H[2]+h+H[1]+"\n",n+=x+H[0]+H[2]+U+H[1]+"\n"}z+=o+x+H[0]+H[2]+O+H[1]+(o?"\n"+x+H[0]+H[2]+C+H[1]+"\n"+n+x+H[0]+f+H[1]:"")+"\n",S=z+S+(o?"\n"+x+H[0]+H[2]+I+H[1]:"")+"\n",t.tidy("\n\n").insert(H[0]+s+H[1]+"\n"+(B&&c?x+H[0]+c+H[1]+B+H[0]+H[2]+L+H[1]+"\n":"")+S+H[0]+H[2]+w+H[1]),q=t.$(),y=q.start+q.value.indexOf(i),t.select(y,y+i.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=B(t.$().before);return t.tidy("\n\n","").insert(r+H[0]+T.hr+O+"\n\n",0),!1}}}),q.keys&&p($.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=B(t.$().before);return t.tidy("\n","").insert(r+H[0]+T.br+O+"\n",0),!1},enter:function(e,t){var p,h,m,r=t.$(),n=r.value,l=t.get(),a=T.p,i=T.li,o=A(a),s=A(i),u=(B(r.before),z[""]),f=$.tools;if(!n||n===u){if(p=r.after.match(g("^\\s*"+I[0]+I[2]+"("+b(o)+"|"+b(s)+")"+I[1])))h=p[1],(f[h===s?E:h]||f.ul).click(e,t);else{if(!(P&&a&&d(l)&&r.end===l.length&&g("^\\s*[^"+I[0]+"\\n]*?[^"+I[1]+"]\\s*$").test(l)))return;l=H[0]+a+H[1]+l+H[0]+H[2]+o+H[1]+"\n"+H[0]+a+H[1],m=u+H[0]+H[2]+o+H[1],t.set(l+m).select(l.length,(l+u).length)}return!1}},tab:function(e,t){var r=t.$(),n=T.li,l=A(n),a=B(r.before);return g(I[0]+I[2]+b(l)+I[1]).test(r.after)?(t[0]().wrap("\n"+a+x+H[0]+(T[E]||E)+H[1]+"\n"+a+x+x+H[0]+n+H[1],H[0]+H[2]+l+H[1]+"\n"+a+x+H[0]+H[2]+E+H[1]+"\n"+a).insert(z[""])[1](),!1):$.tools.indent.click(e,t)},backspace:function(e,t){var l,r=t.$(),n=r.value,a=r.before,i=r.after,o=I[0]+"[^"+I[0]+I[1]+"]+?"+I[1];return!n&&g(o+"$").test(a)?(l=a.split(H[0]).pop().match(g("^([^"+I[2]+"\\s]+).*?"+I[1]+"$")),l=l&&l[1]||0,l&&g("^\\s*"+I[0]+I[2]+b(l)+I[1]).test(i)?t.unwrap(g(I[0]+b(l)+R+I[1]),g("\\s*"+I[0]+I[2]+b(l)+I[1])):t.outdent(g(o)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),u.update({},0)};