/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function A(e){return e.split(m("("+C[3]+")+"))[0]}function B(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function D(e,t,n){var d,r=f.$(),i=r.value,o=r.before,l=_[t]||t,s=_[n]||n,a=A(l),c=A(s),u=B(o),p=j[""];return M=l,f[0](),i&&i!==p?(f.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,L[0]+L[2]+c+L[1]+"\n"+E+L[0]+s+L[1]).wrap(L[0]+l+L[1]+"\n"+E+L[0]+s+L[1],L[0]+L[2]+c+L[1]+"\n"+L[0]+L[2]+a+L[1]+"\n\n",1).replace(m("\\n"+b(E)+S[0]+b(s)+S[1]+"\\s*"+S[0]+S[2]+b(c)+S[1]+"\\n","g"),"\n"+L[0]+L[2]+a+L[1]+"\n\n"+L[0]+l+L[1]+"\n").select(f.$().end),U&&$.tools.p.click(e,f),f[1](),!1):void((d=o.match(m("(?:^|\\n)[\\t ]+"+S[0]+"("+S[2]+"?)(?:"+b(A(_.ul))+"|"+b(A(_.ol))+")"+H+S[1]+"\\s*$")))?f.insert("\n"+u+(d[1]?"":E),0):(d=o.match(m(S[0]+b(c)+I+S[1]+".*?$")))?m(S[0]+S[2]+b(c)+S[1]+"\\s*$").test(o)?f.tidy("\n"+u,!1).insert(p).wrap(L[0]+c+d[1]+L[1],L[0]+L[2]+c+L[1]):m(S[1]+"\\s*$").test(o)?f.insert(p).wrap("\n"+u+E+L[0]+l+L[1]+"\n"+u+E+E+L[0]+c+d[1]+L[1],L[0]+L[2]+c+L[1]+"\n"+u+E+L[0]+L[2]+a+L[1]+"\n"+u):f.insert(L[0]+L[2]+c+L[1]+"\n"+u+L[0]+c+d[1]+L[1],0).insert(p):m(S[0]+S[2]+b(c)+S[1]+"\\s*$").test(o)?f.insert(p).wrap("\n"+u+L[0]+s+L[1],L[0]+L[2]+c+L[1]):f.tidy("\n\n").insert(p).wrap(L[0]+l+L[1]+"\n"+E+L[0]+s+L[1],L[0]+L[2]+c+L[1]+"\n"+L[0]+L[2]+a+L[1]))}function F(e,t){return!t.get(0)&&U&&$.tools.p.click(e,t),t}function N(e){return h(e.replace(/\s+/g," "))}function K(e){return y(N(e),[m(S[0]+".*?"+S[1],"g"),'"',"'"],["","&#34;","&#39;"])}function P(e){return y(N(e),[m(S[0]+".*?"+S[1],"g"),/\s/g,'"'],["","%20","%22"])}var M,n="–",r="…",i="↑",o="↓",l="↵",s="⌘",a="✘",c="⇧",f=new TE(e),u=f._,p=u.extend,d=u.each,b=u.x,h=u.trim,g=u.edge,m=u.pattern,k=u.i,$=f.ui(p({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",a],b:["Bold",s+"+B"],i:["Italic",s+"+I"],u:["Underline",s+"+U"],s:["Strike",s+"+"+a],a:["Link",s+"+L"],img:["Image",s+"+G"],sub:["Subscript",s+"+"+o],sup:["Superscript",s+"+"+i],abbr:["Abbreviation",s+"+"+c+"+?"],p:["Paragraph",s+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",s+"+H"],"blockquote,q":["Quote",s+"+Q"],"pre,code":["Code",s+"+K"],ul:["Unordered List",s+"+-"],ol:["Ordered List",s+"++"],table:["Table",s+"+T"],hr:["Horizontal Rule",s+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),v=u.format,y=u.replace,x=f.config,w=x.states,T=x.languages,_=x.formats,E=(x.classes,x.tab),L=x.unit[0][0],z=x.unit[0][1],S=x.unit[1][0],C=x.unit[1][1],O=x.suffix,H="(?:"+C[3]+"[^"+S[0]+S[1]+"]*?)?",I="(|"+C[3]+"[^"+S[0]+S[1]+"]*?)",R="([\\s\\S]*?)",j=T.placeholders,U=x.auto_p;return f.type="HTML",p($.tools,{clear:{i:"eraser",click:function(e,t){var l,n=t[0]().$(),r=n.before,i=n.after,o=n.value,s=S[0]+"[^"+S[0]+S[1]+"]+?"+S[1],a=S[0]+"[^"+S[2]+S[0]+S[1]+"]+?"+S[1],c=S[0]+S[2]+"[^"+S[0]+S[1]+"]+?"+S[1];return!o&&i&&(l=m("^"+s)).test(i)?(t.replace(l,"",1),!1):(m(s).test(o)||r.slice(-1)===L[1]||i[0]===L[0]?t.replace(m(s,"g"),"").unwrap(m(a),m(c)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return F(e,t).i().format(_.b),!1}},i:{i:"italic",click:function(e,t){return F(e,t).i().format(_.i),!1}},u:{i:"underline",click:function(e,t){return F(e,t).i().format(_.u),!1}},s:{i:"strikethrough",click:function(e,t){return F(e,t).i().format(v(_.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=_.a,r=T.modals.a;return t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,l){l=P(l),i=l;var a,c,s=location.host;-1!==i.indexOf("://")&&(a=1),""!==s&&-1!==i.indexOf("://"+s)&&(a=0),/^([.\/?&#]|javascript:)/.test(i)&&(a=0),$.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=K(r),F(e,t).$().length||t.insert(j[""]),c=x.advance_a&&a?v("%4rel%1%2nofollow%3%4target%1%2_blank%3",z):"",t.i().format(v(n+"%4href%1%2"+i+"%3",z)+(o?v("%4title%1%2"+o+"%3",z):"")+c)})}),!1}},img:{i:"image",click:function(e,t){var c,f,n=t.$(),r=_.img,i=_.figure,o=_.figcaption,l=n.value,s=T.modals.img,a=x.advance_img;return $.prompt(["img[src]",s.title[0]],s.placeholder[0],1,function(e,t,n){n=P(n),c=n,$.prompt(["img[title]",s.title[a?2:1]],s.placeholder[a?2:1],0,function(e,t,n){f=K(n),l||(l=c.split(/[\/\\\\]/).pop()),l=K(l),t[0](),a&&f?(t.tidy("\n\n","").insert(L[0]+i+L[1]+"\n"+E+L[0]+r+v("%4alt%1%2"+l+"%3%4src%1%2"+c+"%3",z)+O+"\n"+E+L[0]+o+L[1]+f+L[0]+L[2]+A(o)+L[1]+"\n"+L[0]+L[2]+A(i)+L[1]+"\n\n",0,1),U&&$.tools.p.click(e,t)):F(e,t).tidy(m(S[0]+"[^"+S[0]+S[1]+S[2]+"]+?"+S[1]+"\\s*$").test(t.$().before)?"":" ","").insert(L[0]+r+v("%4alt%1%2"+l+"%3%4src%1%2"+c+"%3",z)+(f?v("%4title%1%2"+f+"%3",z):"")+O+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=_.sub,r=_.sup,i=A(r);return F(e,t)[0]().unwrap(m(S[0]+b(i)+H+S[1]),L[0]+L[2]+i+L[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=_.sub,r=_.sup,i=A(n);return F(e,t)[0]().unwrap(m(S[0]+b(i)+H+S[1]),L[0]+L[2]+i+L[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var d,g,n=t.$(),r=h(n.value),i=T.modals.abbr,o=t.get(),l=h(r||j[""]),s=_.abbr,a=A(s),c=S[0]+b(s)+I+S[1],f=S[0]+b(s)+H+S[1],u=S[0]+S[2]+b(a)+S[1],p=m(c+R+u);return o.replace(p,function(e,t,n){(n=h(n))&&(w.abbr[n]=(t.match(m(v("%4+title%1%2\\s*(.*?)\\s*%3",C)))||["",""])[1])}),d=w.abbr,r&&d[r]?(t.i().format(s+v("%4title%1%2"+d[r]+"%3",z)),!1):(t.record().ui.prompt(["abbr[title]",i.title],d[l]||i.placeholder,!d[r],function(e,t,n,i){n=K(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(g in d)if(K(d[g])===n){t.insert(g);break}F(e,t).unwrap(m(f),m(u)).unwrap(m(f),m(u),1).i().format(s+v("%4title%1%2"+n+"%3",z))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,n=t.$(),r=n.value,i=_.p,o=_.br,l=A(i),s=A(o),a=n.before,c=n.after,f=B(a),u=j[""];if(t[0](),r&&-1!==r.indexOf("\n")){var d=m("^(?:\\s*"+S[0]+b(l)+H+S[1]+"\\s*)+"+R+"(?:\\s*"+S[0]+S[2]+b(l)+S[1]+"\\s*)+$");d.test(r)?t.replace(d,"$1").replace(m("\\s*"+S[0]+S[2]+b(l)+S[1]+"\\s*"+S[0]+b(l)+H+S[1]+"\\s*","g"),"\n\n").replace(m("\\s*"+S[0]+b(s)+H+S[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+L[0]+o+O+"\n").replace(m("(\\s*"+S[0]+b(s)+H+O+"\\s*){2,}","g"),L[0]+L[2]+l+L[1]+"\n"+L[0]+i+L[1]).wrap(L[0]+i+L[1],L[0]+L[2]+l+L[1],1).replace(m("("+S[0]+b(l)+H+S[1]+")+","g"),"$1").replace(m("("+S[0]+S[2]+b(l)+S[1]+")+","g"),"$1").tidy("\n")}else m("^\\s*"+S[0]+S[2]+b(l)+S[1]).test(c)?m(S[0]+b(l)+H+S[1]+"\\s*$").test(a)?t.unwrap(m("\\s*"+S[0]+b(l)+H+S[1]+"\\s*"),m("\\s*"+S[0]+S[2]+b(l)+S[1])).replace(u,"").tidy("\n","\n"+f):(p=a.match(m(S[0]+b(l)+I+S[1]+".*?$")))&&t.wrap(L[0]+L[2]+l+L[1]+"\n"+f+L[0]+l+p[1]+L[1],"").insert(u):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),r=[_.p,_.h1,_.h2,_.h3,_.h4,_.h5,_.h6],i=[];d(r,function(e,t){i[t]=A(e)});var l=(b(r).join("|"),b(i).join("|")),s="\\s*"+S[0]+"("+l+")"+I+S[1]+"\\s*",a=m("\\s*"+S[0]+"(?:"+l+")"+H+S[1]+"\\s*"),c=m("\\s*"+S[0]+S[2]+"(?:"+l+")"+S[1]+"\\s*"),f=n.value.match(m("^"+s));f||(f=n.before.match(m(s+"$"))||[]);var u=f[2]||"",p=+(f[1]||"h0").slice(1);return t[0]().unwrap(a,c).unwrap(a,c,1).i().tidy("\n\n").format(p>5?i[0]+u:i[p+1]+u,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var n=t.$(),r=n.value,i=_.blockquote,o=_.q,l=_.p,s=A(l),a=S[0]+b(s)+H+S[1];if(m("(^|\\n|"+a+")$").test(n.before)){if(U&&(r===j[""]||m("("+a+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),U&&(!r||t.match(m("^[^"+S[0]+"\\n]*?[^"+S[1]+"]$"))?t.wrap(E+L[0]+l+L[1],L[0]+L[2]+s+L[1]):t[m("((^|\\n)"+b(E)+")+").test(r)?"outdent":"indent"](E)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return i?y(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function g(e){return i?y(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=x.auto_encode_html,o=_.pre,l=_.code,s=A(o),a=A(l),c=S[0]+b(s)+H+S[1]+"\\s*"+S[0]+b(a)+H+S[1]+"\\s*",f="\\s*"+S[0]+S[2]+b(a)+S[1]+"\\s*"+S[0]+S[2]+b(s)+S[1],u=m(c+"\\s*$"),p=m("^\\s*"+f),d=m("^"+R+"$");return m("(^|\\n|"+c+")$").test(n.before)?u.test(n.before)&&p.test(n.after)?t[0]().unwrap(m(u),m(p)).replace(d,g)[1]():t[0]().tidy("\n\n").wrap(L[0]+o+L[1]+L[0]+l+L[1],L[0]+L[2]+a+L[1]+L[0]+L[2]+s+L[1]).insert(r||j[""]).replace(d,h)[1]():t[0]().format(l).replace(d,function(e){return N(m("^\\s*"+S[0]+S[2]+b(a)+S[1]).test(t.$().after)?h(e):g(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=_.ol,r=_.ul,i=A(n),o=A(r),l="("+b(o)+"|"+b(i)+")";return t.match(m(S[0]+l+H+S[1]+R+S[0]+S[2]+l+S[1]))?t[0]().replace(m(S[0]+b(i)+I+S[1],"g"),L[0]+o+"$1"+L[1]).replace(m(S[0]+S[2]+b(i)+S[1],"g"),L[0]+L[2]+o+L[1])[1]():D(e,r,_.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=_.ol,r=_.ul,i=A(n),o=A(r),l="("+b(o)+"|"+b(i)+")";return t.match(m(S[0]+l+H+S[1]+R+S[0]+S[2]+l+S[1]))?t[0]().replace(m(S[0]+b(o)+I+S[1],"g"),L[0]+i+"$1"+L[1]).replace(m(S[0]+S[2]+b(o)+S[1],"g"),L[0]+L[2]+i+L[1])[1]():D(e,n,_.li),!1}},table:function(e,t){var j,U,M,B,n=w.tr,r=w.td,i=T.modals.table,o=T.placeholders.table,l=h(v(o[0],[1,1])),s=x.advance_table?E:"",a=_.table,c=_.caption,f=_.thead,u=_.tbody,p=_.tfoot,d=_.tr,b=_.th,m=_.td,y=A(a),q=A(c),z=A(f),S=A(u),C=A(p),O=A(d),H=A(b),I=A(m),R=[];return t[0]().$().value===l?(t.select(),!1):($.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,x,w){U=g(k(x)||w,r[0],r[1]),$.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,x){M=g(k(r)||x,n[0],n[1]),$.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,g,k,x,w,r="";for(B=N(n),i=0;M>i;++i){for(j=s+E+L[0]+d+L[1]+"\n",g=0;U>g;++g)j+=s+E+E+L[0]+m+L[1]+h(v(o[1],[i+1,g+1]))+L[0]+L[2]+I+L[1]+"\n";j+=s+E+L[0]+L[2]+O+L[1],R.push(j)}for(R=R.join("\n"),j=E+(s?L[0]+f+L[1]+"\n"+E+E+L[0]+d+L[1]:L[0]+O+L[1])+"\n",k=0;U>k;++k)j+=s+E+E+L[0]+b+L[1]+h(v(o[0],[1,k+1]))+L[0]+L[2]+H+L[1]+"\n";if(s){for(r+=E+L[0]+p+L[1]+"\n",r+=E+E+L[0]+d+L[1]+"\n",k=0;U>k;++k)r+=E+E+E+L[0]+m+L[1]+h(v(o[2],[1,k+1]))+L[0]+L[2]+I+L[1]+"\n";r+=E+E+L[0]+L[2]+d+L[1]+"\n",r+=E+L[0]+L[2]+C+L[1]+"\n"}j+=s+E+L[0]+L[2]+O+L[1]+(s?"\n"+E+L[0]+L[2]+z+L[1]+"\n"+r+E+L[0]+u+L[1]:"")+"\n",R=j+R+(s?"\n"+E+L[0]+L[2]+S+L[1]:"")+"\n",t.tidy("\n\n").insert(L[0]+a+L[1]+"\n"+(B&&c?E+L[0]+c+L[1]+B+L[0]+L[2]+q+L[1]+"\n":"")+R+L[0]+L[2]+y+L[1]),x=t.$(),w=x.start+x.value.indexOf(l),t.select(w,w+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=B(t.$().before);return t.tidy("\n\n","").insert(n+L[0]+_.hr+O+"\n\n",0),!1}}}),x.keys&&p($.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=B(t.$().before);return t.tidy("\n","").insert(n+L[0]+_.br+O+"\n",0),!1},enter:function(e,t){var p,d,g,n=t.$(),r=n.value,i=t.get(),o=_.p,l=_.li,s=A(o),a=A(l),f=(B(n.before),j[""]),u=$.tools;if(!r||r===f){if(p=n.after.match(m("^\\s*"+S[0]+S[2]+"("+b(s)+"|"+b(a)+")"+S[1])))d=p[1],(u[d===a?M:d]||u.ul).click(e,t);else{if(!(U&&o&&h(i)&&n.end===i.length&&m("^\\s*[^"+S[0]+"\\n]*?[^"+S[1]+"]\\s*$").test(i)))return;i=L[0]+o+L[1]+i+L[0]+L[2]+s+L[1]+"\n"+L[0]+o+L[1],g=f+L[0]+L[2]+s+L[1],t.set(i+g).select(i.length,(i+f).length)}return!1}},tab:function(e,t){var n=t.$(),r=_.li,i=A(r),o=B(n.before);return m(S[0]+S[2]+b(i)+S[1]).test(n.after)?(t[0]().wrap("\n"+o+E+L[0]+(_[M]||M)+L[1]+"\n"+o+E+E+L[0]+r+L[1],L[0]+L[2]+i+L[1]+"\n"+o+E+L[0]+L[2]+M+L[1]+"\n"+o).insert(j[""])[1](),!1):$.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,l=n.after,s=S[0]+"[^"+S[0]+S[1]+"]+?"+S[1];return!r&&m(s+"$").test(o)?(i=o.split(L[0]).pop().match(m("^([^"+S[2]+"\\s]+).*?"+S[1]+"$")),i=i&&i[1]||0,i&&m("^\\s*"+S[0]+S[2]+b(i)+S[1]).test(l)?t.unwrap(m(S[0]+b(i)+H+S[1]),m("\\s*"+S[0]+S[2]+b(i)+S[1])):t.outdent(m(s)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),f.update({},0)};