/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.8
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function z(e){return e.split(m("("+E[3]+")+"))[0]}function M(e){return S=e.match(/(?:^|\n)([\t ]*).*$/),S&&S[1]||""}function N(e,t,r){var b,n=f.$(),i=n.value,l=n.before,a=q[t]||t,o=q[r]||r,s=z(a),c=z(o),u=M(l),p=R[""];return j=a,f[0](),i&&i!==p?(f.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,B[0]+B[2]+c+B[1]+"\n"+L+B[0]+o+B[1]).wrap(B[0]+a+B[1]+"\n"+L+B[0]+o+B[1],B[0]+B[2]+c+B[1]+"\n"+B[0]+B[2]+s+B[1]+"\n\n",1).replace(m("\\n"+h(L)+C[0]+h(o)+C[1]+"\\s*"+C[0]+C[2]+h(c)+C[1]+"\\n","g"),"\n"+B[0]+B[2]+s+B[1]+"\n\n"+B[0]+a+B[1]+"\n").select(f.$().end),y&&$.tools.p.click(e,f)):(b=l.match(m("(?:^|\\n)[\\t ]+"+C[0]+"("+C[2]+"?)(?:"+h(z(q.ul))+"|"+h(z(q.ol))+")"+I+C[1]+"\\s*$")))?f.insert("\n"+u+(b[1]?"":L),0):(b=l.match(m(C[0]+h(c)+U+C[1]+".*?$")))?m(C[0]+C[2]+h(c)+C[1]+"\\s*$").test(l)?f.tidy("\n"+u,!1).insert(p).wrap(B[0]+c+b[1]+B[1],B[0]+B[2]+c+B[1]):m(C[1]+"\\s*$").test(l)?f.insert(p).wrap("\n"+u+L+B[0]+a+B[1]+"\n"+u+L+L+B[0]+c+b[1]+B[1],B[0]+B[2]+c+B[1]+"\n"+u+L+B[0]+B[2]+s+B[1]+"\n"+u):f.insert(B[0]+B[2]+c+B[1]+"\n"+u+B[0]+c+b[1]+B[1],0).insert(p):m(C[0]+C[2]+h(c)+C[1]+"\\s*$").test(l)?f.insert(p).wrap("\n"+u+B[0]+o+B[1],B[0]+B[2]+c+B[1]):f.tidy("\n\n").insert(p).wrap(B[0]+a+B[1]+"\n"+L+B[0]+o+B[1],B[0]+B[2]+c+B[1]+"\n"+B[0]+B[2]+s+B[1]),f[1](),!1}function F(e,t){return!t.get(0)&&y&&$.tools.p.click(e,t),t}function Q(e){return g(e.replace(/\s+/g," "))}function D(e){return k(Q(e),[m(C[0]+".*?"+C[1],"g"),'"',"'"],["","&#34;","&#39;"])}function P(e){return k(Q(e),[m(C[0]+".*?"+C[1],"g"),/\s/g,'"'],["","%20","%22"])}var j,S,r="–",n="…",i="↑",l="↓",a="↵",o="⌘",s="✘",c="⇧",f=new TE(e),u=f._,p=u.edge,h=u.x,b=u.extend,d=u.i,m=u.pattern,g=u.trim,$=f.ui(b({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",o+"+B"],i:["Italic",o+"+I"],u:["Underline",o+"+U"],s:["Strike",o+"+"+s],a:["Link",o+"+L"],img:["Image",o+"+G"],sub:["Subscript",o+"+"+l],sup:["Superscript",o+"+"+i],abbr:["Abbreviation",o+"+"+c+"+?"],p:["Paragraph",o+"+"+a],br:["Line Break",c+"+"+a],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",o+"+H"],"blockquote,q":["Quote",o+"+Q"],"pre,code":["Code",o+"+K"],ul:["Unordered List",o+"+-"],ol:["Ordered List",o+"++"],table:["Table",o+"+T"],hr:["Horizontal Rule",o+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),v=u.format,k=u.replace,w=f.config,y=w.auto_p,q=(w.classes,w.formats),T=w.languages,A=w.states,x=w.suffix,L=w.tab,B=w.unit[0][0],H=w.unit[0][1],C=w.unit[1][0],E=w.unit[1][1],I="(?:"+E[3]+"[^"+C[0]+C[1]+"]*?)?",U="(|"+E[3]+"[^"+C[0]+C[1]+"]*?)",O="([\\s\\S]*?)",R=T.placeholders;return f.type="HTML",b($.tools,{clear:{i:"eraser",click:function(e,t){var a,r=t[0]().$(),n=r.before,i=r.after,l=r.value,o=C[0]+"[^"+C[0]+C[1]+"]+?"+C[1],s=C[0]+"[^"+C[2]+C[0]+C[1]+"]+?"+C[1],c=C[0]+C[2]+"[^"+C[0]+C[1]+"]+?"+C[1];return!l&&i&&(a=m("^"+o)).test(i)?(t.replace(a,"",1),!1):(m(o).test(l)||n.slice(-1)===B[1]||i[0]===B[0]?t.replace(m(o,"g"),"").unwrap(m(s),m(c)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return F(e,t).i().format(q.b),!1}},i:{i:"italic",click:function(e,t){return F(e,t).i().format(q.i),!1}},u:{i:"underline",click:function(e,t){return F(e,t).i().format(q.u),!1}},s:{i:"strikethrough",click:function(e,t){return F(e,t).i().format(v(q.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,l,r=q.a,n=T.modals.a;return $.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,a){a=P(a),i=a;var s,c,o=location.host;-1!==i.indexOf("://")&&(s=1),""!==o&&-1!==i.indexOf("://"+o)&&(s=0),/^([.\/?&#]|javascript:)/.test(i)&&(s=0),$.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){l=D(n),F(e,t).$().length||t.insert(R[""]),c=w.advance_a&&s?H[3]+"rel"+H[0]+H[1]+"nofollow"+H[2]+H[3]+"target"+H[0]+H[1]+"_blank"+H[2]:"",t.i().format(r+H[3]+"href"+H[0]+H[1]+i+H[2]+(l?H[3]+"title"+H[0]+H[1]+l+H[2]:"")+c)})}).record(),!1}},img:{i:"image",click:function(e,t){var c,f,r=t.$(),n=q.img,i=q.figure,l=q.figcaption,a=r.value,o=T.modals.img,s=w.advance_img;return $.prompt(["img[src]",o.title[0]],o.placeholder[0],1,function(e,t,r){r=P(r),c=r,$.prompt(["img[title]",o.title[s?2:1]],o.placeholder[s?2:1],0,function(e,t,r){f=D(r),a||(a=c.split(/[\/\\\\]/).pop()),a=D(a),t[0](),s&&f?(t.tidy("\n\n","").insert(B[0]+i+B[1]+"\n"+L+B[0]+n+H[3]+"alt"+H[0]+H[1]+a+H[2]+H[3]+"src"+H[0]+H[1]+c+H[2]+x+"\n"+L+B[0]+l+B[1]+f+B[0]+B[2]+z(l)+B[1]+"\n"+B[0]+B[2]+z(i)+B[1]+"\n\n",0,1),y&&$.tools.p.click(e,t)):F(e,t).tidy(m(C[0]+"[^"+C[0]+C[1]+C[2]+"]+?"+C[1]+"\\s*$").test(t.$().before)?"":" ","").insert(B[0]+n+H[3]+"alt"+H[0]+H[1]+a+H[2]+H[3]+"src"+H[0]+H[1]+c+H[2]+(f?H[3]+"title"+H[0]+H[1]+f+H[2]:"")+x+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=q.sub,n=q.sup,i=z(n);return F(e,t)[0]().unwrap(m(C[0]+h(i)+I+C[1]),B[0]+B[2]+i+B[1]).i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=q.sub,n=q.sup,i=z(r);return F(e,t)[0]().unwrap(m(C[0]+h(i)+I+C[1]),B[0]+B[2]+i+B[1]).i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var b,d,r=t.$(),n=g(r.value),i=T.modals.abbr,l=t.get(),a=g(n||R[""]),o=q.abbr,s=z(o),c=C[0]+h(o)+U+C[1],f=C[0]+h(o)+I+C[1],u=C[0]+C[2]+h(s)+C[1],p=m(c+O+u);return l.replace(p,function(e,t,r){(r=g(r))&&(A.abbr[r]=(t.match(m(E[3]+"+title"+E[0]+E[1]+"\\s*(.*?)\\s*"+E[2]))||["",""])[1])}),b=A.abbr,n&&b[n]?(t.i().format(o+H[3]+"title"+H[0]+H[1]+b[n]+H[2]),!1):($.prompt(["abbr[title]",i.title],b[a]||i.placeholder,!b[n],function(e,t,r,i){r=D(r||i),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(d in b)if(D(b[d])===r){t.insert(d);break}F(e,t).unwrap(m(f),m(u)).unwrap(m(f),m(u),1).i().format(o+H[3]+"title"+H[0]+H[1]+r+H[2])[1]()}).record(),!1)}},p:{i:"paragraph",click:function(e,t){var p,r=t.$(),n=r.value,i=q.p,l=q.br,a=z(i),o=z(l),s=r.before,c=r.after,f=M(s),u=R[""];if(t[0](),n&&-1!==n.indexOf("\n")){var b=m("^(?:\\s*"+C[0]+h(a)+I+C[1]+"\\s*)+"+O+"(?:\\s*"+C[0]+C[2]+h(a)+C[1]+"\\s*)+$");b.test(n)?t.replace(b,"$1").replace(m("\\s*"+C[0]+C[2]+h(a)+C[1]+"\\s*"+C[0]+h(a)+I+C[1]+"\\s*","g"),"\n\n").replace(m("\\s*"+C[0]+h(o)+I+C[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+B[0]+l+x+"\n").replace(m("(\\s*"+C[0]+h(o)+I+x+"\\s*){2,}","g"),B[0]+B[2]+a+B[1]+"\n"+B[0]+i+B[1]).wrap(B[0]+i+B[1],B[0]+B[2]+a+B[1],1).replace(m("("+C[0]+h(a)+I+C[1]+")+","g"),"$1").replace(m("("+C[0]+C[2]+h(a)+C[1]+")+","g"),"$1").tidy("\n")}else m("^\\s*"+C[0]+C[2]+h(a)+C[1]).test(c)?m(C[0]+h(a)+I+C[1]+"\\s*$").test(s)?t.unwrap(m("\\s*"+C[0]+h(a)+I+C[1]+"\\s*"),m("\\s*"+C[0]+C[2]+h(a)+C[1])).replace(u,"").tidy("\n","\n"+f):(p=s.match(m(C[0]+h(a)+U+C[1]+".*?$")))&&t.wrap(B[0]+B[2]+a+B[1]+"\n"+f+B[0]+a+p[1]+B[1],"").insert(u):t.tidy("\n\n").format(i,0,"\n\n");return t[1](),!1}},br:{i:"level-down",click:function(e,t){return S=M(t.$().before),t.tidy("\n","").insert(S+B[0]+q.br+x+"\n",0),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var l,a,r=t.$(),n=[q.p,q.h1,q.h2,q.h3,q.h4,q.h5,q.h6],i=[];for(l in n)i[l]=z(n[l]);var s=(h(n).join("|"),h(i).join("|")),c="\\s*"+C[0]+"("+s+")"+U+C[1]+"\\s*",f=m("\\s*"+C[0]+"(?:"+s+")"+I+C[1]+"\\s*"),u=m("\\s*"+C[0]+C[2]+"(?:"+s+")"+C[1]+"\\s*"),p=r.value.match(m("^"+c));return p||(p=r.before.match(m(c+"$"))||[]),a=p[2]||"",l=+(p[1]||"h0").slice(1),t[0]().unwrap(f,u).unwrap(f,u,1).i().tidy("\n\n").format(l>5?i[0]+a:i[l+1]+a,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var u,r=t.$(),n=r.value,i=q.blockquote,l=q.q,a=q.p,o=z(a),s=h(o),c=m(C[0]+C[2]+s+C[1]),f=R[""];return/(^|\n)$/.test(r.before)?(y&&!c.test(n)&&$.tools.p.click(e,t),r=t.$(),n=r.value,!c.test(n)&&y&&t.select(r.start-(B[0]+a+B[1]).length,r.end+(B[0]+B[2]+o+B[1]).length),n!==f&&y?(t[0]().tidy("\n\n").insert(B[0]+i+B[1]+"\n"+t.$().value.replace(m("^(\\s*"+C[0]+")","gm"),L+"$1")+"\n"+B[0]+B[2]+z(i)+B[1]+"\n\n",0,1),y&&$.tools.p.click(e,t)):(t[0]().format(i,0,"\n\n","\n").loss().replace(m("^(\\s*"+C[0]+")","gm"),L+"$1"),y&&(r=t.$(),u=r.start+(B[0]+a+B[1]+L).length,t.select(u,u+f.length))),t[1]()):t.i().format(l),!1}},"pre,code":{i:"code",click:function(e,t){function d(e){return i?k(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function g(e){return i?k(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var r=t.$(),n=r.value,i=w.auto_encode_html,l=q.pre,a=q.code,o=z(l),s=z(a),c=C[0]+h(o)+I+C[1]+"\\s*"+C[0]+h(s)+I+C[1]+"\\s*",f="\\s*"+C[0]+C[2]+h(s)+C[1]+"\\s*"+C[0]+C[2]+h(o)+C[1],u=m(c+"\\s*$"),p=m("^\\s*"+f),b=m("^"+O+"$");return m("(^|\\n|"+c+")$").test(r.before)?u.test(r.before)&&p.test(r.after)?t[0]().unwrap(m(u),m(p)).replace(b,g)[1]():t[0]().tidy("\n\n").wrap(B[0]+l+B[1]+B[0]+a+B[1],B[0]+B[2]+s+B[1]+B[0]+B[2]+o+B[1]).insert(n||R[""]).replace(b,d)[1]():t[0]().format(a).replace(b,function(e){return Q(m("^\\s*"+C[0]+C[2]+h(s)+C[1]).test(t.$().after)?d(e):g(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=q.ol,n=q.ul,i=z(r),l=z(n),a="("+h(l)+"|"+h(i)+")";return t.match(m(C[0]+a+I+C[1]+O+C[0]+C[2]+a+C[1]))?t[0]().replace(m(C[0]+h(i)+U+C[1],"g"),B[0]+l+"$1"+B[1]).replace(m(C[0]+C[2]+h(i)+C[1],"g"),B[0]+B[2]+l+B[1])[1]():N(e,n,q.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=q.ol,n=q.ul,i=z(r),l=z(n),a="("+h(l)+"|"+h(i)+")";return t.match(m(C[0]+a+I+C[1]+O+C[0]+C[2]+a+C[1]))?t[0]().replace(m(C[0]+h(l)+U+C[1],"g"),B[0]+i+"$1"+B[1]).replace(m(C[0]+C[2]+h(l)+C[1],"g"),B[0]+B[2]+i+B[1])[1]():N(e,r,q.li),!1}},table:function(e,t){var R,j,S,M,r=A.tr,n=A.td,i=T.modals.table,l=T.placeholders.table,a=g(v(l[0],[1,1])),o=w.advance_table?L:"",s=q.table,c=q.caption,f=q.thead,u=q.tbody,h=q.tfoot,b=q.tr,m=q.th,k=q.td,y=z(s),_=z(c),x=z(f),H=z(u),C=z(h),E=z(b),I=z(m),U=z(k),O=[];return t[0]().$().value===a?(t.select(),!1):($.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,w,q){j=p(d(w)||q,n[0],n[1]),$.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,w){S=p(d(n)||w,r[0],r[1]),$.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,r){var i,p,d,w,q,n="";for(M=Q(r),i=0;S>i;++i){for(R=o+L+B[0]+b+B[1]+"\n",p=0;j>p;++p)R+=o+L+L+B[0]+k+B[1]+g(v(l[1],[i+1,p+1]))+B[0]+B[2]+U+B[1]+"\n";R+=o+L+B[0]+B[2]+E+B[1],O.push(R)}for(O=O.join("\n"),R=L+(o?B[0]+f+B[1]+"\n"+L+L+B[0]+b+B[1]:B[0]+E+B[1])+"\n",d=0;j>d;++d)R+=o+L+L+B[0]+m+B[1]+g(v(l[0],[1,d+1]))+B[0]+B[2]+I+B[1]+"\n";if(o){for(n+=L+B[0]+h+B[1]+"\n",n+=L+L+B[0]+b+B[1]+"\n",d=0;j>d;++d)n+=L+L+L+B[0]+k+B[1]+g(v(l[2],[1,d+1]))+B[0]+B[2]+U+B[1]+"\n";n+=L+L+B[0]+B[2]+b+B[1]+"\n",n+=L+B[0]+B[2]+C+B[1]+"\n"}R+=o+L+B[0]+B[2]+E+B[1]+(o?"\n"+L+B[0]+B[2]+x+B[1]+"\n"+n+L+B[0]+u+B[1]:"")+"\n",O=R+O+(o?"\n"+L+B[0]+B[2]+H+B[1]:"")+"\n",t.tidy("\n\n").insert(B[0]+s+B[1]+"\n"+(M&&c?L+B[0]+c+B[1]+M+B[0]+B[2]+_+B[1]+"\n":"")+O+B[0]+B[2]+y+B[1]),w=t.$(),q=w.start+w.value.indexOf(a),t.select(q,q+a.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){return S=M(t.$().before),t.tidy("\n\n","").insert(S+B[0]+q.hr+x+"\n\n",0),!1}}}),w.keys&&b($.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var p,b,d,r=t.$(),n=r.value,i=t.get(),l=q.p,a=q.li,o=z(l),s=z(a),f=(M(r.before),R[""]),u=$.tools;if(!n||n===f){if(p=r.after.match(m("^\\s*"+C[0]+C[2]+"("+h(o)+"|"+h(s)+")"+C[1])))b=p[1],(u[b===s?j:b]||u.ul).click(e,t);else{if(!(y&&l&&g(i)&&r.end===i.length&&m("^\\s*[^"+C[0]+"\\n]*?[^"+C[1]+"]\\s*$").test(i)))return;i=B[0]+l+B[1]+i+B[0]+B[2]+o+B[1]+"\n"+B[0]+l+B[1],d=f+B[0]+B[2]+o+B[1],t.set(i+d).select(i.length,(i+f).length)}return!1}},tab:function(e,t){var r=t.$(),n=q.li,i=z(n),l=M(r.before);return m(C[0]+C[2]+h(i)+C[1]).test(r.after)?(t[0]().wrap("\n"+l+L+B[0]+(q[j]||j)+B[1]+"\n"+l+L+L+B[0]+n+B[1],B[0]+B[2]+i+B[1]+"\n"+l+L+B[0]+B[2]+j+B[1]+"\n"+l).insert(R[""])[1](),!1):$.tools.indent.click(e,t)},backspace:function(e,t){var i,r=t.$(),n=r.value,l=r.before,a=r.after,o=C[0]+"[^"+C[0]+C[1]+"]+?"+C[1];return!n&&m(o+"$").test(l)?(i=l.split(B[0]).pop().match(m("^([^"+C[2]+"\\s]+).*?"+C[1]+"\\s*$")),i=i&&i[1]||0,i&&m("^\\s*"+C[0]+C[2]+h(i)+C[1]).test(a)?t.unwrap(m(C[0]+h(i)+I+C[1]),m("\\s*"+C[0]+C[2]+h(i)+C[1])):t.outdent(m(o)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),f.update({},0)};