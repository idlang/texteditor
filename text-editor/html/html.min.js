/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function A(e){return e.split(g("("+H[3]+")+"))[0]}function B(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function N(e,t,n){var b,i=u.$(),o=i.value,r=i.before,l=_[t]||t,a=_[n]||n,c=A(l),s=A(a),f=B(r),p=R[""];return M=l,u[0](),o&&o!==p?(u.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,E[0]+E[2]+s+E[1]+"\n"+L+E[0]+a+E[1]).wrap(E[0]+l+E[1]+"\n"+L+E[0]+a+E[1],E[0]+E[2]+s+E[1]+"\n"+E[0]+E[2]+c+E[1]+"\n\n",1).replace(g("\\n"+d(L)+C[0]+d(a)+C[1]+"\\s*"+C[0]+C[2]+d(s)+C[1]+"\\n","g"),"\n"+E[0]+E[2]+c+E[1]+"\n\n"+E[0]+l+E[1]+"\n").select(u.$().end),j&&v.tools.p.click(e,u),u[1](),!1):void((b=r.match(g("(?:^|\\n)[\\t ]+"+C[0]+"("+C[2]+"?)(?:"+d(A(_.ul))+"|"+d(A(_.ol))+")"+O+C[1]+"\\s*$")))?u.insert("\n"+f+(b[1]?"":L),0):(b=r.match(g(C[0]+d(s)+U+C[1]+".*?$")))?g(C[0]+C[2]+d(s)+C[1]+"\\s*$").test(r)?u.tidy("\n"+f,!1).insert(p).wrap(E[0]+s+b[1]+E[1],E[0]+E[2]+s+E[1]):g(C[1]+"\\s*$").test(r)?u.insert(p).wrap("\n"+f+L+E[0]+l+E[1]+"\n"+f+L+L+E[0]+s+b[1]+E[1],E[0]+E[2]+s+E[1]+"\n"+f+L+E[0]+E[2]+c+E[1]+"\n"+f):u.insert(E[0]+E[2]+s+E[1]+"\n"+f+E[0]+s+b[1]+E[1],0).insert(p):g(C[0]+C[2]+d(s)+C[1]+"\\s*$").test(r)?u.insert(p).wrap("\n"+f+E[0]+a+E[1],E[0]+E[2]+s+E[1]):u.tidy("\n\n").insert(p).wrap(E[0]+l+E[1]+"\n"+L+E[0]+a+E[1],E[0]+E[2]+s+E[1]+"\n"+E[0]+E[2]+c+E[1]))}function F(e,t){return!t.get(0)&&j&&v.tools.p.click(e,t),t}function Q(e){return h(e.replace(/\s+/g," "))}function D(e){return y(Q(e),[g(C[0]+".*?"+C[1],"g"),'"',"'"],["","&#34;","&#39;"])}function P(e){return y(Q(e),[g(C[0]+".*?"+C[1],"g"),/\s/g,'"'],["","%20","%22"])}var M,n="–",i="…",o="↑",r="↓",l="↵",a="⌘",c="✘",s="⇧",u=new TE(e),f=u._,p=f.extend,b=f.each,d=f.x,h=f.trim,m=f.edge,g=f.pattern,k=f.i,v=u.ui(p({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",c],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+c],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+r],sup:["Superscript",a+"+"+o],abbr:["Abbreviation",a+"+"+s+"+?"],p:["Paragraph",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+i]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+i,"image caption here"+i]},abbr:{title:"Abbreviation",placeholder:"meaning here"+i},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+i]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),$=f.format,y=f.replace,x=u.config,w=x.states,T=x.languages,_=x.formats,L=(x.classes,x.tab),E=x.unit[0][0],z=x.unit[0][1],C=x.unit[1][0],H=x.unit[1][1],I=x.suffix,O="(?:"+H[3]+"[^"+C[0]+C[1]+"]*?)?",U="(|"+H[3]+"[^"+C[0]+C[1]+"]*?)",S="([\\s\\S]*?)",R=T.placeholders,j=x.auto_p;return u.type="HTML",p(v.tools,{clear:{i:"eraser",click:function(e,t){var l,n=t[0]().$(),i=n.before,o=n.after,r=n.value,a=C[0]+"[^"+C[0]+C[1]+"]+?"+C[1],c=C[0]+"[^"+C[2]+C[0]+C[1]+"]+?"+C[1],s=C[0]+C[2]+"[^"+C[0]+C[1]+"]+?"+C[1];return!r&&o&&(l=g("^"+a)).test(o)?(t.replace(l,"",1),!1):(g(a).test(r)||i.slice(-1)===E[1]||o[0]===E[0]?t.replace(g(a,"g"),"").unwrap(g(c),g(s)):t.insert(""),t[1](),!!o)}},b:{i:"bold",click:function(e,t){return F(e,t).i().format(_.b),!1}},i:{i:"italic",click:function(e,t){return F(e,t).i().format(_.i),!1}},u:{i:"underline",click:function(e,t){return F(e,t).i().format(_.u),!1}},s:{i:"strikethrough",click:function(e,t){return F(e,t).i().format($(_.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var o,r,n=_.a,i=T.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,l){l=P(l),o=l;var c,s,a=location.host;-1!==o.indexOf("://")&&(c=1),""!==a&&-1!==o.indexOf("://"+a)&&(c=0),/^([.\/?&#]|javascript:)/.test(o)&&(c=0),v.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=D(i),F(e,t).$().length||t.insert(R[""]),s=x.advance_a&&c?z[3]+"rel"+z[0]+z[1]+"nofollow"+z[2]+z[3]+"target"+z[0]+z[1]+"_blank"+z[2]:"",t.i().format(n+z[3]+"href"+z[0]+z[1]+o+z[2]+(r?z[3]+"title"+z[0]+z[1]+r+z[2]:"")+s)})}),!1}},img:{i:"image",click:function(e,t){var s,u,n=t.$(),i=_.img,o=_.figure,r=_.figcaption,l=n.value,a=T.modals.img,c=x.advance_img;return v.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,n){n=P(n),s=n,v.prompt(["img[title]",a.title[c?2:1]],a.placeholder[c?2:1],0,function(e,t,n){u=D(n),l||(l=s.split(/[\/\\\\]/).pop()),l=D(l),t[0](),c&&u?(t.tidy("\n\n","").insert(E[0]+o+E[1]+"\n"+L+E[0]+i+z[3]+"alt"+z[0]+z[1]+l+z[2]+z[3]+"src"+z[0]+z[1]+s+z[2]+I+"\n"+L+E[0]+r+E[1]+u+E[0]+E[2]+A(r)+E[1]+"\n"+E[0]+E[2]+A(o)+E[1]+"\n\n",0,1),j&&v.tools.p.click(e,t)):F(e,t).tidy(g(C[0]+"[^"+C[0]+C[1]+C[2]+"]+?"+C[1]+"\\s*$").test(t.$().before)?"":" ","").insert(E[0]+i+z[3]+"alt"+z[0]+z[1]+l+z[2]+z[3]+"src"+z[0]+z[1]+s+z[2]+(u?z[3]+"title"+z[0]+z[1]+u+z[2]:"")+I+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=_.sub,i=_.sup,o=A(i);return F(e,t)[0]().unwrap(g(C[0]+d(o)+O+C[1]),E[0]+E[2]+o+E[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=_.sub,i=_.sup,o=A(n);return F(e,t)[0]().unwrap(g(C[0]+d(o)+O+C[1]),E[0]+E[2]+o+E[1]).i().format(i)[1](),!1}},abbr:{i:"question",click:function(e,t){var b,m,n=t.$(),i=h(n.value),o=T.modals.abbr,r=t.get(),l=h(i||R[""]),a=_.abbr,c=A(a),s=C[0]+d(a)+U+C[1],u=C[0]+d(a)+O+C[1],f=C[0]+C[2]+d(c)+C[1],p=g(s+S+f);return r.replace(p,function(e,t,n){(n=h(n))&&(w.abbr[n]=(t.match(g(H[3]+"+title"+H[0]+H[1]+"\\s*(.*?)\\s*"+H[2]))||["",""])[1])}),b=w.abbr,i&&b[i]?(t.i().format(a+z[3]+"title"+z[0]+z[1]+b[i]+z[2]),!1):(t.record().ui.prompt(["abbr[title]",o.title],b[l]||o.placeholder,!b[i],function(e,t,n,o){n=D(n||o),t[0](),i||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(m in b)if(D(b[m])===n){t.insert(m);break}F(e,t).unwrap(g(u),g(f)).unwrap(g(u),g(f),1).i().format(a+z[3]+"title"+z[0]+z[1]+n+z[2])[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,n=t.$(),i=n.value,o=_.p,r=_.br,l=A(o),a=A(r),c=n.before,s=n.after,u=B(c),f=R[""];if(t[0](),i&&-1!==i.indexOf("\n")){var b=g("^(?:\\s*"+C[0]+d(l)+O+C[1]+"\\s*)+"+S+"(?:\\s*"+C[0]+C[2]+d(l)+C[1]+"\\s*)+$");b.test(i)?t.replace(b,"$1").replace(g("\\s*"+C[0]+C[2]+d(l)+C[1]+"\\s*"+C[0]+d(l)+O+C[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+C[0]+d(a)+O+C[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+E[0]+r+I+"\n").replace(g("(\\s*"+C[0]+d(a)+O+I+"\\s*){2,}","g"),E[0]+E[2]+l+E[1]+"\n"+E[0]+o+E[1]).wrap(E[0]+o+E[1],E[0]+E[2]+l+E[1],1).replace(g("("+C[0]+d(l)+O+C[1]+")+","g"),"$1").replace(g("("+C[0]+C[2]+d(l)+C[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+C[0]+C[2]+d(l)+C[1]).test(s)?g(C[0]+d(l)+O+C[1]+"\\s*$").test(c)?t.unwrap(g("\\s*"+C[0]+d(l)+O+C[1]+"\\s*"),g("\\s*"+C[0]+C[2]+d(l)+C[1])).replace(f,"").tidy("\n","\n"+u):(p=c.match(g(C[0]+d(l)+U+C[1]+".*?$")))&&t.wrap(E[0]+E[2]+l+E[1]+"\n"+u+E[0]+l+p[1]+E[1],"").insert(f):t.format(o,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),i=[_.p,_.h1,_.h2,_.h3,_.h4,_.h5,_.h6],o=[];b(i,function(e,t){o[t]=A(e)});var l=(d(i).join("|"),d(o).join("|")),a="\\s*"+C[0]+"("+l+")"+U+C[1]+"\\s*",c=g("\\s*"+C[0]+"(?:"+l+")"+O+C[1]+"\\s*"),s=g("\\s*"+C[0]+C[2]+"(?:"+l+")"+C[1]+"\\s*"),u=n.value.match(g("^"+a));u||(u=n.before.match(g(a+"$"))||[]);var f=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(c,s).unwrap(c,s,1).i().tidy("\n\n").format(p>5?o[0]+f:o[p+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var n=t.$(),i=n.value,o=_.blockquote,r=_.q,l=_.p,a=A(l),c=C[0]+d(a)+O+C[1];if(g("(^|\\n|"+c+")$").test(n.before)){if(j&&(i===R[""]||g("("+c+")$").test(n.before)))return t.select(),!1;t[0]().format(o,0,"\n\n","\n"),j&&(!i||t.match(g("^[^"+C[0]+"\\n]*?[^"+C[1]+"]$"))?t.wrap(L+E[0]+l+E[1],E[0]+E[2]+a+E[1]):t[g("((^|\\n)"+d(L)+")+").test(i)?"outdent":"indent"](L)),t[1]()}else t.i().format(r);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return o?y(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function m(e){return o?y(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),i=n.value,o=x.auto_encode_html,r=_.pre,l=_.code,a=A(r),c=A(l),s=C[0]+d(a)+O+C[1]+"\\s*"+C[0]+d(c)+O+C[1]+"\\s*",u="\\s*"+C[0]+C[2]+d(c)+C[1]+"\\s*"+C[0]+C[2]+d(a)+C[1],f=g(s+"\\s*$"),p=g("^\\s*"+u),b=g("^"+S+"$");return g("(^|\\n|"+s+")$").test(n.before)?f.test(n.before)&&p.test(n.after)?t[0]().unwrap(g(f),g(p)).replace(b,m)[1]():t[0]().tidy("\n\n").wrap(E[0]+r+E[1]+E[0]+l+E[1],E[0]+E[2]+c+E[1]+E[0]+E[2]+a+E[1]).insert(i||R[""]).replace(b,h)[1]():t[0]().format(l).replace(b,function(e){return Q(g("^\\s*"+C[0]+C[2]+d(c)+C[1]).test(t.$().after)?h(e):m(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=_.ol,i=_.ul,o=A(n),r=A(i),l="("+d(r)+"|"+d(o)+")";return t.match(g(C[0]+l+O+C[1]+S+C[0]+C[2]+l+C[1]))?t[0]().replace(g(C[0]+d(o)+U+C[1],"g"),E[0]+r+"$1"+E[1]).replace(g(C[0]+C[2]+d(o)+C[1],"g"),E[0]+E[2]+r+E[1])[1]():N(e,i,_.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=_.ol,i=_.ul,o=A(n),r=A(i),l="("+d(r)+"|"+d(o)+")";return t.match(g(C[0]+l+O+C[1]+S+C[0]+C[2]+l+C[1]))?t[0]().replace(g(C[0]+d(r)+U+C[1],"g"),E[0]+o+"$1"+E[1]).replace(g(C[0]+C[2]+d(r)+C[1],"g"),E[0]+E[2]+o+E[1])[1]():N(e,n,_.li),!1}},table:function(e,t){var R,j,M,B,n=w.tr,i=w.td,o=T.modals.table,r=T.placeholders.table,l=h($(r[0],[1,1])),a=x.advance_table?L:"",c=_.table,s=_.caption,u=_.thead,f=_.tbody,p=_.tfoot,b=_.tr,d=_.th,g=_.td,y=A(c),q=A(s),z=A(u),C=A(f),H=A(p),I=A(b),O=A(d),U=A(g),S=[];return t[0]().$().value===l?(t.select(),!1):(v.prompt(["table>td",o.title[0]],o.placeholder[0],0,function(e,t,x,w){j=m(k(x)||w,i[0],i[1]),v.prompt(["table>tr",o.title[1]],o.placeholder[1],0,function(e,t,i,x){M=m(k(i)||x,n[0],n[1]),v.prompt(["table>caption",o.title[2]],o.placeholder[2],0,function(e,t,n){var o,m,k,x,w,i="";for(B=Q(n),o=0;M>o;++o){for(R=a+L+E[0]+b+E[1]+"\n",m=0;j>m;++m)R+=a+L+L+E[0]+g+E[1]+h($(r[1],[o+1,m+1]))+E[0]+E[2]+U+E[1]+"\n";R+=a+L+E[0]+E[2]+I+E[1],S.push(R)}for(S=S.join("\n"),R=L+(a?E[0]+u+E[1]+"\n"+L+L+E[0]+b+E[1]:E[0]+I+E[1])+"\n",k=0;j>k;++k)R+=a+L+L+E[0]+d+E[1]+h($(r[0],[1,k+1]))+E[0]+E[2]+O+E[1]+"\n";if(a){for(i+=L+E[0]+p+E[1]+"\n",i+=L+L+E[0]+b+E[1]+"\n",k=0;j>k;++k)i+=L+L+L+E[0]+g+E[1]+h($(r[2],[1,k+1]))+E[0]+E[2]+U+E[1]+"\n";i+=L+L+E[0]+E[2]+b+E[1]+"\n",i+=L+E[0]+E[2]+H+E[1]+"\n"}R+=a+L+E[0]+E[2]+I+E[1]+(a?"\n"+L+E[0]+E[2]+z+E[1]+"\n"+i+L+E[0]+f+E[1]:"")+"\n",S=R+S+(a?"\n"+L+E[0]+E[2]+C+E[1]:"")+"\n",t.tidy("\n\n").insert(E[0]+c+E[1]+"\n"+(B&&s?L+E[0]+s+E[1]+B+E[0]+E[2]+q+E[1]+"\n":"")+S+E[0]+E[2]+y+E[1]),x=t.$(),w=x.start+x.value.indexOf(l),t.select(w,w+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=B(t.$().before);return t.tidy("\n\n","").insert(n+E[0]+_.hr+I+"\n\n",0),!1}}}),x.keys&&p(v.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=B(t.$().before);return t.tidy("\n","").insert(n+E[0]+_.br+I+"\n",0),!1},enter:function(e,t){var p,b,m,n=t.$(),i=n.value,o=t.get(),r=_.p,l=_.li,a=A(r),c=A(l),u=(B(n.before),R[""]),f=v.tools;if(!i||i===u){if(p=n.after.match(g("^\\s*"+C[0]+C[2]+"("+d(a)+"|"+d(c)+")"+C[1])))b=p[1],(f[b===c?M:b]||f.ul).click(e,t);else{if(!(j&&r&&h(o)&&n.end===o.length&&g("^\\s*[^"+C[0]+"\\n]*?[^"+C[1]+"]\\s*$").test(o)))return;o=E[0]+r+E[1]+o+E[0]+E[2]+a+E[1]+"\n"+E[0]+r+E[1],m=u+E[0]+E[2]+a+E[1],t.set(o+m).select(o.length,(o+u).length)}return!1}},tab:function(e,t){var n=t.$(),i=_.li,o=A(i),r=B(n.before);return g(C[0]+C[2]+d(o)+C[1]).test(n.after)?(t[0]().wrap("\n"+r+L+E[0]+(_[M]||M)+E[1]+"\n"+r+L+L+E[0]+i+E[1],E[0]+E[2]+o+E[1]+"\n"+r+L+E[0]+E[2]+M+E[1]+"\n"+r).insert(R[""])[1](),!1):v.tools.indent.click(e,t)},backspace:function(e,t){var o,n=t.$(),i=n.value,r=n.before,l=n.after,a=C[0]+"[^"+C[0]+C[1]+"]+?"+C[1];return!i&&g(a+"$").test(r)?(o=r.split(E[0]).pop().match(g("^([^"+C[2]+"\\s]+).*?"+C[1]+"$")),o=o&&o[1]||0,o&&g("^\\s*"+C[0]+C[2]+d(o)+C[1]).test(l)?t.unwrap(g(C[0]+d(o)+O+C[1]),g("\\s*"+C[0]+C[2]+d(o)+C[1])):t.outdent(g(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),u.update({},0)};