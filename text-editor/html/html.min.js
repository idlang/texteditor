/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function A(e){return e.split(g("("+H[3]+")+"))[0]}function B(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function F(e,t,n){var b,r=u.$(),i=r.value,o=r.before,l=_[t]||t,a=_[n]||n,s=A(l),c=A(a),f=B(o),p=R[""];return M=l,u[0](),i&&i!==p?(u.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,E[0]+E[2]+c+E[1]+"\n"+L+E[0]+a+E[1]).wrap(E[0]+l+E[1]+"\n"+L+E[0]+a+E[1],E[0]+E[2]+c+E[1]+"\n"+E[0]+E[2]+s+E[1]+"\n\n",1).replace(g("\\n"+d(L)+C[0]+d(a)+C[1]+"\\s*"+C[0]+C[2]+d(c)+C[1]+"\\n","g"),"\n"+E[0]+E[2]+s+E[1]+"\n\n"+E[0]+l+E[1]+"\n").select(u.$().end),j&&v.tools.p.click(e,u),u[1](),!1):void((b=o.match(g("(?:^|\\n)[\\t ]+"+C[0]+"("+C[2]+"?)(?:"+d(A(_.ul))+"|"+d(A(_.ol))+")"+O+C[1]+"\\s*$")))?u.insert("\n"+f+(b[1]?"":L),0):(b=o.match(g(C[0]+d(c)+U+C[1]+".*?$")))?g(C[0]+C[2]+d(c)+C[1]+"\\s*$").test(o)?u.tidy("\n"+f,!1).insert(p).wrap(E[0]+c+b[1]+E[1],E[0]+E[2]+c+E[1]):g(C[1]+"\\s*$").test(o)?u.insert(p).wrap("\n"+f+L+E[0]+l+E[1]+"\n"+f+L+L+E[0]+c+b[1]+E[1],E[0]+E[2]+c+E[1]+"\n"+f+L+E[0]+E[2]+s+E[1]+"\n"+f):u.insert(E[0]+E[2]+c+E[1]+"\n"+f+E[0]+c+b[1]+E[1],0).insert(p):g(C[0]+C[2]+d(c)+C[1]+"\\s*$").test(o)?u.insert(p).wrap("\n"+f+E[0]+a+E[1],E[0]+E[2]+c+E[1]):u.tidy("\n\n").insert(p).wrap(E[0]+l+E[1]+"\n"+L+E[0]+a+E[1],E[0]+E[2]+c+E[1]+"\n"+E[0]+E[2]+s+E[1]))}function N(e,t){return!t.get(0)&&j&&v.tools.p.click(e,t),t}function Q(e){return h(e.replace(/\s+/g," "))}function D(e){return y(Q(e),[g(C[0]+".*?"+C[1],"g"),'"',"'"],["","&#34;","&#39;"])}function K(e){return y(Q(e),[g(C[0]+".*?"+C[1],"g"),/\s/g,'"'],["","%20","%22"])}var M,n="–",r="…",i="↑",o="↓",l="↵",a="⌘",s="✘",c="⇧",u=new TE(e),f=u._,p=f.extend,b=f.each,d=f.x,h=f.trim,m=f.edge,g=f.pattern,k=f.i,v=u.ui(p({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+s],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+o],sup:["Superscript",a+"+"+i],abbr:["Abbreviation",a+"+"+c+"+?"],p:["Paragraph",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),$=f.format,y=f.replace,w=u.config,x=w.states,T=w.languages,_=w.formats,L=(w.classes,w.tab),E=w.unit[0][0],z=w.unit[0][1],C=w.unit[1][0],H=w.unit[1][1],I=w.suffix,O="(?:"+H[3]+"[^"+C[0]+C[1]+"]*?)?",U="(|"+H[3]+"[^"+C[0]+C[1]+"]*?)",S="([\\s\\S]*?)",R=T.placeholders,j=w.auto_p;return u.type="HTML",p(v.tools,{clear:{i:"eraser",click:function(e,t){var l,n=t[0]().$(),r=n.before,i=n.after,o=n.value,a=C[0]+"[^"+C[0]+C[1]+"]+?"+C[1],s=C[0]+"[^"+C[2]+C[0]+C[1]+"]+?"+C[1],c=C[0]+C[2]+"[^"+C[0]+C[1]+"]+?"+C[1];return!o&&i&&(l=g("^"+a)).test(i)?(t.replace(l,"",1),!1):(g(a).test(o)||r.slice(-1)===E[1]||i[0]===E[0]?t.replace(g(a,"g"),"").unwrap(g(s),g(c)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return N(e,t).i().format(_.b),!1}},i:{i:"italic",click:function(e,t){return N(e,t).i().format(_.i),!1}},u:{i:"underline",click:function(e,t){return N(e,t).i().format(_.u),!1}},s:{i:"strikethrough",click:function(e,t){return N(e,t).i().format($(_.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=_.a,r=T.modals.a;return t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,l){l=K(l),i=l;var s,c,a=location.host;-1!==i.indexOf("://")&&(s=1),""!==a&&-1!==i.indexOf("://"+a)&&(s=0),/^([.\/?&#]|javascript:)/.test(i)&&(s=0),v.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=D(r),N(e,t).$().length||t.insert(R[""]),c=w.advance_a&&s?z[3]+"rel"+z[0]+z[1]+"nofollow"+z[2]+z[3]+"target"+z[0]+z[1]+"_blank"+z[2]:"",t.i().format(n+z[3]+"href"+z[0]+z[1]+i+z[2]+(o?z[3]+"title"+z[0]+z[1]+o+z[2]:"")+c)})}),!1}},img:{i:"image",click:function(e,t){var c,u,n=t.$(),r=_.img,i=_.figure,o=_.figcaption,l=n.value,a=T.modals.img,s=w.advance_img;return v.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,n){n=K(n),c=n,v.prompt(["img[title]",a.title[s?2:1]],a.placeholder[s?2:1],0,function(e,t,n){u=D(n),l||(l=c.split(/[\/\\\\]/).pop()),l=D(l),t[0](),s&&u?(t.tidy("\n\n","").insert(E[0]+i+E[1]+"\n"+L+E[0]+r+z[3]+"alt"+z[0]+z[1]+l+z[2]+z[3]+"src"+z[0]+z[1]+c+z[2]+I+"\n"+L+E[0]+o+E[1]+u+E[0]+E[2]+A(o)+E[1]+"\n"+E[0]+E[2]+A(i)+E[1]+"\n\n",0,1),j&&v.tools.p.click(e,t)):N(e,t).tidy(g(C[0]+"[^"+C[0]+C[1]+C[2]+"]+?"+C[1]+"\\s*$").test(t.$().before)?"":" ","").insert(E[0]+r+z[3]+"alt"+z[0]+z[1]+l+z[2]+z[3]+"src"+z[0]+z[1]+c+z[2]+(u?z[3]+"title"+z[0]+z[1]+u+z[2]:"")+I+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=_.sub,r=_.sup,i=A(r);return N(e,t)[0]().unwrap(g(C[0]+d(i)+O+C[1]),E[0]+E[2]+i+E[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=_.sub,r=_.sup,i=A(n);return N(e,t)[0]().unwrap(g(C[0]+d(i)+O+C[1]),E[0]+E[2]+i+E[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var b,m,n=t.$(),r=h(n.value),i=T.modals.abbr,o=t.get(),l=h(r||R[""]),a=_.abbr,s=A(a),c=C[0]+d(a)+U+C[1],u=C[0]+d(a)+O+C[1],f=C[0]+C[2]+d(s)+C[1],p=g(c+S+f);return o.replace(p,function(e,t,n){(n=h(n))&&(x.abbr[n]=(t.match(g(H[3]+"+title"+H[0]+H[1]+"\\s*(.*?)\\s*"+H[2]))||["",""])[1])}),b=x.abbr,r&&b[r]?(t.i().format(a+z[3]+"title"+z[0]+z[1]+b[r]+z[2]),!1):(t.record().ui.prompt(["abbr[title]",i.title],b[l]||i.placeholder,!b[r],function(e,t,n,i){n=D(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(m in b)if(D(b[m])===n){t.insert(m);break}N(e,t).unwrap(g(u),g(f)).unwrap(g(u),g(f),1).i().format(a+z[3]+"title"+z[0]+z[1]+n+z[2])[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,n=t.$(),r=n.value,i=_.p,o=_.br,l=A(i),a=A(o),s=n.before,c=n.after,u=B(s),f=R[""];if(t[0](),r&&-1!==r.indexOf("\n")){var b=g("^(?:\\s*"+C[0]+d(l)+O+C[1]+"\\s*)+"+S+"(?:\\s*"+C[0]+C[2]+d(l)+C[1]+"\\s*)+$");b.test(r)?t.replace(b,"$1").replace(g("\\s*"+C[0]+C[2]+d(l)+C[1]+"\\s*"+C[0]+d(l)+O+C[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+C[0]+d(a)+O+C[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+E[0]+o+I+"\n").replace(g("(\\s*"+C[0]+d(a)+O+I+"\\s*){2,}","g"),E[0]+E[2]+l+E[1]+"\n"+E[0]+i+E[1]).wrap(E[0]+i+E[1],E[0]+E[2]+l+E[1],1).replace(g("("+C[0]+d(l)+O+C[1]+")+","g"),"$1").replace(g("("+C[0]+C[2]+d(l)+C[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+C[0]+C[2]+d(l)+C[1]).test(c)?g(C[0]+d(l)+O+C[1]+"\\s*$").test(s)?t.unwrap(g("\\s*"+C[0]+d(l)+O+C[1]+"\\s*"),g("\\s*"+C[0]+C[2]+d(l)+C[1])).replace(f,"").tidy("\n","\n"+u):(p=s.match(g(C[0]+d(l)+U+C[1]+".*?$")))&&t.wrap(E[0]+E[2]+l+E[1]+"\n"+u+E[0]+l+p[1]+E[1],"").insert(f):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),r=[_.p,_.h1,_.h2,_.h3,_.h4,_.h5,_.h6],i=[];b(r,function(e,t){i[t]=A(e)});var l=(d(r).join("|"),d(i).join("|")),a="\\s*"+C[0]+"("+l+")"+U+C[1]+"\\s*",s=g("\\s*"+C[0]+"(?:"+l+")"+O+C[1]+"\\s*"),c=g("\\s*"+C[0]+C[2]+"(?:"+l+")"+C[1]+"\\s*"),u=n.value.match(g("^"+a));u||(u=n.before.match(g(a+"$"))||[]);var f=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(s,c).unwrap(s,c,1).i().tidy("\n\n").format(p>5?i[0]+f:i[p+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var n=t.$(),r=n.value,i=_.blockquote,o=_.q,l=_.p,a=A(l),s=C[0]+d(a)+O+C[1];if(g("(^|\\n|"+s+")$").test(n.before)){if(j&&(r===R[""]||g("("+s+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),j&&(!r||t.match(g("^[^"+C[0]+"\\n]*?[^"+C[1]+"]$"))?t.wrap(L+E[0]+l+E[1],E[0]+E[2]+a+E[1]):t[g("((^|\\n)"+d(L)+")+").test(r)?"outdent":"indent"](L)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return i?y(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function m(e){return i?y(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=w.auto_encode_html,o=_.pre,l=_.code,a=A(o),s=A(l),c=C[0]+d(a)+O+C[1]+"\\s*"+C[0]+d(s)+O+C[1]+"\\s*",u="\\s*"+C[0]+C[2]+d(s)+C[1]+"\\s*"+C[0]+C[2]+d(a)+C[1],f=g(c+"\\s*$"),p=g("^\\s*"+u),b=g("^"+S+"$");return g("(^|\\n|"+c+")$").test(n.before)?f.test(n.before)&&p.test(n.after)?t[0]().unwrap(g(f),g(p)).replace(b,m)[1]():t[0]().tidy("\n\n").wrap(E[0]+o+E[1]+E[0]+l+E[1],E[0]+E[2]+s+E[1]+E[0]+E[2]+a+E[1]).insert(r||R[""]).replace(b,h)[1]():t[0]().format(l).replace(b,function(e){return Q(g("^\\s*"+C[0]+C[2]+d(s)+C[1]).test(t.$().after)?h(e):m(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=_.ol,r=_.ul,i=A(n),o=A(r),l="("+d(o)+"|"+d(i)+")";return t.match(g(C[0]+l+O+C[1]+S+C[0]+C[2]+l+C[1]))?t[0]().replace(g(C[0]+d(i)+U+C[1],"g"),E[0]+o+"$1"+E[1]).replace(g(C[0]+C[2]+d(i)+C[1],"g"),E[0]+E[2]+o+E[1])[1]():F(e,r,_.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=_.ol,r=_.ul,i=A(n),o=A(r),l="("+d(o)+"|"+d(i)+")";return t.match(g(C[0]+l+O+C[1]+S+C[0]+C[2]+l+C[1]))?t[0]().replace(g(C[0]+d(o)+U+C[1],"g"),E[0]+i+"$1"+E[1]).replace(g(C[0]+C[2]+d(o)+C[1],"g"),E[0]+E[2]+i+E[1])[1]():F(e,n,_.li),!1}},table:function(e,t){var R,j,M,B,n=x.tr,r=x.td,i=T.modals.table,o=T.placeholders.table,l=h($(o[0],[1,1])),a=w.advance_table?L:"",s=_.table,c=_.caption,u=_.thead,f=_.tbody,p=_.tfoot,b=_.tr,d=_.th,g=_.td,y=A(s),q=A(c),z=A(u),C=A(f),H=A(p),I=A(b),O=A(d),U=A(g),S=[];return t[0]().$().value===l?(t.select(),!1):(v.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,w,x){j=m(k(w)||x,r[0],r[1]),v.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,w){M=m(k(r)||w,n[0],n[1]),v.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,m,k,w,x,r="";for(B=Q(n),i=0;M>i;++i){for(R=a+L+E[0]+b+E[1]+"\n",m=0;j>m;++m)R+=a+L+L+E[0]+g+E[1]+h($(o[1],[i+1,m+1]))+E[0]+E[2]+U+E[1]+"\n";R+=a+L+E[0]+E[2]+I+E[1],S.push(R)}for(S=S.join("\n"),R=L+(a?E[0]+u+E[1]+"\n"+L+L+E[0]+b+E[1]:E[0]+I+E[1])+"\n",k=0;j>k;++k)R+=a+L+L+E[0]+d+E[1]+h($(o[0],[1,k+1]))+E[0]+E[2]+O+E[1]+"\n";if(a){for(r+=L+E[0]+p+E[1]+"\n",r+=L+L+E[0]+b+E[1]+"\n",k=0;j>k;++k)r+=L+L+L+E[0]+g+E[1]+h($(o[2],[1,k+1]))+E[0]+E[2]+U+E[1]+"\n";r+=L+L+E[0]+E[2]+b+E[1]+"\n",r+=L+E[0]+E[2]+H+E[1]+"\n"}R+=a+L+E[0]+E[2]+I+E[1]+(a?"\n"+L+E[0]+E[2]+z+E[1]+"\n"+r+L+E[0]+f+E[1]:"")+"\n",S=R+S+(a?"\n"+L+E[0]+E[2]+C+E[1]:"")+"\n",t.tidy("\n\n").insert(E[0]+s+E[1]+"\n"+(B&&c?L+E[0]+c+E[1]+B+E[0]+E[2]+q+E[1]+"\n":"")+S+E[0]+E[2]+y+E[1]),w=t.$(),x=w.start+w.value.indexOf(l),t.select(x,x+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=B(t.$().before);return t.tidy("\n\n","").insert(n+E[0]+_.hr+I+"\n\n",0),!1}}}),w.keys&&p(v.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=B(t.$().before);return t.tidy("\n","").insert(n+E[0]+_.br+I+"\n",0),!1},enter:function(e,t){var p,b,m,n=t.$(),r=n.value,i=t.get(),o=_.p,l=_.li,a=A(o),s=A(l),u=(B(n.before),R[""]),f=v.tools;if(!r||r===u){if(p=n.after.match(g("^\\s*"+C[0]+C[2]+"("+d(a)+"|"+d(s)+")"+C[1])))b=p[1],(f[b===s?M:b]||f.ul).click(e,t);else{if(!(j&&o&&h(i)&&n.end===i.length&&g("^\\s*[^"+C[0]+"\\n]*?[^"+C[1]+"]\\s*$").test(i)))return;i=E[0]+o+E[1]+i+E[0]+E[2]+a+E[1]+"\n"+E[0]+o+E[1],m=u+E[0]+E[2]+a+E[1],t.set(i+m).select(i.length,(i+u).length)}return!1}},tab:function(e,t){var n=t.$(),r=_.li,i=A(r),o=B(n.before);return g(C[0]+C[2]+d(i)+C[1]).test(n.after)?(t[0]().wrap("\n"+o+L+E[0]+(_[M]||M)+E[1]+"\n"+o+L+L+E[0]+r+E[1],E[0]+E[2]+i+E[1]+"\n"+o+L+E[0]+E[2]+M+E[1]+"\n"+o).insert(R[""])[1](),!1):v.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,l=n.after,a=C[0]+"[^"+C[0]+C[1]+"]+?"+C[1];return!r&&g(a+"$").test(o)?(i=o.split(E[0]).pop().match(g("^([^"+C[2]+"\\s]+).*?"+C[1]+"$")),i=i&&i[1]||0,i&&g("^\\s*"+C[0]+C[2]+d(i)+C[1]).test(l)?t.unwrap(g(C[0]+d(i)+O+C[1]),g("\\s*"+C[0]+C[2]+d(i)+C[1])):t.outdent(g(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),u.update({},0)};