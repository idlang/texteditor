/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function P(e){return e.split(g("("+S[3]+")+"))[0]}function I(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function A(e,t,n){var p,r=a.$(),i=r.value,o=r.before,f=$[t]||t,u=$[n]||n,l=P(f),s=P(u),c=I(o),d=N[""];return H=f,a[0](),i&&i!==d?(a.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,z[0]+z[2]+s+z[1]+"\n"+L+z[0]+u+z[1]).wrap(z[0]+f+z[1]+"\n"+L+z[0]+u+z[1],z[0]+z[2]+s+z[1]+"\n"+z[0]+z[2]+l+z[1]+"\n\n",1).replace(g("\\n"+h(L)+O[0]+h(u)+O[1]+"\\s*"+O[0]+O[2]+h(s)+O[1]+"\\n","g"),"\n"+z[0]+z[2]+l+z[1]+"\n\n"+z[0]+f+z[1]+"\n").select(a.$().end),B&&m.tools.p.click(e,a),a[1](),!1):void((p=o.match(g("(?:^|\\n)[\\t ]+"+O[0]+"("+O[2]+"?)(?:"+h(P($.ul))+"|"+h(P($.ol))+")"+M+O[1]+"\\s*$")))?a.insert("\n"+c+(p[1]?"":L),0):(p=o.match(g(O[0]+h(s)+D+O[1]+".*?$")))?g(O[0]+O[2]+h(s)+O[1]+"\\s*$").test(o)?a.tidy("\n"+c,!1).insert(d).wrap(z[0]+s+p[1]+z[1],z[0]+z[2]+s+z[1]):g(O[1]+"\\s*$").test(o)?a.insert(d).wrap("\n"+c+L+z[0]+f+z[1]+"\n"+c+L+L+z[0]+s+p[1]+z[1],z[0]+z[2]+s+z[1]+"\n"+c+L+z[0]+z[2]+l+z[1]+"\n"+c):a.insert(z[0]+z[2]+s+z[1]+"\n"+c+z[0]+s+p[1]+z[1],0).insert(d):g(O[0]+O[2]+h(s)+O[1]+"\\s*$").test(o)?a.insert(d).wrap("\n"+c+z[0]+u+z[1],z[0]+z[2]+s+z[1]):a.tidy("\n\n").insert(d).wrap(z[0]+f+z[1]+"\n"+L+z[0]+u+z[1],z[0]+z[2]+s+z[1]+"\n"+z[0]+z[2]+l+z[1]))}function F(e,t){return!t.get(0)&&B&&m.tools.p.click(e,t),t}function W(e){return b(e.replace(/\s+/g," "))}function U(e){return w(W(e),[g(O[0]+".*?"+O[1],"g"),'"',"'"],["","&#34;","&#39;"])}function R(e){return w(W(e),[g(O[0]+".*?"+O[1],"g"),/\s/g,'"'],["","%20","%22"])}var H,n="–",r="…",i="↑",o="↓",f="↵",u="⌘",l="✘",s="⇧",a=new TE(e),c=a._,d=c.extend,p=c.each,h=c.x,b=c.trim,v=c.edge,g=c.pattern,y=c.i,m=a.ui(d({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",l],b:["Bold",u+"+B"],i:["Italic",u+"+I"],u:["Underline",u+"+U"],s:["Strike",u+"+"+l],a:["Link",u+"+L"],img:["Image",u+"+G"],sub:["Subscript",u+"+"+o],sup:["Superscript",u+"+"+i],abbr:["Abbreviation",u+"+"+s+"+?"],p:["Paragraph",u+"+"+f],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",u+"+H"],"blockquote,q":["Quote",u+"+Q"],"pre,code":["Code",u+"+K"],ul:["Unordered List",u+"+-"],ol:["Ordered List",u+"++"],table:["Table",u+"+T"],hr:["Horizontal Rule",u+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),x=c.format,w=c.replace,k=a.config,E=k.states,T=k.languages,$=k.formats,L=(k.classes,k.tab),z=k.unit[0][0],C=k.unit[0][1],O=k.unit[1][0],S=k.unit[1][1],j=k.suffix,M="(?:"+S[3]+"[^"+O[0]+O[1]+"]*?)?",D="(|"+S[3]+"[^"+O[0]+O[1]+"]*?)",Y="([\\s\\S]*?)",N=T.placeholders,B=k.auto_p;return a.type="HTML",d(m.tools,{clear:{i:"eraser",click:function(e,t){var f,n=t[0]().$(),r=n.before,i=n.after,o=n.value,u=O[0]+"[^"+O[0]+O[1]+"]+?"+O[1],l=O[0]+"[^"+O[2]+O[0]+O[1]+"]+?"+O[1],s=O[0]+O[2]+"[^"+O[0]+O[1]+"]+?"+O[1];return!o&&i&&(f=g("^"+u)).test(i)?(t.replace(f,"",1),!1):(g(u).test(o)||r.slice(-1)===z[1]||i[0]===z[0]?t.replace(g(u,"g"),"").unwrap(g(l),g(s)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return F(e,t).i().format($.b),!1}},i:{i:"italic",click:function(e,t){return F(e,t).i().format($.i),!1}},u:{i:"underline",click:function(e,t){return F(e,t).i().format($.u),!1}},s:{i:"strikethrough",click:function(e,t){return F(e,t).i().format(x($.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=$.a,r=T.modals.a;return t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,f){f=R(f),i=f;var l,s,u=location.host;-1!==i.indexOf("://")&&(l=1),""!==u&&-1!==i.indexOf("://"+u)&&(l=0),/^([.\/?&#]|javascript:)/.test(i)&&(l=0),m.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=U(r),F(e,t).$().length||t.insert(N[""]),s=k.advance_a&&l?x("%4rel%1%2nofollow%3%4target%1%2_blank%3",C):"",t.i().format(x(n+"%4href%1%2"+i+"%3",C)+(o?x("%4title%1%2"+o+"%3",C):"")+s)})}),!1}},img:{i:"image",click:function(e,t){var s,a,n=t.$(),r=$.img,i=$.figure,o=$.figcaption,f=n.value,u=T.modals.img,l=k.advance_img;return m.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,n){n=R(n),s=n,m.prompt(["img[title]",u.title[l?2:1]],u.placeholder[l?2:1],0,function(e,t,n){a=U(n),f||(f=s.split(/[\/\\\\]/).pop()),f=U(f),t[0](),l&&a?(t.tidy("\n\n","").insert(z[0]+i+z[1]+"\n"+L+z[0]+r+x("%4alt%1%2"+f+"%3%4src%1%2"+s+"%3",C)+j+"\n"+L+z[0]+o+z[1]+a+z[0]+z[2]+P(o)+z[1]+"\n"+z[0]+z[2]+P(i)+z[1]+"\n\n",0,1),B&&m.tools.p.click(e,t)):F(e,t).tidy(g(O[0]+"[^"+O[0]+O[1]+O[2]+"]+?"+O[1]+"\\s*$").test(t.$().before)?"":" ","").insert(z[0]+r+x("%4alt%1%2"+f+"%3%4src%1%2"+s+"%3",C)+(a?x("%4title%1%2"+a+"%3",C):"")+j+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=$.sub,r=$.sup,i=P(r);return F(e,t)[0]().unwrap(g(O[0]+h(i)+M+O[1]),z[0]+z[2]+i+z[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=$.sub,r=$.sup,i=P(n);return F(e,t)[0]().unwrap(g(O[0]+h(i)+M+O[1]),z[0]+z[2]+i+z[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var p,v,n=t.$(),r=b(n.value),i=T.modals.abbr,o=t.get(),f=b(r||N[""]),u=$.abbr,l=P(u),s=O[0]+h(u)+D+O[1],a=O[0]+h(u)+M+O[1],c=O[0]+O[2]+h(l)+O[1],d=g(s+Y+c);return o.replace(d,function(e,t,n){(n=b(n))&&(E.abbr[n]=(t.match(g(x("%4+title%1%2\\s*(.*?)\\s*%3",S)))||["",""])[1])}),p=E.abbr,r&&p[r]?(t.i().format(u+x("%4title%1%2"+p[r]+"%3",C)),!1):(t.record().ui.prompt(["abbr[title]",i.title],p[f]||i.placeholder,!p[r],function(e,t,n,i){n=U(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(v in p)if(U(p[v])===n){t.insert(v);break}F(e,t).unwrap(g(a),g(c)).unwrap(g(a),g(c),1).i().format(u+x("%4title%1%2"+n+"%3",C))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var d,n=t.$(),r=n.value,i=$.p,o=$.br,f=P(i),u=P(o),l=n.before,s=n.after,a=I(l),c=N[""];if(t[0](),r&&-1!==r.indexOf("\n")){var p=g("^(?:\\s*"+O[0]+h(f)+M+O[1]+"\\s*)+"+Y+"(?:\\s*"+O[0]+O[2]+h(f)+O[1]+"\\s*)+$");p.test(r)?t.replace(p,"$1").replace(g("\\s*"+O[0]+O[2]+h(f)+O[1]+"\\s*"+O[0]+h(f)+M+O[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+O[0]+h(u)+M+O[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+z[0]+o+j+"\n").replace(g("(\\s*"+O[0]+h(u)+M+j+"\\s*){2,}","g"),z[0]+z[2]+f+z[1]+"\n"+z[0]+i+z[1]).wrap(z[0]+i+z[1],z[0]+z[2]+f+z[1],1).replace(g("("+O[0]+h(f)+M+O[1]+")+","g"),"$1").replace(g("("+O[0]+O[2]+h(f)+O[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+O[0]+O[2]+h(f)+O[1]).test(s)?g(O[0]+h(f)+M+O[1]+"\\s*$").test(l)?t.unwrap(g("\\s*"+O[0]+h(f)+M+O[1]+"\\s*"),g("\\s*"+O[0]+O[2]+h(f)+O[1])).replace(c,"").tidy("\n","\n"+a):(d=l.match(g(O[0]+h(f)+D+O[1]+".*?$")))&&t.wrap(z[0]+z[2]+f+z[1]+"\n"+a+z[0]+f+d[1]+z[1],"").insert(c):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),r=[$.p,$.h1,$.h2,$.h3,$.h4,$.h5,$.h6],i=[];p(r,function(e,t){i[t]=P(e)});var f=(h(r).join("|"),h(i).join("|")),u="\\s*"+O[0]+"("+f+")"+D+O[1]+"\\s*",l=g("\\s*"+O[0]+"(?:"+f+")"+M+O[1]+"\\s*"),s=g("\\s*"+O[0]+O[2]+"(?:"+f+")"+O[1]+"\\s*"),a=n.value.match(g("^"+u));a||(a=n.before.match(g(u+"$"))||[]);var c=a[2]||"",d=+(a[1]||"h0").slice(1);return t[0]().unwrap(l,s).unwrap(l,s,1).i().tidy("\n\n").format(d>5?i[0]+c:i[d+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var n=t.$(),r=n.value,i=$.blockquote,o=$.q,f=$.p,u=P(f),l=O[0]+h(u)+M+O[1];if(g("(^|\\n|"+l+")$").test(n.before)){if(B&&(r===N[""]||g("("+l+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),B&&(!r||t.match(g("^[^"+O[0]+"\\n]*?[^"+O[1]+"]$"))?t.wrap(L+z[0]+f+z[1],z[0]+z[2]+u+z[1]):t[g("((^|\\n)"+h(L)+")+").test(r)?"outdent":"indent"](L)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function b(e){return i?w(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function v(e){return i?w(e,["&lt;","&gt;","&amp;"],["<",">","&"]):e}var n=t.$(),r=n.value,i=k.auto_encode_html,o=$.pre,f=$.code,u=P(o),l=P(f),s=O[0]+h(u)+M+O[1]+"\\s*"+O[0]+h(l)+M+O[1]+"\\s*",a="\\s*"+O[0]+O[2]+h(l)+O[1]+"\\s*"+O[0]+O[2]+h(u)+O[1],c=g(s+"\\s*$"),d=g("^\\s*"+a),p=g("^"+Y+"$");return g("(^|\\n|"+s+")$").test(n.before)?c.test(n.before)&&d.test(n.after)?t[0]().unwrap(g(c),g(d)).replace(p,v)[1]():t[0]().tidy("\n\n").wrap(z[0]+o+z[1]+z[0]+f+z[1],z[0]+z[2]+l+z[1]+z[0]+z[2]+u+z[1]).insert(r||N[""]).replace(p,b)[1]():t[0]().format(f).loss().replace(p,function(e){return W(g("^\\s*"+O[0]+O[2]+h(l)+O[1]).test(t.$().after)?b(e):v(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=$.ol,r=$.ul,i=P(n),o=P(r),f="("+h(o)+"|"+h(i)+")";return t.match(g(O[0]+f+M+O[1]+Y+O[0]+O[2]+f+O[1]))?t[0]().replace(g(O[0]+h(i)+D+O[1],"g"),z[0]+o+"$1"+z[1]).replace(g(O[0]+O[2]+h(i)+O[1],"g"),z[0]+z[2]+o+z[1])[1]():A(e,r,$.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=$.ol,r=$.ul,i=P(n),o=P(r),f="("+h(o)+"|"+h(i)+")";return t.match(g(O[0]+f+M+O[1]+Y+O[0]+O[2]+f+O[1]))?t[0]().replace(g(O[0]+h(o)+D+O[1],"g"),z[0]+i+"$1"+z[1]).replace(g(O[0]+O[2]+h(o)+O[1],"g"),z[0]+z[2]+i+z[1])[1]():A(e,n,$.li),!1}},table:function(e,t){var N,B,H,I,n=E.tr,r=E.td,i=T.modals.table,o=T.placeholders.table,f=b(x(o[0],[1,1])),u=k.advance_table?L:"",l=$.table,s=$.caption,a=$.thead,c=$.tbody,d=$.tfoot,p=$.tr,h=$.th,g=$.td,w=P(l),_=P(s),C=P(a),O=P(c),S=P(d),j=P(p),M=P(h),D=P(g),Y=[];return t[0]().$().value===f?(t.select(),!1):(m.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,k,E){B=v(y(k)||E,r[0],r[1]),m.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,k){H=v(y(r)||k,n[0],n[1]),m.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,v,y,k,E,r="";for(I=W(n),i=0;H>i;++i){for(N=u+L+z[0]+p+z[1]+"\n",v=0;B>v;++v)N+=u+L+L+z[0]+g+z[1]+b(x(o[1],[i+1,v+1]))+z[0]+z[2]+D+z[1]+"\n";N+=u+L+z[0]+z[2]+j+z[1],Y.push(N)}for(Y=Y.join("\n"),N=L+(u?z[0]+a+z[1]+"\n"+L+L+z[0]+p+z[1]:z[0]+j+z[1])+"\n",y=0;B>y;++y)N+=u+L+L+z[0]+h+z[1]+b(x(o[0],[1,y+1]))+z[0]+z[2]+M+z[1]+"\n";if(u){for(r+=L+z[0]+d+z[1]+"\n",r+=L+L+z[0]+p+z[1]+"\n",y=0;B>y;++y)r+=L+L+L+z[0]+g+z[1]+b(x(o[2],[1,y+1]))+z[0]+z[2]+D+z[1]+"\n";r+=L+L+z[0]+z[2]+p+z[1]+"\n",r+=L+z[0]+z[2]+S+z[1]+"\n"}N+=u+L+z[0]+z[2]+j+z[1]+(u?"\n"+L+z[0]+z[2]+C+z[1]+"\n"+r+L+z[0]+c+z[1]:"")+"\n",Y=N+Y+(u?"\n"+L+z[0]+z[2]+O+z[1]:"")+"\n",t.tidy("\n\n").insert(z[0]+l+z[1]+"\n"+(I&&s?L+z[0]+s+z[1]+I+z[0]+z[2]+_+z[1]+"\n":"")+Y+z[0]+z[2]+w+z[1]),k=t.$(),E=k.start+k.value.indexOf(f),t.select(E,E+f.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=I(t.$().before);return t.tidy("\n\n","").insert(n+z[0]+$.hr+j+"\n\n",0),!1}}}),k.keys&&d(m.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=I(t.$().before);return t.tidy("\n","").insert(n+z[0]+$.br+j+"\n",0),!1},enter:function(e,t){var d,p,v,n=t.$(),r=n.value,i=t.get(),o=$.p,f=$.li,u=P(o),l=P(f),a=(I(n.before),N[""]),c=m.tools;if(!r||r===a){if(d=n.after.match(g("^\\s*"+O[0]+O[2]+"("+h(u)+"|"+h(l)+")"+O[1])))p=d[1],(c[p===l?H:p]||c.ul).click(e,t);else{if(!(B&&o&&b(i)&&n.end===i.length&&g("^\\s*[^"+O[0]+"\\n]*?[^"+O[1]+"]\\s*$").test(i)))return;i=z[0]+o+z[1]+i+z[0]+z[2]+u+z[1]+"\n"+z[0]+o+z[1],v=a+z[0]+z[2]+u+z[1],t.set(i+v).select(i.length,(i+a).length)}return!1}},tab:function(e,t){var n=t.$(),r=$.li,i=P(r),o=I(n.before);return g(O[0]+O[2]+h(i)+O[1]).test(n.after)?(t[0]().wrap("\n"+o+L+z[0]+($[H]||H)+z[1]+"\n"+o+L+L+z[0]+r+z[1],z[0]+z[2]+i+z[1]+"\n"+o+L+z[0]+z[2]+H+z[1]+"\n"+o).insert(N[""])[1](),!1):m.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,f=n.after,u=O[0]+"[^"+O[0]+O[1]+"]+?"+O[1];return!r&&g(u+"$").test(o)?(i=o.split(z[0]).pop().match(g("^([^"+O[2]+"\\s]+).*?"+O[1]+"$")),i=i&&i[1]||0,i&&g("^\\s*"+O[0]+O[2]+h(i)+O[1]).test(f)?t.unwrap(g(O[0]+h(i)+M+O[1]),g("\\s*"+O[0]+O[2]+h(i)+O[1])):t.outdent(g(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),a.update({},0)};