/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function I(e){return e.split(m("("+A[3]+")+"))[0]}function B(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function Y(e,t,r){var d,n=a.$(),i=n.value,o=n.before,u=E[t]||t,f=E[r]||r,l=I(u),c=I(f),s=B(o),p=O[""];return M=u,a[0](),i&&i!==p?(a.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,S[0]+S[2]+c+S[1]+"\n"+C+S[0]+f+S[1]).wrap(S[0]+u+S[1]+"\n"+C+S[0]+f+S[1],S[0]+S[2]+c+S[1]+"\n"+S[0]+S[2]+l+S[1]+"\n\n",1).replace(m("\\n"+h(C)+K[0]+h(f)+K[1]+"\\s*"+K[0]+K[2]+h(c)+K[1]+"\\n","g"),"\n"+S[0]+S[2]+l+S[1]+"\n\n"+S[0]+u+S[1]+"\n").select(a.$().end),W&&b.tools.p.click(e,a),a[1](),!1):void((d=o.match(m("(?:^|\\n)[\\t ]+"+K[0]+"("+K[2]+"?)(?:"+h(I(E.ul))+"|"+h(I(E.ol))+")"+L+K[1]+"\\s*$")))?a.insert("\n"+s+(d[1]?"":C),0):(d=o.match(m(K[0]+h(c)+H+K[1]+".*?$")))?m(K[0]+K[2]+h(c)+K[1]+"\\s*$").test(o)?a.tidy("\n"+s,!1).insert(p).wrap(S[0]+c+d[1]+S[1],S[0]+S[2]+c+S[1]):m(K[1]+"\\s*$").test(o)?a.insert(p).wrap("\n"+s+C+S[0]+u+S[1]+"\n"+s+C+C+S[0]+c+d[1]+S[1],S[0]+S[2]+c+S[1]+"\n"+s+C+S[0]+S[2]+l+S[1]+"\n"+s):a.insert(S[0]+S[2]+c+S[1]+"\n"+s+S[0]+c+d[1]+S[1],0).insert(p):m(K[0]+K[2]+h(c)+K[1]+"\\s*$").test(o)?a.insert(p).wrap("\n"+s+S[0]+f+S[1],S[0]+S[2]+c+S[1]):a.tidy("\n\n").insert(p).wrap(S[0]+u+S[1]+"\n"+C+S[0]+f+S[1],S[0]+S[2]+c+S[1]+"\n"+S[0]+S[2]+l+S[1]))}function P(e,t){return!t.get(0)&&W&&b.tools.p.click(e,t),t}function U(e){return g(e.replace(/\s+/g," "))}function X(e){return x(U(e),[m(K[0]+".*?"+K[1],"g"),'"',"'"],["","&#34;","&#39;"])}function N(e){return x(U(e),[m(K[0]+".*?"+K[1],"g"),/\s/g,'"'],["","%20","%22"])}var M,r="–",n="…",i="↑",o="↓",u="↵",f="⌘",l="✘",c="⇧",a=new TE(e),s=a._,p=s.extend,d=s.each,h=s.x,g=s.trim,v=s.edge,m=s.pattern,y=s.i,b=a.ui(p({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",l],b:["Bold",f+"+B"],i:["Italic",f+"+I"],u:["Underline",f+"+U"],s:["Strike",f+"+"+l],a:["Link",f+"+L"],img:["Image",f+"+G"],sub:["Subscript",f+"+"+o],sup:["Superscript",f+"+"+i],abbr:["Abbreviation",f+"+"+c+"+?"],p:["Paragraph",f+"+"+u],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",f+"+H"],"blockquote,q":["Quote",f+"+Q"],"pre,code":["Code",f+"+K"],ul:["Unordered List",f+"+-"],ol:["Ordered List",f+"++"],table:["Table",f+"+T"],hr:["Horizontal Rule",f+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),w=s.format,x=s.replace,$=a.config,k=$.states,_=$.languages,E=$.formats,C=($.classes,$.tab),S=$.unit[0][0],z=$.unit[0][1],K=$.unit[1][0],A=$.unit[1][1],j=$.suffix,L="(?:"+A[3]+"[^"+K[0]+K[1]+"]*?)?",H="(|"+A[3]+"[^"+K[0]+K[1]+"]*?)",R="([\\s\\S]*?)",O=_.placeholders,W=$.auto_p;return a.type="HTML",p(b.tools,{clear:{i:"eraser",click:function(e,t){var u,r=t[0]().$(),n=r.before,i=r.after,o=r.value,f=K[0]+"[^"+K[0]+K[1]+"]+?"+K[1],l=K[0]+"[^"+K[2]+K[0]+K[1]+"]+?"+K[1],c=K[0]+K[2]+"[^"+K[0]+K[1]+"]+?"+K[1];return!o&&i&&(u=m("^"+f)).test(i)?(t.replace(u,"",1),!1):(m(f).test(o)||n.slice(-1)===S[1]||i[0]===S[0]?t.replace(m(f,"g"),"").unwrap(m(l),m(c)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return P(e,t).i().format(E.b),!1}},i:{i:"italic",click:function(e,t){return P(e,t).i().format(E.i),!1}},u:{i:"underline",click:function(e,t){return P(e,t).i().format(E.u),!1}},s:{i:"strikethrough",click:function(e,t){return P(e,t).i().format(w(E.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,r=E.a,n=_.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,u){u=N(u),i=u;var l,c,f=location.host;-1!==i.indexOf("://")&&(l=1),""!==f&&-1!==i.indexOf("://"+f)&&(l=0),/^([.\/?&#]|javascript:)/.test(i)&&(l=0),b.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){o=X(n),P(e,t).$().length||t.insert(O[""]),c=$.advance_a&&l?w("%4rel%1%2nofollow%3%4target%1%2_blank%3",z):"",t.i().format(w(r+"%4href%1%2"+i+"%3",z)+(o?w("%4title%1%2"+o+"%3",z):"")+c)})}),!1}},img:{i:"image",click:function(e,t){var c,a,r=t.$(),n=E.img,i=E.figure,o=E.figcaption,u=r.value,f=_.modals.img,l=$.advance_img;return b.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,r){r=N(r),c=r,b.prompt(["img[title]",f.title[l?2:1]],f.placeholder[l?2:1],0,function(e,t,r){a=X(r),u||(u=c.split(/[\/\\\\]/).pop()),u=X(u),t[0](),l&&a?(t.tidy("\n\n","").insert(S[0]+i+S[1]+"\n"+C+S[0]+n+w("%4alt%1%2"+u+"%3%4src%1%2"+c+"%3",z)+j+"\n"+C+S[0]+o+S[1]+a+S[0]+S[2]+I(o)+S[1]+"\n"+S[0]+S[2]+I(i)+S[1]+"\n\n",0,1),W&&b.tools.p.click(e,t)):P(e,t).tidy(m(K[0]+"[^"+K[0]+K[1]+K[2]+"]+?"+K[1]+"\\s*$").test(t.$().before)?"":" ","").insert(S[0]+n+w("%4alt%1%2"+u+"%3%4src%1%2"+c+"%3",z)+(a?w("%4title%1%2"+a+"%3",z):"")+j+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=E.sub,n=E.sup,i=I(n);return P(e,t)[0]().unwrap(m(K[0]+h(i)+L+K[1]),S[0]+S[2]+i+S[1]).i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=E.sub,n=E.sup,i=I(r);return P(e,t)[0]().unwrap(m(K[0]+h(i)+L+K[1]),S[0]+S[2]+i+S[1]).i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var d,v,r=t.$(),n=g(r.value),i=_.modals.abbr,o=t.get(),u=g(n||O[""]),f=E.abbr,l=I(f),c=K[0]+h(f)+H+K[1],a=K[0]+h(f)+L+K[1],s=K[0]+K[2]+h(l)+K[1],p=m(c+R+s);return o.replace(p,function(e,t,r){(r=g(r))&&(k.abbr[r]=(t.match(m(w("%4+title%1%2\\s*(.*?)\\s*%3",A)))||["",""])[1])}),d=k.abbr,n&&d[n]?(t.i().format(f+w("%4title%1%2"+d[n]+"%3",z)),!1):(t.record().ui.prompt(["abbr[title]",i.title],d[u]||i.placeholder,!d[n],function(e,t,r,i){r=X(r||i),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(v in d)if(X(d[v])===r){t.insert(v);break}P(e,t).unwrap(m(a),m(s)).unwrap(m(a),m(s),1).i().format(f+w("%4title%1%2"+r+"%3",z))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,r=t.$(),n=r.value,i=E.p,o=E.br,u=I(i),f=I(o),l=r.before,c=r.after,a=B(l),s=O[""];if(t[0](),n&&-1!==n.indexOf("\n")){var d=m("^(?:\\s*"+K[0]+h(u)+L+K[1]+"\\s*)+"+R+"(?:\\s*"+K[0]+K[2]+h(u)+K[1]+"\\s*)+$");d.test(n)?t.replace(d,"$1").replace(m("\\s*"+K[0]+K[2]+h(u)+K[1]+"\\s*"+K[0]+h(u)+L+K[1]+"\\s*","g"),"\n\n").replace(m("\\s*"+K[0]+h(f)+L+K[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+S[0]+o+j+"\n").replace(m("(\\s*"+K[0]+h(f)+L+j+"\\s*){2,}","g"),S[0]+S[2]+u+S[1]+"\n"+S[0]+i+S[1]).wrap(S[0]+i+S[1],S[0]+S[2]+u+S[1],1).replace(m("("+K[0]+h(u)+L+K[1]+")+","g"),"$1").replace(m("("+K[0]+K[2]+h(u)+K[1]+")+","g"),"$1").tidy("\n")}else m("^\\s*"+K[0]+K[2]+h(u)+K[1]).test(c)?m(K[0]+h(u)+L+K[1]+"\\s*$").test(l)?t.unwrap(m("\\s*"+K[0]+h(u)+L+K[1]+"\\s*"),m("\\s*"+K[0]+K[2]+h(u)+K[1])).replace(s,"").tidy("\n","\n"+a):(p=l.match(m(K[0]+h(u)+H+K[1]+".*?$")))&&t.wrap(S[0]+S[2]+u+S[1]+"\n"+a+S[0]+u+p[1]+S[1],"").insert(s):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[E.p,E.h1,E.h2,E.h3,E.h4,E.h5,E.h6],i=[];d(n,function(e,t){i[t]=I(e)});var u=(h(n).join("|"),h(i).join("|")),f="\\s*"+K[0]+"("+u+")"+H+K[1]+"\\s*",l=m("\\s*"+K[0]+"(?:"+u+")"+L+K[1]+"\\s*"),c=m("\\s*"+K[0]+K[2]+"(?:"+u+")"+K[1]+"\\s*"),a=r.value.match(m("^"+f));a||(a=r.before.match(m(f+"$"))||[]);var s=a[2]||"",p=+(a[1]||"h0").slice(1);return t[0]().unwrap(l,c).unwrap(l,c,1).i().tidy("\n\n").format(p>5?i[0]+s:i[p+1]+s,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var r=t.$(),n=r.value,i=E.blockquote,o=E.q,u=E.p,f=I(u),l=K[0]+h(f)+L+K[1];if(m("(^|\\n|"+l+")$").test(r.before)){if(W&&(n===O[""]||m("("+l+")$").test(r.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),W&&(!n||t.match(m("^[^"+K[0]+"\\n]*?[^"+K[1]+"]$"))?t.wrap(C+S[0]+u+S[1],S[0]+S[2]+f+S[1]):t[m("((^|\\n)"+h(C)+")+").test(n)?"outdent":"indent"](C)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function g(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function v(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,i=$.auto_encode_html,o=E.pre,u=E.code,f=I(o),l=I(u),c=K[0]+h(f)+L+K[1]+"\\s*"+K[0]+h(l)+L+K[1]+"\\s*",a="\\s*"+K[0]+K[2]+h(l)+K[1]+"\\s*"+K[0]+K[2]+h(f)+K[1],s=m(c+"\\s*$"),p=m("^\\s*"+a),d=m("^"+R+"$");return m("(^|\\n|"+c+")$").test(r.before)?s.test(r.before)&&p.test(r.after)?t[0]().unwrap(m(s),m(p)).replace(d,v)[1]():t[0]().tidy("\n\n").wrap(S[0]+o+S[1]+S[0]+u+S[1],S[0]+S[2]+l+S[1]+S[0]+S[2]+f+S[1]).insert(n||O[""]).replace(d,g)[1]():t[0]().format(u).loss().replace(d,function(e){return U(m("^\\s*"+K[0]+K[2]+h(l)+K[1]).test(t.$().after)?g(e):v(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=E.ol,n=E.ul,i=I(r),o=I(n),u="("+h(o)+"|"+h(i)+")";return t.match(m(K[0]+u+L+K[1]+R+K[0]+K[2]+u+K[1]))?t[0]().replace(m(K[0]+h(i)+H+K[1],"g"),S[0]+o+"$1"+S[1]).replace(m(K[0]+K[2]+h(i)+K[1],"g"),S[0]+S[2]+o+S[1])[1]():Y(e,n,E.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=E.ol,n=E.ul,i=I(r),o=I(n),u="("+h(o)+"|"+h(i)+")";return t.match(m(K[0]+u+L+K[1]+R+K[0]+K[2]+u+K[1]))?t[0]().replace(m(K[0]+h(o)+H+K[1],"g"),S[0]+i+"$1"+S[1]).replace(m(K[0]+K[2]+h(o)+K[1],"g"),S[0]+S[2]+i+S[1])[1]():Y(e,r,E.li),!1}},table:function(e,t){var O,W,M,B,r=k.tr,n=k.td,i=_.modals.table,o=_.placeholders.table,u=g(w(o[0],[1,1])),f=$.advance_table?C:"",l=E.table,c=E.caption,a=E.thead,s=E.tbody,p=E.tfoot,d=E.tr,h=E.th,m=E.td,x=I(l),T=I(c),z=I(a),K=I(s),A=I(p),j=I(d),L=I(h),H=I(m),R=[];return t[0]().$().value===u?(t.select(),!1):(b.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,$,k){W=v(y($)||k,n[0],n[1]),b.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,$){M=v(y(n)||$,r[0],r[1]),b.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,r){var i,v,y,$,k,n="";for(B=U(r),i=0;M>i;++i){for(O=f+C+S[0]+d+S[1]+"\n",v=0;W>v;++v)O+=f+C+C+S[0]+m+S[1]+g(w(o[1],[i+1,v+1]))+S[0]+S[2]+H+S[1]+"\n";O+=f+C+S[0]+S[2]+j+S[1],R.push(O)}for(R=R.join("\n"),O=C+(f?S[0]+a+S[1]+"\n"+C+C+S[0]+d+S[1]:S[0]+j+S[1])+"\n",y=0;W>y;++y)O+=f+C+C+S[0]+h+S[1]+g(w(o[0],[1,y+1]))+S[0]+S[2]+L+S[1]+"\n";if(f){for(n+=C+S[0]+p+S[1]+"\n",n+=C+C+S[0]+d+S[1]+"\n",y=0;W>y;++y)n+=C+C+C+S[0]+m+S[1]+g(w(o[2],[1,y+1]))+S[0]+S[2]+H+S[1]+"\n";n+=C+C+S[0]+S[2]+d+S[1]+"\n",n+=C+S[0]+S[2]+A+S[1]+"\n"}O+=f+C+S[0]+S[2]+j+S[1]+(f?"\n"+C+S[0]+S[2]+z+S[1]+"\n"+n+C+S[0]+s+S[1]:"")+"\n",R=O+R+(f?"\n"+C+S[0]+S[2]+K+S[1]:"")+"\n",t.tidy("\n\n").insert(S[0]+l+S[1]+"\n"+(B&&c?C+S[0]+c+S[1]+B+S[0]+S[2]+T+S[1]+"\n":"")+R+S[0]+S[2]+x+S[1]),$=t.$(),k=$.start+$.value.indexOf(u),t.select(k,k+u.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=B(t.$().before);return t.tidy("\n\n","").insert(r+S[0]+E.hr+j+"\n\n",0),!1}}}),$.keys&&p(b.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=B(t.$().before);return t.tidy("\n","").insert(r+S[0]+E.br+j+"\n",0),!1},enter:function(e,t){var p,d,v,r=t.$(),n=r.value,i=t.get(),o=E.p,u=E.li,f=I(o),l=I(u),a=(B(r.before),O[""]),s=b.tools;if(!n||n===a){if(p=r.after.match(m("^\\s*"+K[0]+K[2]+"("+h(f)+"|"+h(l)+")"+K[1])))d=p[1],(s[d===l?M:d]||s.ul).click(e,t);else{if(!(W&&o&&g(i)&&r.end===i.length&&m("^\\s*[^"+K[0]+"\\n]*?[^"+K[1]+"]\\s*$").test(i)))return;i=S[0]+o+S[1]+i+S[0]+S[2]+f+S[1]+"\n"+S[0]+o+S[1],v=a+S[0]+S[2]+f+S[1],t.set(i+v).select(i.length,(i+a).length)}return!1}},tab:function(e,t){var r=t.$(),n=E.li,i=I(n),o=B(r.before);return m(K[0]+K[2]+h(i)+K[1]).test(r.after)?(t[0]().wrap("\n"+o+C+S[0]+(E[M]||M)+S[1]+"\n"+o+C+C+S[0]+n+S[1],S[0]+S[2]+i+S[1]+"\n"+o+C+S[0]+S[2]+M+S[1]+"\n"+o).insert(O[""])[1](),!1):b.tools.indent.click(e,t)},backspace:function(e,t){var i,r=t.$(),n=r.value,o=r.before,u=r.after,f=K[0]+"[^"+K[0]+K[1]+"]+?"+K[1];return!n&&m(f+"$").test(o)?(i=o.split(S[0]).pop().match(m("^([^"+K[2]+"\\s]+).*?"+K[1]+"$")),i=i&&i[1]||0,i&&m("^\\s*"+K[0]+K[2]+h(i)+K[1]).test(u)?t.unwrap(m(K[0]+h(i)+L+K[1]),m("\\s*"+K[0]+K[2]+h(i)+K[1])):t.outdent(m(f)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),a.update({},0)};