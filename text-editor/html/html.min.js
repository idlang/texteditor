/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function j(e){return e.split(g("("+N[3]+")+"))[0]}function Y(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function I(e,t,n){var p,r=s.$(),i=r.value,o=r.before,f=T[t]||t,l=T[n]||n,u=j(f),a=j(l),c=Y(o),d=A[""];return B=f,s[0](),i&&i!==d?(s.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,L[0]+L[2]+a+L[1]+"\n"+z+L[0]+l+L[1]).wrap(L[0]+f+L[1]+"\n"+z+L[0]+l+L[1],L[0]+L[2]+a+L[1]+"\n"+L[0]+L[2]+u+L[1]+"\n\n",1).replace(g("\\n"+h(z)+O[0]+h(l)+O[1]+"\\s*"+O[0]+O[2]+h(a)+O[1]+"\\n","g"),"\n"+L[0]+L[2]+u+L[1]+"\n\n"+L[0]+f+L[1]+"\n").select(s.$().end),q&&y.tools.p.click(e,s),s[1](),!1):void((p=o.match(g("(?:^|\\n)[\\t ]+"+O[0]+"("+O[2]+"?)(?:"+h(j(T.ul))+"|"+h(j(T.ol))+")"+D+O[1]+"\\s*$")))?s.insert("\n"+c+(p[1]?"":z),0):(p=o.match(g(O[0]+h(a)+M+O[1]+".*?$")))?g(O[0]+O[2]+h(a)+O[1]+"\\s*$").test(o)?s.tidy("\n"+c,!1).insert(d).wrap(L[0]+a+p[1]+L[1],L[0]+L[2]+a+L[1]):g(O[1]+"\\s*$").test(o)?s.insert(d).wrap("\n"+c+z+L[0]+f+L[1]+"\n"+c+z+z+L[0]+a+p[1]+L[1],L[0]+L[2]+a+L[1]+"\n"+c+z+L[0]+L[2]+u+L[1]+"\n"+c):s.insert(L[0]+L[2]+a+L[1]+"\n"+c+L[0]+a+p[1]+L[1],0).insert(d):g(O[0]+O[2]+h(a)+O[1]+"\\s*$").test(o)?s.insert(d).wrap("\n"+c+L[0]+l+L[1],L[0]+L[2]+a+L[1]):s.tidy("\n\n").insert(d).wrap(L[0]+f+L[1]+"\n"+z+L[0]+l+L[1],L[0]+L[2]+a+L[1]+"\n"+L[0]+L[2]+u+L[1]))}function P(e,t){return!t.get(0)&&q&&y.tools.p.click(e,t),t}function U(e){return v(e.replace(/\s+/g," "))}function F(e){return x(U(e),[g(O[0]+".*?"+O[1],"g"),'"',"'"],["","&#34;","&#39;"])}function W(e){return x(U(e),[g(O[0]+".*?"+O[1],"g"),/\s/g,'"'],["","%20","%22"])}var B,n="–",r="…",i="↑",o="↓",f="↵",l="⌘",u="✘",a="⇧",s=new TE(e),c=s._,d=c.extend,p=c.each,h=c.x,v=c.trim,b=c.edge,g=c.pattern,m=c.i,y=s.ui(d({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",u],b:["Bold",l+"+B"],i:["Italic",l+"+I"],u:["Underline",l+"+U"],s:["Strike",l+"+"+u],a:["Link",l+"+L"],img:["Image",l+"+G"],sub:["Subscript",l+"+"+o],sup:["Superscript",l+"+"+i],abbr:["Abbreviation",l+"+"+a+"+?"],p:["Paragraph",l+"+"+f],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",l+"+H"],"blockquote,q":["Quote",l+"+Q"],"pre,code":["Code",l+"+K"],ul:["Unordered List",l+"+-"],ol:["Ordered List",l+"++"],table:["Table",l+"+T"],hr:["Horizontal Rule",l+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),w=c.format,x=c.replace,k=s.config,$=k.states,E=k.languages,T=k.formats,z=(k.classes,k.tab),L=k.unit[0][0],C=k.unit[0][1],O=k.unit[1][0],N=k.unit[1][1],S=k.suffix,D="(?:"+N[3]+"[^"+O[0]+O[1]+"]*?)?",M="(|"+N[3]+"[^"+O[0]+O[1]+"]*?)",H="([\\s\\S]*?)",A=E.placeholders,q=k.auto_p;return s.type="HTML",d(y.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return g(O[0]+"[^"+O[0]+O[1]+"]+?"+O[1]).test(r)||n.before.slice(-1)===L[1]||n.after[0]===L[0]?t.replace(g(O[0]+"[^"+O[0]+O[1]+"]+?"+O[1],"g"),"").unwrap(g(O[0]+"[^"+O[2]+O[0]+O[1]+"]+?"+O[1]),g(O[0]+O[2]+"[^"+O[0]+O[1]+"]+?"+O[1])):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return P(e,t).i().format(T.b),!1}},i:{i:"italic",click:function(e,t){return P(e,t).i().format(T.i),!1}},u:{i:"underline",click:function(e,t){return P(e,t).i().format(T.u),!1}},s:{i:"strikethrough",click:function(e,t){return P(e,t).i().format(w(T.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=T.a,r=E.modals.a;return t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,f){f=W(f),i=f;var u,a,l=location.host;-1!==i.indexOf("://")&&(u=1),""!==l&&-1!==i.indexOf("://"+l)&&(u=0),/^([.\/?&#]|javascript:)/.test(i)&&(u=0),y.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=F(r),P(e,t).$().length||t.insert(A[""]),a=k.advance_a&&u?w("%4rel%1%2nofollow%3%4target%1%2_blank%3",C):"",t.i().format(w(n+"%4href%1%2"+i+"%3",C)+(o?w("%4title%1%2"+o+"%3",C):"")+a)})}),!1}},img:{i:"image",click:function(e,t){var a,s,n=t.$(),r=T.img,i=T.figure,o=T.figcaption,f=n.value,l=E.modals.img,u=k.advance_img;return y.prompt(["img[src]",l.title[0]],l.placeholder[0],1,function(e,t,n){n=W(n),a=n,y.prompt(["img[title]",l.title[u?2:1]],l.placeholder[u?2:1],0,function(e,t,n){s=F(n),f||(f=a.split(/[\/\\\\]/).pop()),f=F(f),t[0](),u&&s?(t.tidy("\n\n","").insert(L[0]+i+L[1]+"\n"+z+L[0]+r+w("%4alt%1%2"+f+"%3%4src%1%2"+a+"%3",C)+S+"\n"+z+L[0]+o+L[1]+s+L[0]+L[2]+j(o)+L[1]+"\n"+L[0]+L[2]+j(i)+L[1]+"\n\n",0,1),q&&y.tools.p.click(e,t)):P(e,t).tidy(g(O[0]+"[^"+O[0]+O[1]+O[2]+"]+?"+O[1]+"\\s*$").test(t.$().before)?"":" ","").insert(L[0]+r+w("%4alt%1%2"+f+"%3%4src%1%2"+a+"%3",C)+(s?w("%4title%1%2"+s+"%3",C):"")+S+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=T.sub,r=T.sup,i=j(r);return P(e,t)[0]().unwrap(g(O[0]+h(i)+D+O[1]),L[0]+L[2]+i+L[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=T.sub,r=T.sup,i=j(n);return P(e,t)[0]().unwrap(g(O[0]+h(i)+D+O[1]),L[0]+L[2]+i+L[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var p,b,n=t.$(),r=v(n.value),i=E.modals.abbr,o=t.get(),f=v(r||A[""]),l=T.abbr,u=j(l),a=O[0]+h(l)+M+O[1],s=O[0]+h(l)+D+O[1],c=O[0]+O[2]+h(u)+O[1],d=g(a+H+c);return o.replace(d,function(e,t,n){(n=v(n))&&($.abbr[n]=(t.match(g(w("%4+title%1%2\\s*(.*?)\\s*%3",N)))||["",""])[1])}),p=$.abbr,r&&p[r]?(t.i().format(l+w("%4title%1%2"+p[r]+"%3",C)),!1):(t.record().ui.prompt(["abbr[title]",i.title],p[f]||i.placeholder,!p[r],function(e,t,n,i){n=F(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(b in p)if(F(p[b])===n){t.insert(b);break}P(e,t).unwrap(g(s),g(c)).unwrap(g(s),g(c),1).i().format(l+w("%4title%1%2"+n+"%3",C))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var d,n=t.$(),r=n.value,i=T.p,o=T.br,f=j(i),l=j(o),u=n.before,a=n.after,s=Y(u),c=A[""];if(t[0](),r&&-1!==r.indexOf("\n")){var p=g("^(?:\\s*"+O[0]+h(f)+D+O[1]+"\\s*)+"+H+"(?:\\s*"+O[0]+O[2]+h(f)+O[1]+"\\s*)+$");p.test(r)?t.replace(p,"$1").replace(g("\\s*"+O[0]+O[2]+h(f)+O[1]+"\\s*"+O[0]+h(f)+D+O[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+O[0]+h(l)+D+O[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+L[0]+o+S+"\n").replace(g("(\\s*"+O[0]+h(l)+D+S+"\\s*){2,}","g"),L[0]+L[2]+f+L[1]+"\n"+L[0]+i+L[1]).wrap(L[0]+i+L[1],L[0]+L[2]+f+L[1],1).replace(g("("+O[0]+h(f)+D+O[1]+")+","g"),"$1").replace(g("("+O[0]+O[2]+h(f)+O[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+O[0]+O[2]+h(f)+O[1]).test(a)?g(O[0]+h(f)+D+O[1]+"\\s*$").test(u)?t.unwrap(g("\\s*"+O[0]+h(f)+D+O[1]+"\\s*"),g("\\s*"+O[0]+O[2]+h(f)+O[1])).replace(c,"").tidy("\n","\n"+s):(d=u.match(g(O[0]+h(f)+M+O[1]+".*?$")))&&t.wrap(L[0]+L[2]+f+L[1]+"\n"+s+L[0]+f+d[1]+L[1],"").insert(c):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),r=[T.p,T.h1,T.h2,T.h3,T.h4,T.h5,T.h6],i=[];p(r,function(e,t){i[t]=j(e)});var f=(h(r).join("|"),h(i).join("|")),l="\\s*"+O[0]+"("+f+")"+M+O[1]+"\\s*",u=g("\\s*"+O[0]+"(?:"+f+")"+D+O[1]+"\\s*"),a=g("\\s*"+O[0]+O[2]+"(?:"+f+")"+O[1]+"\\s*"),s=n.value.match(g("^"+l));s||(s=n.before.match(g(l+"$"))||[]);var c=s[2]||"",d=+(s[1]||"h0").slice(1);return t[0]().unwrap(u,a).unwrap(u,a,1).i().tidy("\n\n").format(d>5?i[0]+c:i[d+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var n=t.$(),r=n.value,i=T.blockquote,o=T.q,f=T.p,l=j(f),u=O[0]+h(l)+D+O[1];if(g("(^|\\n|"+u+")$").test(n.before)){if(q&&(r===A[""]||g("("+u+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),q&&(!r||t.match(g("^[^"+O[0]+"\\n]*?[^"+O[1]+"]$"))?t.wrap(z+L[0]+f+L[1],L[0]+L[2]+l+L[1]):t[g("((^|\\n)"+h(z)+")+").test(r)?"outdent":"indent"](z)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function v(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function b(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var n=t.$(),r=n.value,i=k.auto_encode_html,o=T.pre,f=T.code,l=j(o),u=j(f),a=O[0]+h(l)+D+O[1]+"\\s*"+O[0]+h(u)+D+O[1]+"\\s*",s="\\s*"+O[0]+O[2]+h(u)+O[1]+"\\s*"+O[0]+O[2]+h(l)+O[1],c=g(a+"\\s*$"),d=g("^\\s*"+s),p=g("^"+H+"$");return g("(^|\\n|"+a+")$").test(n.before)?c.test(n.before)&&d.test(n.after)?t[0]().unwrap(g(c),g(d)).replace(p,b)[1]():t[0]().tidy("\n\n").wrap(L[0]+o+L[1]+L[0]+f+L[1],L[0]+L[2]+u+L[1]+L[0]+L[2]+l+L[1]).insert(r||A[""]).replace(p,v)[1]():t[0]().format(f).loss().replace(p,function(e){return U(g("^\\s*"+O[0]+O[2]+h(u)+O[1]).test(t.$().after)?v(e):b(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=T.ol,r=T.ul,i=j(n),o=j(r),f="("+h(o)+"|"+h(i)+")";return t.match(g(O[0]+f+D+O[1]+H+O[0]+O[2]+f+O[1]))?t[0]().replace(g(O[0]+h(i)+M+O[1],"g"),L[0]+o+"$1"+L[1]).replace(g(O[0]+O[2]+h(i)+O[1],"g"),L[0]+L[2]+o+L[1])[1]():I(e,r,T.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=T.ol,r=T.ul,i=j(n),o=j(r),f="("+h(o)+"|"+h(i)+")";return t.match(g(O[0]+f+D+O[1]+H+O[0]+O[2]+f+O[1]))?t[0]().replace(g(O[0]+h(o)+M+O[1],"g"),L[0]+i+"$1"+L[1]).replace(g(O[0]+O[2]+h(o)+O[1],"g"),L[0]+L[2]+i+L[1])[1]():I(e,n,T.li),!1}},table:function(e,t){var A,q,B,Y,n=$.tr,r=$.td,i=E.modals.table,o=E.placeholders.table,f=v(w(o[0],[1,1])),l=k.advance_table?z:"",u=T.table,a=T.caption,s=T.thead,c=T.tbody,d=T.tfoot,p=T.tr,h=T.th,g=T.td,x=j(u),_=j(a),C=j(s),O=j(c),N=j(d),S=j(p),D=j(h),M=j(g),H=[];return t.$().value===f?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,k,$){q=b(m(k)||$,r[0],r[1]),y.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,k){B=b(m(r)||k,n[0],n[1]),y.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,b,m,k,$,r="";for(Y=U(n),i=0;B>i;++i){for(A=l+z+L[0]+p+L[1]+"\n",b=0;q>b;++b)A+=l+z+z+L[0]+g+L[1]+v(w(o[1],[i+1,b+1]))+L[0]+L[2]+M+L[1]+"\n";A+=l+z+L[0]+L[2]+S+L[1],H.push(A)}for(H=H.join("\n"),A=z+(l?L[0]+s+L[1]+"\n"+z+z+L[0]+p+L[1]:L[0]+S+L[1])+"\n",m=0;q>m;++m)A+=l+z+z+L[0]+h+L[1]+v(w(o[0],[1,m+1]))+L[0]+L[2]+D+L[1]+"\n";if(l){for(r+=z+L[0]+d+L[1]+"\n",r+=z+z+L[0]+p+L[1]+"\n",m=0;q>m;++m)r+=z+z+z+L[0]+g+L[1]+v(w(o[2],[1,m+1]))+L[0]+L[2]+M+L[1]+"\n";r+=z+z+L[0]+L[2]+p+L[1]+"\n",r+=z+L[0]+L[2]+N+L[1]+"\n"}A+=l+z+L[0]+L[2]+S+L[1]+(l?"\n"+z+L[0]+L[2]+C+L[1]+"\n"+r+z+L[0]+c+L[1]:"")+"\n",H=A+H+(l?"\n"+z+L[0]+L[2]+O+L[1]:"")+"\n",t.tidy("\n\n").insert(L[0]+u+L[1]+"\n"+(Y&&a?z+L[0]+a+L[1]+Y+L[0]+L[2]+_+L[1]+"\n":"")+H+L[0]+L[2]+x+L[1]),k=t.$(),$=k.start+k.value.indexOf(f),t.select($,$+f.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=Y(t.$().before);return t.tidy("\n\n","").insert(n+L[0]+T.hr+S+"\n\n",0),!1}}}),k.keys&&d(y.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=Y(t.$().before);return t.tidy("\n","").insert(n+L[0]+T.br+S+"\n",0),!1},enter:function(e,t){var d,p,b,n=t.$(),r=n.value,i=t.get(),o=T.p,f=T.li,l=j(o),u=j(f),s=(Y(n.before),A[""]),c=y.tools;if(!r||r===s){if(d=n.after.match(g("^\\s*"+O[0]+O[2]+"("+h(l)+"|"+h(u)+")"+O[1])))p=d[1],(c[p===u?B:p]||c.ul).click(e,t);else{if(!(q&&o&&v(i)&&n.end===i.length&&g("^\\s*[^"+O[0]+"\\n]*?[^"+O[1]+"]\\s*$").test(i)))return;i=L[0]+o+L[1]+i+L[0]+L[2]+l+L[1]+"\n"+L[0]+o+L[1],b=s+L[0]+L[2]+l+L[1],t.set(i+b).select(i.length,(i+s).length)}return!1}},tab:function(e,t){var n=t.$(),r=T.li,i=j(r),o=Y(n.before);return g(O[0]+O[2]+h(i)+O[1]).test(n.after)?(t[0]().wrap("\n"+o+z+L[0]+(T[B]||B)+L[1]+"\n"+o+z+z+L[0]+r+L[1],L[0]+L[2]+i+L[1]+"\n"+o+z+L[0]+L[2]+B+L[1]+"\n"+o).insert(A[""])[1](),!1):y.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,f=n.after,l=O[0]+"[^"+O[0]+O[1]+"]+?"+O[1];return!r&&g(l+"$").test(o)?(i=o.split(L[0]).pop().match(g("^([^"+O[2]+"\\s]+).*?"+O[1]+"$")),i=i&&i[1]||0,i&&g("^\\s*"+O[0]+O[2]+h(i)+O[1]).test(f)?t.unwrap(g(O[0]+h(i)+D+O[1]),g("\\s*"+O[0]+O[2]+h(i)+O[1])):t.outdent(g(l)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),s.update({},0)};