/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function U(e){return e.split(g("("+R[3]+")+"))[0]}function D(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function z(e,t,n){var b,i=c.$(),o=i.value,r=i.before,l=x[t]||t,a=x[n]||n,s=U(l),u=U(a),f=D(r),p=F[""];return G=l,c[0](),o&&o!==p?(c.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,L[0]+L[2]+u+L[1]+"\n"+A+L[0]+a+L[1]).wrap(L[0]+l+L[1]+"\n"+A+L[0]+a+L[1],L[0]+L[2]+u+L[1]+"\n"+L[0]+L[2]+s+L[1]+"\n\n",1).replace(g("\\n"+d(A)+I[0]+d(a)+I[1]+"\\s*"+I[0]+I[2]+d(u)+I[1]+"\\n","g"),"\n"+L[0]+L[2]+s+L[1]+"\n\n"+L[0]+l+L[1]+"\n").select(c.$().end),H&&v.tools.p.click(e,c),c[1](),!1):void((b=r.match(g("(?:^|\\n)[\\t ]+"+I[0]+"("+I[2]+"?)(?:"+d(U(x.ul))+"|"+d(U(x.ol))+")"+S+I[1]+"\\s*$")))?c.insert("\n"+f+(b[1]?"":A),0):(b=r.match(g(I[0]+d(u)+C+I[1]+".*?$")))?g(I[0]+I[2]+d(u)+I[1]+"\\s*$").test(r)?c.tidy("\n"+f,!1).insert(p).wrap(L[0]+u+b[1]+L[1],L[0]+L[2]+u+L[1]):g(I[1]+"\\s*$").test(r)?c.insert(p).wrap("\n"+f+A+L[0]+l+L[1]+"\n"+f+A+A+L[0]+u+b[1]+L[1],L[0]+L[2]+u+L[1]+"\n"+f+A+L[0]+L[2]+s+L[1]+"\n"+f):c.insert(L[0]+L[2]+u+L[1]+"\n"+f+L[0]+u+b[1]+L[1],0).insert(p):g(I[0]+I[2]+d(u)+I[1]+"\\s*$").test(r)?c.insert(p).wrap("\n"+f+L[0]+a+L[1],L[0]+L[2]+u+L[1]):c.tidy("\n\n").insert(p).wrap(L[0]+l+L[1]+"\n"+A+L[0]+a+L[1],L[0]+L[2]+u+L[1]+"\n"+L[0]+L[2]+s+L[1]))}function M(e,t){return!t.get(0)&&H&&v.tools.p.click(e,t),t}function B(e){return h(e.replace(/\s+/g," "))}function P(e){return _(B(e),[g(I[0]+".*?"+I[1],"g"),'"',"'"],["","&#34;","&#39;"])}function W(e){return _(B(e),[g(I[0]+".*?"+I[1],"g"),/\s/g,'"'],["","%20","%22"])}var G,n="–",i="…",o="↑",r="↓",l="↵",a="⌘",s="✘",u="⇧",c=new TE(e),f=c._,p=f.extend,b=f.each,d=f.x,h=f.trim,m=f.edge,g=f.pattern,k=f.i,v=c.ui(p({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+s],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+r],sup:["Superscript",a+"+"+o],abbr:["Abbreviation",a+"+"+u+"+?"],p:["Paragraph",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+i]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+i,"image caption here"+i]},abbr:{title:"Abbreviation",placeholder:"meaning here"+i},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+i]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),y=f.format,_=f.replace,w=c.config,E=w.states,T=w.languages,x=w.formats,A=(w.classes,w.tab),L=w.unit[0][0],O=w.unit[0][1],I=w.unit[1][0],R=w.unit[1][1],N=w.suffix,S="(?:"+R[3]+"[^"+I[0]+I[1]+"]*?)?",C="(|"+R[3]+"[^"+I[0]+I[1]+"]*?)",q="([\\s\\S]*?)",F=T.placeholders,H=w.auto_p;return c.type="HTML",p(v.tools,{clear:{i:"eraser",click:function(e,t){var l,n=t[0]().$(),i=n.before,o=n.after,r=n.value,a=I[0]+"[^"+I[0]+I[1]+"]+?"+I[1],s=I[0]+"[^"+I[2]+I[0]+I[1]+"]+?"+I[1],u=I[0]+I[2]+"[^"+I[0]+I[1]+"]+?"+I[1];return!r&&o&&(l=g("^"+a)).test(o)?(t.replace(l,"",1),!1):(g(a).test(r)||i.slice(-1)===L[1]||o[0]===L[0]?t.replace(g(a,"g"),"").unwrap(g(s),g(u)):t.insert(""),t[1](),!!o)}},b:{i:"bold",click:function(e,t){return M(e,t).i().format(x.b),!1}},i:{i:"italic",click:function(e,t){return M(e,t).i().format(x.i),!1}},u:{i:"underline",click:function(e,t){return M(e,t).i().format(x.u),!1}},s:{i:"strikethrough",click:function(e,t){return M(e,t).i().format(y(x.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var o,r,n=x.a,i=T.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,l){l=W(l),o=l;var s,u,a=location.host;-1!==o.indexOf("://")&&(s=1),""!==a&&-1!==o.indexOf("://"+a)&&(s=0),/^([.\/?&#]|javascript:)/.test(o)&&(s=0),v.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=P(i),M(e,t).$().length||t.insert(F[""]),u=w.advance_a&&s?O[3]+"rel"+O[0]+O[1]+"nofollow"+O[2]+O[3]+"target"+O[0]+O[1]+"_blank"+O[2]:"",t.i().format(n+O[3]+"href"+O[0]+O[1]+o+O[2]+(r?O[3]+"title"+O[0]+O[1]+r+O[2]:"")+u)})}),!1}},img:{i:"image",click:function(e,t){var u,c,n=t.$(),i=x.img,o=x.figure,r=x.figcaption,l=n.value,a=T.modals.img,s=w.advance_img;return v.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,n){n=W(n),u=n,v.prompt(["img[title]",a.title[s?2:1]],a.placeholder[s?2:1],0,function(e,t,n){c=P(n),l||(l=u.split(/[\/\\\\]/).pop()),l=P(l),t[0](),s&&c?(t.tidy("\n\n","").insert(L[0]+o+L[1]+"\n"+A+L[0]+i+O[3]+"alt"+O[0]+O[1]+l+O[2]+O[3]+"src"+O[0]+O[1]+u+O[2]+N+"\n"+A+L[0]+r+L[1]+c+L[0]+L[2]+U(r)+L[1]+"\n"+L[0]+L[2]+U(o)+L[1]+"\n\n",0,1),H&&v.tools.p.click(e,t)):M(e,t).tidy(g(I[0]+"[^"+I[0]+I[1]+I[2]+"]+?"+I[1]+"\\s*$").test(t.$().before)?"":" ","").insert(L[0]+i+O[3]+"alt"+O[0]+O[1]+l+O[2]+O[3]+"src"+O[0]+O[1]+u+O[2]+(c?O[3]+"title"+O[0]+O[1]+c+O[2]:"")+N+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=x.sub,i=x.sup,o=U(i);return M(e,t)[0]().unwrap(g(I[0]+d(o)+S+I[1]),L[0]+L[2]+o+L[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=x.sub,i=x.sup,o=U(n);return M(e,t)[0]().unwrap(g(I[0]+d(o)+S+I[1]),L[0]+L[2]+o+L[1]).i().format(i)[1](),!1}},abbr:{i:"question",click:function(e,t){var b,m,n=t.$(),i=h(n.value),o=T.modals.abbr,r=t.get(),l=h(i||F[""]),a=x.abbr,s=U(a),u=I[0]+d(a)+C+I[1],c=I[0]+d(a)+S+I[1],f=I[0]+I[2]+d(s)+I[1],p=g(u+q+f);return r.replace(p,function(e,t,n){(n=h(n))&&(E.abbr[n]=(t.match(g(R[3]+"+title"+R[0]+R[1]+"\\s*(.*?)\\s*"+R[2]))||["",""])[1])}),b=E.abbr,i&&b[i]?(t.i().format(a+O[3]+"title"+O[0]+O[1]+b[i]+O[2]),!1):(t.record().ui.prompt(["abbr[title]",o.title],b[l]||o.placeholder,!b[i],function(e,t,n,o){n=P(n||o),t[0](),i||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(m in b)if(P(b[m])===n){t.insert(m);break}M(e,t).unwrap(g(c),g(f)).unwrap(g(c),g(f),1).i().format(a+O[3]+"title"+O[0]+O[1]+n+O[2])[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,n=t.$(),i=n.value,o=x.p,r=x.br,l=U(o),a=U(r),s=n.before,u=n.after,c=D(s),f=F[""];if(t[0](),i&&-1!==i.indexOf("\n")){var b=g("^(?:\\s*"+I[0]+d(l)+S+I[1]+"\\s*)+"+q+"(?:\\s*"+I[0]+I[2]+d(l)+I[1]+"\\s*)+$");b.test(i)?t.replace(b,"$1").replace(g("\\s*"+I[0]+I[2]+d(l)+I[1]+"\\s*"+I[0]+d(l)+S+I[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+I[0]+d(a)+S+I[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+L[0]+r+N+"\n").replace(g("(\\s*"+I[0]+d(a)+S+N+"\\s*){2,}","g"),L[0]+L[2]+l+L[1]+"\n"+L[0]+o+L[1]).wrap(L[0]+o+L[1],L[0]+L[2]+l+L[1],1).replace(g("("+I[0]+d(l)+S+I[1]+")+","g"),"$1").replace(g("("+I[0]+I[2]+d(l)+I[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+I[0]+I[2]+d(l)+I[1]).test(u)?g(I[0]+d(l)+S+I[1]+"\\s*$").test(s)?t.unwrap(g("\\s*"+I[0]+d(l)+S+I[1]+"\\s*"),g("\\s*"+I[0]+I[2]+d(l)+I[1])).replace(f,"").tidy("\n","\n"+c):(p=s.match(g(I[0]+d(l)+C+I[1]+".*?$")))&&t.wrap(L[0]+L[2]+l+L[1]+"\n"+c+L[0]+l+p[1]+L[1],"").insert(f):t.tidy("\n\n").format(o,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),i=[x.p,x.h1,x.h2,x.h3,x.h4,x.h5,x.h6],o=[];b(i,function(e,t){o[t]=U(e)});var l=(d(i).join("|"),d(o).join("|")),a="\\s*"+I[0]+"("+l+")"+C+I[1]+"\\s*",s=g("\\s*"+I[0]+"(?:"+l+")"+S+I[1]+"\\s*"),u=g("\\s*"+I[0]+I[2]+"(?:"+l+")"+I[1]+"\\s*"),c=n.value.match(g("^"+a));c||(c=n.before.match(g(a+"$"))||[]);var f=c[2]||"",p=+(c[1]||"h0").slice(1);return t[0]().unwrap(s,u).unwrap(s,u,1).i().tidy("\n\n").format(p>5?o[0]+f:o[p+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var n=t.$(),i=n.value,o=x.blockquote,r=x.q,l=x.p,a=U(l),s=I[0]+d(a)+S+I[1];if(g("(^|\\n|"+s+")$").test(n.before)){if(H&&(i===F[""]||g("("+s+")$").test(n.before)))return t.select(),!1;t[0]().format(o,0,"\n\n","\n"),H&&(!i||t.match(g("^[^"+I[0]+"\\n]*?[^"+I[1]+"]$"))?t.wrap(A+L[0]+l+L[1],L[0]+L[2]+a+L[1]):t[g("((^|\\n)"+d(A)+")+").test(i)?"outdent":"indent"](A)),t[1]()}else t.i().format(r);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return o?_(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function m(e){return o?_(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),i=n.value,o=w.auto_encode_html,r=x.pre,l=x.code,a=U(r),s=U(l),u=I[0]+d(a)+S+I[1]+"\\s*"+I[0]+d(s)+S+I[1]+"\\s*",c="\\s*"+I[0]+I[2]+d(s)+I[1]+"\\s*"+I[0]+I[2]+d(a)+I[1],f=g(u+"\\s*$"),p=g("^\\s*"+c),b=g("^"+q+"$");return g("(^|\\n|"+u+")$").test(n.before)?f.test(n.before)&&p.test(n.after)?t[0]().unwrap(g(f),g(p)).replace(b,m)[1]():t[0]().tidy("\n\n").wrap(L[0]+r+L[1]+L[0]+l+L[1],L[0]+L[2]+s+L[1]+L[0]+L[2]+a+L[1]).insert(i||F[""]).replace(b,h)[1]():t[0]().format(l).replace(b,function(e){return B(g("^\\s*"+I[0]+I[2]+d(s)+I[1]).test(t.$().after)?h(e):m(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=x.ol,i=x.ul,o=U(n),r=U(i),l="("+d(r)+"|"+d(o)+")";return t.match(g(I[0]+l+S+I[1]+q+I[0]+I[2]+l+I[1]))?t[0]().replace(g(I[0]+d(o)+C+I[1],"g"),L[0]+r+"$1"+L[1]).replace(g(I[0]+I[2]+d(o)+I[1],"g"),L[0]+L[2]+r+L[1])[1]():z(e,i,x.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=x.ol,i=x.ul,o=U(n),r=U(i),l="("+d(r)+"|"+d(o)+")";return t.match(g(I[0]+l+S+I[1]+q+I[0]+I[2]+l+I[1]))?t[0]().replace(g(I[0]+d(r)+C+I[1],"g"),L[0]+o+"$1"+L[1]).replace(g(I[0]+I[2]+d(r)+I[1],"g"),L[0]+L[2]+o+L[1])[1]():z(e,n,x.li),!1}},table:function(e,t){var F,H,G,D,n=E.tr,i=E.td,o=T.modals.table,r=T.placeholders.table,l=h(y(r[0],[1,1])),a=w.advance_table?A:"",s=x.table,u=x.caption,c=x.thead,f=x.tbody,p=x.tfoot,b=x.tr,d=x.th,g=x.td,_=U(s),$=U(u),O=U(c),I=U(f),R=U(p),N=U(b),S=U(d),C=U(g),q=[];return t[0]().$().value===l?(t.select(),!1):(v.prompt(["table>td",o.title[0]],o.placeholder[0],0,function(e,t,w,E){H=m(k(w)||E,i[0],i[1]),v.prompt(["table>tr",o.title[1]],o.placeholder[1],0,function(e,t,i,w){G=m(k(i)||w,n[0],n[1]),v.prompt(["table>caption",o.title[2]],o.placeholder[2],0,function(e,t,n){var o,m,k,w,E,i="";for(D=B(n),o=0;G>o;++o){for(F=a+A+L[0]+b+L[1]+"\n",m=0;H>m;++m)F+=a+A+A+L[0]+g+L[1]+h(y(r[1],[o+1,m+1]))+L[0]+L[2]+C+L[1]+"\n";F+=a+A+L[0]+L[2]+N+L[1],q.push(F)}for(q=q.join("\n"),F=A+(a?L[0]+c+L[1]+"\n"+A+A+L[0]+b+L[1]:L[0]+N+L[1])+"\n",k=0;H>k;++k)F+=a+A+A+L[0]+d+L[1]+h(y(r[0],[1,k+1]))+L[0]+L[2]+S+L[1]+"\n";if(a){for(i+=A+L[0]+p+L[1]+"\n",i+=A+A+L[0]+b+L[1]+"\n",k=0;H>k;++k)i+=A+A+A+L[0]+g+L[1]+h(y(r[2],[1,k+1]))+L[0]+L[2]+C+L[1]+"\n";i+=A+A+L[0]+L[2]+b+L[1]+"\n",i+=A+L[0]+L[2]+R+L[1]+"\n"}F+=a+A+L[0]+L[2]+N+L[1]+(a?"\n"+A+L[0]+L[2]+O+L[1]+"\n"+i+A+L[0]+f+L[1]:"")+"\n",q=F+q+(a?"\n"+A+L[0]+L[2]+I+L[1]:"")+"\n",t.tidy("\n\n").insert(L[0]+s+L[1]+"\n"+(D&&u?A+L[0]+u+L[1]+D+L[0]+L[2]+$+L[1]+"\n":"")+q+L[0]+L[2]+_+L[1]),w=t.$(),E=w.start+w.value.indexOf(l),t.select(E,E+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=D(t.$().before);return t.tidy("\n\n","").insert(n+L[0]+x.hr+N+"\n\n",0),!1}}}),w.keys&&p(v.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=D(t.$().before);return t.tidy("\n","").insert(n+L[0]+x.br+N+"\n",0),!1},enter:function(e,t){var p,b,m,n=t.$(),i=n.value,o=t.get(),r=x.p,l=x.li,a=U(r),s=U(l),c=(D(n.before),F[""]),f=v.tools;if(!i||i===c){if(p=n.after.match(g("^\\s*"+I[0]+I[2]+"("+d(a)+"|"+d(s)+")"+I[1])))b=p[1],(f[b===s?G:b]||f.ul).click(e,t);else{if(!(H&&r&&h(o)&&n.end===o.length&&g("^\\s*[^"+I[0]+"\\n]*?[^"+I[1]+"]\\s*$").test(o)))return;o=L[0]+r+L[1]+o+L[0]+L[2]+a+L[1]+"\n"+L[0]+r+L[1],m=c+L[0]+L[2]+a+L[1],t.set(o+m).select(o.length,(o+c).length)}return!1}},tab:function(e,t){var n=t.$(),i=x.li,o=U(i),r=D(n.before);return g(I[0]+I[2]+d(o)+I[1]).test(n.after)?(t[0]().wrap("\n"+r+A+L[0]+(x[G]||G)+L[1]+"\n"+r+A+A+L[0]+i+L[1],L[0]+L[2]+o+L[1]+"\n"+r+A+L[0]+L[2]+G+L[1]+"\n"+r).insert(F[""])[1](),!1):v.tools.indent.click(e,t)},backspace:function(e,t){var o,n=t.$(),i=n.value,r=n.before,l=n.after,a=I[0]+"[^"+I[0]+I[1]+"]+?"+I[1];return!i&&g(a+"$").test(r)?(o=r.split(L[0]).pop().match(g("^([^"+I[2]+"\\s]+).*?"+I[1]+"$")),o=o&&o[1]||0,o&&g("^\\s*"+I[0]+I[2]+d(o)+I[1]).test(l)?t.unwrap(g(I[0]+d(o)+S+I[1]),g("\\s*"+I[0]+I[2]+d(o)+I[1])):t.outdent(g(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),c.update({},0)};