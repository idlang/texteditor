/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function k(e){return e.split(L("("+m[3]+")+"))[0]}function w(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function K(e,t,n){var E,r=s.$(),i=r.value,o=r.before,a=h[t]||t,l=h[n]||n,f=k(a),u=k(l),A=w(o),c=y[""];return v=a,s[0](),i&&i!==c?(s.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,H[0]+H[2]+u+H[1]+"\n"+p+H[0]+l+H[1]).wrap(H[0]+a+H[1]+"\n"+p+H[0]+l+H[1],H[0]+H[2]+u+H[1]+"\n"+H[0]+H[2]+f+H[1]+"\n\n",1).replace(L("\\n"+O(p)+M[0]+O(l)+M[1]+"\\s*"+M[0]+M[2]+O(u)+M[1]+"\\n","g"),"\n"+H[0]+H[2]+f+H[1]+"\n\n"+H[0]+a+H[1]+"\n").select(s.$().end),U&&S.tools.p.click(e,s),s[1](),!1):void((E=o.match(L("(?:^|\\n)[\\t ]+"+M[0]+"("+M[2]+"?)(?:"+O(k(h.ul))+"|"+O(k(h.ol))+")"+W+M[1]+"\\s*$")))?s.insert("\n"+A+(E[1]?"":p),0):(E=o.match(L(M[0]+O(u)+P+M[1]+".*?$")))?L(M[0]+M[2]+O(u)+M[1]+"\\s*$").test(o)?s.tidy("\n"+A,!1).insert(c).wrap(H[0]+u+E[1]+H[1],H[0]+H[2]+u+H[1]):L(M[1]+"\\s*$").test(o)?s.insert(c).wrap("\n"+A+p+H[0]+a+H[1]+"\n"+A+p+p+H[0]+u+E[1]+H[1],H[0]+H[2]+u+H[1]+"\n"+A+p+H[0]+H[2]+f+H[1]+"\n"+A):s.insert(H[0]+H[2]+u+H[1]+"\n"+A+H[0]+u+E[1]+H[1],0).insert(c):L(M[0]+M[2]+O(u)+M[1]+"\\s*$").test(o)?s.insert(c).wrap("\n"+A+H[0]+l+H[1],H[0]+H[2]+u+H[1]):s.tidy("\n\n").insert(c).wrap(H[0]+a+H[1]+"\n"+p+H[0]+l+H[1],H[0]+H[2]+u+H[1]+"\n"+H[0]+H[2]+f+H[1]))}function x(e,t){return!t.get(0)&&U&&S.tools.p.click(e,t),t}function Y(e){return R(e.replace(/\s+/g," "))}function V(e){return N(Y(e),[L(M[0]+".*?"+M[1],"g"),'"',"'"],["","&#34;","&#39;"])}function $(e){return N(Y(e),[L(M[0]+".*?"+M[1],"g"),/\s/g,'"'],["","%20","%22"])}var v,n="–",r="…",i="↑",o="↓",a="↵",l="⌘",f="✘",u="⇧",s=new TE(e),A=s._,c=A.extend,E=A.each,O=A.x,R=A.trim,I=A.edge,L=A.pattern,F=A.i,S=s.ui(c({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",f],b:["Bold",l+"+B"],i:["Italic",l+"+I"],u:["Underline",l+"+U"],s:["Strike",l+"+"+f],a:["Link",l+"+L"],img:["Image",l+"+G"],sub:["Subscript",l+"+"+o],sup:["Superscript",l+"+"+i],abbr:["Abbreviation",l+"+"+u+"+?"],p:["Paragraph",l+"+"+a],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",l+"+H"],"blockquote,q":["Quote",l+"+Q"],"pre,code":["Code",l+"+K"],ul:["Unordered List",l+"+-"],ol:["Ordered List",l+"++"],table:["Table",l+"+T"],hr:["Horizontal Rule",l+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),T=A.format,N=A.replace,d=s.config,C=d.states,g=d.languages,h=d.formats,p=(d.classes,d.tab),H=d.unit[0][0],D=d.unit[0][1],M=d.unit[1][0],m=d.unit[1][1],B=d.suffix,W="(?:"+m[3]+"[^"+M[0]+M[1]+"]*?)?",P="(|"+m[3]+"[^"+M[0]+M[1]+"]*?)",b="([\\s\\S]*?)",y=g.placeholders,U=d.auto_p;return s.type="HTML",c(S.tools,{clear:{i:"eraser",click:function(e,t){var a,n=t[0]().$(),r=n.before,i=n.after,o=n.value,l=M[0]+"[^"+M[0]+M[1]+"]+?"+M[1],f=M[0]+"[^"+M[2]+M[0]+M[1]+"]+?"+M[1],u=M[0]+M[2]+"[^"+M[0]+M[1]+"]+?"+M[1];return!o&&i&&(a=L("^"+l)).test(i)?(t.replace(a,"",1),!1):(L(l).test(o)||r.slice(-1)===H[1]||i[0]===H[0]?t.replace(L(l,"g"),"").unwrap(L(f),L(u)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return x(e,t).i().format(h.b),!1}},i:{i:"italic",click:function(e,t){return x(e,t).i().format(h.i),!1}},u:{i:"underline",click:function(e,t){return x(e,t).i().format(h.u),!1}},s:{i:"strikethrough",click:function(e,t){return x(e,t).i().format(T(h.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=h.a,r=g.modals.a;return t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,a){a=$(a),i=a;var f,u,l=location.host;-1!==i.indexOf("://")&&(f=1),""!==l&&-1!==i.indexOf("://"+l)&&(f=0),/^([.\/?&#]|javascript:)/.test(i)&&(f=0),S.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=V(r),x(e,t).$().length||t.insert(y[""]),u=d.advance_a&&f?T("%4rel%1%2nofollow%3%4target%1%2_blank%3",D):"",t.i().format(T(n+"%4href%1%2"+i+"%3",D)+(o?T("%4title%1%2"+o+"%3",D):"")+u)})}),!1}},img:{i:"image",click:function(e,t){var u,s,n=t.$(),r=h.img,i=h.figure,o=h.figcaption,a=n.value,l=g.modals.img,f=d.advance_img;return S.prompt(["img[src]",l.title[0]],l.placeholder[0],1,function(e,t,n){n=$(n),u=n,S.prompt(["img[title]",l.title[f?2:1]],l.placeholder[f?2:1],0,function(e,t,n){s=V(n),a||(a=u.split(/[\/\\\\]/).pop()),a=V(a),t[0](),f&&s?(t.tidy("\n\n","").insert(H[0]+i+H[1]+"\n"+p+H[0]+r+T("%4alt%1%2"+a+"%3%4src%1%2"+u+"%3",D)+B+"\n"+p+H[0]+o+H[1]+s+H[0]+H[2]+k(o)+H[1]+"\n"+H[0]+H[2]+k(i)+H[1]+"\n\n",0,1),U&&S.tools.p.click(e,t)):x(e,t).tidy(L(M[0]+"[^"+M[0]+M[1]+M[2]+"]+?"+M[1]+"\\s*$").test(t.$().before)?"":" ","").insert(H[0]+r+T("%4alt%1%2"+a+"%3%4src%1%2"+u+"%3",D)+(s?T("%4title%1%2"+s+"%3",D):"")+B+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=h.sub,r=h.sup,i=k(r);return x(e,t)[0]().unwrap(L(M[0]+O(i)+W+M[1]),H[0]+H[2]+i+H[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=h.sub,r=h.sup,i=k(n);return x(e,t)[0]().unwrap(L(M[0]+O(i)+W+M[1]),H[0]+H[2]+i+H[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var E,I,n=t.$(),r=R(n.value),i=g.modals.abbr,o=t.get(),a=R(r||y[""]),l=h.abbr,f=k(l),u=M[0]+O(l)+P+M[1],s=M[0]+O(l)+W+M[1],A=M[0]+M[2]+O(f)+M[1],c=L(u+b+A);return o.replace(c,function(e,t,n){(n=R(n))&&(C.abbr[n]=(t.match(L(T("%4+title%1%2\\s*(.*?)\\s*%3",m)))||["",""])[1])}),E=C.abbr,r&&E[r]?(t.i().format(l+T("%4title%1%2"+E[r]+"%3",D)),!1):(t.record().ui.prompt(["abbr[title]",i.title],E[a]||i.placeholder,!E[r],function(e,t,n,i){n=V(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(I in E)if(V(E[I])===n){t.insert(I);break}x(e,t).unwrap(L(s),L(A)).unwrap(L(s),L(A),1).i().format(l+T("%4title%1%2"+n+"%3",D))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var c,n=t.$(),r=n.value,i=h.p,o=h.br,a=k(i),l=k(o),f=n.before,u=n.after,s=w(f),A=y[""];if(t[0](),r&&-1!==r.indexOf("\n")){var E=L("^(?:\\s*"+M[0]+O(a)+W+M[1]+"\\s*)+"+b+"(?:\\s*"+M[0]+M[2]+O(a)+M[1]+"\\s*)+$");E.test(r)?t.replace(E,"$1").replace(L("\\s*"+M[0]+M[2]+O(a)+M[1]+"\\s*"+M[0]+O(a)+W+M[1]+"\\s*","g"),"\n\n").replace(L("\\s*"+M[0]+O(l)+W+M[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+H[0]+o+B+"\n").replace(L("(\\s*"+M[0]+O(l)+W+B+"\\s*){2,}","g"),H[0]+H[2]+a+H[1]+"\n"+H[0]+i+H[1]).wrap(H[0]+i+H[1],H[0]+H[2]+a+H[1],1).replace(L("("+M[0]+O(a)+W+M[1]+")+","g"),"$1").replace(L("("+M[0]+M[2]+O(a)+M[1]+")+","g"),"$1").tidy("\n")}else L("^\\s*"+M[0]+M[2]+O(a)+M[1]).test(u)?L(M[0]+O(a)+W+M[1]+"\\s*$").test(f)?t.unwrap(L("\\s*"+M[0]+O(a)+W+M[1]+"\\s*"),L("\\s*"+M[0]+M[2]+O(a)+M[1])).replace(A,"").tidy("\n","\n"+s):(c=f.match(L(M[0]+O(a)+P+M[1]+".*?$")))&&t.wrap(H[0]+H[2]+a+H[1]+"\n"+s+H[0]+a+c[1]+H[1],"").insert(A):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),r=[h.p,h.h1,h.h2,h.h3,h.h4,h.h5,h.h6],i=[];E(r,function(e,t){i[t]=k(e)});var a=(O(r).join("|"),O(i).join("|")),l="\\s*"+M[0]+"("+a+")"+P+M[1]+"\\s*",f=L("\\s*"+M[0]+"(?:"+a+")"+W+M[1]+"\\s*"),u=L("\\s*"+M[0]+M[2]+"(?:"+a+")"+M[1]+"\\s*"),s=n.value.match(L("^"+l));s||(s=n.before.match(L(l+"$"))||[]);var A=s[2]||"",c=+(s[1]||"h0").slice(1);return t[0]().unwrap(f,u).unwrap(f,u,1).i().tidy("\n\n").format(c>5?i[0]+A:i[c+1]+A,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var n=t.$(),r=n.value,i=h.blockquote,o=h.q,a=h.p,l=k(a),f=M[0]+O(l)+W+M[1];if(L("(^|\\n|"+f+")$").test(n.before)){if(U&&(r===y[""]||L("("+f+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),U&&(!r||t.match(L("^[^"+M[0]+"\\n]*?[^"+M[1]+"]$"))?t.wrap(p+H[0]+a+H[1],H[0]+H[2]+l+H[1]):t[L("((^|\\n)"+O(p)+")+").test(r)?"outdent":"indent"](p)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function R(e){return i?N(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function I(e){return i?N(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=d.auto_encode_html,o=h.pre,a=h.code,l=k(o),f=k(a),u=M[0]+O(l)+W+M[1]+"\\s*"+M[0]+O(f)+W+M[1]+"\\s*",s="\\s*"+M[0]+M[2]+O(f)+M[1]+"\\s*"+M[0]+M[2]+O(l)+M[1],A=L(u+"\\s*$"),c=L("^\\s*"+s),E=L("^"+b+"$");return L("(^|\\n|"+u+")$").test(n.before)?A.test(n.before)&&c.test(n.after)?t[0]().unwrap(L(A),L(c)).replace(E,I)[1]():t[0]().tidy("\n\n").wrap(H[0]+o+H[1]+H[0]+a+H[1],H[0]+H[2]+f+H[1]+H[0]+H[2]+l+H[1]).insert(r||y[""]).replace(E,R)[1]():t[0]().format(a).loss().replace(E,function(e){return Y(L("^\\s*"+M[0]+M[2]+O(f)+M[1]).test(t.$().after)?R(e):I(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=h.ol,r=h.ul,i=k(n),o=k(r),a="("+O(o)+"|"+O(i)+")";return t.match(L(M[0]+a+W+M[1]+b+M[0]+M[2]+a+M[1]))?t[0]().replace(L(M[0]+O(i)+P+M[1],"g"),H[0]+o+"$1"+H[1]).replace(L(M[0]+M[2]+O(i)+M[1],"g"),H[0]+H[2]+o+H[1])[1]():K(e,r,h.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=h.ol,r=h.ul,i=k(n),o=k(r),a="("+O(o)+"|"+O(i)+")";return t.match(L(M[0]+a+W+M[1]+b+M[0]+M[2]+a+M[1]))?t[0]().replace(L(M[0]+O(o)+P+M[1],"g"),H[0]+i+"$1"+H[1]).replace(L(M[0]+M[2]+O(o)+M[1],"g"),H[0]+H[2]+i+H[1])[1]():K(e,n,h.li),!1}},table:function(e,t){var y,U,v,w,n=C.tr,r=C.td,i=g.modals.table,o=g.placeholders.table,a=R(T(o[0],[1,1])),l=d.advance_table?p:"",f=h.table,u=h.caption,s=h.thead,A=h.tbody,c=h.tfoot,E=h.tr,O=h.th,L=h.td,N=k(f),G=k(u),D=k(s),M=k(A),m=k(c),B=k(E),W=k(O),P=k(L),b=[];return t[0]().$().value===a?(t.select(),!1):(S.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,d,C){U=I(F(d)||C,r[0],r[1]),S.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,d){v=I(F(r)||d,n[0],n[1]),S.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,I,F,d,C,r="";for(w=Y(n),i=0;v>i;++i){for(y=l+p+H[0]+E+H[1]+"\n",I=0;U>I;++I)y+=l+p+p+H[0]+L+H[1]+R(T(o[1],[i+1,I+1]))+H[0]+H[2]+P+H[1]+"\n";y+=l+p+H[0]+H[2]+B+H[1],b.push(y)}for(b=b.join("\n"),y=p+(l?H[0]+s+H[1]+"\n"+p+p+H[0]+E+H[1]:H[0]+B+H[1])+"\n",F=0;U>F;++F)y+=l+p+p+H[0]+O+H[1]+R(T(o[0],[1,F+1]))+H[0]+H[2]+W+H[1]+"\n";if(l){for(r+=p+H[0]+c+H[1]+"\n",r+=p+p+H[0]+E+H[1]+"\n",F=0;U>F;++F)r+=p+p+p+H[0]+L+H[1]+R(T(o[2],[1,F+1]))+H[0]+H[2]+P+H[1]+"\n";r+=p+p+H[0]+H[2]+E+H[1]+"\n",r+=p+H[0]+H[2]+m+H[1]+"\n"}y+=l+p+H[0]+H[2]+B+H[1]+(l?"\n"+p+H[0]+H[2]+D+H[1]+"\n"+r+p+H[0]+A+H[1]:"")+"\n",b=y+b+(l?"\n"+p+H[0]+H[2]+M+H[1]:"")+"\n",t.tidy("\n\n").insert(H[0]+f+H[1]+"\n"+(w&&u?p+H[0]+u+H[1]+w+H[0]+H[2]+G+H[1]+"\n":"")+b+H[0]+H[2]+N+H[1]),d=t.$(),C=d.start+d.value.indexOf(a),t.select(C,C+a.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=w(t.$().before);return t.tidy("\n\n","").insert(n+H[0]+h.hr+B+"\n\n",0),!1}}}),d.keys&&c(S.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=w(t.$().before);return t.tidy("\n","").insert(n+H[0]+h.br+B+"\n",0),!1},enter:function(e,t){var c,E,I,n=t.$(),r=n.value,i=t.get(),o=h.p,a=h.li,l=k(o),f=k(a),s=(w(n.before),y[""]),A=S.tools;if(!r||r===s){if(c=n.after.match(L("^\\s*"+M[0]+M[2]+"("+O(l)+"|"+O(f)+")"+M[1])))E=c[1],(A[E===f?v:E]||A.ul).click(e,t);else{if(!(U&&o&&R(i)&&n.end===i.length&&L("^\\s*[^"+M[0]+"\\n]*?[^"+M[1]+"]\\s*$").test(i)))return;i=H[0]+o+H[1]+i+H[0]+H[2]+l+H[1]+"\n"+H[0]+o+H[1],I=s+H[0]+H[2]+l+H[1],t.set(i+I).select(i.length,(i+s).length)}return!1}},tab:function(e,t){var n=t.$(),r=h.li,i=k(r),o=w(n.before);return L(M[0]+M[2]+O(i)+M[1]).test(n.after)?(t[0]().wrap("\n"+o+p+H[0]+(h[v]||v)+H[1]+"\n"+o+p+p+H[0]+r+H[1],H[0]+H[2]+i+H[1]+"\n"+o+p+H[0]+H[2]+v+H[1]+"\n"+o).insert(y[""])[1](),!1):S.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,a=n.after,l=M[0]+"[^"+M[0]+M[1]+"]+?"+M[1];return!r&&L(l+"$").test(o)?(i=o.split(H[0]).pop().match(L("^([^"+M[2]+"\\s]+).*?"+M[1]+"$")),i=i&&i[1]||0,i&&L("^\\s*"+M[0]+M[2]+O(i)+M[1]).test(a)?t.unwrap(L(M[0]+O(i)+W+M[1]),L("\\s*"+M[0]+M[2]+O(i)+M[1])):t.outdent(L(l)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),s.update({},0)};