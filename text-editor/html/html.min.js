/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.8
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function K(e){return e.split(I("("+g[3]+")+"))[0]}function k(e){return y=e.match(/(?:^|\n)([\t ]*).*$/),y&&y[1]||""}function Y(e,t,n){var O,r=s.$(),i=r.value,o=r.before,l=p[t]||t,f=p[n]||n,A=K(l),a=K(f),u=k(o),E=W[""];return v=l,s[0](),i&&i!==E?(s.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,b[0]+b[2]+a+b[1]+"\n"+H+b[0]+f+b[1]).wrap(b[0]+l+b[1]+"\n"+H+b[0]+f+b[1],b[0]+b[2]+a+b[1]+"\n"+b[0]+b[2]+A+b[1]+"\n\n",1).replace(I("\\n"+c(H)+U[0]+c(f)+U[1]+"\\s*"+U[0]+U[2]+c(a)+U[1]+"\\n","g"),"\n"+b[0]+b[2]+A+b[1]+"\n\n"+b[0]+l+b[1]+"\n").select(s.$().end),C&&N.tools.p.click(e,s)):(O=o.match(I("(?:^|\\n)[\\t ]+"+U[0]+"("+U[2]+"?)(?:"+c(K(p.ul))+"|"+c(K(p.ol))+")"+m+U[1]+"\\s*$")))?s.insert("\n"+u+(O[1]?"":H),0):(O=o.match(I(U[0]+c(a)+B+U[1]+".*?$")))?I(U[0]+U[2]+c(a)+U[1]+"\\s*$").test(o)?s.tidy("\n"+u,!1).insert(E).wrap(b[0]+a+O[1]+b[1],b[0]+b[2]+a+b[1]):I(U[1]+"\\s*$").test(o)?s.insert(E).wrap("\n"+u+H+b[0]+l+b[1]+"\n"+u+H+H+b[0]+a+O[1]+b[1],b[0]+b[2]+a+b[1]+"\n"+u+H+b[0]+b[2]+A+b[1]+"\n"+u):s.insert(b[0]+b[2]+a+b[1]+"\n"+u+b[0]+a+O[1]+b[1],0).insert(E):I(U[0]+U[2]+c(a)+U[1]+"\\s*$").test(o)?s.insert(E).wrap("\n"+u+b[0]+f+b[1],b[0]+b[2]+a+b[1]):s.tidy("\n\n").insert(E).wrap(b[0]+l+b[1]+"\n"+H+b[0]+f+b[1],b[0]+b[2]+a+b[1]+"\n"+b[0]+b[2]+A+b[1]),s[1](),!1}function w(e,t){return!t.get(0)&&C&&N.tools.p.click(e,t),t}function x(e){return L(e.replace(/\s+/g," "))}function $(e){return S(x(e),[I(U[0]+".*?"+U[1],"g"),'"',"'"],["","&#34;","&#39;"])}function V(e){return S(x(e),[I(U[0]+".*?"+U[1],"g"),/\s/g,'"'],["","%20","%22"])}var v,y,n="–",r="…",i="↑",o="↓",l="↵",f="⌘",A="✘",a="⇧",s=new TE(e),u=s._,E=u.edge,c=u.x,O=u.extend,R=u.i,I=u.pattern,L=u.trim,N=s.ui(O({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",A],b:["Bold",f+"+B"],i:["Italic",f+"+I"],u:["Underline",f+"+U"],s:["Strike",f+"+"+A],a:["Link",f+"+L"],img:["Image",f+"+G"],sub:["Subscript",f+"+"+o],sup:["Superscript",f+"+"+i],abbr:["Abbreviation",f+"+"+a+"+?"],p:["Paragraph",f+"+"+l],br:["Line Break",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",f+"+H"],"blockquote,q":["Quote",f+"+Q"],"pre,code":["Code",f+"+K"],ul:["Unordered List",f+"+-"],ol:["Ordered List",f+"++"],table:["Table",f+"+T"],hr:["Horizontal Rule",f+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),T=u.format,S=u.replace,F=s.config,C=F.auto_p,p=(F.classes,F.formats),G=F.languages,h=F.states,D=F.suffix,H=F.tab,b=F.unit[0][0],M=F.unit[0][1],U=F.unit[1][0],g=F.unit[1][1],m="(?:"+g[3]+"[^"+U[0]+U[1]+"]*?)?",B="(|"+g[3]+"[^"+U[0]+U[1]+"]*?)",P="([\\s\\S]*?)",W=G.placeholders;return s.type="HTML",O(N.tools,{clear:{i:"eraser",click:function(e,t){var l,n=t[0]().$(),r=n.before,i=n.after,o=n.value,f=U[0]+"[^"+U[0]+U[1]+"]+?"+U[1],A=U[0]+"[^"+U[2]+U[0]+U[1]+"]+?"+U[1],a=U[0]+U[2]+"[^"+U[0]+U[1]+"]+?"+U[1];return!o&&i&&(l=I("^"+f)).test(i)?(t.replace(l,"",1),!1):(I(f).test(o)||r.slice(-1)===b[1]||i[0]===b[0]?t.replace(I(f,"g"),"").unwrap(I(A),I(a)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return w(e,t).i().format(p.b),!1}},i:{i:"italic",click:function(e,t){return w(e,t).i().format(p.i),!1}},u:{i:"underline",click:function(e,t){return w(e,t).i().format(p.u),!1}},s:{i:"strikethrough",click:function(e,t){return w(e,t).i().format(T(p.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=p.a,r=G.modals.a;return N.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,l){l=V(l),i=l;var A,a,f=location.host;-1!==i.indexOf("://")&&(A=1),""!==f&&-1!==i.indexOf("://"+f)&&(A=0),/^([.\/?&#]|javascript:)/.test(i)&&(A=0),N.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=$(r),w(e,t).$().length||t.insert(W[""]),a=F.advance_a&&A?M[3]+"rel"+M[0]+M[1]+"nofollow"+M[2]+M[3]+"target"+M[0]+M[1]+"_blank"+M[2]:"",t.i().format(n+M[3]+"href"+M[0]+M[1]+i+M[2]+(o?M[3]+"title"+M[0]+M[1]+o+M[2]:"")+a)})}).record(),!1}},img:{i:"image",click:function(e,t){var a,s,n=t.$(),r=p.img,i=p.figure,o=p.figcaption,l=n.value,f=G.modals.img,A=F.advance_img;return N.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,n){n=V(n),a=n,N.prompt(["img[title]",f.title[A?2:1]],f.placeholder[A?2:1],0,function(e,t,n){s=$(n),l||(l=a.split(/[\/\\\\]/).pop()),l=$(l),t[0](),A&&s?(t.tidy("\n\n","").insert(b[0]+i+b[1]+"\n"+H+b[0]+r+M[3]+"alt"+M[0]+M[1]+l+M[2]+M[3]+"src"+M[0]+M[1]+a+M[2]+D+"\n"+H+b[0]+o+b[1]+s+b[0]+b[2]+K(o)+b[1]+"\n"+b[0]+b[2]+K(i)+b[1]+"\n\n",0,1),C&&N.tools.p.click(e,t)):w(e,t).tidy(I(U[0]+"[^"+U[0]+U[1]+U[2]+"]+?"+U[1]+"\\s*$").test(t.$().before)?"":" ","").insert(b[0]+r+M[3]+"alt"+M[0]+M[1]+l+M[2]+M[3]+"src"+M[0]+M[1]+a+M[2]+(s?M[3]+"title"+M[0]+M[1]+s+M[2]:"")+D+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=p.sub,r=p.sup,i=K(r);return w(e,t)[0]().unwrap(I(U[0]+c(i)+m+U[1]),b[0]+b[2]+i+b[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=p.sub,r=p.sup,i=K(n);return w(e,t)[0]().unwrap(I(U[0]+c(i)+m+U[1]),b[0]+b[2]+i+b[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var O,R,n=t.$(),r=L(n.value),i=G.modals.abbr,o=t.get(),l=L(r||W[""]),f=p.abbr,A=K(f),a=U[0]+c(f)+B+U[1],s=U[0]+c(f)+m+U[1],u=U[0]+U[2]+c(A)+U[1],E=I(a+P+u);return o.replace(E,function(e,t,n){(n=L(n))&&(h.abbr[n]=(t.match(I(g[3]+"+title"+g[0]+g[1]+"\\s*(.*?)\\s*"+g[2]))||["",""])[1])}),O=h.abbr,r&&O[r]?(t.i().format(f+M[3]+"title"+M[0]+M[1]+O[r]+M[2]),!1):(N.prompt(["abbr[title]",i.title],O[l]||i.placeholder,!O[r],function(e,t,n,i){n=$(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(R in O)if($(O[R])===n){t.insert(R);break}w(e,t).unwrap(I(s),I(u)).unwrap(I(s),I(u),1).i().format(f+M[3]+"title"+M[0]+M[1]+n+M[2])[1]()}).record(),!1)}},p:{i:"paragraph",click:function(e,t){var E,n=t.$(),r=n.value,i=p.p,o=p.br,l=K(i),f=K(o),A=n.before,a=n.after,s=k(A),u=W[""];if(t[0](),r&&-1!==r.indexOf("\n")){var O=I("^(?:\\s*"+U[0]+c(l)+m+U[1]+"\\s*)+"+P+"(?:\\s*"+U[0]+U[2]+c(l)+U[1]+"\\s*)+$");O.test(r)?t.replace(O,"$1").replace(I("\\s*"+U[0]+U[2]+c(l)+U[1]+"\\s*"+U[0]+c(l)+m+U[1]+"\\s*","g"),"\n\n").replace(I("\\s*"+U[0]+c(f)+m+U[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+b[0]+o+D+"\n").replace(I("(\\s*"+U[0]+c(f)+m+D+"\\s*){2,}","g"),b[0]+b[2]+l+b[1]+"\n"+b[0]+i+b[1]).wrap(b[0]+i+b[1],b[0]+b[2]+l+b[1],1).replace(I("("+U[0]+c(l)+m+U[1]+")+","g"),"$1").replace(I("("+U[0]+U[2]+c(l)+U[1]+")+","g"),"$1").tidy("\n")}else I("^\\s*"+U[0]+U[2]+c(l)+U[1]).test(a)?I(U[0]+c(l)+m+U[1]+"\\s*$").test(A)?t.unwrap(I("\\s*"+U[0]+c(l)+m+U[1]+"\\s*"),I("\\s*"+U[0]+U[2]+c(l)+U[1])).replace(u,"").tidy("\n","\n"+s):(E=A.match(I(U[0]+c(l)+B+U[1]+".*?$")))&&t.wrap(b[0]+b[2]+l+b[1]+"\n"+s+b[0]+l+E[1]+b[1],"").insert(u):t.tidy("\n\n").format(i,0,"\n\n");return t[1](),!1}},br:{i:"level-down",click:function(e,t){return y=k(t.$().before),t.tidy("\n","").insert(y+b[0]+p.br+D+"\n",0),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var o,l,n=t.$(),r=[p.p,p.h1,p.h2,p.h3,p.h4,p.h5,p.h6],i=[];for(o in r)i[o]=K(r[o]);var A=(c(r).join("|"),c(i).join("|")),a="\\s*"+U[0]+"("+A+")"+B+U[1]+"\\s*",s=I("\\s*"+U[0]+"(?:"+A+")"+m+U[1]+"\\s*"),u=I("\\s*"+U[0]+U[2]+"(?:"+A+")"+U[1]+"\\s*"),E=n.value.match(I("^"+a));return E||(E=n.before.match(I(a+"$"))||[]),l=E[2]||"",o=+(E[1]||"h0").slice(1),t[0]().unwrap(s,u).unwrap(s,u,1).i().tidy("\n\n").format(o>5?i[0]+l:i[o+1]+l,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var u,n=t.$(),r=n.value,i=p.blockquote,o=p.q,l=p.p,f=K(l),A=c(f),a=I(U[0]+U[2]+A+U[1]),s=W[""];return/(^|\n)$/.test(n.before)?(C&&!a.test(r)&&N.tools.p.click(e,t),n=t.$(),r=n.value,!a.test(r)&&C&&t.select(n.start-(b[0]+l+b[1]).length,n.end+(b[0]+b[2]+f+b[1]).length),r!==s&&C?(t[0]().tidy("\n\n").insert(b[0]+i+b[1]+"\n"+t.$().value.replace(I("^(\\s*"+U[0]+")","gm"),H+"$1")+"\n"+b[0]+b[2]+K(i)+b[1]+"\n\n",0,1),C&&N.tools.p.click(e,t)):(t[0]().format(i,0,"\n\n","\n").loss().replace(I("^(\\s*"+U[0]+")","gm"),H+"$1"),C&&(n=t.$(),u=n.start+(b[0]+l+b[1]+H).length,t.select(u,u+s.length))),t[1]()):t.i().format(o),!1}},"pre,code":{i:"code",click:function(e,t){function R(e){return i?S(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function L(e){return i?S(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=F.auto_encode_html,o=p.pre,l=p.code,f=K(o),A=K(l),a=U[0]+c(f)+m+U[1]+"\\s*"+U[0]+c(A)+m+U[1]+"\\s*",s="\\s*"+U[0]+U[2]+c(A)+U[1]+"\\s*"+U[0]+U[2]+c(f)+U[1],u=I(a+"\\s*$"),E=I("^\\s*"+s),O=I("^"+P+"$");return I("(^|\\n|"+a+")$").test(n.before)?u.test(n.before)&&E.test(n.after)?t[0]().unwrap(I(u),I(E)).replace(O,L)[1]():t[0]().tidy("\n\n").wrap(b[0]+o+b[1]+b[0]+l+b[1],b[0]+b[2]+A+b[1]+b[0]+b[2]+f+b[1]).insert(r||W[""]).replace(O,R)[1]():t[0]().format(l).replace(O,function(e){return x(I("^\\s*"+U[0]+U[2]+c(A)+U[1]).test(t.$().after)?R(e):L(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=p.ol,r=p.ul,i=K(n),o=K(r),l="("+c(o)+"|"+c(i)+")";return t.match(I(U[0]+l+m+U[1]+P+U[0]+U[2]+l+U[1]))?t[0]().replace(I(U[0]+c(i)+B+U[1],"g"),b[0]+o+"$1"+b[1]).replace(I(U[0]+U[2]+c(i)+U[1],"g"),b[0]+b[2]+o+b[1])[1]():Y(e,r,p.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=p.ol,r=p.ul,i=K(n),o=K(r),l="("+c(o)+"|"+c(i)+")";return t.match(I(U[0]+l+m+U[1]+P+U[0]+U[2]+l+U[1]))?t[0]().replace(I(U[0]+c(o)+B+U[1],"g"),b[0]+i+"$1"+b[1]).replace(I(U[0]+U[2]+c(o)+U[1],"g"),b[0]+b[2]+i+b[1])[1]():Y(e,n,p.li),!1}},table:function(e,t){var W,v,y,k,n=h.tr,r=h.td,i=G.modals.table,o=G.placeholders.table,l=L(T(o[0],[1,1])),f=F.advance_table?H:"",A=p.table,a=p.caption,s=p.thead,u=p.tbody,c=p.tfoot,O=p.tr,I=p.th,S=p.td,C=K(A),d=K(a),D=K(s),M=K(u),U=K(c),g=K(O),m=K(I),B=K(S),P=[];return t[0]().$().value===l?(t.select(),!1):(N.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,F,p){v=E(R(F)||p,r[0],r[1]),N.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,F){y=E(R(r)||F,n[0],n[1]),N.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,E,R,F,p,r="";for(k=x(n),i=0;y>i;++i){for(W=f+H+b[0]+O+b[1]+"\n",E=0;v>E;++E)W+=f+H+H+b[0]+S+b[1]+L(T(o[1],[i+1,E+1]))+b[0]+b[2]+B+b[1]+"\n";W+=f+H+b[0]+b[2]+g+b[1],P.push(W)}for(P=P.join("\n"),W=H+(f?b[0]+s+b[1]+"\n"+H+H+b[0]+O+b[1]:b[0]+g+b[1])+"\n",R=0;v>R;++R)W+=f+H+H+b[0]+I+b[1]+L(T(o[0],[1,R+1]))+b[0]+b[2]+m+b[1]+"\n";if(f){for(r+=H+b[0]+c+b[1]+"\n",r+=H+H+b[0]+O+b[1]+"\n",R=0;v>R;++R)r+=H+H+H+b[0]+S+b[1]+L(T(o[2],[1,R+1]))+b[0]+b[2]+B+b[1]+"\n";r+=H+H+b[0]+b[2]+O+b[1]+"\n",r+=H+b[0]+b[2]+U+b[1]+"\n"}W+=f+H+b[0]+b[2]+g+b[1]+(f?"\n"+H+b[0]+b[2]+D+b[1]+"\n"+r+H+b[0]+u+b[1]:"")+"\n",P=W+P+(f?"\n"+H+b[0]+b[2]+M+b[1]:"")+"\n",t.tidy("\n\n").insert(b[0]+A+b[1]+"\n"+(k&&a?H+b[0]+a+b[1]+k+b[0]+b[2]+d+b[1]+"\n":"")+P+b[0]+b[2]+C+b[1]),F=t.$(),p=F.start+F.value.indexOf(l),t.select(p,p+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){return y=k(t.$().before),t.tidy("\n\n","").insert(y+b[0]+p.hr+D+"\n\n",0),!1}}}),F.keys&&O(N.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var E,O,R,n=t.$(),r=n.value,i=t.get(),o=p.p,l=p.li,f=K(o),A=K(l),s=(k(n.before),W[""]),u=N.tools;if(!r||r===s){if(E=n.after.match(I("^\\s*"+U[0]+U[2]+"("+c(f)+"|"+c(A)+")"+U[1])))O=E[1],(u[O===A?v:O]||u.ul).click(e,t);else{if(!(C&&o&&L(i)&&n.end===i.length&&I("^\\s*[^"+U[0]+"\\n]*?[^"+U[1]+"]\\s*$").test(i)))return;i=b[0]+o+b[1]+i+b[0]+b[2]+f+b[1]+"\n"+b[0]+o+b[1],R=s+b[0]+b[2]+f+b[1],t.set(i+R).select(i.length,(i+s).length)}return!1}},tab:function(e,t){var n=t.$(),r=p.li,i=K(r),o=k(n.before);return I(U[0]+U[2]+c(i)+U[1]).test(n.after)?(t[0]().wrap("\n"+o+H+b[0]+(p[v]||v)+b[1]+"\n"+o+H+H+b[0]+r+b[1],b[0]+b[2]+i+b[1]+"\n"+o+H+b[0]+b[2]+v+b[1]+"\n"+o).insert(W[""])[1](),!1):N.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,l=n.after,f=U[0]+"[^"+U[0]+U[1]+"]+?"+U[1];return!r&&I(f+"$").test(o)?(i=o.split(b[0]).pop().match(I("^([^"+U[2]+"\\s]+).*?"+U[1]+"$")),i=i&&i[1]||0,i&&I("^\\s*"+U[0]+U[2]+c(i)+U[1]).test(l)?t.unwrap(I(U[0]+c(i)+m+U[1]),I("\\s*"+U[0]+U[2]+c(i)+U[1])):t.outdent(I(f)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),s.update({},0)};