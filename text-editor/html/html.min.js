TE.HTML=function(e,t){function k(e){return e.split(I("("+M[3]+")+"))[0]}function w(e){return y=e.match(/(?:^|\n)([\t ]*).*$/),y&&y[1]||""}function K(e,t,n){var O,r=u.$(),i=r.value,o=r.before,l=C[t]||t,f=C[n]||n,a=k(l),s=k(f),c=w(o),A=P[""];return W=l,u[0](),i&&i!==A?(u.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,H[0]+H[2]+s+H[1]+"\n"+g+H[0]+f+H[1]).wrap(H[0]+l+H[1]+"\n"+g+H[0]+f+H[1],H[0]+H[2]+s+H[1]+"\n"+H[0]+H[2]+a+H[1]+"\n\n",1).replace(I("\\n"+E(g)+m[0]+E(f)+m[1]+"\\s*"+m[0]+m[2]+E(s)+m[1]+"\\n","g"),"\n"+H[0]+H[2]+a+H[1]+"\n\n"+H[0]+l+H[1]+"\n").select(u.$().end),S&&N.tools.p.click(e,u)):(O=o.match(I("(?:^|\\n)[\\t ]+"+m[0]+"("+m[2]+"?)(?:"+E(k(C.ul))+"|"+E(k(C.ol))+")"+U+m[1]+"\\s*$")))?u.insert("\n"+c+(O[1]?"":g),0):(O=o.match(I(m[0]+E(s)+v+m[1]+".*?$")))?I(m[0]+m[2]+E(s)+m[1]+"\\s*$").test(o)?u.tidy("\n"+c,!1).insert(A).wrap(H[0]+s+O[1]+H[1],H[0]+H[2]+s+H[1]):I(m[1]+"\\s*$").test(o)?u.insert(A).wrap("\n"+c+g+H[0]+l+H[1]+"\n"+c+g+g+H[0]+s+O[1]+H[1],H[0]+H[2]+s+H[1]+"\n"+c+g+H[0]+H[2]+a+H[1]+"\n"+c):u.insert(H[0]+H[2]+s+H[1]+"\n"+c+H[0]+s+O[1]+H[1],0).insert(A):I(m[0]+m[2]+E(s)+m[1]+"\\s*$").test(o)?u.insert(A).wrap("\n"+c+H[0]+f+H[1],H[0]+H[2]+s+H[1]):u.tidy("\n\n").insert(A).wrap(H[0]+l+H[1]+"\n"+g+H[0]+f+H[1],H[0]+H[2]+s+H[1]+"\n"+H[0]+H[2]+a+H[1]),u[1](),!1}function Y(e,t){return!t.get(0)&&S&&N.tools.p.click(e,t),t}function $(e){return L(e.replace(/\s+/g," "))}function x(e){return d($(e),[I(m[0]+".*?"+m[1],"g"),'"',"'"],["","&#34;","&#39;"])}function V(e){return d($(e),[I(m[0]+".*?"+m[1],"g"),/\s/g,'"'],["","%20","%22"])}var W,y,n="–",r="…",i="↑",o="↓",l="↵",f="⌘",a="✘",s="⇧",u=new TE(e),c=u._,A=c.edge,E=c.x,O=c.extend,R=c.i,I=c.pattern,L=c.trim,N=u.ui(O({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr br | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{tools:["Focus Tools","F10"],clear:["Clear Format",a],b:["Bold",f+"+B"],i:["Italic",f+"+I"],u:["Underline",f+"+U"],s:["Strike",f+"+"+a],a:["Link",f+"+L"],img:["Image",f+"+G"],sub:["Subscript",f+"+"+o],sup:["Superscript",f+"+"+i],abbr:["Abbreviation",f+"+"+s+"+?"],p:["Paragraph",f+"+"+l],br:["Line Break",s+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",f+"+H"],"blockquote,q":["Quote",f+"+Q"],"pre,code":["Code",f+"+K"],ul:["Unordered List",f+"+-"],ol:["Ordered List",f+"++"],table:["Table",f+"+T"],hr:["Horizontal Rule",f+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),T=c.format,d=c.replace,p=u.config,S=p.auto_p,C=(p.classes,p.formats),h=p.languages,G=p.states,b=p.suffix,g=p.tab,H=p.unit[0][0],D=p.unit[0][1],m=p.unit[1][0],M=p.unit[1][1],U="(?:"+M[3]+"[^"+m[0]+m[1]+"]*?)?",v="(|"+M[3]+"[^"+m[0]+m[1]+"]*?)",B="([\\s\\S]*?)",P=h.placeholders;return u.type="HTML",O(N.tools,{clear:{i:"eraser",click:function(e,t){var l,n=t[0]().$(),r=n.before,i=n.after,o=n.value,f=m[0]+"[^"+m[0]+m[1]+"]+?"+m[1],a=m[0]+"[^"+m[2]+m[0]+m[1]+"]+?"+m[1],s=m[0]+m[2]+"[^"+m[0]+m[1]+"]+?"+m[1];return!o&&i&&(l=I("^"+f)).test(i)?(t.replace(l,"",1),!1):(I(f).test(o)||r.slice(-1)===H[1]||i[0]===H[0]?t.replace(I(f,"g"),"").unwrap(I(a),I(s)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return Y(e,t).i().format(C.b),!1}},i:{i:"italic",click:function(e,t){return Y(e,t).i().format(C.i),!1}},u:{i:"underline",click:function(e,t){return Y(e,t).i().format(C.u),!1}},s:{i:"strikethrough",click:function(e,t){return Y(e,t).i().format(T(C.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=C.a,r=h.modals.a;return N.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,l){l=V(l),i=l;var a,s,f=location.host;-1!==i.indexOf("://")&&(a=1),""!==f&&-1!==i.indexOf("://"+f)&&(a=0),/^([.\/?&#]|javascript:)/.test(i)&&(a=0),N.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=x(r),Y(e,t).$().length||t.insert(P[""]),s=p.advance_a&&a?D[3]+"rel"+D[0]+D[1]+"nofollow"+D[2]+D[3]+"target"+D[0]+D[1]+"_blank"+D[2]:"",t.i().format(n+D[3]+"href"+D[0]+D[1]+i+D[2]+(o?D[3]+"title"+D[0]+D[1]+o+D[2]:"")+s)})}).record(),!1}},img:{i:"image",click:function(e,t){var s,u,n=t.$(),r=C.img,i=C.figure,o=C.figcaption,l=n.value,f=h.modals.img,a=p.advance_img;return N.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,n){n=V(n),s=n,N.prompt(["img[title]",f.title[a?2:1]],f.placeholder[a?2:1],0,function(e,t,n){u=x(n),l||(l=s.split(/[\/\\\\]/).pop()),l=x(l),t[0](),a&&u?(t.tidy("\n\n","").insert(H[0]+i+H[1]+"\n"+g+H[0]+r+D[3]+"alt"+D[0]+D[1]+l+D[2]+D[3]+"src"+D[0]+D[1]+s+D[2]+b+"\n"+g+H[0]+o+H[1]+u+H[0]+H[2]+k(o)+H[1]+"\n"+H[0]+H[2]+k(i)+H[1]+"\n\n",0,1),S&&N.tools.p.click(e,t)):Y(e,t).tidy(I(m[0]+"[^"+m[0]+m[1]+m[2]+"]+?"+m[1]+"\\s*$").test(t.$().before)?"":" ","").insert(H[0]+r+D[3]+"alt"+D[0]+D[1]+l+D[2]+D[3]+"src"+D[0]+D[1]+s+D[2]+(u?D[3]+"title"+D[0]+D[1]+u+D[2]:"")+b+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=C.sub,r=C.sup,i=k(r);return Y(e,t)[0]().unwrap(I(m[0]+E(i)+U+m[1]),H[0]+H[2]+i+H[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=C.sub,r=C.sup,i=k(n);return Y(e,t)[0]().unwrap(I(m[0]+E(i)+U+m[1]),H[0]+H[2]+i+H[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var O,R,n=t.$(),r=L(n.value),i=h.modals.abbr,o=t.get(),l=L(r||P[""]),f=C.abbr,a=k(f),s=m[0]+E(f)+v+m[1],u=m[0]+E(f)+U+m[1],c=m[0]+m[2]+E(a)+m[1],A=I(s+B+c);return o.replace(A,function(e,t,n){(n=L(n))&&(G.abbr[n]=(t.match(I(M[3]+"+title"+M[0]+M[1]+"\\s*(.*?)\\s*"+M[2]))||["",""])[1])}),O=G.abbr,r&&O[r]?(t.i().format(f+D[3]+"title"+D[0]+D[1]+O[r]+D[2]),!1):(N.prompt(["abbr[title]",i.title],O[l]||i.placeholder,!O[r],function(e,t,n,i){n=x(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(R in O)if(x(O[R])===n){t.insert(R);break}Y(e,t).unwrap(I(u),I(c)).unwrap(I(u),I(c),1).i().format(f+D[3]+"title"+D[0]+D[1]+n+D[2])[1]()}).record(),!1)}},p:{i:"paragraph",click:function(e,t){var A,n=t.$(),r=n.value,i=C.p,o=C.br,l=k(i),f=k(o),a=n.before,s=n.after,u=w(a),c=P[""];if(t[0](),r&&-1!==r.indexOf("\n")){var O=I("^(?:\\s*"+m[0]+E(l)+U+m[1]+"\\s*)+"+B+"(?:\\s*"+m[0]+m[2]+E(l)+m[1]+"\\s*)+$");O.test(r)?t.replace(O,"$1").replace(I("\\s*"+m[0]+m[2]+E(l)+m[1]+"\\s*"+m[0]+E(l)+U+m[1]+"\\s*","g"),"\n\n").replace(I("\\s*"+m[0]+E(f)+U+m[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+H[0]+o+b+"\n").replace(I("(\\s*"+m[0]+E(f)+U+b+"\\s*){2,}","g"),H[0]+H[2]+l+H[1]+"\n"+H[0]+i+H[1]).wrap(H[0]+i+H[1],H[0]+H[2]+l+H[1],1).replace(I("("+m[0]+E(l)+U+m[1]+")+","g"),"$1").replace(I("("+m[0]+m[2]+E(l)+m[1]+")+","g"),"$1").tidy("\n")}else I("^\\s*"+m[0]+m[2]+E(l)+m[1]).test(s)?I(m[0]+E(l)+U+m[1]+"\\s*$").test(a)?t.unwrap(I("\\s*"+m[0]+E(l)+U+m[1]+"\\s*"),I("\\s*"+m[0]+m[2]+E(l)+m[1])).replace(c,"").tidy("\n","\n"+u):(A=a.match(I(m[0]+E(l)+v+m[1]+".*?$")))&&t.wrap(H[0]+H[2]+l+H[1]+"\n"+u+H[0]+l+A[1]+H[1],"").insert(c):t.tidy("\n\n").format(i,0,"\n\n");return t[1](),!1}},br:{i:"level-down",click:function(e,t){return y=w(t.$().before),t.tidy("\n","").insert(y+H[0]+C.br+b+"\n",0),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var o,l,n=t.$(),r=[C.p,C.h1,C.h2,C.h3,C.h4,C.h5,C.h6],i=[];for(o in r)i[o]=k(r[o]);var a=(E(r).join("|"),E(i).join("|")),s="\\s*"+m[0]+"("+a+")"+v+m[1]+"\\s*",u=I("\\s*"+m[0]+"(?:"+a+")"+U+m[1]+"\\s*"),c=I("\\s*"+m[0]+m[2]+"(?:"+a+")"+m[1]+"\\s*"),A=n.value.match(I("^"+s));return A||(A=n.before.match(I(s+"$"))||[]),l=A[2]||"",o=+(A[1]||"h0").slice(1),t[0]().unwrap(u,c).unwrap(u,c,1).i().tidy("\n\n").format(o>5?i[0]+l:i[o+1]+l,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var c,n=t.$(),r=n.value,i=C.blockquote,o=C.q,l=C.p,f=k(l),a=E(f),s=I(m[0]+m[2]+a+m[1]),u=P[""];return/(^|\n)$/.test(n.before)?(S&&!s.test(r)&&N.tools.p.click(e,t),n=t.$(),r=n.value,!s.test(r)&&S&&t.select(n.start-(H[0]+l+H[1]).length,n.end+(H[0]+H[2]+f+H[1]).length),r!==u&&S?(t[0]().tidy("\n\n").insert(H[0]+i+H[1]+"\n"+t.$().value.replace(I("^(\\s*"+m[0]+")","gm"),g+"$1")+"\n"+H[0]+H[2]+k(i)+H[1]+"\n\n",0,1),S&&N.tools.p.click(e,t)):(t[0]().format(i,0,"\n\n","\n").loss().replace(I("^(\\s*"+m[0]+")","gm"),g+"$1"),S&&(n=t.$(),c=n.start+(H[0]+l+H[1]+g).length,t.select(c,c+u.length))),t[1]()):t.i().format(o),!1}},"pre,code":{i:"code",click:function(e,t){function R(e){return i?d(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function L(e){return i?d(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=p.auto_encode_html,o=C.pre,l=C.code,f=k(o),a=k(l),s=m[0]+E(f)+U+m[1]+"\\s*"+m[0]+E(a)+U+m[1]+"\\s*",u="\\s*"+m[0]+m[2]+E(a)+m[1]+"\\s*"+m[0]+m[2]+E(f)+m[1],c=I(s+"\\s*$"),A=I("^\\s*"+u),O=I("^"+B+"$");return I("(^|\\n|"+s+")$").test(n.before)?c.test(n.before)&&A.test(n.after)?t[0]().unwrap(I(c),I(A)).replace(O,L)[1]():t[0]().tidy("\n\n").wrap(H[0]+o+H[1]+H[0]+l+H[1],H[0]+H[2]+a+H[1]+H[0]+H[2]+f+H[1]).insert(r||P[""]).replace(O,R)[1]():t[0]().format(l).replace(O,function(e){return $(I("^\\s*"+m[0]+m[2]+E(a)+m[1]).test(t.$().after)?R(e):L(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=C.ol,r=C.ul,i=k(n),o=k(r),l="("+E(o)+"|"+E(i)+")";return t.match(I(m[0]+l+U+m[1]+B+m[0]+m[2]+l+m[1]))?t[0]().replace(I(m[0]+E(i)+v+m[1],"g"),H[0]+o+"$1"+H[1]).replace(I(m[0]+m[2]+E(i)+m[1],"g"),H[0]+H[2]+o+H[1])[1]():K(e,r,C.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=C.ol,r=C.ul,i=k(n),o=k(r),l="("+E(o)+"|"+E(i)+")";return t.match(I(m[0]+l+U+m[1]+B+m[0]+m[2]+l+m[1]))?t[0]().replace(I(m[0]+E(o)+v+m[1],"g"),H[0]+i+"$1"+H[1]).replace(I(m[0]+m[2]+E(o)+m[1],"g"),H[0]+H[2]+i+H[1])[1]():K(e,n,C.li),!1}},table:function(e,t){var P,W,y,w,n=G.tr,r=G.td,i=h.modals.table,o=h.placeholders.table,l=L(T(o[0],[1,1])),f=p.advance_table?g:"",a=C.table,s=C.caption,u=C.thead,c=C.tbody,E=C.tfoot,O=C.tr,I=C.th,d=C.td,S=k(a),F=k(s),b=k(u),D=k(c),m=k(E),M=k(O),U=k(I),v=k(d),B=[];return t[0]().$().value===l?(t.select(),!1):(N.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,p,C){W=A(R(p)||C,r[0],r[1]),N.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,p){y=A(R(r)||p,n[0],n[1]),N.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,A,R,p,C,r="";for(w=$(n),i=0;y>i;++i){for(P=f+g+H[0]+O+H[1]+"\n",A=0;W>A;++A)P+=f+g+g+H[0]+d+H[1]+L(T(o[1],[i+1,A+1]))+H[0]+H[2]+v+H[1]+"\n";P+=f+g+H[0]+H[2]+M+H[1],B.push(P)}for(B=B.join("\n"),P=g+(f?H[0]+u+H[1]+"\n"+g+g+H[0]+O+H[1]:H[0]+M+H[1])+"\n",R=0;W>R;++R)P+=f+g+g+H[0]+I+H[1]+L(T(o[0],[1,R+1]))+H[0]+H[2]+U+H[1]+"\n";if(f){for(r+=g+H[0]+E+H[1]+"\n",r+=g+g+H[0]+O+H[1]+"\n",R=0;W>R;++R)r+=g+g+g+H[0]+d+H[1]+L(T(o[2],[1,R+1]))+H[0]+H[2]+v+H[1]+"\n";r+=g+g+H[0]+H[2]+O+H[1]+"\n",r+=g+H[0]+H[2]+m+H[1]+"\n"}P+=f+g+H[0]+H[2]+M+H[1]+(f?"\n"+g+H[0]+H[2]+b+H[1]+"\n"+r+g+H[0]+c+H[1]:"")+"\n",B=P+B+(f?"\n"+g+H[0]+H[2]+D+H[1]:"")+"\n",t.tidy("\n\n").insert(H[0]+a+H[1]+"\n"+(w&&s?g+H[0]+s+H[1]+w+H[0]+H[2]+F+H[1]+"\n":"")+B+H[0]+H[2]+S+H[1]),p=t.$(),C=p.start+p.value.indexOf(l),t.select(C,C+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){return y=w(t.$().before),t.tidy("\n\n","").insert(y+H[0]+C.hr+b+"\n\n",0),!1}}}),p.keys&&O(N.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var A,O,R,n=t.$(),r=n.value,i=t.get(),o=C.p,l=C.li,f=k(o),a=k(l),u=(w(n.before),P[""]),c=N.tools;if(!r||r===u){if(A=n.after.match(I("^\\s*"+m[0]+m[2]+"("+E(f)+"|"+E(a)+")"+m[1])))O=A[1],(c[O===a?W:O]||c.ul).click(e,t);else{if(!(S&&o&&L(i)&&n.end===i.length&&I("^\\s*[^"+m[0]+"\\n]*?[^"+m[1]+"]\\s*$").test(i)))return;i=H[0]+o+H[1]+i+H[0]+H[2]+f+H[1]+"\n"+H[0]+o+H[1],R=u+H[0]+H[2]+f+H[1],t.set(i+R).select(i.length,(i+u).length)}return!1}},tab:function(e,t){var n=t.$(),r=C.li,i=k(r),o=w(n.before);return I(m[0]+m[2]+E(i)+m[1]).test(n.after)?(t[0]().wrap("\n"+o+g+H[0]+(C[W]||W)+H[1]+"\n"+o+g+g+H[0]+r+H[1],H[0]+H[2]+i+H[1]+"\n"+o+g+H[0]+H[2]+W+H[1]+"\n"+o).insert(P[""])[1](),!1):N.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,l=n.after,f=m[0]+"[^"+m[0]+m[1]+"]+?"+m[1];return!r&&I(f+"$").test(o)?(i=o.split(H[0]).pop().match(I("^([^"+m[2]+"\\s]+).*?"+m[1]+"$")),i=i&&i[1]||0,i&&I("^\\s*"+m[0]+m[2]+E(i)+m[1]).test(l)?t.unwrap(I(m[0]+E(i)+U+m[1]),I("\\s*"+m[0]+m[2]+E(i)+m[1])):t.outdent(I(f)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),u.update({},0)};