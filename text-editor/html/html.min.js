/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.2.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function R(e){return e.split(/\s+/)[0]}function B(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function j(e,t,r){var d,n=p.$(),i=n.value,o=n.before,l=_[t],a=_[r]||r,s=R(l),f=R(a),u=B(o),c=M[""];return N=l,p[0](),i&&i!==c?(console.log("\\n"+L+z[0]+a+z[1]+"\\s*"+z[0]+z[2]+f+z[1]+"\\n"),p.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,C[0]+C[2]+f+C[1]+"\n"+L+C[0]+a+C[1]).wrap(C[0]+l+C[1]+"\n"+L+C[0]+a+C[1],C[0]+C[2]+f+C[1]+"\n"+C[0]+C[2]+s+C[1]+"\n\n",1).replace(y("\\n"+L+z[0]+a+z[1]+"\\s*"+z[0]+z[2]+f+z[1]+"\\n","g"),"\n"+C[0]+C[2]+s+C[1]+"\n\n"+C[0]+l+C[1]+"\n").select(p.$().end),U&&w.tools.p.click(e,p),p[1](),!1):void((d=o.match(y("(?:^|\\n)[\\t ]+"+z[0]+"("+z[2]+"?)(?:"+R(_.ul)+"|"+R(_.ol)+")"+A+z[1]+"\\s*$")))?p.insert("\n"+u+(d[1]?"":L),-1):(d=o.match(y(z[0]+f+S+z[1]+".*?$")))?y(z[0]+z[2]+f+z[1]+"\\s*$").test(o)?p.tidy("\n"+u,!1).insert(c).wrap(C[0]+f+d[1]+C[1],C[0]+C[2]+f+C[1]):y(z[1]+"\\s*$").test(o)?p.insert(c).wrap("\n"+u+L+C[0]+l+C[1]+"\n"+u+L+L+C[0]+f+d[1]+C[1],C[0]+C[2]+f+C[1]+"\n"+u+L+C[0]+C[2]+s+C[1]+"\n"+u):p.insert(C[0]+C[2]+f+C[1]+"\n"+u+C[0]+f+d[1]+C[1],-1).insert(c):y(z[0]+z[2]+f+z[1]+"\\s*$").test(o)?p.insert(c).wrap("\n"+u+C[0]+a+C[1],C[0]+C[2]+f+C[1]):p.tidy("\n\n").insert(c).wrap(C[0]+l+C[1]+"\n"+L+C[0]+a+C[1],C[0]+C[2]+f+C[1]+"\n"+C[0]+C[2]+s+C[1]))}function Y(e,t){return!t.get(0)&&U&&w.tools.p.click(e,t),t}function P(e){return m(e.replace(/\s+/g," "))}function V(e){return P(e).replace(y(z[0]+".*?"+z[1],"g"),"").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;")}function F(e){return P(e).replace(y(z[0]+".*?"+z[1],"g"),"").replace(/\s/g,"%20").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29")}var N,r="–",n="…",i="↑",o="↓",l="↵",a="⌘",s="✘",f="⇧",u=window,p=(document,new TE(e)),d=p._,h=d.extend,g=d.each,b=d.x,m=d.trim,v=d.edge,y=d.pattern,k=d.i,w=p.ui(h({auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+s],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+o],sup:["Superscript",a+"+"+i],abbr:["Abbreviation",a+"+"+f+"+?"],p:["Paragraph",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),x=d.format,$=p.config,T=$.states,E=$.languages,_=$.formats,L=($.classes,$.tab),C=$.union.unit,O=$.union.data,z=$.union_x.unit,D=$.union_x.data,H=$.suffix,A="(?:"+D[3]+"[^"+z[0]+z[1]+"]*?)?",S="(|"+D[3]+"[^"+z[0]+z[1]+"]*?)",I="([\\s\\S]*?)",M=E.placeholders,U=$.auto_p;return p.type="HTML",h(w.tools,{clear:{i:"eraser",click:function(e,t){var r=t[0]().$(),n=r.value;return y(z[0]+"[^"+z[0]+z[1]+"]+?"+z[1]).test(n)||r.before.slice(-1)===C[1]||r.after[0]===C[0]?t.replace(y(z[0]+"[^"+z[0]+z[1]+"]+?"+z[1],"g"),"").unwrap(y(z[0]+"[^"+z[2]+z[0]+z[1]+"]+?"+z[1]),y(z[0]+z[2]+"[^"+z[0]+z[1]+"]+?"+z[1])):t.insert(""),t[1](),!!r.after}},b:{i:"bold",click:function(e,t){return Y(e,t).i().format(_.b),!1}},i:{i:"italic",click:function(e,t){return Y(e,t).i().format(_.i),!1}},u:{i:"underline",click:function(e,t){return Y(e,t).i().format(_.u),!1}},s:{i:"strikethrough",click:function(e,t){return Y(e,t).i().format(x(_.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,r=_.a,n=E.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,l){l=F(l),i=l;var s,f,a=u.location.host;-1!==i.indexOf("://")&&(s=1),""!==a&&-1!==i.indexOf("://"+a)&&(s=0),/^([.\/?&#]|javascript:)/.test(i)&&(s=0),t.blur().ui.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){o=V(n),Y(e,t).$().length||t.insert(M[""]),f=$.advance_a&&s?x("%4rel%1%2nofollow%3%4target%1%2_blank%3",O):"",t.i().format(x(r+"%4href%1%2"+i+"%3",O)+(o?x("%4title%1%2"+o+"%3",O):"")+f)})}),!1}},img:{i:"image",click:function(e,t){var f,u,r=t.$(),n=_.img,i=_.figure,o=_.figcaption,l=r.value,a=E.modals.img,s=$.advance_img;return t.ui.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,r){r=F(r),f=r,t.blur().ui.prompt(["img[title]",a.title[s?2:1]],a.placeholder[s?2:1],0,function(e,t,r){u=V(r),l||(l=f.split(/[\/\\\\]/).pop()),l=V(l),t[0](),s&&u?(t.tidy("\n\n","").insert(C[0]+i+C[1]+"\n"+L+C[0]+n+x("%4alt%1%2"+l+"%3%4src%1%2"+f+"%3",O)+H+"\n"+L+C[0]+o+C[1]+u+C[0]+C[2]+R(o)+C[1]+"\n"+C[0]+C[2]+R(i)+C[1]+"\n\n",-1,1),U&&w.tools.p.click(e,t)):Y(e,t).tidy(y(z[0]+"[^"+z[0]+z[1]+z[2]+"]+?"+z[1]+"\\s*$").test(t.$().before)?"":" ","").insert(C[0]+n+x("%4alt%1%2"+l+"%3%4src%1%2"+f+"%3",O)+(u?x("%4title%1%2"+u+"%3",O):"")+H+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=_.sub,n=_.sup,i=R(n);return Y(e,t)[0]().unwrap(y(z[0]+i+A+z[1]),C[0]+C[2]+i+C[1]).i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=_.sub,n=_.sup,i=R(r);return Y(e,t)[0]().unwrap(y(z[0]+i+A+z[1]),C[0]+C[2]+i+C[1]).i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var d,h,r=t.$(),n=m(r.value),i=E.modals.abbr,o=t.get(),l=m(n||M[""]),a=_.abbr,s=R(a),f=z[0]+b(a)+S+z[1],u=z[0]+b(a)+A+z[1],c=z[0]+z[2]+s+z[1],p=y(f+I+c);return o.replace(p,function(e,t,r){(r=m(r))&&(T.abbr[r]=(t.match(y(x("%4+title%1%2\\s*(.*?)\\s*%3",D)))||["",""])[1])}),d=T.abbr,n&&d[n]?(t.i().format(a+x("%4title%1%2"+d[n]+"%3",O)),!1):(t.record().ui.prompt(["abbr[title]",i.title],d[l]||i.placeholder,!d[n],function(e,t,r,i){r=V(r||i),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(h in d)if(V(d[h])===r){t.insert(h);break}Y(e,t).unwrap(y(u),y(c)).unwrap(y(u),y(c),1).i().format(a+x("%4title%1%2"+r+"%3",O))[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var p,r=t.$(),n=r.value,i=_.p,o=_.br,l=R(i),a=R(o),s=r.before,f=r.after,u=B(s),c=M[""];if(t[0](),n&&-1!==n.indexOf("\n")){var d=y("^(?:\\s*"+z[0]+l+A+z[1]+"\\s*)+"+I+"(?:\\s*"+z[0]+z[2]+l+z[1]+"\\s*)+$");d.test(n)?t.replace(d,"$1").replace(y("\\s*"+z[0]+z[2]+l+z[1]+"\\s*"+z[0]+l+A+z[1]+"\\s*","g"),"\n\n").replace(y("\\s*"+z[0]+a+A+z[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+C[0]+o+H+"\n").replace(y("(\\s*"+z[0]+a+A+H+"\\s*){2,}","g"),C[0]+C[2]+l+C[1]+"\n"+C[0]+i+C[1]).wrap(C[0]+i+C[1],C[0]+C[2]+l+C[1],1).replace(y("("+z[0]+l+A+z[1]+")+","g"),"$1").replace(y("("+z[0]+z[2]+l+z[1]+")+","g"),"$1").tidy("\n")}else y("^\\s*"+z[0]+z[2]+l+z[1]).test(f)?y(z[0]+l+A+z[1]+"\\s*$").test(s)?t.unwrap(y("\\s*"+z[0]+l+A+z[1]+"\\s*"),y("\\s*"+z[0]+z[2]+l+z[1])).replace(c,"").tidy("\n","\n"+u):(p=s.match(y(z[0]+l+S+z[1]+".*?$")))&&t.wrap(C[0]+C[2]+l+C[1]+"\n"+u+C[0]+l+p[1]+C[1],"").insert(c):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[_.p,_.h1,_.h2,_.h3,_.h4,_.h5,_.h6],i=[];g(n,function(e,t){i[t]=R(e)});var l=(b(n).join("|"),b(i).join("|")),a="\\s*"+z[0]+"("+l+")"+S+z[1]+"\\s*",s=y("\\s*"+z[0]+"(?:"+l+")"+A+z[1]+"\\s*"),f=y("\\s*"+z[0]+z[2]+"(?:"+l+")"+z[1]+"\\s*"),u=r.value.match(y("^"+a));u||(u=r.before.match(y(a+"$"))||[]);var c=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(s,f).unwrap(s,f,1).i().tidy("\n\n").format(p>5?i[0]+c:i[p+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var r=t.$(),n=r.value,i=_.blockquote,o=_.q,l=_.p,a=R(l),s=z[0]+a+A+z[1];if(y("(^|\\n|"+s+")$").test(r.before)){if(U&&(n===M[""]||y("("+s+")$").test(r.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),U&&(!n||t.match(y("^[^"+z[0]+"\\n]*?[^"+z[1]+"]$"))?t.wrap(L+C[0]+l+C[1],C[0]+C[2]+a+C[1]):t[y("((^|\\n)"+L+")+").test(n)?"outdent":"indent"](L)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function g(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,i=$.auto_encode_html,o=_.pre,l=_.code,a=R(o),s=R(l),f=z[0]+a+A+z[1]+"\\s*"+z[0]+s+A+z[1]+"\\s*",u="\\s*"+z[0]+z[2]+s+z[1]+"\\s*"+z[0]+z[2]+a+z[1],c=y(f+"\\s*$"),p=y("^\\s*"+u),d=y("^"+I+"$");return y("(^|\\n|"+f+")$").test(r.before)?c.test(r.before)&&p.test(r.after)?t[0]().unwrap(y(c),y(p)).replace(d,g)[1]():t[0]().tidy("\n\n").wrap(C[0]+o+C[1]+C[0]+l+C[1],C[0]+C[2]+s+C[1]+C[0]+C[2]+a+C[1]).insert(n||M[""]).replace(d,h)[1]():t[0]().format(l).loss().replace(d,function(e){return P(y("^"+z[0]+z[2]+s+z[1]).test(t.$().after)?h(e):g(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=_.ol,n=_.ul,i=R(r),o=R(n),l="("+b(o)+"|"+b(i)+")";return t.match(y(z[0]+l+A+z[1]+I+z[0]+z[2]+l+z[1]))?t[0]().replace(y(z[0]+i+S+z[1],"g"),C[0]+o+"$1"+C[1]).replace(y(z[0]+z[2]+i+z[1],"g"),C[0]+C[2]+o+C[1])[1]():j(e,n,_.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=_.ol,n=_.ul,i=R(r),o=R(n),l="("+b(o)+"|"+b(i)+")";return t.match(y(z[0]+l+A+z[1]+I+z[0]+z[2]+l+z[1]))?t[0]().replace(y(z[0]+o+S+z[1],"g"),C[0]+i+"$1"+C[1]).replace(y(z[0]+z[2]+o+z[1],"g"),C[0]+C[2]+i+C[1])[1]():j(e,r,_.li),!1}},table:function(e,t){var S,I,M,U,r=T.tr,n=T.td,i=E.modals.table,o=E.placeholders.table,l=m(x(o[0],[1,1])),a=$.advance_table?L:"",s=_.table,f=_.caption,u=_.thead,c=_.tbody,p=_.tfoot,d=_.tr,h=_.th,g=_.td,b=R(s),y=R(f),w=R(u),q=R(c),O=R(p),z=R(d),D=R(h),H=R(g),A=[];return t.$().value===l?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,$,T){I=v(k($)||T,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,$){M=v(k(n)||$,r[0],r[1]),t.blur().ui.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,r){var i,v,k,T,E,n="";for(U=P(r),i=0;M>i;++i){for(S=a+L+C[0]+d+C[1]+"\n",v=0;I>v;++v)S+=a+L+L+C[0]+g+C[1]+m(x(o[1],[i+1,v+1]))+C[0]+C[2]+H+C[1]+"\n";S+=a+L+C[0]+C[2]+z+C[1],A.push(S)}for(A=A.join("\n"),S=L+(a?C[0]+u+C[1]+"\n"+L+L+C[0]+d+C[1]:C[0]+z+C[1])+"\n",k=0;I>k;++k)S+=a+L+L+C[0]+h+C[1]+m(x(o[0],[1,k+1]))+C[0]+C[2]+D+C[1]+"\n";if(a){for(n+=L+C[0]+p+C[1]+"\n",n+=L+L+C[0]+d+C[1]+"\n",k=0;I>k;++k)n+=L+L+L+C[0]+g+C[1]+m(x(o[2],[1,k+1]))+C[0]+C[2]+H+C[1]+"\n";n+=L+L+C[0]+C[2]+d+C[1]+"\n",n+=L+C[0]+C[2]+O+C[1]+"\n"}S+=a+L+C[0]+C[2]+z+C[1]+(a?"\n"+L+C[0]+C[2]+w+C[1]+"\n"+n+L+C[0]+c+C[1]:"")+"\n",A=S+A+(a?"\n"+L+C[0]+C[2]+q+C[1]:"")+"\n",t.tidy("\n\n").insert(C[0]+s+C[1]+"\n"+(U&&f?L+C[0]+f+C[1]+U+C[0]+C[2]+y+C[1]+"\n":"")+A+C[0]+C[2]+b+C[1],0),T=t.$(),E=T.start+T.value.indexOf(l),t.select(E,E+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=B(t.$().before);return t.tidy("\n\n","").insert(r+C[0]+_.hr+H+"\n\n",-1),!1}}}),$.keys&&h(w.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=B(t.$().before);return t.tidy("\n","").insert(r+C[0]+_.br+H+"\n",-1),!1},enter:function(e,t){var c,p,d,r=t.$(),n=r.value,i=t.get(),o=_.p,l=_.li,a=R(o),s=R(l),u=(B(r.before),M[""]);if(!n||n===u){if(c=r.after.match(y("^\\s*"+z[0]+z[2]+"("+a+"|"+s+")"+z[1])))p=c[1],w.tools["li"===p?N:p].click(e,t);else{if(!(U&&o&&m(i)&&r.end===i.length&&y("^\\s*[^"+z[0]+"\\n]*?[^"+z[1]+"]\\s*$").test(i)))return;i=C[0]+o+C[1]+i+C[0]+C[2]+a+C[1]+"\n"+C[0]+o+C[1],d=u+C[0]+C[2]+a+C[1],t.set(i+d).select(i.length,(i+u).length)}return!1}},tab:function(e,t){var r=t.$(),n=_.li,i=R(n),o=B(r.before);return y(z[0]+z[2]+n+z[1]).test(r.after)?(t[0]().wrap("\n"+o+L+C[0]+(_[N]||N)+C[1]+"\n"+o+L+L+C[0]+n+C[1],C[0]+C[2]+i+C[1]+"\n"+o+L+C[0]+C[2]+N+C[1]+"\n"+o).insert(M[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var i,r=t.$(),n=r.value,o=r.before,l=r.after,a=z[0]+"[^"+z[0]+z[1]+"]+?"+z[1];return!n&&y(a+"$").test(o)?(i=o.split(C[0]).pop().match(y("^([^"+z[2]+"\\s]+).*?"+z[1]+"$")),i=i&&i[1]||0,i&&y("^\\s*"+z[0]+z[2]+i+z[1]).test(l)?t.unwrap(y(z[0]+i+A+z[1]),y("\\s*"+z[0]+z[2]+i+z[1])):t.outdent(y(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),p.update({},0)};