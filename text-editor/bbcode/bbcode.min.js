/*!
 * ==========================================================
 *  BBCODE TEXT EDITOR PLUGIN 1.0.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.BBCode=function(A,e){function a(A){return A.split(T("("+F[3]+")+"))[0]}function o(A){return i(A.replace(/\s+/g," "))}function s(A){return S(o(A),[/(<.*?>)|(\[.*?\])/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var t,E=new TE.HTML(A,{auto_p:0,advance_table:0,tools:"clear | b i u s | sub sup | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",unit:[[["[","]"]],[["\\u005B","\\u005D"],["\\u003D","\\u0022","\\u0022","\\u0020|\\u003D"]]],formats:{b:"b",i:"i",u:"u",s:"s",a:"url",email:"email",p:"",blockquote:"quote",code:"code",table:"table=1",caption:""}}),O=E.ui,R=E._,I=R.dom.get,L=R.x,N=R.extend,n=R.event.fire,r=R.hook.set,T=R.pattern,S=R.replace,i=R.trim,l=E.config.unit[1][0],F=E.config.unit[1][1];E.update(e,0),E.type="BBCode";var G=E.config,c=G.formats,f=G.languages,H=(G.states,G.tab,f.placeholders);return N(O.tools,{a:{click:function(A,e){var E=c.a,t=f.modals.a,R=e.$().value;return/^[a-z]+:\/\/\S+$/i.test(R)?(e.format(E),!1):/^[\w.-]+@[\w.-]+(?:\.[\w.-]+)?$/i.test(R)?(e.format(c.email),!1):(O.prompt(["a[href]",t.title[0]],t.placeholder[0],1,function(A,e,O){e.format(E+"="+s(O))}).record(),!1)}},img:{click:function(A,e){var E=c.img,t=f.modals.img;return e.$().length?(e.format(E),!1):(O.prompt(["img[src]",t.title[0]],t.placeholder[0],1,function(A,e,O){e[0]().format(E).insert(s(O))[1]()}).record(),!1)}},abbr:0,p:{click:function(A,e){return e.$().length?(e.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(e.tidy("\n\n").insert(H[""]),!1)}},"blockquote,q":{click:function(A,e){return e.format(c.blockquote,0,"\n\n","\n"),!1}},"pre,code":{click:function(A,e){function R(A){return E?S(A,["&","<",">"],["&amp;","&lt;","&gt;"]):A}function I(A){return E?S(A,["&amp;","&lt;","&gt;"],["&","<",">"]):A}var E=G.auto_encode_html,O=c.code,t=a(O);return e[0]().format(O,0,"\n\n","\n").replace(/^[\s\S]*?$/,function(A){return T("^\\s*"+l[0]+l[2]+L(t)+l[1]).test(e.$().after)?R(A):I(A)})[1](),!1}}}),N(O.keys,{"control+shift+?":0}),r("enter.modal.prompt:table>caption",function(A){!c.caption&&(t=I("[name=y]",O.el.modal))&&n("click",t)}),E.update({},0)};