/*!
 * ==========================================================
 *  BBCODE TEXT EDITOR PLUGIN 1.0.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.BBCode=function(e,t){function h(e){return e.split(s("("+p[3]+")+"))[0]}function v(e){return u(e.replace(/\s+/g," "))}function g(e){return l(v(e),[/(<.*?>)|(\[.*?\])/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var n=new TE.HTML(e,{auto_p:0,advance_table:0,tools:"clear | b i s | sub sup | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",unit:[[["[","]"]],[["\\u005B","\\u005D"],["\\u003D","\\u0022","\\u0022","\\u0020|\\u003D"]]],formats:{b:"b",i:"i",u:"u",s:"s",a:"url",email:"email",p:"",blockquote:"quote",code:"code",ol:"list=1",ul:"list",li:"*",table:"table=1",caption:""}}),r=n.ui,i=n._,o=i.x,f=i.extend,u=i.trim,l=i.replace,s=i.pattern,a=i.hook,c=i.event,d=n.config.unit[1][0],p=n.config.unit[1][1];n.update(t,0),n.type="BBCode";var m=n.config,w=(m.states,m.languages),x=m.formats,$=(m.tab,w.placeholders);return f(r.tools,{a:{click:function(e,t){var n=x.a,r=w.modals.a,i=t.$().value;return/^[a-z]+:\/\/\S+$/i.test(i)?(t.format(n),!1):/^[\w.-]+@[\w.-]+(?:\.[\w.-]+)?$/i.test(i)?(t.format(x.email),!1):(t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,r){t.format(n+"="+g(r))}),!1)}},img:{click:function(e,t){var n=x.img,r=w.modals.img;return t.$().length?(t.format(n),!1):(t.record().ui.prompt(["img[src]",r.title[0]],r.placeholder[0],1,function(e,t,r){t[0]().format(n).insert(g(r))[1]()}),!1)}},abbr:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert($[""]),!1)}},"blockquote,q":{click:function(e,t){return t.format(x.blockquote,0,"\n\n","\n"),!1}},"pre,code":{click:function(e,t){function f(e){return n?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function u(e){return n?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var n=m.auto_encode_html,r=x.code,i=h(r);return t[0]().format(r,0,"\n\n","\n").replace(/^[\s\S]*?$/,function(e){return s("^\\s*"+d[0]+d[2]+o(i)+d[1]).test(t.$().after)?f(e):u(e)})[1](),!1}}}),f(r.keys,{"control+shift+?":0}),a.set("enter.modal.prompt:table>caption",function(e){var t;!x.caption&&(t=r.el.modal.querySelector("[name=y]"))&&c.fire("click",t)}),n.update({},0)};