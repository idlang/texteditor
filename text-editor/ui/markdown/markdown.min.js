/*!
 * ==========================================================
 *  MARKDOWN TEXT EDITOR PLUGIN 1.3.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.Markdown=function(e,t){function v(e){return y(e.replace(/\s+/g," "))}function w(e){return b(v(e),[/<.*?>/g,'"',"'","(",")","[","]"],["","&#34;","&#39;","&#40;","&#41;","&#91;","&#93;"])}function $(e){return b(v(e),[/<.*?>/g,/\s/g,'"',"(",")","[","]"],["","%20","%22","%28","%29","%5B","%5D"])}var n=TE.ui.HTML||TE.ui,r=n(e,{extra:0,auto_p:0,auto_close:{"`":"`","*":"*",_:"_","~":"~"},tools:"b i s | a img | sup abbr | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{a:{"":[""]},img:{}},languages:{modals:{a:{title:["Link URL/Reference ID"]},img:{title:["Image URL/Reference ID"]},sup:{title:"Footnote ID"}}},advance_br:1,"advance_h1,h2":1,"advance_pre,code":1,"close_h1,h2,h3,h4,h5,h6":0,close_tr:0,formats:{b:["**","__"],i:["_","*"],s:["~~"],h1:["=","#"],h2:["-","##"],h3:["###"],h4:["####"],h5:["#####"],h6:["######"],blockquote:[">"],code:["`","~"],ul:["-","+","*"],ol:["%1."],hr:["---","+++","***"]}}),i=r.ui,u="	",o=TE.is,f=o.o,a=function(e){return!o.x(e)},s=o.s,c=r._,l=c.edge,p=c.x,d=c.extend,h=c.format,g=c.i,m=c.pattern,b=c.replace,y=c.trim;r.update(d({languages:{tools:{sup:["Footnote",r.config.languages.tools.sub[1]]}}},t),0),r.type="Markdown";var x=r.config,k=x.extra,E=x.formats,T=x.languages,_=x.states,C=x.tab,S=T.placeholders,z="( +["+p(E.ul).join("")+"] )",L=0;return k||(x["advance_pre,code"]=0),r.mark=function(e,t,n,i){f(e)||(e=[e]),a(n)||(n=" "),a(i)||(i="");var u=r.h,o=r[0]().$(),s=e[0]+i,c=i+(a(e[1])?e[1]:e[0]),l=o.value,d=p(s),h=p(c),g=m("^"+d+"([\\s\\S]*?)"+h+"$"),b=m(d+"$"),y=m("^"+h),v=o.before,w=o.after;return l?n=!1:r.insert(S[""]),r.toggle(t?!g.test(l):!b.test(v)&&!y.test(w),[function(e){e.unwrap(s,c,1).tidy(/<[^\/<>]+?>$/.test(v)?"":n,/^<\/[^<>]+?>/.test(w)?"":n).wrap(s,c,t)},function(e){e.unwrap(s,c,t)}])[u]()},d(i.tools,{b:{click:function(e,t){return t.i().mark(E.b[0]),!1}},i:{click:function(e,t){return t.i().mark(E.i[0]),!1}},u:0,s:k?{click:function(e,t){return t.i().mark(E.s[0]),!1}}:0,a:{click:function(e,t){var p,d,h,g,m,b,v,n=t.$(),r=n.before,u=n.value,o=n.after,f=t.get(),a=/^ {0,3}\[[^\^]+?\]:/.test(f.split("\n").pop())?"\n":"\n\n",s=f.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],c=T.modals.a,l=c.placeholder[0];if(/^([a-z]+:\/\/\S+|<[a-z]+:\/\/\S+>)$/.test(u))return t.tidy(" ").mark(["<",">"],1),!1;for(v in s)v=" "+y(s[v]).replace(/^\[|\]:$/g,""),_.a[v]=1;return p=_.a,i.prompt(["a[href]",c.title[0]],l,0,function(e,t,f){var v=""===f;f=$(f),t[0](),p[f]?(t.trim(y(r)?" ":"",/^\n+ {0,3}\*?\[/.test(o)?!1:" ").mark(["[","]["+f+"]"],0,!1),g=s.indexOf(" ["+f+"]:"),-1===g&&1!==p[f]&&(n=t.$(),r=n.before,m=n.start,b=n.end,t.set(r+u+y(n.after,1)+a+" ["+(f||y(u)||S[""])+"]: "+(v?"":p[f][0]+(p[f][1]?' "'+p[f][1]+'"':""))).select(m,b),v&&t.focus(1).insert(l))):(d=f,i.prompt(["a[title]",c.title[1]],c.placeholder[1],0,function(e,t,n){h=w(n),u||t.insert(S[""]),t.i().trim(y(r)?" ":"",y(o)?/^\n+ {0,3}\*?\[/.test(o)?"\n\n ":" ":"").wrap("[","]("+d+(h?' "'+h+'"':"")+")")})),t[1]()}).record(),!1}},img:{click:function(e,t){var h,g,m,b,v,x,k,n=t.$(),r=n.value,u=r,o=n.before,f=n.after,a=t.get(),s=/^ {0,3}\[[^\^]+?\]:/.test(a.split("\n").pop())?"\n":"\n\n",c=a.match(/^ {0,3}\[[^\^]+?\]:/gm)||[],l=T.modals.img,p=/^\n* {0,3}\[.+?\]:/.test(f)?" ":"",d=y(f);for(k in c)k=" "+y(c[k]).replace(/^\[|\]:$/g,""),!_.img[k]&&(_.img[k]=1);return h=_.img,i.prompt(["img[src]",l.title[0]],l.placeholder[0],1,function(e,t,f){f=$(f),g=f,u||(u=g.split(/[\/\\\\]/).pop()),u=w(u),t[0]().trim(y(o)?"\n\n":"",p),h[f]?(t.insert("!["+u+"]["+f+"]\n\n",0,1),p&&t.select(t.$().start),b=c.indexOf(" ["+f+"]:"),-1===b&&(n=t.$(),o=n.before,v=n.start,x=n.end,t.set(o+r+n.after+(d?s:"")+" ["+f+"]: "+h[f][0]+(h[f][1]?' "'+h[f][1]+'"':"")).select(v,x))):i.prompt(["img[title]",l.title[1]],l.placeholder[1],0,function(e,t,n){m=w(n),t.insert("!["+u+"]("+g+(m?' "'+m+'"':"")+")\n\n",0,1),p&&t.select(t.$().start)}),t[1]()}),!1}},sup:k?{i:"thumb-tack",click:function(t,n){var p,r=n.$(),u=r.before,o=r.after,f=T.modals.sup,a=n.get(),s=/^ {0,3}\[\^.+?\]:/.test(y(a).split("\n").pop())?"\n":"\n\n",c=a.match(/^ {0,3}\[\^.+?\]:/gm)||[],l=0;for(l in c)c[l]=" "+y(c[l]);return l=c.length+1,i.prompt(["sup[id]",f.title],r.value||f.placeholder||l,0,function(t,n,r,i){r=y(r||i)||l,p=c.indexOf(" [^"+r+"]:"),-1!==p?(l=a.indexOf(c[p])+3,n.select(l,l+r.length),e.scrollTop=n.$(1).caret[0].y):n.trim(y(u)?" ":"",!y(o)||/^[\t ]*\n+[\t ]*/.test(o)?"\n\n":" ").insert("[^"+r+"]").set(y(n.get(),1)+s+" [^"+r+"]: ").focus(1).insert(S[""])}),!1}}:0,abbr:k?{click:function(t,n){var r=n.$(),u=y(r.value),o=T.modals.abbr,f=n.get(),a=v(u||S[""]),s=/^ {0,3}\*\[.+?\]:/.test(f.split("\n").pop())?"\n":"\n\n",c=f.match(/^ {0,3}\*\[.+?\]:/gm)||[],l=_.abbr,p=0;for(p in c)c[p]=" "+y(c[p]);return p=c.indexOf(" *["+a+"]:"),u&&-1!==p?(p=f.indexOf(c[p])+3,n.select(p,p+a.length),e.scrollTop=n.$(1).caret[0].y,!1):(i.prompt(["abbr[title]",o.title],l[a]||o.placeholder,!l[u],function(e,t,n,i){if(n=w(n),t[0]().set(y(t.get(),1)+(r.before||u?s:"")+" *["+a+"]: ").focus(1).insert(n||i),a===S[""]){var o=t.$().start;t.select(o-3-a.length,o-3)}t[1]()}).record(),!1)}}:0,p:{click:function(e,t){return t.$().length?(t.tidy("\n\n").replace(/([\t ]*\n[\t ]*){2,}/g,"\n\n"),!1):(t.tidy("\n\n").insert(S[""]).scroll(2),!1)}},br:{click:function(e,t){var n=x.advance_br;return!s(n)&&n&&(n="  \n"),t.trim().insert(n||"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{click:function(e,t){L>5?L=0:L++;var n=t.$(),r=x["advance_h1,h2"],i="\\s?["+p(E.h1[0]+E.h2[0])+"]+\\s*",u=p(E.h1[1]),o=n.before.replace(m("["+u+"\\s]+$"),""),f=v(n.value).replace(m("^["+u+"\\s]+|["+u+"\\s]+$","g"),"").replace(m(i+"$"),"")||S[""],a=n.after.replace(m("^["+u+"\\s]+"),"").replace(m("^"+i),""),s=["",E.h1[r?0:1],E.h2[r?0:1],E.h3[0],E.h4[0],E.h5[0],E.h6[0]];return t[0]().set(o+f+a).select(o.length,(o+f).length).tidy("\n\n"),0===L||(3>L&&r?t.wrap("","\n"+f.replace(/./g,s[L])):t.wrap(s[L]+" ",x["close_h1,h2,h3,h4,h5,h6"]?" "+s[L]:"")),t[1](),!1}},"blockquote,q":{click:function(e,t){var n=t.$(),r=n.value,i=E.blockquote[0];return r===S[""]?(t.select(),!1):r?(t.tidy(m(i+" $").test(n.before)?!1:"\n\n")[m("^"+i).test(r)?"outdent":"indent"](i+" "),!1):(t[0]().tidy("\n\n").insert(i+" ",0).insert(S[""])[1](),!1)}},"pre,code":{click:function(e,t){var c,l,d,n=t.$(),r=n.before,i=n.value,o=x["advance_pre,code"],f=E.code,a=f[1]||f[0];return a=a+a+a,!s(o)&&o?o=a:s(o)&&-1!==o.indexOf("%")&&(o=h(o,[a])),c="( {4,}|\\t"+(s(o)?"|"+p(o):"")+")",m("(^|\\n)"+c+"?$").test(r)?o?(t.mark([o,o.split(/\s+/)[0]],0,"\n\n","\n"),!1):(o=C===u?u:"    ",i?i===S[""]&&m(c+"$").test(r)?(t.select(n.start-o.length,n.end),!1):(t.tidy("\n\n")[m("^"+c).test(i)?"outdent":"indent"](o),!1):(t[0]().tidy("\n\n"),l=t.$().start,d=o+S[""],t.insert(d).select(l+o.length,l+d.length)[1](),!1)):(t.mark(f[0]),!1)}},ul:{click:function(e,t){var y,n=t.$(),r=n.value,i=n.before,u=n.after,o=E.ul[0],f=E.ol[0],a=p(o),s=h(p(f),["\\d+"]),c=m("(^|\\n)([\\t ]*) "+a+" (.*)$"),l=m("^(.*) "+a+" ","gm"),d=m("(^|\\n)([\\t ]*) "+s+" (.*)$"),g=m("^(.*) "+s+" ","gm"),b=S[""];return r?(r===b?t.select():g.test(r)?t.replace(g,"$1 "+o+" "):l.test(r)?t.replace(l,"$1"):t.replace(/^(\s*)(\S.*)$/gm,"$1 "+o+" $2"),!1):u&&i&&("\n"!==u[0]||"\n"!==i.slice(-1))?(y=d.test(i)?i.replace(d,"$1$2 "+o+" $3"):c.test(i)?i.replace(c,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+o+" $3"),t.set(y+u).select(y.length),!1):(t[0]().tidy("\n\n").insert(" "+o+" ",0).insert(b)[1](),!1)}},ol:{click:function(e,t){var w,n=t.$(),r=n.value,i=n.before,u=n.after,o=E.ul[0],f=E.ol[0],a=h(f,[1]),s=p(o),c=h(p(f),["\\d+"]),l=m("(^|\\n)([\\t ]*) "+s+" (.*)$"),d=m("^(.*) "+s+" ","gm"),g=m("(^|\\n)([\\t ]*) "+c+" (.*)$"),b=m("^(.*) "+c+" ","gm"),y=S[""],v=0;return r?(r===y?t.select():d.test(r)?t.replace(d,function(e,t,n){return++v,t+" "+h(f,[v])+" "}):b.test(r)?t.replace(b,"$1"):t.replace(/^(\s*)(\S.*)$/gm,function(e,t,n){return++v,t+" "+h(f,[v])+" "+n}),!1):u&&i&&("\n"!==u[0]||"\n"!==i.slice(-1))?(w=l.test(i)?i.replace(l,"$1$2 "+a+" $3"):g.test(i)?i.replace(g,"$1$2$3"):i.replace(/(^|\n)(\s*)([^\n]*)$/,"$1$2 "+a+" $3"),t.set(w+u).select(w.length),!1):(t[0]().tidy("\n\n").insert(" "+a+" ",0).insert(y)[1](),!1)}},table:k?function(e,t){var s,c,p,n=_.tr,r=_.td,u=T.modals.table,o=T.placeholders.table,f=h(o[0],[1,1]),a=[];return t[0]().$().value===f?(t.select(),!1):(i.prompt(["table>td",u.title[0]],u.placeholder[0],0,function(e,t,d,m){c=l(g(d)||m,r[0],r[1]),i.prompt(["table>tr",u.title[1]],u.placeholder[1],0,function(e,t,r,i){p=l(g(r)||i,n[0],n[1]);var u,d,m,b,y,v;for(u=0;p>u;++u){for(s="|",d=0;c>d;++d)s+=" "+h(o[1],[u+1,d+1])+" |";a.push(s)}for(a=a.join("\n"),s="|",m=0;c>m;++m)s+=" "+h(o[0],[m+1,m+1]).replace(/./g,"-")+" |";for(a=s+"\n"+a,s="|",b=0;c>b;++b)s+=" "+h(o[0],[1,b+1])+" |";a=s+"\n"+a,x.close_tr||(a=a.replace(/^\|\s*|\s*\|$/gm,"")),t.tidy("\n\n").insert(a),y=t.$(),v=y.start+y.value.indexOf(f),t.select(v,v+f.length)[1]()})}),!1)}:0,hr:{click:function(e,t){return t.tidy("\n\n","").insert(E.hr[0]+"\n\n",0),!1}}}),i.tools.sub=i.tools.sup,d(i.keys,{"control+u":0,enter:function(e,t){var n=t.$(),r=E.blockquote[0],u=(E.ul[0],E.ol[0]),o=h(p(u),["\\d+"]),f="(("+p(r)+" )+|"+z+"| +("+o+") )",a=m("^"+f+".*$","gm").exec(n.before.split("\n").pop());if(a){if(a[0]===a[1])return t.outdent(m(f)),!1;if(m("\\s*"+o+"\\s*").test(a[1])){var s=g(y(a[1]));return t.insert("\n"+a[1].replace(/\d+/,s+1),0),!1}return t.insert("\n"+a[1],0),!1}},"shift+tab":function(e,t){var b,n=t.$(),r=n.before,u=n.value,o=n.after,f=E.ol[0],a=p(f),s=h(a,["\\d+"]),c=p(E.blockquote[0]),l=m("  "+z+"$"),d=m("   ( ?"+s+" )$"),g="("+c+" |"+z+"| +"+s+" )";if(u){if(u&&(b=u.match(m("(^|\\n)"+g,"g"))))return t.outdent(m(g)),!1}else{if(b=r.match(m(c+" $")))return t.outdent(b[0]),!1;if(b=r.match(l))return r=r.replace(l,"$1"),t.set(r+o).select(r.length),!1;if(b=r.match(d))return r=r.replace(d,"$1"),t.set(r+o).select(r.length),!1}return i.tools.outdent.click(e,t)},tab:function(e,t){var g,n=t.$(),r=n.before,u=n.value,o=n.after,f=E.ol[0],a=E.blockquote[0],s=p(f),c=p(a),l=m(z+"$"),d=m(" ?"+h(s,["\\d+"])+" $");if(u){if(m("^"+c+" ").test(u))return t.indent(a+" "),!1}else{if(g=r.match(m(c+" $")))return t.insert(g[0],0),!1;if(g=r.match(l))return r=r.replace(l,"  $1"),t.set(r+o).select(r.length),!1;if(g=r.match(d))return r=r.replace(d,"    "+h(f,[1])+" "),t.set(r+o).select(r.length),!1}return i.tools.indent.click(e,t)}}),r.update({},0)};