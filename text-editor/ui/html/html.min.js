/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.3.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(e,t){function S(e){return e.split(b("("+I[3]+")+"))[0]}function W(e){return j=e.match(/(?:^|\n)([\t ]*).*$/),j&&j[1]||""}function q(e,t,n){var g,i=c.$(),l=i.value,a=i.before,r=T[t]||t,s=T[n]||n,o=S(r),f=S(s),u=W(a),d=z[""];return D=r,c[0](),l&&l!==d?(c.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,F[0]+F[2]+f+F[1]+"\n"+C+F[0]+s+F[1]).wrap(F[0]+r+F[1]+"\n"+C+F[0]+s+F[1],F[0]+F[2]+f+F[1]+"\n"+F[0]+F[2]+o+F[1]+"\n\n",1).replace(b("\\n"+p(C)+P[0]+p(s)+P[1]+"\\s*"+P[0]+P[2]+p(f)+P[1]+"\\n","g"),"\n"+F[0]+F[2]+o+F[1]+"\n\n"+F[0]+r+F[1]+"\n").select(c.$().end),x&&w.tools.p.click(e,c)):(g=a.match(b("(?:^|\\n)[\\t ]+"+P[0]+"("+P[2]+"?)(?:"+p(S(T.ul))+"|"+p(S(T.ol))+")"+L+P[1]+"\\s*$")))?c.insert("\n"+u+(g[1]?"":C),0):(g=a.match(b(P[0]+p(f)+N+P[1]+".*?$")))?b(P[0]+P[2]+p(f)+P[1]+"\\s*$").test(a)?c.tidy("\n"+u,!1).insert(d).wrap(F[0]+f+g[1]+F[1],F[0]+F[2]+f+F[1]):b(P[1]+"\\s*$").test(a)?c.insert(d).wrap("\n"+u+C+F[0]+r+F[1]+"\n"+u+C+C+F[0]+f+g[1]+F[1],F[0]+F[2]+f+F[1]+"\n"+u+C+F[0]+F[2]+o+F[1]+"\n"+u):c.insert(F[0]+F[2]+f+F[1]+"\n"+u+F[0]+f+g[1]+F[1],0).insert(d):b(P[0]+P[2]+p(f)+P[1]+"\\s*$").test(a)?c.insert(d).wrap("\n"+u+F[0]+s+F[1],F[0]+F[2]+f+F[1]):c.tidy("\n\n").insert(d).wrap(F[0]+r+F[1]+"\n"+C+F[0]+s+F[1],F[0]+F[2]+f+F[1]+"\n"+F[0]+F[2]+o+F[1]),c[1](),!1}function H(e,t){return!t.get(0)&&x&&w.tools.p.click(e,t),t}function B(e){return m(e.replace(/\s+/g," "))}function A(e){return y(B(e),[b(P[0]+".*?"+P[1],"g"),'"',"'"],["","&#34;","&#39;"])}function U(e){return y(B(e),[b(P[0]+".*?"+P[1],"g"),/\s/g,'"'],["","%20","%22"])}var D,j,n="–",i="…",l="↑",a="↓",r="↵",s="⌘",o="✘",f="⇧",c=TE.ui(e,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],a:{},img:{},abbr:{}},languages:{tools:{clear:["Clear Format",o],b:["Bold",s+"+B"],i:["Italic",s+"+I"],u:["Underline",s+"+U"],s:["Strike",s+"+"+o],a:["Link",s+"+L"],img:["Image",s+"+G"],sub:["Subscript",s+"+"+a],sup:["Superscript",s+"+"+l],abbr:["Abbreviation",s+"+"+f+"+?"],p:["Paragraph",s+"+"+r],br:["Line Break",f+"+"+r],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",s+"+H"],"blockquote,q":["Quote",s+"+Q"],"pre,code":["Code",s+"+K"],ul:["Unordered List",s+"+-"],ol:["Ordered List",s+"++"],table:["Table",s+"+T"],hr:["Horizontal Rule",s+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+i]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+i,"image caption here"+i]},abbr:{title:"Abbreviation",placeholder:"meaning here"+i},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+i]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),u=c._,d=u.edge,p=u.x,g=u.extend,h=u.i,b=u.pattern,m=u.trim,v=u.format,y=u.replace,k=g(c.config,t),w=c.ui,x=k.auto_p,T=(k.classes,k.formats),E=k.languages,_=k.states,M=k.suffix,C=k.tab,F=k.unit[0][0],O=k.unit[0][1],P=k.unit[1][0],I=k.unit[1][1],L="(?:"+I[3]+"[^"+P[0]+P[1]+"]*?)?",N="(|"+I[3]+"[^"+P[0]+P[1]+"]*?)",R="([\\s\\S]*?)",z=E.placeholders;return c.type="HTML",g(w.tools,{clear:{i:"eraser",click:function(e,t){var r,n=t[0]().$(),i=n.before,l=n.after,a=n.value,s=P[0]+"[^"+P[0]+P[1]+"]+?"+P[1],o=P[0]+"[^"+P[2]+P[0]+P[1]+"]+?"+P[1],f=P[0]+P[2]+"[^"+P[0]+P[1]+"]+?"+P[1];return!a&&l&&(r=b("^"+s)).test(l)?(t.replace(r,"",1),!1):(b(s).test(a)||i.slice(-1)===F[1]||l[0]===F[0]?t.replace(b(s,"g"),"").unwrap(b(o),b(f)):t.insert(""),t[1](),!!l)}},b:{i:"bold",click:function(e,t){return H(e,t).i().format(T.b),!1}},i:{i:"italic",click:function(e,t){return H(e,t).i().format(T.i),!1}},u:{i:"underline",click:function(e,t){return H(e,t).i().format(T.u),!1}},s:{i:"strikethrough",click:function(e,t){return H(e,t).i().format(v(T.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var l,a,n=T.a,i=E.modals.a;return w.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,r){r=U(r),l=r;var o,f,s=location.host;-1!==l.indexOf("://")&&(o=1),""!==s&&-1!==l.indexOf("://"+s)&&(o=0),/^([.\/?&#]|javascript:)/.test(l)&&(o=0),w.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){a=A(i),H(e,t).$().length||t.insert(z[""]),f=k.advance_a&&o?O[3]+"rel"+O[0]+O[1]+"nofollow"+O[2]+O[3]+"target"+O[0]+O[1]+"_blank"+O[2]:"",t.i().format(n+O[3]+"href"+O[0]+O[1]+l+O[2]+(a?O[3]+"title"+O[0]+O[1]+a+O[2]:"")+f)})}).record(),!1}},img:{i:"image",click:function(e,t){var f,c,n=t.$(),i=T.img,l=T.figure,a=T.figcaption,r=n.value,s=E.modals.img,o=k.advance_img;return w.prompt(["img[src]",s.title[0]],s.placeholder[0],1,function(e,t,n){n=U(n),f=n,w.prompt(["img[title]",s.title[o?2:1]],s.placeholder[o?2:1],0,function(e,t,n){c=A(n),r||(r=f.split(/[\/\\\\]/).pop()),r=A(r),t[0](),o&&c?(t.tidy("\n\n","").insert(F[0]+l+F[1]+"\n"+C+F[0]+i+O[3]+"alt"+O[0]+O[1]+r+O[2]+O[3]+"src"+O[0]+O[1]+f+O[2]+M+"\n"+C+F[0]+a+F[1]+c+F[0]+F[2]+S(a)+F[1]+"\n"+F[0]+F[2]+S(l)+F[1]+"\n\n",0,1),x&&w.tools.p.click(e,t)):H(e,t).tidy(b(P[0]+"[^"+P[0]+P[1]+P[2]+"]+?"+P[1]+"\\s*$").test(t.$().before)?"":" ","").insert(F[0]+i+O[3]+"alt"+O[0]+O[1]+r+O[2]+O[3]+"src"+O[0]+O[1]+f+O[2]+(c?O[3]+"title"+O[0]+O[1]+c+O[2]:"")+M+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=T.sub,i=T.sup,l=S(i);return H(e,t)[0]().unwrap(b(P[0]+p(l)+L+P[1]),F[0]+F[2]+l+F[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=T.sub,i=T.sup,l=S(n);return H(e,t)[0]().unwrap(b(P[0]+p(l)+L+P[1]),F[0]+F[2]+l+F[1]).i().format(i)[1](),!1}},abbr:{i:"question",click:function(e,t){var g,h,n=t.$(),i=m(n.value),l=E.modals.abbr,a=t.get(),r=m(i||z[""]),s=T.abbr,o=S(s),f=P[0]+p(s)+N+P[1],c=P[0]+p(s)+L+P[1],u=P[0]+P[2]+p(o)+P[1],d=b(f+R+u);return a.replace(d,function(e,t,n){(n=m(n))&&(_.abbr[n]=(t.match(b(I[3]+"+title"+I[0]+I[1]+"\\s*(.*?)\\s*"+I[2]))||["",""])[1])}),g=_.abbr,i&&g[i]?(t.i().format(s+O[3]+"title"+O[0]+O[1]+g[i]+O[2]),!1):(w.prompt(["abbr[title]",l.title],g[r]||l.placeholder,!g[i],function(e,t,n,l){n=A(n||l),t[0](),i||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(h in g)if(A(g[h])===n){t.insert(h);break}H(e,t).unwrap(b(c),b(u)).unwrap(b(c),b(u),1).i().format(s+O[3]+"title"+O[0]+O[1]+n+O[2])[1]()}).record(),!1)}},p:{i:"paragraph",click:function(e,t){var d,n=t.$(),i=n.value,l=T.p,a=T.br,r=S(l),s=S(a),o=n.before,f=n.after,c=W(o),u=z[""];if(t[0](),i&&-1!==i.indexOf("\n")){var g=b("^(?:\\s*"+P[0]+p(r)+L+P[1]+"\\s*)+"+R+"(?:\\s*"+P[0]+P[2]+p(r)+P[1]+"\\s*)+$");g.test(i)?t.replace(g,"$1").replace(b("\\s*"+P[0]+P[2]+p(r)+P[1]+"\\s*"+P[0]+p(r)+L+P[1]+"\\s*","g"),"\n\n").replace(b("\\s*"+P[0]+p(s)+L+P[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+F[0]+a+M+"\n").replace(b("(\\s*"+P[0]+p(s)+L+M+"\\s*){2,}","g"),F[0]+F[2]+r+F[1]+"\n"+F[0]+l+F[1]).wrap(F[0]+l+F[1],F[0]+F[2]+r+F[1],1).replace(b("("+P[0]+p(r)+L+P[1]+")+","g"),"$1").replace(b("("+P[0]+P[2]+p(r)+P[1]+")+","g"),"$1").tidy("\n")}else b("^\\s*"+P[0]+P[2]+p(r)+P[1]).test(f)?b(P[0]+p(r)+L+P[1]+"\\s*$").test(o)?t.unwrap(b("\\s*"+P[0]+p(r)+L+P[1]+"\\s*"),b("\\s*"+P[0]+P[2]+p(r)+P[1])).replace(u,"").tidy("\n","\n"+c):(d=o.match(b(P[0]+p(r)+N+P[1]+".*?$")))&&t.wrap(F[0]+F[2]+r+F[1]+"\n"+c+F[0]+r+d[1]+F[1],"").insert(u).scroll(1):t.tidy("\n\n").format(l,0,"\n\n").scroll(1);return t[1](),!1}},br:{i:"level-down",click:function(e,t){return j=W(t.$().before),t.tidy("\n","").insert(j+F[0]+T.br+M+"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var a,r,n=t.$(),i=[T.p,T.h1,T.h2,T.h3,T.h4,T.h5,T.h6],l=[];for(a in i)l[a]=S(i[a]);var o=(p(i).join("|"),p(l).join("|")),f="\\s*"+P[0]+"("+o+")"+N+P[1]+"\\s*",c=b("\\s*"+P[0]+"(?:"+o+")"+L+P[1]+"\\s*"),u=b("\\s*"+P[0]+P[2]+"(?:"+o+")"+P[1]+"\\s*"),d=n.value.match(b("^"+f));return d||(d=n.before.match(b(f+"$"))||[]),r=d[2]||"",a=+(d[1]||"h0").slice(1),t[0]().unwrap(c,u).unwrap(c,u,1).i().tidy("\n\n").format(a>5?l[0]+r:l[a+1]+r,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var u,n=t.$(),i=n.value,l=T.blockquote,a=T.q,r=T.p,s=S(r),o=p(s),f=b(P[0]+P[2]+o+P[1]),c=z[""];return/(^|\n)$/.test(n.before)?(x&&!f.test(i)&&w.tools.p.click(e,t),n=t.$(),i=n.value,!f.test(i)&&x&&t.select(n.start-(F[0]+r+F[1]).length,n.end+(F[0]+F[2]+s+F[1]).length),i!==c&&x?(t[0]().tidy("\n\n").insert(F[0]+l+F[1]+"\n"+t.$().value.replace(b("^(\\s*"+P[0]+")","gm"),C+"$1")+"\n"+F[0]+F[2]+S(l)+F[1]+"\n\n",0,1),x&&w.tools.p.click(e,t)):(t[0]().format(l,0,"\n\n","\n").loss().replace(b("^(\\s*"+P[0]+")","gm"),C+"$1"),x&&(n=t.$(),u=n.start+(F[0]+r+F[1]+C).length,t.select(u,u+c.length))),t[1]()):t.i().format(a),!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return l?y(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function m(e){return l?y(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),i=n.value,l=k.auto_encode_html,a=T.pre,r=T.code,s=S(a),o=S(r),f=P[0]+p(s)+L+P[1]+"\\s*"+P[0]+p(o)+L+P[1]+"\\s*",c="\\s*"+P[0]+P[2]+p(o)+P[1]+"\\s*"+P[0]+P[2]+p(s)+P[1],u=b(f+"\\s*$"),d=b("^\\s*"+c),g=b("^"+R+"$");return b("(^|\\n|"+f+")$").test(n.before)?u.test(n.before)&&d.test(n.after)?t[0]().unwrap(b(u),b(d)).replace(g,m)[1]():t[0]().tidy("\n\n").wrap(F[0]+a+F[1]+F[0]+r+F[1],F[0]+F[2]+o+F[1]+F[0]+F[2]+s+F[1]).insert(i||z[""]).replace(g,h)[1]():t[0]().format(r).replace(g,function(e){return B(b("^\\s*"+P[0]+P[2]+p(o)+P[1]).test(t.$().after)?h(e):m(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=T.ol,i=T.ul,l=S(n),a=S(i),r="("+p(a)+"|"+p(l)+")";return t.match(b(P[0]+r+L+P[1]+R+P[0]+P[2]+r+P[1]))?t[0]().replace(b(P[0]+p(l)+N+P[1],"g"),F[0]+a+"$1"+F[1]).replace(b(P[0]+P[2]+p(l)+P[1],"g"),F[0]+F[2]+a+F[1])[1]():q(e,i,T.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=T.ol,i=T.ul,l=S(n),a=S(i),r="("+p(a)+"|"+p(l)+")";return t.match(b(P[0]+r+L+P[1]+R+P[0]+P[2]+r+P[1]))?t[0]().replace(b(P[0]+p(a)+N+P[1],"g"),F[0]+l+"$1"+F[1]).replace(b(P[0]+P[2]+p(a)+P[1],"g"),F[0]+F[2]+l+F[1])[1]():q(e,n,T.li),!1}},table:function(e,t){var z,D,j,W,n=_.tr,i=_.td,l=E.modals.table,a=E.placeholders.table,r=m(v(a[0],[1,1])),s=k.advance_table?C:"",o=T.table,f=T.caption,c=T.thead,u=T.tbody,p=T.tfoot,g=T.tr,b=T.th,y=T.td,x=S(o),$=S(f),M=S(c),O=S(u),P=S(p),I=S(g),L=S(b),N=S(y),R=[];return t[0]().$().value===r?(t.select(),!1):(w.prompt(["table>td",l.title[0]],l.placeholder[0],0,function(e,t,k,T){D=d(h(k)||T,i[0],i[1]),w.prompt(["table>tr",l.title[1]],l.placeholder[1],0,function(e,t,i,k){j=d(h(i)||k,n[0],n[1]),w.prompt(["table>caption",l.title[2]],l.placeholder[2],0,function(e,t,n){var l,d,h,w,T,i="";for(W=B(n),l=0;j>l;++l){for(z=s+C+F[0]+g+F[1]+"\n",d=0;D>d;++d)z+=s+C+C+F[0]+y+F[1]+m(v(a[1],[l+1,d+1]))+F[0]+F[2]+N+F[1]+"\n";z+=s+C+F[0]+F[2]+I+F[1],R.push(z)}for(R=R.join("\n"),z=C+(s?F[0]+c+F[1]+"\n"+C+C+F[0]+g+F[1]:F[0]+I+F[1])+"\n",h=0;D>h;++h)z+=s+C+C+F[0]+b+F[1]+m(v(a[0],[1,h+1]))+F[0]+F[2]+L+F[1]+"\n";if(s){for(i+=C+F[0]+p+F[1]+"\n",i+=C+C+F[0]+g+F[1]+"\n",h=0;D>h;++h)i+=C+C+C+F[0]+y+F[1]+m(v(a[2],[1,h+1]))+F[0]+F[2]+N+F[1]+"\n";i+=C+C+F[0]+F[2]+g+F[1]+"\n",i+=C+F[0]+F[2]+P+F[1]+"\n"}z+=s+C+F[0]+F[2]+I+F[1]+(s?"\n"+C+F[0]+F[2]+M+F[1]+"\n"+i+C+F[0]+u+F[1]:"")+"\n",R=z+R+(s?"\n"+C+F[0]+F[2]+O+F[1]:"")+"\n",t.tidy("\n\n").insert(F[0]+o+F[1]+"\n"+(W&&f?C+F[0]+f+F[1]+W+F[0]+F[2]+$+F[1]+"\n":"")+R+F[0]+F[2]+x+F[1]),w=t.$(),T=w.start+w.value.indexOf(r),t.select(T,T+r.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){return j=W(t.$().before),t.tidy("\n\n","").insert(j+F[0]+T.hr+M+"\n\n",0),!1}}}),k.keys&&g(w.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var d,g,h,n=t.$(),i=n.value,l=t.get(),a=T.p,r=T.li,s=S(a),o=S(r),c=(W(n.before),z[""]),u=w.tools;if(!i||i===c){if(d=n.after.match(b("^\\s*"+P[0]+P[2]+"("+p(s)+"|"+p(o)+")"+P[1])))g=d[1],(u[g===o?D:g]||u.ul).click(e,t);else{if(!(x&&a&&m(l)&&n.end===l.length&&b("^\\s*[^"+P[0]+"\\n]*?[^"+P[1]+"]\\s*$").test(l)))return;l=F[0]+a+F[1]+l+F[0]+F[2]+s+F[1]+"\n"+F[0]+a+F[1],h=c+F[0]+F[2]+s+F[1],t.set(l+h).select(l.length,(l+c).length)}return!1}},tab:function(e,t){var n=t.$(),i=T.li,l=S(i),a=W(n.before);return b(P[0]+P[2]+p(l)+P[1]).test(n.after)?(t[0]().wrap("\n"+a+C+F[0]+(T[D]||D)+F[1]+"\n"+a+C+C+F[0]+i+F[1],F[0]+F[2]+l+F[1]+"\n"+a+C+F[0]+F[2]+D+F[1]+"\n"+a).insert(z[""])[1](),!1):w.tools.indent.click(e,t)},backspace:function(e,t){var l,n=t.$(),i=n.value,a=n.before,r=n.after,s=P[0]+"[^"+P[0]+P[1]+"]+?"+P[1];return!i&&b(s+"$").test(a)?(l=a.split(F[0]).pop().match(b("^([^"+P[2]+"\\s]+).*?"+P[1]+"\\s*$")),l=l&&l[1]||0,l&&b("^\\s*"+P[0]+P[2]+p(l)+P[1]).test(r)?t.unwrap(b(P[0]+p(l)+L+P[1]),b("\\s*"+P[0]+P[2]+p(l)+P[1])):t.outdent(b(s)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),c.update(t,0)};