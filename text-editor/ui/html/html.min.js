/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.4.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(e,t){function j(e){return e.split(g("("+S[3]+")+"))[0]}function q(e){return F=e.match(/(?:^|\n)([\t ]*).*$/),F&&F[1]||""}function Y(e,t,n){var b,i=a.$(),r=i.value,o=i.before,f=$[t]||t,s=$[n]||n,l=j(f),u=j(s),c=q(o),d=N[""];return A=f,a[0](),r&&r!==d?(a.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,O[0]+O[2]+u+O[1]+"\n"+z+O[0]+s+O[1]).wrap(O[0]+f+O[1]+"\n"+z+O[0]+s+O[1],O[0]+O[2]+u+O[1]+"\n"+O[0]+O[2]+l+O[1]+"\n\n",1).replace(g("\\n"+p(z)+M[0]+p(s)+M[1]+"\\s*"+M[0]+M[2]+p(u)+M[1]+"\\n","g"),"\n"+O[0]+O[2]+l+O[1]+"\n\n"+O[0]+f+O[1]+"\n").select(a.$().end),w&&k.tools.p.click(e,a)):(b=o.match(g("(?:^|\\n)[\\t ]+"+M[0]+"("+M[2]+"?)(?:"+p(j($.ul))+"|"+p(j($.ol))+")"+H+M[1]+"\\s*$")))?a.insert("\n"+c+(b[1]?"":z),0):(b=o.match(g(M[0]+p(u)+D+M[1]+".*?$")))?g(M[0]+M[2]+p(u)+M[1]+"\\s*$").test(o)?a.tidy("\n"+c,!1).insert(d).wrap(O[0]+u+b[1]+O[1],O[0]+O[2]+u+O[1]):g(M[1]+"\\s*$").test(o)?a.insert(d).wrap("\n"+c+z+O[0]+f+O[1]+"\n"+c+z+z+O[0]+u+b[1]+O[1],O[0]+O[2]+u+O[1]+"\n"+c+z+O[0]+O[2]+l+O[1]+"\n"+c).scroll(2):a.insert(O[0]+O[2]+u+O[1]+"\n"+c+O[0]+u+b[1]+O[1],0).insert(d).scroll(1):g(M[0]+M[2]+p(u)+M[1]+"\\s*$").test(o)?a.insert(d).wrap("\n"+c+O[0]+s+O[1],O[0]+O[2]+u+O[1]):a.tidy("\n\n").insert(d).wrap(O[0]+f+O[1]+"\n"+z+O[0]+s+O[1],O[0]+O[2]+u+O[1]+"\n"+O[0]+O[2]+l+O[1]),a[1](),!1}function I(e,t){return!t.get(0)&&w&&k.tools.p.click(e,t),t}function R(e){return y(e.replace(/\s+/g," "))}function U(e){return v(R(e),[g(M[0]+".*?"+M[1],"g"),'"',"'"],["","&#34;","&#39;"])}function W(e){return v(R(e),[g(M[0]+".*?"+M[1],"g"),/\s/g,'"'],["","%20","%22"])}var A,F,n="–",i="…",r="↑",o="↓",f="↵",s="⌘",l="✘",u="⇧",a=TE.ui(e,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],a:{},img:{},abbr:{}},languages:{tools:{clear:["Clear Format",l],b:["Bold",s+"+B"],i:["Italic",s+"+I"],u:["Underline",s+"+U"],s:["Strike",s+"+"+l],a:["Link",s+"+L"],img:["Image",s+"+G"],sub:["Subscript",s+"+"+o],sup:["Superscript",s+"+"+r],abbr:["Abbreviation",s+"+"+u+"+?"],p:["Paragraph",s+"+"+f],br:["Line Break",u+"+"+f],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",s+"+H"],"blockquote,q":["Quote",s+"+Q"],"pre,code":["Code",s+"+K"],ul:["Unordered List",s+"+-"],ol:["Ordered List",s+"++"],table:["Table",s+"+T"],hr:["Horizontal Rule",s+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+i]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+i,"image caption here"+i]},abbr:{title:"Abbreviation",placeholder:"meaning here"+i},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+i]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),c=a._,d=c.edge,p=c.x,b=c.extend,h=c.i,g=c.pattern,y=c.trim,m=c.format,v=c.replace,x=b(a.config,t),k=a.ui,w=x.auto_p,$=(x.classes,x.formats),T=x.languages,_=x.states,L=x.suffix,z=x.tab,O=x.unit[0][0],C=x.unit[0][1],M=x.unit[1][0],S=x.unit[1][1],H="(?:"+S[3]+"[^"+M[0]+M[1]+"]*?)?",D="(|"+S[3]+"[^"+M[0]+M[1]+"]*?)",B="([\\s\\S]*?)",N=T.placeholders;return a.type="HTML",b(k.tools,{clear:{i:"eraser",click:function(e,t){var f,n=t[0]().$(),i=n.before,r=n.after,o=n.value,s=M[0]+"[^"+M[0]+M[1]+"]+?"+M[1],l=M[0]+"[^"+M[2]+M[0]+M[1]+"]+?"+M[1],u=M[0]+M[2]+"[^"+M[0]+M[1]+"]+?"+M[1];return!o&&r&&(f=g("^"+s)).test(r)?(t.replace(f,"",1),!1):(g(s).test(o)||i.slice(-1)===O[1]||r[0]===O[0]?t.replace(g(s,"g"),"").unwrap(g(l),g(u)):t.insert(""),t[1](),!!r)}},b:{i:"bold",click:function(e,t){return I(e,t).i().format($.b),!1}},i:{i:"italic",click:function(e,t){return I(e,t).i().format($.i),!1}},u:{i:"underline",click:function(e,t){return I(e,t).i().format($.u),!1}},s:{i:"strikethrough",click:function(e,t){return I(e,t).i().format(m($.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var r,o,n=$.a,i=T.modals.a;return k.prompt(i.title[0],i.placeholder[0],1,function(e,t,f){f=W(f),r=f;var l,u,s=location.host;-1!==r.indexOf("://")&&(l=1),""!==s&&-1!==r.indexOf("://"+s)&&(l=0),/^([.\/?&#]|javascript:)/.test(r)&&(l=0),k.prompt(i.title[1],i.placeholder[1],0,function(e,t,i){o=U(i),I(e,t).$().length||t.insert(N[""]),u=x.advance_a&&l?C[3]+"rel"+C[0]+C[1]+"nofollow"+C[2]+C[3]+"target"+C[0]+C[1]+"_blank"+C[2]:"",t.i().format(n+C[3]+"href"+C[0]+C[1]+r+C[2]+(o?C[3]+"title"+C[0]+C[1]+o+C[2]:"")+u)},0,0,"a[title]")},0,0,"a[href]").record(),!1}},img:{i:"image",click:function(e,t){var u,a,n=t.$(),i=$.img,r=$.figure,o=$.figcaption,f=n.value,s=T.modals.img,l=x.advance_img;return k.prompt(s.title[0],s.placeholder[0],1,function(e,t,n){n=W(n),u=n,k.prompt(s.title[l?2:1],s.placeholder[l?2:1],0,function(e,t,n){a=U(n),f||(f=u.split(/[\/\\\\]/).pop()),f=U(f),t[0](),l&&a?(t.tidy("\n\n","").insert(O[0]+r+O[1]+"\n"+z+O[0]+i+C[3]+"alt"+C[0]+C[1]+f+C[2]+C[3]+"src"+C[0]+C[1]+u+C[2]+L+"\n"+z+O[0]+o+O[1]+a+O[0]+O[2]+j(o)+O[1]+"\n"+O[0]+O[2]+j(r)+O[1]+"\n\n",0,1),w&&k.tools.p.click(e,t)):I(e,t).tidy(g(M[0]+"[^"+M[0]+M[1]+M[2]+"]+?"+M[1]+"\\s*$").test(t.$().before)?"":" ","").insert(O[0]+i+C[3]+"alt"+C[0]+C[1]+f+C[2]+C[3]+"src"+C[0]+C[1]+u+C[2]+(a?C[3]+"title"+C[0]+C[1]+a+C[2]:"")+L+" ",0,1),t[1]()},0,0,"img[title]")},0,0,"img[src]"),!1}},sub:{i:"subscript",click:function(e,t){var n=$.sub,i=$.sup,r=j(i);return I(e,t)[0]().unwrap(g(M[0]+p(r)+H+M[1]),O[0]+O[2]+r+O[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=$.sub,i=$.sup,r=j(n);return I(e,t)[0]().unwrap(g(M[0]+p(r)+H+M[1]),O[0]+O[2]+r+O[1]).i().format(i)[1](),!1}},abbr:{i:"question",click:function(e,t){var b,h,n=t.$(),i=y(n.value),r=T.modals.abbr,o=t.get(),f=y(i||N[""]),s=$.abbr,l=j(s),u=M[0]+p(s)+D+M[1],a=M[0]+p(s)+H+M[1],c=M[0]+M[2]+p(l)+M[1],d=g(u+B+c);return o.replace(d,function(e,t,n){(n=y(n))&&(_.abbr[n]=(t.match(g(S[3]+"+title"+S[0]+S[1]+"\\s*(.*?)\\s*"+S[2]))||["",""])[1])}),b=_.abbr,i&&b[i]?(t.i().format(s+C[3]+"title"+C[0]+C[1]+b[i]+C[2]),!1):(k.prompt(r.title,b[f]||r.placeholder,!b[i],function(e,t,n,r){n=U(n||r),t[0](),i||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(h in b)if(U(b[h])===n){t.insert(h);break}I(e,t).unwrap(g(a),g(c)).unwrap(g(a),g(c),1).i().format(s+C[3]+"title"+C[0]+C[1]+n+C[2])[1]()},0,0,"abbr[title]").record(),!1)}},p:{i:"paragraph",click:function(e,t){var d,n=t.$(),i=n.value,r=$.p,o=$.br,f=j(r),s=j(o),l=n.before,u=n.after,a=q(l),c=N[""];if(t[0](),i&&-1!==i.indexOf("\n")){var b=g("^(?:\\s*"+M[0]+p(f)+H+M[1]+"\\s*)+"+B+"(?:\\s*"+M[0]+M[2]+p(f)+M[1]+"\\s*)+$");b.test(i)?t.replace(b,"$1").replace(g("\\s*"+M[0]+M[2]+p(f)+M[1]+"\\s*"+M[0]+p(f)+H+M[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+M[0]+p(s)+H+M[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+O[0]+o+L+"\n").replace(g("(\\s*"+M[0]+p(s)+H+L+"\\s*){2,}","g"),O[0]+O[2]+f+O[1]+"\n"+O[0]+r+O[1]).wrap(O[0]+r+O[1],O[0]+O[2]+f+O[1],1).replace(g("("+M[0]+p(f)+H+M[1]+")+","g"),"$1").replace(g("("+M[0]+M[2]+p(f)+M[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+M[0]+M[2]+p(f)+M[1]).test(u)?g(M[0]+p(f)+H+M[1]+"\\s*$").test(l)?t.unwrap(g("\\s*"+M[0]+p(f)+H+M[1]+"\\s*"),g("\\s*"+M[0]+M[2]+p(f)+M[1])).replace(c,"").tidy("\n","\n"+a):(d=l.match(g(M[0]+p(f)+D+M[1]+".*?$")))&&t.wrap(O[0]+O[2]+f+O[1]+"\n"+a+O[0]+f+d[1]+O[1],"").insert(c).scroll(1):t.tidy("\n\n").format(r,0,"\n\n").scroll(1);return t[1](),!1}},br:{i:"level-down",click:function(e,t){return F=q(t.$().before),t.tidy("\n","").insert(F+O[0]+$.br+L+"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var o,f,n=t.$(),i=[$.p,$.h1,$.h2,$.h3,$.h4,$.h5,$.h6],r=[];for(o in i)r[o]=j(i[o]);var l=(p(i).join("|"),p(r).join("|")),u="\\s*"+M[0]+"("+l+")"+D+M[1]+"\\s*",a=g("\\s*"+M[0]+"(?:"+l+")"+H+M[1]+"\\s*"),c=g("\\s*"+M[0]+M[2]+"(?:"+l+")"+M[1]+"\\s*"),d=n.value.match(g("^"+u));return d||(d=n.before.match(g(u+"$"))||[]),f=d[2]||"",o=+(d[1]||"h0").slice(1),t[0]().unwrap(a,c).unwrap(a,c,1).i().tidy("\n\n").format(o>5?r[0]+f:r[o+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var c,n=t.$(),i=n.value,r=$.blockquote,o=$.q,f=$.p,s=j(f),l=p(s),u=g(M[0]+M[2]+l+M[1]),a=N[""];return/(^|\n)$/.test(n.before)?(w&&!u.test(i)&&k.tools.p.click(e,t),n=t.$(),i=n.value,!u.test(i)&&w&&t.select(n.start-(O[0]+f+O[1]).length,n.end+(O[0]+O[2]+s+O[1]).length),i!==a&&w?(t[0]().tidy("\n\n").insert(O[0]+r+O[1]+"\n"+t.$().value.replace(g("^(\\s*"+M[0]+")","gm"),z+"$1")+"\n"+O[0]+O[2]+j(r)+O[1]+"\n\n",0,1),w&&k.tools.p.click(e,t)):(t[0]().format(r,0,"\n\n","\n").loss().replace(g("^(\\s*"+M[0]+")","gm"),z+"$1"),w&&(n=t.$(),c=n.start+(O[0]+f+O[1]+z).length,t.select(c,c+a.length))),t[1]()):t.i().format(o),!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return r?v(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function y(e){return r?v(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),i=n.value,r=x.auto_encode_html,o=$.pre,f=$.code,s=j(o),l=j(f),u=M[0]+p(s)+H+M[1]+"\\s*"+M[0]+p(l)+H+M[1]+"\\s*",a="\\s*"+M[0]+M[2]+p(l)+M[1]+"\\s*"+M[0]+M[2]+p(s)+M[1],c=g(u+"\\s*$"),d=g("^\\s*"+a),b=g("^"+B+"$");return g("(^|\\n|"+u+")$").test(n.before)?c.test(n.before)&&d.test(n.after)?t[0]().unwrap(g(c),g(d)).replace(b,y)[1]():t[0]().tidy("\n\n").wrap(O[0]+o+O[1]+O[0]+f+O[1],O[0]+O[2]+l+O[1]+O[0]+O[2]+s+O[1]).insert(i||N[""]).replace(b,h)[1]():t[0]().format(f).replace(b,function(e){return R(g("^\\s*"+M[0]+M[2]+p(l)+M[1]).test(t.$().after)?h(e):y(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=$.ol,i=$.ul,r=j(n),o=j(i),f="("+p(o)+"|"+p(r)+")";return t.match(g(M[0]+f+H+M[1]+B+M[0]+M[2]+f+M[1]))?t[0]().replace(g(M[0]+p(r)+D+M[1],"g"),O[0]+o+"$1"+O[1]).replace(g(M[0]+M[2]+p(r)+M[1],"g"),O[0]+O[2]+o+O[1])[1]():Y(e,i,$.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=$.ol,i=$.ul,r=j(n),o=j(i),f="("+p(o)+"|"+p(r)+")";return t.match(g(M[0]+f+H+M[1]+B+M[0]+M[2]+f+M[1]))?t[0]().replace(g(M[0]+p(o)+D+M[1],"g"),O[0]+r+"$1"+O[1]).replace(g(M[0]+M[2]+p(o)+M[1],"g"),O[0]+O[2]+r+O[1])[1]():Y(e,n,$.li),!1}},table:function(e,t){var N,A,F,q,n=_.tr,i=_.td,r=T.modals.table,o=T.placeholders.table,f=y(m(o[0],[1,1])),s=x.advance_table?z:"",l=$.table,u=$.caption,a=$.thead,c=$.tbody,p=$.tfoot,b=$.tr,g=$.th,v=$.td,w=j(l),E=j(u),L=j(a),C=j(c),M=j(p),S=j(b),H=j(g),D=j(v),B=[];return t[0]().$().value===f?(t.select(),!1):(k.prompt(r.title[0],r.placeholder[0],0,function(e,t,x,$){A=d(h(x)||$,i[0],i[1]),k.prompt(r.title[1],r.placeholder[1],0,function(e,t,i,x){F=d(h(i)||x,n[0],n[1]),k.prompt(r.title[2],r.placeholder[2],0,function(e,t,n){var r,d,h,k,$,i="";for(q=R(n),r=0;F>r;++r){for(N=s+z+O[0]+b+O[1]+"\n",d=0;A>d;++d)N+=s+z+z+O[0]+v+O[1]+y(m(o[1],[r+1,d+1]))+O[0]+O[2]+D+O[1]+"\n";N+=s+z+O[0]+O[2]+S+O[1],B.push(N)}for(B=B.join("\n"),N=z+(s?O[0]+a+O[1]+"\n"+z+z+O[0]+b+O[1]:O[0]+S+O[1])+"\n",h=0;A>h;++h)N+=s+z+z+O[0]+g+O[1]+y(m(o[0],[1,h+1]))+O[0]+O[2]+H+O[1]+"\n";if(s){for(i+=z+O[0]+p+O[1]+"\n",i+=z+z+O[0]+b+O[1]+"\n",h=0;A>h;++h)i+=z+z+z+O[0]+v+O[1]+y(m(o[2],[1,h+1]))+O[0]+O[2]+D+O[1]+"\n";i+=z+z+O[0]+O[2]+b+O[1]+"\n",i+=z+O[0]+O[2]+M+O[1]+"\n"}N+=s+z+O[0]+O[2]+S+O[1]+(s?"\n"+z+O[0]+O[2]+L+O[1]+"\n"+i+z+O[0]+c+O[1]:"")+"\n",B=N+B+(s?"\n"+z+O[0]+O[2]+C+O[1]:"")+"\n",t.tidy("\n\n").insert(O[0]+l+O[1]+"\n"+(q&&u?z+O[0]+u+O[1]+q+O[0]+O[2]+E+O[1]+"\n":"")+B+O[0]+O[2]+w+O[1]),k=t.$(),$=k.start+k.value.indexOf(f),t.select($,$+f.length)[1]()},0,0,"table>caption")},0,0,"table>tr")},0,0,"table>td"),!1)},hr:{i:"ellipsis-h",click:function(e,t){return F=q(t.$().before),t.tidy("\n\n","").insert(F+O[0]+$.hr+L+"\n\n",0),!1}}}),x.keys&&b(k.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var d,b,h,n=t.$(),i=n.value,r=t.get(),o=$.p,f=$.li,s=j(o),l=j(f),a=(q(n.before),N[""]),c=k.tools;if(!i||i===a){if(d=n.after.match(g("^\\s*"+M[0]+M[2]+"("+p(s)+"|"+p(l)+")"+M[1])))b=d[1],(c[b===l?A:b]||c.ul).click(e,t);else{if(!(w&&o&&y(r)&&n.end===r.length&&g("^\\s*[^"+M[0]+"\\n]*?[^"+M[1]+"]\\s*$").test(r)))return;r=O[0]+o+O[1]+r+O[0]+O[2]+s+O[1]+"\n"+O[0]+o+O[1],h=a+O[0]+O[2]+s+O[1],t.set(r+h).select(r.length,(r+a).length)}return!1}},tab:function(e,t){var n=t.$(),i=$.li,r=j(i),o=q(n.before);return g(M[0]+M[2]+p(r)+M[1]).test(n.after)?(t[0]().wrap("\n"+o+z+O[0]+($[A]||A)+O[1]+"\n"+o+z+z+O[0]+i+O[1],O[0]+O[2]+r+O[1]+"\n"+o+z+O[0]+O[2]+A+O[1]+"\n"+o).insert(N[""])[1](),!1):k.tools.indent.click(e,t)},backspace:function(e,t){var r,n=t.$(),i=n.value,o=n.before,f=n.after,s=M[0]+"[^"+M[0]+M[1]+"]+?"+M[1];return!i&&g(s+"$").test(o)?(r=o.split(O[0]).pop().match(g("^([^"+M[2]+"\\s]+).*?"+M[1]+"\\s*$")),r=r&&r[1]||0,r&&g("^\\s*"+M[0]+M[2]+p(r)+M[1]).test(f)?t.unwrap(g(M[0]+p(r)+H+M[1]),g("\\s*"+M[0]+M[2]+p(r)+M[1])):t.outdent(g(s)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),a.update(t,0)};