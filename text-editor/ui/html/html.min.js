/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.4.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(e,t){function J(e){return e.split(E("("+S[3]+")+"))[0]}function D(e){return N=e.match(/(?:^|\n)([\t ]*).*$/),N&&N[1]||""}function H(e,t,n){var g,a=h.$(),i=a.value,o=a.before,r=x[t]||t,s=x[n]||n,u=J(r),c=J(s),l=D(o),f=Z[""];return G=r,h[0](),i&&i!==f?(h.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,Y[0]+Y[2]+c+Y[1]+"\n"+w+Y[0]+s+Y[1]).wrap(Y[0]+r+Y[1]+"\n"+w+Y[0]+s+Y[1],Y[0]+Y[2]+c+Y[1]+"\n"+Y[0]+Y[2]+u+Y[1]+"\n\n",1).replace(E("\\n"+d(w)+T[0]+d(s)+T[1]+"\\s*"+T[0]+T[2]+d(c)+T[1]+"\\n","g"),"\n"+Y[0]+Y[2]+u+Y[1]+"\n\n"+Y[0]+r+Y[1]+"\n").select(h.$().end),y&&U.tools.p.click(e,h)):(g=o.match(E("(?:^|\\n)[\\t ]+"+T[0]+"("+T[2]+"?)(?:"+d(J(x.ul))+"|"+d(J(x.ol))+")"+j+T[1]+"\\s*$")))?h.insert("\n"+l+(g[1]?"":w),0):(g=o.match(E(T[0]+d(c)+R+T[1]+".*?$")))?E(T[0]+T[2]+d(c)+T[1]+"\\s*$").test(o)?h.tidy("\n"+l,!1).insert(f).wrap(Y[0]+c+g[1]+Y[1],Y[0]+Y[2]+c+Y[1]):E(T[1]+"\\s*$").test(o)?h.insert(f).wrap("\n"+l+w+Y[0]+r+Y[1]+"\n"+l+w+w+Y[0]+c+g[1]+Y[1],Y[0]+Y[2]+c+Y[1]+"\n"+l+w+Y[0]+Y[2]+u+Y[1]+"\n"+l).scroll(2):h.insert(Y[0]+Y[2]+c+Y[1]+"\n"+l+Y[0]+c+g[1]+Y[1],0).insert(f).scroll(1):E(T[0]+T[2]+d(c)+T[1]+"\\s*$").test(o)?h.insert(f).wrap("\n"+l+Y[0]+s+Y[1],Y[0]+Y[2]+c+Y[1]):h.tidy("\n\n").insert(f).wrap(Y[0]+r+Y[1]+"\n"+w+Y[0]+s+Y[1],Y[0]+Y[2]+c+Y[1]+"\n"+Y[0]+Y[2]+u+Y[1]),h[1](),!1}function P(e,t){return!t.get(0)&&y&&U.tools.p.click(e,t),t}function $(e){return v(e.replace(/\s+/g," "))}function q(e){return A($(e),[E(T[0]+".*?"+T[1],"g"),'"',"'"],["","&#34;","&#39;"])}function B(e){return A($(e),[E(T[0]+".*?"+T[1],"g"),/\s/g,'"'],["","%20","%22"])}var G,N,n="–",a="…",i="↑",o="↓",r="↵",s="⌘",u="✘",c="⇧",h=TE.ui(e,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],a:{},img:{},abbr:{}},languages:{tools:{clear:["Clear Format",u],b:["Bold",s+"+B"],i:["Italic",s+"+I"],u:["Underline",s+"+U"],s:["Strike",s+"+"+u],a:["Link",s+"+L"],img:["Image",s+"+G"],sub:["Subscript",s+"+"+o],sup:["Superscript",s+"+"+i],abbr:["Abbreviation",s+"+"+c+"+?"],p:["Paragraph",s+"+"+r],br:["Line Break",c+"+"+r],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",s+"+H"],"blockquote,q":["Quote",s+"+Q"],"pre,code":["Code",s+"+K"],ul:["Unordered List",s+"+-"],ol:["Ordered List",s+"++"],table:["Table",s+"+T"],hr:["Horizontal Rule",s+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+a]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+a,"image caption here"+a]},abbr:{title:"Abbreviation",placeholder:"meaning here"+a},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+a]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),l=h._,f=l.edge,d=l.x,g=l.extend,p=l.i,E=l.pattern,v=l.trim,O=l.format,A=l.replace,b=g(h.config,t),U=h.ui,y=b.auto_p,x=(b.classes,b.formats),m=b.languages,I=b.states,C=b.suffix,w=b.tab,Y=b.union[1][0],z=b.union[1][1],T=b.union[0][0],S=b.union[0][1],j="(?:"+S[3]+"[^"+T[0]+T[1]+"]*?)?",R="(|"+S[3]+"[^"+T[0]+T[1]+"]*?)",L="([\\s\\S]*?)",Z=m.placeholders;return h.type="HTML",g(U.tools,{clear:{i:"eraser",click:function(e,t){var r,n=t[0]().$(),a=n.before,i=n.after,o=n.value,s=T[0]+"[^"+T[0]+T[1]+"]+?"+T[1],u=T[0]+"[^"+T[2]+T[0]+T[1]+"]+?"+T[1],c=T[0]+T[2]+"[^"+T[0]+T[1]+"]+?"+T[1];return!o&&i&&(r=E("^"+s)).test(i)?(t.replace(r,"",1),!1):(E(s).test(o)||a.slice(-1)===Y[1]||i[0]===Y[0]?t.replace(E(s,"g"),"").unwrap(E(u),E(c)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return P(e,t).i().format(x.b),!1}},i:{i:"italic",click:function(e,t){return P(e,t).i().format(x.i),!1}},u:{i:"underline",click:function(e,t){return P(e,t).i().format(x.u),!1}},s:{i:"strikethrough",click:function(e,t){return P(e,t).i().format(O(x.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=x.a,a=m.modals.a;return U.prompt(a.title[0],a.placeholder[0],1,function(e,t,r){r=B(r),i=r;var u,c,s=location.host;-1!==i.indexOf("://")&&(u=1),""!==s&&-1!==i.indexOf("://"+s)&&(u=0),/^([.\/?&#]|javascript:)/.test(i)&&(u=0),U.prompt(a.title[1],a.placeholder[1],0,function(e,t,a){o=q(a),P(e,t).$().length||t.insert(Z[""]),c=b.advance_a&&u?z[3]+"rel"+z[0]+z[1]+"nofollow"+z[2]+z[3]+"target"+z[0]+z[1]+"_blank"+z[2]:"",t.i().format(n+z[3]+"href"+z[0]+z[1]+i+z[2]+(o?z[3]+"title"+z[0]+z[1]+o+z[2]:"")+c)},0,0,"a[title]")},0,0,"a[href]").record(),!1}},img:{i:"image",click:function(e,t){var c,h,n=t.$(),a=x.img,i=x.figure,o=x.figcaption,r=n.value,s=m.modals.img,u=b.advance_img;return U.prompt(s.title[0],s.placeholder[0],1,function(e,t,n){n=B(n),c=n,U.prompt(s.title[u?2:1],s.placeholder[u?2:1],0,function(e,t,n){h=q(n),r||(r=c.split(/[\/\\\\]/).pop()),r=q(r),t[0](),u&&h?(t.tidy("\n\n","").insert(Y[0]+i+Y[1]+"\n"+w+Y[0]+a+z[3]+"alt"+z[0]+z[1]+r+z[2]+z[3]+"src"+z[0]+z[1]+c+z[2]+C+"\n"+w+Y[0]+o+Y[1]+h+Y[0]+Y[2]+J(o)+Y[1]+"\n"+Y[0]+Y[2]+J(i)+Y[1]+"\n\n",0,1),y&&U.tools.p.click(e,t)):P(e,t).tidy(E(T[0]+"[^"+T[0]+T[1]+T[2]+"]+?"+T[1]+"\\s*$").test(t.$().before)?"":" ","").insert(Y[0]+a+z[3]+"alt"+z[0]+z[1]+r+z[2]+z[3]+"src"+z[0]+z[1]+c+z[2]+(h?z[3]+"title"+z[0]+z[1]+h+z[2]:"")+C+" ",0,1),t[1]()},0,0,"img[title]")},0,0,"img[src]"),!1}},sub:{i:"subscript",click:function(e,t){var n=x.sub,a=x.sup,i=J(a);return P(e,t)[0]().unwrap(E(T[0]+d(i)+j+T[1]),Y[0]+Y[2]+i+Y[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=x.sub,a=x.sup,i=J(n);return P(e,t)[0]().unwrap(E(T[0]+d(i)+j+T[1]),Y[0]+Y[2]+i+Y[1]).i().format(a)[1](),!1}},abbr:{i:"question",click:function(e,t){var g,p,n=t.$(),a=v(n.value),i=m.modals.abbr,o=t.get(),r=v(a||Z[""]),s=x.abbr,u=J(s),c=T[0]+d(s)+R+T[1],h=T[0]+d(s)+j+T[1],l=T[0]+T[2]+d(u)+T[1],f=E(c+L+l);return o.replace(f,function(e,t,n){(n=v(n))&&(I.abbr[n]=(t.match(E(S[3]+"+title"+S[0]+S[1]+"\\s*(.*?)\\s*"+S[2]))||["",""])[1])}),g=I.abbr,a&&g[a]?(t.i().format(s+z[3]+"title"+z[0]+z[1]+g[a]+z[2]),!1):(U.prompt(i.title,g[r]||i.placeholder,!g[a],function(e,t,n,i){n=q(n||i),t[0](),a||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(p in g)if(q(g[p])===n){t.insert(p);break}P(e,t).unwrap(E(h),E(l)).unwrap(E(h),E(l),1).i().format(s+z[3]+"title"+z[0]+z[1]+n+z[2])[1]()},0,0,"abbr[title]").record(),!1)}},p:{i:"paragraph",click:function(e,t){var f,n=t.$(),a=n.value,i=x.p,o=x.br,r=J(i),s=J(o),u=n.before,c=n.after,h=D(u),l=Z[""];if(t[0](),a&&-1!==a.indexOf("\n")){var g=E("^(?:\\s*"+T[0]+d(r)+j+T[1]+"\\s*)+"+L+"(?:\\s*"+T[0]+T[2]+d(r)+T[1]+"\\s*)+$");g.test(a)?t.replace(g,"$1").replace(E("\\s*"+T[0]+T[2]+d(r)+T[1]+"\\s*"+T[0]+d(r)+j+T[1]+"\\s*","g"),"\n\n").replace(E("\\s*"+T[0]+d(s)+j+T[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+Y[0]+o+C+"\n").replace(E("(\\s*"+T[0]+d(s)+j+C+"\\s*){2,}","g"),Y[0]+Y[2]+r+Y[1]+"\n"+Y[0]+i+Y[1]).wrap(Y[0]+i+Y[1],Y[0]+Y[2]+r+Y[1],1).replace(E("("+T[0]+d(r)+j+T[1]+")+","g"),"$1").replace(E("("+T[0]+T[2]+d(r)+T[1]+")+","g"),"$1").tidy("\n")}else E("^\\s*"+T[0]+T[2]+d(r)+T[1]).test(c)?E(T[0]+d(r)+j+T[1]+"\\s*$").test(u)?t.unwrap(E("\\s*"+T[0]+d(r)+j+T[1]+"\\s*"),E("\\s*"+T[0]+T[2]+d(r)+T[1])).replace(l,"").tidy("\n","\n"+h):(f=u.match(E(T[0]+d(r)+R+T[1]+".*?$")))&&t.wrap(Y[0]+Y[2]+r+Y[1]+"\n"+h+Y[0]+r+f[1]+Y[1],"").insert(l).scroll(1):t.tidy("\n\n").format(i,0,"\n\n").scroll(1);return t[1](),!1}},br:{i:"level-down",click:function(e,t){return N=D(t.$().before),t.tidy("\n","").insert(N+Y[0]+x.br+C+"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var o,r,n=t.$(),a=[x.p,x.h1,x.h2,x.h3,x.h4,x.h5,x.h6],i=[];for(o in a)i[o]=J(a[o]);var u=(d(a).join("|"),d(i).join("|")),c="\\s*"+T[0]+"("+u+")"+R+T[1]+"\\s*",h=E("\\s*"+T[0]+"(?:"+u+")"+j+T[1]+"\\s*"),l=E("\\s*"+T[0]+T[2]+"(?:"+u+")"+T[1]+"\\s*"),f=n.value.match(E("^"+c));return f||(f=n.before.match(E(c+"$"))||[]),r=f[2]||"",o=+(f[1]||"h0").slice(1),t[0]().unwrap(h,l).unwrap(h,l,1).i().tidy("\n\n").format(o>5?i[0]+r:i[o+1]+r,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var l,n=t.$(),a=n.value,i=x.blockquote,o=x.q,r=x.p,s=J(r),u=d(s),c=E(T[0]+T[2]+u+T[1]),h=Z[""];return/(^|\n)$/.test(n.before)?(y&&!c.test(a)&&U.tools.p.click(e,t),n=t.$(),a=n.value,!c.test(a)&&y&&t.select(n.start-(Y[0]+r+Y[1]).length,n.end+(Y[0]+Y[2]+s+Y[1]).length),a!==h&&y?(t[0]().tidy("\n\n").insert(Y[0]+i+Y[1]+"\n"+t.$().value.replace(E("^(\\s*"+T[0]+")","gm"),w+"$1")+"\n"+Y[0]+Y[2]+J(i)+Y[1]+"\n\n",0,1),y&&U.tools.p.click(e,t)):(t[0]().format(i,0,"\n\n","\n").loss().replace(E("^(\\s*"+T[0]+")","gm"),w+"$1"),y&&(n=t.$(),l=n.start+(Y[0]+r+Y[1]+w).length,t.select(l,l+h.length))),t[1]()):t.i().format(o),!1}},"pre,code":{i:"code",click:function(e,t){function p(e){return i?A(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function v(e){return i?A(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),a=n.value,i=b.auto_encode_html,o=x.pre,r=x.code,s=J(o),u=J(r),c=T[0]+d(s)+j+T[1]+"\\s*"+T[0]+d(u)+j+T[1]+"\\s*",h="\\s*"+T[0]+T[2]+d(u)+T[1]+"\\s*"+T[0]+T[2]+d(s)+T[1],l=E(c+"\\s*$"),f=E("^\\s*"+h),g=E("^"+L+"$");return E("(^|\\n|"+c+")$").test(n.before)?l.test(n.before)&&f.test(n.after)?t[0]().unwrap(E(l),E(f)).replace(g,v)[1]():t[0]().tidy("\n\n").wrap(Y[0]+o+Y[1]+Y[0]+r+Y[1],Y[0]+Y[2]+u+Y[1]+Y[0]+Y[2]+s+Y[1]).insert(a||Z[""]).replace(g,p)[1]():t[0]().format(r).replace(g,function(e){return $(E("^\\s*"+T[0]+T[2]+d(u)+T[1]).test(t.$().after)?p(e):v(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=x.ol,a=x.ul,i=J(n),o=J(a),r="("+d(o)+"|"+d(i)+")";return t.match(E(T[0]+r+j+T[1]+L+T[0]+T[2]+r+T[1]))?t[0]().replace(E(T[0]+d(i)+R+T[1],"g"),Y[0]+o+"$1"+Y[1]).replace(E(T[0]+T[2]+d(i)+T[1],"g"),Y[0]+Y[2]+o+Y[1])[1]():H(e,a,x.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=x.ol,a=x.ul,i=J(n),o=J(a),r="("+d(o)+"|"+d(i)+")";return t.match(E(T[0]+r+j+T[1]+L+T[0]+T[2]+r+T[1]))?t[0]().replace(E(T[0]+d(o)+R+T[1],"g"),Y[0]+i+"$1"+Y[1]).replace(E(T[0]+T[2]+d(o)+T[1],"g"),Y[0]+Y[2]+i+Y[1])[1]():H(e,n,x.li),!1}},table:function(e,t){var Z,G,N,D,n=I.tr,a=I.td,i=m.modals.table,o=m.placeholders.table,r=v(O(o[0],[1,1])),s=b.advance_table?w:"",u=x.table,c=x.caption,h=x.thead,l=x.tbody,d=x.tfoot,g=x.tr,E=x.th,A=x.td,y=J(u),k=J(c),C=J(h),z=J(l),T=J(d),S=J(g),j=J(E),R=J(A),L=[];return t[0]().$().value===r?(t.select(),!1):(U.prompt(i.title[0],i.placeholder[0],0,function(e,t,b,x){G=f(p(b)||x,a[0],a[1]),U.prompt(i.title[1],i.placeholder[1],0,function(e,t,a,b){N=f(p(a)||b,n[0],n[1]),U.prompt(i.title[2],i.placeholder[2],0,function(e,t,n){var i,f,p,U,x,a="";for(D=$(n),i=0;N>i;++i){for(Z=s+w+Y[0]+g+Y[1]+"\n",f=0;G>f;++f)Z+=s+w+w+Y[0]+A+Y[1]+v(O(o[1],[i+1,f+1]))+Y[0]+Y[2]+R+Y[1]+"\n";Z+=s+w+Y[0]+Y[2]+S+Y[1],L.push(Z)}for(L=L.join("\n"),Z=w+(s?Y[0]+h+Y[1]+"\n"+w+w+Y[0]+g+Y[1]:Y[0]+S+Y[1])+"\n",p=0;G>p;++p)Z+=s+w+w+Y[0]+E+Y[1]+v(O(o[0],[1,p+1]))+Y[0]+Y[2]+j+Y[1]+"\n";if(s){for(a+=w+Y[0]+d+Y[1]+"\n",a+=w+w+Y[0]+g+Y[1]+"\n",p=0;G>p;++p)a+=w+w+w+Y[0]+A+Y[1]+v(O(o[2],[1,p+1]))+Y[0]+Y[2]+R+Y[1]+"\n";a+=w+w+Y[0]+Y[2]+g+Y[1]+"\n",a+=w+Y[0]+Y[2]+T+Y[1]+"\n"}Z+=s+w+Y[0]+Y[2]+S+Y[1]+(s?"\n"+w+Y[0]+Y[2]+C+Y[1]+"\n"+a+w+Y[0]+l+Y[1]:"")+"\n",L=Z+L+(s?"\n"+w+Y[0]+Y[2]+z+Y[1]:"")+"\n",t.tidy("\n\n").insert(Y[0]+u+Y[1]+"\n"+(D&&c?w+Y[0]+c+Y[1]+D+Y[0]+Y[2]+k+Y[1]+"\n":"")+L+Y[0]+Y[2]+y+Y[1]),U=t.$(),x=U.start+U.value.indexOf(r),t.select(x,x+r.length)[1]()},0,0,"table>caption")},0,0,"table>tr")},0,0,"table>td"),!1)},hr:{i:"ellipsis-h",click:function(e,t){return N=D(t.$().before),t.tidy("\n\n","").insert(N+Y[0]+x.hr+C+"\n\n",0),!1}}}),b.keys&&g(U.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var f,g,p,n=t.$(),a=n.value,i=t.get(),o=x.p,r=x.li,s=J(o),u=J(r),h=(D(n.before),Z[""]),l=U.tools;if(!a||a===h){if(f=n.after.match(E("^\\s*"+T[0]+T[2]+"("+d(s)+"|"+d(u)+")"+T[1])))g=f[1],(l[g===u?G:g]||l.ul).click(e,t);else{if(!(y&&o&&v(i)&&n.end===i.length&&E("^\\s*[^"+T[0]+"\\n]*?[^"+T[1]+"]\\s*$").test(i)))return;i=Y[0]+o+Y[1]+i+Y[0]+Y[2]+s+Y[1]+"\n"+Y[0]+o+Y[1],p=h+Y[0]+Y[2]+s+Y[1],t.set(i+p).select(i.length,(i+h).length)}return!1}},tab:function(e,t){var n=t.$(),a=x.li,i=J(a),o=D(n.before);return E(T[0]+T[2]+d(i)+T[1]).test(n.after)?(t[0]().wrap("\n"+o+w+Y[0]+(x[G]||G)+Y[1]+"\n"+o+w+w+Y[0]+a+Y[1],Y[0]+Y[2]+i+Y[1]+"\n"+o+w+Y[0]+Y[2]+G+Y[1]+"\n"+o).insert(Z[""])[1](),!1):U.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),a=n.value,o=n.before,r=n.after,s=T[0]+"[^"+T[0]+T[1]+"]+?"+T[1];return!a&&E(s+"$").test(o)?(i=o.split(Y[0]).pop().match(E("^([^"+T[2]+"\\s]+).*?"+T[1]+"\\s*$")),i=i&&i[1]||0,i&&E("^\\s*"+T[0]+T[2]+d(i)+T[1]).test(r)?t.unwrap(E(T[0]+d(i)+j+T[1]),E("\\s*"+T[0]+T[2]+d(i)+T[1])):t.outdent(E(s)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),h.update(t,0)};