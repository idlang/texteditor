/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.5.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(A,E){function x(A){return A.split(C("("+p[3]+")+"))[0]}function y(A){return b=A.match(/(?:^|\n)([\t ]*).*$/),b&&b[1]||""}function v(A,E,e){var S,T=i.$(),L=T.value,I=T.before,R=u[E]||E,t=u[e]||e,O=x(R),N=x(t),n=y(I),r=h[""];return m=R,i[0](),L&&L!==r?(i.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,B[0]+B[2]+N+B[1]+"\n"+U+B[0]+t+B[1]).wrap(B[0]+R+B[1]+"\n"+U+B[0]+t+B[1],B[0]+B[2]+N+B[1]+"\n"+B[0]+B[2]+O+B[1]+"\n\n",1).replace(C("\\n"+o(U)+W[0]+o(t)+W[1]+"\\s*"+W[0]+W[2]+o(N)+W[1]+"\\n","g"),"\n"+B[0]+B[2]+O+B[1]+"\n\n"+B[0]+R+B[1]+"\n").select(i.$().end),f&&F.tools.p.click(A,i)):(S=I.match(C("(?:^|\\n)[\\t ]+"+W[0]+"("+W[2]+"?)(?:"+o(x(u.ul))+"|"+o(x(u.ol))+")"+K+W[1]+"\\s*$")))?i.insert("\n"+n+(S[1]?"":U),0):(S=I.match(C(W[0]+o(N)+g+W[1]+".*?$")))?C(W[0]+W[2]+o(N)+W[1]+"\\s*$").test(I)?i.tidy("\n"+n,!1).insert(r).wrap(B[0]+N+S[1]+B[1],B[0]+B[2]+N+B[1]):C(W[1]+"\\s*$").test(I)?i.insert(r).wrap("\n"+n+U+B[0]+R+B[1]+"\n"+n+U+U+B[0]+N+S[1]+B[1],B[0]+B[2]+N+B[1]+"\n"+n+U+B[0]+B[2]+O+B[1]+"\n"+n).scroll(2):i.insert(B[0]+B[2]+N+B[1]+"\n"+n+B[0]+N+S[1]+B[1],0).insert(r).scroll(1):C(W[0]+W[2]+o(N)+W[1]+"\\s*$").test(I)?i.insert(r).wrap("\n"+n+B[0]+t+B[1],B[0]+B[2]+N+B[1]):i.tidy("\n\n").insert(r).wrap(B[0]+R+B[1]+"\n"+U+B[0]+t+B[1],B[0]+B[2]+N+B[1]+"\n"+B[0]+B[2]+O+B[1]),i[1](),!1}function w(A,E){return!E.get(0)&&f&&F.tools.p.click(A,E),E}function Q(A){return l(A.replace(/\s+/g," "))}function k(A){return s(Q(A),[C(W[0]+".*?"+W[1],"g"),'"',"'"],["","&#34;","&#39;"])}function V(A){return s(Q(A),[C(W[0]+".*?"+W[1],"g"),/\s/g,'"'],["","%20","%22"])}var m,b,e="–",T="…",L="↑",I="↓",R="↵",t="⌘",O="✘",N="⇧",i=TE.ui(A,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],a:{},img:{},abbr:{}},languages:{tools:{clear:["Clear Format",O],b:["Bold",t+"+B"],i:["Italic",t+"+I"],u:["Underline",t+"+U"],s:["Strike",t+"+"+O],a:["Link",t+"+L"],img:["Image",t+"+G"],sub:["Subscript",t+"+"+I],sup:["Superscript",t+"+"+L],abbr:["Abbreviation",t+"+"+N+"+?"],p:["Paragraph",t+"+"+R],br:["Line Break",N+"+"+R],"p,h1,h2,h3,h4,h5,h6":["H1 "+e+" H6",t+"+H"],"blockquote,q":["Quote",t+"+Q"],"pre,code":["Code",t+"+K"],ul:["Unordered List",t+"+-"],ol:["Ordered List",t+"++"],table:["Table",t+"+T"],hr:["Horizontal Rule",t+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+T]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+T,"image caption here"+T]},abbr:{title:"Abbreviation",placeholder:"meaning here"+T},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+T]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),n=i._,r=n.edge,o=n.x,S=n.extend,a=n.i,C=n.pattern,l=n.trim,G=n.format,s=n.replace,c=S(i.config,E),F=i.ui,f=c.auto_p,u=(c.classes,c.formats),D=c.languages,H=c.states,d=c.suffix,U=c.tab,B=c.union[1][0],P=c.union[1][1],W=c.union[0][0],p=c.union[0][1],K="(?:"+p[3]+"[^"+W[0]+W[1]+"]*?)?",g="(|"+p[3]+"[^"+W[0]+W[1]+"]*?)",Y="([\\s\\S]*?)",h=D.placeholders;return i.type="HTML",S(F.tools,{clear:{i:"remove-format",click:function(A,E){var R,e=E[0]().$(),T=e.before,L=e.after,I=e.value,t=W[0]+"[^"+W[0]+W[1]+"]+?"+W[1],O=W[0]+"[^"+W[2]+W[0]+W[1]+"]+?"+W[1],N=W[0]+W[2]+"[^"+W[0]+W[1]+"]+?"+W[1];return!I&&L&&(R=C("^"+t)).test(L)?(E.replace(R,"",1),!1):(C(t).test(I)||T.slice(-1)===B[1]||L[0]===B[0]?E.replace(C(t,"g"),"").unwrap(C(O),C(N)):E.insert(""),E[1](),!!L)}},b:{i:"bold",click:function(A,E){return w(A,E).i().format(u.b),!1}},i:{i:"italic",click:function(A,E){return w(A,E).i().format(u.i),!1}},u:{i:"underline",click:function(A,E){return w(A,E).i().format(u.u),!1}},s:{i:"strike",click:function(A,E){return w(A,E).i().format(G(u.s,E._.time())),!1}},a:{i:"link",click:function(A,E){var L,I,e=u.a,T=D.modals.a;return F.prompt(T.title[0],T.placeholder[0],1,function(A,E,R){R=V(R),L=R;var O,N,t=location.host;-1!==L.indexOf("://")&&(O=1),""!==t&&-1!==L.indexOf("://"+t)&&(O=0),/^([.\/?&#]|javascript:)/.test(L)&&(O=0),F.prompt(T.title[1],T.placeholder[1],0,function(A,E,T){I=k(T),w(A,E).$().length||E.insert(h[""]),N=c.advance_a&&O?P[3]+"rel"+P[0]+P[1]+"nofollow"+P[2]+P[3]+"target"+P[0]+P[1]+"_blank"+P[2]:"",E.i().format(e+P[3]+"href"+P[0]+P[1]+L+P[2]+(I?P[3]+"title"+P[0]+P[1]+I+P[2]:"")+N)},0,0,"a[title]")},0,0,"a[href]").record(),!1}},img:{i:"image",click:function(A,E){var N,i,e=E.$(),T=u.img,L=u.figure,I=u.figcaption,R=e.value,t=D.modals.img,O=c.advance_img;return F.prompt(t.title[0],t.placeholder[0],1,function(A,E,e){e=V(e),N=e,F.prompt(t.title[O?2:1],t.placeholder[O?2:1],0,function(A,E,e){i=k(e),R||(R=N.split(/[\/\\\\]/).pop()),R=k(R),E[0](),O&&i?(E.tidy("\n\n","").insert(B[0]+L+B[1]+"\n"+U+B[0]+T+P[3]+"alt"+P[0]+P[1]+R+P[2]+P[3]+"src"+P[0]+P[1]+N+P[2]+d+"\n"+U+B[0]+I+B[1]+i+B[0]+B[2]+x(I)+B[1]+"\n"+B[0]+B[2]+x(L)+B[1]+"\n\n",0,1),f&&F.tools.p.click(A,E)):w(A,E).tidy(C(W[0]+"[^"+W[0]+W[1]+W[2]+"]+?"+W[1]+"\\s*$").test(E.$().before)?"":" ","").insert(B[0]+T+P[3]+"alt"+P[0]+P[1]+R+P[2]+P[3]+"src"+P[0]+P[1]+N+P[2]+(i?P[3]+"title"+P[0]+P[1]+i+P[2]:"")+d+" ",0,1),E[1]()},0,0,"img[title]")},0,0,"img[src]"),!1}},sub:{i:"subscript",click:function(A,E){var e=u.sub,T=u.sup,L=x(T);return w(A,E)[0]().unwrap(C(W[0]+o(L)+K+W[1]),B[0]+B[2]+L+B[1]).i().format(e)[1](),!1}},sup:{i:"superscript",click:function(A,E){var e=u.sub,T=u.sup,L=x(e);return w(A,E)[0]().unwrap(C(W[0]+o(L)+K+W[1]),B[0]+B[2]+L+B[1]).i().format(T)[1](),!1}},abbr:{i:"abbreviation",click:function(A,E){var S,a,e=E.$(),T=l(e.value),L=D.modals.abbr,I=E.get(),R=l(T||h[""]),t=u.abbr,O=x(t),N=W[0]+o(t)+g+W[1],i=W[0]+o(t)+K+W[1],n=W[0]+W[2]+o(O)+W[1],r=C(N+Y+n);return I.replace(r,function(A,E,e){(e=l(e))&&(H.abbr[e]=(E.match(C(p[3]+"+title"+p[0]+p[1]+"\\s*(.*?)\\s*"+p[2]))||["",""])[1])}),S=H.abbr,T&&S[T]?(E.i().format(t+P[3]+"title"+P[0]+P[1]+S[T]+P[2]),!1):(F.prompt(L.title,S[R]||L.placeholder,!S[T],function(A,E,e,L){e=k(e||L),E[0](),T||E.insert(e.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(a in S)if(k(S[a])===e){E.insert(a);break}w(A,E).unwrap(C(i),C(n)).unwrap(C(i),C(n),1).i().format(t+P[3]+"title"+P[0]+P[1]+e+P[2])[1]()},0,0,"abbr[title]").record(),!1)}},p:{i:"paragraph",click:function(A,E){var r,e=E.$(),T=e.value,L=u.p,I=u.br,R=x(L),t=x(I),O=e.before,N=e.after,i=y(O),n=h[""];if(E[0](),T&&-1!==T.indexOf("\n")){var S=C("^(?:\\s*"+W[0]+o(R)+K+W[1]+"\\s*)+"+Y+"(?:\\s*"+W[0]+W[2]+o(R)+W[1]+"\\s*)+$");S.test(T)?E.replace(S,"$1").replace(C("\\s*"+W[0]+W[2]+o(R)+W[1]+"\\s*"+W[0]+o(R)+K+W[1]+"\\s*","g"),"\n\n").replace(C("\\s*"+W[0]+o(t)+K+W[1]+"\\s*","g"),"\n"):E.replace(/\n/g,"\n"+B[0]+I+d+"\n").replace(C("(\\s*"+W[0]+o(t)+K+d+"\\s*){2,}","g"),B[0]+B[2]+R+B[1]+"\n"+B[0]+L+B[1]).wrap(B[0]+L+B[1],B[0]+B[2]+R+B[1],1).replace(C("("+W[0]+o(R)+K+W[1]+")+","g"),"$1").replace(C("("+W[0]+W[2]+o(R)+W[1]+")+","g"),"$1").tidy("\n")}else C("^\\s*"+W[0]+W[2]+o(R)+W[1]).test(N)?C(W[0]+o(R)+K+W[1]+"\\s*$").test(O)?E.unwrap(C("\\s*"+W[0]+o(R)+K+W[1]+"\\s*"),C("\\s*"+W[0]+W[2]+o(R)+W[1])).replace(n,"").tidy("\n","\n"+i):(r=O.match(C(W[0]+o(R)+g+W[1]+".*?$")))&&E.wrap(B[0]+B[2]+R+B[1]+"\n"+i+B[0]+R+r[1]+B[1],"").insert(n).scroll(1):E.tidy("\n\n").format(L,0,"\n\n").scroll(1);return E[1](),!1}},br:{i:"break",click:function(A,E){return b=y(E.$().before),E.tidy("\n","").insert(b+B[0]+u.br+d+"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"headers",click:function(A,E){var I,R,e=E.$(),T=[u.p,u.h1,u.h2,u.h3,u.h4,u.h5,u.h6],L=[];for(I in T)L[I]=x(T[I]);var O=(o(T).join("|"),o(L).join("|")),N="\\s*"+W[0]+"("+O+")"+g+W[1]+"\\s*",i=C("\\s*"+W[0]+"(?:"+O+")"+K+W[1]+"\\s*"),n=C("\\s*"+W[0]+W[2]+"(?:"+O+")"+W[1]+"\\s*"),r=e.value.match(C("^"+N));return r||(r=e.before.match(C(N+"$"))||[]),R=r[2]||"",I=+(r[1]||"h0").slice(1),E[0]().unwrap(i,n).unwrap(i,n,1).i().tidy("\n\n").format(I>5?L[0]+R:L[I+1]+R,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote",click:function(A,E){var n,e=E.$(),T=e.value,L=u.blockquote,I=u.q,R=u.p,t=x(R),O=o(t),N=C(W[0]+W[2]+O+W[1]),i=h[""];return/(^|\n)$/.test(e.before)?(f&&!N.test(T)&&F.tools.p.click(A,E),e=E.$(),T=e.value,!N.test(T)&&f&&E.select(e.start-(B[0]+R+B[1]).length,e.end+(B[0]+B[2]+t+B[1]).length),T!==i&&f?(E[0]().tidy("\n\n").insert(B[0]+L+B[1]+"\n"+E.$().value.replace(C("^(\\s*"+W[0]+")","gm"),U+"$1")+"\n"+B[0]+B[2]+x(L)+B[1]+"\n\n",0,1),f&&F.tools.p.click(A,E)):(E[0]().format(L,0,"\n\n","\n").loss().replace(C("^(\\s*"+W[0]+")","gm"),U+"$1"),f&&(e=E.$(),n=e.start+(B[0]+R+B[1]+U).length,E.select(n,n+i.length))),E[1]()):E.i().format(I),!1}},"pre,code":{i:"code",click:function(A,E){function a(A){return L?s(A,["&","<",">"],["&amp;","&lt;","&gt;"]):A}function l(A){return L?s(A,["&amp;","&lt;","&gt;"],["&","<",">"]):A}var e=E.$(),T=e.value,L=c.auto_encode_html,I=u.pre,R=u.code,t=x(I),O=x(R),N=W[0]+o(t)+K+W[1]+"\\s*"+W[0]+o(O)+K+W[1]+"\\s*",i="\\s*"+W[0]+W[2]+o(O)+W[1]+"\\s*"+W[0]+W[2]+o(t)+W[1],n=C(N+"\\s*$"),r=C("^\\s*"+i),S=C("^"+Y+"$");return C("(^|\\n|"+N+")$").test(e.before)?n.test(e.before)&&r.test(e.after)?E[0]().unwrap(C(n),C(r)).replace(S,l)[1]():E[0]().tidy("\n\n").wrap(B[0]+I+B[1]+B[0]+R+B[1],B[0]+B[2]+O+B[1]+B[0]+B[2]+t+B[1]).insert(T||h[""]).replace(S,a)[1]():E[0]().format(R).replace(S,function(A){return Q(C("^\\s*"+W[0]+W[2]+o(O)+W[1]).test(E.$().after)?a(A):l(A))})[1](),!1}},ul:{i:"list-bullet",click:function(A,E){var e=u.ol,T=u.ul,L=x(e),I=x(T),R="("+o(I)+"|"+o(L)+")";return E.match(C(W[0]+R+K+W[1]+Y+W[0]+W[2]+R+W[1]))?E[0]().replace(C(W[0]+o(L)+g+W[1],"g"),B[0]+I+"$1"+B[1]).replace(C(W[0]+W[2]+o(L)+W[1],"g"),B[0]+B[2]+I+B[1])[1]():v(A,T,u.li),!1}},ol:{i:"list-number",click:function(A,E){var e=u.ol,T=u.ul,L=x(e),I=x(T),R="("+o(I)+"|"+o(L)+")";return E.match(C(W[0]+R+K+W[1]+Y+W[0]+W[2]+R+W[1]))?E[0]().replace(C(W[0]+o(I)+g+W[1],"g"),B[0]+L+"$1"+B[1]).replace(C(W[0]+W[2]+o(I)+W[1],"g"),B[0]+B[2]+L+B[1])[1]():v(A,e,u.li),!1}},table:function(A,E){var h,m,b,y,e=H.tr,T=H.td,L=D.modals.table,I=D.placeholders.table,R=l(G(I[0],[1,1])),t=c.advance_table?U:"",O=u.table,N=u.caption,i=u.thead,n=u.tbody,o=u.tfoot,S=u.tr,C=u.th,s=u.td,f=x(O),M=x(N),d=x(i),P=x(n),W=x(o),p=x(S),K=x(C),g=x(s),Y=[];return E[0]().$().value===R?(E.select(),!1):(F.prompt(L.title[0],L.placeholder[0],0,function(A,E,c,u){m=r(a(c)||u,T[0],T[1]),F.prompt(L.title[1],L.placeholder[1],0,function(A,E,T,c){b=r(a(T)||c,e[0],e[1]),F.prompt(L.title[2],L.placeholder[2],0,function(A,E,e){var L,r,a,F,u,T="";for(y=Q(e),L=0;b>L;++L){for(h=t+U+B[0]+S+B[1]+"\n",r=0;m>r;++r)h+=t+U+U+B[0]+s+B[1]+l(G(I[1],[L+1,r+1]))+B[0]+B[2]+g+B[1]+"\n";h+=t+U+B[0]+B[2]+p+B[1],Y.push(h)}for(Y=Y.join("\n"),h=U+(t?B[0]+i+B[1]+"\n"+U+U+B[0]+S+B[1]:B[0]+p+B[1])+"\n",a=0;m>a;++a)h+=t+U+U+B[0]+C+B[1]+l(G(I[0],[1,a+1]))+B[0]+B[2]+K+B[1]+"\n";if(t){for(T+=U+B[0]+o+B[1]+"\n",T+=U+U+B[0]+S+B[1]+"\n",a=0;m>a;++a)T+=U+U+U+B[0]+s+B[1]+l(G(I[2],[1,a+1]))+B[0]+B[2]+g+B[1]+"\n";T+=U+U+B[0]+B[2]+S+B[1]+"\n",T+=U+B[0]+B[2]+W+B[1]+"\n"}h+=t+U+B[0]+B[2]+p+B[1]+(t?"\n"+U+B[0]+B[2]+d+B[1]+"\n"+T+U+B[0]+n+B[1]:"")+"\n",Y=h+Y+(t?"\n"+U+B[0]+B[2]+P+B[1]:"")+"\n",E.tidy("\n\n").insert(B[0]+O+B[1]+"\n"+(y&&N?U+B[0]+N+B[1]+y+B[0]+B[2]+M+B[1]+"\n":"")+Y+B[0]+B[2]+f+B[1]),F=E.$(),u=F.start+F.value.indexOf(R),E.select(u,u+R.length)[1]()},0,0,"table>caption")},0,0,"table>tr")},0,0,"table>td"),!1)},hr:{i:"horizontal-rule",click:function(A,E){return b=y(E.$().before),E.tidy("\n\n","").insert(b+B[0]+u.hr+d+"\n\n",0),!1}}}),c.keys&&S(F.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(A,E){var r,S,a,e=E.$(),T=e.value,L=E.get(),I=u.p,R=u.li,t=x(I),O=x(R),i=(y(e.before),h[""]),n=F.tools;if(!T||T===i){if(r=e.after.match(C("^\\s*"+W[0]+W[2]+"("+o(t)+"|"+o(O)+")"+W[1])))S=r[1],(n[S===O?m:S]||n.ul).click(A,E);else{if(!(f&&I&&l(L)&&e.end===L.length&&C("^\\s*[^"+W[0]+"\\n]*?[^"+W[1]+"]\\s*$").test(L)))return;L=B[0]+I+B[1]+L+B[0]+B[2]+t+B[1]+"\n"+B[0]+I+B[1],a=i+B[0]+B[2]+t+B[1],E.set(L+a).select(L.length,(L+i).length)}return!1}},tab:function(A,E){var e=E.$(),T=u.li,L=x(T),I=y(e.before);return C(W[0]+W[2]+o(L)+W[1]).test(e.after)?(E[0]().wrap("\n"+I+U+B[0]+(u[m]||m)+B[1]+"\n"+I+U+U+B[0]+T+B[1],B[0]+B[2]+L+B[1]+"\n"+I+U+B[0]+B[2]+m+B[1]+"\n"+I).insert(h[""])[1](),!1):F.tools.indent.click(A,E)},backspace:function(A,E){var L,e=E.$(),T=e.value,I=e.before,R=e.after,t=W[0]+"[^"+W[0]+W[1]+"]+?"+W[1];return!T&&C(t+"$").test(I)?(L=I.split(B[0]).pop().match(C("^([^"+W[2]+"\\s]+).*?"+W[1]+"\\s*$")),L=L&&L[1]||0,L&&C("^\\s*"+W[0]+W[2]+o(L)+W[1]).test(R)?E.unwrap(C(W[0]+o(L)+K+W[1]),C("\\s*"+W[0]+W[2]+o(L)+W[1])):E.outdent(C(t)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),i.update(E,0)};