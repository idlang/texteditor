/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.3.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(e,t){function q(e){return e.split(g("("+O[3]+")+"))[0]}function I(e){return D=e.match(/(?:^|\n)([\t ]*).*$/),D&&D[1]||""}function Y(e,t,n){var h,r=a.$(),i=r.value,o=r.before,f=E[t]||t,u=E[n]||n,l=q(f),s=q(u),c=I(o),d=A[""];return N=f,a[0](),i&&i!==d?(a.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,C[0]+C[2]+s+C[1]+"\n"+z+C[0]+u+C[1]).wrap(C[0]+f+C[1]+"\n"+z+C[0]+u+C[1],C[0]+C[2]+s+C[1]+"\n"+C[0]+C[2]+l+C[1]+"\n\n",1).replace(g("\\n"+p(z)+M[0]+p(u)+M[1]+"\\s*"+M[0]+M[2]+p(s)+M[1]+"\\n","g"),"\n"+C[0]+C[2]+l+C[1]+"\n\n"+C[0]+f+C[1]+"\n").select(a.$().end),x&&k.tools.p.click(e,a)):(h=o.match(g("(?:^|\\n)[\\t ]+"+M[0]+"("+M[2]+"?)(?:"+p(q(E.ul))+"|"+p(q(E.ol))+")"+H+M[1]+"\\s*$")))?a.insert("\n"+c+(h[1]?"":z),0):(h=o.match(g(M[0]+p(s)+j+M[1]+".*?$")))?g(M[0]+M[2]+p(s)+M[1]+"\\s*$").test(o)?a.tidy("\n"+c,!1).insert(d).wrap(C[0]+s+h[1]+C[1],C[0]+C[2]+s+C[1]):g(M[1]+"\\s*$").test(o)?a.insert(d).wrap("\n"+c+z+C[0]+f+C[1]+"\n"+c+z+z+C[0]+s+h[1]+C[1],C[0]+C[2]+s+C[1]+"\n"+c+z+C[0]+C[2]+l+C[1]+"\n"+c):a.insert(C[0]+C[2]+s+C[1]+"\n"+c+C[0]+s+h[1]+C[1],0).insert(d):g(M[0]+M[2]+p(s)+M[1]+"\\s*$").test(o)?a.insert(d).wrap("\n"+c+C[0]+u+C[1],C[0]+C[2]+s+C[1]):a.tidy("\n\n").insert(d).wrap(C[0]+f+C[1]+"\n"+z+C[0]+u+C[1],C[0]+C[2]+s+C[1]+"\n"+C[0]+C[2]+l+C[1]),a[1](),!1}function F(e,t){return!t.get(0)&&x&&k.tools.p.click(e,t),t}function R(e){return m(e.replace(/\s+/g," "))}function U(e){return y(R(e),[g(M[0]+".*?"+M[1],"g"),'"',"'"],["","&#34;","&#39;"])}function W(e){return y(R(e),[g(M[0]+".*?"+M[1],"g"),/\s/g,'"'],["","%20","%22"])}var N,D,n="–",r="…",i="↑",o="↓",f="↵",u="⌘",l="✘",s="⇧",a=TE.ui(e,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],abbr:{}},languages:{tools:{clear:["Clear Format",l],b:["Bold",u+"+B"],i:["Italic",u+"+I"],u:["Underline",u+"+U"],s:["Strike",u+"+"+l],a:["Link",u+"+L"],img:["Image",u+"+G"],sub:["Subscript",u+"+"+o],sup:["Superscript",u+"+"+i],abbr:["Abbreviation",u+"+"+s+"+?"],p:["Paragraph",u+"+"+f],br:["Line Break",s+"+"+f],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",u+"+H"],"blockquote,q":["Quote",u+"+Q"],"pre,code":["Code",u+"+K"],ul:["Unordered List",u+"+-"],ol:["Ordered List",u+"++"],table:["Table",u+"+T"],hr:["Horizontal Rule",u+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),c=a._,d=c.edge,p=c.x,h=c.extend,b=c.i,g=c.pattern,m=c.trim,v=c.format,y=c.replace,w=h(a.config,t),k=a.ui,x=w.auto_p,E=(w.classes,w.formats),T=w.languages,L=w.states,_=w.suffix,z=w.tab,C=w.unit[0][0],S=w.unit[0][1],M=w.unit[1][0],O=w.unit[1][1],H="(?:"+O[3]+"[^"+M[0]+M[1]+"]*?)?",j="(|"+O[3]+"[^"+M[0]+M[1]+"]*?)",B="([\\s\\S]*?)",A=T.placeholders;return a.type="HTML",h(k.tools,{clear:{i:"eraser",click:function(e,t){var f,n=t[0]().$(),r=n.before,i=n.after,o=n.value,u=M[0]+"[^"+M[0]+M[1]+"]+?"+M[1],l=M[0]+"[^"+M[2]+M[0]+M[1]+"]+?"+M[1],s=M[0]+M[2]+"[^"+M[0]+M[1]+"]+?"+M[1];return!o&&i&&(f=g("^"+u)).test(i)?(t.replace(f,"",1),!1):(g(u).test(o)||r.slice(-1)===C[1]||i[0]===C[0]?t.replace(g(u,"g"),"").unwrap(g(l),g(s)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return F(e,t).i().format(E.b),!1}},i:{i:"italic",click:function(e,t){return F(e,t).i().format(E.i),!1}},u:{i:"underline",click:function(e,t){return F(e,t).i().format(E.u),!1}},s:{i:"strikethrough",click:function(e,t){return F(e,t).i().format(v(E.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=E.a,r=T.modals.a;return k.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,f){f=W(f),i=f;var l,s,u=location.host;-1!==i.indexOf("://")&&(l=1),""!==u&&-1!==i.indexOf("://"+u)&&(l=0),/^([.\/?&#]|javascript:)/.test(i)&&(l=0),k.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=U(r),F(e,t).$().length||t.insert(A[""]),s=w.advance_a&&l?S[3]+"rel"+S[0]+S[1]+"nofollow"+S[2]+S[3]+"target"+S[0]+S[1]+"_blank"+S[2]:"",t.i().format(n+S[3]+"href"+S[0]+S[1]+i+S[2]+(o?S[3]+"title"+S[0]+S[1]+o+S[2]:"")+s)})}).record(),!1}},img:{i:"image",click:function(e,t){var s,a,n=t.$(),r=E.img,i=E.figure,o=E.figcaption,f=n.value,u=T.modals.img,l=w.advance_img;return k.prompt(["img[src]",u.title[0]],u.placeholder[0],1,function(e,t,n){n=W(n),s=n,k.prompt(["img[title]",u.title[l?2:1]],u.placeholder[l?2:1],0,function(e,t,n){a=U(n),f||(f=s.split(/[\/\\\\]/).pop()),f=U(f),t[0](),l&&a?(t.tidy("\n\n","").insert(C[0]+i+C[1]+"\n"+z+C[0]+r+S[3]+"alt"+S[0]+S[1]+f+S[2]+S[3]+"src"+S[0]+S[1]+s+S[2]+_+"\n"+z+C[0]+o+C[1]+a+C[0]+C[2]+q(o)+C[1]+"\n"+C[0]+C[2]+q(i)+C[1]+"\n\n",0,1),x&&k.tools.p.click(e,t)):F(e,t).tidy(g(M[0]+"[^"+M[0]+M[1]+M[2]+"]+?"+M[1]+"\\s*$").test(t.$().before)?"":" ","").insert(C[0]+r+S[3]+"alt"+S[0]+S[1]+f+S[2]+S[3]+"src"+S[0]+S[1]+s+S[2]+(a?S[3]+"title"+S[0]+S[1]+a+S[2]:"")+_+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=E.sub,r=E.sup,i=q(r);return F(e,t)[0]().unwrap(g(M[0]+p(i)+H+M[1]),C[0]+C[2]+i+C[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=E.sub,r=E.sup,i=q(n);return F(e,t)[0]().unwrap(g(M[0]+p(i)+H+M[1]),C[0]+C[2]+i+C[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var h,b,n=t.$(),r=m(n.value),i=T.modals.abbr,o=t.get(),f=m(r||A[""]),u=E.abbr,l=q(u),s=M[0]+p(u)+j+M[1],a=M[0]+p(u)+H+M[1],c=M[0]+M[2]+p(l)+M[1],d=g(s+B+c);return o.replace(d,function(e,t,n){(n=m(n))&&(L.abbr[n]=(t.match(g(O[3]+"+title"+O[0]+O[1]+"\\s*(.*?)\\s*"+O[2]))||["",""])[1])}),h=L.abbr,r&&h[r]?(t.i().format(u+S[3]+"title"+S[0]+S[1]+h[r]+S[2]),!1):(k.prompt(["abbr[title]",i.title],h[f]||i.placeholder,!h[r],function(e,t,n,i){n=U(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(b in h)if(U(h[b])===n){t.insert(b);break}F(e,t).unwrap(g(a),g(c)).unwrap(g(a),g(c),1).i().format(u+S[3]+"title"+S[0]+S[1]+n+S[2])[1]()}).record(),!1)}},p:{i:"paragraph",click:function(e,t){var d,n=t.$(),r=n.value,i=E.p,o=E.br,f=q(i),u=q(o),l=n.before,s=n.after,a=I(l),c=A[""];if(t[0](),r&&-1!==r.indexOf("\n")){var h=g("^(?:\\s*"+M[0]+p(f)+H+M[1]+"\\s*)+"+B+"(?:\\s*"+M[0]+M[2]+p(f)+M[1]+"\\s*)+$");h.test(r)?t.replace(h,"$1").replace(g("\\s*"+M[0]+M[2]+p(f)+M[1]+"\\s*"+M[0]+p(f)+H+M[1]+"\\s*","g"),"\n\n").replace(g("\\s*"+M[0]+p(u)+H+M[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+C[0]+o+_+"\n").replace(g("(\\s*"+M[0]+p(u)+H+_+"\\s*){2,}","g"),C[0]+C[2]+f+C[1]+"\n"+C[0]+i+C[1]).wrap(C[0]+i+C[1],C[0]+C[2]+f+C[1],1).replace(g("("+M[0]+p(f)+H+M[1]+")+","g"),"$1").replace(g("("+M[0]+M[2]+p(f)+M[1]+")+","g"),"$1").tidy("\n")}else g("^\\s*"+M[0]+M[2]+p(f)+M[1]).test(s)?g(M[0]+p(f)+H+M[1]+"\\s*$").test(l)?t.unwrap(g("\\s*"+M[0]+p(f)+H+M[1]+"\\s*"),g("\\s*"+M[0]+M[2]+p(f)+M[1])).replace(c,"").tidy("\n","\n"+a):(d=l.match(g(M[0]+p(f)+j+M[1]+".*?$")))&&t.wrap(C[0]+C[2]+f+C[1]+"\n"+a+C[0]+f+d[1]+C[1],"").insert(c):t.tidy("\n\n").format(i,0,"\n\n");return t[1](),!1}},br:{i:"level-down",click:function(e,t){return D=I(t.$().before),t.tidy("\n","").insert(D+C[0]+E.br+_+"\n",0),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var o,f,n=t.$(),r=[E.p,E.h1,E.h2,E.h3,E.h4,E.h5,E.h6],i=[];for(o in r)i[o]=q(r[o]);var l=(p(r).join("|"),p(i).join("|")),s="\\s*"+M[0]+"("+l+")"+j+M[1]+"\\s*",a=g("\\s*"+M[0]+"(?:"+l+")"+H+M[1]+"\\s*"),c=g("\\s*"+M[0]+M[2]+"(?:"+l+")"+M[1]+"\\s*"),d=n.value.match(g("^"+s));return d||(d=n.before.match(g(s+"$"))||[]),f=d[2]||"",o=+(d[1]||"h0").slice(1),t[0]().unwrap(a,c).unwrap(a,c,1).i().tidy("\n\n").format(o>5?i[0]+f:i[o+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var c,n=t.$(),r=n.value,i=E.blockquote,o=E.q,f=E.p,u=q(f),l=p(u),s=g(M[0]+M[2]+l+M[1]),a=A[""];return/(^|\n)$/.test(n.before)?(x&&!s.test(r)&&k.tools.p.click(e,t),n=t.$(),r=n.value,!s.test(r)&&x&&t.select(n.start-(C[0]+f+C[1]).length,n.end+(C[0]+C[2]+u+C[1]).length),r!==a&&x?(t[0]().tidy("\n\n").insert(C[0]+i+C[1]+"\n"+t.$().value.replace(g("^(\\s*"+M[0]+")","gm"),z+"$1")+"\n"+C[0]+C[2]+q(i)+C[1]+"\n\n",0,1),x&&k.tools.p.click(e,t)):(t[0]().format(i,0,"\n\n","\n").loss().replace(g("^(\\s*"+M[0]+")","gm"),z+"$1"),x&&(n=t.$(),c=n.start+(C[0]+f+C[1]+z).length,t.select(c,c+a.length))),t[1]()):t.i().format(o),!1}},"pre,code":{i:"code",click:function(e,t){function b(e){return i?y(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function m(e){return i?y(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=w.auto_encode_html,o=E.pre,f=E.code,u=q(o),l=q(f),s=M[0]+p(u)+H+M[1]+"\\s*"+M[0]+p(l)+H+M[1]+"\\s*",a="\\s*"+M[0]+M[2]+p(l)+M[1]+"\\s*"+M[0]+M[2]+p(u)+M[1],c=g(s+"\\s*$"),d=g("^\\s*"+a),h=g("^"+B+"$");return g("(^|\\n|"+s+")$").test(n.before)?c.test(n.before)&&d.test(n.after)?t[0]().unwrap(g(c),g(d)).replace(h,m)[1]():t[0]().tidy("\n\n").wrap(C[0]+o+C[1]+C[0]+f+C[1],C[0]+C[2]+l+C[1]+C[0]+C[2]+u+C[1]).insert(r||A[""]).replace(h,b)[1]():t[0]().format(f).replace(h,function(e){return R(g("^\\s*"+M[0]+M[2]+p(l)+M[1]).test(t.$().after)?b(e):m(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=E.ol,r=E.ul,i=q(n),o=q(r),f="("+p(o)+"|"+p(i)+")";return t.match(g(M[0]+f+H+M[1]+B+M[0]+M[2]+f+M[1]))?t[0]().replace(g(M[0]+p(i)+j+M[1],"g"),C[0]+o+"$1"+C[1]).replace(g(M[0]+M[2]+p(i)+M[1],"g"),C[0]+C[2]+o+C[1])[1]():Y(e,r,E.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=E.ol,r=E.ul,i=q(n),o=q(r),f="("+p(o)+"|"+p(i)+")";return t.match(g(M[0]+f+H+M[1]+B+M[0]+M[2]+f+M[1]))?t[0]().replace(g(M[0]+p(o)+j+M[1],"g"),C[0]+i+"$1"+C[1]).replace(g(M[0]+M[2]+p(o)+M[1],"g"),C[0]+C[2]+i+C[1])[1]():Y(e,n,E.li),!1}},table:function(e,t){var A,N,D,I,n=L.tr,r=L.td,i=T.modals.table,o=T.placeholders.table,f=m(v(o[0],[1,1])),u=w.advance_table?z:"",l=E.table,s=E.caption,a=E.thead,c=E.tbody,p=E.tfoot,h=E.tr,g=E.th,y=E.td,x=q(l),$=q(s),_=q(a),S=q(c),M=q(p),O=q(h),H=q(g),j=q(y),B=[];return t[0]().$().value===f?(t.select(),!1):(k.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,w,E){N=d(b(w)||E,r[0],r[1]),k.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,w){D=d(b(r)||w,n[0],n[1]),k.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,d,b,k,E,r="";for(I=R(n),i=0;D>i;++i){for(A=u+z+C[0]+h+C[1]+"\n",d=0;N>d;++d)A+=u+z+z+C[0]+y+C[1]+m(v(o[1],[i+1,d+1]))+C[0]+C[2]+j+C[1]+"\n";A+=u+z+C[0]+C[2]+O+C[1],B.push(A)}for(B=B.join("\n"),A=z+(u?C[0]+a+C[1]+"\n"+z+z+C[0]+h+C[1]:C[0]+O+C[1])+"\n",b=0;N>b;++b)A+=u+z+z+C[0]+g+C[1]+m(v(o[0],[1,b+1]))+C[0]+C[2]+H+C[1]+"\n";if(u){for(r+=z+C[0]+p+C[1]+"\n",r+=z+z+C[0]+h+C[1]+"\n",b=0;N>b;++b)r+=z+z+z+C[0]+y+C[1]+m(v(o[2],[1,b+1]))+C[0]+C[2]+j+C[1]+"\n";r+=z+z+C[0]+C[2]+h+C[1]+"\n",r+=z+C[0]+C[2]+M+C[1]+"\n"}A+=u+z+C[0]+C[2]+O+C[1]+(u?"\n"+z+C[0]+C[2]+_+C[1]+"\n"+r+z+C[0]+c+C[1]:"")+"\n",B=A+B+(u?"\n"+z+C[0]+C[2]+S+C[1]:"")+"\n",t.tidy("\n\n").insert(C[0]+l+C[1]+"\n"+(I&&s?z+C[0]+s+C[1]+I+C[0]+C[2]+$+C[1]+"\n":"")+B+C[0]+C[2]+x+C[1]),k=t.$(),E=k.start+k.value.indexOf(f),t.select(E,E+f.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){return D=I(t.$().before),t.tidy("\n\n","").insert(D+C[0]+E.hr+_+"\n\n",0),!1}}}),w.keys&&h(k.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var d,h,b,n=t.$(),r=n.value,i=t.get(),o=E.p,f=E.li,u=q(o),l=q(f),a=(I(n.before),A[""]),c=k.tools;if(!r||r===a){if(d=n.after.match(g("^\\s*"+M[0]+M[2]+"("+p(u)+"|"+p(l)+")"+M[1])))h=d[1],(c[h===l?N:h]||c.ul).click(e,t);else{if(!(x&&o&&m(i)&&n.end===i.length&&g("^\\s*[^"+M[0]+"\\n]*?[^"+M[1]+"]\\s*$").test(i)))return;i=C[0]+o+C[1]+i+C[0]+C[2]+u+C[1]+"\n"+C[0]+o+C[1],b=a+C[0]+C[2]+u+C[1],t.set(i+b).select(i.length,(i+a).length)}return!1}},tab:function(e,t){var n=t.$(),r=E.li,i=q(r),o=I(n.before);return g(M[0]+M[2]+p(i)+M[1]).test(n.after)?(t[0]().wrap("\n"+o+z+C[0]+(E[N]||N)+C[1]+"\n"+o+z+z+C[0]+r+C[1],C[0]+C[2]+i+C[1]+"\n"+o+z+C[0]+C[2]+N+C[1]+"\n"+o).insert(A[""])[1](),!1):k.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,f=n.after,u=M[0]+"[^"+M[0]+M[1]+"]+?"+M[1];return!r&&g(u+"$").test(o)?(i=o.split(C[0]).pop().match(g("^([^"+M[2]+"\\s]+).*?"+M[1]+"\\s*$")),i=i&&i[1]||0,i&&g("^\\s*"+M[0]+M[2]+p(i)+M[1]).test(f)?t.unwrap(g(M[0]+p(i)+H+M[1]),g("\\s*"+M[0]+M[2]+p(i)+M[1])):t.outdent(g(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),a.update(t,0)};