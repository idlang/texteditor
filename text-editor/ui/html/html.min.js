/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.3.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui.HTML=function(e,t){function P(e){return e.split(m("("+A[3]+")+"))[0]}function I(e){return B=e.match(/(?:^|\n)([\t ]*).*$/),B&&B[1]||""}function q(e,t,n){var h,r=s.$(),i=r.value,u=r.before,o=E[t]||t,f=E[n]||n,a=P(o),c=P(f),l=I(u),p=R[""];return K=o,s[0](),i&&i!==p?(s.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,z[0]+z[2]+c+z[1]+"\n"+S+z[0]+f+z[1]).wrap(z[0]+o+z[1]+"\n"+S+z[0]+f+z[1],z[0]+z[2]+c+z[1]+"\n"+z[0]+z[2]+a+z[1]+"\n\n",1).replace(m("\\n"+d(S)+O[0]+d(f)+O[1]+"\\s*"+O[0]+O[2]+d(c)+O[1]+"\\n","g"),"\n"+z[0]+z[2]+a+z[1]+"\n\n"+z[0]+o+z[1]+"\n").select(s.$().end),x&&$.tools.p.click(e,s)):(h=u.match(m("(?:^|\\n)[\\t ]+"+O[0]+"("+O[2]+"?)(?:"+d(P(E.ul))+"|"+d(P(E.ol))+")"+j+O[1]+"\\s*$")))?s.insert("\n"+l+(h[1]?"":S),0):(h=u.match(m(O[0]+d(c)+H+O[1]+".*?$")))?m(O[0]+O[2]+d(c)+O[1]+"\\s*$").test(u)?s.tidy("\n"+l,!1).insert(p).wrap(z[0]+c+h[1]+z[1],z[0]+z[2]+c+z[1]):m(O[1]+"\\s*$").test(u)?s.insert(p).wrap("\n"+l+S+z[0]+o+z[1]+"\n"+l+S+S+z[0]+c+h[1]+z[1],z[0]+z[2]+c+z[1]+"\n"+l+S+z[0]+z[2]+a+z[1]+"\n"+l):s.insert(z[0]+z[2]+c+z[1]+"\n"+l+z[0]+c+h[1]+z[1],0).insert(p):m(O[0]+O[2]+d(c)+O[1]+"\\s*$").test(u)?s.insert(p).wrap("\n"+l+z[0]+f+z[1],z[0]+z[2]+c+z[1]):s.tidy("\n\n").insert(p).wrap(z[0]+o+z[1]+"\n"+S+z[0]+f+z[1],z[0]+z[2]+c+z[1]+"\n"+z[0]+z[2]+a+z[1]),s[1](),!1}function U(e,t){return!t.get(0)&&x&&$.tools.p.click(e,t),t}function N(e){return b(e.replace(/\s+/g," "))}function Y(e){return v(N(e),[m(O[0]+".*?"+O[1],"g"),'"',"'"],["","&#34;","&#39;"])}function X(e){return v(N(e),[m(O[0]+".*?"+O[1],"g"),/\s/g,'"'],["","%20","%22"])}var K,B,n="–",r="…",i="↑",u="↓",o="↵",f="⌘",a="✘",c="⇧",s=TE.ui(e,{auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,10],td:[1,10],a:{},img:{},abbr:{}},languages:{tools:{clear:["Clear Format",a],b:["Bold",f+"+B"],i:["Italic",f+"+I"],u:["Underline",f+"+U"],s:["Strike",f+"+"+a],a:["Link",f+"+L"],img:["Image",f+"+G"],sub:["Subscript",f+"+"+u],sup:["Superscript",f+"+"+i],abbr:["Abbreviation",f+"+"+c+"+?"],p:["Paragraph",f+"+"+o],br:["Line Break",c+"+"+o],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",f+"+H"],"blockquote,q":["Quote",f+"+Q"],"pre,code":["Code",f+"+K"],ul:["Unordered List",f+"+-"],ol:["Ordered List",f+"++"],table:["Table",f+"+T"],hr:["Horizontal Rule",f+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}}),l=s._,p=l.edge,d=l.x,h=l.extend,g=l.i,m=l.pattern,b=l.trim,y=l.format,v=l.replace,w=h(s.config,t),$=s.ui,x=w.auto_p,E=(w.classes,w.formats),T=w.languages,_=w.states,C=w.suffix,S=w.tab,z=w.unit[0][0],L=w.unit[0][1],O=w.unit[1][0],A=w.unit[1][1],j="(?:"+A[3]+"[^"+O[0]+O[1]+"]*?)?",H="(|"+A[3]+"[^"+O[0]+O[1]+"]*?)",M="([\\s\\S]*?)",R=T.placeholders;return s.type="HTML",h($.tools,{clear:{i:"eraser",click:function(e,t){var o,n=t[0]().$(),r=n.before,i=n.after,u=n.value,f=O[0]+"[^"+O[0]+O[1]+"]+?"+O[1],a=O[0]+"[^"+O[2]+O[0]+O[1]+"]+?"+O[1],c=O[0]+O[2]+"[^"+O[0]+O[1]+"]+?"+O[1];return!u&&i&&(o=m("^"+f)).test(i)?(t.replace(o,"",1),!1):(m(f).test(u)||r.slice(-1)===z[1]||i[0]===z[0]?t.replace(m(f,"g"),"").unwrap(m(a),m(c)):t.insert(""),t[1](),!!i)}},b:{i:"bold",click:function(e,t){return U(e,t).i().format(E.b),!1}},i:{i:"italic",click:function(e,t){return U(e,t).i().format(E.i),!1}},u:{i:"underline",click:function(e,t){return U(e,t).i().format(E.u),!1}},s:{i:"strikethrough",click:function(e,t){return U(e,t).i().format(y(E.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,u,n=E.a,r=T.modals.a;return $.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,o){o=X(o),i=o;var a,c,f=location.host;-1!==i.indexOf("://")&&(a=1),""!==f&&-1!==i.indexOf("://"+f)&&(a=0),/^([.\/?&#]|javascript:)/.test(i)&&(a=0),$.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){u=Y(r),U(e,t).$().length||t.insert(R[""]),c=w.advance_a&&a?L[3]+"rel"+L[0]+L[1]+"nofollow"+L[2]+L[3]+"target"+L[0]+L[1]+"_blank"+L[2]:"",t.i().format(n+L[3]+"href"+L[0]+L[1]+i+L[2]+(u?L[3]+"title"+L[0]+L[1]+u+L[2]:"")+c)})}).record(),!1}},img:{i:"image",click:function(e,t){var c,s,n=t.$(),r=E.img,i=E.figure,u=E.figcaption,o=n.value,f=T.modals.img,a=w.advance_img;return $.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,n){n=X(n),c=n,$.prompt(["img[title]",f.title[a?2:1]],f.placeholder[a?2:1],0,function(e,t,n){s=Y(n),o||(o=c.split(/[\/\\\\]/).pop()),o=Y(o),t[0](),a&&s?(t.tidy("\n\n","").insert(z[0]+i+z[1]+"\n"+S+z[0]+r+L[3]+"alt"+L[0]+L[1]+o+L[2]+L[3]+"src"+L[0]+L[1]+c+L[2]+C+"\n"+S+z[0]+u+z[1]+s+z[0]+z[2]+P(u)+z[1]+"\n"+z[0]+z[2]+P(i)+z[1]+"\n\n",0,1),x&&$.tools.p.click(e,t)):U(e,t).tidy(m(O[0]+"[^"+O[0]+O[1]+O[2]+"]+?"+O[1]+"\\s*$").test(t.$().before)?"":" ","").insert(z[0]+r+L[3]+"alt"+L[0]+L[1]+o+L[2]+L[3]+"src"+L[0]+L[1]+c+L[2]+(s?L[3]+"title"+L[0]+L[1]+s+L[2]:"")+C+" ",0,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=E.sub,r=E.sup,i=P(r);return U(e,t)[0]().unwrap(m(O[0]+d(i)+j+O[1]),z[0]+z[2]+i+z[1]).i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=E.sub,r=E.sup,i=P(n);return U(e,t)[0]().unwrap(m(O[0]+d(i)+j+O[1]),z[0]+z[2]+i+z[1]).i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var h,g,n=t.$(),r=b(n.value),i=T.modals.abbr,u=t.get(),o=b(r||R[""]),f=E.abbr,a=P(f),c=O[0]+d(f)+H+O[1],s=O[0]+d(f)+j+O[1],l=O[0]+O[2]+d(a)+O[1],p=m(c+M+l);return u.replace(p,function(e,t,n){(n=b(n))&&(_.abbr[n]=(t.match(m(A[3]+"+title"+A[0]+A[1]+"\\s*(.*?)\\s*"+A[2]))||["",""])[1])}),h=_.abbr,r&&h[r]?(t.i().format(f+L[3]+"title"+L[0]+L[1]+h[r]+L[2]),!1):($.prompt(["abbr[title]",i.title],h[o]||i.placeholder,!h[r],function(e,t,n,i){n=Y(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(g in h)if(Y(h[g])===n){t.insert(g);break}U(e,t).unwrap(m(s),m(l)).unwrap(m(s),m(l),1).i().format(f+L[3]+"title"+L[0]+L[1]+n+L[2])[1]()}).record(),!1)}},p:{i:"paragraph",click:function(e,t){var p,n=t.$(),r=n.value,i=E.p,u=E.br,o=P(i),f=P(u),a=n.before,c=n.after,s=I(a),l=R[""];if(t[0](),r&&-1!==r.indexOf("\n")){var h=m("^(?:\\s*"+O[0]+d(o)+j+O[1]+"\\s*)+"+M+"(?:\\s*"+O[0]+O[2]+d(o)+O[1]+"\\s*)+$");h.test(r)?t.replace(h,"$1").replace(m("\\s*"+O[0]+O[2]+d(o)+O[1]+"\\s*"+O[0]+d(o)+j+O[1]+"\\s*","g"),"\n\n").replace(m("\\s*"+O[0]+d(f)+j+O[1]+"\\s*","g"),"\n"):t.replace(/\n/g,"\n"+z[0]+u+C+"\n").replace(m("(\\s*"+O[0]+d(f)+j+C+"\\s*){2,}","g"),z[0]+z[2]+o+z[1]+"\n"+z[0]+i+z[1]).wrap(z[0]+i+z[1],z[0]+z[2]+o+z[1],1).replace(m("("+O[0]+d(o)+j+O[1]+")+","g"),"$1").replace(m("("+O[0]+O[2]+d(o)+O[1]+")+","g"),"$1").tidy("\n")}else m("^\\s*"+O[0]+O[2]+d(o)+O[1]).test(c)?m(O[0]+d(o)+j+O[1]+"\\s*$").test(a)?t.unwrap(m("\\s*"+O[0]+d(o)+j+O[1]+"\\s*"),m("\\s*"+O[0]+O[2]+d(o)+O[1])).replace(l,"").tidy("\n","\n"+s):(p=a.match(m(O[0]+d(o)+H+O[1]+".*?$")))&&t.wrap(z[0]+z[2]+o+z[1]+"\n"+s+z[0]+o+p[1]+z[1],"").insert(l).scroll(1):t.tidy("\n\n").format(i,0,"\n\n").scroll(1);return t[1](),!1}},br:{i:"level-down",click:function(e,t){return B=I(t.$().before),t.tidy("\n","").insert(B+z[0]+E.br+C+"\n",0).scroll(1),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var u,o,n=t.$(),r=[E.p,E.h1,E.h2,E.h3,E.h4,E.h5,E.h6],i=[];for(u in r)i[u]=P(r[u]);var a=(d(r).join("|"),d(i).join("|")),c="\\s*"+O[0]+"("+a+")"+H+O[1]+"\\s*",s=m("\\s*"+O[0]+"(?:"+a+")"+j+O[1]+"\\s*"),l=m("\\s*"+O[0]+O[2]+"(?:"+a+")"+O[1]+"\\s*"),p=n.value.match(m("^"+c));return p||(p=n.before.match(m(c+"$"))||[]),o=p[2]||"",u=+(p[1]||"h0").slice(1),t[0]().unwrap(s,l).unwrap(s,l,1).i().tidy("\n\n").format(u>5?i[0]+o:i[u+1]+o,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var l,n=t.$(),r=n.value,i=E.blockquote,u=E.q,o=E.p,f=P(o),a=d(f),c=m(O[0]+O[2]+a+O[1]),s=R[""];return/(^|\n)$/.test(n.before)?(x&&!c.test(r)&&$.tools.p.click(e,t),n=t.$(),r=n.value,!c.test(r)&&x&&t.select(n.start-(z[0]+o+z[1]).length,n.end+(z[0]+z[2]+f+z[1]).length),r!==s&&x?(t[0]().tidy("\n\n").insert(z[0]+i+z[1]+"\n"+t.$().value.replace(m("^(\\s*"+O[0]+")","gm"),S+"$1")+"\n"+z[0]+z[2]+P(i)+z[1]+"\n\n",0,1),x&&$.tools.p.click(e,t)):(t[0]().format(i,0,"\n\n","\n").loss().replace(m("^(\\s*"+O[0]+")","gm"),S+"$1"),x&&(n=t.$(),l=n.start+(z[0]+o+z[1]+S).length,t.select(l,l+s.length))),t[1]()):t.i().format(u),!1}},"pre,code":{i:"code",click:function(e,t){function g(e){return i?v(e,["&","<",">"],["&amp;","&lt;","&gt;"]):e}function b(e){return i?v(e,["&amp;","&lt;","&gt;"],["&","<",">"]):e}var n=t.$(),r=n.value,i=w.auto_encode_html,u=E.pre,o=E.code,f=P(u),a=P(o),c=O[0]+d(f)+j+O[1]+"\\s*"+O[0]+d(a)+j+O[1]+"\\s*",s="\\s*"+O[0]+O[2]+d(a)+O[1]+"\\s*"+O[0]+O[2]+d(f)+O[1],l=m(c+"\\s*$"),p=m("^\\s*"+s),h=m("^"+M+"$");return m("(^|\\n|"+c+")$").test(n.before)?l.test(n.before)&&p.test(n.after)?t[0]().unwrap(m(l),m(p)).replace(h,b)[1]():t[0]().tidy("\n\n").wrap(z[0]+u+z[1]+z[0]+o+z[1],z[0]+z[2]+a+z[1]+z[0]+z[2]+f+z[1]).insert(r||R[""]).replace(h,g)[1]():t[0]().format(o).replace(h,function(e){return N(m("^\\s*"+O[0]+O[2]+d(a)+O[1]).test(t.$().after)?g(e):b(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=E.ol,r=E.ul,i=P(n),u=P(r),o="("+d(u)+"|"+d(i)+")";return t.match(m(O[0]+o+j+O[1]+M+O[0]+O[2]+o+O[1]))?t[0]().replace(m(O[0]+d(i)+H+O[1],"g"),z[0]+u+"$1"+z[1]).replace(m(O[0]+O[2]+d(i)+O[1],"g"),z[0]+z[2]+u+z[1])[1]():q(e,r,E.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=E.ol,r=E.ul,i=P(n),u=P(r),o="("+d(u)+"|"+d(i)+")";return t.match(m(O[0]+o+j+O[1]+M+O[0]+O[2]+o+O[1]))?t[0]().replace(m(O[0]+d(u)+H+O[1],"g"),z[0]+i+"$1"+z[1]).replace(m(O[0]+O[2]+d(u)+O[1],"g"),z[0]+z[2]+i+z[1])[1]():q(e,n,E.li),!1}},table:function(e,t){var R,K,B,I,n=_.tr,r=_.td,i=T.modals.table,u=T.placeholders.table,o=b(y(u[0],[1,1])),f=w.advance_table?S:"",a=E.table,c=E.caption,s=E.thead,l=E.tbody,d=E.tfoot,h=E.tr,m=E.th,v=E.td,x=P(a),k=P(c),C=P(s),L=P(l),O=P(d),A=P(h),j=P(m),H=P(v),M=[];return t[0]().$().value===o?(t.select(),!1):($.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,w,E){K=p(g(w)||E,r[0],r[1]),$.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,w){B=p(g(r)||w,n[0],n[1]),$.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,p,g,$,E,r="";for(I=N(n),i=0;B>i;++i){for(R=f+S+z[0]+h+z[1]+"\n",p=0;K>p;++p)R+=f+S+S+z[0]+v+z[1]+b(y(u[1],[i+1,p+1]))+z[0]+z[2]+H+z[1]+"\n";R+=f+S+z[0]+z[2]+A+z[1],M.push(R)}for(M=M.join("\n"),R=S+(f?z[0]+s+z[1]+"\n"+S+S+z[0]+h+z[1]:z[0]+A+z[1])+"\n",g=0;K>g;++g)R+=f+S+S+z[0]+m+z[1]+b(y(u[0],[1,g+1]))+z[0]+z[2]+j+z[1]+"\n";if(f){for(r+=S+z[0]+d+z[1]+"\n",r+=S+S+z[0]+h+z[1]+"\n",g=0;K>g;++g)r+=S+S+S+z[0]+v+z[1]+b(y(u[2],[1,g+1]))+z[0]+z[2]+H+z[1]+"\n";r+=S+S+z[0]+z[2]+h+z[1]+"\n",r+=S+z[0]+z[2]+O+z[1]+"\n"}R+=f+S+z[0]+z[2]+A+z[1]+(f?"\n"+S+z[0]+z[2]+C+z[1]+"\n"+r+S+z[0]+l+z[1]:"")+"\n",M=R+M+(f?"\n"+S+z[0]+z[2]+L+z[1]:"")+"\n",t.tidy("\n\n").insert(z[0]+a+z[1]+"\n"+(I&&c?S+z[0]+c+z[1]+I+z[0]+z[2]+k+z[1]+"\n":"")+M+z[0]+z[2]+x+z[1]),$=t.$(),E=$.start+$.value.indexOf(o),t.select(E,E+o.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){return B=I(t.$().before),t.tidy("\n\n","").insert(B+z[0]+E.hr+C+"\n\n",0),!1}}}),w.keys&&h($.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":"br",enter:function(e,t){var p,h,g,n=t.$(),r=n.value,i=t.get(),u=E.p,o=E.li,f=P(u),a=P(o),s=(I(n.before),R[""]),l=$.tools;if(!r||r===s){if(p=n.after.match(m("^\\s*"+O[0]+O[2]+"("+d(f)+"|"+d(a)+")"+O[1])))h=p[1],(l[h===a?K:h]||l.ul).click(e,t);else{if(!(x&&u&&b(i)&&n.end===i.length&&m("^\\s*[^"+O[0]+"\\n]*?[^"+O[1]+"]\\s*$").test(i)))return;i=z[0]+u+z[1]+i+z[0]+z[2]+f+z[1]+"\n"+z[0]+u+z[1],g=s+z[0]+z[2]+f+z[1],t.set(i+g).select(i.length,(i+s).length)}return!1}},tab:function(e,t){var n=t.$(),r=E.li,i=P(r),u=I(n.before);return m(O[0]+O[2]+d(i)+O[1]).test(n.after)?(t[0]().wrap("\n"+u+S+z[0]+(E[K]||K)+z[1]+"\n"+u+S+S+z[0]+r+z[1],z[0]+z[2]+i+z[1]+"\n"+u+S+z[0]+z[2]+K+z[1]+"\n"+u).insert(R[""])[1](),!1):$.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,u=n.before,o=n.after,f=O[0]+"[^"+O[0]+O[1]+"]+?"+O[1];return!r&&m(f+"$").test(u)?(i=u.split(z[0]).pop().match(m("^([^"+O[2]+"\\s]+).*?"+O[1]+"\\s*$")),i=i&&i[1]||0,i&&m("^\\s*"+O[0]+O[2]+d(i)+O[1]).test(o)?t.unwrap(m(O[0]+d(i)+j+O[1]),m("\\s*"+O[0]+O[2]+d(i)+O[1])):t.outdent(m(f)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),s.update(t,0)};