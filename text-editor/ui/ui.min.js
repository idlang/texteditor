/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.6.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Le(e){return L(e)?m(e).split(/\s+/):e}function ze(e){return _(e)?e.join(" "):e}function Oe(e,t){return-1!==e.indexOf(t)}function Fe(e){return e.length}function Ne(e){return Object.keys(e)}function De(e){return Fe(Ne(e))}function Se(e,t,n){return C(e)?C(t)?(C(v[e])||(v[e]={}),C(n)||(n=De(v[e])),v[e][n]=t,s):v[e]:v}function Ie(e,t){return C(e)?C(t)&&C(v[e])?(delete v[e][t],s):(v[e]={},s):(v={},s)}function je(e,t,n){if(!C(v[e]))return v[e]={},s;if(C(n))C(v[e][n])&&v[e][n].apply(s,t);else for(A in v[e])v[e][A].apply(s,t);return s}function He(e,t,n){if(_(t))for(A in t)He(e,A,t[A]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Pe(e,n,i){if(L(n))return Pe(e,[n],C(i)?i:"")[0];t=[];for(A in n)A=n[A],(A=e.getAttribute(A))&&t.push(A);return Fe(t)?t:C(i)?i:[]}function Be(e,t){if(_(t))for(A in t)Be(e,t[A]);else if(C(t))e.removeAttribute(t);else for(Be(e,"class"),A=0,W=e.attributes,q=Fe(W);q>A;++A)W[A]&&Be(e,W[A].name)}function Re(e,t,n){if(_(t))for(A in t)Re(e,A,t[A]);else He(e,"data-"+t,n)}function Ye(e,n,i){if(L(n))return Ye(e,[n],C(i)?i:"")[0];t=[];for(A in n)A=n[A],(A=Pe(e,"data-"+A))&&t.push(A);return Fe(t)?t:C(i)?i:[]}function Ae(e,t){if(_(t))for(A in t)Be(e,"data-"+t[A]);else if(C(t))Be(e,"data-"+t);else for(A=0,W=e.attributes,q=Fe(W);q>A;++A)W[A]&&"data-"===W[A].name.slice(0,5)&&Be(e,W[A].name)}function We(e){return e&&e.preventDefault(),!1}function qe(e,t,n){if(t){for(e=Le(e),A=0,W=Fe(e);W>A;++A)t.addEventListener(e[A],n,!1),Se("on:"+e[A],n,ft(t));return s}}function Xe(e,t,n){if(t){for(e=Le(e),A=0,W=Fe(e);W>A;++A)t.removeEventListener(e[A],n,!1),Ie("on:"+e[A],ft(t));return w(t)&&t.id.split(":")[0]===Ct+"-dom"&&Be(t,"id"),s}}function Ue(e,t,n){e=Le(e);var r,i="createEvent"in a;for(A=0,W=Fe(e);W>A;++A)i?(r=a.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[A],!0,!1),t.dispatchEvent(r)):je("on:"+e[A],n,ft(t));return s}function Ke(e,t,n){for(A=0,W=Fe(t),q;W>A;++A)q=t[A],e=e.replace(M(q)?q:h(p(q),"g"),n&&n[A]||"");return e}function Ze(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,C(t[n])?t[n]:e})}function Ge(e){return m(Ke(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Je(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Qe(e);return{x:n-r.l,y:i-r.t}}function Qe(e){for(X=e.offsetLeft,V=e.offsetTop;e=e.offsetParent;)X+=e.offsetLeft,V+=e.offsetTop;return{l:X,t:V}}function Ve(e){return e===l?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function et(e,t){for(;(e=ut(e))&&e!==t;);return e}function tt(e,t){t=Le(t);for(A in t)e.classList.add(t[A])}function nt(e,n,i){if(L(n))return nt(e,[n],C(i)?i:"")[0];t=[];for(A in n)A=n[A],e.classList.contains(A)&&t.push(A);return Fe(t)?t:C(i)?i:!1}function it(e,t){if(C(t)){t=Le(t);for(A in t)e.classList.remove(t[A])}else Be(e,"class")}function rt(e,t){t=Le(t);for(A in t)e.classList.toggle(t[A])}function ot(e,t,n){if(e=L(e)?a.createElement(e):e,_(n))for(A in n)if(te=n[A],"classes"===A)tt(e,te);else if("data"===A)for(W in te)te=te[W],null===te?Ae(e,W):Re(e,W,te);else"css"===A?L(te)?He(e,"style",te):null===te?Be(e,"style"):c(e,te):T(te)?e[A]=te:null===te?Be(e,A):He(e,A,E(te)?te.join(" "):""+te);if(w(t))wt(e,t);else if(_(t))for(A in t)te=t[A],w(te)?wt(e,te):te!==!1&&lt(e,te);else C(t)&&t!==!1&&lt(e,t);return e}function ft(e){var t=e.id;return t||(t=Ct+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function lt(e,t){e.innerHTML=t}function at(e,t){return e.innerHTML||(C(t)?t:"")}function st(e,t){if(t!==!1&&(j=ct(e)))for(A=0,W=Fe(j);W>A;++A)st(j[A]);lt(e,"")}function ut(e){return e&&e.parentNode}function ct(e){return e&&e.children||[]}function dt(e){return e&&e.nextSibling}function pt(e){return e&&e.previousSibling}function bt(e){for(A=0;e=pt(e);)++A;return A}function ht(e,t){return e&&L(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&T(t)?e===t(e):e===t}function gt(e,n){if(!(n=C(n)?n:a))return[];if(t=[],L(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(A=0,W=Fe(e);W>A;++A)t.push(e[A]);return t}return[]}for(e=n.querySelectorAll(e),A=0,W=Fe(e);W>A;++A)t.push(e[A]);return t}return yt(e)?[e]:[]}function yt(e,t){var n=ut(e);return 1===Fe(arguments)?n||!1:e&&n===e?n:!1}function mt(e,t){Z=ut(e),Z&&Z.insertBefore(t,e)}function vt(e,t){Z=ut(e),Z&&Z.insertBefore(t,dt(e))}function kt(e,t){j=ct(e)[0],j?mt(j,t):wt(e,t)}function xt(e,t){wt(e,t)}function wt(e,t){e.appendChild(t)}function Et(e,t){var n=yt(e);if(n){if(t!==!1)for(j=ct(e)[0];j;)Et(j);n.removeChild(e)}}function Tt(e){st(ot(e,!1,{style:""})),Et(e)}function $t(e,t,n){return ot(t||"div",n,{"class":e})}function Jt(e){return!e||C(e.active)&&!e.active}function Qt(){return Ht.disabled||Ht.readOnly}function Vt(e,t,n){return T(e)&&(e={click:e}),L(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Lt[t]||"",C(e.attributes)||(e.attributes={}),n[t]=e,e}function en(e){if(Qt())return Ht.focus(),We(e);_t.exit(0,0,0);var t=Ye(this,"tool-id"),n=_t.tools,i=n[t];return _t.drop.target=e.currentTarget||e.target,!Jt(i)&&T(W=i.click)&&(W=W(e,s,t),je("on:change",[e,s,t]),W===!1)?We(e):(s.select(),We(e))}function tn(e){if(V=this,(q=e.TE.key)(/^(escape|f10)$/))_t.exit(1);else if(q("enter")||q("arrowdown")&&Ye(V,"ui-drop"))_t.drop.target=V,Ue(le,V,[e]);else if(q("arrowright")&&(X=dt(V))){for(;!ht(X,"a")&&X;)X=dt(X);X&&X.focus()}else if(q("arrowleft")&&(X=pt(V))){for(;!ht(X,"a")&&X;)X=pt(X);X&&X.focus()}return We(e)}function nn(){st(jt,!1);var r,o,f,l,a,u,c,e=_t.tools,t=Le(N.tools),n=Ct+"-button",i=Ct+"-separator";N.tools=t;for(u in t)c=t[u],o=e[c],(o||o==={})&&(o=Vt(o,c,e),f=o.i||c,"|"===f||Oe(f,"<")||(f=Ge(f)),l="|"!==f,a=Ge(c).replace(/[\/\s]/g,"-"),Zt=$t(l?n+" "+n+"-"+a:i+" "+i+"-"+u,l?"a":"span"),l?(Zt=o.target||Zt,r=n+":"+a,He(Zt,{href:Me,id:r,tabindex:-1}),Re(Zt,"tool-id",c),f=Oe(f,"<")?f:_t.i(a,f),Jt(o)?tt(Zt,"x"):it(Zt,"x"),o.on?tt(Zt,"on"):it(Zt,"on"),o.text&&(f=Ze('<span class="'+Ct+'-text">'+o.text+"</span>",[f]),tt(Zt,"text")),lt(Zt,f),ot(Zt,!1,o.attributes),!o.attributes.title&&(W=o.title)&&(Zt.title=_(W)?W[0]+(W[1]?" ("+W[1]+")":""):W),qe(le,Zt,en),qe(de,Zt,tn)):Zt.id=i+":"+u,o.target=Zt,wt(jt,Zt));je("update.tools",[s])}function rn(){_t.keys=function(){var n,e=Ne(_t.keys).sort().reverse(),t={};for(A=0,W=Fe(e);W>A;++A)n=e[A],t[n]=_t.keys[n];return t}(),fn(),je("update.keys",[s])}function on(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}if(Qt())return Ht.focus(),We(e);var n=s.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],l=n.length,a=_t.keys,u=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();K=e.TE.key(),D[K]=1,t=De(D),y(function(){s.record()});for(A in a){q=d(A),j=0;for(W in q)W=q[W],D[u[W]||W]&&++j;if(q=Fe(q),j===q&&t===q&&(L(a[A])&&(a[A]=_t.tools[a[A]].click),X=a[A]&&a[A](e,s),X===!1))return We(e)}if(ve)for(A in ve)if(U=ve[A],U!==!1){if(K===U&&f===U)return"\\"===o?(s.insert(K,0),We(e)):(s.select(n.end+1),We(e));if(A===K)return s.wrap(A,U),We(e);if(o===A&&f===U){if("backspace"===K&&i.slice(-2)!=="\\"+A)return s.unwrap(A,U),We(e);if(ke&&"enter"===K&&A!==U&&!l)return s.tidy("\n"+c+we,"\n"+c).scroll(1),We(e)}}if(ke&&!l){if("backspace"===K&&h(p(we)+"$").test(i))return s.outdent(we),We(e);if("enter"===K&&h("(^|\\n)("+p(we)+")+.*$").test(i))return s.insert("\n"+c,0,1).scroll(1),We(e)}}function fn(e){e&&e.TE&&e.TE.key?delete D[e.TE.key()]:D={}}function cn(e){return ln=Pt,Q=Ve(It),We(e)}function dn(e){ln===Pt&&c(Ht,{height:Je(St,e).y-Q.h+Ce})}function pn(){ln=0}function bn(){_t.exit(1)}function hn(){t=Ve(At),ne=t.w,Y=t.h,t=Ve(Yt),an=t.w,sn=t.h}function gn(e,t){t&&je("exit.modal."+t,[s]),Ue(le,Yt,[e])}function yn(e){ln=e.target,t=Je(At,e),ie=t.x,re=t.y,hn()}function mn(e){var n=un.header,i=un.resize;ln===n||et(ln,n)===n?(t=Je(St,e),X=t.x-ie,V=t.y-re,c(At,{left:(ne>an?X:d(X,0,an-ne))+Ce,top:(Y>sn?V:d(V,0,sn-Y))+Ce})):ln===i&&(t=Je(At,e),Q=Ve(i),c(At,{width:t.x+Q.w/4+Ce,height:t.y+Q.h/4+Ce}))}function vn(){ln=0}function kn(e,t,n){return{header:e,body:t,footer:n}}function xn(e){S=_t.drop.target,I=Wt,j=e&&e.target||0,(!j||j!==S&&et(j,S)!==S)&&(_t.drop.target=0,Xe(le,a,xn),Xe(me,l,xn),_t.exit(e.target===Ht))}var S,I,j,B,Y,A,W,q,X,U,K,t,Z,J,Q,V,te,ne,ie,re,n="⌘",i="…",o="⇥",f="⇧",l=window,a=document,s=new TE(e),u=s._,c=u.css,d=u.edge,p=u.x,b=u.extend,h=u.pattern,y=(u.timer.reset,u.timer.set),m=u.trim,v={},k=function(){},x=TE.is,w=x.e,E=x.a,T=x.f,$=x.i,_=x.o,M=x.r,C=function(e){return!x.x(e)},L=x.s,z=a.documentElement,F=(a.head,a.body),N=b({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},t),D={},fe="blur",le="click",de="keydown",pe="keyup",be="touchstart mousedown",he="touchmove mousemove",ge="touchend mouseup",me="orientationchange resize",ve=N.auto_close,ke=N.auto_tab,xe=N.languages,we=N.tab,Te=(N.unit[0][1],N.unit[0][0]),$e=N.unit[1][1],_e=N.unit[1][0],Me="javascript:;",Ce="px",_t=s.ui={};s.tidy=function(e,t){var n=s.$(),i=m(n.before)?e:"",r=m(n.after)?C(t)?t:e:"";return s.trim(i,r)},s.i=function(){return m(s.replace(/\s+/g," "))},s.format=function(e,t,n,i){_(e)||(e=[e]),C(n)||(n=" "),C(i)||(i="");var r=s.h,o=s[0]().$(),f=(e[0]?Te[0]+e[0]+Te[1]:"")+i,l=i+(e[0]?Te[0]+Te[2]+(e[1]||e[0].split(h("("+$e[3]+")+"))[0])+Te[1]:""),a=p(f),u=p(l),c=h("^"+a+"([\\s\\S]*?)"+u+"$"),d=h(a+"$"),b=h("^"+u),g=o.before,y=o.after;return o.length?n=!1:s.insert(xe.placeholders[""]),s.toggle(t?!c.test(o.value):!d.test(g)&&!b.test(y),[function(e){e.unwrap(f,l,1).tidy(h(_e[0]+"[^"+_e[0]+_e[1]+_e[2]+"]+?"+_e[1]+"$").test(g)?"":n,h("^"+_e[0]+_e[2]+"[^"+_e[0]+_e[1]+"]+?"+_e[1]).test(y)?"":n).wrap(f,l,t)},function(e){e.unwrap(f,l,t)}])[r]()};var Zt,Mt=N.classes,Ct=Mt[""],Lt=xe.tools,zt=xe.buttons,Ot=xe.labels,Ft=Ct+"-textarea "+Ct+"-content block",Nt=$t(Ct),Dt=$t(Ct+"-header"),St=$t(Ct+"-body"),It=$t(Ct+"-footer"),jt=$t(Ct+"-tool"),Ht=ot(e,!1,N.attributes),Pt=$t(Ct+"-resize s"),Bt=$t(Ct+"-description"),Rt=$t(Ct+"-panel"),Yt=$t(Ct+"-overlay"),At=ot("div"),Wt=ot("div"),qt=ot("div"),Xt=$t("left","span"),Ut=$t("right","span"),Kt=0;_t.i=function(e,t,n){return e=Ge(e).replace(/[\/\s]/g,"-"),Q=Ze(Mt.i,[e,t||e]),n?(it(n),tt(n,Q),n):'<i class="'+Q+'"></i>'},C(N.suffix)||(N.suffix=Te[1]);var ln=0,ie=0,re=0,ne=0,Y=0,an=0,sn=0,un={};s.create=function(e,t){_(e)&&(N=b(N,e));var n=yt(Ht);return tt(Nt,Ct+"-is-can-update"),tt(Nt,Ct+"-is-can-copy"),tt(Ht,Ft),n&&ht(n,"p")?(mt(n,Nt),Kt=n,Et(n,!1)):mt(Ht,Nt),Nt.dir=N.dir,wt(Nt,Dt),wt(Nt,St),wt(Nt,It),wt(St,Ht),N.tools&&(wt(Dt,jt),wt(It,Bt),wt(Bt,Xt),wt(Bt,Ut)),qe(de,Ht,on),qe(pe+" "+fe,Ht,fn),N.resize&&(wt(Nt,Pt),tt(Nt,Ct+"-is-can-resize"),qe(be,Pt,cn),qe(he,a,dn),qe(ge,F,pn)),nn(),rn(),0!==t?je("create",[s]):s},s.update=function(e,t){return nt(Ht,Le(Ft),0)&&s.destroy(0),(0!==t?je("update",[s]):s).create(e,0)},s.destroy=function(e){return nt(Ht,Le(Ft),0)?(_t.exit(0,0,0),it(Ht,Ft),N.tools=ze(N.tools),N.keys&&(Xe(de,Ht,on),Xe(pe,Ht,fn)),N.resize&&(Xe(be,Pt,cn),Xe(he,a,dn),Xe(ge,a,pn)),Kt?(mt(Nt,Kt),wt(Kt,Ht),Kt=0):mt(Nt,Ht),Tt(Nt),0!==e?je("destroy",[s]):s):s},s.enable=function(e){return Ht.disabled=Ht.readOnly=!1,tt(Nt,Ct+"-is-can-update"),tt(Nt,Ct+"-is-can-copy"),0!==e?je("enable",[s]):s},s.disable=function(e){return Ht.disabled=!0,it(Nt,Ct+"-is-can-update"),it(Nt,Ct+"-is-can-copy"),0!==e?je("disable",[s]):s},s.freeze=function(e){return Ht.disabled=!1,Ht.readOnly=!0,it(Nt,Ct+"-is-can-update"),tt(Nt,Ct+"-is-can-copy"),0!==e?je("freeze",[s]):s},_t.exit=function(e,t,n){if(B={panel:function(){Tt(Rt)},overlay:function(){Xe(le,Yt,bn),Tt(Yt)},modal:function(){Xe(be,St,yn),Xe(he,St,mn),Xe(ge,a,vn),Xe(le,un.x,gn),Tt(At)},drop:function(){Tt(Wt)},bubble:function(){Tt(qt)}},fn(),t)if(_(t))for(A in t)A=t[A],B[A]&&B[A](),0!==n&&je("exit."+A,[s]);else B[t]&&B[t](),0!==n&&je("exit."+A,[s]);else for(A in B)B[A]();return e&&s.select(),0!==n&&je("exit",[s]),s},_t.panel=function(e,t){function n(){Xe(le,ie,n),_t.panel.exit(1)}return _t.exit(0,0,0),ie=$t(Ct+"-x"),ie.title=zt.close,qe(le,ie,n),st(Rt,!1),wt(St,ot(Rt,[$t(Ct+"-panel-content","div",e),ie])),T(t)?t(Rt):ot(Rt,t),je("enter.panel",[s]),je("enter",[s]),s},_t.panel.fit=function(){},_t.overlay=function(e,t){return _t.exit(0,0,0),wt(St,Yt),e&&qe(le,Yt,bn),T(t)?t(Yt):ot(Yt,t),je("enter.overlay",[s]),je("enter",[s]),s},_t.overlay.fit=function(){},_t.modal=function(){_t.overlay(1).blur();var f,l,e=arguments,t=e[0],n=e[1],i=e[2],r=Ct+"-modal",o=n.footer;if(_(t)&&(t="default",n=e[0],i=e[1]),X=Ge(t),ot(At,!1,{"class":r+" "+X}),C(n.body)&&(n.body=ot("div",n.body,{"class":r+"-content "+X})),C(o)&&_(o)&&!w(o)){l=[];for(A in o)W=o[A],w(W)?l.push(W):(W=Vt(W,A,o),t=A.text||zt[A]||A,f=ot("button",t,b({name:"y["+A+"]",type:"button","class":Ct+"-button",data:{"button-id":A}},W.attributes)),qe(le,f,function(e){return t=o[Ye(this,"button-id")].click(e,s),t===!1?We(e):void 0}),l.push(f));n.footer=l}for(A in n)r[1]=A,un[A]=$t(r+"-"+Ze(A,r)+" "+X,0,n[A]);return un.x=$t(Ct+"-x "+X),un.resize=$t(Ct+"-resize se "+X),st(At,!1),un.x.title=zt.close,wt(St,ot(At,un,{style:""})),_t.modal.fit(),vt(At,Yt),qe(le,un.x,gn),qe(be,un.header,We),qe(be,un.resize,We),qe(be,St,yn),qe(he,St,mn),qe(ge,a,vn),T(i)&&(un.overlay=Yt,un.modal=At,i(un)),je("enter.modal."+t,[s]),je("enter.modal",[s]),je("enter",[s]),s},_t.modal.fit=function(e){return hn(),X=an/2-ne/2,V=sn/2-Y/2,_(e)?(C(e[0])&&(X=e[0]),C(e[1])&&(V=e[1])):(X=d(X,0),V=d(V,0)),c(At,{left:X+Ce,top:V+Ce,"min-width":ne+Ce,"min-height":Y+Ce,visibility:"visible"}),je("fit.modal",[s]),je("fit",[s]),s};var wn={"class":Ct+"-button",name:"y"};return _t.alert=function(e,t,n,i){var r=ot("button",zt.okay,wn),o="alert";return n=n||k,_(e)&&(o+=":"+e[0],e=e[1]||e[0]),qe(le,r,function(e){return n(e,s),gn(e,o+".y"),We(e)}),qe(de,r,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Ue(le,r,[e]),We(e)}),_t.modal(o,kn(e,t,r),i),r.focus(),s},_t.confirm=function(e,t,n,i,r){function u(e){return T(n)&&n(e,s),gn(e,l+".y"),We(e)}function c(e){return T(i)&&i(e,s),gn(e,l+".n"),We(e)}var a,o=ot("button",zt.okay,wn),f=ot("button",zt.cancel,wn),l="confirm";return f.name="n",_(e)&&(l+=":"+e[0],e=e[1]||e[0]),qe(le,o,u),qe(le,f,c),qe(de,o,function(e){return a=e.TE.key,a("arrowright")?f.focus():a("enter")?u(e):a("escape")&&gn(e,l+".y"),We(e)}),qe(de,f,function(e){return a=e.TE.key,a("arrowleft")?o.focus():a("enter")?c(e):a("escape")&&gn(e,l+".n"),We(e)}),_t.modal(l,kn(e,t,[o,f]),r),f.focus(),s},_t.prompt=function(e,t,n,i,r,o){function h(){a.focus(),"placeholder"in a&&a.select()}function g(e){d=a.value,T(n)&&!n(d)?h():!n||m(d)&&d!==t?(gn(e,u+".y"),i(e,s,d!==t?d:"",t)):h()}function y(e){gn(e,u+".n")}var d,p,b,f=ot("button",zt.okay,wn),l=ot("button",zt.cancel,wn),a=ot("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Ct+"-input block"}),u="prompt",c=[];if(_(e)&&(u+=":"+e[0],e=e[1]||e[0]),T(r)&&(o=r,r=0),r=r||0,1===r)a=ot("textarea",t,{placeholder:t.split("\n")[0],"class":Ct+"-textarea block",spellcheck:"false"});else if(2===r){for(A in t)c.push(ot("option",t[A],{value:A,selected:A===n||null}));a=ot("select",c,{"class":Ct+"-select block"})}return i=i||k,a.name="data",l.name="n",qe(de,a,function(e){return p=e.TE.key,b=e.TE.control,p("enter")&&0===r||b("enter")?(g(e),We(e)):p("escape")||p("backspace")&&!this.value?(y(e),We(e)):p("arrowdown")&&0===r||p("enter")&&2===r||b("arrowdown")?(f.focus(),We(e)):void 0}),qe(de,f,function(e){return p=e.TE.key,p("enter")?g(e):p("escape")?y(e):p("arrowup")?a.focus():p("arrowright")&&l.focus(),We(e)}),qe(de,l,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?y(e):p("arrowup")?a.focus():p("arrowleft")&&f.focus(),We(e)}),qe(le,f,g),qe(le,l,y),_t.modal(u,kn(e,a,[f,l]),o),h(),s},_t.drop=function(){_t.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===Fe(e)&&(t="default",n=e[0],i=e[1]),X=Ge(t),st(Wt,!1),wt(F,ot(Wt,!1,{"class":Ct+"-drop "+X})),T(n)?n(Wt):ot(Wt,n),_t.drop.fit(),i===!1||qe(le,a,xn),qe(me,l,xn),je("enter.drop."+t,[s]),je("enter.drop",[s]),s},_t.drop.fit=function(e){return S=Ve(z),I=Ve(Wt),j=_t.drop.target,X=S.w/2-I.w/2,V=S.h/2-I.h/2,!C(e)&&j&&(t=Qe(j),X=t.l,V=t.t+Ve(j).h),_(e)?(C(e[0])&&(X=e[0]),C(e[1])&&(V=e[1])):(X=d(X,0,S.w-I.w),V=d(V,0,Math.max(S.h,Ve(l).h)-I.h)),c(Wt,{left:X+Ce,top:V+Ce,visibility:"visible"}),je("fit.drop",[s]),je("fit",[s]),s},_t.menu=function(e,n,i,r){var l,o=_t.tools,f=0;if(n===!1)return _t.tool(e,n);for(r in i)ne="%"===r[0],l=i[r],l=L(l)&&!ne?o[l]:l,l&&(l=Vt(l,r,o),i[r]=l);return _t.tool(e,{i:_(n)?n[0]:0,text:!_(n),click:function(n){var a=_t.drop.target=o[e].target;return _t.drop("menu menu-"+Ge(e),function(n){function u(n){return V=this,t=Ye(V,"tool-id"),U=i[t],U=L(U)?o[U]:U||{},K=at(V),!Jt(U)&&T(r=U.click)&&(r=r(n,s),_t.menu.set(e,t),r===!1)?(s.select(),We(n)):(s.select(),We(n))}function c(e){if(V=this,(q=e.TE.key)("escape"))_t.exit(1);else if(q("enter"))Ue(le,V,[e]);else if(q("f10")&&a)a.focus();else if(q("arrowdown")&&(X=dt(V))){for(;!ht(X,"a")&&X;)X=dt(X);X&&X.focus()}else if(q("arrowup")&&(X=pt(V))){for(;!ht(X,"a")&&X;)X=pt(X);!X&&a?(_t.exit(),a.focus()):X&&X.focus()}else q("arrowup")&&a&&(_t.exit(),a.focus());return We(e)}for(r in i)if(l=i[r],ne="%"===r[0],l){var d={href:ne?null:Me,"class":Ct+"-"+(ne?"label":"button")};ne?W=Ot[e]&&Ot[e][+r.slice(1)-1]||r:(d.data={},d.data["tool-id"]=r,W=Lt[r]||r),J=l.text,J=_(J)?J[1]||"":J,W=_(W)?W[0]:W,Q=ot(ne?"span":"a","<span>"+(ne?W||"%"+f:J||W)+"</span>",b(d,l.attributes||{})),tt(Q,"menu-"+Ge(r).replace(/[\/\s]/g,"-")),!d.title&&(V=l.title)&&(Q.title=_(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),ne?He(Q,{id:Ct+"-label:"+f}):(Jt(l)?tt(Q,"x"):it(Q,"x"),l.on?tt(Q,"on"):it(Q,"on"),qe(le,Q,u),qe(de,Q,c)),wt(n,Q),++f}y(function(){(gt('[data-tool-id="'+Ye(a,"ui-drop-data")+'"]',n)[0]||gt("a",n)[0]).focus()},1)}),!1}},r),Re(o[e].target,{"ui-drop":e}),o[e].data=i,_t.menu.set(e,n),s},_t.menu.set=function(e,t){var f,l,n='<span class="'+Ct+'-current menu">%1</span>',i=_t.tools[e]||{},r=i.target,o=i.data;return r?(!_(t)&&o[t]&&(Re(r,"ui-drop-data",t),t=o[t].text||t),_(t)?(l=t[0],l=Oe(l,"<")?l:_t.i(e,l),t=C(t[1])?t[1]:0,t=t&&o[t]&&o[t].text||t,n=l+(0!==t?" "+n:"")):l=_t.i(i.i||e),(f=gt("."+Ct+"-text",r)[0])?(tt(r,"text"),lt(f,Ze(n,[t,l]))):(it(r,"text"),lt(r,l)),s):s},_t.bubble=function(){_t.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Fe(e)&&(t="default",n=e[0]),X=Ge(t),st(qt,!1),wt(F,ot(qt,!1,{"class":Ct+"-bubble "+X})),T(n)?n(qt):ot(qt,n),_t.bubble.fit(),je("enter.bubble."+t,[s]),je("enter.bubble",[s]),s},_t.bubble.fit=function(e){Q=s.$(1),t=Qe(Ht),Y=c(Ht,"line-height");var n="border-",i="-width";X=Q.caret[0].x+t.l-Ht.scrollLeft,V=Q.caret[1].y+t.t+Y-Ht.scrollTop,I=c(St,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=Ve(St),o=Ve(qt),f=I[0]+I[1],l=I[2]+I[3];return _(e)?(C(e[0])&&(X=e[0]),C(e[1])&&(V=e[1])):(X=d(X,t.l,t.l+r.w-o.w-l),V=d(V,t.t,t.t+r.h-o.h-f)),c(qt,{left:X+Ce,top:V+Ce,visibility:"visible"}),je("fit.bubble",[s]),je("fit",[s]),s},_t.panel.exit=function(e){return _t.exit(e,"panel")},_t.overlay.exit=function(e){return _t.exit(e,"overlay")},_t.modal.exit=function(e){return _t.exit(e,"modal")},_t.drop.exit=function(e){return _t.exit(e,"drop")},_t.bubble.exit=function(e){return _t.exit(e,"bubble")},_t.tool=function(e,t,n){return W="","|"!==e&&(N.tools=Le(N.tools).filter(function(t,n){return t===e?(W=n,!1):!0})),t===!1?delete _t.tools[e]:("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),_t.tools[e]=b(_t.tools[e]||{},t),C(n)||""===W||(n=W)),$(n)?N.tools.splice(n,0,e):N.tools.push(e)),nn(),s},_t.separator=function(e,t){return _t.tool("|",e!==!1?{attributes:e||{}}:!1,t)},_t.key=function(e,t){return N.keys?(t===!1?delete _t.keys[e]:_t.keys[e]=t,rn(),s):s},_t.key.set=function(e){D[e]=1},_t.key.reset=function(e){e?delete D[e]:D={}},_t.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(we),!1},outdent:function(e,t){return _t.key.set("shift"),t.outdent(we),!1}},_t.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return J=":not([tabindex]):not([disabled])",(Q=gt("input"+J+",button"+J+",select"+J+",textarea"+J+",a[href]"+J+",[contenteditable]"+J+',[tabindex]:not([tabindex="-1"])',a,0))&&-1!==(V=Q.indexOf(Ht))?((Q[V+1]||a).focus(),!1):void 0},f10:function(e,t){return gt("a",jt)[0].focus(),!1},"shift+tab":ke?"outdent":0,tab:ke?"indent":0},_t.el={container:Nt,header:Dt,body:St,footer:It,panel:Rt,overlay:Yt,modal:At,drop:Wt,bubble:qt},s.config=N,b(TE._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),l=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>l&&(l="0"+l),[""+t,""+n,""+i,""+r,""+o,""+f,""+l]},replace:Ke,format:Ze,dom:{set:wt,reset:Et,get:gt,id:ft,copy:function(e,t){return e.cloneNode(C(t)?t:!0)},classes:{set:tt,reset:it,toggle:rt,get:nt},attributes:{set:He,reset:Be,get:Pe},data:{set:Re,reset:Ae,get:Ye},is:ht,offset:Qe,pointer:Je,size:Ve,content:{set:lt,reset:st,get:at},closest:et,parent:ut,children:ct,next:dt,previous:pt,index:bt,before:mt,after:vt,prepend:kt,append:xt},el:ot,event:{set:qe,reset:Xe,fire:Ue,x:We}}),b(s._,TE._),b(s._,{hooks:v,hook:{set:Se,reset:Ie,fire:je}}),s.create()};