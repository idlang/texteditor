/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function te(e,t,i){return z(e)?z(t)?(z(_[e])||(_[e]={}),z(i)||(i=Object.keys(_[e]).length),_[e][i]=t,s):_[e]:_}function ie(e,t){return z(e)?z(t)&&z(_[e])?(delete _[e][t],s):(_[e]={},s):(_={},s)}function ne(e,t,i){if(!z(_[e]))return _[e]={},s;if(z(i))z(_[e][i])&&_[e][i].apply(s,t);else for(var n in _[e])_[e][n].apply(s,t);return s}function re(e,t,i){if(y(t))for(var n in t)re(e,n,t[n]);else e.setAttribute(t,i)}function oe(e,t,i){return e.getAttribute(t)||(z(i)?i:!1)}function fe(e,t){if(y(t))for(var i in t)fe(e,t[i]);else e.removeAttribute(t)}function le(e,t,i){if(y(t))for(var n in t)re(e,"data-"+n,t[n]);else re(e,"data-"+t,i)}function se(e,t,i){return oe(e,"data-"+t,i)}function ae(e,t){if(y(t))for(var i in t)fe(e,"data-"+t[i]);else fe(e,"data-"+t)}function ue(e){return e&&e.preventDefault(),!1}function ce(e,t,i){return t?(t.addEventListener(e,i,!1),te("on:"+e,i,Ve(t)),s):void 0}function de(e,t,i){return t?(t.removeEventListener(e,i,!1),ie("on:"+e,Ve(t)),m(t)&&t.id.split(":")[0]===Me+"-dom"&&fe(t,"id"),s):void 0}function pe(e,t,i){if("createEvent"in l){var n=l.createEvent("HTMLEvents");n.data=i,n.initEvent(e,!0,!1),t.dispatchEvent(n)}else ne("on:"+e,i,Ve(t));return s}function he(e,t,i){e=v(e).split(/\s+/);for(var n=0,r=e.length;r>n;++n)ce(e[n],t,i);return s}function ve(e,t,i){e=v(e).split(/\s+/);for(var n=0,r=e.length;r>n;++n)de(e[n],t,i);return s}function be(e,t,i){e=v(e).split(/\s+/);for(var n=0,r=e.length;r>n;++n)pe(e[n],t,i);return s}function me(e,t){return setTimeout(e,t)}function ge(e){return clearTimeout(e)}function xe(e,t,i){for(var o,n=0,r=t.length;r>n;++n)o=t[n],e=e.replace(w(o)?o:h(u(o),"g"),i&&i[n]||"");return e}function ye(e,t){return e.replace(/%(\d+)/g,function(e,i){return--i,z(t[i])?t[i]:e})}function we(e){return v(xe(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function ke(e,t){var i=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,r=ze(e);return{x:i-r.l,y:n-r.t}}function ze(e){for(var t=e.offsetLeft,i=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,i+=e.offsetTop;return{l:t,t:i}}function Ee(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Te(e,t){for(;(e=ot(e))&&e!==t;);return e}function Qe(e,t,i){if(e=k(e)?l.createElement(e):e,y(i)){var n,r;for(r in i)n=i[r],"style"===r?k(n)?re(e,r,n):null===n?fe(e,r):e=d(e,n):g(n)?e[r]=n:null===n?fe(e,r):re(e,r,y(n)?n.join(" "):""+n)}if(m(t))ht(e,t);else if(y(t)){var n,r;for(r in t)n=t[r],m(n)?ht(e,n):n!==!1&&nt(e,n)}else z(t)&&t!==!1&&nt(e,t);return e}function Ve(e){var t=e.id;return t||(t=Me+"-dom:"+Date.now(),e.id=t),t}function et(e,t){return h("(^|\\s)"+t+"(\\s|$)").test(e.className)}function tt(e,t){et(e,t)||(e.className=v(e.className+" "+t))}function it(e,t){e.className=v(e.className.replace(h("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function nt(e,t){return z(t)?void(e.innerHTML=t):e.innerHTML}function rt(e,t){if(t!==!1){var n,i=e.children;for(n in i)rt(i[n])}nt(e,"")}function ot(e){return e.parentElement||e.parentNode}function ft(e){return e.children||[]}function lt(e){return e.nextElementSibling||e.nextSibling}function st(e){return e.previousElementSibling||e.previousSibling}function at(e,t){var i=ot(e);return 1===arguments.length?i||!1:e&&i===e?i:!1}function ut(e,t){ot(e).insertBefore(t,e)}function ct(e,t){ot(e).insertBefore(t,lt(e))}function dt(e,t){var i=ft(e)[0];i?ut(i,t):ht(e,t)}function pt(e,t){ht(e,t)}function ht(e,t){e.appendChild(t)}function vt(e,t){var i=at(e);if(i){if(t!==!1)for(var n=ft(e)[0];n;)vt(n);i.removeChild(e)}}function bt(e){rt(Qe(e,!1,{style:""})),vt(e)}function mt(e,t,i){return Qe(t||"div",i,{"class":e})}function gt(){if(Se._word&&Se._words){var e=(Ye.value||"").replace(h(J[0]+"[^"+J[0]+J[1]+"]+?"+J[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;nt(Ue,ye(Se["_word"+(1===t?"":"s")],[t]))}}function xt(e,t){g(e)&&(e.click=e),k(e.click)&&(e.click=($e.tools[e.click]||{}).click),z(e.active)||(e.active=1),z(e.title)||(e.title=De[t]||"")}function yt(){rt(je,!1);var n,r,o,f,l,a,u,e=k(D.tools)?v(D.tools).split(/\s+/):D.tools,t=Me+"-button",i=Me+"-separator";D.tools=e;for(l in e)u=e[l],r=$e.tools[u],r&&(xt(r,u),"|"!==(o=r.i||u)&&(o=we(o)),f="|"!==o,Je=mt(f?t:i,f?"a":"span"),f&&(n=t+":"+we(u).replace(/\s/g,""),re(Je,{href:V,id:n,"tab-index":-1}),le(Je,Q,u),o='<i class="'+ye(_e.i,[o])+" "+n+'"></i>',r.active||tt(Je,"x"),r.text&&(o=ye('<span class="'+Me+'-text">'+r.text+"</span>",[o]),tt(Je,"text")),nt(Je,o),Qe(Je,!1,r.attributes||{}),!Je.title&&(a=r.title)&&(Je.title=y(a)?a[0]+(a[1]?" ("+a[1]+")":""):a),he(Y,Je,Mt)),ht(je,Je));ne("update.tools",[s])}function wt(){$e.keys=function(){var i,n,e=Object.keys($e.keys).sort().reverse(),t={};for(i=0,n=e.length;n>i;++i)t[e[i]]=$e.keys[e[i]];return t}(),$t(1),ne("update.keys",[s])}function kt(e){gt(),ne("on:change",[e,s])}function Tt(e){function y(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var d,p,v,b,m,x,t=s.$(),i=t.before,n=t.after,r=i.slice(-1),o=n[0],f=t.length,l=$e.keys,a=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),g=e.TE.key();zt[g]=1,x=Object.keys(zt).length,me(function(){s.record()},1);for(d in l){var w=0;v=y(d);for(p in v)p=v[p],zt[a[p]||p]&&++w;if(v=v.length,w===v&&x===v&&(k(l[d])&&(l[d]=$e.tools[l[d]].click),b=l[d]&&l[d](e,s),b===!1))return ue(e)}if(X)for(d in X)if(m=X[d],m!==!1){if(g===m&&o===m)return"\\"===r?(s.insert(g,0),ue(e)):(s.select(t.end+1),ue(e));if(d===g)return s.wrap(d,m),ue(e);if(r===d&&o===m){if("backspace"===g&&i.slice(-2)!=="\\"+d)return s.unwrap(d,m),ue(e);if(U&&"enter"===g&&d!==m)return s.tidy("\n"+c+R,"\n"+c).scroll(!0),ue(e)}}if(U&&!f){if("backspace"===g&&h(u(R)+"$").test(i))return s.outdent(R).scroll(!0),ue(e);if("enter"===g&&h("(^|\\n)("+u(R)+")+.*$").test(i))return s.insert("\n"+c,0,1).scroll(!0),ue(e)}}function $t(e){y(e)?delete zt[e.TE.key()]:zt={}}function _t(e){/^focus|blur$/.test(e.type)&&$t(1),ge(Et),Et=me(function(){kt(e)},D.debounce||0)}function Mt(e){$e.exit(0,0,0);var r,t=se(this,Q),i=$e.tools,n=i[t];return Ze=e.currentTarget||e.target,n&&n.active&&n.click&&(r=i[t].click(e,s,t),ne("on:change",[e,s,t]),r===!1)?ue(e):(s.select(),ue(e))}function Yt(e){return Dt=Pe,jt=Ee(Fe),ue(e)}function Pt(e){Dt===Pe&&d(Ye,{height:ke(He,e).y-jt.h+ee})}function Wt(){Dt=0}function At(){$e.exit(1)}function It(){e=Ee(Ie),Ot=e.w,Nt=e.h,e=Ee(Ae),Ct=e.w,Ht=e.h}function qt(e,t){t&&ne("exit.modal."+t,[s]),be(Y,Ae,[e])}function Bt(t){Dt=t.target,e=ke(Ie,t),Lt=e.x,St=e.y,It()}function Rt(t){var r,o,i=Ft.header,n=Ft.resize;Dt===i||Te(Dt,i)===i?(e=ke(He,t),r=e.x-Lt,o=e.y-St,d(Ie,{left:(Ot>Ct?r:p(r,0,Ct-Ot))+ee,top:(Nt>Ht?o:p(o,0,Ht-Nt))+ee})):Dt===n&&(e=ke(Ie,t),jt=Ee(n),d(Ie,{width:e.x+jt.w/4+ee,height:e.y+jt.h/4+ee}))}function Ut(){Dt=0}function Xt(e,t,i){return{header:e,body:t,footer:i}}function Kt(e){var t=Ze,n=e&&e.target||0;(!n||n!==t&&Te(n,t)!==t)&&(Ze=0,bt(qe),ve(Y,$,Kt),$e.exit(1))}function Jt(e){function l(){r&&(o=Ee(r),d(n,{width:o.w+ee,height:o.h+ee}))}var n,r,o,t=s.get(),i="";return-1===t.indexOf("</html>")&&(i='<!DOCTYPE html><html dir="'+D.dir+'"><head><meta charset="utf-8"><style>'+D.css+"</style></head><body>"+t+"</body></html>"),n=Qe("iframe",!1,{"class":Me+"-portal",src:"data:text/html,"+encodeURIComponent(i)}),!at(Ae)&&t?$e.overlay(n,1,function(){r=ft(Ae)[0],l(),he(I,f,l),ne("enter.overlay.preview",[e,s,[t,i],r])}):(ve(I,f,l),At()),ue(e)}var t="⌘",i="…",r="⇥",o="⇧",f=window,l=document,s=this,a=s._,u=a.x,c=a.extend,d=a.css,p=a.edge,h=a.pattern,v=a.trim,b=s.is,m=b.e,g=b.f,x=b.i,y=b.o,w=b.r,k=b.s,z=function(e){return!b.x(e)},E=l.documentElement,$=(l.head,l.body),_={},M=function(){},D=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",r],outdent:["Outdent",o+"+"+r],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),L="keydown",S="keyup",O="copy",N="cut",C="paste",H="touchstart mousedown",F="touchend mouseup",j="touchmove mousemove",Y="click",P="focus",W="blur",A="input",I="orientationchange resize",q=W+" "+O+" "+N+" "+P+" "+A+" "+L+" "+C,B=D.languages,R=D.tab,U=D.auto_tab,X=D.auto_close,K=D.unit[0][0],J=(D.unit[0][1],D.unit[1][0]),G=D.unit[1][1],Q="tool-id",V="javascript:;",ee="px",$e=s.ui={};s.tidy=function(e,t){var i=s.$(),n=v(i.before)?e:"",r=v(i.after)?z(t)?t:e:"";return s.trim(n,r)},s.i=function(){return v(s.replace(/\s+/g," "))},s.format=function(e,t,i,n){y(e)||(e=[e]),z(i)||(i=" "),z(n)||(n="");var r=s[0]().$(),o=(e[0]?K[0]+e[0]+K[1]:"")+n,f=n+(e[0]?K[0]+K[2]+(e[1]||e[0].split(h("("+G[3]+")+"))[0])+K[1]:""),l=u(o),a=u(f),c=h("^"+l+"([\\s\\S]*?)"+a+"$"),d=h(l+"$"),p=h("^"+a),v=r.before,b=r.after;return r.length?i=!1:s.insert(B.placeholders[""]),s.toggle(t?!c.test(r.value):!d.test(v)&&!p.test(b),[function(e){e.unwrap(o,f,1).tidy(h(J[0]+"[^"+J[0]+J[1]+J[2]+"]+?"+J[1]+"$").test(v)?"":i,h("^"+J[0]+J[2]+"[^"+J[0]+J[1]+"]+?"+J[1]).test(b)?"":i).wrap(o,f,t)[1]()},function(e){e.unwrap(o,f,t)[1]()}])};var Je,_e=D.classes,Me=_e[""],De=B.tools,Le=B.buttons,Se=B.others,Oe=Me+"-textarea "+Me+"-content block",Ne=mt(Me),Ce=mt(Me+"-header"),He=mt(Me+"-body"),Fe=mt(Me+"-footer"),je=mt(Me+"-tool"),Ye=Qe(s.target,!1,D.attributes),Pe=mt(Me+"-resize s"),We=mt(Me+"-description"),Ae=mt(Me+"-overlay"),Ie=Qe("div"),qe=Qe("div"),Be=Qe("div"),Re=mt("left","span"),Ue=mt("right","span"),Xe=mt(Me+"-preview","a"),Ke=0,Ze=0;D.suffix||(D.suffix=K[1]);var zt={},Et=null;s.create=function(e,t){y(e)&&(D=c(D,e));var i=at(Ye);if(tt(Ye,Oe),i&&"P"===i.nodeName?(ut(i,Ne),Ke=i,vt(i,!1)):ut(Ye,Ne),Ne.dir=D.dir,ht(Ne,Ce),ht(Ne,He),ht(Ne,Fe),ht(Ne,Pe),ht(He,Ye),D.tools&&(ht(Ce,je),ht(Fe,We),ht(We,Re),ht(We,Ue)),he(L,Ye,Tt),he(S,Ye,$t),he(q,Ye,_t),he(H,Pe,Yt),he(j,$,Pt),he(F,$,Wt),Se.preview){var n=De.preview;re(Xe,{href:V,title:y(n)?n[0]+(n[1]?" ("+n[1]+")":""):n}),ht(Re,Xe),nt(Xe,Se.preview)}return kt(null),yt(),wt(),0!==t?ne("create",[s]):s},s.update=function(e,t){return et(Ye,Oe)&&s.destroy(0),(0!==t?ne("update",[s]):s).create(e,0)},s.destroy=function(e){return et(Ye,Oe)?($e.exit(0,0,0),it(Ye,Oe),y(D.tools)&&(D.tools=D.tools.join(" ")),D.keys&&(ve(L,Ye,Tt),ve(S,Ye,$t)),ve(H,Pe,Yt),ve(j,$,Pt),ve(F,$,Wt),ve(q,Ye,_t),Ke?(ut(Ne,Ke),ht(Ke,Ye),Ke=0):ut(Ne,Ye),bt(Ne),0!==e?ne("destroy",[s]):s):s};var e,jt,Dt=0,Lt=0,St=0,Ot=0,Nt=0,Ct=0,Ht=0,Ft={};$e.exit=function(e,t,i){var r,n={overlay:function(){ve(Y,Ae,At),bt(Ae)},modal:function(){ve(H,He,Bt),ve(j,He,Rt),ve(F,$,Ut),ve(Y,Ft.x,qt),bt(Ie)},drop:function(){bt(qe)},bubble:function(){bt(Be)}};if(t)if(y(t))for(r in t)r=t[r],n[r]&&n[r](),0!==i&&ne("exit."+r,[s]);else n[t]&&n[t](),0!==i&&ne("exit."+r,[s]);else for(r in n)n[r]();return e&&s.select(),0!==i&&ne("exit",[s]),s},$e.overlay=function(e,t,i){return $e.exit(0,0,0).blur(),$t(1),ht(He,Qe(Ae,e.length||m(e)?mt(Me+"-overlay-content","div",e):"")),t&&he(Y,Ae,At),g(i)?i(Ae):Qe(Ae,i),ne("enter.overlay",[s]),ne("enter",[s]),s},$e.overlay.fit=function(){},$e.modal=function(){$e.overlay("",1);var o,l,e=arguments,t=e[0],i=e[1],n=e[2],r=Me+"-modal";y(t)&&(t="default",i=e[0],n=e[1]),l=we(t),Qe(Ie,!1,{"class":r+" "+l}),z(i.body)&&(i.body=Qe("div",i.body,{"class":r+"-content "+l}));for(o in i)r[1]=o,Ft[o]=mt(r+"-"+ye(o,r)+" "+l,0,i[o]);return Ft.x=mt(Me+"-x "+l),Ft.resize=mt(Me+"-resize se "+l),rt(Ie),ht(He,Qe(Ie,Ft,{style:""})),$e.modal.fit(),ct(Ie,Ae),he(Y,Ft.x,qt),he(H,Ft.header,ue),he(H,Ft.resize,ue),he(H,He,Bt),he(j,He,Rt),he(F,$,Ut),g(n)&&(Ft.overlay=Ae,Ft.modal=Ie,n(Ft)),ne("enter.modal."+t,[s]),ne("enter.modal",[s]),ne("enter",[s]),s},$e.modal.fit=function(e){It();var t=Ht/2-Nt/2,i=Ct/2-Ot/2;return y(e)?(i=e[0],t=e[1]):(i=p(i,0),t=p(t,0)),d(Ie,{left:i+ee,top:t+ee,"min-width":Ot+ee,"min-height":Nt+ee,visibility:"visible"}),ne("fit.modal",[s]),ne("fit",[s]),s};var Zt={"class":Me+"-button",name:"y"};return $e.alert=function(e,t,i,n){var r=Qe("button",Le.okay,Zt),o="alert";return i=i||M,y(e)&&(o+=":"+e[0],e=e[1]||e[0]),he(Y,r,function(e){return i(e,s),qt(e,o+".y"),ue(e)}),he(L,r,function(e){var t=e.TE.key;return t(/^escape|enter$/)?be(Y,r,[e,s]):void 0}),$e.modal(o,Xt(e,t,r),n),r.focus(),s},$e.confirm=function(e,t,i,n,r){function u(e){return g(i)&&i(e,s),qt(e,l+".y"),ue(e)}function c(e){return g(n)&&n(e,s),qt(e,l+".n"),ue(e)}var a,o=Qe("button",Le.okay,Zt),f=Qe("button",Le.cancel,Zt),l="confirm";return f.name="n",y(e)&&(l+=":"+e[0],e=e[1]||e[0]),he(Y,o,u),he(Y,f,c),he(L,o,function(e){return a=e.TE.key,a("arrowright")?(f.focus(),ue(e)):a("arrowleft")?ue(e):a("enter")?(u(e),ue(e)):a("escape")?(qt(e,l+".y"),ue(e)):void 0}),he(L,f,function(e){return a=e.TE.key,a("arrowright")?ue(e):a("arrowleft")?(o.focus(),ue(e)):a("enter")?(c(e),ue(e)):a("escape")?(qt(e,l+".n"),ue(e)):void 0}),$e.modal(l,Xt(e,t,[o,f]),r),f.focus(),s},$e.prompt=function(e,t,i,n,r,o){function b(){a.focus(),"placeholder"in a&&a.select()}function m(e){return ue(e)}function x(e){return h=a.value,!i||v(h)&&h!==t?(qt(e,u+".y"),ue(e),n(e,s,h!==t?h:"",t)):(b(),m(e))}function w(e){return qt(e,u+".n"),ue(e)}var d,p,h,f=Qe("button",Le.okay,Zt),l=Qe("button",Le.cancel,Zt),a=Qe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Me+"-input block"}),u="prompt",c=[];if(y(e)&&(u+=":"+e[0],e=e[1]||e[0]),g(r)&&(o=r,r=0),1===r)a=Qe("textarea",t,{placeholder:t.split("\n")[0],"class":Me+"-textarea block"});else if(2===r){for(p in t)c.push(Qe("option",t[p],{value:p,selected:p===i||null}));a=Qe("select",c,{"class":Me+"-select block"})}return n=n||M,a.name="data",l.name="n",he(L,a,function(e){return d=e.TE.key,d("enter")?x(e):d("escape")||d("backspace")&&!this.value?w(e):d("arrowup")?m(e):d("arrowdown")?(f.focus(),ue(e)):void 0}),he(L,f,function(e){return d=e.TE.key,d("enter")?x(e):d("escape")?w(e):d("arrowup")?(a.focus(),ue(e)):d("arrowright")?(l.focus(),ue(e)):d(/^arrow(down|left)$/)?m(e):void 0}),he(L,l,function(e){return d=e.TE.key,d(/^enter|escape$/)?w(e):d("arrowup")?(a.focus(),ue(e)):d(/^arrow(right|down)$/)?m(e):d("arrowleft")?(f.focus(),ue(e)):void 0}),he(Y,f,x),he(Y,l,w),$e.modal(u,Xt(e,a,[f,l]),o),b(),s},$e.drop=function(){$e.exit(0,0,0);var n,e=arguments,t=e[0],i=e[1];return 1===e.length&&(t="default",i=e[0]),n=we(t),rt(qe),ht($,Qe(qe,!1,{"class":Me+"-drop "+n})),g(i)?i(qe):Qe(qe,i),$e.drop.fit(),he(Y,$,Kt),ne("enter.drop."+t,[s]),ne("enter.drop",[s]),s},$e.drop.fit=function(e){var o,t=Ee(E),i=Ee(qe),n=t.w/2-i.w/2,r=t.h/2-i.h/2;return!z(e)&&Ze&&(o=ze(Ze),n=o.l,r=o.t+Ee(Ze).h),y(e)?(n=e[0],r=e[1]):(n=p(n,0,t.w-i.w),r=p(r,0,t.h-i.h)),d(qe,{left:n+ee,top:r+ee,visibility:"visible"}),ne("fit.drop",[s]),ne("fit",[s]),s},$e.menu=function(e,t,i,n){var r='<span class="'+Me+'-current menu">%1</span>',o="";return t===!1?$e.tool(e,t):(y(t)&&(o=t[0],t=t[1],r='<i class="'+ye(_e.i,[o])+'"></i> '+r),$e.tool(e,{i:o,text:ye(r,[i[t]&&i[t].text||t,o]),click:function(t){var f,l,a,u,d,p,h,n={href:V,"class":Me+"-button"};return $e.drop("menu menu-"+we(e),function(e){function t(e){return u=this,h=i[se(u,Q)],f=nt(u),h&&h.active&&g(p=h.click)&&(p=p(e,s),Ze&&nt(ft(Ze)[0]||Ze,ye(r,[f,o])),p===!1)?ue(e):(s.select(),ue(e))}for(a in i)d=i[a],d=k(d)?$e.tools[d]:d,d&&(xt(d,a),n["data-"+Q]=a,l=Qe("a",d.text||a,c(n,d.attributes||{})),!l.title&&(p=d.title)&&(l.title=y(p)?p[0]+(p[1]?" ("+p[1]+")":""):p),d.active||tt(l,"x"),i[a]=d,he(Y,l,t),ht(e,l))}),!1}},n),s)},$e.bubble=function(){$e.exit(0,0,0);var n,e=arguments,t=e[0],i=e[1];return 1===e.length&&(t="default",i=e[0]),n=we(t),rt(Be),ht($,Qe(Be,!1,{"class":Me+"-bubble "+n})),g(i)?i(Be):Qe(Be,i),$e.bubble.fit(),ne("enter.bubble."+t,[s]),ne("enter.bubble",[s]),s},$e.bubble.fit=function(e){var t=s.$(1),i=ze(Ye),n=d(Ye,"line-height"),r="border-",o="-width",f=t.caret[0].x+i.l-Ye.scrollLeft,l=t.caret[1].y+i.t+n-Ye.scrollTop,a=d(He,[r+"top"+o,r+"bottom"+o,r+"left"+o,r+"right"+o]),u=Ee(He),c=Ee(Be),h=a[0]+a[1],v=a[2]+a[3];return y(e)?(f=e[0],l=e[1]):(f=p(f,i.l,i.l+u.w-c.w-v),l=p(l,i.t,i.t+u.h-c.h-h)),d(Be,{left:f+ee,top:l+ee,visibility:"visible"}),ne("fit.bubble",[s]),ne("fit",[s]),s},$e.overlay.exit=function(e){return $e.exit(e,"overlay")},$e.modal.exit=function(e){return $e.exit(e,"modal")},$e.drop.exit=function(e){return $e.exit(e,"drop")},$e.bubble.exit=function(e){return $e.exit(e,"bubble")},$e.tool=function(e,t,i){var n="";return"|"!==e&&(D.tools=D.tools.filter(function(t,i){return t===e?(n=i,!1):!0})),t===!1?delete $e.tools[e]:("|"===e?(i=t,t={}):(g(t)&&(t={click:t}),$e.tools[e]=c($e.tools[e]||{},t),z(i)||""===n||(i=n)),x(i)?D.tools.splice(i,0,e):D.tools.push(e)),yt(),s},$e.key=function(e,t){return D.keys?(t===!1?delete $e.keys[e]:$e.keys[e]=t,wt(),s):s},$e.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(R),!1},outdent:function(e,t){return t.outdent(R),!1}},he(Y,Xe,Jt),$e.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Jt(e)},"shift+tab":U?"outdent":0,tab:U?"indent":0,escape:function(e,t){return Xe.focus(),!1}},$e.el={container:Ne,header:Ce,body:He,footer:Fe,overlay:Ae,modal:Ie,drop:qe,bubble:Be},s.config=D,c(s._,{time:function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,n=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),l=e.getMilliseconds();return 10>i&&(i="0"+i),10>n&&(n="0"+n),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>l&&(l="0"+l),[""+t,""+i,""+n,""+r,""+o,""+f,""+l]},replace:xe,format:ye,dom:{set:ht,reset:vt,exist:at,id:Ve,classes:{set:tt,reset:it,exist:et},attr:{set:re,reset:fe,get:oe},data:{set:le,reset:ae,get:se},offset:ze,point:ke,size:Ee,content:{set:nt,reset:rt},closest:Te,parent:ot,children:ft,next:lt,previous:st,before:ut,after:ct,prepend:dt,append:pt},el:Qe,event:{set:he,reset:ve,fire:be,x:ue},hooks:_,hook:{set:te,reset:ie,fire:ne}}),$e};