/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.8.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,n){function Ne(e){return _(e)?x(e).split(/\s+/):e}function $e(e){return T(e)?e.join(" "):e}function Me(e,n){return-1!==e.indexOf(n)}function Se(e){return e.length}function He(e){return Object.keys(e)}function je(e){return Se(He(e))}function Be(e,n,t){return k(e)?k(n)?(k(b[e])||(b[e]={}),k(t)||(t=je(b[e])),b[e][t]=n,s):b[e]:b}function Re(e,n){return k(e)?k(n)&&k(b[e])?(delete b[e][n],s):(b[e]={},s):(b={},s)}function Ie(e,n,t){if(!k(b[e]))return b[e]={},s;if(k(t))k(b[e][t])&&b[e][t].apply(s,n);else for(Z in b[e])b[e][Z].apply(s,n);return s}function ze(e,n,t){if(T(n))for(Z in n)ze(e,Z,n[Z]);else e[(null===t?"remove":"set")+"Attribute"](n,t)}function Oe(e,t,r){if(_(t))return Oe(e,[t],[k(r)?r:""])[0];n=[];for(Z in t)Z=t[Z],(Z=e.getAttribute(Z))&&n.push(Z);return Se(n)?n:k(r)?r:[]}function De(e,n){if(T(n))for(Z in n)De(e,n[Z]);else if(k(n))e.removeAttribute(n);else for(De(e,"class"),Z=0,U=e.attributes,V=Se(U);V>Z;++Z)U[Z]&&De(e,U[Z].name)}function qe(e,n,t){if(T(n))for(Z in n)qe(e,Z,n[Z]);else ze(e,"data-"+n,t)}function Pe(e,t,r){if(_(t))return Pe(e,[t],[k(r)?r:""])[0];n=[];for(Z in t)Z=t[Z],(Z=Oe(e,"data-"+Z))&&n.push(Z);return Se(n)?n:k(r)?r:[]}function Ze(e,n){if(T(n))for(Z in n)De(e,"data-"+n[Z]);else if(k(n))De(e,"data-"+n);else for(Z=0,U=e.attributes,V=Se(U);V>Z;++Z)U[Z]&&"data-"===U[Z].name.slice(0,5)&&De(e,U[Z].name)}function Ue(e){return e&&e.preventDefault(),!1}function Ve(e,n,t){if(n){for(e=Ne(e),Z=0,U=Se(e);U>Z;++Z)n.addEventListener(e[Z],t,!1),Be("on:"+e[Z],t,sn(n));return s}}function Ye(e,n,t){if(n){for(e=Ne(e),Z=0,U=Se(e);U>Z;++Z)t?(n.removeEventListener(e[Z],t,!1),Re("on:"+e[Z],sn(n))):cn(n);return w(n)&&n.id.split(":")[0]===Hn+"-dom"&&De(n,"id"),s}}function Xe(e,n,t){e=Ne(e);var i,r="createEvent"in c;for(Z=0,U=Se(e);U>Z;++Z)r?(i=c.createEvent("HTMLEvents"),i.data=t,i.initEvent(e[Z],!0,!1),n.dispatchEvent(i)):Ie("on:"+e[Z],t,sn(n));return s}function We(e,n,t){for(Z=0,U=Se(n),V;U>Z;++Z)V=n[Z],e=e.replace(A(V)?V:m(d(V),"g"),t&&t[Z]||"");return e}function Ke(e,n){return e.replace(/%(\d+)/g,function(e,t){return--t,k(n[t])?n[t]:e})}function Ge(e){return x(We(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Je(e,n){var t=n.touches?n.touches[0].pageX:n.pageX,r=n.touches?n.touches[0].pageY:n.pageY,i=Qe(e);return{x:t-i.l,y:r-i.t}}function Qe(e){for(Y=e.offsetLeft,ee=e.offsetTop;e=e.offsetParent;)Y+=e.offsetLeft,ee+=e.offsetTop;return{l:Y,t:ee}}function en(e){return e===o?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function nn(e,n){for(;(e=dn(e))&&e!==n;);return e}function tn(e,n){n=Ne(n);for(Z in n)e.classList.add(n[Z])}function rn(e,t,r){if(_(t))return rn(e,[t],[k(r)?r:""])[0];n=[];for(Z in t)Z=t[Z],e.classList.contains(Z)&&n.push(Z);return Se(n)?n:k(r)?r:!1}function un(e,n){if(k(n)){n=Ne(n);for(Z in n)e.classList.remove(n[Z])}else De(e,"class")}function fn(e,n){n=Ne(n);for(Z in n)e.classList.toggle(n[Z])}function on(e,n,t){if(e=e||"div",e=_(e)?c.createElement(e):e,T(t))for(Z in t)if(te=t[Z],"classes"===Z)tn(e,te);else if("data"===Z)for(U in te)te=te[U],null===te?Ze(e,U):qe(e,U,te);else"css"===Z?_(te)?ze(e,"style",te):null===te?De(e,"style"):l(e,te):C(te)?e[Z]=te:null===te?De(e,Z):ze(e,Z,F(te)?te.join(" "):""+te);if(w(n))Tn(e,n);else if(T(n))for(Z in n)te=n[Z],w(te)?Tn(e,te):te!==!1&&an(e,te);else k(n)&&n!==!1&&an(e,n);return e}function cn(e){return _n(e,kn(e,!0))}function sn(e){var n=e.id;return n||(n=Hn+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=n),n}function an(e,n){e.innerHTML=n}function ln(e,n){return e.innerHTML||(k(n)?n:"")}function pn(e,n){if((!k(n)||n)&&(I=hn(e)))for(Z=0,U=Se(I);U>Z;++Z)pn(I[Z]);an(e,"")}function dn(e){return e&&e.parentNode}function hn(e){return e&&e.children||[]}function mn(e,n){return k(n)?_(n)?e.closest(n):nn(e,n):dn(e)}function gn(e){return e&&e.nextSibling}function yn(e){return e&&e.previousSibling}function xn(e){for(Z=0;e=yn(e);)++Z;return Z}function bn(e,n){return e&&_(n)?e.nodeName.toLowerCase()===n.toLowerCase():e&&C(n)?e===n(e):e===n}function vn(e,t){if(!(t=k(t)?t:c))return[];if(n=[],_(e)){if(/^[#.]?(?:\\.|[\w-]|[^\x00-\xa0])+$/.test(e)){if("#"===e[0]&&(e=t.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=t.getElementsByClassName(e.slice(1)))||(e=t.getElementsByTagName(e))){for(Z=0,U=Se(e);U>Z;++Z)n.push(e[Z]);return n}return[]}for(e=t.querySelectorAll(e),Z=0,U=Se(e);U>Z;++Z)n.push(e[Z]);return n}return En(e)?[e]:[]}function En(e,n){var t=dn(e);return 1===Se(arguments)?t||!1:e&&t===e?t:!1}function wn(e,n){K=dn(e),K&&K.insertBefore(n,e)}function Fn(e,n){K=dn(e),K&&K.insertBefore(n,gn(e))}function Cn(e,n){I=hn(e)[0],I?wn(I,n):Tn(e,n)}function Ln(e,n){Tn(e,n)}function Tn(e,n){e.appendChild(n)}function An(e,n){var t=En(e);if(t){if(!k(n)||n)for(I=hn(e)[0];I;)An(I);t.removeChild(e)}}function kn(e,n){return e.cloneNode(k(n)?!!n:!0)}function _n(e,n){return dn(e).replaceChild(n,e),n}function Nn(e){pn(on(e,!1,{style:""})),An(e)}function $n(e,n,t){return on(n,t,{"class":e})}function ut(e){return!e||k(e.active)&&!e.active}function ft(e,n,t){return C(e)&&(e={click:e}),_(e.click)&&(e.click=(t[e.click]||{}).click),e.title=jn[n]||"",k(e.attributes)||(e.attributes={}),t[n]&&(t[n]=e),e}function ot(e){Mn.exit(0,0,0);var n=Pe(this,"tool-id"),t=Mn.tools,r=t[n];return Mn.drop.target=e.currentTarget||e.target,!ut(r)&&C(U=r.click)&&(U=U(e,s,n),Ie("on:change",[e,s,n]),U===!1)?Ue(e):(s.select(),Ue(e))}function ct(e){if(ee=this,(V=e.TE.key)(/^(escape|f10)$/))Mn.exit(1);else if(V("enter")||V("arrowdown")&&Pe(ee,"ui-drop"))Mn.drop.target=ee,Xe(ce,ee,[e]);else if(V("arrowright")&&(Y=gn(ee))){for(;!bn(Y,"a")&&Y;)Y=gn(Y);Y&&Y.focus()}else if(V("arrowleft")&&(Y=yn(ee))){for(;!bn(Y,"a")&&Y;)Y=yn(Y);Y&&Y.focus()}return Ue(e)}function at(){pn(Un,0);var i,u,f,o,c,a,l,e=Mn.tools,n=Ne(H.tools),t=Hn+"-button",r=Hn+"-separator";H.tools=n;for(a in n)l=n[a],u=e[l],(u||u==={})&&(u=ft(u,l,e),f=u.i||l,"|"===f||Me(f,"<")||(f=Ge(f)),o="|"!==f,c=Ge(l).replace(/[\/\s]/g,"-"),rt=$n(o?t+" "+t+"-"+c:r+" "+r+"-"+a,o?"a":"span"),o?(rt=u.target||rt,i=t+":"+c,ze(rt,{href:ke,id:i,tabindex:-1}),qe(rt,"tool-id",l),f=Me(f,"<")?f:Mn.i(c,f),ut(u)?tn(rt,"x"):un(rt,"x"),u.on?tn(rt,"on"):un(rt,"on"),u.text&&(f=Ke('<span class="'+Hn+'-text">'+u.text+"</span>",[f]),tn(rt,"text")),an(rt,f),on(rt,!1,u.attributes),!u.attributes.title&&(U=u.title)&&(rt.title=T(U)?U[0]+(U[1]?" ("+U[1]+")":""):U),Ve(ce,rt,ot),Ve(de,rt,ct)):rt.id=r+":"+a,u.target=rt,(c=Pe(rt,st))&&Mn.menu.set(l,c),Tn(Un,rt));Ie("update.tools",[s])}function lt(){Mn.keys=function(){var t,e=He(Mn.keys).sort().reverse(),n={};for(Z=0,U=Se(e);U>Z;++Z)t=e[Z],n[t]=Mn.keys[t];return n}(),dt(),Ie("update.keys",[s])}function pt(e){function h(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var t=s.$(),r=t.before,i=t.after,u=r.slice(-1),f=i[0],o=t.length,c=Mn.keys,a=TE.keys_alias,l={control:0,shift:0,option:"alt",meta:0},p=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(Z in l)e.TE[Z]()&&(j[l[Z]||Z]=1);W=e.TE.key(),j[W]=1,n=je(j),y(function(){s.record()});for(Z in c){V=h(Z),I=0;for(U in V)U=V[U],j[a[U]||U]&&++I;if(V=Se(V),I===V&&n===V&&(_(c[Z])&&(c[Z]=Mn.tools[c[Z]].click),Y=C(c[Z])&&c[Z](e,s),Y===!1))return Ue(e)}if(ve)for(Z in ve)if(X=ve[Z],X!==!1){if(W===X&&f===X)return"\\"===u?(s.insert(W,0),Ue(e)):(s.select(t.end+1),Ue(e));if(Z===W)return s.wrap(Z,X),Ue(e);if(u===Z&&f===X){if("backspace"===W&&r.slice(-2)!=="\\"+Z)return s.unwrap(Z,X),Ue(e);if(Ee&&"enter"===W&&Z!==X&&!o)return s.tidy("\n"+p+Fe,"\n"+p).scroll(1),Ue(e)}}if(Ee&&!o){if("backspace"===W&&m(d(Fe)+"$").test(r))return s.outdent(Fe),Ue(e);if("enter"===W&&m("(^|\\n)("+d(Fe)+")+.*$").test(r))return s.insert("\n"+p,0,1).scroll(1),Ue(e)}}function dt(e){e&&e.TE&&e.TE.key?delete j[e.TE.key()]:j={}}function xt(e){return ht=zn,Q=en(Zn),Ue(e)}function bt(e){ht===zn&&l(Vn,{height:Je(Pn,e).y-Q.h+_e})}function vt(){ht=0}function Et(){Mn.exit(1)}function wt(){n=en(Kn),re=n.w,P=n.h,n=en(Wn),mt=n.w,gt=n.h}function Ft(e,n){return n&&Ie("exit.modal."+n,[s]),Xe(ce,Wn,[e]),Ue(e)}function Ct(e){ht=e.target,n=Je(Kn,e),ie=n.x,ue=n.y,wt()}function Lt(e){var t=yt.header,r=yt.sizer;ht===t||nn(ht,t)===t?(n=Je(Pn,e),Y=n.x-ie,ee=n.y-ue,l(Kn,{left:(re>mt?Y:p(Y,0,mt-re))+_e,top:(P>gt?ee:p(ee,0,gt-P))+_e})):ht===r&&(n=Je(Kn,e),Q=en(r),l(Kn,{width:n.x+Q.w/4+_e,height:n.y+Q.h/4+_e}))}function Tt(){ht=0}function At(e,n,t){return{header:e,body:n,footer:t}}function kt(e){B=Mn.drop.target,R=Gn,I=e&&e.target||0,(!I||I!==B&&nn(I,B)!==B)&&(Mn.drop.target=0,Mn.exit(I===Vn))}var B,R,I,D,P,Z,U,V,Y,X,W,n,K,J,Q,ee,ne,te,re,ie,ue,t="⌘",r="…",u="⇥",f="⇧",o=window,c=document,s=new TE(e),a=s._,l=a.css,p=a.edge,d=a.x,h=a.extend,m=a.pattern,g=a.timer.reset,y=a.timer.set,x=a.trim,b={},v=function(){},E=TE.is,w=E.e,F=E.a,C=E.f,L=E.i,T=E.o,A=E.r,k=function(e){return!E.x(e)},_=E.s,N=c.documentElement,M=(c.head,c.body),H=(c.currentScript,h({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",u],outdent:["Outdent",f+"+"+u]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},n)),j={},oe="blur",ce="click",de="keydown",he="keyup",me="touchstart mousedown",ge="touchmove mousemove",ye="touchend mouseup",be="orientationchange resize",ve=H.auto_close,Ee=H.auto_tab,we=H.languages,Fe=H.tab,Le=(H.union[1][1],H.union[1][0]),Te=H.union[0][1],Ae=H.union[0][0],ke="javascript:;",_e="px",Mn=s.ui={};s.tidy=function(e,n){var t=s.$(),r=x(t.before)?e:"",i=x(t.after)?k(n)?n:e:"";return s.trim(r,i)},s.i=function(){return x(s.replace(/\s+/g," "))},s.format=function(e,n,t,r){T(e)||(e=[e]),k(t)||(t=" "),k(r)||(r="");var i=s.h,u=s[0]().$(),f=e[0].split(m("("+Te[3]+")+"))[0],o=(e[0]?Le[0]+e[0]+Le[1]:"")+r,c=r+(e[0]?Le[0]+Le[2]+(e[1]||f)+Le[1]:""),a=d(e[0]?Le[0]+f+Le[1]:""),l=d(c),p=m("^"+a+"([\\s\\S]*?)"+l+"$"),h=m(a+"$"),g=m("^"+l),y=u.before,x=u.after;return u.length?t=!1:s.insert(we.placeholders[""]),s.toggle(n?!p.test(u.value):!h.test(y)&&!g.test(x),[function(e){e.unwrap(o,c,1).tidy(m(Ae[0]+"[^"+Ae[0]+Ae[1]+Ae[2]+"]+?"+Ae[1]+"$").test(y)?"":t,m("^"+Ae[0]+Ae[2]+"[^"+Ae[0]+Ae[1]+"]+?"+Ae[1]).test(x)?"":t).wrap(o,c,n)},function(e){e.unwrap(o,c,n)}])[i]()};var rt,Sn=H.classes,Hn=Sn[""],jn=we.tools,Bn=we.buttons,Rn=we.labels,In=Hn+"-textarea "+Hn+"-content block",zn=$n(Hn+"-sizer s"),On=$n(Hn+"-sizer se"),Dn=$n(Hn),qn=$n(Hn+"-header"),Pn=$n(Hn+"-body"),Zn=$n(Hn+"-footer"),Un=$n(Hn+"-tool"),Vn=on(e,!1,H.attributes),Yn=$n(Hn+"-description"),Xn=on(),Wn=on(),Kn=on(),Gn=on(),Jn=on(),Qn=on(),et=$n("left","span"),nt=$n("right","span"),tt=0;Mn.i=function(e,n,t){return e=Ge(e).replace(/[\/\s]/g,"-"),Q=Ke(Sn.i,[e,n||e]),t?(un(t),tn(t,Q),t):'<i class="'+Q+'"></i>'},k(H.suffix)||(H.suffix=Le[1]);var st="ui-drop-data",ht=0,ie=0,ue=0,re=0,P=0,mt=0,gt=0,yt={};s.create=function(e,n){if(s.is.create)return s;s.is.create=!0,T(e)&&(H=h(H,e));var t=En(Vn);return tn(Dn,Hn+"-is-can-update"),tn(Dn,Hn+"-is-can-copy"),tn(Vn,In),t&&bn(t,"p")?(wn(t,Dn),tt=t,An(t,!1)):wn(Vn,Dn),Dn.dir=H.direction,Tn(Dn,qn),Tn(Dn,Pn),Tn(Dn,Zn),Tn(Pn,Vn),H.tools&&(Tn(qn,Un),Tn(Zn,Yn),Tn(Yn,et),Tn(Yn,nt)),Ve(de,Vn,pt),Ve(he+" "+oe,Vn,dt),H.resize&&(Tn(Dn,zn),tn(Dn,Hn+"-is-can-resize"),Ve(me,zn,xt),Ve(ge,c,bt),Ve(ye,M,vt)),at(),lt(),0!==n?Ie("create",[s]):s},s.update=function(e,n){return s.is.create&&s.destroy(0),(0!==n?Ie("update",[s]):s).create(e,0)},s.destroy=function(e){return s.is.create?(s.is.create=!1,Mn.exit(0,0,0),un(Vn,In),H.tools=$e(H.tools),H.keys&&(Ye(de,Vn,pt),Ye(he,Vn,dt)),H.resize&&(Ye(me,zn,xt),Ye(ge,c,bt),Ye(ye,c,vt)),tt?(wn(Dn,tt),Tn(tt,Vn),tt=0):wn(Dn,Vn),Nn(Dn),0!==e?Ie("destroy",[s]):s):s},s.enable=function(e){return Vn.disabled=Vn.readOnly=!1,tn(Dn,Hn+"-is-can-update"),tn(Dn,Hn+"-is-can-copy"),0!==e?Ie("enable",[s]):s},s.disable=function(e){return Vn.disabled=!0,un(Dn,Hn+"-is-can-update"),un(Dn,Hn+"-is-can-copy"),0!==e?Ie("disable",[s]):s},s.freeze=function(e){return Vn.disabled=!1,Vn.readOnly=!0,un(Dn,Hn+"-is-can-update"),tn(Dn,Hn+"-is-can-copy"),0!==e?Ie("freeze",[s]):s},Mn.exit=function(e,n,t){if(D={panel:function(){Nn(Xn)},overlay:function(){Ye(ce,Wn,Et),Nn(Wn)},modal:function(){Ye(ce+" "+de,yt.x,Ft),Ye(me,Pn,Ct),Ye(ge,Pn,Lt),Ye(ye,c,Tt),Nn(Kn)},drop:function(){Ye(ce,c,kt),Ye(be,o,kt),Nn(Gn)},bubble:function(){Nn(Jn)}},dt(),n)if(T(n))for(Z in n)Z=n[Z],D[Z]&&D[Z](),0!==t&&Ie("exit."+Z,[s]);else D[n]&&D[n](),0!==t&&Ie("exit."+Z,[s]);else for(Z in D)D[Z]();return e&&s.select(),0!==t&&Ie("exit",[s]),s},Mn.panel=function(e,n,t,r){function i(e){return Ye(ce+" "+de,ie,i),Mn.panel.exit(1),Ue(e)}return Mn.exit(0,0,0),Y=Ge(e),ee=0,r&&(Y+=" "+Y+"--"+Ge(r)),T(n)&&!w(n)&&(ee=$n(Hn+"-panel-header "+Y,0,n.header),n=n.body),ne=$n(Hn+"-panel-body "+Y,0,$n(Hn+"-panel-content "+Y,0,C(n)?"":n)),C(n)&&n(ne),ie=on("a",!1,{href:ke,"class":Hn+"-a "+Hn+"-x "+Y}),ie.title=Bn.close,on(Xn,!1,{"class":Hn+"-panel "+Y}),Ve(ce+" "+de,ie,i),pn(Xn,0),ee&&Tn(Xn,ee),Tn(Pn,on(Xn,[ne,ie])),C(t)?t(Xn):_(t)&&on(Xn,t),B=[s,Xn],r&&Ie("enter.panel."+e+":"+r,B),Ie("enter.panel."+e,B),Ie("enter.panel",B),Ie("enter",B),ie.focus(),s},Mn.panel.fit=function(){},Mn.overlay=function(e,n,t,r){return Mn.exit(0,0,0),Y=Ge(e),r&&(Y+=" "+Y+"--"+Ge(r)),Tn(Pn,on(Wn,!1,{"class":Hn+"-overlay "+Y})),n&&Ve(ce,Wn,Et),C(t)?t(Wn):_(t)&&on(Wn,t),B=[s,Wn],r&&Ie("enter.overlay."+e+":"+r,B),Ie("enter.overlay."+e,B),Ie("enter.overlay",B),Ie("enter",B),s},Mn.overlay.fit=function(){},Mn.message=function(e,n,t,r,i){function f(e){return Ye(ce+" "+de,ie,f),g(u),Mn.overlay.exit(1),Ue(e)}var u;return Y=Ge(e),i&&(Y+=" "+Y+"--"+Ge(i)),ie=on("a",!1,{href:ke,"class":Hn+"-a "+Hn+"-x "+Y}),ie.title=Bn.close,on(Qn,C(n)?n(Qn):n,{"class":Hn+"-message "+Y}),Ve(ce+" "+de,ie,f),Mn.overlay("message message-"+Y,0,function(e){Tn(Qn,ie),t&&(u=y(function(){f()},t)),Tn(e,Qn)},i),C(r)?r(Qn):_(r)&&on(Qn,r),s},Mn.modal=function(){var o,a,e=arguments,n=e[0],t=e[1],r=e[2],i=e[3],u=Hn+"-modal",f=t.footer;if(T(n)&&(n="default",t=e[0],r=e[1],i=e[2]),Mn.overlay(n,1,0,i).blur(),Y=Ge(n),i&&(Y+=" "+Y+"--"+Ge(i)),on(Kn,!1,{"class":u+" "+Y}),k(t.body)&&(t.body=on("div",t.body,{"class":u+"-content "+Y})),k(f)&&T(f)&&!w(f)){a=[];for(Z in f)U=f[Z],w(U)?a.push(U):(U=ft(U,Z,f),V=Z.text||Bn[Z]||Z,o=on("button",V,h({name:"y["+Z+"]",type:"button","class":Hn+"-button",data:{"button-id":Z}},U.attributes)),Ve(ce,o,function(e){return V=f[Pe(this,"button-id")].click(e,s),V===!1?Ue(e):void 0}),a.push(o));t.footer=a}for(Z in t)u[1]=Z,yt[Z]=$n(u+"-"+Ke(Z,u)+" "+Y,0,t[Z]);return yt.x=on("a",!1,{href:ke,"class":Hn+"-a "+Hn+"-x "+Y}),yt.sizer=On,pn(Kn,0),yt.x.title=Bn.close,Tn(Pn,on(Kn,yt,{style:""})),Mn.modal.fit(),Fn(Kn,Wn),Ve(ce+" "+de,yt.x,Ft),Ve(me,yt.header,Ue),Ve(me,yt.sizer,Ue),Ve(me,Pn,Ct),Ve(ge,Pn,Lt),Ve(ye,c,Tt),C(r)&&r(yt),B=[s,Kn,yt],i&&Ie("enter.modal."+n+":"+i,B),Ie("enter.modal."+n,B),Ie("enter.modal",B),Ie("enter",B),yt.x.focus(),s},Mn.modal.fit=function(e){return wt(),Y=mt/2-re/2,ee=gt/2-P/2,T(e)?(k(e[0])&&(Y=e[0]),k(e[1])&&(ee=e[1])):(Y=p(Y,0),ee=p(ee,0)),l(Kn,{left:Y+_e,top:ee+_e,"min-width":re+_e,"min-height":P+_e,visibility:"visible"}),B=[s,Kn,yt],Ie("fit.modal",B),Ie("fit",B),s};var _t={"class":Hn+"-button",name:"y"};return Mn.alert=function(e,n,t,r,i){var u=on("button",Bn.okay,_t),f="alert";return t=t||v,T(e)&&(f+=":"+e[0],e=e[1]||e[0]),Ve(ce,u,function(e){return t(e,s),Ft(e,f+".y")}),Ve(de,u,function(e){var n=e.TE.key;return n(/^(escape|enter)$/)&&Xe(ce,u,[e]),Ue(e)}),Mn.modal(f,At(e,n,u),r,i),u.focus(),s},Mn.confirm=function(e,n,t,r,i,u){function l(e){return C(t)&&t(e,s),Ft(e,c+".y")}function p(e){return C(r)&&r(e,s),Ft(e,c+".n")}var a,f=on("button",Bn.okay,_t),o=on("button",Bn.cancel,_t),c="confirm";return o.name="n",Ve(ce,f,l),Ve(ce,o,p),Ve(de,f,function(e){return a=e.TE.key,a("arrowright")?o.focus():a("enter")?l(e):a("escape")&&Ft(e,c+".y"),Ue(e)}),Ve(de,o,function(e){return a=e.TE.key,a("arrowleft")?f.focus():a("enter")?p(e):a("escape")&&Ft(e,c+".n"),Ue(e)}),Mn.modal(c,At(e,n,[f,o]),i,u),o.focus(),s},Mn.prompt=function(e,n,t,r,i,u,f){function g(){a.focus(),"placeholder"in a&&a.select()}function y(e){return d=a.value,C(t)&&!t(d)?g():!t||x(d)&&d!==n?(Ft(e,l+".y"),r(e,s,d!==n?d:"",n)):g(),Ue(e)}function b(e){return Ft(e,l+".n")}var d,h,m,o=on("button",Bn.okay,_t),c=on("button",Bn.cancel,_t),a=on("input",!1,{type:"text",value:n,placeholder:n,spellcheck:"false","class":Hn+"-input block"}),l="prompt",p=[];if(i=i||0,1===i)a=on("textarea",n,{placeholder:n.split("\n")[0],"class":Hn+"-textarea block",spellcheck:"false"});else if(2===i){for(Z in n)p.push(on("option",n[Z],{value:Z,selected:Z===t||null}));a=on("select",p,{"class":Hn+"-select block"})}return r=r||v,a.name="data",c.name="n",Ve(de,a,function(e){return h=e.TE.key,m=e.TE.control,h("enter")&&0===i||m("enter")?y(e):h("escape")||h("backspace")&&!this.value?b(e):h("arrowdown")&&0===i||h("enter")&&2===i||m("arrowdown")?(o.focus(),Ue(e)):void 0}),Ve(de,o,function(e){return h=e.TE.key,h("enter")?y(e):h("escape")?b(e):h("arrowup")?a.focus():h("arrowright")&&c.focus(),Ue(e)}),Ve(de,c,function(e){return h=e.TE.key,h(/^(enter|escape)$/)?b(e):h("arrowup")?a.focus():h("arrowleft")&&o.focus(),Ue(e)}),Ve(ce,o,y),Ve(ce,c,b),Mn.modal(l,At(e,a,[o,c]),u,f),g(),s},Mn.drop=function(){Mn.exit(0,0,0);var e=arguments,n=e[0],t=e[1],r=e[2];return 1===Se(e)&&(n="default",t=e[0],r=e[1]),Y=Ge(n),pn(Gn,0),Tn(M,on(Gn,!1,{"class":Hn+"-drop "+Y})),C(t)?t(Gn):on(Gn,t),Mn.drop.fit(),r===!1||(Ve(ce,c,kt),Ve(be,o,kt)),B=[s,Gn],Ie("enter.drop."+n,B),Ie("enter.drop",B),s},Mn.drop.fit=function(e){return B=en(N),R=en(Gn),I=Mn.drop.target,Y=B.w/2-R.w/2,ee=B.h/2-R.h/2,!k(e)&&I&&(n=Qe(I),Y=n.l,ee=n.t+en(I).h),T(e)?(k(e[0])&&(Y=e[0]),k(e[1])&&(ee=e[1])):(Y=p(Y,0,B.w-R.w),ee=p(ee,0,Math.max(B.h,en(o).h)-R.h)),l(Gn,{left:Y+_e,top:ee+_e,visibility:"visible"}),B=[s,Gn],Ie("fit.drop",B),Ie("fit",B),s},Mn.menu=function(e,t,r,i){var o,u=Mn.tools,f=0;if(t===!1)return Mn.tool(e,t);for(i in r)re="%"===i[0],o=r[i],o=_(o)&&!re?u[o]:o,o&&(o=ft(o,i,u),r[i]=o);return Mn.tool(e,{i:T(t)?t[0]:0,text:T(t)?t[1]||0:t&&r[t]&&r[t].text||t,click:function(c){var a=Mn.drop.target=u[e].target;return Mn.drop("menu menu-"+Ge(e),function(c){function l(f){return ee=this,n=Pe(ee,"tool-id"),X=r[n],X=_(X)?u[X]:X||{},W=ln(ee),!ut(X)&&C(i=X.click)&&(i=i(f,s),X.i&&(u[e].i=X.i),Mn.menu.set(e,T(X.text)?[X.text[0],n]:T(t)?[t[0],n]:n),i===!1)?(s.select(),Ue(f)):(s.select(),Ue(f))}function p(e){if(ee=this,(V=e.TE.key)("escape"))Mn.exit(1);else if(V("enter"))Xe(ce,ee,[e]);else if(V("f10")&&a)a.focus();else if(V("arrowdown")&&(Y=gn(ee))){for(;!bn(Y,"a")&&Y;)Y=gn(Y);Y&&Y.focus()}else if(V("arrowup")&&(Y=yn(ee))){for(;!bn(Y,"a")&&Y;)Y=yn(Y);!Y&&a?(Mn.exit(),a.focus()):Y&&Y.focus()}else V("arrowup")&&a&&(Mn.exit(),a.focus());return Ue(e)}for(i in r)if(o=r[i],re="%"===i[0],o){var d={href:re?null:ke,"class":Hn+"-"+(re?"label":"button")};re?U=Rn[e]&&Rn[e][+i.slice(1)-1]||i:(d.data={},d.data["tool-id"]=i,U=jn[i]||i),J=o.text,J=T(J)?J[1]||"":J,U=T(U)?U[0]:U,Q=on(re?"span":"a","<span>"+(re?U||"%"+f:J||U)+"</span>",h(d,o.attributes||{})),tn(Q,"menu-"+Ge(i).replace(/[\/\s]/g,"-")),!d.title&&(ee=o.title)&&(Q.title=T(ee)?ee[0]+(ee[1]?" ("+ee[1]+")":""):ee),re?ze(Q,{id:Hn+"-label:"+f}):(ut(o)?tn(Q,"x"):un(Q,"x"),o.on?tn(Q,"on"):un(Q,"on"),Ve(ce,Q,l),Ve(de,Q,p)),Tn(c,Q),++f}y(function(){(vn('[data-tool-id="'+Pe(a,st)+'"]',c)[0]||vn("a",c)[0]).focus()},1)}),!1}},i),qe(u[e].target,{"ui-drop":e}),u[e].data=r,Mn.menu.set(e,t)},Mn.menu.set=function(e,n){var u,f,t=Mn.tools[e]||{},r=t.target,i=t.data;return r?(T(n)?qe(r,st,n[1]||""):(qe(r,st,n),n=i[n]&&i[n].text||n),T(n)?(f=n[0],f=Me(f,"<")?f:Mn.i(f,t.i),n=k(n[1])?n[1]:0,n=n&&i[n]&&i[n].text||n,n=f+(0!==n?"<span>"+(T(n)?n[1]||n:n)+"</span>":"")):f=Mn.i(e,t.i),(u=vn("."+Hn+"-text",r)[0])?(tn(r,"text"),an(u,n)):(un(r,"text"),an(r,f)),s):s},Mn.bubble=function(){Mn.exit(0,0,0);var e=arguments,n=e[0],t=e[1];return 1===Se(e)&&(n="default",t=e[0]),Y=Ge(n),pn(Jn,0),Tn(M,on(Jn,!1,{"class":Hn+"-bubble "+Y})),C(t)?t(Jn):on(Jn,t),Mn.bubble.fit(),B=[s,Jn],Ie("enter.bubble."+n,B),Ie("enter.bubble",B),s},Mn.bubble.fit=function(e){Q=s.$(1),n=Qe(Vn),P=l(Vn,"line-height");var t="border-",r="-width";Y=Q.caret[0].x+n.l-Vn.scrollLeft,ee=Q.caret[1].y+n.t+P-Vn.scrollTop,R=l(Pn,[t+"top"+r,t+"bottom"+r,t+"left"+r,t+"right"+r]);var i=en(Pn),u=en(Jn),f=R[0]+R[1],o=R[2]+R[3];return T(e)?(k(e[0])&&(Y=e[0]),k(e[1])&&(ee=e[1])):(Y=p(Y,n.l,n.l+i.w-u.w-o),ee=p(ee,n.t,n.t+i.h-u.h-f)),l(Jn,{left:Y+_e,top:ee+_e,visibility:"visible"}),B=[s,Jn],Ie("fit.bubble",B),Ie("fit",B),s},Mn.panel.exit=function(e){return Mn.exit(e,"panel")},Mn.overlay.exit=function(e){return Mn.exit(e,"overlay")},Mn.modal.exit=function(e){return Mn.exit(e,"modal")},Mn.drop.exit=function(e){return Mn.exit(e,"drop")},Mn.bubble.exit=function(e){return Mn.exit(e,"bubble")},Mn.tool=function(e,n,t){var r=Mn.tools;return U="",V=k(r[e])?"update":"create","|"!==e&&(H.tools=Ne(H.tools).filter(function(n,t){return n===e?(U=t,!1):!0})),n===!1?(delete r[e],V="destroy"):("|"===e?(t=n,n={}):(C(n)&&(n={click:n}),r[e]=h(r[e]||{},n),k(t)||""===U||(t=U)),L(t)?H.tools.splice(t,0,e):H.tools.push(e)),Ie(V+".tool."+e,[s,r[e]]),at(),s},Mn.separator=function(e,n){return Mn.tool("|",e!==!1?{attributes:e||{}}:!1,n)},Mn.key=function(e,n){var t=Mn.keys;return V=k(t[e])?"update":"create",n===!1?(delete t[e],V="destroy"):t[e]=n,Ie(V+".key."+e,[s,t[e]]),lt(),s},Mn.key.set=function(e){j[e]=1},Mn.key.reset=function(e){e?delete j[e]:j={}},Mn.tools={"|":{},undo:{i:"undo",click:function(e,n){return n.undo(),!1}},redo:{i:"repeat",click:function(e,n){return n.redo(),!1}},indent:function(e,n){return n.indent(Fe),!1},outdent:function(e,n){return n.outdent(Fe),!1}},Mn.keys={"control+y":"redo","control+z":"undo",escape:function(e,n){return J=":not([tabindex]):not([disabled])",(Q=vn("input"+J+",button"+J+",select"+J+",textarea"+J+",a[href]"+J+",[contenteditable]"+J+',[tabindex]:not([tabindex="-1"])',c,0))&&-1!==(ee=Q.indexOf(Vn))?((Q[ee+1]||c).focus(),!1):void 0},f10:function(e,n){return vn("a",Un)[0].focus(),!1},tab:Ee?"indent":0,"shift+tab":Ee?"outdent":0},Mn.el={container:Dn,header:qn,body:Pn,footer:Zn,panel:Xn,overlay:Wn,modal:Kn,drop:Gn,bubble:Jn},s.config=H,h(TE._,{time:function(e){var n=new Date(k(e)?e:Date.now()),t=n.getFullYear(),r=n.getMonth()+1,i=n.getDate(),u=n.getHours(),f=n.getMinutes(),o=n.getSeconds(),c=n.getMilliseconds();return 10>r&&(r="0"+r),10>i&&(i="0"+i),10>u&&(u="0"+u),10>f&&(f="0"+f),10>o&&(o="0"+o),10>c&&(c="0"+c),[""+t,""+r,""+i,""+u,""+f,""+o,""+c]},replace:We,format:Ke,dom:{set:Tn,reset:An,get:vn,id:sn,copy:kn,replace:_n,classes:{set:tn,reset:un,toggle:fn,get:rn},attributes:{set:ze,reset:De,get:Oe},data:{set:qe,reset:Ze,get:Pe},is:bn,offset:Qe,pointer:Je,size:en,content:{set:an,reset:pn,get:ln},closest:nn,parent:dn,children:hn,closest:mn,next:gn,previous:yn,index:xn,before:wn,after:Fn,prepend:Cn,append:Ln},el:on,event:{set:Ve,reset:Ye,fire:Xe,x:Ue}}),h(s._,TE._),h(s._,{hooks:b,hook:{set:Be,reset:Re,fire:Ie}}),s.create()};