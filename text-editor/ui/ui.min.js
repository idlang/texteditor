/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.8
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Ce(e){return g(e)?E(e).split(/\s+/):e}function ve(e){return T(e)?e.join(" "):e}function Ge(e,t,n){return m(e)?m(t)?(m(G[e])||(G[e]={}),m(n)||(n=Object.keys(G[e]).length),G[e][n]=t,a):G[e]:G}function ye(e,t){return m(e)?m(t)&&m(G[e])?(delete G[e][t],a):(G[e]={},a):(G={},a)}function ke(e,t,n){if(!m(G[e]))return G[e]={},a;if(m(n))m(G[e][n])&&G[e][n].apply(a,t);else for(P in G[e])G[e][P].apply(a,t);return a}function He(e,t,n){if(T(t))for(P in t)He(e,P,t[P]);else e.setAttribute(t,n)}function De(t,n,r){if(g(n))return De(t,[n],m(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=t.getAttribute(P))&&e.push(P);return e.length?e:m(r)?r:[]}function we(e,t){if(T(t))for(P in t)we(e,t[P]);else if(m(t))e.removeAttribute(t);else for(we(e,"class"),P=0,W=e.attributes,K=W.length;K>P;++P)W[P]&&we(e,W[P].name)}function Me(e,t,n){if(T(t))for(P in t)Me(e,P,t[P]);else He(e,"data-"+t,n)}function Ue(t,n,r){if(g(n))return Ue(t,[n],m(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=De(t,"data-"+P))&&e.push(P);return e.length?e:m(r)?r:[]}function $e(e,t){if(T(t))for(P in t)we(e,"data-"+t[P]);else if(m(t))we(e,"data-"+t);else for(P=0,W=e.attributes,K=W.length;K>P;++P)W[P]&&"data-"===W[P].name.slice(0,5)&&we(e,W[P].name)}function xe(e){return e&&e.preventDefault(),!1}function Be(e,t,n){if(t){for(e=Ce(e),P=0,W=e.length;W>P;++P)t.addEventListener(e[P],n,!1),Ge("on:"+e[P],n,et(t));return a}}function Pe(e,t,n){if(t){for(e=Ce(e),P=0,W=e.length;W>P;++P)t.removeEventListener(e[P],n,!1),ye("on:"+e[P],et(t));return I(t)&&t.id.split(":")[0]===Tt+"-dom"&&we(t,"id"),a}}function We(e,t,n){e=Ce(e);var i,r="createEvent"in f;for(P=0,W=e.length;W>P;++P)r?(i=f.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[P],!0,!1),t.dispatchEvent(i)):ke("on:"+e[P],n,et(t));return a}function Ke(e,t,n){for(P=0,W=t.length,K;W>P;++P)K=t[P],e=e.replace(N(K)?K:d(u(K),"g"),n&&n[P]||"");return e}function Ye(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,m(t[n])?t[n]:e})}function _e(e){return E(Ke(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ve(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=qe(e);return{x:n-i.l,y:r-i.t}}function qe(e){for(Y=e.offsetLeft,X=e.offsetTop;e=e.offsetParent;)Y+=e.offsetLeft,X+=e.offsetTop;return{l:Y,t:X}}function ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function je(e,t){for(;(e=it(e))&&e!==t;);return e}function Qe(e,t){t=Ce(t);for(P in t)e.classList.add(t[P])}function Xe(t,n,r){if(g(n))return Xe(t,[n],m(r)?r:"")[0];e=[];for(P in n)P=n[P],t.classList.contains(P)&&e.push(P);return e.length?e:m(r)?r:!1}function Je(e,t){if(m(t)){t=Ce(t);for(P in t)e.classList.remove(t[P])}else we(e,"class")}function Ze(e,t,n){if(e=g(e)?f.createElement(e):e,T(n))for(P in n)if(Z=n[P],"classes"===P)Qe(e,Z);else if("data"===P)for(W in Z)Z=Z[W],null===Z?$e(e,W):Me(e,W,Z);else"css"===P?g(Z)?He(e,"style",Z):null===Z?we(e,"style"):A(e,Z):L(Z)?e[P]=Z:null===Z?we(e,P):He(e,P,T(Z)?Z.join(" "):""+Z);if(I(t))Et(e,t);else if(T(t))for(P in t)Z=t[P],I(Z)?Et(e,Z):Z!==!1&&tt(e,Z);else m(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=Tt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(m(t)?t:"")}function rt(e,t){if(t!==!1&&(w=ot(e)))for(P=0,W=w.length;W>P;++P)rt(w[P]);tt(e,"")}function it(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function ft(e){return e&&e.previousSibling}function at(e,t){return e&&g(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&L(t)?e===t(e):e===t}function st(t,n){if(n=n||f,e=[],g(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(P=0,W=t.length;W>P;++P)e.push(t[P]);return e}return[]}for(t=n.querySelectorAll(t),P=0,W=t.length;W>P;++P)e.push(t[P]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=it(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){q=it(e),q&&q.insertBefore(t,e)}function At(e,t){q=it(e),q&&q.insertBefore(t,lt(e))}function pt(e,t){w=ot(e)[0],w?ct(w,t):Et(e,t)}function dt(e,t){Et(e,t)}function Et(e,t){e.appendChild(t)}function ht(e,t){var n=ut(e);if(n){if(t!==!1)for(w=ot(e)[0];w;)ht(w);n.removeChild(e)}}function Ot(e){rt(Ze(e,!1,{style:""})),ht(e)}function Rt(e,t,n){return Ze(t||"div",n,{"class":e})}function qt(e){return!e||m(e.active)&&!Q.active}function zt(){St._word&&St._words&&(Z=(Ht.value||"").replace(d(Ne[0]+"[^"+Ne[0]+Ne[1]+"]+?"+Ne[1],"g"),""),P=(Z.match(/(\w+)/g)||[]).length,tt(Pt,Ye(St["_word"+(1===P?"":"s")],[P])))}function jt(e,t,n){return L(e)&&(e={click:e}),g(e.click)&&(e.click=(n[e.click]||{}).click),m(e.title)||(e.title=Nt[t]||""),n[t]=e,e}function Qt(e){It.exit(0,0,0);var t=Ue(this,me),n=It.tools,r=n[t];return Yt=e.currentTarget||e.target,!qt(r)&&L(W=r.click)&&(W=W(e,a,t),ke("on:change",[e,a,t]),W===!1)?xe(e):(a.select(),xe(e))}function Xt(e){if(X=this,(K=e.TE.key)(/^(escape|f10)$/))It.exit(1);else if(K("enter"))Yt=X,We(Ae,X,[e]);else if(K("arrowright")&&(Y=lt(X))){for(;!at(Y,"a")&&Y;)Y=lt(Y);Y&&Y.focus()}else if(K("arrowleft")&&(Y=ft(X))){for(;!at(Y,"a")&&Y;)Y=ft(Y);Y&&Y.focus()}return xe(e)}function Jt(){rt(kt,!1);var r,i,o,l,f,s,u,e=Ce(k.tools),t=Tt+"-button",n=Tt+"-separator";k.tools=e;for(s in e)u=e[s],i=It.tools[u],(i||i==={})&&(i=jt(i,u,It.tools),o=i.i||u,"|"!==o&&"<"!==o[0]&&(o=_e(o)),l="|"!==o,f=_e(o).replace(/\s/g,""),_t=Rt(l?t+" "+t+"-"+f:n+" "+n+"-"+s,l?"a":"span"),l?(r=t+":"+f,He(_t,{href:Se,id:r,tabindex:-1}),Me(_t,me,u),o="<"===o[0]?o:'<i class="'+Ye(bt,[o])+'"></i>',qt(i)&&Qe(_t,"x"),i.text&&(o=Ye('<span class="'+Tt+'-text">'+i.text+"</span>",[o]),Qe(_t,"text")),tt(_t,o),Ze(_t,!1,i.attributes||{}),!_t.title&&(W=i.title)&&(_t.title=T(W)?W[0]+(W[1]?" ("+W[1]+")":""):W),Be(Ae,_t,Qt),Be(ie,_t,Xt)):_t.id=n+":"+s,It.tools[u].target=_t,Et(kt,_t));ke("update.tools",[a])}function Zt(){It.keys=function(){var n,e=Object.keys(It.keys).sort().reverse(),t={};for(P=0,W=e.length;W>P;++P)n=e[P],t[n]=It.keys[n];return t}(),on(1),ke("update.keys",[a])}function en(e){zt(),ke("on:change",[e,a])}function rn(t){function p(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=a.$(),r=n.before,i=n.after,o=r.slice(-1),l=i[0],f=n.length,s=It.keys,c=TE.keys_alias,A=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();V=t.TE.key(),tn[V]=1,e=Object.keys(tn).length,h(function(){a.record()},1);for(P in s){K=p(P),w=0;for(W in K)W=K[W],tn[c[W]||W]&&++w;if(K=K.length,w===K&&e===K&&(g(s[P])&&(s[P]=It.tools[s[P]].click),Y=s[P]&&s[P](t,a),Y===!1))return xe(t)}if(Le)for(P in Le)if(_=Le[P],_!==!1){if(V===_&&l===_)return"\\"===o?(a.insert(V,0),xe(t)):(a.select(n.end+1),xe(t));if(P===V)return a.wrap(P,_),xe(t);if(o===P&&l===_){if("backspace"===V&&r.slice(-2)!=="\\"+P)return a.unwrap(P,_),xe(t);if(Ie&&"enter"===V&&P!==_)return a.tidy("\n"+A+Re,"\n"+A),xe(t)}}if(Ie&&!f){if("backspace"===V&&d(u(Re)+"$").test(r))return a.outdent(Re),xe(t);if("enter"===V&&d("(^|\\n)("+u(Re)+")+.*$").test(r))return a.insert("\n"+A,0,1),xe(t)}}function on(e){T(e)?delete tn[e.TE.key()]:tn={}}function ln(e){/^(focus|blur)$/.test(e.type)&&on(1),O(nn),nn=h(function(){en(e)},k.debounce||0)}function cn(e){return fn=Dt,Q=ze(yt),xe(e)}function An(e){fn===Dt&&A(Ht,{height:Ve(Gt,e).y-Q.h+Fe})}function pn(){fn=0}function dn(){It.exit(1)}function En(){e=ze(Ut),ee=e.w,B=e.h,e=ze(Mt),an=e.w,sn=e.h}function hn(e,t){t&&ke("exit.modal."+t,[a]),We(Ae,Mt,[e])}function On(t){fn=t.target,e=Ve(Ut,t),te=e.x,ne=e.y,En()}function Rn(t){var n=un.header,r=un.resize;fn===n||je(fn,n)===n?(e=Ve(Gt,t),Y=e.x-te,X=e.y-ne,A(Ut,{left:(ee>an?Y:p(Y,0,an-ee))+Fe,top:(B>sn?X:p(X,0,sn-B))+Fe})):fn===r&&(e=Ve(Ut,t),Q=ze(r),A(Ut,{width:e.x+Q.w/4+Fe,height:e.y+Q.h/4+Fe}))}function In(){fn=0}function Ln(e,t,n){return{header:e,body:t,footer:n}}function bn(e){H=Yt,D=$t,w=e&&e.target||0,(!w||w!==H&&je(w,H)!==H)&&(Yt=0,Ot($t),Pe(Ae,f,bn),Pe(Ee,l,bn),It.exit(e.target===v))}function Nn(t){function i(){e&&(q=ze(e),A(j,{width:q.w+Fe,height:q.h+Fe}))}var n=a.get(),r="";return-1===n.indexOf("</html>")&&(r='<!DOCTYPE html><html dir="'+k.dir+'"><head><meta charset="utf-8"><style>'+k.css+"</style></head><body>"+n+"</body></html>"),j=Ze("iframe",!1,{"class":Tt+"-portal",src:"data:text/html,"+encodeURIComponent(r)}),!ut(Mt)&&n?It.overlay(j,1,function(){e=ot(Mt)[0],i(),Be(Ee,l,i),ke("enter.overlay.preview",[t,a,[n,r],e])}):(Pe(Ee,l,i),dn()),xe(t)}var H,D,w,U,$,B,P,W,K,Y,_,V,e,q,j,Q,X,Z,ee,te,ne,t="⌘",n="…",i="⇥",o="⇧",l=window,f=document,a=this,s=a._,u=s.x,c=s.extend,A=s.css,p=s.edge,d=s.pattern,E=s.trim,h=s.timer.set,O=s.timer.reset,R=a.is,I=R.e,L=R.f,b=R.i,T=R.o,N=R.r,g=R.s,m=function(e){return!R.x(e)},S=f.documentElement,C=(f.head,f.body),v=a.target,G={},y=function(){},k=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",oe="keyup",le="copy",fe="cut",ae="paste",se="touchstart mousedown",ue="touchend mouseup",ce="touchmove mousemove",Ae="click",pe="focus",de="blur",Ee="orientationchange resize",he=de+" "+le+" "+fe+" "+pe+" input "+ie+" "+ae,Oe=k.languages,Re=k.tab,Ie=k.auto_tab,Le=k.auto_close,be=k.unit[0][0],Ne=(k.unit[0][1],k.unit[1][0]),ge=k.unit[1][1],me="tool-id",Se="javascript:;",Fe="px",It=a.ui={};a.tidy=function(e,t){var n=a.$(),r=E(n.before)?e:"",i=E(n.after)?m(t)?t:e:"";return a.trim(r,i)},a.i=function(){return E(a.replace(/\s+/g," "))},a.format=function(e,t,n,r){T(e)||(e=[e]),m(n)||(n=" "),m(r)||(r="");var i=a.h,o=a[0]().$(),l=(e[0]?be[0]+e[0]+be[1]:"")+r,f=r+(e[0]?be[0]+be[2]+(e[1]||e[0].split(d("("+ge[3]+")+"))[0])+be[1]:""),s=u(l),c=u(f),A=d("^"+s+"([\\s\\S]*?)"+c+"$"),p=d(s+"$"),E=d("^"+c),h=o.before,O=o.after;return o.length?n=!1:a.insert(Oe.placeholders[""]),a.toggle(t?!A.test(o.value):!p.test(h)&&!E.test(O),[function(e){e.unwrap(l,f,1).tidy(d(Ne[0]+"[^"+Ne[0]+Ne[1]+Ne[2]+"]+?"+Ne[1]+"$").test(h)?"":n,d("^"+Ne[0]+Ne[2]+"[^"+Ne[0]+Ne[1]+"]+?"+Ne[1]).test(O)?"":n).wrap(l,f,t)},function(e){e.unwrap(l,f,t)}])[i]()};var _t,Lt=k.classes,bt=Lt.i,Tt=Lt[""],Nt=Oe.tools,gt=Oe.buttons,mt=Oe.labels,St=Oe.others,Ft=Tt+"-textarea "+Tt+"-content block",Ct=Rt(Tt),vt=Rt(Tt+"-header"),Gt=Rt(Tt+"-body"),yt=Rt(Tt+"-footer"),kt=Rt(Tt+"-tool"),Ht=Ze(v,!1,k.attributes),Dt=Rt(Tt+"-resize s"),wt=Rt(Tt+"-description"),Mt=Rt(Tt+"-overlay"),Ut=Ze("div"),$t=Ze("div"),xt=Ze("div"),Bt=Rt("left","span"),Pt=Rt("right","span"),Wt=Rt(Tt+"-preview","a"),Kt=0,Yt=0;k.suffix||(k.suffix=be[1]);var tn={},nn=null;a.create=function(e,t){T(e)&&(k=c(k,e));var n=ut(Ht);return Qe(Ht,Ft),n&&at(n,"p")?(ct(n,Ct),Kt=n,ht(n,!1)):ct(Ht,Ct),Ct.dir=k.dir,Et(Ct,vt),Et(Ct,Gt),Et(Ct,yt),Et(Ct,Dt),Et(Gt,Ht),k.tools&&(Et(vt,kt),Et(yt,wt),Et(wt,Bt),Et(wt,Pt)),Be(ie,Ht,rn),Be(oe,Ht,on),Be(he,Ht,ln),Be(se,Dt,cn),Be(ce,f,An),Be(ue,C,pn),St.preview&&(Q=Nt.preview,He(Wt,{href:Se,title:T(Q)?Q[0]+(Q[1]?" ("+Q[1]+")":""):Q}),Et(Bt,Wt),tt(Wt,St.preview)),en(null),Jt(),Zt(),0!==t?ke("create",[a]):a},a.update=function(e,t){return Xe(Ht,Ce(Ft),0)&&a.destroy(0),(0!==t?ke("update",[a]):a).create(e,0)},a.destroy=function(e){return Xe(Ht,Ce(Ft),0)?(It.exit(0,0,0),Je(Ht,Ft),k.tools=ve(k.tools),k.keys&&(Pe(ie,Ht,rn),Pe(oe,Ht,on)),Pe(se,Dt,cn),Pe(ce,f,An),Pe(ue,f,pn),Pe(he,Ht,ln),Kt?(ct(Ct,Kt),Et(Kt,Ht),Kt=0):ct(Ct,Ht),Ot(Ct),0!==e?ke("destroy",[a]):a):a};var fn=0,te=0,ne=0,ee=0,B=0,an=0,sn=0,un={};It.exit=function(e,t,n){if($={overlay:function(){Pe(Ae,Mt,dn),Ot(Mt)},modal:function(){Pe(se,Gt,On),Pe(ce,Gt,Rn),Pe(ue,f,In),Pe(Ae,un.x,hn),Ot(Ut)},drop:function(){Ot($t)},bubble:function(){Ot(xt)}},t)if(T(t))for(P in t)P=t[P],$[P]&&$[P](),0!==n&&ke("exit."+P,[a]);else $[t]&&$[t](),0!==n&&ke("exit."+P,[a]);else for(P in $)$[P]();return e&&a.select(),0!==n&&ke("exit",[a]),a},It.overlay=function(e,t,n){return It.exit(0,0,0),on(1),Et(Gt,Ze(Mt,e.length||I(e)?Rt(Tt+"-overlay-content","div",e):"")),t&&Be(Ae,Mt,dn),L(n)?n(Mt):Ze(Mt,n),ke("enter.overlay",[a]),ke("enter",[a]),a},It.overlay.fit=function(){},It.modal=function(){It.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=Tt+"-modal";T(t)&&(t="default",n=e[0],r=e[1]),Y=_e(t),Ze(Ut,!1,{"class":i+" "+Y}),m(n.body)&&(n.body=Ze("div",n.body,{"class":i+"-content "+Y}));for(P in n)i[1]=P,un[P]=Rt(i+"-"+Ye(P,i)+" "+Y,0,n[P]);return un.x=Rt(Tt+"-x "+Y),un.resize=Rt(Tt+"-resize se "+Y),rt(Ut),Et(Gt,Ze(Ut,un,{style:""})),It.modal.fit(),At(Ut,Mt),Be(Ae,un.x,hn),Be(se,un.header,xe),Be(se,un.resize,xe),Be(se,Gt,On),Be(ce,Gt,Rn),Be(ue,f,In),L(r)&&(un.overlay=Mt,un.modal=Ut,r(un)),ke("enter.modal."+t,[a]),ke("enter.modal",[a]),ke("enter",[a]),a},It.modal.fit=function(e){return En(),Y=an/2-ee/2,X=sn/2-B/2,T(e)?(m(e[0])&&(Y=e[0]),m(e[1])&&(X=e[1])):(Y=p(Y,0),X=p(X,0)),A(Ut,{left:Y+Fe,top:X+Fe,"min-width":ee+Fe,"min-height":B+Fe,visibility:"visible"}),ke("fit.modal",[a]),ke("fit",[a]),a};var Tn={"class":Tt+"-button",name:"y"};return It.alert=function(e,t,n,r){var i=Ze("button",gt.okay,Tn),o="alert";return n=n||y,T(e)&&(o+=":"+e[0],e=e[1]||e[0]),Be(Ae,i,function(e){return n(e,a),hn(e,o+".y"),xe(e)}),Be(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(We(Ae,i,[e]),xe(e)):void 0}),It.modal(o,Ln(e,t,i),r),i.focus(),a},It.confirm=function(e,t,n,r,i){function u(e){return L(n)&&n(e,a),hn(e,f+".y"),xe(e)}function c(e){return L(r)&&r(e,a),hn(e,f+".n"),xe(e)}var s,o=Ze("button",gt.okay,Tn),l=Ze("button",gt.cancel,Tn),f="confirm";return l.name="n",T(e)&&(f+=":"+e[0],e=e[1]||e[0]),Be(Ae,o,u),Be(Ae,l,c),Be(ie,o,function(e){return s=e.TE.key,s("arrowright")?(l.focus(),xe(e)):s("arrowleft")?xe(e):s("enter")?(u(e),xe(e)):s("escape")?(hn(e,f+".y"),xe(e)):void 0}),Be(ie,l,function(e){return s=e.TE.key,s("arrowright")?xe(e):s("arrowleft")?(o.focus(),xe(e)):s("enter")?(c(e),xe(e)):s("escape")?(hn(e,f+".n"),xe(e)):void 0}),It.modal(f,Ln(e,t,[o,l]),i),l.focus(),a},It.prompt=function(e,t,n,r,i,o){function d(){s.focus(),"placeholder"in s&&s.select()}function h(e){return xe(e)}function O(e){return A=s.value,!n||E(A)&&A!==t?(hn(e,u+".y"),xe(e),r(e,a,A!==t?A:"",t)):(d(),h(e))}function R(e){return hn(e,u+".n"),xe(e)}var A,p,l=Ze("button",gt.okay,Tn),f=Ze("button",gt.cancel,Tn),s=Ze("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Tt+"-input block"}),u="prompt",c=[];if(T(e)&&(u+=":"+e[0],e=e[1]||e[0]),L(i)&&(o=i,i=0),1===i)s=Ze("textarea",t,{placeholder:t.split("\n")[0],"class":Tt+"-textarea block"});else if(2===i){for(P in t)c.push(Ze("option",t[P],{value:P,selected:P===n||null}));s=Ze("select",c,{"class":Tt+"-select block"})}return r=r||y,s.name="data",f.name="n",Be(ie,s,function(e){return p=e.TE.key,p("enter")?O(e):p("escape")||p("backspace")&&!this.value?R(e):p("arrowup")?h(e):p("arrowdown")?(l.focus(),xe(e)):void 0}),Be(ie,l,function(e){return p=e.TE.key,p("enter")?O(e):p("escape")?R(e):p("arrowup")?(s.focus(),xe(e)):p("arrowright")?(f.focus(),xe(e)):p(/^arrow(down|left)$/)?h(e):void 0}),Be(ie,f,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?R(e):p("arrowup")?(s.focus(),xe(e)):p(/^arrow(right|down)$/)?h(e):p("arrowleft")?(l.focus(),xe(e)):void 0}),Be(Ae,l,O),Be(Ae,f,R),It.modal(u,Ln(e,s,[l,f]),o),d(),a},It.drop=function(){It.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),Y=_e(t),rt($t),Et(C,Ze($t,!1,{"class":Tt+"-drop "+Y})),L(n)?n($t):Ze($t,n),It.drop.fit(),Be(Ae,f,bn),Be(Ee,l,bn),ke("enter.drop."+t,[a]),ke("enter.drop",[a]),a},It.drop.fit=function(t){return H=ze(S),D=ze($t),Y=H.w/2-D.w/2,X=H.h/2-D.h/2,!m(t)&&Yt&&(e=qe(Yt),Y=e.l,X=e.t+ze(Yt).h),T(t)?(m(t[0])&&(Y=t[0]),m(t[1])&&(X=t[1])):(Y=p(Y,0,Math.max(H.w,l.innerWidth)-D.w),X=p(X,0,Math.max(H.h,l.innerHeight)-D.h)),A($t,{left:Y+Fe,top:X+Fe,visibility:"visible"}),ke("fit.drop",[a]),ke("fit",[a]),a},It.menu=function(e,t,n,r){t=!T(t)&&n[t]&&n[t].text||t;var s,i=It.tools,o='<span class="'+Tt+'-current menu">%1</span>',l="",f=0;return t===!1?It.tool(e,t):(T(t)&&(l=t[0],l="<"===l[0]?l:'<i class="'+Ye(bt,[l])+'"></i>',t=m(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,o=l+(0!==t?" "+o:"")),It.tool(e,{i:l,text:t?Ye(o,[t,l]):0,click:function(u){return It.drop("menu menu-"+_e(e),function(u){function A(e){return X=this,_=n[Ue(X,me)],_=g(_)?i[_]:_||{},V=nt(X),!qt(_)&&L(r=_.click)&&(r=r(e,a),t!==!1&&Yt&&(w=ot(Yt)[0]||Yt,at(w,"i")||tt(w,Ye(o,[V,l])),T(_.text)&&(w=ot(w)[0])&&at(w,"i")&&(Je(w),Qe(w,Ye(bt,[_.text[0]])))),r===!1)?xe(e):(a.select(),xe(e))}function p(e){if(X=this,(K=e.TE.key)("escape"))It.exit(1);else if(K("enter"))We(Ae,X,[e]);else if(K("f10")&&Yt)Yt.focus();else if(K("arrowdown")&&(Y=lt(X))){for(;!at(Y,"a")&&Y;)Y=lt(Y);Y&&Y.focus()}else if(K("arrowup")&&(Y=ft(X))){for(;!at(Y,"a")&&Y;)Y=ft(Y);!Y&&Yt?(It.exit(),Yt.focus()):Y&&Y.focus()}else K("arrowup")&&Yt&&(It.exit(),Yt.focus());return xe(e)}for(r in n)if(s=n[r],ee="%"===r[0],s=g(s)&&!ee?i[s]:s){s=jt(s,r,i);var d={href:ee?null:Se,"class":Tt+"-"+(ee?"label":"button")};ee?W=mt[e]&&mt[e][+r.slice(1)-1]||r:(d.data={},d.data[me]=r,W=Nt[r]||r),j=s.text,j=T(j)?j[1]||"":j,W=T(W)?W[0]:W,Q=Ze(ee?"span":"a",ee?"<span>"+(W||"%"+f)+"</span>":s.text||W,c(d,s.attributes||{})),!Q.title&&(X=s.title)&&(Q.title=T(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),ee?He(Q,{id:Tt+"-label:"+f}):(qt(s)&&Qe(Q,"x"),Be(Ae,Q,A),Be(ie,Q,p)),n[r]=s,Et(u,Q),++f}h(function(){st("a",u)[0].focus()},1)}),!1}},r),Be(ie,i[e].target,function(t){return t.TE.key("arrowdown")?(Yt=this,i[e].click(U,a),xe(t)):void 0}),i[e].data=n,a)},It.bubble=function(){It.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),Y=_e(t),rt(xt),Et(C,Ze(xt,!1,{"class":Tt+"-bubble "+Y})),L(n)?n(xt):Ze(xt,n),It.bubble.fit(),ke("enter.bubble."+t,[a]),ke("enter.bubble",[a]),a},It.bubble.fit=function(t){Q=a.$(1),e=qe(Ht),B=A(Ht,"line-height");var n="border-",r="-width";Y=Q.caret[0].x+e.l-Ht.scrollLeft,X=Q.caret[1].y+e.t+B-Ht.scrollTop,D=A(Gt,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=ze(Gt),o=ze(xt),l=D[0]+D[1],f=D[2]+D[3];return T(t)?(m(t[0])&&(Y=t[0]),m(t[1])&&(X=t[1])):(Y=p(Y,e.l,e.l+i.w-o.w-f),X=p(X,e.t,e.t+i.h-o.h-l)),A(xt,{left:Y+Fe,top:X+Fe,visibility:"visible"}),ke("fit.bubble",[a]),ke("fit",[a]),a},It.overlay.exit=function(e){return It.exit(e,"overlay")},It.modal.exit=function(e){return It.exit(e,"modal")},It.drop.exit=function(e){return It.exit(e,"drop")},It.bubble.exit=function(e){return It.exit(e,"bubble")},It.tool=function(e,t,n){return W="","|"!==e&&(k.tools=k.tools.filter(function(t,n){return t===e?(W=n,!1):!0})),t===!1?delete It.tools[e]:("|"===e?(n=t,t={}):(L(t)&&(t={click:t}),It.tools[e]=c(It.tools[e]||{},t),m(n)||""===W||(n=W)),b(n)?k.tools.splice(n,0,e):k.tools.push(e)),Jt(),a},It.key=function(e,t){return k.keys?(t===!1?delete It.keys[e]:It.keys[e]=t,Zt(),a):a},It.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Re),!1},outdent:function(e,t){return t.outdent(Re),!1}},Be(Ae,Wt,Nn),It.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Nn(e)},f10:function(e,t){return st("a",kt)[0].focus(),!1},"shift+tab":Ie?"outdent":0,tab:Ie?"indent":0,escape:function(e,t){return Wt.focus(),!1}},It.el={container:Ct,header:vt,body:Gt,footer:yt,overlay:Mt,modal:Ut,drop:$t,bubble:xt},a.config=k,c(a._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=e.getSeconds(),f=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>l&&(l="0"+l),10>f&&(f="0"+f),[""+t,""+n,""+r,""+i,""+o,""+l,""+f]},replace:Ke,format:Ye,dom:{set:Et,reset:ht,get:st,id:et,copy:function(e,t){return e.cloneNode(m(t)?t:!0)},classes:{set:Qe,reset:Je,get:Xe},attributes:{set:He,reset:we,get:De},data:{set:Me,reset:$e,get:Ue},is:at,offset:qe,point:Ve,size:ze,content:{set:tt,reset:rt,get:nt},closest:je,parent:it,children:ot,next:lt,previous:ft,before:ct,after:At,prepend:pt,append:dt},el:Ze,event:{set:Be,reset:Pe,fire:We,x:xe},hooks:G,hook:{set:Ge,reset:ye,fire:ke}}),It};