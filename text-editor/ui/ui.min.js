/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function pe(e){return d(e)?R(e).split(/\s+/):e}function He(e){return T(e)?e.join(" "):e}function De(e,t,n){return C(e)?C(t)?(C(H[e])||(H[e]={}),C(n)||(n=Object.keys(H[e]).length),H[e][n]=t,f):H[e]:H}function Me(e,t){return C(e)?C(t)&&C(H[e])?(delete H[e][t],f):(H[e]={},f):(H={},f)}function Be(e,t,n){if(!C(H[e]))return H[e]={},f;if(C(n))C(H[e][n])&&H[e][n].apply(f,t);else for(k in H[e])H[e][k].apply(f,t);return f}function me(e,t,n){if(T(t))for(k in t)me(e,k,t[k]);else e.setAttribute(t,n)}function We(t,n,r){if(d(n))return We(t,[n],C(r)?r:"")[0];e=[];for(k in n)k=n[k],(k=t.getAttribute(k))&&e.push(k);return e.length?e:C(r)?r:[]}function Pe(e,t){if(T(t))for(k in t)Pe(e,t[k]);else if(C(t))e.removeAttribute(t);else for(Pe(e,"class"),k=0,w=e.attributes,K=w.length;K>k;++k)w[k]&&Pe(e,w[k].name)}function be(e,t,n){if(T(t))for(k in t)be(e,k,t[k]);else me(e,"data-"+t,n)}function ye(t,n,r){if(d(n))return ye(t,[n],C(r)?r:"")[0];e=[];for(k in n)k=n[k],(k=We(t,"data-"+k))&&e.push(k);return e.length?e:C(r)?r:[]}function Ue(e,t){if(T(t))for(k in t)Pe(e,"data-"+t[k]);else if(C(t))Pe(e,"data-"+t);else for(k=0,w=e.attributes,K=w.length;K>k;++k)w[k]&&"data-"===w[k].name.slice(0,5)&&Pe(e,w[k].name)}function ve(e){return e&&e.preventDefault(),!1}function ke(e,t,n){if(t){for(e=pe(e),k=0,w=e.length;w>k;++k)t.addEventListener(e[k],n,!1),De("on:"+e[k],n,tt(t));return f}}function we(e,t,n){if(t){for(e=pe(e),k=0,w=e.length;w>k;++k)t.removeEventListener(e[k],n,!1),Me("on:"+e[k],tt(t));return L(t)&&t.id.split(":")[0]===Ct+"-dom"&&Pe(t,"id"),f}}function Ke(e,t,n){e=pe(e);var i,r="createEvent"in l;for(k=0,w=e.length;w>k;++k)r?(i=l.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[k],!0,!1),t.dispatchEvent(i)):Be("on:"+e[k],n,tt(t));return f}function Ye(e,t){return setTimeout(e,t)}function xe(e){return clearTimeout(e)}function Ve(e,t,n){for(k=0,w=t.length,K;w>k;++k)K=t[k],e=e.replace(N(K)?K:O(u(K),"g"),n&&n[k]||"");return e}function $e(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,C(t[n])?t[n]:e})}function _e(e){return R(Ve(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Qe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=Je(e);return{x:n-i.l,y:r-i.t}}function Je(e){for(Y=e.offsetLeft,z=e.offsetTop;e=e.offsetParent;)Y+=e.offsetLeft,z+=e.offsetTop;return{l:Y,t:z}}function ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Xe(e,t){for(;(e=ot(e))&&e!==t;);return e}function je(e,t){t=pe(t);for(k in t)e.classList.add(t[k])}function qe(t,n,r){if(d(n))return qe(t,[n],C(r)?r:"")[0];e=[];for(k in n)k=n[k],t.classList.contains(k)&&e.push(k);return e.length?e:C(r)?r:!1}function Ze(e,t){if(C(t)){t=pe(t);for(k in t)e.classList.remove(t[k])}else Pe(e,"class")}function et(e,t,n){if(e=d(e)?l.createElement(e):e,T(n))for(k in n)if(j=n[k],"classes"===k)je(e,j);else if("data"===k)for(w in j)j=j[w],null===j?Ue(e,w):be(e,w,j);else"css"===k?d(j)?me(e,"style",j):null===j?Pe(e,"style"):E(e,j):F(j)?e[k]=j:null===j?Pe(e,k):me(e,k,T(j)?j.join(" "):""+j);if(L(t))It(e,t);else if(T(t))for(k in t)j=t[k],L(j)?It(e,j):j!==!1&&nt(e,j);else C(t)&&t!==!1&&nt(e,t);return e}function tt(e){var t=e.id;return t||(t=Ct+"-dom:"+Date.now(),e.id=t),t}function nt(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(C(t)?t:"")}function it(e,t){if(t!==!1&&(W=at(e)))for(k=0,w=W.length;w>k;++k)it(W[k]);nt(e,"")}function ot(e){return e.parentNode}function at(e){return e.children||[]}function lt(e){return e.nextSibling}function ft(e){return e.previousSibling}function At(e,t){return d(t)?e.nodeName.toLowerCase()===t.toLowerCase():F(t)?e===t(e):e===t}function ut(t,n){if(n=n||l,e=[],d(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(k=0,w=t.length;w>k;++k)e.push(t[k]);return e}return[]}for(t=n.querySelectorAll(t),k=0,w=t.length;w>k;++k)e.push(t[k]);return e}return st(t)?[t]:[]}function st(e,t){var n=ot(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function Et(e,t){$=ot(e),$&&$.insertBefore(t,e)}function ct(e,t){$=ot(e),$&&$.insertBefore(t,lt(e))}function Ot(e,t){W=at(e)[0],W?Et(W,t):It(e,t)}function Rt(e,t){It(e,t)}function It(e,t){e.appendChild(t)}function Lt(e,t){var n=st(e);if(n){if(t!==!1)for(W=at(e)[0];W;)Lt(W);n.removeChild(e)}}function Ft(e){it(et(e,!1,{style:""})),Lt(e)}function St(e,t,n){return et(t||"div",n,{"class":e})}function Jt(e){return!e||C(e.active)&&!J.active}function zt(){pt._word&&pt._words&&(j=(Pt.value||"").replace(O(de[0]+"[^"+de[0]+de[1]+"]+?"+de[1],"g"),""),k=(j.match(/(\w+)/g)||[]).length,nt(Yt,$e(pt["_word"+(1===k?"":"s")],[k])))}function Xt(e,t,n){return F(e)&&(e={click:e}),d(e.click)&&(e.click=(n[e.click]||{}).click),C(e.title)||(e.title=gt[t]||""),n[t]=e,e}function jt(){it(Wt,!1);var r,i,o,a,l,A,e=pe(M.tools),t=Ct+"-button",n=Ct+"-separator";M.tools=e;for(l in e)A=e[l],i=Tt.tools[A],i&&(i=Xt(i,A,Tt.tools),o=i.i||A,"|"!==o&&"<"!==o[0]&&(o=_e(o)),a="|"!==o,_t=St(a?t:n,a?"a":"span"),a?(r=t+":"+_e(A).replace(/\s/g,""),me(_t,{href:he,id:r,tabindex:-1}),be(_t,ge,A),o="<"===o[0]?o:'<i class="'+$e(dt,[o])+" "+r+'"></i>',Jt(i)&&je(_t,"x"),i.text&&(o=$e('<span class="'+Ct+'-text">'+i.text+"</span>",[o]),je(_t,"text")),nt(_t,o),et(_t,!1,i.attributes||{}),!_t.title&&(w=i.title)&&(_t.title=T(w)?w[0]+(w[1]?" ("+w[1]+")":""):w),Tt.tools[A].target=_t,ke(ue,_t,an)):_t.id=Ct+"-separator:"+l,It(Wt,_t));Be("update.tools",[f])}function qt(){Tt.keys=function(){var n,e=Object.keys(Tt.keys).sort().reverse(),t={};for(k=0,w=e.length;w>k;++k)n=e[k],t[n]=Tt.keys[n];return t}(),rn(1),Be("update.keys",[f])}function Zt(e){zt(),Be("on:change",[e,f])}function nn(t){function c(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=f.$(),r=n.before,i=n.after,o=r.slice(-1),a=i[0],l=n.length,A=Tt.keys,s=TE.keys_alias,E=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();V=t.TE.key(),en[V]=1,e=Object.keys(en).length,Ye(function(){f.record()},1);for(k in A){K=c(k),W=0;for(w in K)w=K[w],en[s[w]||w]&&++W;if(K=K.length,W===K&&e===K&&(d(A[k])&&(A[k]=Tt.tools[A[k]].click),Y=A[k]&&A[k](t,f),Y===!1))return ve(t)}if(Se)for(k in Se)if(x=Se[k],x!==!1){if(V===x&&a===x)return"\\"===o?(f.insert(V,0),ve(t)):(f.select(n.end+1),ve(t));if(k===V)return f.wrap(k,x),ve(t);if(o===k&&a===x){if("backspace"===V&&r.slice(-2)!=="\\"+k)return f.unwrap(k,x),ve(t);if(Fe&&"enter"===V&&k!==x)return f.tidy("\n"+E+Le,"\n"+E).scroll(!0),ve(t)}}if(Fe&&!l){if("backspace"===V&&O(u(Le)+"$").test(r))return f.outdent(Le).scroll(!0),ve(t);if("enter"===V&&O("(^|\\n)("+u(Le)+")+.*$").test(r))return f.insert("\n"+E,0,1).scroll(!0),ve(t)}}function rn(e){T(e)?delete en[e.TE.key()]:en={}}function on(e){/^focus|blur$/.test(e.type)&&rn(1),xe(tn),tn=Ye(function(){Zt(e)},M.debounce||0)}function an(e){Tt.exit(0,0,0);var t=ye(this,ge),n=Tt.tools,r=n[t];return $t=e.currentTarget||e.target,!Jt(r)&&F(w=r.click)&&(w=w(e,f,t),Be("on:change",[e,f,t]),w===!1)?ve(e):(f.select(),ve(e))}function sn(e){return ln=bt,J=ze(mt),ve(e)}function En(e){ln===bt&&E(Pt,{height:Qe(Bt,e).y-J.h+Ge})}function cn(){ln=0}function On(){Tt.exit(1)}function Rn(){e=ze(vt),q=e.w,v=e.h,e=ze(Ut),fn=e.w,An=e.h}function In(e,t){t&&Be("exit.modal."+t,[f]),Ke(ue,Ut,[e])}function Ln(t){ln=t.target,e=Qe(vt,t),Z=e.x,ee=e.y,Rn()}function Fn(t){var n=un.header,r=un.resize;ln===n||Xe(ln,n)===n?(e=Qe(Bt,t),Y=e.x-Z,z=e.y-ee,E(vt,{left:(q>fn?Y:c(Y,0,fn-q))+Ge,top:(v>An?z:c(z,0,An-v))+Ge})):ln===r&&(e=Qe(vt,t),J=ze(r),E(vt,{width:e.x+J.w/4+Ge,height:e.y+J.h/4+Ge}))}function Sn(){ln=0}function Tn(e,t,n){return{header:e,body:t,footer:n}}function Nn(e){B=$t,m=kt,W=e&&e.target||0,(!W||W!==B&&Xe(W,B)!==B)&&($t=0,Ft(kt),we(ue,l,Nn),we(Oe,a,Nn),Tt.exit(e.target===p))}function Cn(t){function n(){e&&($=ze(e),E(Q,{width:$.w+Ge,height:$.h+Ge}))}return j=f.get(),q="",-1===j.indexOf("</html>")&&(q='<!DOCTYPE html><html dir="'+M.dir+'"><head><meta charset="utf-8"><style>'+M.css+"</style></head><body>"+j+"</body></html>"),Q=et("iframe",!1,{"class":Ct+"-portal",src:"data:text/html,"+encodeURIComponent(q)}),!st(Ut)&&j?Tt.overlay(Q,1,function(){e=at(Ut)[0],n(),ke(Oe,a,n),Be("enter.overlay.preview",[t,f,[j,q],e])}):(we(Oe,a,n),On()),ve(t)}var B,m,W,y,v,k,w,K,Y,x,V,e,$,Q,J,z,j,q,Z,ee,t="⌘",n="…",i="⇥",o="⇧",a=window,l=document,f=this,A=f._,u=A.x,s=A.extend,E=A.css,c=A.edge,O=A.pattern,R=A.trim,I=f.is,L=I.e,F=I.f,S=I.i,T=I.o,N=I.r,d=I.s,C=function(e){return!I.x(e)},g=l.documentElement,G=(l.head,l.body),p=f.target,H={},D=function(){},M=s({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),ne="keydown",re="keyup",ie="copy",oe="cut",ae="paste",le="touchstart mousedown",fe="touchend mouseup",Ae="touchmove mousemove",ue="click",se="focus",Ee="blur",ce="input",Oe="orientationchange resize",Re=Ee+" "+ie+" "+oe+" "+se+" "+ce+" "+ne+" "+ae,Ie=M.languages,Le=M.tab,Fe=M.auto_tab,Se=M.auto_close,Te=M.unit[0][0],de=(M.unit[0][1],M.unit[1][0]),Ce=M.unit[1][1],ge="tool-id",he="javascript:;",Ge="px",Tt=f.ui={};f.tidy=function(e,t){var n=f.$(),r=R(n.before)?e:"",i=R(n.after)?C(t)?t:e:"";return f.trim(r,i)},f.i=function(){return R(f.replace(/\s+/g," "))},f.format=function(e,t,n,r){T(e)||(e=[e]),C(n)||(n=" "),C(r)||(r="");var i=f[0]().$(),o=(e[0]?Te[0]+e[0]+Te[1]:"")+r,a=r+(e[0]?Te[0]+Te[2]+(e[1]||e[0].split(O("("+Ce[3]+")+"))[0])+Te[1]:""),l=u(o),A=u(a),s=O("^"+l+"([\\s\\S]*?)"+A+"$"),E=O(l+"$"),c=O("^"+A),R=i.before,I=i.after;return i.length?n=!1:f.insert(Ie.placeholders[""]),f.toggle(t?!s.test(i.value):!E.test(R)&&!c.test(I),[function(e){e.unwrap(o,a,1).tidy(O(de[0]+"[^"+de[0]+de[1]+de[2]+"]+?"+de[1]+"$").test(R)?"":n,O("^"+de[0]+de[2]+"[^"+de[0]+de[1]+"]+?"+de[1]).test(I)?"":n).wrap(o,a,t)[1]()},function(e){e.unwrap(o,a,t)[1]()}])};var _t,Nt=M.classes,dt=Nt.i,Ct=Nt[""],gt=Ie.tools,ht=Ie.buttons,Gt=Ie.labels,pt=Ie.others,Ht=Ct+"-textarea "+Ct+"-content block",Dt=St(Ct),Mt=St(Ct+"-header"),Bt=St(Ct+"-body"),mt=St(Ct+"-footer"),Wt=St(Ct+"-tool"),Pt=et(p,!1,M.attributes),bt=St(Ct+"-resize s"),yt=St(Ct+"-description"),Ut=St(Ct+"-overlay"),vt=et("div"),kt=et("div"),wt=et("div"),Kt=St("left","span"),Yt=St("right","span"),xt=St(Ct+"-preview","a"),Vt=0,$t=0;M.suffix||(M.suffix=Te[1]);var en={},tn=null;f.create=function(e,t){T(e)&&(M=s(M,e));var n=st(Pt);return je(Pt,Ht),n&&At(n,"p")?(Et(n,Dt),Vt=n,Lt(n,!1)):Et(Pt,Dt),Dt.dir=M.dir,It(Dt,Mt),It(Dt,Bt),It(Dt,mt),It(Dt,bt),It(Bt,Pt),M.tools&&(It(Mt,Wt),It(mt,yt),It(yt,Kt),It(yt,Yt)),ke(ne,Pt,nn),ke(re,Pt,rn),ke(Re,Pt,on),ke(le,bt,sn),ke(Ae,l,En),ke(fe,G,cn),pt.preview&&(J=gt.preview,me(xt,{href:he,title:T(J)?J[0]+(J[1]?" ("+J[1]+")":""):J}),It(Kt,xt),nt(xt,pt.preview)),Zt(null),jt(),qt(),0!==t?Be("create",[f]):f},f.update=function(e,t){return qe(Pt,pe(Ht),0)&&f.destroy(0),(0!==t?Be("update",[f]):f).create(e,0)},f.destroy=function(e){return qe(Pt,pe(Ht),0)?(Tt.exit(0,0,0),Ze(Pt,Ht),M.tools=He(M.tools),M.keys&&(we(ne,Pt,nn),we(re,Pt,rn)),we(le,bt,sn),we(Ae,l,En),we(fe,l,cn),we(Re,Pt,on),Vt?(Et(Dt,Vt),It(Vt,Pt),Vt=0):Et(Dt,Pt),Ft(Dt),0!==e?Be("destroy",[f]):f):f};var ln=0,Z=0,ee=0,q=0,v=0,fn=0,An=0,un={};Tt.exit=function(e,t,n){if(y={overlay:function(){we(ue,Ut,On),Ft(Ut)},modal:function(){we(le,Bt,Ln),we(Ae,Bt,Fn),we(fe,l,Sn),we(ue,un.x,In),Ft(vt)},drop:function(){Ft(kt)},bubble:function(){Ft(wt)}},t)if(T(t))for(k in t)k=t[k],y[k]&&y[k](),0!==n&&Be("exit."+k,[f]);else y[t]&&y[t](),0!==n&&Be("exit."+k,[f]);else for(k in y)y[k]();return e&&f.select(),0!==n&&Be("exit",[f]),f},Tt.overlay=function(e,t,n){return Tt.exit(0,0,0),rn(1),It(Bt,et(Ut,e.length||L(e)?St(Ct+"-overlay-content","div",e):"")),t&&ke(ue,Ut,On),F(n)?n(Ut):et(Ut,n),Be("enter.overlay",[f]),Be("enter",[f]),f},Tt.overlay.fit=function(){},Tt.modal=function(){Tt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=Ct+"-modal";T(t)&&(t="default",n=e[0],r=e[1]),Y=_e(t),et(vt,!1,{"class":i+" "+Y}),C(n.body)&&(n.body=et("div",n.body,{"class":i+"-content "+Y}));for(k in n)i[1]=k,un[k]=St(i+"-"+$e(k,i)+" "+Y,0,n[k]);return un.x=St(Ct+"-x "+Y),un.resize=St(Ct+"-resize se "+Y),it(vt),It(Bt,et(vt,un,{style:""})),Tt.modal.fit(),ct(vt,Ut),ke(ue,un.x,In),ke(le,un.header,ve),ke(le,un.resize,ve),ke(le,Bt,Ln),ke(Ae,Bt,Fn),ke(fe,l,Sn),F(r)&&(un.overlay=Ut,un.modal=vt,r(un)),Be("enter.modal."+t,[f]),Be("enter.modal",[f]),Be("enter",[f]),f},Tt.modal.fit=function(e){return Rn(),Y=fn/2-q/2,z=An/2-v/2,T(e)?(Y=e[0],z=e[1]):(Y=c(Y,0),z=c(z,0)),E(vt,{left:Y+Ge,top:z+Ge,"min-width":q+Ge,"min-height":v+Ge,visibility:"visible"}),Be("fit.modal",[f]),Be("fit",[f]),f};var dn={"class":Ct+"-button",name:"y"};return Tt.alert=function(e,t,n,r){var i=et("button",ht.okay,dn),o="alert";return n=n||D,T(e)&&(o+=":"+e[0],e=e[1]||e[0]),ke(ue,i,function(e){return n(e,f),In(e,o+".y"),ve(e)}),ke(ne,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(Ke(ue,i,[e]),ve(e)):void 0}),Tt.modal(o,Tn(e,t,i),r),i.focus(),f},Tt.confirm=function(e,t,n,r,i){function u(e){return F(n)&&n(e,f),In(e,l+".y"),ve(e)}function s(e){return F(r)&&r(e,f),In(e,l+".n"),ve(e)}var A,o=et("button",ht.okay,dn),a=et("button",ht.cancel,dn),l="confirm";return a.name="n",T(e)&&(l+=":"+e[0],e=e[1]||e[0]),ke(ue,o,u),ke(ue,a,s),ke(ne,o,function(e){return A=e.TE.key,A("arrowright")?(a.focus(),ve(e)):A("arrowleft")?ve(e):A("enter")?(u(e),ve(e)):A("escape")?(In(e,l+".y"),ve(e)):void 0}),ke(ne,a,function(e){return A=e.TE.key,A("arrowright")?ve(e):A("arrowleft")?(o.focus(),ve(e)):A("enter")?(s(e),ve(e)):A("escape")?(In(e,l+".n"),ve(e)):void 0}),Tt.modal(l,Tn(e,t,[o,a]),i),a.focus(),f},Tt.prompt=function(e,t,n,r,i,o){function c(){A.focus(),"placeholder"in A&&A.select()}function O(e){return ve(e)}function I(e){return J=A.value,!n||R(J)&&J!==t?(In(e,u+".y"),ve(e),r(e,f,J!==t?J:"",t)):(c(),O(e))}function L(e){return In(e,u+".n"),ve(e)}var E,a=et("button",ht.okay,dn),l=et("button",ht.cancel,dn),A=et("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Ct+"-input block"}),u="prompt",s=[];if(T(e)&&(u+=":"+e[0],e=e[1]||e[0]),F(i)&&(o=i,i=0),1===i)A=et("textarea",t,{placeholder:t.split("\n")[0],"class":Ct+"-textarea block"});else if(2===i){for(k in t)s.push(et("option",t[k],{value:k,selected:k===n||null}));A=et("select",s,{"class":Ct+"-select block"})}return r=r||D,A.name="data",l.name="n",ke(ne,A,function(e){return E=e.TE.key,E("enter")?I(e):E("escape")||E("backspace")&&!this.value?L(e):E("arrowup")?O(e):E("arrowdown")?(a.focus(),ve(e)):void 0}),ke(ne,a,function(e){return E=e.TE.key,E("enter")?I(e):E("escape")?L(e):E("arrowup")?(A.focus(),ve(e)):E("arrowright")?(l.focus(),ve(e)):E(/^arrow(down|left)$/)?O(e):void 0}),ke(ne,l,function(e){return E=e.TE.key,E(/^enter|escape$/)?L(e):E("arrowup")?(A.focus(),ve(e)):E(/^arrow(right|down)$/)?O(e):E("arrowleft")?(a.focus(),ve(e)):void 0}),ke(ue,a,I),ke(ue,l,L),Tt.modal(u,Tn(e,A,[a,l]),o),c(),f},Tt.drop=function(){Tt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),Y=_e(t),it(kt),It(G,et(kt,!1,{"class":Ct+"-drop "+Y})),F(n)?n(kt):et(kt,n),Tt.drop.fit(),ke(ue,l,Nn),ke(Oe,a,Nn),Be("enter.drop."+t,[f]),Be("enter.drop",[f]),f},Tt.drop.fit=function(t){return B=ze(g),m=ze(kt),Y=B.w/2-m.w/2,z=B.h/2-m.h/2,!C(t)&&$t&&(e=Je($t),Y=e.l,z=e.t+ze($t).h),T(t)?(Y=t[0],z=t[1]):(Y=c(Y,0,Math.max(B.w,a.innerWidth)-m.w),z=c(z,0,Math.max(B.h,a.innerHeight)-m.h)),E(kt,{left:Y+Ge,top:z+Ge,visibility:"visible"}),Be("fit.drop",[f]),Be("fit",[f]),f},Tt.menu=function(e,t,n,r){t=!T(t)&&n[t]&&n[t].text||t;var l,i='<span class="'+Ct+'-current menu">%1</span>',o="",a=0;return t===!1?Tt.tool(e,t):(T(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+$e(dt,[o])+'"></i>',t=C(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,i=o+(0!==t?" "+i:"")),Tt.tool(e,{i:o,text:t?$e(i,[t,o]):0,click:function(A){return Tt.drop("menu menu-"+_e(e),function(A){function u(e){return l=this,x=n[ye(l,ge)],x=d(x)?Tt.tools[x]:x||{},v=rt(l),!Jt(x)&&F(r=x.click)&&(r=r(e,f),t!==!1&&$t&&(J=at($t)[0]||$t,At(J,"i")||nt(J,$e(i,[v,o])),T(x.text)&&(z=at(J)[0])&&At(z,"i")&&(Ze(z),je(z,$e(dt,[x.text[0]])))),r===!1)?ve(e):(f.select(),ve(e))}function E(e){if(l=this,(K=e.TE.key)("escape"))return Tt.exit(1),ve(e);if(K("arrowdown")&&(Y=lt(l))){for(;!At(Y,"a");)Y=lt(Y);return Y&&Y.focus(),ve(e)}if(K("arrowup")&&(Y=ft(l))){for(;!At(Y,"a");)Y=ft(Y);return Y&&Y.focus(),ve(e)}}for(r in n)if(l=n[r],q="%"===r[0],l=d(l)&&!q?Tt.tools[l]:l){l=Xt(l,r,Tt.tools);var c={href:q?null:he,"class":Ct+"-"+(q?"label":"button")};q?w=Gt[e]&&Gt[e][+r.slice(1)-1]||r:(c.data={},c.data[ge]=r,w=gt[r]||r),Q=l.text,Q=T(Q)?Q[1]||"":Q,w=T(w)?w[0]:w,J=et(q?"span":"a",q?!1:l.text||w,s(c,l.attributes||{})),!J.title&&(z=l.title)&&(J.title=T(z)?z[0]+(z[1]?" ("+z[1]+")":""):z),q?me(J,{id:Ct+"-label:"+a,title:w||null}):(Jt(l)&&je(J,"x"),ke(ue,J,u),ke(ne,J,E)),n[r]=l,It(A,J),++a}Ye(function(){ut("a",A)[0].focus()},1)}),!1}},r),Tt.tools[e].data=n,f)},Tt.bubble=function(){Tt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),Y=_e(t),it(wt),It(G,et(wt,!1,{"class":Ct+"-bubble "+Y})),F(n)?n(wt):et(wt,n),Tt.bubble.fit(),Be("enter.bubble."+t,[f]),Be("enter.bubble",[f]),f},Tt.bubble.fit=function(t){J=f.$(1),e=Je(Pt),v=E(Pt,"line-height");var n="border-",r="-width";Y=J.caret[0].x+e.l-Pt.scrollLeft,z=J.caret[1].y+e.t+v-Pt.scrollTop,m=E(Bt,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=ze(Bt),o=ze(wt),a=m[0]+m[1],l=m[2]+m[3];return T(t)?(Y=t[0],z=t[1]):(Y=c(Y,e.l,e.l+i.w-o.w-l),z=c(z,e.t,e.t+i.h-o.h-a)),E(wt,{left:Y+Ge,top:z+Ge,visibility:"visible"}),Be("fit.bubble",[f]),Be("fit",[f]),f},Tt.overlay.exit=function(e){return Tt.exit(e,"overlay")},Tt.modal.exit=function(e){return Tt.exit(e,"modal")},Tt.drop.exit=function(e){return Tt.exit(e,"drop")},Tt.bubble.exit=function(e){return Tt.exit(e,"bubble")},Tt.tool=function(e,t,n){return w="","|"!==e&&(M.tools=M.tools.filter(function(t,n){return t===e?(w=n,!1):!0})),t===!1?delete Tt.tools[e]:("|"===e?(n=t,t={}):(F(t)&&(t={click:t}),Tt.tools[e]=s(Tt.tools[e]||{},t),C(n)||""===w||(n=w)),S(n)?M.tools.splice(n,0,e):M.tools.push(e)),jt(),f},Tt.key=function(e,t){return M.keys?(t===!1?delete Tt.keys[e]:Tt.keys[e]=t,qt(),f):f},Tt.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Le),!1},outdent:function(e,t){return t.outdent(Le),!1}},ke(ue,xt,Cn),Tt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Cn(e)},"shift+tab":Fe?"outdent":0,tab:Fe?"indent":0,escape:function(e,t){return xt.focus(),!1}},Tt.el={container:Dt,header:Mt,body:Bt,footer:mt,overlay:Ut,modal:vt,drop:kt,bubble:wt},f.config=M,s(f._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),a=e.getSeconds(),l=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>a&&(a="0"+a),10>l&&(l="0"+l),[""+t,""+n,""+r,""+i,""+o,""+a,""+l]},replace:Ve,format:$e,dom:{set:It,reset:Lt,get:ut,id:tt,classes:{set:je,reset:Ze,get:qe},attributes:{set:me,reset:Pe,get:We},data:{set:be,reset:Ue,get:ye},offset:Je,point:Qe,size:ze,content:{set:nt,reset:it,get:rt},closest:Xe,parent:ot,children:at,next:lt,previous:ft,before:Et,after:ct,prepend:Ot,append:Rt},el:et,event:{set:ke,reset:we,fire:Ke,x:ve},hooks:H,hook:{set:De,reset:Me,fire:Be}}),Tt};