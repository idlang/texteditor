/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.7
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function ge(e){return F(e)?R(e).split(/\s+/):e}function me(e){return S(e)?e.join(" "):e}function He(e,t,n){return C(e)?C(t)?(C(H[e])||(H[e]={}),C(n)||(n=Object.keys(H[e]).length),H[e][n]=t,s):H[e]:H}function De(e,t){return C(e)?C(t)&&C(H[e])?(delete H[e][t],s):(H[e]={},s):(H={},s)}function Me(e,t,n){if(!C(H[e]))return H[e]={},s;if(C(n))C(H[e][n])&&H[e][n].apply(s,t);else for(K in H[e])H[e][K].apply(s,t);return s}function Ue(e,t,n){if(S(t))for(K in t)Ue(e,K,t[K]);else e.setAttribute(t,n)}function ve(t,n,r){if(F(n))return ve(t,[n],C(r)?r:"")[0];e=[];for(K in n)K=n[K],(K=t.getAttribute(K))&&e.push(K);return e.length?e:C(r)?r:[]}function Be(e,t){if(S(t))for(K in t)Be(e,t[K]);else if(C(t))e.removeAttribute(t);else for(Be(e,"class"),K=0,w=e.attributes,Y=w.length;Y>K;++K)w[K]&&Be(e,w[K].name)}function Pe(e,t,n){if(S(t))for(K in t)Pe(e,K,t[K]);else Ue(e,"data-"+t,n)}function We(t,n,r){if(F(n))return We(t,[n],C(r)?r:"")[0];e=[];for(K in n)K=n[K],(K=ve(t,"data-"+K))&&e.push(K);return e.length?e:C(r)?r:[]}function $e(e,t){if(S(t))for(K in t)Be(e,"data-"+t[K]);else if(C(t))Be(e,"data-"+t);else for(K=0,w=e.attributes,Y=w.length;Y>K;++K)w[K]&&"data-"===w[K].name.slice(0,5)&&Be(e,w[K].name)}function ke(e){return e&&e.preventDefault(),!1}function ye(e,t,n){if(t){for(e=ge(e),K=0,w=e.length;w>K;++K)t.addEventListener(e[K],n,!1),He("on:"+e[K],n,et(t));return s}}function Ke(e,t,n){if(t){for(e=ge(e),K=0,w=e.length;w>K;++K)t.removeEventListener(e[K],n,!1),De("on:"+e[K],et(t));return N(t)&&t.id.split(":")[0]===St+"-dom"&&Be(t,"id"),s}}function we(e,t,n){e=ge(e);var i,r="createEvent"in a;for(K=0,w=e.length;w>K;++K)r?(i=a.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[K],!0,!1),t.dispatchEvent(i)):Me("on:"+e[K],n,et(t));return s}function Ye(e,t,n){for(K=0,w=t.length,Y;w>K;++K)Y=t[K],e=e.replace(h(Y)?Y:O(u(Y),"g"),n&&n[K]||"");return e}function xe(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,C(t[n])?t[n]:e})}function _e(e){return R(Ye(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ve(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=qe(e);return{x:n-i.l,y:r-i.t}}function qe(e){for(x=e.offsetLeft,z=e.offsetTop;e=e.offsetParent;)x+=e.offsetLeft,z+=e.offsetTop;return{l:x,t:z}}function Qe(e){return{w:e.offsetWidth,h:e.offsetHeight}}function je(e,t){for(;(e=it(e))&&e!==t;);return e}function Xe(e,t){t=ge(t);for(K in t)e.classList.add(t[K])}function ze(t,n,r){if(F(n))return ze(t,[n],C(r)?r:"")[0];e=[];for(K in n)K=n[K],t.classList.contains(K)&&e.push(K);return e.length?e:C(r)?r:!1}function Je(e,t){if(C(t)){t=ge(t);for(K in t)e.classList.remove(t[K])}else Be(e,"class")}function Ze(e,t,n){if(e=F(e)?a.createElement(e):e,S(n))for(K in n)if(Z=n[K],"classes"===K)Xe(e,Z);else if("data"===K)for(w in Z)Z=Z[w],null===Z?$e(e,w):Pe(e,w,Z);else"css"===K?F(Z)?Ue(e,"style",Z):null===Z?Be(e,"style"):A(e,Z):T(Z)?e[K]=Z:null===Z?Be(e,K):Ue(e,K,S(Z)?Z.join(" "):""+Z);if(N(t))Rt(e,t);else if(S(t))for(K in t)Z=t[K],N(Z)?Rt(e,Z):Z!==!1&&tt(e,Z);else C(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=St+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(C(t)?t:"")}function rt(e,t){if(t!==!1&&(B=ot(e)))for(K=0,w=B.length;w>K;++K)rt(B[K]);tt(e,"")}function it(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function at(e){return e&&e.previousSibling}function st(e,t){return e&&F(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&T(t)?e===t(e):e===t}function ft(t,n){if(n=n||a,e=[],F(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(K=0,w=t.length;w>K;++K)e.push(t[K]);return e}return[]}for(t=n.querySelectorAll(t),K=0,w=t.length;w>K;++K)e.push(t[K]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=it(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){q=it(e),q&&q.insertBefore(t,e)}function At(e,t){q=it(e),q&&q.insertBefore(t,lt(e))}function Et(e,t){B=ot(e)[0],B?ct(B,t):Rt(e,t)}function Ot(e,t){Rt(e,t)}function Rt(e,t){e.appendChild(t)}function It(e,t){var n=ut(e);if(n){if(t!==!1)for(B=ot(e)[0];B;)It(B);n.removeChild(e)}}function Lt(e){rt(Ze(e,!1,{style:""})),It(e)}function pt(e,t,n){return Ze(t||"div",n,{"class":e})}function qt(e){return!e||C(e.active)&&!X.active}function Qt(){bt._word&&bt._words&&(Z=(Ut.value||"").replace(O(he[0]+"[^"+he[0]+he[1]+"]+?"+he[1],"g"),""),K=(Z.match(/(\w+)/g)||[]).length,tt(Kt,xe(bt["_word"+(1===K?"":"s")],[K])))}function jt(e,t,n){return T(e)&&(e={click:e}),F(e.click)&&(e.click=(n[e.click]||{}).click),C(e.title)||(e.title=ht[t]||""),n[t]=e,e}function Xt(){rt(Mt,!1);var r,i,o,l,a,f,u,e=ge(M.tools),t=St+"-button",n=St+"-separator";M.tools=e;for(f in e)u=e[f],i=Nt.tools[u],(i||i==={})&&(i=jt(i,u,Nt.tools),o=i.i||u,"|"!==o&&"<"!==o[0]&&(o=_e(o)),l="|"!==o,a=_e(o).replace(/\s/g,""),_t=pt(l?t+" "+t+"-"+a:n+" "+n+"-"+f,l?"a":"span"),l?(r=t+":"+a,Ue(_t,{href:be,id:r,tabindex:-1}),Pe(_t,Ce,u),o="<"===o[0]?o:'<i class="'+xe(dt,[o])+'"></i>',qt(i)&&Xe(_t,"x"),i.text&&(o=xe('<span class="'+St+'-text">'+i.text+"</span>",[o]),Xe(_t,"text")),tt(_t,o),Ze(_t,!1,i.attributes||{}),!_t.title&&(w=i.title)&&(_t.title=S(w)?w[0]+(w[1]?" ("+w[1]+")":""):w),ye(Ae,_t,on)):_t.id=n+":"+f,Nt.tools[u].target=_t,Rt(Mt,_t));Me("update.tools",[s])}function zt(){Nt.keys=function(){var n,e=Object.keys(Nt.keys).sort().reverse(),t={};for(K=0,w=e.length;w>K;++K)n=e[K],t[n]=Nt.keys[n];return t}(),nn(1),Me("update.keys",[s])}function Jt(e){Qt(),Me("on:change",[e,s])}function tn(t){function E(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=s.$(),r=n.before,i=n.after,o=r.slice(-1),l=i[0],a=n.length,f=Nt.keys,c=TE.keys_alias,A=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();V=t.TE.key(),Zt[V]=1,e=Object.keys(Zt).length,I(function(){s.record()},1);for(K in f){Y=E(K),B=0;for(w in Y)w=Y[w],Zt[c[w]||w]&&++B;if(Y=Y.length,B===Y&&e===Y&&(F(f[K])&&(f[K]=Nt.tools[f[K]].click),x=f[K]&&f[K](t,s),x===!1))return ke(t)}if(Te)for(K in Te)if(_=Te[K],_!==!1){if(V===_&&l===_)return"\\"===o?(s.insert(V,0),ke(t)):(s.select(n.end+1),ke(t));if(K===V)return s.wrap(K,_),ke(t);if(o===K&&l===_){if("backspace"===V&&r.slice(-2)!=="\\"+K)return s.unwrap(K,_),ke(t);if(Ne&&"enter"===V&&K!==_)return s.tidy("\n"+A+pe,"\n"+A),ke(t)}}if(Ne&&!a){if("backspace"===V&&O(u(pe)+"$").test(r))return s.outdent(pe),ke(t);if("enter"===V&&O("(^|\\n)("+u(pe)+")+.*$").test(r))return s.insert("\n"+A,0,1),ke(t)}}function nn(e){S(e)?delete Zt[e.TE.key()]:Zt={}}function rn(e){/^(focus|blur)$/.test(e.type)&&nn(1),L(en),en=I(function(){Jt(e)},M.debounce||0)}function on(e){Nt.exit(0,0,0);var t=We(this,Ce),n=Nt.tools,r=n[t];return xt=e.currentTarget||e.target,!qt(r)&&T(w=r.click)&&(w=w(e,s,t),Me("on:change",[e,s,t]),w===!1)?ke(e):(s.select(),ke(e))}function un(e){return ln=vt,X=Qe(Dt),ke(e)}function cn(e){ln===vt&&A(Ut,{height:Ve(Ht,e).y-X.h+Ge})}function An(){ln=0}function En(){Nt.exit(1)}function On(){e=Qe(Wt),ee=e.w,y=e.h,e=Qe(Pt),an=e.w,sn=e.h}function Rn(e,t){t&&Me("exit.modal."+t,[s]),we(Ae,Pt,[e])}function In(t){ln=t.target,e=Ve(Wt,t),te=e.x,ne=e.y,On()}function Ln(t){var n=fn.header,r=fn.resize;ln===n||je(ln,n)===n?(e=Ve(Ht,t),x=e.x-te,z=e.y-ne,A(Wt,{left:(ee>an?x:E(x,0,an-ee))+Ge,top:(y>sn?z:E(z,0,sn-y))+Ge})):ln===r&&(e=Ve(Wt,t),X=Qe(r),A(Wt,{width:e.x+X.w/4+Ge,height:e.y+X.h/4+Ge}))}function pn(){ln=0}function Nn(e,t,n){return{header:e,body:t,footer:n}}function Tn(e){U=xt,v=$t,B=e&&e.target||0,(!B||B!==U&&je(B,U)!==U)&&(xt=0,Lt($t),Ke(Ae,a,Tn),Ke(Re,l,Tn),Nt.exit(e.target===m))}function Sn(t){function n(){e&&(q=Qe(e),A(j,{width:q.w+Ge,height:q.h+Ge}))}return Z=s.get(),ee="",-1===Z.indexOf("</html>")&&(ee='<!DOCTYPE html><html dir="'+M.dir+'"><head><meta charset="utf-8"><style>'+M.css+"</style></head><body>"+Z+"</body></html>"),j=Ze("iframe",!1,{"class":St+"-portal",src:"data:text/html,"+encodeURIComponent(ee)}),!ut(Pt)&&Z?Nt.overlay(j,1,function(){e=ot(Pt)[0],n(),ye(Re,l,n),Me("enter.overlay.preview",[t,s,[Z,ee],e])}):(Ke(Re,l,n),En()),ke(t)}var U,v,B,$,y,K,w,Y,x,_,V,e,q,j,X,z,Z,ee,te,ne,t="⌘",n="…",i="⇥",o="⇧",l=window,a=document,s=this,f=s._,u=f.x,c=f.extend,A=f.css,E=f.edge,O=f.pattern,R=f.trim,I=f.timer.set,L=f.timer.reset,p=s.is,N=p.e,T=p.f,d=p.i,S=p.o,h=p.r,F=p.s,C=function(e){return!p.x(e)},b=a.documentElement,g=(a.head,a.body),m=s.target,H={},D=function(){},M=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",oe="keyup",le="copy",ae="cut",se="paste",fe="touchstart mousedown",ue="touchend mouseup",ce="touchmove mousemove",Ae="click",Ee="focus",Oe="blur",Re="orientationchange resize",Ie=Oe+" "+le+" "+ae+" "+Ee+" input "+ie+" "+se,Le=M.languages,pe=M.tab,Ne=M.auto_tab,Te=M.auto_close,de=M.unit[0][0],he=(M.unit[0][1],M.unit[1][0]),Fe=M.unit[1][1],Ce="tool-id",be="javascript:;",Ge="px",Nt=s.ui={};s.tidy=function(e,t){var n=s.$(),r=R(n.before)?e:"",i=R(n.after)?C(t)?t:e:"";return s.trim(r,i)},s.i=function(){return R(s.replace(/\s+/g," "))},s.format=function(e,t,n,r){S(e)||(e=[e]),C(n)||(n=" "),C(r)||(r="");var i=s.h,o=s[0]().$(),l=(e[0]?de[0]+e[0]+de[1]:"")+r,a=r+(e[0]?de[0]+de[2]+(e[1]||e[0].split(O("("+Fe[3]+")+"))[0])+de[1]:""),f=u(l),c=u(a),A=O("^"+f+"([\\s\\S]*?)"+c+"$"),E=O(f+"$"),R=O("^"+c),I=o.before,L=o.after;return o.length?n=!1:s.insert(Le.placeholders[""]),s.toggle(t?!A.test(o.value):!E.test(I)&&!R.test(L),[function(e){e.unwrap(l,a,1).tidy(O(he[0]+"[^"+he[0]+he[1]+he[2]+"]+?"+he[1]+"$").test(I)?"":n,O("^"+he[0]+he[2]+"[^"+he[0]+he[1]+"]+?"+he[1]).test(L)?"":n).wrap(l,a,t)},function(e){e.unwrap(l,a,t)}])[1]()[i]()};var _t,Tt=M.classes,dt=Tt.i,St=Tt[""],ht=Le.tools,Ft=Le.buttons,Ct=Le.labels,bt=Le.others,Gt=St+"-textarea "+St+"-content block",gt=pt(St),mt=pt(St+"-header"),Ht=pt(St+"-body"),Dt=pt(St+"-footer"),Mt=pt(St+"-tool"),Ut=Ze(m,!1,M.attributes),vt=pt(St+"-resize s"),Bt=pt(St+"-description"),Pt=pt(St+"-overlay"),Wt=Ze("div"),$t=Ze("div"),kt=Ze("div"),yt=pt("left","span"),Kt=pt("right","span"),wt=pt(St+"-preview","a"),Yt=0,xt=0;M.suffix||(M.suffix=de[1]);var Zt={},en=null;s.create=function(e,t){S(e)&&(M=c(M,e));var n=ut(Ut);return Xe(Ut,Gt),n&&st(n,"p")?(ct(n,gt),Yt=n,It(n,!1)):ct(Ut,gt),gt.dir=M.dir,Rt(gt,mt),Rt(gt,Ht),Rt(gt,Dt),Rt(gt,vt),Rt(Ht,Ut),M.tools&&(Rt(mt,Mt),Rt(Dt,Bt),Rt(Bt,yt),Rt(Bt,Kt)),ye(ie,Ut,tn),ye(oe,Ut,nn),ye(Ie,Ut,rn),ye(fe,vt,un),ye(ce,a,cn),ye(ue,g,An),bt.preview&&(X=ht.preview,Ue(wt,{href:be,title:S(X)?X[0]+(X[1]?" ("+X[1]+")":""):X}),Rt(yt,wt),tt(wt,bt.preview)),Jt(null),Xt(),zt(),0!==t?Me("create",[s]):s},s.update=function(e,t){return ze(Ut,ge(Gt),0)&&s.destroy(0),(0!==t?Me("update",[s]):s).create(e,0)},s.destroy=function(e){return ze(Ut,ge(Gt),0)?(Nt.exit(0,0,0),Je(Ut,Gt),M.tools=me(M.tools),M.keys&&(Ke(ie,Ut,tn),Ke(oe,Ut,nn)),Ke(fe,vt,un),Ke(ce,a,cn),Ke(ue,a,An),Ke(Ie,Ut,rn),Yt?(ct(gt,Yt),Rt(Yt,Ut),Yt=0):ct(gt,Ut),Lt(gt),0!==e?Me("destroy",[s]):s):s};var ln=0,te=0,ne=0,ee=0,y=0,an=0,sn=0,fn={};Nt.exit=function(e,t,n){if($={overlay:function(){Ke(Ae,Pt,En),Lt(Pt)},modal:function(){Ke(fe,Ht,In),Ke(ce,Ht,Ln),Ke(ue,a,pn),Ke(Ae,fn.x,Rn),Lt(Wt)},drop:function(){Lt($t)},bubble:function(){Lt(kt)}},t)if(S(t))for(K in t)K=t[K],$[K]&&$[K](),0!==n&&Me("exit."+K,[s]);else $[t]&&$[t](),0!==n&&Me("exit."+K,[s]);else for(K in $)$[K]();return e&&s.select(),0!==n&&Me("exit",[s]),s},Nt.overlay=function(e,t,n){return Nt.exit(0,0,0),nn(1),Rt(Ht,Ze(Pt,e.length||N(e)?pt(St+"-overlay-content","div",e):"")),t&&ye(Ae,Pt,En),T(n)?n(Pt):Ze(Pt,n),Me("enter.overlay",[s]),Me("enter",[s]),s},Nt.overlay.fit=function(){},Nt.modal=function(){Nt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=St+"-modal";S(t)&&(t="default",n=e[0],r=e[1]),x=_e(t),Ze(Wt,!1,{"class":i+" "+x}),C(n.body)&&(n.body=Ze("div",n.body,{"class":i+"-content "+x}));for(K in n)i[1]=K,fn[K]=pt(i+"-"+xe(K,i)+" "+x,0,n[K]);return fn.x=pt(St+"-x "+x),fn.resize=pt(St+"-resize se "+x),rt(Wt),Rt(Ht,Ze(Wt,fn,{style:""})),Nt.modal.fit(),At(Wt,Pt),ye(Ae,fn.x,Rn),ye(fe,fn.header,ke),ye(fe,fn.resize,ke),ye(fe,Ht,In),ye(ce,Ht,Ln),ye(ue,a,pn),T(r)&&(fn.overlay=Pt,fn.modal=Wt,r(fn)),Me("enter.modal."+t,[s]),Me("enter.modal",[s]),Me("enter",[s]),s},Nt.modal.fit=function(e){return On(),x=an/2-ee/2,z=sn/2-y/2,S(e)?(C(e[0])&&(x=e[0]),C(e[1])&&(z=e[1])):(x=E(x,0),z=E(z,0)),A(Wt,{left:x+Ge,top:z+Ge,"min-width":ee+Ge,"min-height":y+Ge,visibility:"visible"}),Me("fit.modal",[s]),Me("fit",[s]),s};var dn={"class":St+"-button",name:"y"};return Nt.alert=function(e,t,n,r){var i=Ze("button",Ft.okay,dn),o="alert";return n=n||D,S(e)&&(o+=":"+e[0],e=e[1]||e[0]),ye(Ae,i,function(e){return n(e,s),Rn(e,o+".y"),ke(e)}),ye(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(we(Ae,i,[e]),ke(e)):void 0}),Nt.modal(o,Nn(e,t,i),r),i.focus(),s},Nt.confirm=function(e,t,n,r,i){function u(e){return T(n)&&n(e,s),Rn(e,a+".y"),ke(e)}function c(e){return T(r)&&r(e,s),Rn(e,a+".n"),ke(e)}var f,o=Ze("button",Ft.okay,dn),l=Ze("button",Ft.cancel,dn),a="confirm";return l.name="n",S(e)&&(a+=":"+e[0],e=e[1]||e[0]),ye(Ae,o,u),ye(Ae,l,c),ye(ie,o,function(e){return f=e.TE.key,f("arrowright")?(l.focus(),ke(e)):f("arrowleft")?ke(e):f("enter")?(u(e),ke(e)):f("escape")?(Rn(e,a+".y"),ke(e)):void 0}),ye(ie,l,function(e){return f=e.TE.key,f("arrowright")?ke(e):f("arrowleft")?(o.focus(),ke(e)):f("enter")?(c(e),ke(e)):f("escape")?(Rn(e,a+".n"),ke(e)):void 0}),Nt.modal(a,Nn(e,t,[o,l]),i),l.focus(),s},Nt.prompt=function(e,t,n,r,i,o){function O(){f.focus(),"placeholder"in f&&f.select()}function I(e){return ke(e)}function L(e){return A=f.value,!n||R(A)&&A!==t?(Rn(e,u+".y"),ke(e),r(e,s,A!==t?A:"",t)):(O(),I(e))}function p(e){return Rn(e,u+".n"),ke(e)}var A,E,l=Ze("button",Ft.okay,dn),a=Ze("button",Ft.cancel,dn),f=Ze("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":St+"-input block"}),u="prompt",c=[];if(S(e)&&(u+=":"+e[0],e=e[1]||e[0]),T(i)&&(o=i,i=0),1===i)f=Ze("textarea",t,{placeholder:t.split("\n")[0],"class":St+"-textarea block"});else if(2===i){for(K in t)c.push(Ze("option",t[K],{value:K,selected:K===n||null}));f=Ze("select",c,{"class":St+"-select block"})}return r=r||D,f.name="data",a.name="n",ye(ie,f,function(e){return E=e.TE.key,E("enter")?L(e):E("escape")||E("backspace")&&!this.value?p(e):E("arrowup")?I(e):E("arrowdown")?(l.focus(),ke(e)):void 0}),ye(ie,l,function(e){return E=e.TE.key,E("enter")?L(e):E("escape")?p(e):E("arrowup")?(f.focus(),ke(e)):E("arrowright")?(a.focus(),ke(e)):E(/^arrow(down|left)$/)?I(e):void 0}),ye(ie,a,function(e){return E=e.TE.key,E(/^(enter|escape)$/)?p(e):E("arrowup")?(f.focus(),ke(e)):E(/^arrow(right|down)$/)?I(e):E("arrowleft")?(l.focus(),ke(e)):void 0}),ye(Ae,l,L),ye(Ae,a,p),Nt.modal(u,Nn(e,f,[l,a]),o),O(),s},Nt.drop=function(){Nt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),x=_e(t),rt($t),Rt(g,Ze($t,!1,{"class":St+"-drop "+x})),T(n)?n($t):Ze($t,n),Nt.drop.fit(),ye(Ae,a,Tn),ye(Re,l,Tn),Me("enter.drop."+t,[s]),Me("enter.drop",[s]),s},Nt.drop.fit=function(t){return U=Qe(b),v=Qe($t),x=U.w/2-v.w/2,z=U.h/2-v.h/2,!C(t)&&xt&&(e=qe(xt),x=e.l,z=e.t+Qe(xt).h),S(t)?(C(t[0])&&(x=t[0]),C(t[1])&&(z=t[1])):(x=E(x,0,Math.max(U.w,l.innerWidth)-v.w),z=E(z,0,Math.max(U.h,l.innerHeight)-v.h)),A($t,{left:x+Ge,top:z+Ge,visibility:"visible"}),Me("fit.drop",[s]),Me("fit",[s]),s},Nt.menu=function(e,t,n,r){t=!S(t)&&n[t]&&n[t].text||t;var a,i='<span class="'+St+'-current menu">%1</span>',o="",l=0;return t===!1?Nt.tool(e,t):(S(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+xe(dt,[o])+'"></i>',t=C(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,i=o+(0!==t?" "+i:"")),Nt.tool(e,{i:o,text:t?xe(i,[t,o]):0,click:function(f){return Nt.drop("menu menu-"+_e(e),function(f){function u(e){return a=this,_=n[We(a,Ce)],_=F(_)?Nt.tools[_]:_||{},V=nt(a),!qt(_)&&T(r=_.click)&&(r=r(e,s),t!==!1&&xt&&(X=ot(xt)[0]||xt,st(X,"i")||tt(X,xe(i,[V,o])),S(_.text)&&(z=ot(X)[0])&&st(z,"i")&&(Je(z),Xe(z,xe(dt,[_.text[0]])))),r===!1)?ke(e):(s.select(),ke(e))}function A(e){if(a=this,(Y=e.TE.key)("escape"))return Nt.exit(1),ke(e);if(Y("arrowdown")&&(x=lt(a))){for(;!st(x,"a")&&x;)x=lt(x);return x&&x.focus(),ke(e)}if(Y("arrowup")&&(x=at(a))){for(;!st(x,"a")&&x;)x=at(x);return x&&x.focus(),ke(e)}}for(r in n)if(a=n[r],ee="%"===r[0],a=F(a)&&!ee?Nt.tools[a]:a){a=jt(a,r,Nt.tools);var E={href:ee?null:be,"class":St+"-"+(ee?"label":"button")};ee?w=Ct[e]&&Ct[e][+r.slice(1)-1]||r:(E.data={},E.data[Ce]=r,w=ht[r]||r),j=a.text,j=S(j)?j[1]||"":j,w=S(w)?w[0]:w,X=Ze(ee?"span":"a",ee?"<span>"+(w||"%"+l)+"</span>":a.text||w,c(E,a.attributes||{})),!X.title&&(z=a.title)&&(X.title=S(z)?z[0]+(z[1]?" ("+z[1]+")":""):z),ee?Ue(X,{id:St+"-label:"+l}):(qt(a)&&Xe(X,"x"),ye(Ae,X,u),ye(ie,X,A)),n[r]=a,Rt(f,X),++l}I(function(){ft("a",f)[0].focus()},1)}),!1}},r),Nt.tools[e].data=n,s)},Nt.bubble=function(){Nt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),x=_e(t),rt(kt),Rt(g,Ze(kt,!1,{"class":St+"-bubble "+x})),T(n)?n(kt):Ze(kt,n),Nt.bubble.fit(),Me("enter.bubble."+t,[s]),Me("enter.bubble",[s]),s},Nt.bubble.fit=function(t){X=s.$(1),e=qe(Ut),y=A(Ut,"line-height");var n="border-",r="-width";x=X.caret[0].x+e.l-Ut.scrollLeft,z=X.caret[1].y+e.t+y-Ut.scrollTop,v=A(Ht,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Qe(Ht),o=Qe(kt),l=v[0]+v[1],a=v[2]+v[3];return S(t)?(C(t[0])&&(x=t[0]),C(t[1])&&(z=t[1])):(x=E(x,e.l,e.l+i.w-o.w-a),z=E(z,e.t,e.t+i.h-o.h-l)),A(kt,{left:x+Ge,top:z+Ge,visibility:"visible"}),Me("fit.bubble",[s]),Me("fit",[s]),s},Nt.overlay.exit=function(e){return Nt.exit(e,"overlay")},Nt.modal.exit=function(e){return Nt.exit(e,"modal")},Nt.drop.exit=function(e){return Nt.exit(e,"drop")},Nt.bubble.exit=function(e){return Nt.exit(e,"bubble")},Nt.tool=function(e,t,n){return w="","|"!==e&&(M.tools=M.tools.filter(function(t,n){return t===e?(w=n,!1):!0})),t===!1?delete Nt.tools[e]:("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),Nt.tools[e]=c(Nt.tools[e]||{},t),C(n)||""===w||(n=w)),d(n)?M.tools.splice(n,0,e):M.tools.push(e)),Xt(),s},Nt.key=function(e,t){return M.keys?(t===!1?delete Nt.keys[e]:Nt.keys[e]=t,zt(),s):s},Nt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(pe),!1},outdent:function(e,t){return t.outdent(pe),!1}},ye(Ae,wt,Sn),Nt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Sn(e)},"shift+tab":Ne?"outdent":0,tab:Ne?"indent":0,escape:function(e,t){return wt.focus(),!1}},Nt.el={container:gt,header:mt,body:Ht,footer:Dt,overlay:Pt,modal:Wt,drop:$t,bubble:kt},s.config=M,c(s._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=e.getSeconds(),a=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>l&&(l="0"+l),10>a&&(a="0"+a),[""+t,""+n,""+r,""+i,""+o,""+l,""+a]},replace:Ye,format:xe,dom:{set:Rt,reset:It,get:ft,id:et,copy:function(e,t){return e.cloneNode(C(t)?t:!0)},classes:{set:Xe,reset:Je,get:ze},attributes:{set:Ue,reset:Be,get:ve},data:{set:Pe,reset:$e,get:We},is:st,offset:qe,point:Ve,size:Qe,content:{set:tt,reset:rt,get:nt},closest:je,parent:it,children:ot,next:lt,previous:at,before:ct,after:At,prepend:Et,append:Ot},el:Ze,event:{set:ye,reset:Ke,fire:we,x:ke},hooks:H,hook:{set:He,reset:De,fire:Me}}),Nt};