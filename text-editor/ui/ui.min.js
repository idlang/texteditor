/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.10
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function He(e){return p(e)?R(e).split(/\s+/):e}function be(e){return C(e)?e.join(" "):e}function Me(e,t,n){return G(e)?G(t)?(G(M[e])||(M[e]={}),G(n)||(n=Object.keys(M[e]).length),M[e][n]=t,A):M[e]:M}function Ue(e,t){return G(e)?G(t)&&G(M[e])?(delete M[e][t],A):(M[e]={},A):(M={},A)}function ge(e,t,n){if(!G(M[e]))return M[e]={},A;if(G(n))G(M[e][n])&&M[e][n].apply(A,t);else for(Y in M[e])M[e][Y].apply(A,t);return A}function me(e,t,n){if(C(t))for(Y in t)me(e,Y,t[Y]);else e.setAttribute(t,n)}function Be(t,n,r){if(p(n))return Be(t,[n],G(r)?r:"")[0];e=[];for(Y in n)Y=n[Y],(Y=t.getAttribute(Y))&&e.push(Y);return e.length?e:G(r)?r:[]}function Pe(e,t){if(C(t))for(Y in t)Pe(e,t[Y]);else if(G(t))e.removeAttribute(t);else for(Pe(e,"class"),Y=0,w=e.attributes,x=w.length;x>Y;++Y)w[Y]&&Pe(e,w[Y].name)}function We(e,t,n){if(C(t))for(Y in t)We(e,Y,t[Y]);else me(e,"data-"+t,n)}function ve(t,n,r){if(p(n))return ve(t,[n],G(r)?r:"")[0];e=[];for(Y in n)Y=n[Y],(Y=Be(t,"data-"+Y))&&e.push(Y);return e.length?e:G(r)?r:[]}function ye(e,t){if(C(t))for(Y in t)Pe(e,"data-"+t[Y]);else if(G(t))Pe(e,"data-"+t);else for(Y=0,w=e.attributes,x=w.length;x>Y;++Y)w[Y]&&"data-"===w[Y].name.slice(0,5)&&Pe(e,w[Y].name)}function Ke(e){return e&&e.preventDefault(),!1}function ke(e,t,n){if(t){for(e=He(e),Y=0,w=e.length;w>Y;++Y)t.addEventListener(e[Y],n,!1),Me("on:"+e[Y],n,et(t));return A}}function Ye(e,t,n){if(t){for(e=He(e),Y=0,w=e.length;w>Y;++Y)t.removeEventListener(e[Y],n,!1),Ue("on:"+e[Y],et(t));return T(t)&&t.id.split(":")[0]===dt+"-dom"&&Pe(t,"id"),A}}function we(e,t,n){e=He(e);var i,r="createEvent"in f;for(Y=0,w=e.length;w>Y;++Y)r?(i=f.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[Y],!0,!1),t.dispatchEvent(i)):ge("on:"+e[Y],n,et(t));return A}function xe(e,t,n){for(Y=0,w=t.length,x;w>Y;++Y)x=t[Y],e=e.replace(d(x)?x:O(s(x),"g"),n&&n[Y]||"");return e}function $e(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,G(t[n])?t[n]:e})}function Ve(e){return R(xe(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function _e(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=Qe(e);return{x:n-i.l,y:r-i.t}}function Qe(e){for($=e.offsetLeft,z=e.offsetTop;e=e.offsetParent;)$+=e.offsetLeft,z+=e.offsetTop;return{l:$,t:z}}function Xe(e){return{w:e.offsetWidth,h:e.offsetHeight}}function je(e,t){for(;(e=it(e))&&e!==t;);return e}function qe(e,t){t=He(t);for(Y in t)e.classList.add(t[Y])}function ze(t,n,r){if(p(n))return ze(t,[n],G(r)?r:"")[0];e=[];for(Y in n)Y=n[Y],t.classList.contains(Y)&&e.push(Y);return e.length?e:G(r)?r:!1}function Je(e,t){if(G(t)){t=He(t);for(Y in t)e.classList.remove(t[Y])}else Pe(e,"class")}function Ze(e,t,n){if(e=p(e)?f.createElement(e):e,C(n))for(Y in n)if(Z=n[Y],"classes"===Y)qe(e,Z);else if("data"===Y)for(w in Z)Z=Z[w],null===Z?ye(e,w):We(e,w,Z);else"css"===Y?p(Z)?me(e,"style",Z):null===Z?Pe(e,"style"):E(e,Z):S(Z)?e[Y]=Z:null===Z?Pe(e,Y):me(e,Y,C(Z)?Z.join(" "):""+Z);if(T(t))It(e,t);else if(C(t))for(Y in t)Z=t[Y],T(Z)?It(e,Z):Z!==!1&&tt(e,Z);else G(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=dt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(G(t)?t:"")}function rt(e,t){if(t!==!1&&(P=ot(e)))for(Y=0,w=P.length;w>Y;++Y)rt(P[Y]);tt(e,"")}function it(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function ft(e){return e&&e.previousSibling}function At(e){for(Y=-1;e=ft(e);)++Y;return Y}function at(e,t){return e&&p(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&S(t)?e===t(e):e===t}function st(t,n){if(!(n=G(n)?n:f))return[];if(e=[],p(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(Y=0,w=t.length;w>Y;++Y)e.push(t[Y]);return e}return[]}for(t=n.querySelectorAll(t),Y=0,w=t.length;w>Y;++Y)e.push(t[Y]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=it(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function Et(e,t){Q=it(e),Q&&Q.insertBefore(t,e)}function ct(e,t){Q=it(e),Q&&Q.insertBefore(t,lt(e))}function Ot(e,t){P=ot(e)[0],P?Et(P,t):It(e,t)}function Rt(e,t){It(e,t)}function It(e,t){e.appendChild(t)}function Lt(e,t){var n=ut(e);if(n){if(t!==!1)for(P=ot(e)[0];P;)Lt(P);n.removeChild(e)}}function Nt(e){rt(Ze(e,!1,{style:""})),Lt(e)}function Tt(e,t,n){return Ze(t||"div",n,{"class":e})}function Qt(e){return!e||G(e.active)&&!q.active}function Xt(){Dt._word&&Dt._words&&(Z=(Bt.value||"").replace(O(de[0]+"[^"+de[0]+de[1]+"]+?"+de[1],"g"),""),Y=(Z.match(/(\w+)/g)||[]).length,tt(wt,$e(Dt["_word"+(1===Y?"":"s")],[Y])))}function jt(e,t,n){return S(e)&&(e={click:e}),p(e.click)&&(e.click=(n[e.click]||{}).click),G(e.title)||(e.title=pt[t]||""),n[t]=e,e}function qt(e){St.exit(0,0,0);var t=ve(this,Ge),n=St.tools,r=n[t];return St.drop.target=e.currentTarget||e.target,!Qt(r)&&S(w=r.click)&&(w=w(e,A,t),ge("on:change",[e,A,t]),w===!1)?Ke(e):(A.select(),Ke(e))}function zt(e){if(z=this,(x=e.TE.key)(/^(escape|f10)$/))St.exit(1);else if(x("enter"))St.drop.target=z,we(Ee,z,[e]);else if(x("arrowright")&&($=lt(z))){for(;!at($,"a")&&$;)$=lt($);$&&$.focus()}else if(x("arrowleft")&&($=ft(z))){for(;!at($,"a")&&$;)$=ft($);$&&$.focus()}return Ke(e)}function Jt(){rt(mt,!1);var r,i,o,l,f,a,s,e=He(g.tools),t=dt+"-button",n=dt+"-separator";g.tools=e;for(a in e)s=e[a],i=St.tools[s],(i||i==={})&&(i=jt(i,s,St.tools),o=i.i||s,"|"!==o&&"<"!==o[0]&&(o=Ve(o)),l="|"!==o,f=Ve(o).replace(/\s/g,""),Vt=Tt(l?t+" "+t+"-"+f:n+" "+n+"-"+a,l?"a":"span"),l?(r=t+":"+f,me(Vt,{href:he,id:r,tabindex:-1}),We(Vt,Ge,s),o="<"===o[0]?o:'<i class="'+$e(Ct,[o])+'"></i>',Qt(i)&&qe(Vt,"x"),i.text&&(o=$e('<span class="'+dt+'-text">'+i.text+"</span>",[o]),qe(Vt,"text")),tt(Vt,o),Ze(Vt,!1,i.attributes||{}),!Vt.title&&(w=i.title)&&(Vt.title=C(w)?w[0]+(w[1]?" ("+w[1]+")":""):w),ke(Ee,Vt,qt),ke(ie,Vt,zt)):Vt.id=n+":"+a,St.tools[s].target=Vt,It(mt,Vt));ge("update.tools",[A])}function Zt(){St.keys=function(){var n,e=Object.keys(St.keys).sort().reverse(),t={};for(Y=0,w=e.length;w>Y;++Y)n=e[Y],t[n]=St.keys[n];return t}(),on(1),ge("update.keys",[A])}function en(e){Xt(),ge("on:change",[e,A])}function rn(t){function c(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=A.$(),r=n.before,i=n.after,o=r.slice(-1),l=i[0],f=n.length,a=St.keys,u=TE.keys_alias,E=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();_=t.TE.key(),tn[_]=1,e=Object.keys(tn).length,I(function(){A.record()},1);for(Y in a){x=c(Y),P=0;for(w in x)w=x[w],tn[u[w]||w]&&++P;if(x=x.length,P===x&&e===x&&(p(a[Y])&&(a[Y]=St.tools[a[Y]].click),$=a[Y]&&a[Y](t,A),$===!1))return Ke(t)}if(Se)for(Y in Se)if(V=Se[Y],V!==!1){if(_===V&&l===V)return"\\"===o?(A.insert(_,0),Ke(t)):(A.select(n.end+1),Ke(t));if(Y===_)return A.wrap(Y,V),Ke(t);if(o===Y&&l===V){if("backspace"===_&&r.slice(-2)!=="\\"+Y)return A.unwrap(Y,V),Ke(t);if(Te&&"enter"===_&&Y!==V)return A.tidy("\n"+E+Ne,"\n"+E),Ke(t)}}if(Te&&!f){if("backspace"===_&&O(s(Ne)+"$").test(r))return A.outdent(Ne),Ke(t);if("enter"===_&&O("(^|\\n)("+s(Ne)+")+.*$").test(r))return A.insert("\n"+E,0,1),Ke(t)}}function on(e){C(e)?delete tn[e.TE.key()]:tn={}}function ln(e){/^(focus|blur)$/.test(e.type)&&on(1),L(nn),nn=I(function(){en(e)},g.debounce||0)}function un(e){return fn=Pt,q=Xe(gt),Ke(e)}function En(e){fn===Pt&&E(Bt,{height:_e(Ut,e).y-q.h+De})}function cn(){fn=0}function On(){St.exit(1)}function Rn(){e=Xe(yt),ee=e.w,k=e.h,e=Xe(vt),An=e.w,an=e.h}function In(e,t){t&&ge("exit.modal."+t,[A]),we(Ee,vt,[e])}function Ln(t){fn=t.target,e=_e(yt,t),te=e.x,ne=e.y,Rn()}function Nn(t){var n=sn.header,r=sn.resize;fn===n||je(fn,n)===n?(e=_e(Ut,t),$=e.x-te,z=e.y-ne,E(yt,{left:(ee>An?$:c($,0,An-ee))+De,top:(k>an?z:c(z,0,an-k))+De})):fn===r&&(e=_e(yt,t),q=Xe(r),E(yt,{width:e.x+q.w/4+De,height:e.y+q.h/4+De}))}function Tn(){fn=0}function Sn(e,t,n){return{header:e,body:t,footer:n}}function Fn(e){m=St.drop.target,B=Kt,P=e&&e.target||0,(!P||P!==m&&je(P,m)!==m)&&(St.drop.target=0,Nt(Kt),Ye(Ee,f,Fn),Ye(Re,l,Fn),St.exit(e.target===b))}function pn(t){function i(){e&&(Q=Xe(e),E(j,{width:Q.w+De,height:Q.h+De}))}var n=A.get(),r="";return-1===n.indexOf("</html>")&&(r='<!DOCTYPE html><html dir="'+g.dir+'"><head><meta charset="utf-8"><style>'+g.css+"</style></head><body>"+n+"</body></html>"),j=Ze("iframe",!1,{"class":dt+"-portal",src:"data:text/html,"+encodeURIComponent(r)}),!ut(vt)&&n?(St.overlay(j,1,function(){e=ot(vt)[0],i(),ke(Re,l,i),ge("enter.overlay.preview",[t,A,[n,r],e])}),dn=!0):(Ye(Re,l,i),On(),dn=!1),Ke(t)}var m,B,P,v,y,k,Y,w,x,$,V,_,e,Q,j,q,z,Z,ee,te,ne,t="⌘",n="…",i="⇥",o="⇧",l=window,f=document,A=this,a=A._,s=a.x,u=a.extend,E=a.css,c=a.edge,O=a.pattern,R=a.trim,I=a.timer.set,L=a.timer.reset,N=A.is,T=N.e,S=N.f,F=N.i,C=N.o,d=N.r,p=N.s,G=function(e){return!N.x(e)},h=f.documentElement,H=(f.head,f.body),b=A.target,M={},U=function(){},g=u({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{preview:["Preview","F5"],tools:["Focus Tools","F10"],undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",oe="keyup",le="copy",fe="cut",Ae="paste",ae="touchstart mousedown",se="touchend mouseup",ue="touchmove mousemove",Ee="click",ce="focus",Oe="blur",Re="orientationchange resize",Ie=Oe+" "+le+" "+fe+" "+ce+" input "+ie+" "+Ae,Le=g.languages,Ne=g.tab,Te=g.auto_tab,Se=g.auto_close,Fe=g.unit[0][0],de=(g.unit[0][1],g.unit[1][0]),pe=g.unit[1][1],Ge="tool-id",he="javascript:;",De="px",St=A.ui={};A.tidy=function(e,t){var n=A.$(),r=R(n.before)?e:"",i=R(n.after)?G(t)?t:e:"";return A.trim(r,i)},A.i=function(){return R(A.replace(/\s+/g," "))},A.format=function(e,t,n,r){C(e)||(e=[e]),G(n)||(n=" "),G(r)||(r="");var i=A.h,o=A[0]().$(),l=(e[0]?Fe[0]+e[0]+Fe[1]:"")+r,f=r+(e[0]?Fe[0]+Fe[2]+(e[1]||e[0].split(O("("+pe[3]+")+"))[0])+Fe[1]:""),a=s(l),u=s(f),E=O("^"+a+"([\\s\\S]*?)"+u+"$"),c=O(a+"$"),R=O("^"+u),I=o.before,L=o.after;return o.length?n=!1:A.insert(Le.placeholders[""]),A.toggle(t?!E.test(o.value):!c.test(I)&&!R.test(L),[function(e){e.unwrap(l,f,1).tidy(O(de[0]+"[^"+de[0]+de[1]+de[2]+"]+?"+de[1]+"$").test(I)?"":n,O("^"+de[0]+de[2]+"[^"+de[0]+de[1]+"]+?"+de[1]).test(L)?"":n).wrap(l,f,t)},function(e){e.unwrap(l,f,t)}])[i]()};var Vt,Ft=g.classes,Ct=Ft.i,dt=Ft[""],pt=Le.tools,Gt=Le.buttons,ht=Le.labels,Dt=Le.others,Ht=dt+"-textarea "+dt+"-content block",bt=Tt(dt),Mt=Tt(dt+"-header"),Ut=Tt(dt+"-body"),gt=Tt(dt+"-footer"),mt=Tt(dt+"-tool"),Bt=Ze(b,!1,g.attributes),Pt=Tt(dt+"-resize s"),Wt=Tt(dt+"-description"),vt=Tt(dt+"-overlay"),yt=Ze("div"),Kt=Ze("div"),kt=Ze("div"),Yt=Tt("left","span"),wt=Tt("right","span"),xt=Tt(dt+"-preview","a"),$t=0;g.suffix||(g.suffix=Fe[1]);var tn={},nn=null;A.create=function(e,t){C(e)&&(g=u(g,e));var n=ut(Bt);return qe(Bt,Ht),n&&at(n,"p")?(Et(n,bt),$t=n,Lt(n,!1)):Et(Bt,bt),bt.dir=g.dir,It(bt,Mt),It(bt,Ut),It(bt,gt),It(bt,Pt),It(Ut,Bt),g.tools&&(It(Mt,mt),It(gt,Wt),It(Wt,Yt),It(Wt,wt)),ke(ie,Bt,rn),ke(oe,Bt,on),ke(Ie,Bt,ln),ke(ae,Pt,un),ke(ue,f,En),ke(se,H,cn),(q=pt.preview)&&(me(xt,{href:he,title:C(q)?q[0]+(q[1]?" ("+q[1]+")":""):q}),It(Yt,xt),tt(xt,Dt.preview)),en(null),Jt(),Zt(),0!==t?ge("create",[A]):A},A.update=function(e,t){return ze(Bt,He(Ht),0)&&A.destroy(0),(0!==t?ge("update",[A]):A).create(e,0)},A.destroy=function(e){return ze(Bt,He(Ht),0)?(St.exit(0,0,0),Je(Bt,Ht),g.tools=be(g.tools),g.keys&&(Ye(ie,Bt,rn),Ye(oe,Bt,on)),Ye(ae,Pt,un),Ye(ue,f,En),Ye(se,f,cn),Ye(Ie,Bt,ln),$t?(Et(bt,$t),It($t,Bt),$t=0):Et(bt,Bt),Nt(bt),0!==e?ge("destroy",[A]):A):A};var fn=0,te=0,ne=0,ee=0,k=0,An=0,an=0,sn={};St.exit=function(e,t,n){if(y={overlay:function(){Ye(Ee,vt,On),Nt(vt)},modal:function(){Ye(ae,Ut,Ln),Ye(ue,Ut,Nn),Ye(se,f,Tn),Ye(Ee,sn.x,In),Nt(yt)},drop:function(){Nt(Kt)},bubble:function(){Nt(kt)}},t)if(C(t))for(Y in t)Y=t[Y],y[Y]&&y[Y](),0!==n&&ge("exit."+Y,[A]);else y[t]&&y[t](),0!==n&&ge("exit."+Y,[A]);else for(Y in y)y[Y]();return e&&A.select(),0!==n&&ge("exit",[A]),A},St.overlay=function(e,t,n){return St.exit(0,0,0),on(1),It(Ut,Ze(vt,e.length||T(e)?Tt(dt+"-overlay-content","div",e):"")),t&&ke(Ee,vt,On),S(n)?n(vt):Ze(vt,n),ge("enter.overlay",[A]),ge("enter",[A]),A},St.overlay.fit=function(){},St.modal=function(){St.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=dt+"-modal";C(t)&&(t="default",n=e[0],r=e[1]),$=Ve(t),Ze(yt,!1,{"class":i+" "+$}),G(n.body)&&(n.body=Ze("div",n.body,{"class":i+"-content "+$}));for(Y in n)i[1]=Y,sn[Y]=Tt(i+"-"+$e(Y,i)+" "+$,0,n[Y]);return sn.x=Tt(dt+"-x "+$),sn.resize=Tt(dt+"-resize se "+$),rt(yt),It(Ut,Ze(yt,sn,{style:""})),St.modal.fit(),ct(yt,vt),ke(Ee,sn.x,In),ke(ae,sn.header,Ke),ke(ae,sn.resize,Ke),ke(ae,Ut,Ln),ke(ue,Ut,Nn),ke(se,f,Tn),S(r)&&(sn.overlay=vt,sn.modal=yt,r(sn)),ge("enter.modal."+t,[A]),ge("enter.modal",[A]),ge("enter",[A]),A},St.modal.fit=function(e){return Rn(),$=An/2-ee/2,z=an/2-k/2,C(e)?(G(e[0])&&($=e[0]),G(e[1])&&(z=e[1])):($=c($,0),z=c(z,0)),E(yt,{left:$+De,top:z+De,"min-width":ee+De,"min-height":k+De,visibility:"visible"}),ge("fit.modal",[A]),ge("fit",[A]),A};var Cn={"class":dt+"-button",name:"y"};St.alert=function(e,t,n,r){var i=Ze("button",Gt.okay,Cn),o="alert";return n=n||U,C(e)&&(o+=":"+e[0],e=e[1]||e[0]),ke(Ee,i,function(e){return n(e,A),In(e,o+".y"),Ke(e)}),ke(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(we(Ee,i,[e]),Ke(e)):void 0}),St.modal(o,Sn(e,t,i),r),i.focus(),A},St.confirm=function(e,t,n,r,i){function s(e){return S(n)&&n(e,A),In(e,f+".y"),Ke(e)}function u(e){return S(r)&&r(e,A),In(e,f+".n"),Ke(e)}var a,o=Ze("button",Gt.okay,Cn),l=Ze("button",Gt.cancel,Cn),f="confirm";return l.name="n",C(e)&&(f+=":"+e[0],e=e[1]||e[0]),ke(Ee,o,s),ke(Ee,l,u),ke(ie,o,function(e){return a=e.TE.key,a("arrowright")?(l.focus(),Ke(e)):a("arrowleft")?Ke(e):a("enter")?(s(e),Ke(e)):a("escape")?(In(e,f+".y"),Ke(e)):void 0}),ke(ie,l,function(e){return a=e.TE.key,a("arrowright")?Ke(e):a("arrowleft")?(o.focus(),Ke(e)):a("enter")?(u(e),Ke(e)):a("escape")?(In(e,f+".n"),Ke(e)):void 0}),St.modal(f,Sn(e,t,[o,l]),i),l.focus(),A},St.prompt=function(e,t,n,r,i,o){function O(){a.focus(),"placeholder"in a&&a.select()}function I(e){return Ke(e)}function L(e){return E=a.value,!n||R(E)&&E!==t?(In(e,s+".y"),Ke(e),r(e,A,E!==t?E:"",t)):(O(),I(e))}function N(e){return In(e,s+".n"),Ke(e)}var E,c,l=Ze("button",Gt.okay,Cn),f=Ze("button",Gt.cancel,Cn),a=Ze("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":dt+"-input block"}),s="prompt",u=[];if(C(e)&&(s+=":"+e[0],e=e[1]||e[0]),S(i)&&(o=i,i=0),1===i)a=Ze("textarea",t,{placeholder:t.split("\n")[0],"class":dt+"-textarea block"});else if(2===i){for(Y in t)u.push(Ze("option",t[Y],{value:Y,selected:Y===n||null}));a=Ze("select",u,{"class":dt+"-select block"})}return r=r||U,a.name="data",f.name="n",ke(ie,a,function(e){return c=e.TE.key,c("enter")?L(e):c("escape")||c("backspace")&&!this.value?N(e):c("arrowup")?I(e):c("arrowdown")?(l.focus(),Ke(e)):void 0}),ke(ie,l,function(e){return c=e.TE.key,c("enter")?L(e):c("escape")?N(e):c("arrowup")?(a.focus(),Ke(e)):c("arrowright")?(f.focus(),Ke(e)):c(/^arrow(down|left)$/)?I(e):void 0}),ke(ie,f,function(e){return c=e.TE.key,c(/^(enter|escape)$/)?N(e):c("arrowup")?(a.focus(),Ke(e)):c(/^arrow(right|down)$/)?I(e):c("arrowleft")?(l.focus(),Ke(e)):void 0}),ke(Ee,l,L),ke(Ee,f,N),St.modal(s,Sn(e,a,[l,f]),o),O(),A},St.drop=function(){St.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),$=Ve(t),rt(Kt),It(H,Ze(Kt,!1,{"class":dt+"-drop "+$})),S(n)?n(Kt):Ze(Kt,n),St.drop.fit(),ke(Ee,f,Fn),ke(Re,l,Fn),ge("enter.drop."+t,[A]),ge("enter.drop",[A]),A},St.drop.fit=function(t){return m=Xe(h),B=Xe(Kt),P=St.drop.target,$=m.w/2-B.w/2,z=m.h/2-B.h/2,!G(t)&&P&&(e=Qe(P),$=e.l,z=e.t+Xe(P).h),C(t)?(G(t[0])&&($=t[0]),G(t[1])&&(z=t[1])):($=c($,0,Math.max(m.w,l.innerWidth)-B.w),z=c(z,0,Math.max(m.h,l.innerHeight)-B.h)),E(Kt,{left:$+De,top:z+De,visibility:"visible"}),ge("fit.drop",[A]),ge("fit",[A]),A},St.menu=function(e,t,n,r){t=!C(t)&&n[t]&&n[t].text||t;var a,i=St.tools,o='<span class="'+dt+'-current menu">%1</span>',l="",f=0;return t===!1?St.tool(e,t):(C(t)&&(l=t[0],l="<"===l[0]?l:'<i class="'+$e(Ct,[l])+'"></i>',t=G(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,o=l+(0!==t?" "+o:"")),St.tool(e,{i:l,text:t?$e(o,[t,l]):0,click:function(s){var E=St.drop.target=i[e].target;return St.drop("menu menu-"+Ve(e),function(s){function c(e){return z=this,V=n[ve(z,Ge)],V=p(V)?i[V]:V||{},_=nt(z),!Qt(V)&&S(r=V.click)&&(r=r(e,A),t!==!1&&E&&(P=ot(E)[0]||E,at(P,"i")||tt(P,$e(o,[_,l])),C(V.text)&&(P=ot(P)[0])&&at(P,"i")&&(Je(P),qe(P,$e(Ct,[V.text[0]])))),r===!1)?Ke(e):(A.select(),Ke(e))}function O(e){if(z=this,(x=e.TE.key)("escape"))St.exit(1);else if(x("enter"))we(Ee,z,[e]);else if(x("f10")&&E)E.focus();else if(x("arrowdown")&&($=lt(z))){for(;!at($,"a")&&$;)$=lt($);$&&$.focus()}else if(x("arrowup")&&($=ft(z))){for(;!at($,"a")&&$;)$=ft($);!$&&E?(St.exit(),E.focus()):$&&$.focus()}else x("arrowup")&&E&&(St.exit(),E.focus());return Ke(e)}for(r in n)if(a=n[r],ee="%"===r[0],a=p(a)&&!ee?i[a]:a){a=jt(a,r,i);var R={href:ee?null:he,"class":dt+"-"+(ee?"label":"button")};ee?w=ht[e]&&ht[e][+r.slice(1)-1]||r:(R.data={},R.data[Ge]=r,w=pt[r]||r),j=a.text,j=C(j)?j[1]||"":j,w=C(w)?w[0]:w,q=Ze(ee?"span":"a",ee?"<span>"+(w||"%"+f)+"</span>":a.text||w,u(R,a.attributes||{})),!q.title&&(z=a.title)&&(q.title=C(z)?z[0]+(z[1]?" ("+z[1]+")":""):z),ee?me(q,{id:dt+"-label:"+f}):(Qt(a)&&qe(q,"x"),ke(Ee,q,c),ke(ie,q,O)),n[r]=a,It(s,q),++f}I(function(){st("a",s)[0].focus()},1)}),!1}},r),ke(ie,i[e].target,function(t){return t.TE.key("arrowdown")?(St.drop.target=this,i[e].click(v,A),Ke(t)):void 0}),i[e].data=n,A)},St.bubble=function(){St.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),$=Ve(t),rt(kt),It(H,Ze(kt,!1,{"class":dt+"-bubble "+$})),S(n)?n(kt):Ze(kt,n),St.bubble.fit(),ge("enter.bubble."+t,[A]),ge("enter.bubble",[A]),A},St.bubble.fit=function(t){q=A.$(1),e=Qe(Bt),k=E(Bt,"line-height");var n="border-",r="-width";$=q.caret[0].x+e.l-Bt.scrollLeft,z=q.caret[1].y+e.t+k-Bt.scrollTop,B=E(Ut,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Xe(Ut),o=Xe(kt),l=B[0]+B[1],f=B[2]+B[3];return C(t)?(G(t[0])&&($=t[0]),G(t[1])&&(z=t[1])):($=c($,e.l,e.l+i.w-o.w-f),z=c(z,e.t,e.t+i.h-o.h-l)),E(kt,{left:$+De,top:z+De,visibility:"visible"}),ge("fit.bubble",[A]),ge("fit",[A]),A},St.overlay.exit=function(e){return St.exit(e,"overlay")},St.modal.exit=function(e){return St.exit(e,"modal")},St.drop.exit=function(e){return St.exit(e,"drop")},St.bubble.exit=function(e){return St.exit(e,"bubble")},St.tool=function(e,t,n){return w="","|"!==e&&(g.tools=g.tools.filter(function(t,n){return t===e?(w=n,!1):!0})),t===!1?delete St.tools[e]:("|"===e?(n=t,t={}):(S(t)&&(t={click:t}),St.tools[e]=u(St.tools[e]||{},t),G(n)||""===w||(n=w)),F(n)?g.tools.splice(n,0,e):g.tools.push(e)),Jt(),A},St.key=function(e,t){return g.keys?(t===!1?delete St.keys[e]:St.keys[e]=t,Zt(),A):A};var dn=!1;return ke(Ee,xt,pn),St.tools={"|":{},preview:{i:"eye",click:function(e){return dn?(On(),dn=!1):pn(e),!1}},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Ne),!1},outdent:function(e,t){return t.outdent(Ne),!1}},St.keys={"control+y":"redo","control+z":"undo",f5:"preview",f10:function(e,t){return st("a",mt)[0].focus(),!1},"shift+tab":Te?"outdent":0,tab:Te?"indent":0,escape:function(e,t){return xt.focus(),!1}},St.el={container:bt,header:Mt,body:Ut,footer:gt,overlay:vt,modal:yt,drop:Kt,bubble:kt},A.config=g,u(A._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=e.getSeconds(),f=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>l&&(l="0"+l),10>f&&(f="0"+f),[""+t,""+n,""+r,""+i,""+o,""+l,""+f]},replace:xe,format:$e,dom:{set:It,reset:Lt,get:st,id:et,copy:function(e,t){return e.cloneNode(G(t)?t:!0)},classes:{set:qe,reset:Je,get:ze},attributes:{set:me,reset:Pe,get:Be},data:{set:We,reset:ye,get:ve},is:at,offset:Qe,point:_e,size:Xe,content:{set:tt,reset:rt,get:nt},closest:je,parent:it,children:ot,next:lt,previous:ft,index:At,before:Et,after:ct,prepend:Ot,append:Rt},el:Ze,event:{set:ke,reset:Ye,fire:we,x:Ke},hooks:M,hook:{set:Me,reset:Ue,fire:ge}}),St};