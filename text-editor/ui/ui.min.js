/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function ne(e,t,n){return w(e)?w(t)?(w(q[e])||(q[e]={}),w(n)||(n=Object.keys(q[e]).length),q[e][n]=t,s):q[e]:q}function re(e,t){return w(e)?w(t)&&w(q[e])?(delete q[e][t],s):(q[e]={},s):(q={},s)}function ie(e,t,n){if(!w(q[e]))return q[e]={},s;if(w(n))w(q[e][n])&&q[e][n].apply(s,t);else for(var r in q[e])q[e][r].apply(s,t);return s}function le(e,t,n){if(y(t))for(var r in t)le(e,r,t[r]);else e.setAttribute(t,n)}function oe(e,t,n){return e.getAttribute(t)||(w(n)?n:!1)}function fe(e,t){if(y(t))for(var n in t)fe(e,t[n]);else e.removeAttribute(t)}function se(e,t,n){if(y(t))for(var r in t)le(e,"data-"+r,t[r]);else le(e,"data-"+t,n)}function ae(e,t,n){return oe(e,"data-"+t,n)}function ue(e,t){if(y(t))for(var n in t)fe(e,"data-"+t[n]);else fe(e,"data-"+t)}function ce(e){return e&&e.preventDefault(),!1}function de(e,t,n){return t?(t.addEventListener(e,n,!1),ne("on:"+e,n,qe(t)),s):void 0}function pe(e,t,n){return t?(t.removeEventListener(e,n,!1),re("on:"+e,qe(t)),v(t)&&t.id.split(":")[0]===Je+"-dom"&&fe(t,"id"),s):void 0}function he(e,t,n){if("createEvent"in f){var r=f.createEvent("HTMLEvents");r.data=n,r.initEvent(e,!0,!1),t.dispatchEvent(r)}else ie("on:"+e,n,qe(t));return s}function ge(e,t,n){e=g(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)de(e[r],t,n);return s}function me(e,t,n){e=g(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)pe(e[r],t,n);return s}function ve(e,t,n){e=g(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)he(e[r],t,n);return s}function be(e,t){return setTimeout(e,t)}function $e(e){return clearTimeout(e)}function ye(e,t,n){for(var l,r=0,i=t.length;i>r;++r)l=t[r],e=e.replace(k(l)?l:h(u(l),"g"),n&&n[r]||"");return e}function ke(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,w(t[n])?t[n]:e})}function xe(e){return g(ye(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function we(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=_e(e);return{x:n-i.l,y:r-i.t}}function _e(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{l:t,t:n}}function Ee(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Te(e,t){for(;(e=Ie(e))&&e!==t;);return e}function Oe(e,t,n){if(e=x(e)?f.createElement(e):e,y(n)){var r,i;for(i in n)r=n[i],"style"===i?x(r)?le(e,i,r):null===r?fe(e,i):e=d(e,r):b(r)?e[i]=r:null===r?fe(e,i):le(e,i,y(r)?r.join(" "):""+r)}if(v(t))Be(e,t);else if(y(t)){var r,i;for(i in t)r=t[i],v(r)?Be(e,r):r!==!1&&ze(e,r)}else w(t)&&t!==!1&&ze(e,t);return e}function qe(e){var t=e.id;return t||(t=Je+"-dom:"+Date.now(),e.id=t),t}function Se(e,t){Le(e,t,0)||(e.className=g(e.className+" "+(y(t)?t.join(" "):t)))}function Le(e,t,n){var r=e.className;return h("(^|\\s)"+t+"(\\s|$)").test(r)?r.split(/\s+/):w(n)?n:[]}function De(e,t){e.className=g(e.className.replace(h("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function ze(e,t){e.innerHTML=t}function Me(e,t){return e.innerHTML||(w(t)?t:"")}function je(e,t){if(t!==!1){var r,n=e.children;for(r in n)je(n[r])}ze(e,"")}function Ie(e){return e.parentElement||e.parentNode}function Re(e){return e.children||[]}function Ne(e){return e.nextElementSibling||e.nextSibling}function Ce(e){return e.previousElementSibling||e.previousSibling}function He(e,t){return(t||f).querySelectorAll(e)||[]}function Fe(e,t){var n=Ie(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function Ye(e,t){Ie(e).insertBefore(t,e)}function Ue(e,t){Ie(e).insertBefore(t,Ne(e))}function Pe(e,t){var n=Re(e)[0];n?Ye(n,t):Be(e,t)}function Ae(e,t){Be(e,t)}function Be(e,t){e.appendChild(t)}function We(e,t){var n=Fe(e);if(n){if(t!==!1)for(var r=Re(e)[0];r;)We(r);n.removeChild(e)}}function Xe(e){je(Oe(e,!1,{style:""})),We(e)}function Ke(e,t,n){return Oe(t||"div",n,{"class":e})}function kt(){if(et._word&&et._words){var e=(ft.value||"").replace(h(J[0]+"[^"+J[0]+J[1]+"]+?"+J[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;ze(gt,ke(et["_word"+(1===t?"":"s")],[t]))}}function xt(e,t){b(e)&&(e.click=e),x(e.click)&&(e.click=(Ze.tools[e.click]||{}).click),w(e.active)||(e.active=1),w(e.title)||(e.title=Qe[t]||"")}function wt(){je(ot,!1);var r,i,l,o,f,a,u,e=x(L.tools)?g(L.tools).split(/\s+/):L.tools,t=Je+"-button",n=Je+"-separator";L.tools=e;for(f in e)u=e[f],i=Ze.tools[u],i&&(xt(i,u),"|"!==(l=i.i||u)&&(l=xe(l)),o="|"!==l,$t=Ke(o?t:n,o?"a":"span"),o&&(r=t+":"+xe(u).replace(/\s/g,""),le($t,{href:ee,id:r,"tab-index":-1}),se($t,V,u),l='<i class="'+ke(Ge.i,[l])+" "+r+'"></i>',i.active||Se($t,"x"),i.text&&(l=ke('<span class="'+Je+'-text">'+i.text+"</span>",[l]),Se($t,"text")),ze($t,l),Oe($t,!1,i.attributes||{}),!$t.title&&(a=i.title)&&($t.title=y(a)?a[0]+(a[1]?" ("+a[1]+")":""):a),ge(H,$t,Dt)),Be(ot,$t));ie("update.tools",[s])}function _t(){Ze.keys=function(){var n,r,e=Object.keys(Ze.keys).sort().reverse(),t={};for(n=0,r=e.length;r>n;++n)t[e[n]]=Ze.keys[e[n]];return t}(),St(1),ie("update.keys",[s])}function Et(e){kt(),ie("on:change",[e,s])}function qt(e){function y(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var d,p,g,m,v,$,t=s.$(),n=t.before,r=t.after,i=n.slice(-1),l=r[0],o=t.length,f=Ze.keys,a=TE.keys_alias,c=(n.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),b=e.TE.key();Tt[b]=1,$=Object.keys(Tt).length,be(function(){s.record()},1);for(d in f){var k=0;g=y(d);for(p in g)p=g[p],Tt[a[p]||p]&&++k;if(g=g.length,k===g&&$===g&&(x(f[d])&&(f[d]=Ze.tools[f[d]].click),m=f[d]&&f[d](e,s),m===!1))return ce(e)}if(K)for(d in K)if(v=K[d],v!==!1){if(b===v&&l===v)return"\\"===i?(s.insert(b,0),ce(e)):(s.select(t.end+1),ce(e));if(d===b)return s.wrap(d,v),ce(e);if(i===d&&l===v){if("backspace"===b&&n.slice(-2)!=="\\"+d)return s.unwrap(d,v),ce(e);if(X&&"enter"===b&&d!==v)return s.tidy("\n"+c+W,"\n"+c).scroll(!0),ce(e)}}if(X&&!o){if("backspace"===b&&h(u(W)+"$").test(n))return s.outdent(W).scroll(!0),ce(e);if("enter"===b&&h("(^|\\n)("+u(W)+")+.*$").test(n))return s.insert("\n"+c,0,1).scroll(!0),ce(e)}}function St(e){y(e)?delete Tt[e.TE.key()]:Tt={}}function Lt(e){/^focus|blur$/.test(e.type)&&St(1),$e(Ot),Ot=be(function(){Et(e)},L.debounce||0)}function Dt(e){Ze.exit(0,0,0);var i,t=ae(this,V),n=Ze.tools,r=n[t];return bt=e.currentTarget||e.target,r&&r.active&&r.click&&(i=n[t].click(e,s,t),ie("on:change",[e,s,t]),i===!1)?ce(e):(s.select(),ce(e))}function Yt(e){return zt=st,Ft=Ee(lt),ce(e)}function Ut(e){zt===st&&d(ft,{height:we(it,e).y-Ft.h+te})}function Pt(){zt=0}function At(){Ze.exit(1)}function Bt(){e=Ee(ct),It=e.w,Rt=e.h,e=Ee(ut),Nt=e.w,Ct=e.h}function Wt(e,t){t&&ie("exit.modal."+t,[s]),ve(H,ut,[e])}function Xt(t){zt=t.target,e=we(ct,t),Mt=e.x,jt=e.y,Bt()}function Kt(t){var i,l,n=Ht.header,r=Ht.resize;zt===n||Te(zt,n)===n?(e=we(it,t),i=e.x-Mt,l=e.y-jt,d(ct,{left:(It>Nt?i:p(i,0,Nt-It))+te,top:(Rt>Ct?l:p(l,0,Ct-Rt))+te})):zt===r&&(e=we(ct,t),Ft=Ee(r),d(ct,{width:e.x+Ft.w/4+te,height:e.y+Ft.h/4+te}))}function Zt(){zt=0}function Gt(e,t,n){return{header:e,body:t,footer:n}}function Jt(e){var t=bt,r=e&&e.target||0;(!r||r!==t&&Te(r,t)!==t)&&(bt=0,Xe(dt),me(H,T,Jt),Ze.exit(e.target===O))}function Vt(e){function f(){i&&(l=Ee(i),d(r,{width:l.w+te,height:l.h+te}))}var r,i,l,t=s.get(),n="";return-1===t.indexOf("</html>")&&(n='<!DOCTYPE html><html dir="'+L.dir+'"><head><meta charset="utf-8"><style>'+L.css+"</style></head><body>"+t+"</body></html>"),r=Oe("iframe",!1,{"class":Je+"-portal",src:"data:text/html,"+encodeURIComponent(n)}),!Fe(ut)&&t?Ze.overlay(r,1,function(){i=Re(ut)[0],f(),ge(P,o,f),ie("enter.overlay.preview",[e,s,[t,n],i])}):(me(P,o,f),At()),ce(e)}var t="⌘",n="…",i="⇥",l="⇧",o=window,f=document,s=this,a=s._,u=a.x,c=a.extend,d=a.css,p=a.edge,h=a.pattern,g=a.trim,m=s.is,v=m.e,b=m.f,$=m.i,y=m.o,k=m.r,x=m.s,w=function(e){return!m.x(e)},_=f.documentElement,T=(f.head,f.body),O=s.target,q={},S=function(){},L=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",l+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),D="keydown",z="keyup",M="copy",j="cut",I="paste",R="touchstart mousedown",N="touchend mouseup",C="touchmove mousemove",H="click",F="focus",Y="blur",U="input",P="orientationchange resize",A=Y+" "+M+" "+j+" "+F+" "+U+" "+D+" "+I,B=L.languages,W=L.tab,X=L.auto_tab,K=L.auto_close,Z=L.unit[0][0],J=(L.unit[0][1],L.unit[1][0]),Q=L.unit[1][1],V="tool-id",ee="javascript:;",te="px",Ze=s.ui={};s.tidy=function(e,t){var n=s.$(),r=g(n.before)?e:"",i=g(n.after)?w(t)?t:e:"";return s.trim(r,i)},s.i=function(){return g(s.replace(/\s+/g," "))},s.format=function(e,t,n,r){y(e)||(e=[e]),w(n)||(n=" "),w(r)||(r="");var i=s[0]().$(),l=(e[0]?Z[0]+e[0]+Z[1]:"")+r,o=r+(e[0]?Z[0]+Z[2]+(e[1]||e[0].split(h("("+Q[3]+")+"))[0])+Z[1]:""),f=u(l),a=u(o),c=h("^"+f+"([\\s\\S]*?)"+a+"$"),d=h(f+"$"),p=h("^"+a),g=i.before,m=i.after;return i.length?n=!1:s.insert(B.placeholders[""]),s.toggle(t?!c.test(i.value):!d.test(g)&&!p.test(m),[function(e){e.unwrap(l,o,1).tidy(h(J[0]+"[^"+J[0]+J[1]+J[2]+"]+?"+J[1]+"$").test(g)?"":n,h("^"+J[0]+J[2]+"[^"+J[0]+J[1]+"]+?"+J[1]).test(m)?"":n).wrap(l,o,t)[1]()},function(e){e.unwrap(l,o,t)[1]()}])};var $t,Ge=L.classes,Je=Ge[""],Qe=B.tools,Ve=B.buttons,et=B.others,tt=Je+"-textarea "+Je+"-content block",nt=Ke(Je),rt=Ke(Je+"-header"),it=Ke(Je+"-body"),lt=Ke(Je+"-footer"),ot=Ke(Je+"-tool"),ft=Oe(O,!1,L.attributes),st=Ke(Je+"-resize s"),at=Ke(Je+"-description"),ut=Ke(Je+"-overlay"),ct=Oe("div"),dt=Oe("div"),pt=Oe("div"),ht=Ke("left","span"),gt=Ke("right","span"),mt=Ke(Je+"-preview","a"),vt=0,bt=0;L.suffix||(L.suffix=Z[1]);var Tt={},Ot=null;s.create=function(e,t){y(e)&&(L=c(L,e));var n=Fe(ft);if(Se(ft,tt),n&&"P"===n.nodeName?(Ye(n,nt),vt=n,We(n,!1)):Ye(ft,nt),nt.dir=L.dir,Be(nt,rt),Be(nt,it),Be(nt,lt),Be(nt,st),Be(it,ft),L.tools&&(Be(rt,ot),Be(lt,at),Be(at,ht),Be(at,gt)),ge(D,ft,qt),ge(z,ft,St),ge(A,ft,Lt),ge(R,st,Yt),ge(C,T,Ut),ge(N,T,Pt),et.preview){var r=Qe.preview;le(mt,{href:ee,title:y(r)?r[0]+(r[1]?" ("+r[1]+")":""):r}),Be(ht,mt),ze(mt,et.preview)}return Et(null),wt(),_t(),0!==t?ie("create",[s]):s},s.update=function(e,t){return Le(ft,tt,0)&&s.destroy(0),(0!==t?ie("update",[s]):s).create(e,0)},s.destroy=function(e){return Le(ft,tt,0)?(Ze.exit(0,0,0),De(ft,tt),y(L.tools)&&(L.tools=L.tools.join(" ")),L.keys&&(me(D,ft,qt),me(z,ft,St)),me(R,st,Yt),me(C,T,Ut),me(N,T,Pt),me(A,ft,Lt),vt?(Ye(nt,vt),Be(vt,ft),vt=0):Ye(nt,ft),Xe(nt),0!==e?ie("destroy",[s]):s):s};var e,Ft,zt=0,Mt=0,jt=0,It=0,Rt=0,Nt=0,Ct=0,Ht={};Ze.exit=function(e,t,n){var i,r={overlay:function(){me(H,ut,At),Xe(ut)},modal:function(){me(R,it,Xt),me(C,it,Kt),me(N,T,Zt),me(H,Ht.x,Wt),Xe(ct)},drop:function(){Xe(dt)},bubble:function(){Xe(pt)}};if(t)if(y(t))for(i in t)i=t[i],r[i]&&r[i](),0!==n&&ie("exit."+i,[s]);else r[t]&&r[t](),0!==n&&ie("exit."+i,[s]);else for(i in r)r[i]();return e&&s.select(),0!==n&&ie("exit",[s]),s},Ze.overlay=function(e,t,n){return Ze.exit(0,0,0).blur(),St(1),Be(it,Oe(ut,e.length||v(e)?Ke(Je+"-overlay-content","div",e):"")),t&&ge(H,ut,At),b(n)?n(ut):Oe(ut,n),ie("enter.overlay",[s]),ie("enter",[s]),s},Ze.overlay.fit=function(){},Ze.modal=function(){Ze.overlay("",1);var l,f,e=arguments,t=e[0],n=e[1],r=e[2],i=Je+"-modal";y(t)&&(t="default",n=e[0],r=e[1]),f=xe(t),Oe(ct,!1,{"class":i+" "+f}),w(n.body)&&(n.body=Oe("div",n.body,{"class":i+"-content "+f}));for(l in n)i[1]=l,Ht[l]=Ke(i+"-"+ke(l,i)+" "+f,0,n[l]);return Ht.x=Ke(Je+"-x "+f),Ht.resize=Ke(Je+"-resize se "+f),je(ct),Be(it,Oe(ct,Ht,{style:""})),Ze.modal.fit(),Ue(ct,ut),ge(H,Ht.x,Wt),ge(R,Ht.header,ce),ge(R,Ht.resize,ce),ge(R,it,Xt),ge(C,it,Kt),ge(N,T,Zt),b(r)&&(Ht.overlay=ut,Ht.modal=ct,r(Ht)),ie("enter.modal."+t,[s]),ie("enter.modal",[s]),ie("enter",[s]),s},Ze.modal.fit=function(e){Bt();var t=Ct/2-Rt/2,n=Nt/2-It/2;return y(e)?(n=e[0],t=e[1]):(n=p(n,0),t=p(t,0)),d(ct,{left:n+te,top:t+te,"min-width":It+te,"min-height":Rt+te,visibility:"visible"}),ie("fit.modal",[s]),ie("fit",[s]),s};var Qt={"class":Je+"-button",name:"y"};return Ze.alert=function(e,t,n,r){var i=Oe("button",Ve.okay,Qt),l="alert";return n=n||S,y(e)&&(l+=":"+e[0],e=e[1]||e[0]),ge(H,i,function(e){return n(e,s),Wt(e,l+".y"),ce(e)}),ge(D,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?ve(H,i,[e,s]):void 0}),Ze.modal(l,Gt(e,t,i),r),i.focus(),s},Ze.confirm=function(e,t,n,r,i){function u(e){return b(n)&&n(e,s),Wt(e,f+".y"),ce(e)}function c(e){return b(r)&&r(e,s),Wt(e,f+".n"),ce(e)}var a,l=Oe("button",Ve.okay,Qt),o=Oe("button",Ve.cancel,Qt),f="confirm";return o.name="n",y(e)&&(f+=":"+e[0],e=e[1]||e[0]),ge(H,l,u),ge(H,o,c),ge(D,l,function(e){return a=e.TE.key,a("arrowright")?(o.focus(),ce(e)):a("arrowleft")?ce(e):a("enter")?(u(e),ce(e)):a("escape")?(Wt(e,f+".y"),ce(e)):void 0}),ge(D,o,function(e){return a=e.TE.key,a("arrowright")?ce(e):a("arrowleft")?(l.focus(),ce(e)):a("enter")?(c(e),ce(e)):a("escape")?(Wt(e,f+".n"),ce(e)):void 0}),Ze.modal(f,Gt(e,t,[l,o]),i),o.focus(),s},Ze.prompt=function(e,t,n,r,i,l){function m(){a.focus(),"placeholder"in a&&a.select()}function v(e){return ce(e)}function $(e){return h=a.value,!n||g(h)&&h!==t?(Wt(e,u+".y"),ce(e),r(e,s,h!==t?h:"",t)):(m(),v(e))}function k(e){return Wt(e,u+".n"),ce(e)}var d,p,h,o=Oe("button",Ve.okay,Qt),f=Oe("button",Ve.cancel,Qt),a=Oe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Je+"-input block"}),u="prompt",c=[];if(y(e)&&(u+=":"+e[0],e=e[1]||e[0]),b(i)&&(l=i,i=0),1===i)a=Oe("textarea",t,{placeholder:t.split("\n")[0],"class":Je+"-textarea block"});else if(2===i){for(p in t)c.push(Oe("option",t[p],{value:p,selected:p===n||null}));a=Oe("select",c,{"class":Je+"-select block"})}return r=r||S,a.name="data",f.name="n",ge(D,a,function(e){return d=e.TE.key,d("enter")?$(e):d("escape")||d("backspace")&&!this.value?k(e):d("arrowup")?v(e):d("arrowdown")?(o.focus(),ce(e)):void 0}),ge(D,o,function(e){return d=e.TE.key,d("enter")?$(e):d("escape")?k(e):d("arrowup")?(a.focus(),ce(e)):d("arrowright")?(f.focus(),ce(e)):d(/^arrow(down|left)$/)?v(e):void 0}),ge(D,f,function(e){return d=e.TE.key,d(/^enter|escape$/)?k(e):d("arrowup")?(a.focus(),ce(e)):d(/^arrow(right|down)$/)?v(e):d("arrowleft")?(o.focus(),ce(e)):void 0}),ge(H,o,$),ge(H,f,k),Ze.modal(u,Gt(e,a,[o,f]),l),m(),s},Ze.drop=function(){Ze.exit(0,0,0);var r,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),r=xe(t),je(dt),Be(T,Oe(dt,!1,{"class":Je+"-drop "+r})),b(n)?n(dt):Oe(dt,n),Ze.drop.fit(),ge(H,T,Jt),ie("enter.drop."+t,[s]),ie("enter.drop",[s]),s},Ze.drop.fit=function(e){var l,t=Ee(_),n=Ee(dt),r=t.w/2-n.w/2,i=t.h/2-n.h/2;return!w(e)&&bt&&(l=_e(bt),r=l.l,i=l.t+Ee(bt).h),y(e)?(r=e[0],i=e[1]):(r=p(r,0,t.w-n.w),i=p(i,0,t.h-n.h)),d(dt,{left:r+te,top:i+te,visibility:"visible"}),ie("fit.drop",[s]),ie("fit",[s]),s},Ze.menu=function(e,t,n,r){var i='<span class="'+Je+'-current menu">%1</span>',l="";return t===!1?Ze.tool(e,t):(y(t)&&(l=t[0],t=t[1],i='<i class="'+ke(Ge.i,[l])+'"></i> '+i),Ze.tool(e,{i:l,text:ke(i,[n[t]&&n[t].text||t,l]),click:function(t){var o,f,a,u,d,p,h,r={href:ee,"class":Je+"-button"};return Ze.drop("menu menu-"+xe(e),function(e){function t(e){return u=this,h=n[ae(u,V)],o=Me(u),h&&h.active&&b(p=h.click)&&(p=p(e,s),bt&&ze(Re(bt)[0]||bt,ke(i,[o,l])),p===!1)?ce(e):(s.select(),ce(e))}for(a in n)d=n[a],d=x(d)?Ze.tools[d]:d,d&&(xt(d,a),r["data-"+V]=a,f=Oe("a",d.text||a,c(r,d.attributes||{})),!f.title&&(p=d.title)&&(f.title=y(p)?p[0]+(p[1]?" ("+p[1]+")":""):p),d.active||Se(f,"x"),n[a]=d,ge(H,f,t),Be(e,f))}),!1}},r),s)},Ze.bubble=function(){Ze.exit(0,0,0);var r,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),r=xe(t),je(pt),Be(T,Oe(pt,!1,{"class":Je+"-bubble "+r})),b(n)?n(pt):Oe(pt,n),Ze.bubble.fit(),ie("enter.bubble."+t,[s]),ie("enter.bubble",[s]),s},Ze.bubble.fit=function(e){var t=s.$(1),n=_e(ft),r=d(ft,"line-height"),i="border-",l="-width",o=t.caret[0].x+n.l-ft.scrollLeft,f=t.caret[1].y+n.t+r-ft.scrollTop,a=d(it,[i+"top"+l,i+"bottom"+l,i+"left"+l,i+"right"+l]),u=Ee(it),c=Ee(pt),h=a[0]+a[1],g=a[2]+a[3];return y(e)?(o=e[0],f=e[1]):(o=p(o,n.l,n.l+u.w-c.w-g),f=p(f,n.t,n.t+u.h-c.h-h)),d(pt,{left:o+te,top:f+te,visibility:"visible"}),ie("fit.bubble",[s]),ie("fit",[s]),s},Ze.overlay.exit=function(e){return Ze.exit(e,"overlay")},Ze.modal.exit=function(e){return Ze.exit(e,"modal")},Ze.drop.exit=function(e){return Ze.exit(e,"drop")},Ze.bubble.exit=function(e){return Ze.exit(e,"bubble")},Ze.tool=function(e,t,n){var r="";return"|"!==e&&(L.tools=L.tools.filter(function(t,n){return t===e?(r=n,!1):!0})),t===!1?delete Ze.tools[e]:("|"===e?(n=t,t={}):(b(t)&&(t={click:t}),Ze.tools[e]=c(Ze.tools[e]||{},t),w(n)||""===r||(n=r)),$(n)?L.tools.splice(n,0,e):L.tools.push(e)),wt(),s},Ze.key=function(e,t){return L.keys?(t===!1?delete Ze.keys[e]:Ze.keys[e]=t,_t(),s):s},Ze.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(W),!1},outdent:function(e,t){return t.outdent(W),!1}},ge(H,mt,Vt),Ze.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Vt(e)},"shift+tab":X?"outdent":0,tab:X?"indent":0,escape:function(e,t){return mt.focus(),!1}},Ze.el={container:nt,header:rt,body:it,footer:lt,overlay:ut,modal:ct,drop:dt,bubble:pt},s.config=L,c(s._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),l=e.getMinutes(),o=e.getSeconds(),f=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>l&&(l="0"+l),10>o&&(o="0"+o),10>f&&(f="0"+f),[""+t,""+n,""+r,""+i,""+l,""+o,""+f]},replace:ye,format:ke,dom:{set:Be,reset:We,get:He,id:qe,classes:{set:Se,reset:De,get:Le},attr:{set:le,reset:fe,get:oe},data:{set:se,reset:ue,get:ae},offset:_e,point:we,size:Ee,content:{set:ze,reset:je,get:Me},closest:Te,parent:Ie,children:Re,next:Ne,previous:Ce,before:Ye,after:Ue,prepend:Pe,append:Ae},el:Oe,event:{set:ge,reset:me,fire:ve,x:ce},hooks:q,hook:{set:ne,reset:re,fire:ie}}),Ze};