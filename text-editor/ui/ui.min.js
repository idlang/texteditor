/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.6.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function _e(e){return _(e)?v(e).split(/\s+/):e}function Me(e){return z(e)?e.join(" "):e}function Oe(e,t){return-1!==e.indexOf(t)}function Fe(e){return e.length}function Ne(e){return Object.keys(e)}function He(e){return Fe(Ne(e))}function De(e,t,n){return C(e)?C(t)?(C(x[e])||(x[e]={}),C(n)||(n=He(x[e])),x[e][n]=t,u):x[e]:x}function Se(e,t){return C(e)?C(t)&&C(x[e])?(delete x[e][t],u):(x[e]={},u):(x={},u)}function Be(e,t,n){if(!C(x[e]))return x[e]={},u;if(C(n))C(x[e][n])&&x[e][n].apply(u,t);else for(R in x[e])x[e][R].apply(u,t);return u}function Ye(e,t,n){if(z(t))for(R in t)Ye(e,R,t[R]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function je(e,n,i){if(_(n))return je(e,[n],C(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=e.getAttribute(R))&&t.push(R);return Fe(t)?t:C(i)?i:[]}function Ae(e,t){if(z(t))for(R in t)Ae(e,t[R]);else if(C(t))e.removeAttribute(t);else for(Ae(e,"class"),R=0,W=e.attributes,X=Fe(W);X>R;++R)W[R]&&Ae(e,W[R].name)}function Ie(e,t,n){if(z(t))for(R in t)Ie(e,R,t[R]);else Ye(e,"data-"+t,n)}function Pe(e,n,i){if(_(n))return Pe(e,[n],C(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=je(e,"data-"+R))&&t.push(R);return Fe(t)?t:C(i)?i:[]}function Re(e,t){if(z(t))for(R in t)Ae(e,"data-"+t[R]);else if(C(t))Ae(e,"data-"+t);else for(R=0,W=e.attributes,X=Fe(W);X>R;++R)W[R]&&"data-"===W[R].name.slice(0,5)&&Ae(e,W[R].name)}function We(e){return e&&e.preventDefault(),!1}function Xe(e,t,n){if(t){for(e=_e(e),R=0,W=Fe(e);W>R;++R)t.addEventListener(e[R],n,!1),De("on:"+e[R],n,ft(t));return u}}function Ke(e,t,n){if(t){for(e=_e(e),R=0,W=Fe(e);W>R;++R)t.removeEventListener(e[R],n,!1),Se("on:"+e[R],ft(t));return w(t)&&t.id.split(":")[0]===Ct+"-dom"&&Ae(t,"id"),u}}function qe(e,t,n){e=_e(e);var r,i="createEvent"in l;for(R=0,W=Fe(e);W>R;++R)i?(r=l.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[R],!0,!1),t.dispatchEvent(r)):Be("on:"+e[R],n,ft(t));return u}function Ue(e,t,n){for(R=0,W=Fe(t),X;W>R;++R)X=t[R],e=e.replace(L(X)?X:h(p(X),"g"),n&&n[R]||"");return e}function Ze(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,C(t[n])?t[n]:e})}function Ge(e){return v(Ue(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Je(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Qe(e);return{x:n-r.l,y:i-r.t}}function Qe(e){for(K=e.offsetLeft,V=e.offsetTop;e=e.offsetParent;)K+=e.offsetLeft,V+=e.offsetTop;return{l:K,t:V}}function Ve(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function et(e,t){for(;(e=at(e))&&e!==t;);return e}function tt(e,t){t=_e(t);for(R in t)e.classList.add(t[R])}function nt(e,n,i){if(_(n))return nt(e,[n],C(i)?i:"")[0];t=[];for(R in n)R=n[R],e.classList.contains(R)&&t.push(R);return Fe(t)?t:C(i)?i:!1}function it(e,t){if(C(t)){t=_e(t);for(R in t)e.classList.remove(t[R])}else Ae(e,"class")}function rt(e,t){t=_e(t);for(R in t)e.classList.toggle(t[R])}function ot(e,t,n){if(e=_(e)?l.createElement(e):e,z(n))for(R in n)if(te=n[R],"classes"===R)tt(e,te);else if("data"===R)for(W in te)te=te[W],null===te?Re(e,W):Ie(e,W,te);else"css"===R?_(te)?Ye(e,"style",te):null===te?Ae(e,"style"):c(e,te):T(te)?e[R]=te:null===te?Ae(e,R):Ye(e,R,E(te)?te.join(" "):""+te);if(w(t))wt(e,t);else if(z(t))for(R in t)te=t[R],w(te)?wt(e,te):te!==!1&&st(e,te);else C(t)&&t!==!1&&st(e,t);return e}function ft(e){var t=e.id;return t||(t=Ct+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function st(e,t){e.innerHTML=t}function lt(e,t){return e.innerHTML||(C(t)?t:"")}function ut(e,t){if(t!==!1&&(B=ct(e)))for(R=0,W=Fe(B);W>R;++R)ut(B[R]);st(e,"")}function at(e){return e&&e.parentNode}function ct(e){return e&&e.children||[]}function dt(e){return e&&e.nextSibling}function pt(e){return e&&e.previousSibling}function bt(e){for(R=0;e=pt(e);)++R;return R}function ht(e,t){return e&&_(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&T(t)?e===t(e):e===t}function yt(e,n){if(!(n=C(n)?n:l))return[];if(t=[],_(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(R=0,W=Fe(e);W>R;++R)t.push(e[R]);return t}return[]}for(e=n.querySelectorAll(e),R=0,W=Fe(e);W>R;++R)t.push(e[R]);return t}return gt(e)?[e]:[]}function gt(e,t){var n=at(e);return 1===Fe(arguments)?n||!1:e&&n===e?n:!1}function vt(e,t){Z=at(e),Z&&Z.insertBefore(t,e)}function xt(e,t){Z=at(e),Z&&Z.insertBefore(t,dt(e))}function mt(e,t){B=ct(e)[0],B?vt(B,t):wt(e,t)}function kt(e,t){wt(e,t)}function wt(e,t){e.appendChild(t)}function Et(e,t){var n=gt(e);if(n){if(t!==!1)for(B=ct(e)[0];B;)Et(B);n.removeChild(e)}}function Tt(e){ut(ot(e,!1,{style:""})),Et(e)}function $t(e,t,n){return ot(t||"div",n,{"class":e})}function Jt(e){return!e||C(e.active)&&!e.active}function Qt(){return Yt.disabled||Yt.readOnly}function Vt(e,t,n){return T(e)&&(e={click:e}),_(e.click)&&(e.click=(n[e.click]||{}).click),e.title=_t[t]||"",C(e.attributes)||(e.attributes={}),n[t]=e,e}function en(e){if(Qt())return Yt.focus(),We(e);zt.exit(0,0,0);var t=Pe(this,"tool-id"),n=zt.tools,i=n[t];return zt.drop.target=e.currentTarget||e.target,!Jt(i)&&T(W=i.click)&&(W=W(e,u,t),Be("on:change",[e,u,t]),W===!1)?We(e):(u.select(),We(e))}function tn(e){if(V=this,(X=e.TE.key)(/^(escape|f10)$/))zt.exit(1);else if(X("enter")||X("arrowdown")&&Pe(V,"ui-drop"))zt.drop.target=V,qe(se,V,[e]);else if(X("arrowright")&&(K=dt(V))){for(;!ht(K,"a")&&K;)K=dt(K);K&&K.focus()}else if(X("arrowleft")&&(K=pt(V))){for(;!ht(K,"a")&&K;)K=pt(K);K&&K.focus()}return We(e)}function nn(){ut(Bt,!1);var r,o,f,s,l,a,c,e=zt.tools,t=_e(N.tools),n=Ct+"-button",i=Ct+"-separator";N.tools=t;for(a in t)c=t[a],o=e[c],(o||o==={})&&(o=Vt(o,c,e),f=o.i||c,"|"===f||Oe(f,"<")||(f=Ge(f)),s="|"!==f,l=Ge(c).replace(/[\/\s]/g,"-"),Zt=$t(s?n+" "+n+"-"+l:i+" "+i+"-"+a,s?"a":"span"),s?(Zt=o.target||Zt,r=n+":"+l,Ye(Zt,{href:Le,id:r,tabindex:-1}),Ie(Zt,"tool-id",c),f=Oe(f,"<")?f:zt.i(l,f),Jt(o)?tt(Zt,"x"):it(Zt,"x"),o.on?tt(Zt,"on"):it(Zt,"on"),o.text&&(f=Ze('<span class="'+Ct+'-text">'+o.text+"</span>",[f]),tt(Zt,"text")),st(Zt,f),ot(Zt,!1,o.attributes),!o.attributes.title&&(W=o.title)&&(Zt.title=z(W)?W[0]+(W[1]?" ("+W[1]+")":""):W),Xe(se,Zt,en),Xe(de,Zt,tn)):Zt.id=i+":"+a,o.target=Zt,wt(Bt,Zt));Be("update.tools",[u])}function rn(){zt.keys=function(){var n,e=Ne(zt.keys).sort().reverse(),t={};for(R=0,W=Fe(e);W>R;++R)n=e[R],t[n]=zt.keys[n];return t}(),fn(),Be("update.keys",[u])}function on(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}if(Qt())return Yt.focus(),We(e);var n=u.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,l=zt.keys,a=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();U=e.TE.key(),H[U]=1,t=He(H),g(function(){u.record()});for(R in l){X=d(R),B=0;for(W in X)W=X[W],H[a[W]||W]&&++B;if(X=Fe(X),B===X&&t===X&&(_(l[R])&&(l[R]=zt.tools[l[R]].click),K=l[R]&&l[R](e,u),K===!1))return We(e)}if(xe)for(R in xe)if(q=xe[R],q!==!1){if(U===q&&f===q)return"\\"===o?(u.insert(U,0),We(e)):(u.select(n.end+1),We(e));if(R===U)return u.wrap(R,q),We(e);if(o===R&&f===q){if("backspace"===U&&i.slice(-2)!=="\\"+R)return u.unwrap(R,q),We(e);if(me&&"enter"===U&&R!==q&&!s)return u.tidy("\n"+c+we,"\n"+c).scroll(1),We(e)}}if(me&&!s){if("backspace"===U&&h(p(we)+"$").test(i))return u.outdent(we),We(e);if("enter"===U&&h("(^|\\n)("+p(we)+")+.*$").test(i))return u.insert("\n"+c,0,1).scroll(1),We(e)}}function fn(e){e&&e.TE&&e.TE.key?delete H[e.TE.key()]:H={}}function cn(e){return sn=jt,Q=Ve(St),We(e)}function dn(e){sn===jt&&c(Yt,{height:Je(Dt,e).y-Q.h+Ce})}function pn(){sn=0}function bn(){zt.exit(1)}function hn(){t=Ve(Rt),ne=t.w,P=t.h,t=Ve(Pt),ln=t.w,un=t.h}function yn(e,t){t&&Be("exit.modal."+t,[u]),qe(se,Pt,[e])}function gn(e){sn=e.target,t=Je(Rt,e),ie=t.x,re=t.y,hn()}function vn(e){var n=an.header,i=an.resize;sn===n||et(sn,n)===n?(t=Je(Dt,e),K=t.x-ie,V=t.y-re,c(Rt,{left:(ne>ln?K:d(K,0,ln-ne))+Ce,top:(P>un?V:d(V,0,un-P))+Ce})):sn===i&&(t=Je(Rt,e),Q=Ve(i),c(Rt,{width:t.x+Q.w/4+Ce,height:t.y+Q.h/4+Ce}))}function xn(){sn=0}function mn(e,t,n){return{header:e,body:t,footer:n}}function kn(e){D=zt.drop.target,S=Wt,B=e&&e.target||0,(!B||B!==D&&et(B,D)!==D)&&(zt.drop.target=0,Ke(se,l,kn),Ke(ve,s,kn),zt.exit(e.target===Yt))}var D,S,B,A,P,R,W,X,K,q,U,t,Z,J,Q,V,te,ne,ie,re,n="⌘",i="…",o="⇥",f="⇧",s=window,l=document,u=new TE(e),a=u._,c=a.css,d=a.edge,p=a.x,b=a.extend,h=a.pattern,g=(a.timer.reset,a.timer.set),v=a.trim,x={},m=function(){},k=TE.is,w=k.e,E=k.a,T=k.f,$=k.i,z=k.o,L=k.r,C=function(e){return!k.x(e)},_=k.s,M=l.documentElement,F=(l.head,l.body),N=b({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},t),H={},fe="blur",se="click",de="keydown",pe="keyup",be="touchstart mousedown",he="touchmove mousemove",ye="touchend mouseup",ve="orientationchange resize",xe=N.auto_close,me=N.auto_tab,ke=N.languages,we=N.tab,Te=(N.unit[0][1],N.unit[0][0]),$e=N.unit[1][1],ze=N.unit[1][0],Le="javascript:;",Ce="px",zt=u.ui={};u.tidy=function(e,t){var n=u.$(),i=v(n.before)?e:"",r=v(n.after)?C(t)?t:e:"";return u.trim(i,r)},u.i=function(){return v(u.replace(/\s+/g," "))},u.format=function(e,t,n,i){z(e)||(e=[e]),C(n)||(n=" "),C(i)||(i="");var r=u.h,o=u[0]().$(),f=(e[0]?Te[0]+e[0]+Te[1]:"")+i,s=i+(e[0]?Te[0]+Te[2]+(e[1]||e[0].split(h("("+$e[3]+")+"))[0])+Te[1]:""),l=p(f),a=p(s),c=h("^"+l+"([\\s\\S]*?)"+a+"$"),d=h(l+"$"),b=h("^"+a),y=o.before,g=o.after;return o.length?n=!1:u.insert(ke.placeholders[""]),u.toggle(t?!c.test(o.value):!d.test(y)&&!b.test(g),[function(e){e.unwrap(f,s,1).tidy(h(ze[0]+"[^"+ze[0]+ze[1]+ze[2]+"]+?"+ze[1]+"$").test(y)?"":n,h("^"+ze[0]+ze[2]+"[^"+ze[0]+ze[1]+"]+?"+ze[1]).test(g)?"":n).wrap(f,s,t)},function(e){e.unwrap(f,s,t)}])[r]()};var Zt,Lt=N.classes,Ct=Lt[""],_t=ke.tools,Mt=ke.buttons,Ot=ke.labels,Ft=Ct+"-textarea "+Ct+"-content block",Nt=$t(Ct),Ht=$t(Ct+"-header"),Dt=$t(Ct+"-body"),St=$t(Ct+"-footer"),Bt=$t(Ct+"-tool"),Yt=ot(e,!1,N.attributes),jt=$t(Ct+"-resize s"),At=$t(Ct+"-description"),It=$t(Ct+"-panel"),Pt=$t(Ct+"-overlay"),Rt=ot("div"),Wt=ot("div"),Xt=ot("div"),Kt=$t("left","span"),qt=$t("right","span"),Ut=0;zt.i=function(e,t,n){return e=Ge(e).replace(/[\/\s]/g,"-"),Q=Ze(Lt.i,[e,t||e]),n?(it(n),tt(n,Q),n):'<i class="'+Q+'"></i>'},C(N.suffix)||(N.suffix=Te[1]);var sn=0,ie=0,re=0,ne=0,P=0,ln=0,un=0,an={};u.create=function(e,t){z(e)&&(N=b(N,e));var n=gt(Yt);return tt(Nt,Ct+"-is-can-update"),tt(Nt,Ct+"-is-can-copy"),tt(Yt,Ft),n&&ht(n,"p")?(vt(n,Nt),Ut=n,Et(n,!1)):vt(Yt,Nt),Nt.dir=N.dir,wt(Nt,Ht),wt(Nt,Dt),wt(Nt,St),wt(Dt,Yt),N.tools&&(wt(Ht,Bt),wt(St,At),wt(At,Kt),wt(At,qt)),Xe(de,Yt,on),Xe(pe+" "+fe,Yt,fn),N.resize&&(wt(Nt,jt),tt(Nt,Ct+"-is-can-resize"),Xe(be,jt,cn),Xe(he,l,dn),Xe(ye,F,pn)),nn(),rn(),0!==t?Be("create",[u]):u},u.update=function(e,t){return nt(Yt,_e(Ft),0)&&u.destroy(0),(0!==t?Be("update",[u]):u).create(e,0)},u.destroy=function(e){return nt(Yt,_e(Ft),0)?(zt.exit(0,0,0),it(Yt,Ft),N.tools=Me(N.tools),N.keys&&(Ke(de,Yt,on),Ke(pe,Yt,fn)),N.resize&&(Ke(be,jt,cn),Ke(he,l,dn),Ke(ye,l,pn)),Ut?(vt(Nt,Ut),wt(Ut,Yt),Ut=0):vt(Nt,Yt),Tt(Nt),0!==e?Be("destroy",[u]):u):u},u.enable=function(e){return Yt.disabled=Yt.readOnly=!1,tt(Nt,Ct+"-is-can-update"),tt(Nt,Ct+"-is-can-copy"),0!==e?Be("enable",[u]):u},u.disable=function(e){return Yt.disabled=!0,it(Nt,Ct+"-is-can-update"),it(Nt,Ct+"-is-can-copy"),0!==e?Be("disable",[u]):u},u.freeze=function(e){return Yt.disabled=!1,Yt.readOnly=!0,it(Nt,Ct+"-is-can-update"),tt(Nt,Ct+"-is-can-copy"),0!==e?Be("freeze",[u]):u},zt.exit=function(e,t,n){if(A={panel:function(){Tt(It)},overlay:function(){Ke(se,Pt,bn),Tt(Pt)},modal:function(){Ke(be,Dt,gn),Ke(he,Dt,vn),Ke(ye,l,xn),Ke(se,an.x,yn),Tt(Rt)},drop:function(){Tt(Wt)},bubble:function(){Tt(Xt)}},fn(),t)if(z(t))for(R in t)R=t[R],A[R]&&A[R](),0!==n&&Be("exit."+R,[u]);else A[t]&&A[t](),0!==n&&Be("exit."+R,[u]);else for(R in A)A[R]();return e&&u.select(),0!==n&&Be("exit",[u]),u},zt.panel=function(e,t){function n(){Ke(se,ie,n),zt.panel.exit(1)}return zt.exit(0,0,0),ie=$t(Ct+"-x"),ie.title=Mt.close,Xe(se,ie,n),ut(It,!1),wt(Dt,ot(It,[$t(Ct+"-panel-content","div",e),ie])),T(t)?t(It):ot(It,t),Be("enter.panel",[u]),Be("enter",[u]),u},zt.panel.fit=function(){},zt.overlay=function(e,t){return zt.exit(0,0,0),wt(Dt,Pt),e&&Xe(se,Pt,bn),T(t)?t(Pt):ot(Pt,t),Be("enter.overlay",[u]),Be("enter",[u]),u},zt.overlay.fit=function(){},zt.modal=function(){zt.overlay(1).blur();var f,s,e=arguments,t=e[0],n=e[1],i=e[2],r=Ct+"-modal",o=n.footer;if(z(t)&&(t="default",n=e[0],i=e[1]),K=Ge(t),ot(Rt,!1,{"class":r+" "+K}),C(n.body)&&(n.body=ot("div",n.body,{"class":r+"-content "+K})),C(o)&&z(o)&&!w(o)){s=[];for(R in o)W=o[R],w(W)?s.push(W):(W=Vt(W,R,o),t=R.text||Mt[R]||R,f=ot("button",t,b({name:"y["+R+"]",type:"button","class":Ct+"-button",data:{"button-id":R}},W.attributes)),Xe(se,f,function(e){return t=o[Pe(this,"button-id")].click(e,u),t===!1?We(e):void 0}),s.push(f));n.footer=s}for(R in n)r[1]=R,an[R]=$t(r+"-"+Ze(R,r)+" "+K,0,n[R]);return an.x=$t(Ct+"-x "+K),an.resize=$t(Ct+"-resize se "+K),ut(Rt,!1),an.x.title=Mt.close,wt(Dt,ot(Rt,an,{style:""})),zt.modal.fit(),xt(Rt,Pt),Xe(se,an.x,yn),Xe(be,an.header,We),Xe(be,an.resize,We),Xe(be,Dt,gn),Xe(he,Dt,vn),Xe(ye,l,xn),T(i)&&(an.overlay=Pt,an.modal=Rt,i(an)),Be("enter.modal."+t,[u]),Be("enter.modal",[u]),Be("enter",[u]),u},zt.modal.fit=function(e){return hn(),K=ln/2-ne/2,V=un/2-P/2,z(e)?(C(e[0])&&(K=e[0]),C(e[1])&&(V=e[1])):(K=d(K,0),V=d(V,0)),c(Rt,{left:K+Ce,top:V+Ce,"min-width":ne+Ce,"min-height":P+Ce,visibility:"visible"}),Be("fit.modal",[u]),Be("fit",[u]),u};var wn={"class":Ct+"-button",name:"y"};return zt.alert=function(e,t,n,i){var r=ot("button",Mt.okay,wn),o="alert";return n=n||m,z(e)&&(o+=":"+e[0],e=e[1]||e[0]),Xe(se,r,function(e){return n(e,u),yn(e,o+".y"),We(e)}),Xe(de,r,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&qe(se,r,[e]),We(e)}),zt.modal(o,mn(e,t,r),i),r.focus(),u},zt.confirm=function(e,t,n,i,r){function a(e){return T(n)&&n(e,u),yn(e,s+".y"),We(e)}function c(e){return T(i)&&i(e,u),yn(e,s+".n"),We(e)}var l,o=ot("button",Mt.okay,wn),f=ot("button",Mt.cancel,wn),s="confirm";return f.name="n",z(e)&&(s+=":"+e[0],e=e[1]||e[0]),Xe(se,o,a),Xe(se,f,c),Xe(de,o,function(e){return l=e.TE.key,l("arrowright")?f.focus():l("enter")?a(e):l("escape")&&yn(e,s+".y"),We(e)}),Xe(de,f,function(e){return l=e.TE.key,l("arrowleft")?o.focus():l("enter")?c(e):l("escape")&&yn(e,s+".n"),We(e)}),zt.modal(s,mn(e,t,[o,f]),r),f.focus(),u},zt.prompt=function(e,t,n,i,r,o){function h(){l.focus(),"placeholder"in l&&l.select()}function y(e){d=l.value,T(n)&&!n(d)?h():!n||v(d)&&d!==t?(yn(e,a+".y"),i(e,u,d!==t?d:"",t)):h()}function g(e){yn(e,a+".n")}var d,p,b,f=ot("button",Mt.okay,wn),s=ot("button",Mt.cancel,wn),l=ot("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Ct+"-input block"}),a="prompt",c=[];if(z(e)&&(a+=":"+e[0],e=e[1]||e[0]),T(r)&&(o=r,r=0),r=r||0,1===r)l=ot("textarea",t,{placeholder:t.split("\n")[0],"class":Ct+"-textarea block",spellcheck:"false"});else if(2===r){for(R in t)c.push(ot("option",t[R],{value:R,selected:R===n||null}));l=ot("select",c,{"class":Ct+"-select block"})}return i=i||m,l.name="data",s.name="n",Xe(de,l,function(e){return p=e.TE.key,b=e.TE.control,p("enter")&&0===r||b("enter")?(y(e),We(e)):p("escape")||p("backspace")&&!this.value?(g(e),We(e)):p("arrowdown")&&0===r||p("enter")&&2===r||b("arrowdown")?(f.focus(),We(e)):void 0}),Xe(de,f,function(e){return p=e.TE.key,p("enter")?y(e):p("escape")?g(e):p("arrowup")?l.focus():p("arrowright")&&s.focus(),We(e)}),Xe(de,s,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?g(e):p("arrowup")?l.focus():p("arrowleft")&&f.focus(),We(e)}),Xe(se,f,y),Xe(se,s,g),zt.modal(a,mn(e,l,[f,s]),o),h(),u},zt.drop=function(){zt.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===Fe(e)&&(t="default",n=e[0],i=e[1]),K=Ge(t),ut(Wt,!1),wt(F,ot(Wt,!1,{"class":Ct+"-drop "+K})),T(n)?n(Wt):ot(Wt,n),zt.drop.fit(),i===!1||Xe(se,l,kn),Xe(ve,s,kn),Be("enter.drop."+t,[u]),Be("enter.drop",[u]),u},zt.drop.fit=function(e){return D=Ve(M),S=Ve(Wt),B=zt.drop.target,K=D.w/2-S.w/2,V=D.h/2-S.h/2,!C(e)&&B&&(t=Qe(B),K=t.l,V=t.t+Ve(B).h),z(e)?(C(e[0])&&(K=e[0]),C(e[1])&&(V=e[1])):(K=d(K,0,D.w-S.w),V=d(V,0,Math.max(D.h,Ve(s).h)-S.h)),c(Wt,{left:K+Ce,top:V+Ce,visibility:"visible"}),Be("fit.drop",[u]),Be("fit",[u]),u},zt.menu=function(e,n,i,r){var s,o=zt.tools,f=0;if(n===!1)return zt.tool(e,n);for(r in i)ne="%"===r[0],s=i[r],s=_(s)&&!ne?o[s]:s,s&&(s=Vt(s,r,o),i[r]=s);return zt.tool(e,{i:z(n)?n[0]:0,text:!z(n),click:function(n){var l=zt.drop.target=o[e].target;return zt.drop("menu menu-"+Ge(e),function(n){function a(n){return V=this,t=Pe(V,"tool-id"),q=i[t],q=_(q)?o[q]:q||{},U=lt(V),!Jt(q)&&T(r=q.click)&&(r=r(n,u),zt.menu.set(e,t),r===!1)?(u.select(),We(n)):(u.select(),We(n))}function c(e){if(V=this,(X=e.TE.key)("escape"))zt.exit(1);else if(X("enter"))qe(se,V,[e]);else if(X("f10")&&l)l.focus();else if(X("arrowdown")&&(K=dt(V))){for(;!ht(K,"a")&&K;)K=dt(K);K&&K.focus()}else if(X("arrowup")&&(K=pt(V))){for(;!ht(K,"a")&&K;)K=pt(K);!K&&l?(zt.exit(),l.focus()):K&&K.focus()}else X("arrowup")&&l&&(zt.exit(),l.focus());return We(e)}for(r in i)if(s=i[r],ne="%"===r[0],s){var d={href:ne?null:Le,"class":Ct+"-"+(ne?"label":"button")};ne?W=Ot[e]&&Ot[e][+r.slice(1)-1]||r:(d.data={},d.data["tool-id"]=r,W=_t[r]||r),J=s.text,J=z(J)?J[1]||"":J,W=z(W)?W[0]:W,Q=ot(ne?"span":"a","<span>"+(ne?W||"%"+f:J||W)+"</span>",b(d,s.attributes||{})),tt(Q,"menu-"+Ge(r).replace(/[\/\s]/g,"-")),!d.title&&(V=s.title)&&(Q.title=z(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),ne?Ye(Q,{id:Ct+"-label:"+f}):(Jt(s)?tt(Q,"x"):it(Q,"x"),s.on?tt(Q,"on"):it(Q,"on"),Xe(se,Q,a),Xe(de,Q,c)),wt(n,Q),++f}g(function(){(yt('[data-tool-id="'+Pe(l,"ui-drop-data")+'"]',n)[0]||yt("a",n)[0]).focus()},1)}),!1}},r),Ie(o[e].target,{"ui-drop":e}),o[e].data=i,zt.menu.set(e,n),u},zt.menu.set=function(e,t){var f,s,n='<span class="'+Ct+'-current menu">%1</span>',i=zt.tools[e]||{},r=i.target,o=i.data;return r?(!z(t)&&o[t]&&(Ie(r,"ui-drop-data",t),t=o[t].text||t),z(t)?(s=t[0],s=Oe(s,"<")?s:zt.i(e,s),t=C(t[1])?t[1]:0,t=t&&o[t]&&o[t].text||t,n=s+(0!==t?" "+n:"")):s=zt.i(i.i||e),(f=yt("."+Ct+"-text",r)[0])?(tt(r,"text"),st(f,Ze(n,[t,s]))):(it(r,"text"),st(r,s)),u):u},zt.bubble=function(){zt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Fe(e)&&(t="default",n=e[0]),K=Ge(t),ut(Xt,!1),wt(F,ot(Xt,!1,{"class":Ct+"-bubble "+K})),T(n)?n(Xt):ot(Xt,n),zt.bubble.fit(),Be("enter.bubble."+t,[u]),Be("enter.bubble",[u]),u},zt.bubble.fit=function(e){Q=u.$(1),t=Qe(Yt),P=c(Yt,"line-height");var n="border-",i="-width";K=Q.caret[0].x+t.l-Yt.scrollLeft,V=Q.caret[1].y+t.t+P-Yt.scrollTop,S=c(Dt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=Ve(Dt),o=Ve(Xt),f=S[0]+S[1],s=S[2]+S[3];return z(e)?(C(e[0])&&(K=e[0]),C(e[1])&&(V=e[1])):(K=d(K,t.l,t.l+r.w-o.w-s),V=d(V,t.t,t.t+r.h-o.h-f)),c(Xt,{left:K+Ce,top:V+Ce,visibility:"visible"}),Be("fit.bubble",[u]),Be("fit",[u]),u},zt.panel.exit=function(e){return zt.exit(e,"panel")},zt.overlay.exit=function(e){return zt.exit(e,"overlay")},zt.modal.exit=function(e){return zt.exit(e,"modal")},zt.drop.exit=function(e){return zt.exit(e,"drop")},zt.bubble.exit=function(e){return zt.exit(e,"bubble")},zt.tool=function(e,t,n){return W="","|"!==e&&(N.tools=_e(N.tools).filter(function(t,n){return t===e?(W=n,!1):!0})),t===!1?delete zt.tools[e]:("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),zt.tools[e]=b(zt.tools[e]||{},t),C(n)||""===W||(n=W)),$(n)?N.tools.splice(n,0,e):N.tools.push(e)),nn(),u},zt.separator=function(e,t){return zt.tool("|",e!==!1?{attributes:e||{}}:!1,t)},zt.key=function(e,t){return N.keys?(t===!1?delete zt.keys[e]:zt.keys[e]=t,rn(),u):u},zt.key.set=function(e){H[e]=1},zt.key.reset=function(e){e?delete H[e]:H={}},zt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return e&&e.TE&&e.TE.shift()?(t.outdent(we),!1):(t.indent(we),!1)},outdent:function(e,t){return t.outdent(we),!1}},zt.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return J=":not([tabindex]):not([disabled])",(Q=yt("input"+J+",button"+J+",select"+J+",textarea"+J+",a[href]"+J+",[contenteditable]"+J+',[tabindex]:not([tabindex="-1"])',l,0))&&-1!==(V=Q.indexOf(Yt))?((Q[V+1]||l).focus(),!1):void 0},f10:function(e,t){return yt("a",Bt)[0].focus(),!1},tab:me?"indent":0,"shift+tab":me?"outdent":0},zt.el={container:Nt,header:Ht,body:Dt,footer:St,panel:It,overlay:Pt,modal:Rt,drop:Wt,bubble:Xt},u.config=N,b(TE._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),s=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),[""+t,""+n,""+i,""+r,""+o,""+f,""+s]},replace:Ue,format:Ze,dom:{set:wt,reset:Et,get:yt,id:ft,copy:function(e,t){return e.cloneNode(C(t)?t:!0)},classes:{set:tt,reset:it,toggle:rt,get:nt},attributes:{set:Ye,reset:Ae,get:je},data:{set:Ie,reset:Re,get:Pe},is:ht,offset:Qe,pointer:Je,size:Ve,content:{set:st,reset:ut,get:lt},closest:et,parent:at,children:ct,next:dt,previous:pt,index:bt,before:vt,after:xt,prepend:mt,append:kt},el:ot,event:{set:Xe,reset:Ke,fire:qe,x:We}}),b(u._,TE._),b(u._,{hooks:x,hook:{set:De,reset:Se,fire:Be}}),u.create()};