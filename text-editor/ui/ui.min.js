/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.8.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function ze(e){return Y(e)?O(e).split(/\s+/):e}function Te(e){return I(e)?e.join(" "):e}function Se(e,t){return-1!==e.indexOf(t)}function je(e){return e.length}function Re(e){return Object.keys(e)}function Le(e){return je(Re(e))}function Ze(e,t,a){return w(e)?w(t)?(w(A[e])||(A[e]={}),w(a)||(a=Le(A[e])),A[e][a]=t,c):A[e]:A}function Ge(e,t){return w(e)?w(t)&&w(A[e])?(delete A[e][t],c):(A[e]={},c):(A={},c)}function Ne(e,t,a){if(!w(A[e]))return A[e]={},c;if(w(a))w(A[e][a])&&A[e][a].apply(c,t);else for($ in A[e])A[e][$].apply(c,t);return c}function Je(e,t,a){if(I(t))for($ in t)Je(e,$,t[$]);else e[(null===a?"remove":"set")+"Attribute"](t,a)}function De(e,a,n){if(Y(a))return De(e,[a],w(n)?n:"")[0];t=[];for($ in a)$=a[$],($=e.getAttribute($))&&t.push($);return je(t)?t:w(n)?n:[]}function He(e,t){if(I(t))for($ in t)He(e,t[$]);else if(w(t))e.removeAttribute(t);else for(He(e,"class"),$=0,B=e.attributes,K=je(B);K>$;++$)B[$]&&He(e,B[$].name)}function Pe(e,t,a){if(I(t))for($ in t)Pe(e,$,t[$]);else Je(e,"data-"+t,a)}function qe(e,a,n){if(Y(a))return qe(e,[a],w(n)?n:"")[0];t=[];for($ in a)$=a[$],($=De(e,"data-"+$))&&t.push($);return je(t)?t:w(n)?n:[]}function $e(e,t){if(I(t))for($ in t)He(e,"data-"+t[$]);else if(w(t))He(e,"data-"+t);else for($=0,B=e.attributes,K=je(B);K>$;++$)B[$]&&"data-"===B[$].name.slice(0,5)&&He(e,B[$].name)}function Be(e){return e&&e.preventDefault(),!1}function Ke(e,t,a){if(t){for(e=ze(e),$=0,B=je(e);B>$;++$)t.addEventListener(e[$],a,!1),Ze("on:"+e[$],a,st(t));return c}}function Me(e,t,a){if(t){for(e=ze(e),$=0,B=je(e);B>$;++$)t.removeEventListener(e[$],a,!1),Ge("on:"+e[$],st(t));return y(t)&&t.id.split(":")[0]===Yt+"-dom"&&He(t,"id"),c}}function Xe(e,t,a){e=ze(e);var i,n="createEvent"in u;for($=0,B=je(e);B>$;++$)n?(i=u.createEvent("HTMLEvents"),i.data=a,i.initEvent(e[$],!0,!1),t.dispatchEvent(i)):Ne("on:"+e[$],a,st(t));return c}function Fe(e,t,a){for($=0,B=je(t),K;B>$;++$)K=t[$],e=e.replace(C(K)?K:p(d(K),"g"),a&&a[$]||"");return e}function We(e,t){return e.replace(/%(\d+)/g,function(e,a){return--a,w(t[a])?t[a]:e})}function Ve(e){return O(Fe(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Qe(e,t){var a=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,i=_e(e);return{x:a-i.l,y:n-i.t}}function _e(e){for(M=e.offsetLeft,ee=e.offsetTop;e=e.offsetParent;)M+=e.offsetLeft,ee+=e.offsetTop;return{l:M,t:ee}}function et(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function tt(e,t){for(;(e=lt(e))&&e!==t;);return e}function at(e,t){t=ze(t);for($ in t)e.classList.add(t[$])}function nt(e,a,n){if(Y(a))return nt(e,[a],w(n)?[n]:[""])[0];t=[];for($ in a)$=a[$],e.classList.contains($)&&t.push($);return je(t)?t:w(n)?n:!1}function it(e,t){if(w(t)){t=ze(t);for($ in t)e.classList.remove(t[$])}else He(e,"class")}function ot(e,t){t=ze(t);for($ in t)e.classList.toggle(t[$])}function rt(e,t,a){if(e=e||"div",e=Y(e)?u.createElement(e):e,I(a))for($ in a)if(ae=a[$],"classes"===$)at(e,ae);else if("data"===$)for(B in ae)ae=ae[B],null===ae?$e(e,B):Pe(e,B,ae);else"css"===$?Y(ae)?Je(e,"style",ae):null===ae?He(e,"style"):l(e,ae):x(ae)?e[$]=ae:null===ae?He(e,$):Je(e,$,k(ae)?ae.join(" "):""+ae);if(y(t))kt(e,t);else if(I(t))for($ in t)ae=t[$],y(ae)?kt(e,ae):ae!==!1&&ut(e,ae);else w(t)&&t!==!1&&ut(e,t);return e}function st(e){var t=e.id;return t||(t=Yt+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function ut(e,t){e.innerHTML=t}function ct(e,t){return e.innerHTML||(w(t)?t:"")}function ht(e,t){if((!w(t)||t)&&(N=ft(e)))for($=0,B=je(N);B>$;++$)ht(N[$]);ut(e,"")}function lt(e){return e&&e.parentNode}function ft(e){return e&&e.children||[]}function dt(e){return e&&e.nextSibling}function gt(e){return e&&e.previousSibling}function pt(e){for($=0;e=gt(e);)++$;return $}function Et(e,t){return e&&Y(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&x(t)?e===t(e):e===t}function vt(e,a){if(!(a=w(a)?a:u))return[];if(t=[],Y(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=a.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=a.getElementsByClassName(e.slice(1)))||(e=a.getElementsByTagName(e))){for($=0,B=je(e);B>$;++$)t.push(e[$]);return t}return[]}for(e=a.querySelectorAll(e),$=0,B=je(e);B>$;++$)t.push(e[$]);return t}return Ot(e)?[e]:[]}function Ot(e,t){var a=lt(e);return 1===je(arguments)?a||!1:e&&a===e?a:!1}function At(e,t){W=lt(e),W&&W.insertBefore(t,e)}function Ut(e,t){W=lt(e),W&&W.insertBefore(t,dt(e))}function bt(e,t){N=ft(e)[0],N?At(N,t):kt(e,t)}function yt(e,t){kt(e,t)}function kt(e,t){e.appendChild(t)}function xt(e,t){var a=Ot(e);if(a){if(!w(t)||t)for(N=ft(e)[0];N;)xt(N);a.removeChild(e)}}function mt(e){ht(rt(e,!1,{style:""})),xt(e)}function It(e,t,a){return rt(t,a,{"class":e})}function ea(e){return!e||w(e.active)&&!e.active}function ta(e,t,a){return x(e)&&(e={click:e}),Y(e.click)&&(e.click=(a[e.click]||{}).click),e.title=zt[t]||"",w(e.attributes)||(e.attributes={}),a[t]&&(a[t]=e),e}function aa(e){Ct.exit(0,0,0);var t=qe(this,"tool-id"),a=Ct.tools,n=a[t];return Ct.drop.target=e.currentTarget||e.target,!ea(n)&&x(B=n.click)&&(B=B(e,c,t),Ne("on:change",[e,c,t]),B===!1)?Be(e):(c.select(),Be(e))}function na(e){if(ee=this,(K=e.TE.key)(/^(escape|f10)$/))Ct.exit(1);else if(K("enter")||K("arrowdown")&&qe(ee,"ui-drop"))Ct.drop.target=ee,Xe(ue,ee,[e]);else if(K("arrowright")&&(M=dt(ee))){for(;!Et(M,"a")&&M;)M=dt(M);M&&M.focus()}else if(K("arrowleft")&&(M=gt(ee))){for(;!Et(M,"a")&&M;)M=gt(M);M&&M.focus()}return Be(e)}function oa(){ht(Dt,0);var i,o,r,s,u,h,l,e=Ct.tools,t=ze(R.tools),a=Yt+"-button",n=Yt+"-separator";R.tools=t;for(h in t)l=t[h],o=e[l],(o||o==={})&&(o=ta(o,l,e),r=o.i||l,"|"===r||Se(r,"<")||(r=Ve(r)),s="|"!==r,u=Ve(l).replace(/[\/\s]/g,"-"),Qt=It(s?a+" "+a+"-"+u:n+" "+n+"-"+h,s?"a":"span"),s?(Qt=o.target||Qt,i=a+":"+u,Je(Qt,{href:we,id:i,tabindex:-1}),Pe(Qt,"tool-id",l),r=Se(r,"<")?r:Ct.i(u,r),ea(o)?at(Qt,"x"):it(Qt,"x"),o.on?at(Qt,"on"):it(Qt,"on"),o.text&&(r=We('<span class="'+Yt+'-text">'+o.text+"</span>",[r]),at(Qt,"text")),ut(Qt,r),rt(Qt,!1,o.attributes),!o.attributes.title&&(B=o.title)&&(Qt.title=I(B)?B[0]+(B[1]?" ("+B[1]+")":""):B),Ke(ue,Qt,aa),Ke(de,Qt,na)):Qt.id=n+":"+h,o.target=Qt,(u=qe(Qt,ia))&&Ct.menu.set(l,u),kt(Dt,Qt));Ne("update.tools",[c])}function ra(){Ct.keys=function(){var a,e=Re(Ct.keys).sort().reverse(),t={};for($=0,B=je(e);B>$;++$)a=e[$],t[a]=Ct.keys[a];return t}(),ua(),Ne("update.keys",[c])}function sa(e){function g(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var a=c.$(),n=a.before,i=a.after,o=n.slice(-1),r=i[0],s=a.length,u=Ct.keys,h=TE.keys_alias,l={control:0,shift:0,option:"alt",meta:0},f=(n.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for($ in l)e.TE[$]()&&(L[l[$]||$]=1);F=e.TE.key(),L[F]=1,t=Le(L),v(function(){c.record()});for($ in u){K=g($),N=0;for(B in K)B=K[B],L[h[B]||B]&&++N;if(K=je(K),N===K&&t===K&&(Y(u[$])&&(u[$]=Ct.tools[u[$]].click),M=x(u[$])&&u[$](e,c),M===!1))return Be(e)}if(Ue)for($ in Ue)if(X=Ue[$],X!==!1){if(F===X&&r===X)return"\\"===o?(c.insert(F,0),Be(e)):(c.select(a.end+1),Be(e));if($===F)return c.wrap($,X),Be(e);if(o===$&&r===X){if("backspace"===F&&n.slice(-2)!=="\\"+$)return c.unwrap($,X),Be(e);if(be&&"enter"===F&&$!==X&&!s)return c.tidy("\n"+f+ke,"\n"+f).scroll(1),Be(e)}}if(be&&!s){if("backspace"===F&&p(d(ke)+"$").test(n))return c.outdent(ke),Be(e);if("enter"===F&&p("(^|\\n)("+d(ke)+")+.*$").test(n))return c.insert("\n"+f,0,1).scroll(1),Be(e)}}function ua(e){e&&e.TE&&e.TE.key?delete L[e.TE.key()]:L={}}function da(e){return ca=Rt,_=et(Jt),Be(e)}function ga(e){ca===Rt&&l(Ht,{height:Qe(Nt,e).y-_.h+Ye})}function pa(){ca=0}function Ea(){Ct.exit(1)}function va(){t=et(Bt),ne=t.w,q=t.h,t=et($t),ha=t.w,la=t.h}function Oa(e,t){return t&&Ne("exit.modal."+t,[c]),Xe(ue,$t,[e]),Be(e)}function Aa(e){ca=e.target,t=Qe(Bt,e),ie=t.x,oe=t.y,va()}function Ua(e){var a=fa.header,n=fa.sizer;ca===a||tt(ca,a)===a?(t=Qe(Nt,e),M=t.x-ie,ee=t.y-oe,l(Bt,{left:(ne>ha?M:f(M,0,ha-ne))+Ye,top:(q>la?ee:f(ee,0,la-q))+Ye})):ca===n&&(t=Qe(Bt,e),_=et(n),l(Bt,{width:t.x+_.w/4+Ye,height:t.y+_.h/4+Ye}))}function ba(){ca=0}function ya(e,t,a){return{header:e,body:t,footer:a}}function ka(e){Z=Ct.drop.target,G=Kt,N=e&&e.target||0,(!N||N!==Z&&tt(N,Z)!==Z)&&(Ct.drop.target=0,Ct.exit(N===Ht))}var Z,G,N,H,q,$,B,K,M,X,F,t,W,Q,_,ee,te,ae,ne,ie,oe,a="⌘",n="…",o="⇥",r="⇧",s=window,u=document,c=new TE(e),h=c._,l=h.css,f=h.edge,d=h.x,g=h.extend,p=h.pattern,E=h.timer.reset,v=h.timer.set,O=h.trim,A={},U=function(){},b=TE.is,y=b.e,k=b.a,x=b.f,m=b.i,I=b.o,C=b.r,w=function(e){return!b.x(e)},Y=b.s,z=u.documentElement,S=(u.head,u.body),R=(u.currentScript,g({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",a+"+Z"],redo:["Redo",a+"+Y"],indent:["Indent",o],outdent:["Outdent",r+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},t)),L={},se="blur",ue="click",de="keydown",ge="keyup",pe="touchstart mousedown",Ee="touchmove mousemove",ve="touchend mouseup",Ae="orientationchange resize",Ue=R.auto_close,be=R.auto_tab,ye=R.languages,ke=R.tab,me=(R.union[1][1],R.union[1][0]),Ie=R.union[0][1],Ce=R.union[0][0],we="javascript:;",Ye="px",Ct=c.ui={};c.tidy=function(e,t){var a=c.$(),n=O(a.before)?e:"",i=O(a.after)?w(t)?t:e:"";return c.trim(n,i)},c.i=function(){return O(c.replace(/\s+/g," "))},c.format=function(e,t,a,n){I(e)||(e=[e]),w(a)||(a=" "),w(n)||(n="");var i=c.h,o=c[0]().$(),r=e[0].split(p("("+Ie[3]+")+"))[0],s=(e[0]?me[0]+e[0]+me[1]:"")+n,u=n+(e[0]?me[0]+me[2]+(e[1]||r)+me[1]:""),h=d(e[0]?me[0]+r+me[1]:""),l=d(u),f=p("^"+h+"([\\s\\S]*?)"+l+"$"),g=p(h+"$"),E=p("^"+l),v=o.before,O=o.after;return o.length?a=!1:c.insert(ye.placeholders[""]),c.toggle(t?!f.test(o.value):!g.test(v)&&!E.test(O),[function(e){e.unwrap(s,u,1).tidy(p(Ce[0]+"[^"+Ce[0]+Ce[1]+Ce[2]+"]+?"+Ce[1]+"$").test(v)?"":a,p("^"+Ce[0]+Ce[2]+"[^"+Ce[0]+Ce[1]+"]+?"+Ce[1]).test(O)?"":a).wrap(s,u,t)},function(e){e.unwrap(s,u,t)}])[i]()};var Qt,wt=R.classes,Yt=wt[""],zt=ye.tools,Tt=ye.buttons,St=ye.labels,jt=Yt+"-textarea "+Yt+"-content block",Rt=It(Yt+"-sizer s"),Lt=It(Yt+"-sizer se"),Zt=It(Yt),Gt=It(Yt+"-header"),Nt=It(Yt+"-body"),Jt=It(Yt+"-footer"),Dt=It(Yt+"-tool"),Ht=rt(e,!1,R.attributes),Pt=It(Yt+"-description"),qt=rt(),$t=rt(),Bt=rt(),Kt=rt(),Mt=rt(),Xt=rt(),Ft=It("left","span"),Wt=It("right","span"),Vt=0;Ct.i=function(e,t,a){return e=Ve(e).replace(/[\/\s]/g,"-"),_=We(wt.i,[e,t||e]),a?(it(a),at(a,_),a):'<i class="'+_+'"></i>'},w(R.suffix)||(R.suffix=me[1]);var ia="ui-drop-data",ca=0,ie=0,oe=0,ne=0,q=0,ha=0,la=0,fa={};c.create=function(e,t){if(c.is.create)return c;c.is.create=!0,I(e)&&(R=g(R,e));var a=Ot(Ht);return at(Zt,Yt+"-is-can-update"),at(Zt,Yt+"-is-can-copy"),at(Ht,jt),a&&Et(a,"p")?(At(a,Zt),Vt=a,xt(a,!1)):At(Ht,Zt),Zt.dir=R.direction,kt(Zt,Gt),kt(Zt,Nt),kt(Zt,Jt),kt(Nt,Ht),R.tools&&(kt(Gt,Dt),kt(Jt,Pt),kt(Pt,Ft),kt(Pt,Wt)),Ke(de,Ht,sa),Ke(ge+" "+se,Ht,ua),R.resize&&(kt(Zt,Rt),at(Zt,Yt+"-is-can-resize"),Ke(pe,Rt,da),Ke(Ee,u,ga),Ke(ve,S,pa)),oa(),ra(),0!==t?Ne("create",[c]):c},c.update=function(e,t){return c.is.create&&c.destroy(0),(0!==t?Ne("update",[c]):c).create(e,0)},c.destroy=function(e){return c.is.create?(c.is.create=!1,Ct.exit(0,0,0),it(Ht,jt),R.tools=Te(R.tools),R.keys&&(Me(de,Ht,sa),Me(ge,Ht,ua)),R.resize&&(Me(pe,Rt,da),Me(Ee,u,ga),Me(ve,u,pa)),Vt?(At(Zt,Vt),kt(Vt,Ht),Vt=0):At(Zt,Ht),mt(Zt),0!==e?Ne("destroy",[c]):c):c},c.enable=function(e){return Ht.disabled=Ht.readOnly=!1,at(Zt,Yt+"-is-can-update"),at(Zt,Yt+"-is-can-copy"),0!==e?Ne("enable",[c]):c},c.disable=function(e){return Ht.disabled=!0,it(Zt,Yt+"-is-can-update"),it(Zt,Yt+"-is-can-copy"),0!==e?Ne("disable",[c]):c},c.freeze=function(e){return Ht.disabled=!1,Ht.readOnly=!0,it(Zt,Yt+"-is-can-update"),at(Zt,Yt+"-is-can-copy"),0!==e?Ne("freeze",[c]):c},Ct.exit=function(e,t,a){if(H={panel:function(){mt(qt)},overlay:function(){Me(ue,$t,Ea),mt($t)},modal:function(){Me(ue+" "+de,fa.x,Oa),Me(pe,Nt,Aa),Me(Ee,Nt,Ua),Me(ve,u,ba),mt(Bt)},drop:function(){Me(ue,u,ka),Me(Ae,s,ka),mt(Kt)},bubble:function(){mt(Mt)}},ua(),t)if(I(t))for($ in t)$=t[$],H[$]&&H[$](),0!==a&&Ne("exit."+$,[c]);else H[t]&&H[t](),0!==a&&Ne("exit."+$,[c]);else for($ in H)H[$]();return e&&c.select(),0!==a&&Ne("exit",[c]),c},Ct.panel=function(e,t,a,n){function i(e){return Me(ue+" "+de,ie,i),Ct.panel.exit(1),Be(e)}return Ct.exit(0,0,0),M=Ve(e),ee=0,n&&(M+=" "+M+"--"+Ve(n)),I(t)&&!y(t)&&(ee=It(Yt+"-panel-header "+M,0,t.header),t=t.body),te=It(Yt+"-panel-body "+M,0,It(Yt+"-panel-content "+M,0,x(t)?"":t)),x(t)&&t(te),ie=rt("a",!1,{href:we,"class":Yt+"-a "+Yt+"-x "+M}),ie.title=Tt.close,rt(qt,!1,{"class":Yt+"-panel "+M}),Ke(ue+" "+de,ie,i),ht(qt,0),ee&&kt(qt,ee),kt(Nt,rt(qt,[te,ie])),x(a)?a(qt):Y(a)&&rt(qt,a),Z=[c,qt],n&&Ne("enter.panel."+e+":"+n,Z),Ne("enter.panel."+e,Z),Ne("enter.panel",Z),Ne("enter",Z),ie.focus(),c},Ct.panel.fit=function(){},Ct.overlay=function(e,t,a,n){return Ct.exit(0,0,0),M=Ve(e),n&&(M+=" "+M+"--"+Ve(n)),kt(Nt,rt($t,!1,{"class":Yt+"-overlay "+M})),t&&Ke(ue,$t,Ea),x(a)?a($t):Y(a)&&rt($t,a),Z=[c,$t],n&&Ne("enter.overlay."+e+":"+n,Z),Ne("enter.overlay."+e,Z),Ne("enter.overlay",Z),Ne("enter",Z),c},Ct.overlay.fit=function(){},Ct.message=function(e,t,a,n,i){function r(e){return Me(ue+" "+de,ie,r),E(o),Ct.overlay.exit(1),Be(e)}var o;return M=Ve(e),i&&(M+=" "+M+"--"+Ve(i)),ie=rt("a",!1,{href:we,"class":Yt+"-a "+Yt+"-x "+M}),ie.title=Tt.close,rt(Xt,x(t)?t(Xt):t,{"class":Yt+"-message "+M}),Ke(ue+" "+de,ie,r),Ct.overlay("message message-"+M,0,function(e){kt(Xt,ie),a&&(o=v(function(){r()},a)),kt(e,Xt)},i),x(n)?n(Xt):Y(n)&&rt(Xt,n),c},Ct.modal=function(){var s,h,e=arguments,t=e[0],a=e[1],n=e[2],i=e[3],o=Yt+"-modal",r=a.footer;if(I(t)&&(t="default",a=e[0],n=e[1],i=e[2]),Ct.overlay(t,1,0,i).blur(),M=Ve(t),i&&(M+=" "+M+"--"+Ve(i)),rt(Bt,!1,{"class":o+" "+M}),w(a.body)&&(a.body=rt("div",a.body,{"class":o+"-content "+M})),w(r)&&I(r)&&!y(r)){h=[];for($ in r)B=r[$],y(B)?h.push(B):(B=ta(B,$,r),K=$.text||Tt[$]||$,s=rt("button",K,g({name:"y["+$+"]",type:"button","class":Yt+"-button",data:{"button-id":$}},B.attributes)),Ke(ue,s,function(e){return K=r[qe(this,"button-id")].click(e,c),K===!1?Be(e):void 0}),h.push(s));a.footer=h}for($ in a)o[1]=$,fa[$]=It(o+"-"+We($,o)+" "+M,0,a[$]);return fa.x=rt("a",!1,{href:we,"class":Yt+"-a "+Yt+"-x "+M}),fa.sizer=Lt,ht(Bt,0),fa.x.title=Tt.close,kt(Nt,rt(Bt,fa,{style:""})),Ct.modal.fit(),Ut(Bt,$t),Ke(ue+" "+de,fa.x,Oa),Ke(pe,fa.header,Be),Ke(pe,fa.sizer,Be),Ke(pe,Nt,Aa),Ke(Ee,Nt,Ua),Ke(ve,u,ba),x(n)&&n(fa),Z=[c,Bt,fa],i&&Ne("enter.modal."+t+":"+i,Z),Ne("enter.modal."+t,Z),Ne("enter.modal",Z),Ne("enter",Z),fa.x.focus(),c},Ct.modal.fit=function(e){return va(),M=ha/2-ne/2,ee=la/2-q/2,I(e)?(w(e[0])&&(M=e[0]),w(e[1])&&(ee=e[1])):(M=f(M,0),ee=f(ee,0)),l(Bt,{left:M+Ye,top:ee+Ye,"min-width":ne+Ye,"min-height":q+Ye,visibility:"visible"}),Z=[c,Bt,fa],Ne("fit.modal",Z),Ne("fit",Z),c};var xa={"class":Yt+"-button",name:"y"};return Ct.alert=function(e,t,a,n,i){var o=rt("button",Tt.okay,xa),r="alert";return a=a||U,I(e)&&(r+=":"+e[0],e=e[1]||e[0]),Ke(ue,o,function(e){return a(e,c),Oa(e,r+".y")}),Ke(de,o,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Xe(ue,o,[e]),Be(e)}),Ct.modal(r,ya(e,t,o),n,i),o.focus(),c},Ct.confirm=function(e,t,a,n,i,o){function l(e){return x(a)&&a(e,c),Oa(e,u+".y")}function f(e){return x(n)&&n(e,c),Oa(e,u+".n")}var h,r=rt("button",Tt.okay,xa),s=rt("button",Tt.cancel,xa),u="confirm";return s.name="n",Ke(ue,r,l),Ke(ue,s,f),Ke(de,r,function(e){return h=e.TE.key,h("arrowright")?s.focus():h("enter")?l(e):h("escape")&&Oa(e,u+".y"),Be(e)}),Ke(de,s,function(e){return h=e.TE.key,h("arrowleft")?r.focus():h("enter")?f(e):h("escape")&&Oa(e,u+".n"),Be(e)}),Ct.modal(u,ya(e,t,[r,s]),i,o),s.focus(),c},Ct.prompt=function(e,t,a,n,i,o,r){function E(){h.focus(),"placeholder"in h&&h.select()}function v(e){return d=h.value,x(a)&&!a(d)?E():!a||O(d)&&d!==t?(Oa(e,l+".y"),n(e,c,d!==t?d:"",t)):E(),Be(e)}function A(e){return Oa(e,l+".n")}var d,g,p,s=rt("button",Tt.okay,xa),u=rt("button",Tt.cancel,xa),h=rt("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Yt+"-input block"}),l="prompt",f=[];if(i=i||0,1===i)h=rt("textarea",t,{placeholder:t.split("\n")[0],"class":Yt+"-textarea block",spellcheck:"false"});else if(2===i){for($ in t)f.push(rt("option",t[$],{value:$,selected:$===a||null}));h=rt("select",f,{"class":Yt+"-select block"})}return n=n||U,h.name="data",u.name="n",Ke(de,h,function(e){return g=e.TE.key,p=e.TE.control,g("enter")&&0===i||p("enter")?v(e):g("escape")||g("backspace")&&!this.value?A(e):g("arrowdown")&&0===i||g("enter")&&2===i||p("arrowdown")?(s.focus(),Be(e)):void 0}),Ke(de,s,function(e){return g=e.TE.key,g("enter")?v(e):g("escape")?A(e):g("arrowup")?h.focus():g("arrowright")&&u.focus(),Be(e)}),Ke(de,u,function(e){return g=e.TE.key,g(/^(enter|escape)$/)?A(e):g("arrowup")?h.focus():g("arrowleft")&&s.focus(),Be(e)}),Ke(ue,s,v),Ke(ue,u,A),Ct.modal(l,ya(e,h,[s,u]),o,r),E(),c},Ct.drop=function(){Ct.exit(0,0,0);var e=arguments,t=e[0],a=e[1],n=e[2];return 1===je(e)&&(t="default",a=e[0],n=e[1]),M=Ve(t),ht(Kt,0),kt(S,rt(Kt,!1,{"class":Yt+"-drop "+M})),x(a)?a(Kt):rt(Kt,a),Ct.drop.fit(),n===!1||(Ke(ue,u,ka),Ke(Ae,s,ka)),Z=[c,Kt],Ne("enter.drop."+t,Z),Ne("enter.drop",Z),c},Ct.drop.fit=function(e){return Z=et(z),G=et(Kt),N=Ct.drop.target,M=Z.w/2-G.w/2,ee=Z.h/2-G.h/2,!w(e)&&N&&(t=_e(N),M=t.l,ee=t.t+et(N).h),I(e)?(w(e[0])&&(M=e[0]),w(e[1])&&(ee=e[1])):(M=f(M,0,Z.w-G.w),ee=f(ee,0,Math.max(Z.h,et(s).h)-G.h)),l(Kt,{left:M+Ye,top:ee+Ye,visibility:"visible"}),Z=[c,Kt],Ne("fit.drop",Z),Ne("fit",Z),c},Ct.menu=function(e,a,n,i){var s,o=Ct.tools,r=0;if(a===!1)return Ct.tool(e,a);for(i in n)ne="%"===i[0],s=n[i],s=Y(s)&&!ne?o[s]:s,s&&(s=ta(s,i,o),n[i]=s);return Ct.tool(e,{i:I(a)?a[0]:0,text:I(a)?a[1]||0:a&&n[a]&&n[a].text||a,click:function(u){var h=Ct.drop.target=o[e].target;return Ct.drop("menu menu-"+Ve(e),function(u){function l(r){return ee=this,t=qe(ee,"tool-id"),X=n[t],X=Y(X)?o[X]:X||{},F=ct(ee),!ea(X)&&x(i=X.click)&&(i=i(r,c),X.i&&(o[e].i=X.i),Ct.menu.set(e,I(X.text)?[X.text[0],t]:I(a)?[a[0],t]:t),i===!1)?(c.select(),Be(r)):(c.select(),Be(r))}function f(e){if(ee=this,(K=e.TE.key)("escape"))Ct.exit(1);else if(K("enter"))Xe(ue,ee,[e]);else if(K("f10")&&h)h.focus();else if(K("arrowdown")&&(M=dt(ee))){for(;!Et(M,"a")&&M;)M=dt(M);M&&M.focus()}else if(K("arrowup")&&(M=gt(ee))){for(;!Et(M,"a")&&M;)M=gt(M);!M&&h?(Ct.exit(),h.focus()):M&&M.focus()}else K("arrowup")&&h&&(Ct.exit(),h.focus());return Be(e)}for(i in n)if(s=n[i],ne="%"===i[0],s){var d={href:ne?null:we,"class":Yt+"-"+(ne?"label":"button")};ne?B=St[e]&&St[e][+i.slice(1)-1]||i:(d.data={},d.data["tool-id"]=i,B=zt[i]||i),Q=s.text,Q=I(Q)?Q[1]||"":Q,B=I(B)?B[0]:B,_=rt(ne?"span":"a","<span>"+(ne?B||"%"+r:Q||B)+"</span>",g(d,s.attributes||{})),at(_,"menu-"+Ve(i).replace(/[\/\s]/g,"-")),!d.title&&(ee=s.title)&&(_.title=I(ee)?ee[0]+(ee[1]?" ("+ee[1]+")":""):ee),ne?Je(_,{id:Yt+"-label:"+r}):(ea(s)?at(_,"x"):it(_,"x"),s.on?at(_,"on"):it(_,"on"),Ke(ue,_,l),Ke(de,_,f)),kt(u,_),++r}v(function(){(vt('[data-tool-id="'+qe(h,ia)+'"]',u)[0]||vt("a",u)[0]).focus()},1)}),!1}},i),Pe(o[e].target,{"ui-drop":e}),o[e].data=n,Ct.menu.set(e,a)},Ct.menu.set=function(e,t){var o,r,a=Ct.tools[e]||{},n=a.target,i=a.data;return n?(I(t)?Pe(n,ia,t[1]||""):(Pe(n,ia,t),t=i[t]&&i[t].text||t),I(t)?(r=t[0],r=Se(r,"<")?r:Ct.i(r,a.i),t=w(t[1])?t[1]:0,t=t&&i[t]&&i[t].text||t,t=r+(0!==t?"<span>"+(I(t)?t[1]||t:t)+"</span>":"")):r=Ct.i(e,a.i),(o=vt("."+Yt+"-text",n)[0])?(at(n,"text"),ut(o,t)):(it(n,"text"),ut(n,r)),c):c},Ct.bubble=function(){Ct.exit(0,0,0);var e=arguments,t=e[0],a=e[1];return 1===je(e)&&(t="default",a=e[0]),M=Ve(t),ht(Mt,0),kt(S,rt(Mt,!1,{"class":Yt+"-bubble "+M})),x(a)?a(Mt):rt(Mt,a),Ct.bubble.fit(),Z=[c,Mt],Ne("enter.bubble."+t,Z),Ne("enter.bubble",Z),c},Ct.bubble.fit=function(e){_=c.$(1),t=_e(Ht),q=l(Ht,"line-height");var a="border-",n="-width";M=_.caret[0].x+t.l-Ht.scrollLeft,ee=_.caret[1].y+t.t+q-Ht.scrollTop,G=l(Nt,[a+"top"+n,a+"bottom"+n,a+"left"+n,a+"right"+n]);var i=et(Nt),o=et(Mt),r=G[0]+G[1],s=G[2]+G[3];return I(e)?(w(e[0])&&(M=e[0]),w(e[1])&&(ee=e[1])):(M=f(M,t.l,t.l+i.w-o.w-s),ee=f(ee,t.t,t.t+i.h-o.h-r)),l(Mt,{left:M+Ye,top:ee+Ye,visibility:"visible"}),Z=[c,Mt],Ne("fit.bubble",Z),Ne("fit",Z),c},Ct.panel.exit=function(e){return Ct.exit(e,"panel")},Ct.overlay.exit=function(e){return Ct.exit(e,"overlay")},Ct.modal.exit=function(e){return Ct.exit(e,"modal")},Ct.drop.exit=function(e){return Ct.exit(e,"drop")},Ct.bubble.exit=function(e){return Ct.exit(e,"bubble")},Ct.tool=function(e,t,a){var n=Ct.tools;return B="",K=w(n[e])?"update":"create","|"!==e&&(R.tools=ze(R.tools).filter(function(t,a){return t===e?(B=a,!1):!0})),t===!1?(delete n[e],K="destroy"):("|"===e?(a=t,t={}):(x(t)&&(t={click:t}),n[e]=g(n[e]||{},t),w(a)||""===B||(a=B)),m(a)?R.tools.splice(a,0,e):R.tools.push(e)),Ne(K+".tool."+e,[c,n[e]]),oa(),c},Ct.separator=function(e,t){return Ct.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Ct.key=function(e,t){var a=Ct.keys;return K=w(a[e])?"update":"create",t===!1?(delete a[e],K="destroy"):a[e]=t,Ne(K+".key."+e,[c,a[e]]),ra(),c},Ct.key.set=function(e){L[e]=1},Ct.key.reset=function(e){e?delete L[e]:L={}},Ct.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ke),!1},outdent:function(e,t){return t.outdent(ke),!1}},Ct.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return Q=":not([tabindex]):not([disabled])",(_=vt("input"+Q+",button"+Q+",select"+Q+",textarea"+Q+",a[href]"+Q+",[contenteditable]"+Q+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(ee=_.indexOf(Ht))?((_[ee+1]||u).focus(),!1):void 0},f10:function(e,t){return vt("a",Dt)[0].focus(),!1},tab:be?"indent":0,"shift+tab":be?"outdent":0},Ct.el={container:Zt,header:Gt,body:Nt,footer:Jt,panel:qt,overlay:$t,modal:Bt,drop:Kt,bubble:Mt},c.config=R,g(TE._,{time:function(e){var t=new Date(w(e)?e:Date.now()),a=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),o=t.getHours(),r=t.getMinutes(),s=t.getSeconds(),u=t.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>o&&(o="0"+o),10>r&&(r="0"+r),10>s&&(s="0"+s),10>u&&(u="0"+u),[""+a,""+n,""+i,""+o,""+r,""+s,""+u]},replace:Fe,format:We,dom:{set:kt,reset:xt,get:vt,id:st,copy:function(e,t){return e.cloneNode(w(t)?t:!0)},classes:{set:at,reset:it,toggle:ot,get:nt},attributes:{set:Je,reset:He,get:De},data:{set:Pe,reset:$e,get:qe},is:Et,offset:_e,pointer:Qe,size:et,content:{set:ut,reset:ht,get:ct},closest:tt,parent:lt,children:ft,next:dt,previous:gt,index:pt,before:At,after:Ut,prepend:bt,append:yt},el:rt,event:{set:Ke,reset:Me,fire:Xe,x:Be}}),g(c._,TE._),g(c._,{hooks:A,hook:{set:Ze,reset:Ge,fire:Ne}}),c.create()};