/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(A){function BA(A){return f(A)?i(A).split(/\s+/):A}function PA(A){return H(A)?A.join(" "):A}function WA(A,E,O){return M(A)?M(E)?(M(W[A])||(W[A]={}),M(O)||(O=Object.keys(W[A]).length),W[A][O]=E,t):W[A]:W}function KA(A,E){return M(A)?M(E)&&M(W[A])?(delete W[A][E],t):(W[A]={},t):(W={},t)}function dA(A,E,O){if(!M(W[A]))return W[A]={},t;if(M(O))M(W[A][O])&&W[A][O].apply(t,E);else for(V in W[A])W[A][V].apply(t,E);return t}function pA(A,E,O){if(H(E))for(V in E)pA(A,V,E[V]);else A.setAttribute(E,O)}function YA(E,O,e){if(f(O))return YA(E,[O],M(e)?e:"")[0];A=[];for(V in O)V=O[V],(V=E.getAttribute(V))&&A.push(V);return A.length?A:M(e)?e:[]}function hA(A,E){if(H(E))for(V in E)hA(A,E[V]);else if(M(E))A.removeAttribute(E);else for(hA(A,"class"),V=0,k=A.attributes,w=k.length;w>V;++V)k[V]&&hA(A,k[V].name)}function mA(A,E,O){if(H(E))for(V in E)mA(A,V,E[V]);else pA(A,"data-"+E,O)}function bA(E,O,e){if(f(O))return bA(E,[O],M(e)?e:"")[0];A=[];for(V in O)V=O[V],(V=YA(E,"data-"+V))&&A.push(V);return A.length?A:M(e)?e:[]}function gA(A,E){if(H(E))for(V in E)hA(A,"data-"+E[V]);else if(M(E))hA(A,"data-"+E);else for(V=0,k=A.attributes,w=k.length;w>V;++V)k[V]&&"data-"===k[V].name.slice(0,5)&&hA(A,k[V].name)}function vA(A){return A&&A.preventDefault(),!1}function $A(A,E,O){if(E){for(A=BA(A),V=0,k=A.length;k>V;++V)E.addEventListener(A[V],O,!1),WA("on:"+A[V],O,AE(E));return t}}function VA(A,E,O){if(E){for(A=BA(A),V=0,k=A.length;k>V;++V)E.removeEventListener(A[V],O,!1),KA("on:"+A[V],AE(E));return a(E)&&E.id.split(":")[0]===cE+"-dom"&&hA(E,"id"),t}}function kA(A,E,O){A=BA(A);var R,e="createEvent"in N;for(V=0,k=A.length;k>V;++V)e?(R=N.createEvent("HTMLEvents"),R.data=O,R.initEvent(A[V],!0,!1),E.dispatchEvent(R)):dA("on:"+A[V],O,AE(E));return t}function wA(A,E,O){for(V=0,k=E.length,w;k>V;++V)w=E[V],A=A.replace(c(w)?w:C(S(w),"g"),O&&O[V]||"");return A}function yA(A,E){return A.replace(/%(\d+)/g,function(A,O){return--O,M(E[O])?E[O]:A})}function xA(A){return i(wA(A,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function QA(A,E){var O=E.touches?E.touches[0].pageX:E.pageX,e=E.touches?E.touches[0].pageY:E.pageY,R=_A(A);return{x:O-R.l,y:e-R.t}}function _A(A){for(y=A.offsetLeft,q=A.offsetTop;A=A.offsetParent;)y+=A.offsetLeft,q+=A.offsetTop;return{l:y,t:q}}function XA(A){return{w:A.offsetWidth,h:A.offsetHeight}}function JA(A,E){for(;(A=RE(A))&&A!==E;);return A}function ZA(A,E){E=BA(E);for(V in E)A.classList.add(E[V])}function qA(E,O,e){if(f(O))return qA(E,[O],M(e)?e:"")[0];A=[];for(V in O)V=O[V],E.classList.contains(V)&&A.push(V);return A.length?A:M(e)?e:!1}function jA(A,E){if(M(E)){E=BA(E);for(V in E)A.classList.remove(E[V])}else hA(A,"class")}function zA(A,E,O){if(A=f(A)?N.createElement(A):A,H(O))for(V in O)if(z=O[V],"classes"===V)ZA(A,z);else if("data"===V)for(k in z)z=z[k],null===z?gA(A,k):mA(A,k,z);else"css"===V?f(z)?pA(A,"style",z):null===z?hA(A,"style"):F(A,z):s(z)?A[V]=z:null===z?hA(A,V):pA(A,V,H(z)?z.join(" "):""+z);if(a(E))GE(A,E);else if(H(E))for(V in E)z=E[V],a(z)?GE(A,z):z!==!1&&EE(A,z);else M(E)&&E!==!1&&EE(A,E);return A}function AE(A){var E=A.id;return E||(E=cE+"-dom:"+Date.now(),A.id=E),E}function EE(A,E){A.innerHTML=E}function OE(A,E){return A.innerHTML||(M(E)?E:"")}function eE(A,E){if(E!==!1&&(h=IE(A)))for(V=0,k=h.length;k>V;++V)eE(h[V]);EE(A,"")}function RE(A){return A&&A.parentNode}function IE(A){return A&&A.children||[]}function LE(A){return A&&A.nextSibling}function NE(A){return A&&A.previousSibling}function tE(A,E){return A&&f(E)?A.nodeName.toLowerCase()===E.toLowerCase():A&&s(E)?A===E(A):A===E}function SE(E,O){if(O=O||N,A=[],f(E)){if(/^([#.]?[\w-]+|\*)$/.test(E)){if("#"===E[0]&&(E=O.getElementById(E.slice(1))))return[E];if("."===E[0]&&(E=O.getElementsByClassName(E.slice(1)))||(E=O.getElementsByTagName(E))){for(V=0,k=E.length;k>V;++V)A.push(E[V]);return A}return[]}for(E=O.querySelectorAll(E),V=0,k=E.length;k>V;++V)A.push(E[V]);return A}return nE(E)?[E]:[]}function nE(A,E){var O=RE(A);return 1===arguments.length?O||!1:A&&O===A?O:!1}function FE(A,E){_=RE(A),_&&_.insertBefore(E,A)}function rE(A,E){_=RE(A),_&&_.insertBefore(E,LE(A))}function CE(A,E){h=IE(A)[0],h?FE(h,E):GE(A,E)}function iE(A,E){GE(A,E)}function GE(A,E){A.appendChild(E)}function lE(A,E){var O=nE(A);if(O){if(E!==!1)for(h=IE(A)[0];h;)lE(h);O.removeChild(A)}}function oE(A){eE(zA(A,!1,{style:""})),lE(A)}function aE(A,E,O){return zA(E||"div",O,{"class":A})}function XE(A){return!A||M(A.active)&&!Z.active}function JE(){uE._word&&uE._words&&(z=(YE.value||"").replace(C(cA[0]+"[^"+cA[0]+cA[1]+"]+?"+cA[1],"g"),""),V=(z.match(/(\w+)/g)||[]).length,EE(kE,yA(uE["_word"+(1===V?"":"s")],[V])))}function ZE(A,E,O){return s(A)&&(A={click:A}),f(A.click)&&(A.click=(O[A.click]||{}).click),M(A.title)||(A.title=fE[E]||""),O[E]=A,A}function qE(){eE(pE,!1);var e,R,I,L,N,T,S,A=BA(d.tools),E=cE+"-button",O=cE+"-separator";d.tools=A;for(T in A)S=A[T],R=sE.tools[S],(R||R==={})&&(R=ZE(R,S,sE.tools),I=R.i||S,"|"!==I&&"<"!==I[0]&&(I=xA(I)),L="|"!==I,N=xA(I).replace(/\s/g,""),QE=aE(L?E+" "+E+"-"+N:O+" "+O+"-"+T,L?"a":"span"),L?(e=E+":"+N,pA(QE,{href:UA,id:e,tabindex:-1}),mA(QE,MA,S),I="<"===I[0]?I:'<i class="'+yA(HE,[I])+'"></i>',XE(R)&&ZA(QE,"x"),R.text&&(I=yA('<span class="'+cE+'-text">'+R.text+"</span>",[I]),ZA(QE,"text")),EE(QE,I),zA(QE,!1,R.attributes||{}),!QE.title&&(k=R.title)&&(QE.title=H(k)?k[0]+(k[1]?" ("+k[1]+")":""):k),$A(FA,QE,IO)):QE.id=O+":"+T,sE.tools[S].target=QE,GE(pE,QE));dA("update.tools",[t])}function jE(){sE.keys=function(){var O,A=Object.keys(sE.keys).sort().reverse(),E={};for(V=0,k=A.length;k>V;++V)O=A[V],E[O]=sE.keys[O];return E}(),eO(1),dA("update.keys",[t])}function zE(A){JE(),dA("on:change",[A,t])}function OO(E){function r(A){return A.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var O=t.$(),e=O.before,R=O.after,I=e.slice(-1),L=R[0],N=O.length,T=sE.keys,n=TE.keys_alias,F=(e.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();Q=E.TE.key(),AO[Q]=1,A=Object.keys(AO).length,G(function(){t.record()},1);for(V in T){w=r(V),h=0;for(k in w)k=w[k],AO[n[k]||k]&&++h;if(w=w.length,h===w&&A===w&&(f(T[V])&&(T[V]=sE.tools[T[V]].click),y=T[V]&&T[V](E,t),y===!1))return vA(E)}if(sA)for(V in sA)if(x=sA[V],x!==!1){if(Q===x&&L===x)return"\\"===I?(t.insert(Q,0),vA(E)):(t.select(O.end+1),vA(E));if(V===Q)return t.wrap(V,x),vA(E);if(I===V&&L===x){if("backspace"===Q&&e.slice(-2)!=="\\"+V)return t.unwrap(V,x),vA(E);if(aA&&"enter"===Q&&V!==x)return t.tidy("\n"+F+oA,"\n"+F).scroll(!0),vA(E)}}if(aA&&!N){if("backspace"===Q&&C(S(oA)+"$").test(e))return t.outdent(oA).scroll(!0),vA(E);if("enter"===Q&&C("(^|\\n)("+S(oA)+")+.*$").test(e))return t.insert("\n"+F,0,1).scroll(!0),vA(E)}}function eO(A){H(A)?delete AO[A.TE.key()]:AO={}}function RO(A){/^(focus|blur)$/.test(A.type)&&eO(1),l(EO),EO=G(function(){zE(A)},d.debounce||0)}function IO(A){sE.exit(0,0,0);var E=bA(this,MA),O=sE.tools,e=O[E];return xE=A.currentTarget||A.target,!XE(e)&&s(k=e.click)&&(k=k(A,t,E),dA("on:change",[A,t,E]),k===!1)?vA(A):(t.select(),vA(A))}function SO(A){return LO=hE,Z=XA(dE),vA(A)}function nO(A){LO===hE&&F(YE,{height:QA(KE,A).y-Z.h+uA})}function FO(){LO=0}function rO(){sE.exit(1)}function CO(){A=XA(gE),AA=A.w,$=A.h,A=XA(bE),NO=A.w,tO=A.h}function iO(A,E){E&&dA("exit.modal."+E,[t]),kA(FA,bE,[A])}function GO(E){LO=E.target,A=QA(gE,E),EA=A.x,OA=A.y,CO()}function lO(E){var O=TO.header,e=TO.resize;LO===O||JA(LO,O)===O?(A=QA(KE,E),y=A.x-EA,q=A.y-OA,F(gE,{left:(AA>NO?y:r(y,0,NO-AA))+uA,top:($>tO?q:r(q,0,tO-$))+uA})):LO===e&&(A=QA(gE,E),Z=XA(e),F(gE,{width:A.x+Z.w/4+uA,height:A.y+Z.h/4+uA}))}function oO(){LO=0}function aO(A,E,O){return{header:A,body:E,footer:O}}function sO(A){p=xE,Y=vE,h=A&&A.target||0,(!h||h!==p&&JA(h,p)!==p)&&(xE=0,oE(vE),VA(FA,N,sO),VA(iA,L,sO),sE.exit(A.target===P))}function HO(E){function O(){A&&(_=XA(A),F(J,{width:_.w+uA,height:_.h+uA}))}return z=t.get(),AA="",-1===z.indexOf("</html>")&&(AA='<!DOCTYPE html><html dir="'+d.dir+'"><head><meta charset="utf-8"><style>'+d.css+"</style></head><body>"+z+"</body></html>"),J=zA("iframe",!1,{"class":cE+"-portal",src:"data:text/html,"+encodeURIComponent(AA)}),!nE(bE)&&z?sE.overlay(J,1,function(){A=IE(bE)[0],O(),$A(iA,L,O),dA("enter.overlay.preview",[E,t,[z,AA],A])}):(VA(iA,L,O),rO()),vA(E)}var p,Y,h,g,$,V,k,w,y,x,Q,A,_,J,Z,q,z,AA,EA,OA,E="⌘",O="…",R="⇥",I="⇧",L=window,N=document,t=this,T=t._,S=T.x,n=T.extend,F=T.css,r=T.edge,C=T.pattern,i=T.trim,G=T.timer.set,l=T.timer.reset,o=t.is,a=o.e,s=o.f,D=o.i,H=o.o,c=o.r,f=o.s,M=function(A){return!o.x(A)},U=N.documentElement,B=(N.head,N.body),P=t.target,W={},K=function(){},d=n({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",E+"+Z"],redo:["Redo",E+"+Y"],indent:["Indent",R],outdent:["Outdent",I+"+"+R],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+O},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},A),RA="keydown",IA="keyup",LA="copy",NA="cut",tA="paste",TA="touchstart mousedown",SA="touchend mouseup",nA="touchmove mousemove",FA="click",rA="focus",CA="blur",iA="orientationchange resize",GA=CA+" "+LA+" "+NA+" "+rA+" input "+RA+" "+tA,lA=d.languages,oA=d.tab,aA=d.auto_tab,sA=d.auto_close,DA=d.unit[0][0],cA=(d.unit[0][1],d.unit[1][0]),fA=d.unit[1][1],MA="tool-id",UA="javascript:;",uA="px",sE=t.ui={};t.tidy=function(A,E){var O=t.$(),e=i(O.before)?A:"",R=i(O.after)?M(E)?E:A:"";return t.trim(e,R)},t.i=function(){return i(t.replace(/\s+/g," "))},t.format=function(A,E,O,e){H(A)||(A=[A]),M(O)||(O=" "),M(e)||(e="");var R=t.$(),I=(A[0]?DA[0]+A[0]+DA[1]:"")+e,L=e+(A[0]?DA[0]+DA[2]+(A[1]||A[0].split(C("("+fA[3]+")+"))[0])+DA[1]:""),N=S(I),T=S(L),n=C("^"+N+"([\\s\\S]*?)"+T+"$"),F=C(N+"$"),r=C("^"+T),i=R.before,G=R.after;return R.length?O=!1:t.insert(lA.placeholders[""]).loss(),t.toggle(E?!n.test(R.value):!F.test(i)&&!r.test(G),[function(A){A.unwrap(I,L,1).tidy(C(cA[0]+"[^"+cA[0]+cA[1]+cA[2]+"]+?"+cA[1]+"$").test(i)?"":O,C("^"+cA[0]+cA[2]+"[^"+cA[0]+cA[1]+"]+?"+cA[1]).test(G)?"":O).loss().wrap(I,L,E)},function(A){A.unwrap(I,L,E)}])};var QE,DE=d.classes,HE=DE.i,cE=DE[""],fE=lA.tools,ME=lA.buttons,UE=lA.labels,uE=lA.others,BE=cE+"-textarea "+cE+"-content block",PE=aE(cE),WE=aE(cE+"-header"),KE=aE(cE+"-body"),dE=aE(cE+"-footer"),pE=aE(cE+"-tool"),YE=zA(P,!1,d.attributes),hE=aE(cE+"-resize s"),mE=aE(cE+"-description"),bE=aE(cE+"-overlay"),gE=zA("div"),vE=zA("div"),$E=zA("div"),VE=aE("left","span"),kE=aE("right","span"),wE=aE(cE+"-preview","a"),yE=0,xE=0;d.suffix||(d.suffix=DA[1]);var AO={},EO=null;t.create=function(A,E){H(A)&&(d=n(d,A));var O=nE(YE);return ZA(YE,BE),O&&tE(O,"p")?(FE(O,PE),yE=O,lE(O,!1)):FE(YE,PE),PE.dir=d.dir,GE(PE,WE),GE(PE,KE),GE(PE,dE),GE(PE,hE),GE(KE,YE),d.tools&&(GE(WE,pE),GE(dE,mE),GE(mE,VE),GE(mE,kE)),$A(RA,YE,OO),$A(IA,YE,eO),$A(GA,YE,RO),$A(TA,hE,SO),$A(nA,N,nO),$A(SA,B,FO),uE.preview&&(Z=fE.preview,pA(wE,{href:UA,title:H(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z}),GE(VE,wE),EE(wE,uE.preview)),zE(null),qE(),jE(),0!==E?dA("create",[t]):t},t.update=function(A,E){return qA(YE,BA(BE),0)&&t.destroy(0),(0!==E?dA("update",[t]):t).create(A,0)},t.destroy=function(A){return qA(YE,BA(BE),0)?(sE.exit(0,0,0),jA(YE,BE),d.tools=PA(d.tools),d.keys&&(VA(RA,YE,OO),VA(IA,YE,eO)),VA(TA,hE,SO),VA(nA,N,nO),VA(SA,N,FO),VA(GA,YE,RO),yE?(FE(PE,yE),GE(yE,YE),yE=0):FE(PE,YE),oE(PE),0!==A?dA("destroy",[t]):t):t};var LO=0,EA=0,OA=0,AA=0,$=0,NO=0,tO=0,TO={};sE.exit=function(A,E,O){if(g={overlay:function(){VA(FA,bE,rO),oE(bE)},modal:function(){VA(TA,KE,GO),VA(nA,KE,lO),VA(SA,N,oO),VA(FA,TO.x,iO),oE(gE)},drop:function(){oE(vE)},bubble:function(){oE($E)}},E)if(H(E))for(V in E)V=E[V],g[V]&&g[V](),0!==O&&dA("exit."+V,[t]);else g[E]&&g[E](),0!==O&&dA("exit."+V,[t]);else for(V in g)g[V]();return A&&t.select(),0!==O&&dA("exit",[t]),t},sE.overlay=function(A,E,O){return sE.exit(0,0,0),eO(1),GE(KE,zA(bE,A.length||a(A)?aE(cE+"-overlay-content","div",A):"")),E&&$A(FA,bE,rO),s(O)?O(bE):zA(bE,O),dA("enter.overlay",[t]),dA("enter",[t]),t},sE.overlay.fit=function(){},sE.modal=function(){sE.overlay("",1).blur();var A=arguments,E=A[0],O=A[1],e=A[2],R=cE+"-modal";H(E)&&(E="default",O=A[0],e=A[1]),y=xA(E),zA(gE,!1,{"class":R+" "+y}),M(O.body)&&(O.body=zA("div",O.body,{"class":R+"-content "+y}));for(V in O)R[1]=V,TO[V]=aE(R+"-"+yA(V,R)+" "+y,0,O[V]);return TO.x=aE(cE+"-x "+y),TO.resize=aE(cE+"-resize se "+y),eE(gE),GE(KE,zA(gE,TO,{style:""})),sE.modal.fit(),rE(gE,bE),$A(FA,TO.x,iO),$A(TA,TO.header,vA),$A(TA,TO.resize,vA),$A(TA,KE,GO),$A(nA,KE,lO),$A(SA,N,oO),s(e)&&(TO.overlay=bE,TO.modal=gE,e(TO)),dA("enter.modal."+E,[t]),dA("enter.modal",[t]),dA("enter",[t]),t},sE.modal.fit=function(A){return CO(),y=NO/2-AA/2,q=tO/2-$/2,H(A)?(M(A[0])&&(y=A[0]),M(A[1])&&(q=A[1])):(y=r(y,0),q=r(q,0)),F(gE,{left:y+uA,top:q+uA,"min-width":AA+uA,"min-height":$+uA,visibility:"visible"}),dA("fit.modal",[t]),dA("fit",[t]),t};var DO={"class":cE+"-button",name:"y"};return sE.alert=function(A,E,O,e){var R=zA("button",ME.okay,DO),I="alert";return O=O||K,H(A)&&(I+=":"+A[0],A=A[1]||A[0]),$A(FA,R,function(A){return O(A,t),iO(A,I+".y"),vA(A)}),$A(RA,R,function(A){var E=A.TE.key;return E(/^(escape|enter)$/)?(kA(FA,R,[A]),vA(A)):void 0}),sE.modal(I,aO(A,E,R),e),R.focus(),t},sE.confirm=function(A,E,O,e,R){function S(A){return s(O)&&O(A,t),iO(A,N+".y"),vA(A)}function n(A){return s(e)&&e(A,t),iO(A,N+".n"),vA(A)}var T,I=zA("button",ME.okay,DO),L=zA("button",ME.cancel,DO),N="confirm";return L.name="n",H(A)&&(N+=":"+A[0],A=A[1]||A[0]),$A(FA,I,S),$A(FA,L,n),$A(RA,I,function(A){return T=A.TE.key,T("arrowright")?(L.focus(),vA(A)):T("arrowleft")?vA(A):T("enter")?(S(A),vA(A)):T("escape")?(iO(A,N+".y"),vA(A)):void 0}),$A(RA,L,function(A){return T=A.TE.key,T("arrowright")?vA(A):T("arrowleft")?(I.focus(),vA(A)):T("enter")?(n(A),vA(A)):T("escape")?(iO(A,N+".n"),vA(A)):void 0}),sE.modal(N,aO(A,E,[I,L]),R),L.focus(),t},sE.prompt=function(A,E,O,e,R,I){function C(){T.focus(),"placeholder"in T&&T.select()}function G(A){return vA(A)}function l(A){return F=T.value,!O||i(F)&&F!==E?(iO(A,S+".y"),vA(A),e(A,t,F!==E?F:"",E)):(C(),G(A))}function o(A){return iO(A,S+".n"),vA(A)}var F,r,L=zA("button",ME.okay,DO),N=zA("button",ME.cancel,DO),T=zA("input",!1,{type:"text",value:E,placeholder:E,spellcheck:"false","class":cE+"-input block"}),S="prompt",n=[];if(H(A)&&(S+=":"+A[0],A=A[1]||A[0]),s(R)&&(I=R,R=0),1===R)T=zA("textarea",E,{placeholder:E.split("\n")[0],"class":cE+"-textarea block"});else if(2===R){for(V in E)n.push(zA("option",E[V],{value:V,selected:V===O||null}));T=zA("select",n,{"class":cE+"-select block"})}return e=e||K,T.name="data",N.name="n",$A(RA,T,function(A){return r=A.TE.key,r("enter")?l(A):r("escape")||r("backspace")&&!this.value?o(A):r("arrowup")?G(A):r("arrowdown")?(L.focus(),vA(A)):void 0}),$A(RA,L,function(A){return r=A.TE.key,r("enter")?l(A):r("escape")?o(A):r("arrowup")?(T.focus(),vA(A)):r("arrowright")?(N.focus(),vA(A)):r(/^arrow(down|left)$/)?G(A):void 0}),$A(RA,N,function(A){return r=A.TE.key,r(/^(enter|escape)$/)?o(A):r("arrowup")?(T.focus(),vA(A)):r(/^arrow(right|down)$/)?G(A):r("arrowleft")?(L.focus(),vA(A)):void 0}),$A(FA,L,l),$A(FA,N,o),sE.modal(S,aO(A,T,[L,N]),I),C(),t},sE.drop=function(){sE.exit(0,0,0);var A=arguments,E=A[0],O=A[1];return 1===A.length&&(E="default",O=A[0]),y=xA(E),eE(vE),GE(B,zA(vE,!1,{"class":cE+"-drop "+y})),s(O)?O(vE):zA(vE,O),sE.drop.fit(),$A(FA,N,sO),$A(iA,L,sO),dA("enter.drop."+E,[t]),dA("enter.drop",[t]),t},sE.drop.fit=function(E){return p=XA(U),Y=XA(vE),y=p.w/2-Y.w/2,q=p.h/2-Y.h/2,!M(E)&&xE&&(A=_A(xE),y=A.l,q=A.t+XA(xE).h),H(E)?(M(E[0])&&(y=E[0]),M(E[1])&&(q=E[1])):(y=r(y,0,Math.max(p.w,L.innerWidth)-Y.w),q=r(q,0,Math.max(p.h,L.innerHeight)-Y.h)),F(vE,{left:y+uA,top:q+uA,visibility:"visible"}),dA("fit.drop",[t]),dA("fit",[t]),t},sE.menu=function(A,E,O,e){E=!H(E)&&O[E]&&O[E].text||E;var N,R='<span class="'+cE+'-current menu">%1</span>',I="",L=0;return E===!1?sE.tool(A,E):(H(E)&&(I=E[0],I="<"===I[0]?I:'<i class="'+yA(HE,[I])+'"></i>',E=M(E[1])?E[1]:0,E=E&&O[E]&&O[E].text||E,R=I+(0!==E?" "+R:"")),sE.tool(A,{i:I,text:E?yA(R,[E,I]):0,click:function(T){return sE.drop("menu menu-"+xA(A),function(T){function S(A){return N=this,x=O[bA(N,MA)],x=f(x)?sE.tools[x]:x||{},Q=OE(N),!XE(x)&&s(e=x.click)&&(e=e(A,t),E!==!1&&xE&&(Z=IE(xE)[0]||xE,tE(Z,"i")||EE(Z,yA(R,[Q,I])),H(x.text)&&(q=IE(Z)[0])&&tE(q,"i")&&(jA(q),ZA(q,yA(HE,[x.text[0]])))),e===!1)?vA(A):(t.select(),vA(A))}function F(A){if(N=this,(w=A.TE.key)("escape"))return sE.exit(1),vA(A);if(w("arrowdown")&&(y=LE(N))){for(;!tE(y,"a")&&y;)y=LE(y);return y&&y.focus(),vA(A)}if(w("arrowup")&&(y=NE(N))){for(;!tE(y,"a")&&y;)y=NE(y);return y&&y.focus(),vA(A)}}for(e in O)if(N=O[e],AA="%"===e[0],N=f(N)&&!AA?sE.tools[N]:N){N=ZE(N,e,sE.tools);var r={href:AA?null:UA,"class":cE+"-"+(AA?"label":"button")};AA?k=UE[A]&&UE[A][+e.slice(1)-1]||e:(r.data={},r.data[MA]=e,k=fE[e]||e),J=N.text,J=H(J)?J[1]||"":J,k=H(k)?k[0]:k,Z=zA(AA?"span":"a",AA?"<span>"+(k||"%"+L)+"</span>":N.text||k,n(r,N.attributes||{})),!Z.title&&(q=N.title)&&(Z.title=H(q)?q[0]+(q[1]?" ("+q[1]+")":""):q),AA?pA(Z,{id:cE+"-label:"+L}):(XE(N)&&ZA(Z,"x"),$A(FA,Z,S),$A(RA,Z,F)),O[e]=N,GE(T,Z),++L}G(function(){SE("a",T)[0].focus()},1)}),!1}},e),sE.tools[A].data=O,t)},sE.bubble=function(){sE.exit(0,0,0);var A=arguments,E=A[0],O=A[1];return 1===A.length&&(E="default",O=A[0]),y=xA(E),eE($E),GE(B,zA($E,!1,{"class":cE+"-bubble "+y})),s(O)?O($E):zA($E,O),sE.bubble.fit(),dA("enter.bubble."+E,[t]),dA("enter.bubble",[t]),t},sE.bubble.fit=function(E){Z=t.$(1),A=_A(YE),$=F(YE,"line-height");var O="border-",e="-width";y=Z.caret[0].x+A.l-YE.scrollLeft,q=Z.caret[1].y+A.t+$-YE.scrollTop,Y=F(KE,[O+"top"+e,O+"bottom"+e,O+"left"+e,O+"right"+e]);var R=XA(KE),I=XA($E),L=Y[0]+Y[1],N=Y[2]+Y[3];return H(E)?(M(E[0])&&(y=E[0]),M(E[1])&&(q=E[1])):(y=r(y,A.l,A.l+R.w-I.w-N),q=r(q,A.t,A.t+R.h-I.h-L)),F($E,{left:y+uA,top:q+uA,visibility:"visible"}),dA("fit.bubble",[t]),dA("fit",[t]),t},sE.overlay.exit=function(A){return sE.exit(A,"overlay")},sE.modal.exit=function(A){return sE.exit(A,"modal")},sE.drop.exit=function(A){return sE.exit(A,"drop")},sE.bubble.exit=function(A){return sE.exit(A,"bubble")},sE.tool=function(A,E,O){return k="","|"!==A&&(d.tools=d.tools.filter(function(E,O){return E===A?(k=O,!1):!0})),E===!1?delete sE.tools[A]:("|"===A?(O=E,E={}):(s(E)&&(E={click:E}),sE.tools[A]=n(sE.tools[A]||{},E),M(O)||""===k||(O=k)),D(O)?d.tools.splice(O,0,A):d.tools.push(A)),qE(),t},sE.key=function(A,E){return d.keys?(E===!1?delete sE.keys[A]:sE.keys[A]=E,jE(),t):t},sE.tools={"|":{},undo:{i:"undo",click:function(A,E){return E.undo(),!1}},redo:{i:"repeat",click:function(A,E){return E.redo(),!1}},indent:function(A,E){return E.indent(oA),!1},outdent:function(A,E){return E.outdent(oA),!1}},$A(FA,wE,HO),sE.keys={"control+y":"redo","control+z":"undo",f5:function(A,E){return HO(A)},"shift+tab":aA?"outdent":0,tab:aA?"indent":0,escape:function(A,E){return wE.focus(),!1}},sE.el={container:PE,header:WE,body:KE,footer:dE,overlay:bE,modal:gE,drop:vE,bubble:$E},t.config=d,n(t._,{time:function(){var A=new Date,E=A.getFullYear(),O=A.getMonth()+1,e=A.getDate(),R=A.getHours(),I=A.getMinutes(),L=A.getSeconds(),N=A.getMilliseconds();return 10>O&&(O="0"+O),10>e&&(e="0"+e),10>R&&(R="0"+R),10>I&&(I="0"+I),10>L&&(L="0"+L),10>N&&(N="0"+N),[""+E,""+O,""+e,""+R,""+I,""+L,""+N]},replace:wA,format:yA,dom:{set:GE,reset:lE,get:SE,id:AE,copy:function(A,E){return A.cloneNode(M(E)?E:!0)},classes:{set:ZA,reset:jA,get:qA},attributes:{set:pA,reset:hA,get:YA},data:{set:mA,reset:gA,get:bA},is:tE,offset:_A,point:QA,size:XA,content:{set:EE,reset:eE,get:OE},closest:JA,parent:RE,children:IE,next:LE,previous:NE,before:FE,after:rE,prepend:CE,append:iE},el:zA,event:{set:$A,reset:VA,fire:kA,x:vA},hooks:W,hook:{set:WA,reset:KA,fire:dA}}),sE};