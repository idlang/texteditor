/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.3.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function ee(e,t,n){return x(e)?x(t)?(x($[e])||($[e]={}),x(n)||(n=Object.keys($[e]).length),$[e][n]=t,u):$[e]:$}function te(e,t){return x(e)?x(t)&&x($[e])?(delete $[e][t],u):($[e]={},u):($={},u)}function ne(e,t,n){if(!x($[e]))return $[e]={},u;if(x(n))x($[e][n])&&$[e][n].apply(u,t);else for(var r in $[e])$[e][r].apply(u,t);return u}function re(e,t,n){if(b(t))for(var r in t)re(e,r,t[r]);else e.setAttribute(t,n)}function ie(e,t){e.removeAttribute(t)}function oe(e){return e&&e.preventDefault(),!1}function se(e,t,n){return t?(t.addEventListener(e,n,!1),ee("on:"+e,n,Xe(t)),u):void 0}function ae(e,t,n){return t?(t.removeEventListener(e,n,!1),te("on:"+e,Xe(t)),t.id.split(":")[0]===xe+"-dom"&&ie(t,"id"),u):void 0}function ue(e,t,n){if("createEvent"in a){var r=a.createEvent("HTMLEvents");r.data=n,r.initEvent(e,!0,!1),t.dispatchEvent(r)}else ne("on:"+e,n,Xe(t));return u}function le(e,t,n){e=m(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)se(e[r],t,n);return u}function ce(e,t,n){e=m(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)ae(e[r],t,n);return u}function fe(e,t,n){e=m(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)ue(e[r],t,n);return u}function ge(e,t){return setTimeout(e,t)}function de(e){return clearTimeout(e)}function pe(e,t,n){for(var o,r=0,i=t.length;i>r;++r)o=t[r],e=e.replace(E(o)?o:p(c(o),"g"),n&&n[r]||"");return e}function me(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,x(t[n])?t[n]:e})}function he(e){return m(pe(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function _e(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=ve(e);return{x:n-i.l,y:r-i.t}}function ve(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{l:t,t:n}}function ye(e){return{w:e.offsetWidth,h:e.offsetHeight}}function be(e,t){for(;(e=et(e))&&e!==t;);return e}function Ge(e,t,n){if(e=w(e)?a.createElement(e):e,b(n)){var r,i;for(i in n)r=n[i],"style"===i?w(r)?re(e,i,r):null===r?ie(e,i):e=g(e,r):v(r)?e[i]=r:null===r?ie(e,i):re(e,i,b(r)?r.join(" "):""+r)}if(_(t))lt(e,t);else if(b(t)){var r,i;for(i in t)r=t[i],_(r)?lt(e,r):r!==!1&&Je(e,r)}else x(t)&&t!==!1&&Je(e,t);return e}function Xe(e){var t=e.id;return t||(t=xe+"-dom:"+(new Date).getTime(),e.id=t),t}function Ve(e,t){return p("(^|\\s)"+t+"(\\s|$)").test(e.className)}function Ze(e,t){Ve(e,t)||(e.className=m(e.className+" "+t))}function qe(e,t){e.className=m(e.className.replace(p("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function Je(e,t){return x(t)?void(e.innerHTML=t):e.innerHTML}function Qe(e,t){if(t!==!1){var r,n=e.children;for(r in n)Qe(n[r])}Je(e,"")}function et(e){return e.parentElement||e.parentNode}function tt(e){return e.children||[]}function nt(e){return e.nextElementSibling||e.nextSibling}function it(e,t){var n=et(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ot(e,t){et(e).insertBefore(t,e)}function st(e,t){et(e).insertBefore(t,nt(e))}function lt(e,t){e.appendChild(t)}function ct(e,t){var n=it(e);if(n){if(t!==!1)for(var r=tt(e)[0];r;)ct(r);n.removeChild(e)}}function ft(e){Qe(Ge(e,!1,{style:""})),ct(e)}function gt(e,t,n){return Ge(t||"div",n,{"class":e})}function dt(){if(Te._word&&Te._words){var e=(Be.value||"").replace(p(Z[0]+"[^"+Z[0]+Z[1]+"]+?"+Z[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;Je(He,me(Te["_word"+(1===t?"":"s")],[t]))}}function pt(e,t){v(e)&&(e.click=e),w(e.click)&&(e.click=(Ee.tools[e.click]||{}).click),x(e.active)||(e.active=1),x(e.title)||(e.title=ke[t]||"")}function mt(){Qe(Oe,!1);var r,i,o,s,a,l,c,e=w(j.tools)?m(j.tools).split(/\s+/):j.tools,t=xe+"-button",n=xe+"-separator";j.tools=e;for(a in e)c=e[a],i=Ee.tools[c],i&&(pt(i,c),"|"!==(o=i.i||c)&&(o=he(o)),s="|"!==o,Ue=gt(s?t:n,s?"a":"span"),s&&(r=t+":"+he(c).replace(/\s/g,""),re(Ue,{href:"",id:r,"tab-index":-1}),re(Ue,J,c),o='<i class="'+me(we.i,[o])+" "+r+'"></i>',i.active||Ze(Ue,"x"),i.text&&(o=me('<span class="'+xe+'-text">'+i.text+"</span>",[o]),Ze(Ue,"text")),Je(Ue,o),Ge(Ue,!1,i.attributes||{}),!Ue.title&&(l=i.title)&&(Ue.title=b(l)?l[0]+(l[1]?" ("+l[1]+")":""):l),le(z,Ue,xt)),lt(Oe,Ue));ne("update.tools",[u])}function ht(){Ee.keys=function(){var n,r,e=Object.keys(Ee.keys).sort().reverse(),t={};for(n=0,r=e.length;r>n;++n)t[e[n]]=Ee.keys[e[n]];return t}(),Et(1),ne("update.keys",[u])}function _t(e){dt(),ne("on:change",[e,u])}function bt(e){function b(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var g,d,m,h,_,y,t=u.$(),n=t.before,r=t.after,i=n.slice(-1),o=r[0],s=t.length,a=Ee.keys,l=TE.keys_alias,f=(n.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),v=e.TE.key();vt[v]=1,y=Object.keys(vt).length,ge(function(){u.record()},1);for(g in a){var E=0;m=b(g);for(d in m)d=m[d],vt[l[d]||d]&&++E;if(m=m.length,E===m&&y===m&&(w(a[g])&&(a[g]=Ee.tools[a[g]].click),h=a[g]&&a[g](e,u),h===!1))return oe(e)}if(G)for(g in G)if(_=G[g],_!==!1){if(v===_&&o===_)return"\\"===i?(u.insert(v,0),oe(e)):(u.select(t.end+1),oe(e));if(g===v)return u.wrap(g,_),oe(e);if(i===g&&o===_){if("backspace"===v&&n.slice(-2)!=="\\"+g)return u.unwrap(g,_),oe(e);if(Y&&"enter"===v&&g!==_)return u.tidy("\n"+f+U,"\n"+f).scroll(!0),oe(e)}}if(Y&&!s){if("backspace"===v&&p(c(U)+"$").test(n))return u.outdent(U).scroll(!0),oe(e);if("enter"===v&&p("(^|\\n)("+c(U)+")+.*$").test(n))return u.insert("\n"+f,0,1).scroll(!0),oe(e)}}function Et(e){b(e)?delete vt[e.TE.key()]:vt={}}function wt(e){/^focus|blur$/.test(e.type)&&Et(1),de(yt),yt=ge(function(){_t(e)},j.debounce||0)}function xt(e){Ee.exit(0,0,0);var i,t=this.getAttribute(J),n=Ee.tools,r=n[t];return We=e.currentTarget||e.target,r&&r.active&&r.click&&(i=n[t].click(e,u,t),ne("on:change",[e,u,t]),i===!1)?oe(e):(u.select(),oe(e))}function Bt(e){return kt=Ne,Ot=ye(Se),oe(e)}function Nt(e){kt===Ne&&g(Be,{height:_e(Ce,e).y-Ot.h+Q})}function Lt(){kt=0}function It(){Ee.exit(1)}function Rt(){e=ye(Re),$t=e.w,At=e.h,e=ye(Ie),jt=e.w,Ct=e.h}function zt(e,t){t&&ne("exit.modal."+t,[u]),fe(z,Ie,[e])}function Dt(t){kt=t.target,e=_e(Re,t),Ft=e.x,Tt=e.y,Rt()}function Pt(t){var i,o,n=St.header,r=St.resize;kt===n||be(kt,n)===n?(e=_e(Ce,t),i=e.x-Ft,o=e.y-Tt,g(Re,{left:($t>jt?i:d(i,0,jt-$t))+Q,top:(At>Ct?o:d(o,0,Ct-At))+Q})):kt===r&&(e=_e(Re,t),Ot=ye(r),g(Re,{width:e.x+Ot.w/4+Q,height:e.y+Ot.h/4+Q}))}function Ht(){kt=0}function Mt(e,t,n){return{header:e,body:t,footer:n}}function Kt(e){var t=We,r=e&&e.target||0;(!r||r!==t&&be(r,t)!==t)&&(We=0,ft(ze),ce(z,T,Kt),Ee.exit(1))}function Ut(e){function a(){i&&(o=ye(i),g(r,{width:o.w+Q,height:o.h+Q}))}var r,i,o,t=u.get(),n="";return-1===t.indexOf("</html>")&&(n='<!DOCTYPE html><html dir="'+j.dir+'"><head><meta charset="utf-8"><style>'+j.css+"</style></head><body>"+t+"</body></html>"),r=Ge("iframe",!1,{"class":xe+"-portal",src:"data:text/html,"+encodeURIComponent(n)}),!it(Ie)&&t?Ee.overlay(r,1,function(){i=tt(Ie)[0],a(),le(M,s,a),ne("enter.overlay.preview",[e,u,[t,n],i])}):(ce(M,s,a),It()),oe(e)}var t="⌘",n="…",i="⇥",o="⇧",s=window,a=document,u=this,l=u._,c=l.x,f=l.extend,g=l.css,d=l.edge,p=l.pattern,m=l.trim,h=u.is,_=h.e,v=h.f,y=h.i,b=h.o,E=h.r,w=h.s,x=function(e){return!h.x(e)},k=a.documentElement,T=(a.head,a.body),$={},A=function(){},j=f({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),C="keydown",S="keyup",O="copy",B="cut",N="paste",L="touchstart mousedown",I="touchend mouseup",R="touchmove mousemove",z="click",D="focus",P="blur",H="input",M="orientationchange resize",K=P+" "+O+" "+B+" "+D+" "+H+" "+C+" "+N,W=j.languages,U=j.tab,Y=j.auto_tab,G=j.auto_close,X=j.unit[0][0],Z=(j.unit[0][1],j.unit[1][0]),q=j.unit[1][1],J="data-tool-id",Q="px",Ee=u.ui={};u.tidy=function(e,t){var n=u.$(),r=m(n.before)?e:"",i=m(n.after)?x(t)?t:e:"";return u.trim(r,i)},u.i=function(){return m(u.replace(/\s+/g," "))},u.format=function(e,t,n,r){b(e)||(e=[e]),x(n)||(n=" "),x(r)||(r="");var i=u[0]().$(),o=(e[0]?X[0]+e[0]+X[1]:"")+r,s=r+(e[0]?X[0]+X[2]+(e[1]||e[0].split(p("("+q[3]+")+"))[0])+X[1]:""),a=c(o),l=c(s),f=p("^"+a+"([\\s\\S]*?)"+l+"$"),g=p(a+"$"),d=p("^"+l),m=i.before,h=i.after;return i.length?n=!1:u.insert(W.placeholders[""]),u.toggle(t?!f.test(i.value):!g.test(m)&&!d.test(h),[function(e){e.unwrap(o,s,1).tidy(p(Z[0]+"[^"+Z[0]+Z[1]+Z[2]+"]+?"+Z[1]+"$").test(m)?"":n,p("^"+Z[0]+Z[2]+"[^"+Z[0]+Z[1]+"]+?"+Z[1]).test(h)?"":n).wrap(o,s,t)[1]()},function(e){e.unwrap(o,s,t)[1]()}])};var Ue,we=j.classes,xe=we[""],ke=W.tools,Fe=W.buttons,Te=W.others,$e=xe+"-textarea "+xe+"-content block",Ae=gt(xe),je=gt(xe+"-header"),Ce=gt(xe+"-body"),Se=gt(xe+"-footer"),Oe=gt(xe+"-tool"),Be=Ge(u.target,!1,j.attributes),Ne=gt(xe+"-resize s"),Le=gt(xe+"-description"),Ie=gt(xe+"-overlay"),Re=Ge("div"),ze=Ge("div"),De=Ge("div"),Pe=gt("left","span"),He=gt("right","span"),Me=gt(xe+"-preview","a"),Ke=0,We=0;j.suffix||(j.suffix=X[1]);var vt={},yt=null;u.create=function(e,t){b(e)&&(j=f(j,e));var n=it(Be);if(Ze(Be,$e),n&&"P"===n.nodeName?(ot(n,Ae),Ke=n,ct(n,!1)):ot(Be,Ae),Ae.dir=j.dir,lt(Ae,je),lt(Ae,Ce),lt(Ae,Se),lt(Ae,Ne),lt(Ce,Be),j.tools&&(lt(je,Oe),lt(Se,Le),lt(Le,Pe),lt(Le,He)),le(C,Be,bt),le(S,Be,Et),le(K,Be,wt),le(L,Ne,Bt),le(R,T,Nt),le(I,T,Lt),Te.preview){var r=ke.preview;re(Me,{href:"",title:b(r)?r[0]+(r[1]?" ("+r[1]+")":""):r}),lt(Pe,Me),Je(Me,Te.preview)}return _t(null),mt(),ht(),0!==t?ne("create",[u]):u},u.update=function(e,t){return Ve(Be,$e)&&u.destroy(0),(0!==t?ne("update",[u]):u).create(e,0)},u.destroy=function(e){return Ve(Be,$e)?(Ee.exit(0,0,0),qe(Be,$e),b(j.tools)&&(j.tools=j.tools.join(" ")),j.keys&&(ce(C,Be,bt),ce(S,Be,Et)),ce(L,Ne,Bt),ce(R,T,Nt),ce(I,T,Lt),ce(K,Be,wt),Ke?(ot(Ae,Ke),lt(Ke,Be),Ke=0):ot(Ae,Be),ft(Ae),0!==e?ne("destroy",[u]):u):u};var e,Ot,kt=0,Ft=0,Tt=0,$t=0,At=0,jt=0,Ct=0,St={};Ee.exit=function(e,t,n){var i,r={overlay:function(){ce(z,Ie,It),ft(Ie)},modal:function(){ce(L,Ce,Dt),ce(R,Ce,Pt),ce(I,T,Ht),ce(z,St.x,zt),ft(Re)},drop:function(){ft(ze)},bubble:function(){ft(De)}};if(t)if(b(t))for(i in t)i=t[i],r[i]&&r[i](),0!==n&&ne("exit."+i,[u]);else r[t]&&r[t](),0!==n&&ne("exit."+i,[u]);else for(i in r)r[i]();return e&&u.select(),0!==n&&ne("exit",[u]),u},Ee.overlay=function(e,t,n){return Ee.exit(0,0,0).blur(),Et(1),lt(Ce,Ge(Ie,e.length||_(e)?gt(xe+"-overlay-content","div",e):"")),t&&le(z,Ie,It),v(n)?n(Ie):Ge(Ie,n),ne("enter.overlay",[u]),ne("enter",[u]),u},Ee.modal=function(){Ee.overlay("",1);var o,a,e=arguments,t=e[0],n=e[1],r=e[2],i=xe+"-modal";b(t)&&(t="default",n=e[0],r=e[1]),a=he(t),Ge(Re,!1,{"class":i+" "+a}),x(n.body)&&(n.body=Ge("div",n.body,{"class":i+"-content "+a}));for(o in n)i[1]=o,St[o]=gt(i+"-"+me(o,i)+" "+a,0,n[o]);return St.x=gt(xe+"-x "+a),St.resize=gt(xe+"-resize se "+a),Qe(Re),lt(Ce,Ge(Re,St,{style:""})),Ee.modal.fit(),st(Re,Ie),le(z,St.x,zt),le(L,St.header,oe),le(L,St.resize,oe),le(L,Ce,Dt),le(R,Ce,Pt),le(I,T,Ht),v(r)&&(St.overlay=Ie,St.modal=Re,r(St)),ne("enter.modal."+t,[u]),ne("enter.modal",[u]),ne("enter",[u]),u},Ee.modal.fit=function(e){Rt();var t=Ct/2-At/2,n=jt/2-$t/2;return b(e)?(n=e[0],t=e[1]):(n=d(n,0),t=d(t,0)),g(Re,{left:n+Q,top:t+Q,"min-width":$t+Q,"min-height":At+Q,visibility:"visible"}),ne("fit.modal",[u]),ne("fit",[u]),u};var Wt={"class":xe+"-button",name:"y"};return Ee.alert=function(e,t,n,r){var i=Ge("button",Fe.okay,Wt),o="alert";return n=n||A,b(e)&&(o+=":"+e[0],e=e[1]||e[0]),le(z,i,function(e){return n(e,u),zt(e,o+".y"),oe(e)}),le(C,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?fe(z,i,[e,u]):void 0}),Ee.modal(o,Mt(e,t,i),r),i.focus(),u},Ee.confirm=function(e,t,n,r,i){function c(e){return v(n)&&n(e,u),zt(e,a+".y"),oe(e)}function f(e){return v(r)&&r(e,u),zt(e,a+".n"),oe(e)}var l,o=Ge("button",Fe.okay,Wt),s=Ge("button",Fe.cancel,Wt),a="confirm";return s.name="n",b(e)&&(a+=":"+e[0],e=e[1]||e[0]),le(z,o,c),le(z,s,f),le(C,o,function(e){return l=e.TE.key,l("arrowright")?(s.focus(),oe(e)):l("arrowleft")?oe(e):l("enter")?(c(e),oe(e)):l("escape")?(zt(e,a+".y"),oe(e)):void 0}),le(C,s,function(e){return l=e.TE.key,l("arrowright")?oe(e):l("arrowleft")?(o.focus(),oe(e)):l("enter")?(f(e),oe(e)):l("escape")?(zt(e,a+".n"),oe(e)):void 0}),Ee.modal(a,Mt(e,t,[o,s]),i),s.focus(),u},Ee.prompt=function(e,t,n,r,i,o){function h(){l.focus(),"placeholder"in l&&l.select()}function _(e){return oe(e)}function y(e){return p=l.value,!n||m(p)&&p!==t?(zt(e,c+".y"),oe(e),r(e,u,p!==t?p:"",t)):(h(),_(e))}function E(e){return zt(e,c+".n"),oe(e)}var g,d,p,s=Ge("button",Fe.okay,Wt),a=Ge("button",Fe.cancel,Wt),l=Ge("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":xe+"-input block"}),c="prompt",f=[];if(b(e)&&(c+=":"+e[0],e=e[1]||e[0]),v(i)&&(o=i,i=0),1===i)l=Ge("textarea",t,{placeholder:t.split("\n")[0],"class":xe+"-textarea block"});else if(2===i){for(d in t)f.push(Ge("option",t[d],{value:d,selected:d===n||null}));l=Ge("select",f,{"class":xe+"-select block"})}return r=r||A,l.name="data",a.name="n",le(C,l,function(e){return g=e.TE.key,g("enter")?y(e):g("escape")||g("backspace")&&!this.value?E(e):g("arrowup")?_(e):g("arrowdown")?(s.focus(),oe(e)):void 0}),le(C,s,function(e){return g=e.TE.key,g("enter")?y(e):g("escape")?E(e):g("arrowup")?(l.focus(),oe(e)):g("arrowright")?(a.focus(),oe(e)):g(/^arrow(down|left)$/)?_(e):void 0}),le(C,a,function(e){return g=e.TE.key,g(/^enter|escape$/)?E(e):g("arrowup")?(l.focus(),oe(e)):g(/^arrow(right|down)$/)?_(e):g("arrowleft")?(s.focus(),oe(e)):void 0}),le(z,s,y),le(z,a,E),Ee.modal(c,Mt(e,l,[s,a]),o),h(),u},Ee.drop=function(){Ee.exit(0,0,0);var r,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),r=he(t),Qe(ze),lt(T,Ge(ze,!1,{"class":xe+"-drop "+r})),v(n)?n(ze):Ge(ze,n),Ee.drop.fit(),le(z,T,Kt),ne("enter.drop."+t,[u]),ne("enter.drop",[u]),u},Ee.drop.fit=function(e){var o,t=ye(k),n=ye(ze),r=t.w/2-n.w/2,i=t.h/2-n.h/2;return!x(e)&&We&&(o=ve(We),r=o.l,i=o.t+ye(We).h),b(e)?(r=e[0],i=e[1]):(r=d(r,0,t.w-n.w),i=d(i,0,t.h-n.h)),g(ze,{left:r+Q,top:i+Q,visibility:"visible"}),ne("fit.drop",[u]),ne("fit",[u]),u},Ee.menu=function(e,t,n,r){var i='<span class="'+xe+'-current menu">%1</span>',o="";return t===!1?Ee.tool(e,t):(b(t)&&(o=t[0],t=t[1],i='<i class="'+me(we.i,[o])+'"></i> '+i),Ee.tool(e,{i:o,text:me(i,[n[t]&&n[t].text||t,o]),click:function(t){var s,a,l,c,g,d,p,r={href:"","class":xe+"-button"};return Ee.drop("menu menu-"+he(e),function(e){function t(e){return c=this,p=n[c.getAttribute(J)],s=Je(c),p&&p.active&&v(d=p.click)&&(d=d(e,u),We&&Je(tt(We)[0]||We,me(i,[s,o])),d===!1)?oe(e):(u.select(),oe(e))}for(l in n)g=n[l],g=w(g)?Ee.tools[g]:g,g&&(pt(g,l),r[J]=l,a=Ge("a",g.text||l,f(r,g.attributes||{})),!a.title&&(d=g.title)&&(a.title=b(d)?d[0]+(d[1]?" ("+d[1]+")":""):d),g.active||Ze(a,"x"),n[l]=g,le(z,a,t),lt(e,a))}),!1}},r),ne("update.menus",[u]),u)},Ee.menu.fit=function(e){return Ee.drop.fit(e)},Ee.bubble=function(){Ee.exit(0,0,0);var r,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),r=he(t),Qe(De),lt(T,Ge(De,!1,{"class":xe+"-bubble "+r})),v(n)?n(De):Ge(De,n),Ee.bubble.fit(),ne("enter.bubble."+t,[u]),ne("enter.bubble",[u]),u},Ee.bubble.fit=function(e){var t=u.$(1),n=ve(Be),r=g(Be,"line-height"),i="border-",o="-width",s=t.caret[0].x+n.l-Be.scrollLeft,a=t.caret[1].y+n.t+r-Be.scrollTop,l=g(Ce,[i+"top"+o,i+"bottom"+o,i+"left"+o,i+"right"+o]),c=ye(Ce),f=ye(De),p=l[0]+l[1],m=l[2]+l[3];return b(e)?(s=e[0],a=e[1]):(s=d(s,n.l,n.l+c.w-f.w-m),a=d(a,n.t,n.t+c.h-f.h-p)),g(De,{left:s+Q,top:a+Q,visibility:"visible"}),ne("fit.bubble",[u]),ne("fit",[u]),u},Ee.tool=function(e,t,n){var r="";return"|"!==e&&(j.tools=j.tools.filter(function(t,n){return t===e?(r=n,!1):!0})),t===!1?delete Ee.tools[e]:("|"===e?(n=t,t={}):(v(t)&&(t={click:t}),Ee.tools[e]=f(Ee.tools[e]||{},t),x(n)||""===r||(n=r)),y(n)?j.tools.splice(n,0,e):j.tools.push(e)),mt(),u},Ee.key=function(e,t){return j.keys?(t===!1?delete Ee.keys[e]:Ee.keys[e]=t,ht(),u):u},Ee.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(U),!1},outdent:function(e,t){return t.outdent(U),!1}},le(z,Me,Ut),Ee.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Ut(e)},"shift+tab":Y?"outdent":0,tab:Y?"indent":0,escape:function(e,t){return Me.focus(),!1}},Ee.el={container:Ae,header:je,body:Ce,footer:Se,overlay:Ie,modal:Re,drop:ze,bubble:De},u.config=j,f(u._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),s=e.getSeconds(),a=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>s&&(s="0"+s),10>a&&(a="0"+a),[""+t,""+n,""+r,""+i,""+o,""+s,""+a]},replace:pe,format:me,el:Ge,event:{set:le,reset:ce,fire:fe,x:oe},hooks:$,hook:{set:ee,reset:te,fire:ne}}),Ee};