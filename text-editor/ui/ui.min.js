/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.7.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Oe(e){return O(e)?m(e).split(/\s+/):e}function Ce(e){return L(e)?e.join(" "):e}function Me(e,t){return-1!==e.indexOf(t)}function Se(e){return e.length}function De(e){return Object.keys(e)}function He(e){return Se(De(e))}function Ne(e,t,n){return _(e)?_(t)?(_(v[e])||(v[e]={}),_(n)||(n=He(v[e])),v[e][n]=t,l):v[e]:v}function Be(e,t){return _(e)?_(t)&&_(v[e])?(delete v[e][t],l):(v[e]={},l):(v={},l)}function Fe(e,t,n){if(!_(v[e]))return v[e]={},l;if(_(n))_(v[e][n])&&v[e][n].apply(l,t);else for(R in v[e])v[e][R].apply(l,t);return l}function Ae(e,t,n){if(L(t))for(R in t)Ae(e,R,t[R]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Ye(e,n,i){if(O(n))return Ye(e,[n],_(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=e.getAttribute(R))&&t.push(R);return Se(t)?t:_(i)?i:[]}function je(e,t){if(L(t))for(R in t)je(e,t[R]);else if(_(t))e.removeAttribute(t);else for(je(e,"class"),R=0,X=e.attributes,W=Se(X);W>R;++R)X[R]&&je(e,X[R].name)}function Ie(e,t,n){if(L(t))for(R in t)Ie(e,R,t[R]);else Ae(e,"data-"+t,n)}function qe(e,n,i){if(O(n))return qe(e,[n],_(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=Ye(e,"data-"+R))&&t.push(R);return Se(t)?t:_(i)?i:[]}function Re(e,t){if(L(t))for(R in t)je(e,"data-"+t[R]);else if(_(t))je(e,"data-"+t);else for(R=0,X=e.attributes,W=Se(X);W>R;++R)X[R]&&"data-"===X[R].name.slice(0,5)&&je(e,X[R].name)}function Xe(e){return e&&e.preventDefault(),!1}function We(e,t,n){if(t){for(e=Oe(e),R=0,X=Se(e);X>R;++R)t.addEventListener(e[R],n,!1),Ne("on:"+e[R],n,ft(t));return l}}function Ue(e,t,n){if(t){for(e=Oe(e),R=0,X=Se(e);X>R;++R)t.removeEventListener(e[R],n,!1),Be("on:"+e[R],ft(t));return w(t)&&t.id.split(":")[0]===_t+"-dom"&&je(t,"id"),l}}function Pe(e,t,n){e=Oe(e);var r,i="createEvent"in u;for(R=0,X=Se(e);X>R;++R)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[R],!0,!1),t.dispatchEvent(r)):Fe("on:"+e[R],n,ft(t));return l}function Ke(e,t,n){for(R=0,X=Se(t),W;X>R;++R)W=t[R],e=e.replace(z(W)?W:h(p(W),"g"),n&&n[R]||"");return e}function Ze(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,_(t[n])?t[n]:e})}function Qe(e){return m(Ke(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ge(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ve(e);return{x:n-r.l,y:i-r.t}}function Ve(e){for(U=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)U+=e.offsetLeft,J+=e.offsetTop;return{l:U,t:J}}function Je(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function et(e,t){for(;(e=at(e))&&e!==t;);return e}function tt(e,t){t=Oe(t);for(R in t)e.classList.add(t[R])}function nt(e,n,i){if(O(n))return nt(e,[n],_(i)?[i]:[""])[0];t=[];for(R in n)R=n[R],e.classList.contains(R)&&t.push(R);return Se(t)?t:_(i)?i:!1}function it(e,t){if(_(t)){t=Oe(t);for(R in t)e.classList.remove(t[R])}else je(e,"class")}function rt(e,t){t=Oe(t);for(R in t)e.classList.toggle(t[R])}function ot(e,t,n){if(e=O(e)?u.createElement(e):e,L(n))for(R in n)if(te=n[R],"classes"===R)tt(e,te);else if("data"===R)for(X in te)te=te[X],null===te?Re(e,X):Ie(e,X,te);else"css"===R?O(te)?Ae(e,"style",te):null===te?je(e,"style"):c(e,te):T(te)?e[R]=te:null===te?je(e,R):Ae(e,R,E(te)?te.join(" "):""+te);if(w(t))wt(e,t);else if(L(t))for(R in t)te=t[R],w(te)?wt(e,te):te!==!1&&st(e,te);else _(t)&&t!==!1&&st(e,t);return e}function ft(e){var t=e.id;return t||(t=_t+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function st(e,t){e.innerHTML=t}function ut(e,t){return e.innerHTML||(_(t)?t:"")}function lt(e,t){if(0!==t&&(F=ct(e)))for(R=0,X=Se(F);X>R;++R)lt(F[R]);st(e,"")}function at(e){return e&&e.parentNode}function ct(e){return e&&e.children||[]}function dt(e){return e&&e.nextSibling}function pt(e){return e&&e.previousSibling}function bt(e){for(R=0;e=pt(e);)++R;return R}function ht(e,t){return e&&O(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&T(t)?e===t(e):e===t}function yt(e,n){if(!(n=_(n)?n:u))return[];if(t=[],O(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(R=0,X=Se(e);X>R;++R)t.push(e[R]);return t}return[]}for(e=n.querySelectorAll(e),R=0,X=Se(e);X>R;++R)t.push(e[R]);return t}return gt(e)?[e]:[]}function gt(e,t){var n=at(e);return 1===Se(arguments)?n||!1:e&&n===e?n:!1}function mt(e,t){Z=at(e),Z&&Z.insertBefore(t,e)}function vt(e,t){Z=at(e),Z&&Z.insertBefore(t,dt(e))}function xt(e,t){F=ct(e)[0],F?mt(F,t):wt(e,t)}function kt(e,t){wt(e,t)}function wt(e,t){e.appendChild(t)}function Et(e,t){var n=gt(e);if(n){if(0!==t)for(F=ct(e)[0];F;)Et(F);n.removeChild(e)}}function Tt(e){lt(ot(e,!1,{style:""})),Et(e)}function $t(e,t,n){return ot(t||"div",n,{"class":e})}function Vt(e){return!e||_(e.active)&&!e.active}function Jt(e,t,n){return T(e)&&(e={click:e}),O(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Ot[t]||"",_(e.attributes)||(e.attributes={}),n[t]=e,e}function en(e){Lt.exit(0,0,0);var t=qe(this,"tool-id"),n=Lt.tools,i=n[t];return Lt.drop.target=e.currentTarget||e.target,!Vt(i)&&T(X=i.click)&&(X=X(e,l,t),Fe("on:change",[e,l,t]),X===!1)?Xe(e):(l.select(),Xe(e))}function tn(e){if(J=this,(W=e.TE.key)(/^(escape|f10)$/))Lt.exit(1);else if(W("enter")||W("arrowdown")&&qe(J,"ui-drop"))Lt.drop.target=J,Pe(se,J,[e]);else if(W("arrowright")&&(U=dt(J))){for(;!ht(U,"a")&&U;)U=dt(U);U&&U.focus()}else if(W("arrowleft")&&(U=pt(J))){for(;!ht(U,"a")&&U;)U=pt(U);U&&U.focus()}return Xe(e)}function nn(){lt(Yt,0);var r,o,f,s,u,a,c,e=Lt.tools,t=Oe(D.tools),n=_t+"-button",i=_t+"-separator";D.tools=t;for(a in t)c=t[a],o=e[c],(o||o==={})&&(o=Jt(o,c,e),f=o.i||c,"|"===f||Me(f,"<")||(f=Qe(f)),s="|"!==f,u=Qe(c).replace(/[\/\s]/g,"-"),Qt=$t(s?n+" "+n+"-"+u:i+" "+i+"-"+a,s?"a":"span"),s?(Qt=o.target||Qt,r=n+":"+u,Ae(Qt,{href:ze,id:r,tabindex:-1}),Ie(Qt,"tool-id",c),f=Me(f,"<")?f:Lt.i(u,f),Vt(o)?tt(Qt,"x"):it(Qt,"x"),o.on?tt(Qt,"on"):it(Qt,"on"),o.text&&(f=Ze('<span class="'+_t+'-text">'+o.text+"</span>",[f]),tt(Qt,"text")),st(Qt,f),ot(Qt,!1,o.attributes),!o.attributes.title&&(X=o.title)&&(Qt.title=L(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),We(se,Qt,en),We(de,Qt,tn)):Qt.id=i+":"+a,o.target=Qt,wt(Yt,Qt));Fe("update.tools",[l])}function rn(){Lt.keys=function(){var n,e=De(Lt.keys).sort().reverse(),t={};for(R=0,X=Se(e);X>R;++R)n=e[R],t[n]=Lt.keys[n];return t}(),fn(),Fe("update.keys",[l])}function on(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,u=Lt.keys,a=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();K=e.TE.key(),H[K]=1,t=He(H),g(function(){l.record()});for(R in u){W=d(R),F=0;for(X in W)X=W[X],H[a[X]||X]&&++F;if(W=Se(W),F===W&&t===W&&(O(u[R])&&(u[R]=Lt.tools[u[R]].click),U=T(u[R])&&u[R](e,l),U===!1))return Xe(e)}if(ve)for(R in ve)if(P=ve[R],P!==!1){if(K===P&&f===P)return"\\"===o?(l.insert(K,0),Xe(e)):(l.select(n.end+1),Xe(e));if(R===K)return l.wrap(R,P),Xe(e);if(o===R&&f===P){if("backspace"===K&&i.slice(-2)!=="\\"+R)return l.unwrap(R,P),Xe(e);if(xe&&"enter"===K&&R!==P&&!s)return l.tidy("\n"+c+we,"\n"+c).scroll(1),Xe(e)}}if(xe&&!s){if("backspace"===K&&h(p(we)+"$").test(i))return l.outdent(we),Xe(e);if("enter"===K&&h("(^|\\n)("+p(we)+")+.*$").test(i))return l.insert("\n"+c,0,1).scroll(1),Xe(e)}}function fn(e){e&&e.TE&&e.TE.key?delete H[e.TE.key()]:H={}}function cn(e){return sn=Dt,V=Je(At),Xe(e)}function dn(e){sn===Dt&&c(jt,{height:Ge(Ft,e).y-V.h+_e})}function pn(){sn=0}function bn(){Lt.exit(1)}function hn(){t=Je(Xt),ne=t.w,q=t.h,t=Je(Rt),un=t.w,ln=t.h}function yn(e,t){return t&&Fe("exit.modal."+t,[l]),Pe(se,Rt,[e]),Xe(e)}function gn(e){sn=e.target,t=Ge(Xt,e),ie=t.x,re=t.y,hn()}function mn(e){var n=an.header,i=an.sizer;sn===n||et(sn,n)===n?(t=Ge(Ft,e),U=t.x-ie,J=t.y-re,c(Xt,{left:(ne>un?U:d(U,0,un-ne))+_e,top:(q>ln?J:d(J,0,ln-q))+_e})):sn===i&&(t=Ge(Xt,e),V=Je(i),c(Xt,{width:t.x+V.w/4+_e,height:t.y+V.h/4+_e}))}function vn(){sn=0}function xn(e,t,n){return{header:e,body:t,footer:n}}function kn(e){N=Lt.drop.target,B=Wt,F=e&&e.target||0,(!F||F!==N&&et(F,N)!==N)&&(Lt.drop.target=0,Ue(se,u,kn),Ue(me,s,kn),Lt.exit(e.target===jt))}var N,B,F,j,q,R,X,W,U,P,K,t,Z,G,V,J,te,ne,ie,re,n="⌘",i="…",o="⇥",f="⇧",s=window,u=document,l=new TE(e),a=l._,c=a.css,d=a.edge,p=a.x,b=a.extend,h=a.pattern,g=(a.timer.reset,a.timer.set),m=a.trim,v={},x=function(){},k=TE.is,w=k.e,E=k.a,T=k.f,$=k.i,L=k.o,z=k.r,_=function(e){return!k.x(e)},O=k.s,C=u.documentElement,S=(u.head,u.body),D=b({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},t),H={},fe="blur",se="click",de="keydown",pe="keyup",be="touchstart mousedown",he="touchmove mousemove",ye="touchend mouseup",me="orientationchange resize",ve=D.auto_close,xe=D.auto_tab,ke=D.languages,we=D.tab,Te=(D.unit[0][1],D.unit[0][0]),$e=D.unit[1][1],Le=D.unit[1][0],ze="javascript:;",_e="px",Lt=l.ui={};l.tidy=function(e,t){var n=l.$(),i=m(n.before)?e:"",r=m(n.after)?_(t)?t:e:"";return l.trim(i,r)},l.i=function(){return m(l.replace(/\s+/g," "))},l.format=function(e,t,n,i){L(e)||(e=[e]),_(n)||(n=" "),_(i)||(i="");var r=l.h,o=l[0]().$(),f=e[0].split(h("("+$e[3]+")+"))[0],s=(e[0]?Te[0]+e[0]+Te[1]:"")+i,u=i+(e[0]?Te[0]+Te[2]+(e[1]||f)+Te[1]:""),a=p(e[0]?Te[0]+f+Te[1]:""),c=p(u),d=h("^"+a+"([\\s\\S]*?)"+c+"$"),b=h(a+"$"),y=h("^"+c),g=o.before,m=o.after;return o.length?n=!1:l.insert(ke.placeholders[""]),l.toggle(t?!d.test(o.value):!b.test(g)&&!y.test(m),[function(e){e.unwrap(s,u,1).tidy(h(Le[0]+"[^"+Le[0]+Le[1]+Le[2]+"]+?"+Le[1]+"$").test(g)?"":n,h("^"+Le[0]+Le[2]+"[^"+Le[0]+Le[1]+"]+?"+Le[1]).test(m)?"":n).wrap(s,u,t)},function(e){e.unwrap(s,u,t)}])[r]()};var Qt,zt=D.classes,_t=zt[""],Ot=ke.tools,Ct=ke.buttons,Mt=ke.labels,St=_t+"-textarea "+_t+"-content block",Dt=$t(_t+"-sizer s"),Ht=$t(_t+"-sizer se"),Nt=$t(_t),Bt=$t(_t+"-header"),Ft=$t(_t+"-body"),At=$t(_t+"-footer"),Yt=$t(_t+"-tool"),jt=ot(e,!1,D.attributes),It=$t(_t+"-description"),qt=ot("div"),Rt=ot("div"),Xt=ot("div"),Wt=ot("div"),Ut=ot("div"),Pt=$t("left","span"),Kt=$t("right","span"),Zt=0;Lt.i=function(e,t,n){return e=Qe(e).replace(/[\/\s]/g,"-"),V=Ze(zt.i,[e,t||e]),n?(it(n),tt(n,V),n):'<i class="'+V+'"></i>'},_(D.suffix)||(D.suffix=Te[1]);var sn=0,ie=0,re=0,ne=0,q=0,un=0,ln=0,an={};l.create=function(e,t){if(l.is.create)return l;l.is.create=!0,L(e)&&(D=b(D,e));var n=gt(jt);return tt(Nt,_t+"-is-can-update"),tt(Nt,_t+"-is-can-copy"),tt(jt,St),n&&ht(n,"p")?(mt(n,Nt),Zt=n,Et(n,!1)):mt(jt,Nt),Nt.dir=D.dir,wt(Nt,Bt),wt(Nt,Ft),wt(Nt,At),wt(Ft,jt),D.tools&&(wt(Bt,Yt),wt(At,It),wt(It,Pt),wt(It,Kt)),We(de,jt,on),We(pe+" "+fe,jt,fn),D.resize&&(wt(Nt,Dt),tt(Nt,_t+"-is-can-resize"),We(be,Dt,cn),We(he,u,dn),We(ye,S,pn)),nn(),rn(),0!==t?Fe("create",[l]):l},l.update=function(e,t){return l.is.create&&l.destroy(0),(0!==t?Fe("update",[l]):l).create(e,0)},l.destroy=function(e){return l.is.create?(l.is.create=!1,Lt.exit(0,0,0),it(jt,St),D.tools=Ce(D.tools),D.keys&&(Ue(de,jt,on),Ue(pe,jt,fn)),D.resize&&(Ue(be,Dt,cn),Ue(he,u,dn),Ue(ye,u,pn)),Zt?(mt(Nt,Zt),wt(Zt,jt),Zt=0):mt(Nt,jt),Tt(Nt),0!==e?Fe("destroy",[l]):l):l},l.enable=function(e){return jt.disabled=jt.readOnly=!1,tt(Nt,_t+"-is-can-update"),tt(Nt,_t+"-is-can-copy"),0!==e?Fe("enable",[l]):l},l.disable=function(e){return jt.disabled=!0,it(Nt,_t+"-is-can-update"),it(Nt,_t+"-is-can-copy"),0!==e?Fe("disable",[l]):l},l.freeze=function(e){return jt.disabled=!1,jt.readOnly=!0,it(Nt,_t+"-is-can-update"),tt(Nt,_t+"-is-can-copy"),0!==e?Fe("freeze",[l]):l},Lt.exit=function(e,t,n){if(j={panel:function(){Tt(qt)},overlay:function(){Ue(se,Rt,bn),Tt(Rt)},modal:function(){Ue(se+" "+de,an.x,yn),Ue(be,Ft,gn),Ue(he,Ft,mn),Ue(ye,u,vn),Tt(Xt)},drop:function(){Tt(Wt)},bubble:function(){Tt(Ut)}},fn(),t)if(L(t))for(R in t)R=t[R],j[R]&&j[R](),0!==n&&Fe("exit."+R,[l]);else j[t]&&j[t](),0!==n&&Fe("exit."+R,[l]);else for(R in j)j[R]();return e&&l.select(),0!==n&&Fe("exit",[l]),l},Lt.panel=function(e,t,n,i){function r(e){return Ue(se+" "+de,ie,r),Lt.panel.exit(1),Xe(e)}return Lt.exit(0,0,0),U=Qe(e),J=0,i&&(U+=" "+U+"--"+Qe(i)),L(t)&&!w(t)&&(J=$t(_t+"-panel-header "+U,0,t.header),t=t.body),t=$t(_t+"-panel-body "+U,0,$t(_t+"-panel-content "+U,0,t)),ie=ot("a",!1,{href:ze,"class":_t+"-a "+_t+"-x "+U}),ie.title=Ct.close,ot(qt,!1,{"class":_t+"-panel "+U}),We(se+" "+de,ie,r),lt(qt,0),J&&wt(qt,J),wt(Ft,ot(qt,[t,ie])),T(n)?n(qt):O(n)&&ot(qt,n),N=[l,qt],i&&Fe("enter.panel."+e+":"+i,N),Fe("enter.panel."+e,N),Fe("enter.panel",N),Fe("enter",N),ie.focus(),l},Lt.panel.fit=function(){},Lt.overlay=function(e,t,n,i){return Lt.exit(0,0,0),U=Qe(e),i&&(U+=" "+U+"--"+Qe(i)),wt(Ft,ot(Rt,!1,{"class":_t+"-overlay "+U})),t&&We(se,Rt,bn),T(n)?n(Rt):O(n)&&ot(Rt,n),N=[l,Rt],i&&Fe("enter.overlay."+e+":"+i,N),Fe("enter.overlay."+e,N),Fe("enter.overlay",N),Fe("enter",N),l},Lt.overlay.fit=function(){},Lt.modal=function(){var s,a,e=arguments,t=e[0],n=e[1],i=e[2],r=e[3],o=_t+"-modal",f=n.footer;if(L(t)&&(t="default",n=e[0],i=e[1],r=e[2]),Lt.overlay(t,1,0,r).blur(),U=Qe(t),r&&(U+=" "+U+"--"+Qe(r)),ot(Xt,!1,{"class":o+" "+U}),_(n.body)&&(n.body=ot("div",n.body,{"class":o+"-content "+U})),_(f)&&L(f)&&!w(f)){a=[];for(R in f)X=f[R],w(X)?a.push(X):(X=Jt(X,R,f),W=R.text||Ct[R]||R,s=ot("button",W,b({name:"y["+R+"]",type:"button","class":_t+"-button",data:{"button-id":R}},X.attributes)),We(se,s,function(e){return W=f[qe(this,"button-id")].click(e,l),W===!1?Xe(e):void 0}),a.push(s));n.footer=a}for(R in n)o[1]=R,an[R]=$t(o+"-"+Ze(R,o)+" "+U,0,n[R]);return an.x=ot("a",!1,{href:ze,"class":_t+"-a "+_t+"-x "+U}),an.sizer=Ht,lt(Xt,0),an.x.title=Ct.close,wt(Ft,ot(Xt,an,{style:""})),Lt.modal.fit(),vt(Xt,Rt),We(se+" "+de,an.x,yn),We(be,an.header,Xe),We(be,an.sizer,Xe),We(be,Ft,gn),We(he,Ft,mn),We(ye,u,vn),T(i)&&i(an),N=[l,Xt,an],r&&Fe("enter.modal."+t+":"+r,N),Fe("enter.modal."+t,N),Fe("enter.modal",N),Fe("enter",N),an.x.focus(),l},Lt.modal.fit=function(e){return hn(),U=un/2-ne/2,J=ln/2-q/2,L(e)?(_(e[0])&&(U=e[0]),_(e[1])&&(J=e[1])):(U=d(U,0),J=d(J,0)),c(Xt,{left:U+_e,top:J+_e,"min-width":ne+_e,"min-height":q+_e,visibility:"visible"}),N=[l,Xt,an],Fe("fit.modal",N),Fe("fit",N),l};var wn={"class":_t+"-button",name:"y"};return Lt.alert=function(e,t,n,i,r){var o=ot("button",Ct.okay,wn),f="alert";return n=n||x,L(e)&&(f+=":"+e[0],e=e[1]||e[0]),We(se,o,function(e){return n(e,l),yn(e,f+".y")}),We(de,o,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Pe(se,o,[e]),Xe(e)}),Lt.modal(f,xn(e,t,o),i,r),o.focus(),l},Lt.confirm=function(e,t,n,i,r,o){function c(e){return T(n)&&n(e,l),yn(e,u+".y")}function d(e){return T(i)&&i(e,l),yn(e,u+".n")}var a,f=ot("button",Ct.okay,wn),s=ot("button",Ct.cancel,wn),u="confirm";return s.name="n",We(se,f,c),We(se,s,d),We(de,f,function(e){return a=e.TE.key,a("arrowright")?s.focus():a("enter")?c(e):a("escape")&&yn(e,u+".y"),Xe(e)}),We(de,s,function(e){return a=e.TE.key,a("arrowleft")?f.focus():a("enter")?d(e):a("escape")&&yn(e,u+".n"),Xe(e)}),Lt.modal(u,xn(e,t,[f,s]),r,o),s.focus(),l},Lt.prompt=function(e,t,n,i,r,o,f){function y(){a.focus(),"placeholder"in a&&a.select()}function g(e){return p=a.value,T(n)&&!n(p)?y():!n||m(p)&&p!==t?(yn(e,c+".y"),i(e,l,p!==t?p:"",t)):y(),Xe(e)}function v(e){return yn(e,c+".n")}var p,b,h,s=ot("button",Ct.okay,wn),u=ot("button",Ct.cancel,wn),a=ot("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":_t+"-input block"}),c="prompt",d=[];if(r=r||0,1===r)a=ot("textarea",t,{placeholder:t.split("\n")[0],"class":_t+"-textarea block",spellcheck:"false"});else if(2===r){for(R in t)d.push(ot("option",t[R],{value:R,selected:R===n||null}));a=ot("select",d,{"class":_t+"-select block"})}return i=i||x,a.name="data",u.name="n",We(de,a,function(e){return b=e.TE.key,h=e.TE.control,b("enter")&&0===r||h("enter")?g(e):b("escape")||b("backspace")&&!this.value?v(e):b("arrowdown")&&0===r||b("enter")&&2===r||h("arrowdown")?(s.focus(),Xe(e)):void 0}),We(de,s,function(e){return b=e.TE.key,b("enter")?g(e):b("escape")?v(e):b("arrowup")?a.focus():b("arrowright")&&u.focus(),Xe(e)}),We(de,u,function(e){return b=e.TE.key,b(/^(enter|escape)$/)?v(e):b("arrowup")?a.focus():b("arrowleft")&&s.focus(),Xe(e)}),We(se,s,g),We(se,u,v),Lt.modal(c,xn(e,a,[s,u]),o,f),y(),l},Lt.drop=function(){Lt.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===Se(e)&&(t="default",n=e[0],i=e[1]),U=Qe(t),lt(Wt,0),wt(S,ot(Wt,!1,{"class":_t+"-drop "+U})),T(n)?n(Wt):ot(Wt,n),Lt.drop.fit(),i===!1||We(se,u,kn),We(me,s,kn),N=[l,Wt],Fe("enter.drop."+t,N),Fe("enter.drop",N),l},Lt.drop.fit=function(e){return N=Je(C),B=Je(Wt),F=Lt.drop.target,U=N.w/2-B.w/2,J=N.h/2-B.h/2,!_(e)&&F&&(t=Ve(F),U=t.l,J=t.t+Je(F).h),L(e)?(_(e[0])&&(U=e[0]),_(e[1])&&(J=e[1])):(U=d(U,0,N.w-B.w),J=d(J,0,Math.max(N.h,Je(s).h)-B.h)),c(Wt,{left:U+_e,top:J+_e,visibility:"visible"}),N=[l,Wt],Fe("fit.drop",N),Fe("fit",N),l},Lt.menu=function(e,n,i,r){var s,o=Lt.tools,f=0;if(n===!1)return Lt.tool(e,n);for(r in i)ne="%"===r[0],s=i[r],s=O(s)&&!ne?o[s]:s,s&&(s=Jt(s,r,o),i[r]=s);return Lt.tool(e,{i:L(n)?n[0]:0,text:L(n)?n[1]||0:n&&i[n]&&i[n].text||n,click:function(u){var a=Lt.drop.target=o[e].target;return Lt.drop("menu menu-"+Qe(e),function(u){function c(f){return J=this,t=qe(J,"tool-id"),P=i[t],P=O(P)?o[P]:P||{},K=ut(J),!Vt(P)&&T(r=P.click)&&(r=r(f,l),Lt.menu.set(e,L(P.text)?P.text:L(n)?n:t),r===!1)?(l.select(),Xe(f)):(l.select(),Xe(f))}function d(e){if(J=this,(W=e.TE.key)("escape"))Lt.exit(1);else if(W("enter"))Pe(se,J,[e]);else if(W("f10")&&a)a.focus();else if(W("arrowdown")&&(U=dt(J))){for(;!ht(U,"a")&&U;)U=dt(U);U&&U.focus()}else if(W("arrowup")&&(U=pt(J))){for(;!ht(U,"a")&&U;)U=pt(U);!U&&a?(Lt.exit(),a.focus()):U&&U.focus()}else W("arrowup")&&a&&(Lt.exit(),a.focus());return Xe(e)}for(r in i)if(s=i[r],ne="%"===r[0],s){var p={href:ne?null:ze,"class":_t+"-"+(ne?"label":"button")};ne?X=Mt[e]&&Mt[e][+r.slice(1)-1]||r:(p.data={},p.data["tool-id"]=r,X=Ot[r]||r),G=s.text,G=L(G)?G[1]||"":G,X=L(X)?X[0]:X,V=ot(ne?"span":"a","<span>"+(ne?X||"%"+f:G||X)+"</span>",b(p,s.attributes||{})),tt(V,"menu-"+Qe(r).replace(/[\/\s]/g,"-")),!p.title&&(J=s.title)&&(V.title=L(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),ne?Ae(V,{id:_t+"-label:"+f}):(Vt(s)?tt(V,"x"):it(V,"x"),s.on?tt(V,"on"):it(V,"on"),We(se,V,c),We(de,V,d)),wt(u,V),++f}g(function(){(yt('[data-tool-id="'+qe(a,"ui-drop-data")+'"]',u)[0]||yt("a",u)[0]).focus()},1)}),!1}},r),Ie(o[e].target,{"ui-drop":e}),o[e].data=i,Lt.menu.set(e,n),l},Lt.menu.set=function(e,t){var o,f,n=Lt.tools[e]||{},i=n.target,r=n.data;return i?(L(t)?Ie(i,"ui-drop-data",t[0]):(Ie(i,"ui-drop-data",t),t=r[t]&&r[t].text||t),L(t)?(f=t[0],f=Me(f,"<")?f:Lt.i(e,f),t=_(t[1])?t[1]:0,t=t&&r[t]&&r[t].text||t,t=f+(0!==t?" "+t:"")):f=Lt.i(n.i||e),(o=yt("."+_t+"-text",i)[0])?(tt(o,"menu"),tt(i,"text"),st(o,Ze(t,[f]))):(it(i,"text"),st(i,f)),l):l},Lt.bubble=function(){Lt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Se(e)&&(t="default",n=e[0]),U=Qe(t),lt(Ut,0),wt(S,ot(Ut,!1,{"class":_t+"-bubble "+U})),T(n)?n(Ut):ot(Ut,n),Lt.bubble.fit(),N=[l,Ut],Fe("enter.bubble."+t,N),Fe("enter.bubble",N),l},Lt.bubble.fit=function(e){V=l.$(1),t=Ve(jt),q=c(jt,"line-height");var n="border-",i="-width";U=V.caret[0].x+t.l-jt.scrollLeft,J=V.caret[1].y+t.t+q-jt.scrollTop,B=c(Ft,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=Je(Ft),o=Je(Ut),f=B[0]+B[1],s=B[2]+B[3];return L(e)?(_(e[0])&&(U=e[0]),_(e[1])&&(J=e[1])):(U=d(U,t.l,t.l+r.w-o.w-s),J=d(J,t.t,t.t+r.h-o.h-f)),c(Ut,{left:U+_e,top:J+_e,visibility:"visible"}),N=[l,Ut],Fe("fit.bubble",N),Fe("fit",N),l},Lt.panel.exit=function(e){return Lt.exit(e,"panel")},Lt.overlay.exit=function(e){return Lt.exit(e,"overlay")},Lt.modal.exit=function(e){return Lt.exit(e,"modal")},Lt.drop.exit=function(e){return Lt.exit(e,"drop")},Lt.bubble.exit=function(e){return Lt.exit(e,"bubble")},Lt.tool=function(e,t,n){return X="","|"!==e&&(D.tools=Oe(D.tools).filter(function(t,n){return t===e?(X=n,!1):!0})),t===!1?delete Lt.tools[e]:("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),Lt.tools[e]=b(Lt.tools[e]||{},t),_(n)||""===X||(n=X)),$(n)?D.tools.splice(n,0,e):D.tools.push(e)),nn(),l},Lt.separator=function(e,t){return Lt.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Lt.key=function(e,t){return D.keys?(t===!1?delete Lt.keys[e]:Lt.keys[e]=t,rn(),l):l},Lt.key.set=function(e){H[e]=1},Lt.key.reset=function(e){e?delete H[e]:H={}},Lt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return e&&e.TE&&e.TE.shift()?(t.outdent(we),!1):(t.indent(we),!1)},outdent:function(e,t){return t.outdent(we),!1}},Lt.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return G=":not([tabindex]):not([disabled])",(V=yt("input"+G+",button"+G+",select"+G+",textarea"+G+",a[href]"+G+",[contenteditable]"+G+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(J=V.indexOf(jt))?((V[J+1]||u).focus(),!1):void 0},f10:function(e,t){return yt("a",Yt)[0].focus(),!1},tab:xe?"indent":0,"shift+tab":xe?"outdent":0},Lt.el={container:Nt,header:Bt,body:Ft,footer:At,panel:qt,overlay:Rt,modal:Xt,drop:Wt,bubble:Ut},l.config=D,b(TE._,{time:function(e){var t=new Date(_(e)?e:Date.now()),n=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=t.getHours(),f=t.getMinutes(),s=t.getSeconds(),u=t.getMilliseconds();return 10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),10>u&&(u="0"+u),[""+n,""+i,""+r,""+o,""+f,""+s,""+u]},replace:Ke,format:Ze,dom:{set:wt,reset:Et,get:yt,id:ft,copy:function(e,t){return e.cloneNode(_(t)?t:!0)},classes:{set:tt,reset:it,toggle:rt,get:nt},attributes:{set:Ae,reset:je,get:Ye},data:{set:Ie,reset:Re,get:qe},is:ht,offset:Ve,pointer:Ge,size:Je,content:{set:st,reset:lt,get:ut},closest:et,parent:at,children:ct,next:dt,previous:pt,index:bt,before:mt,after:vt,prepend:xt,append:kt},el:ot,event:{set:We,reset:Ue,fire:Pe,x:Xe}}),b(l._,TE._),b(l._,{hooks:v,hook:{set:Ne,reset:Be,fire:Fe}}),l.create()};