/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.7
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function ge(e){return F(e)?R(e).split(/\s+/):e}function me(e){return h(e)?e.join(" "):e}function He(e,t,n){return C(e)?C(t)?(C(H[e])||(H[e]={}),C(n)||(n=Object.keys(H[e]).length),H[e][n]=t,s):H[e]:H}function De(e,t){return C(e)?C(t)&&C(H[e])?(delete H[e][t],s):(H[e]={},s):(H={},s)}function Me(e,t,n){if(!C(H[e]))return H[e]={},s;if(C(n))C(H[e][n])&&H[e][n].apply(s,t);else for(w in H[e])H[e][w].apply(s,t);return s}function Ue(e,t,n){if(h(t))for(w in t)Ue(e,w,t[w]);else e.setAttribute(t,n)}function ve(t,n,r){if(F(n))return ve(t,[n],C(r)?r:"")[0];e=[];for(w in n)w=n[w],(w=t.getAttribute(w))&&e.push(w);return e.length?e:C(r)?r:[]}function Be(e,t){if(h(t))for(w in t)Be(e,t[w]);else if(C(t))e.removeAttribute(t);else for(Be(e,"class"),w=0,K=e.attributes,Y=K.length;Y>w;++w)K[w]&&Be(e,K[w].name)}function Pe(e,t,n){if(h(t))for(w in t)Pe(e,w,t[w]);else Ue(e,"data-"+t,n)}function $e(t,n,r){if(F(n))return $e(t,[n],C(r)?r:"")[0];e=[];for(w in n)w=n[w],(w=ve(t,"data-"+w))&&e.push(w);return e.length?e:C(r)?r:[]}function ke(e,t){if(h(t))for(w in t)Be(e,"data-"+t[w]);else if(C(t))Be(e,"data-"+t);else for(w=0,K=e.attributes,Y=K.length;Y>w;++w)K[w]&&"data-"===K[w].name.slice(0,5)&&Be(e,K[w].name)}function We(e){return e&&e.preventDefault(),!1}function ye(e,t,n){if(t){for(e=ge(e),w=0,K=e.length;K>w;++w)t.addEventListener(e[w],n,!1),He("on:"+e[w],n,et(t));return s}}function we(e,t,n){if(t){for(e=ge(e),w=0,K=e.length;K>w;++w)t.removeEventListener(e[w],n,!1),De("on:"+e[w],et(t));return N(t)&&t.id.split(":")[0]===ht+"-dom"&&Be(t,"id"),s}}function Ke(e,t,n){e=ge(e);var i,r="createEvent"in a;for(w=0,K=e.length;K>w;++w)r?(i=a.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[w],!0,!1),t.dispatchEvent(i)):Me("on:"+e[w],n,et(t));return s}function Ye(e,t,n){for(w=0,K=t.length,Y;K>w;++w)Y=t[w],e=e.replace(S(Y)?Y:O(u(Y),"g"),n&&n[w]||"");return e}function xe(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,C(t[n])?t[n]:e})}function _e(e){return R(Ye(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ve(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=qe(e);return{x:n-i.l,y:r-i.t}}function qe(e){for(x=e.offsetLeft,X=e.offsetTop;e=e.offsetParent;)x+=e.offsetLeft,X+=e.offsetTop;return{l:x,t:X}}function Qe(e){return{w:e.offsetWidth,h:e.offsetHeight}}function je(e,t){for(;(e=it(e))&&e!==t;);return e}function ze(e,t){t=ge(t);for(w in t)e.classList.add(t[w])}function Xe(t,n,r){if(F(n))return Xe(t,[n],C(r)?r:"")[0];e=[];for(w in n)w=n[w],t.classList.contains(w)&&e.push(w);return e.length?e:C(r)?r:!1}function Je(e,t){if(C(t)){t=ge(t);for(w in t)e.classList.remove(t[w])}else Be(e,"class")}function Ze(e,t,n){if(e=F(e)?a.createElement(e):e,h(n))for(w in n)if(Z=n[w],"classes"===w)ze(e,Z);else if("data"===w)for(K in Z)Z=Z[K],null===Z?ke(e,K):Pe(e,K,Z);else"css"===w?F(Z)?Ue(e,"style",Z):null===Z?Be(e,"style"):A(e,Z):T(Z)?e[w]=Z:null===Z?Be(e,w):Ue(e,w,h(Z)?Z.join(" "):""+Z);if(N(t))Rt(e,t);else if(h(t))for(w in t)Z=t[w],N(Z)?Rt(e,Z):Z!==!1&&tt(e,Z);else C(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=ht+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(C(t)?t:"")}function rt(e,t){if(t!==!1&&(B=ot(e)))for(w=0,K=B.length;K>w;++w)rt(B[w]);tt(e,"")}function it(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function at(e){return e&&e.previousSibling}function st(e,t){return e&&F(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&T(t)?e===t(e):e===t}function ft(t,n){if(n=n||a,e=[],F(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(w=0,K=t.length;K>w;++w)e.push(t[w]);return e}return[]}for(t=n.querySelectorAll(t),w=0,K=t.length;K>w;++w)e.push(t[w]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=it(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){q=it(e),q&&q.insertBefore(t,e)}function At(e,t){q=it(e),q&&q.insertBefore(t,lt(e))}function Et(e,t){B=ot(e)[0],B?ct(B,t):Rt(e,t)}function Ot(e,t){Rt(e,t)}function Rt(e,t){e.appendChild(t)}function It(e,t){var n=ut(e);if(n){if(t!==!1)for(B=ot(e)[0];B;)It(B);n.removeChild(e)}}function pt(e){rt(Ze(e,!1,{style:""})),It(e)}function Lt(e,t,n){return Ze(t||"div",n,{"class":e})}function qt(e){return!e||C(e.active)&&!z.active}function Qt(){bt._word&&bt._words&&(Z=(Ut.value||"").replace(O(Se[0]+"[^"+Se[0]+Se[1]+"]+?"+Se[1],"g"),""),w=(Z.match(/(\w+)/g)||[]).length,tt(wt,xe(bt["_word"+(1===w?"":"s")],[w])))}function jt(e,t,n){return T(e)&&(e={click:e}),F(e.click)&&(e.click=(n[e.click]||{}).click),C(e.title)||(e.title=St[t]||""),n[t]=e,e}function zt(){rt(Mt,!1);var r,i,o,l,a,f,u,e=ge(M.tools),t=ht+"-button",n=ht+"-separator";M.tools=e;for(f in e)u=e[f],i=Nt.tools[u],(i||i==={})&&(i=jt(i,u,Nt.tools),o=i.i||u,"|"!==o&&"<"!==o[0]&&(o=_e(o)),l="|"!==o,a=_e(o).replace(/\s/g,""),_t=Lt(l?t+" "+t+"-"+a:n+" "+n+"-"+f,l?"a":"span"),l?(r=t+":"+a,Ue(_t,{href:be,id:r,tabindex:-1}),Pe(_t,Ce,u),o="<"===o[0]?o:'<i class="'+xe(dt,[o])+'"></i>',qt(i)&&ze(_t,"x"),i.text&&(o=xe('<span class="'+ht+'-text">'+i.text+"</span>",[o]),ze(_t,"text")),tt(_t,o),Ze(_t,!1,i.attributes||{}),!_t.title&&(K=i.title)&&(_t.title=h(K)?K[0]+(K[1]?" ("+K[1]+")":""):K),ye(Ae,_t,on)):_t.id=n+":"+f,Nt.tools[u].target=_t,Rt(Mt,_t));Me("update.tools",[s])}function Xt(){Nt.keys=function(){var n,e=Object.keys(Nt.keys).sort().reverse(),t={};for(w=0,K=e.length;K>w;++w)n=e[w],t[n]=Nt.keys[n];return t}(),nn(1),Me("update.keys",[s])}function Jt(e){Qt(),Me("on:change",[e,s])}function tn(t){function E(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=s.$(),r=n.before,i=n.after,o=r.slice(-1),l=i[0],a=n.length,f=Nt.keys,c=TE.keys_alias,A=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();V=t.TE.key(),Zt[V]=1,e=Object.keys(Zt).length,I(function(){s.record()},1);for(w in f){Y=E(w),B=0;for(K in Y)K=Y[K],Zt[c[K]||K]&&++B;if(Y=Y.length,B===Y&&e===Y&&(F(f[w])&&(f[w]=Nt.tools[f[w]].click),x=f[w]&&f[w](t,s),x===!1))return We(t)}if(Te)for(w in Te)if(_=Te[w],_!==!1){if(V===_&&l===_)return"\\"===o?(s.insert(V,0),We(t)):(s.select(n.end+1),We(t));if(w===V)return s.wrap(w,_),We(t);if(o===w&&l===_){if("backspace"===V&&r.slice(-2)!=="\\"+w)return s.unwrap(w,_),We(t);if(Ne&&"enter"===V&&w!==_)return s.tidy("\n"+A+Le,"\n"+A),We(t)}}if(Ne&&!a){if("backspace"===V&&O(u(Le)+"$").test(r))return s.outdent(Le),We(t);if("enter"===V&&O("(^|\\n)("+u(Le)+")+.*$").test(r))return s.insert("\n"+A,0,1),We(t)}}function nn(e){h(e)?delete Zt[e.TE.key()]:Zt={}}function rn(e){/^(focus|blur)$/.test(e.type)&&nn(1),p(en),en=I(function(){Jt(e)},M.debounce||0)}function on(e){Nt.exit(0,0,0);var t=$e(this,Ce),n=Nt.tools,r=n[t];return xt=e.currentTarget||e.target,!qt(r)&&T(K=r.click)&&(K=K(e,s,t),Me("on:change",[e,s,t]),K===!1)?We(e):(s.select(),We(e))}function un(e){return ln=vt,z=Qe(Dt),We(e)}function cn(e){ln===vt&&A(Ut,{height:Ve(Ht,e).y-z.h+Ge})}function An(){ln=0}function En(){Nt.exit(1)}function On(){e=Qe($t),ee=e.w,y=e.h,e=Qe(Pt),an=e.w,sn=e.h}function Rn(e,t){t&&Me("exit.modal."+t,[s]),Ke(Ae,Pt,[e])}function In(t){ln=t.target,e=Ve($t,t),te=e.x,ne=e.y,On()}function pn(t){var n=fn.header,r=fn.resize;ln===n||je(ln,n)===n?(e=Ve(Ht,t),x=e.x-te,X=e.y-ne,A($t,{left:(ee>an?x:E(x,0,an-ee))+Ge,top:(y>sn?X:E(X,0,sn-y))+Ge})):ln===r&&(e=Ve($t,t),z=Qe(r),A($t,{width:e.x+z.w/4+Ge,height:e.y+z.h/4+Ge}))}function Ln(){ln=0}function Nn(e,t,n){return{header:e,body:t,footer:n}}function Tn(e){U=xt,v=kt,B=e&&e.target||0,(!B||B!==U&&je(B,U)!==U)&&(xt=0,pt(kt),we(Ae,a,Tn),we(Re,l,Tn),Nt.exit(e.target===m))}function hn(t){function n(){e&&(q=Qe(e),A(j,{width:q.w+Ge,height:q.h+Ge}))}return Z=s.get(),ee="",-1===Z.indexOf("</html>")&&(ee='<!DOCTYPE html><html dir="'+M.dir+'"><head><meta charset="utf-8"><style>'+M.css+"</style></head><body>"+Z+"</body></html>"),j=Ze("iframe",!1,{"class":ht+"-portal",src:"data:text/html,"+encodeURIComponent(ee)}),!ut(Pt)&&Z?Nt.overlay(j,1,function(){e=ot(Pt)[0],n(),ye(Re,l,n),Me("enter.overlay.preview",[t,s,[Z,ee],e])}):(we(Re,l,n),En()),We(t)}var U,v,B,k,y,w,K,Y,x,_,V,e,q,j,z,X,Z,ee,te,ne,t="⌘",n="…",i="⇥",o="⇧",l=window,a=document,s=this,f=s._,u=f.x,c=f.extend,A=f.css,E=f.edge,O=f.pattern,R=f.trim,I=f.timer.set,p=f.timer.reset,L=s.is,N=L.e,T=L.f,d=L.i,h=L.o,S=L.r,F=L.s,C=function(e){return!L.x(e)},b=a.documentElement,g=(a.head,a.body),m=s.target,H={},D=function(){},M=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",oe="keyup",le="copy",ae="cut",se="paste",fe="touchstart mousedown",ue="touchend mouseup",ce="touchmove mousemove",Ae="click",Ee="focus",Oe="blur",Re="orientationchange resize",Ie=Oe+" "+le+" "+ae+" "+Ee+" input "+ie+" "+se,pe=M.languages,Le=M.tab,Ne=M.auto_tab,Te=M.auto_close,de=M.unit[0][0],Se=(M.unit[0][1],M.unit[1][0]),Fe=M.unit[1][1],Ce="tool-id",be="javascript:;",Ge="px",Nt=s.ui={};s.tidy=function(e,t){var n=s.$(),r=R(n.before)?e:"",i=R(n.after)?C(t)?t:e:"";return s.trim(r,i)},s.i=function(){return R(s.replace(/\s+/g," "))},s.format=function(e,t,n,r){h(e)||(e=[e]),C(n)||(n=" "),C(r)||(r="");var i=s.h,o=s[0]().$(),l=(e[0]?de[0]+e[0]+de[1]:"")+r,a=r+(e[0]?de[0]+de[2]+(e[1]||e[0].split(O("("+Fe[3]+")+"))[0])+de[1]:""),f=u(l),c=u(a),A=O("^"+f+"([\\s\\S]*?)"+c+"$"),E=O(f+"$"),R=O("^"+c),I=o.before,p=o.after;return o.length?n=!1:s.insert(pe.placeholders[""]),s.toggle(t?!A.test(o.value):!E.test(I)&&!R.test(p),[function(e){e.unwrap(l,a,1).tidy(O(Se[0]+"[^"+Se[0]+Se[1]+Se[2]+"]+?"+Se[1]+"$").test(I)?"":n,O("^"+Se[0]+Se[2]+"[^"+Se[0]+Se[1]+"]+?"+Se[1]).test(p)?"":n).wrap(l,a,t)},function(e){e.unwrap(l,a,t)}])[1]()[i]()};var _t,Tt=M.classes,dt=Tt.i,ht=Tt[""],St=pe.tools,Ft=pe.buttons,Ct=pe.labels,bt=pe.others,Gt=ht+"-textarea "+ht+"-content block",gt=Lt(ht),mt=Lt(ht+"-header"),Ht=Lt(ht+"-body"),Dt=Lt(ht+"-footer"),Mt=Lt(ht+"-tool"),Ut=Ze(m,!1,M.attributes),vt=Lt(ht+"-resize s"),Bt=Lt(ht+"-description"),Pt=Lt(ht+"-overlay"),$t=Ze("div"),kt=Ze("div"),Wt=Ze("div"),yt=Lt("left","span"),wt=Lt("right","span"),Kt=Lt(ht+"-preview","a"),Yt=0,xt=0;M.suffix||(M.suffix=de[1]);var Zt={},en=null;s.create=function(e,t){h(e)&&(M=c(M,e));var n=ut(Ut);return ze(Ut,Gt),n&&st(n,"p")?(ct(n,gt),Yt=n,It(n,!1)):ct(Ut,gt),gt.dir=M.dir,Rt(gt,mt),Rt(gt,Ht),Rt(gt,Dt),Rt(gt,vt),Rt(Ht,Ut),M.tools&&(Rt(mt,Mt),Rt(Dt,Bt),Rt(Bt,yt),Rt(Bt,wt)),ye(ie,Ut,tn),ye(oe,Ut,nn),ye(Ie,Ut,rn),ye(fe,vt,un),ye(ce,a,cn),ye(ue,g,An),bt.preview&&(z=St.preview,Ue(Kt,{href:be,title:h(z)?z[0]+(z[1]?" ("+z[1]+")":""):z}),Rt(yt,Kt),tt(Kt,bt.preview)),Jt(null),zt(),Xt(),0!==t?Me("create",[s]):s},s.update=function(e,t){return Xe(Ut,ge(Gt),0)&&s.destroy(0),(0!==t?Me("update",[s]):s).create(e,0)},s.destroy=function(e){return Xe(Ut,ge(Gt),0)?(Nt.exit(0,0,0),Je(Ut,Gt),M.tools=me(M.tools),M.keys&&(we(ie,Ut,tn),we(oe,Ut,nn)),we(fe,vt,un),we(ce,a,cn),we(ue,a,An),we(Ie,Ut,rn),Yt?(ct(gt,Yt),Rt(Yt,Ut),Yt=0):ct(gt,Ut),pt(gt),0!==e?Me("destroy",[s]):s):s};var ln=0,te=0,ne=0,ee=0,y=0,an=0,sn=0,fn={};Nt.exit=function(e,t,n){if(k={overlay:function(){we(Ae,Pt,En),pt(Pt)},modal:function(){we(fe,Ht,In),we(ce,Ht,pn),we(ue,a,Ln),we(Ae,fn.x,Rn),pt($t)},drop:function(){pt(kt)},bubble:function(){pt(Wt)}},t)if(h(t))for(w in t)w=t[w],k[w]&&k[w](),0!==n&&Me("exit."+w,[s]);else k[t]&&k[t](),0!==n&&Me("exit."+w,[s]);else for(w in k)k[w]();return e&&s.select(),0!==n&&Me("exit",[s]),s},Nt.overlay=function(e,t,n){return Nt.exit(0,0,0),nn(1),Rt(Ht,Ze(Pt,e.length||N(e)?Lt(ht+"-overlay-content","div",e):"")),t&&ye(Ae,Pt,En),T(n)?n(Pt):Ze(Pt,n),Me("enter.overlay",[s]),Me("enter",[s]),s},Nt.overlay.fit=function(){},Nt.modal=function(){Nt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=ht+"-modal";h(t)&&(t="default",n=e[0],r=e[1]),x=_e(t),Ze($t,!1,{"class":i+" "+x}),C(n.body)&&(n.body=Ze("div",n.body,{"class":i+"-content "+x}));for(w in n)i[1]=w,fn[w]=Lt(i+"-"+xe(w,i)+" "+x,0,n[w]);return fn.x=Lt(ht+"-x "+x),fn.resize=Lt(ht+"-resize se "+x),rt($t),Rt(Ht,Ze($t,fn,{style:""})),Nt.modal.fit(),At($t,Pt),ye(Ae,fn.x,Rn),ye(fe,fn.header,We),ye(fe,fn.resize,We),ye(fe,Ht,In),ye(ce,Ht,pn),ye(ue,a,Ln),T(r)&&(fn.overlay=Pt,fn.modal=$t,r(fn)),Me("enter.modal."+t,[s]),Me("enter.modal",[s]),Me("enter",[s]),s},Nt.modal.fit=function(e){return On(),x=an/2-ee/2,X=sn/2-y/2,h(e)?(C(e[0])&&(x=e[0]),C(e[1])&&(X=e[1])):(x=E(x,0),X=E(X,0)),A($t,{left:x+Ge,top:X+Ge,"min-width":ee+Ge,"min-height":y+Ge,visibility:"visible"}),Me("fit.modal",[s]),Me("fit",[s]),s};var dn={"class":ht+"-button",name:"y"};return Nt.alert=function(e,t,n,r){var i=Ze("button",Ft.okay,dn),o="alert";return n=n||D,h(e)&&(o+=":"+e[0],e=e[1]||e[0]),ye(Ae,i,function(e){return n(e,s),Rn(e,o+".y"),We(e)}),ye(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(Ke(Ae,i,[e]),We(e)):void 0}),Nt.modal(o,Nn(e,t,i),r),i.focus(),s},Nt.confirm=function(e,t,n,r,i){function u(e){return T(n)&&n(e,s),Rn(e,a+".y"),We(e)}function c(e){return T(r)&&r(e,s),Rn(e,a+".n"),We(e)}var f,o=Ze("button",Ft.okay,dn),l=Ze("button",Ft.cancel,dn),a="confirm";return l.name="n",h(e)&&(a+=":"+e[0],e=e[1]||e[0]),ye(Ae,o,u),ye(Ae,l,c),ye(ie,o,function(e){return f=e.TE.key,f("arrowright")?(l.focus(),We(e)):f("arrowleft")?We(e):f("enter")?(u(e),We(e)):f("escape")?(Rn(e,a+".y"),We(e)):void 0}),ye(ie,l,function(e){return f=e.TE.key,f("arrowright")?We(e):f("arrowleft")?(o.focus(),We(e)):f("enter")?(c(e),We(e)):f("escape")?(Rn(e,a+".n"),We(e)):void 0}),Nt.modal(a,Nn(e,t,[o,l]),i),l.focus(),s},Nt.prompt=function(e,t,n,r,i,o){function O(){f.focus(),"placeholder"in f&&f.select()}function I(e){return We(e)}function p(e){return A=f.value,!n||R(A)&&A!==t?(Rn(e,u+".y"),We(e),r(e,s,A!==t?A:"",t)):(O(),I(e))}function L(e){return Rn(e,u+".n"),We(e)}var A,E,l=Ze("button",Ft.okay,dn),a=Ze("button",Ft.cancel,dn),f=Ze("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":ht+"-input block"}),u="prompt",c=[];if(h(e)&&(u+=":"+e[0],e=e[1]||e[0]),T(i)&&(o=i,i=0),1===i)f=Ze("textarea",t,{placeholder:t.split("\n")[0],"class":ht+"-textarea block"});else if(2===i){for(w in t)c.push(Ze("option",t[w],{value:w,selected:w===n||null}));f=Ze("select",c,{"class":ht+"-select block"})}return r=r||D,f.name="data",a.name="n",ye(ie,f,function(e){return E=e.TE.key,E("enter")?p(e):E("escape")||E("backspace")&&!this.value?L(e):E("arrowup")?I(e):E("arrowdown")?(l.focus(),We(e)):void 0}),ye(ie,l,function(e){return E=e.TE.key,E("enter")?p(e):E("escape")?L(e):E("arrowup")?(f.focus(),We(e)):E("arrowright")?(a.focus(),We(e)):E(/^arrow(down|left)$/)?I(e):void 0}),ye(ie,a,function(e){return E=e.TE.key,E(/^(enter|escape)$/)?L(e):E("arrowup")?(f.focus(),We(e)):E(/^arrow(right|down)$/)?I(e):E("arrowleft")?(l.focus(),We(e)):void 0}),ye(Ae,l,p),ye(Ae,a,L),Nt.modal(u,Nn(e,f,[l,a]),o),O(),s},Nt.drop=function(){Nt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),x=_e(t),rt(kt),Rt(g,Ze(kt,!1,{"class":ht+"-drop "+x})),T(n)?n(kt):Ze(kt,n),Nt.drop.fit(),ye(Ae,a,Tn),ye(Re,l,Tn),Me("enter.drop."+t,[s]),Me("enter.drop",[s]),s},Nt.drop.fit=function(t){return U=Qe(b),v=Qe(kt),x=U.w/2-v.w/2,X=U.h/2-v.h/2,!C(t)&&xt&&(e=qe(xt),x=e.l,X=e.t+Qe(xt).h),h(t)?(C(t[0])&&(x=t[0]),C(t[1])&&(X=t[1])):(x=E(x,0,Math.max(U.w,l.innerWidth)-v.w),X=E(X,0,Math.max(U.h,l.innerHeight)-v.h)),A(kt,{left:x+Ge,top:X+Ge,visibility:"visible"}),Me("fit.drop",[s]),Me("fit",[s]),s},Nt.menu=function(e,t,n,r){t=!h(t)&&n[t]&&n[t].text||t;var a,i='<span class="'+ht+'-current menu">%1</span>',o="",l=0;return t===!1?Nt.tool(e,t):(h(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+xe(dt,[o])+'"></i>',t=C(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,i=o+(0!==t?" "+i:"")),Nt.tool(e,{i:o,text:t?xe(i,[t,o]):0,click:function(f){return Nt.drop("menu menu-"+_e(e),function(f){function u(e){return a=this,_=n[$e(a,Ce)],_=F(_)?Nt.tools[_]:_||{},V=nt(a),!qt(_)&&T(r=_.click)&&(r=r(e,s),t!==!1&&xt&&(z=ot(xt)[0]||xt,st(z,"i")||tt(z,xe(i,[V,o])),h(_.text)&&(X=ot(z)[0])&&st(X,"i")&&(Je(X),ze(X,xe(dt,[_.text[0]])))),r===!1)?We(e):(s.select(),We(e))}function A(e){if(a=this,(Y=e.TE.key)("escape"))return Nt.exit(1),We(e);if(Y("arrowdown")&&(x=lt(a))){for(;!st(x,"a")&&x;)x=lt(x);return x&&x.focus(),We(e)}if(Y("arrowup")&&(x=at(a))){for(;!st(x,"a")&&x;)x=at(x);return x&&x.focus(),We(e)}}for(r in n)if(a=n[r],ee="%"===r[0],a=F(a)&&!ee?Nt.tools[a]:a){a=jt(a,r,Nt.tools);var E={href:ee?null:be,"class":ht+"-"+(ee?"label":"button")};ee?K=Ct[e]&&Ct[e][+r.slice(1)-1]||r:(E.data={},E.data[Ce]=r,K=St[r]||r),j=a.text,j=h(j)?j[1]||"":j,K=h(K)?K[0]:K,z=Ze(ee?"span":"a",ee?"<span>"+(K||"%"+l)+"</span>":a.text||K,c(E,a.attributes||{})),!z.title&&(X=a.title)&&(z.title=h(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),ee?Ue(z,{id:ht+"-label:"+l}):(qt(a)&&ze(z,"x"),ye(Ae,z,u),ye(ie,z,A)),n[r]=a,Rt(f,z),++l}I(function(){ft("a",f)[0].focus()},1)}),!1}},r),Nt.tools[e].data=n,s)},Nt.bubble=function(){Nt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),x=_e(t),rt(Wt),Rt(g,Ze(Wt,!1,{"class":ht+"-bubble "+x})),T(n)?n(Wt):Ze(Wt,n),Nt.bubble.fit(),Me("enter.bubble."+t,[s]),Me("enter.bubble",[s]),s},Nt.bubble.fit=function(t){z=s.$(1),e=qe(Ut),y=A(Ut,"line-height");var n="border-",r="-width";x=z.caret[0].x+e.l-Ut.scrollLeft,X=z.caret[1].y+e.t+y-Ut.scrollTop,v=A(Ht,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Qe(Ht),o=Qe(Wt),l=v[0]+v[1],a=v[2]+v[3];return h(t)?(C(t[0])&&(x=t[0]),C(t[1])&&(X=t[1])):(x=E(x,e.l,e.l+i.w-o.w-a),X=E(X,e.t,e.t+i.h-o.h-l)),A(Wt,{left:x+Ge,top:X+Ge,visibility:"visible"}),Me("fit.bubble",[s]),Me("fit",[s]),s},Nt.overlay.exit=function(e){return Nt.exit(e,"overlay")},Nt.modal.exit=function(e){return Nt.exit(e,"modal")},Nt.drop.exit=function(e){return Nt.exit(e,"drop")},Nt.bubble.exit=function(e){return Nt.exit(e,"bubble")},Nt.tool=function(e,t,n){return K="","|"!==e&&(M.tools=M.tools.filter(function(t,n){return t===e?(K=n,!1):!0})),t===!1?delete Nt.tools[e]:("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),Nt.tools[e]=c(Nt.tools[e]||{},t),C(n)||""===K||(n=K)),d(n)?M.tools.splice(n,0,e):M.tools.push(e)),zt(),s},Nt.key=function(e,t){return M.keys?(t===!1?delete Nt.keys[e]:Nt.keys[e]=t,Xt(),s):s},Nt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Le),!1},outdent:function(e,t){return t.outdent(Le),!1}},ye(Ae,Kt,hn),Nt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return hn(e)},"shift+tab":Ne?"outdent":0,tab:Ne?"indent":0,escape:function(e,t){return Kt.focus(),!1}},Nt.el={container:gt,header:mt,body:Ht,footer:Dt,overlay:Pt,modal:$t,drop:kt,bubble:Wt},s.config=M,c(s._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=e.getSeconds(),a=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>l&&(l="0"+l),10>a&&(a="0"+a),[""+t,""+n,""+r,""+i,""+o,""+l,""+a]},replace:Ye,format:xe,dom:{set:Rt,reset:It,get:ft,id:et,copy:function(e,t){return e.cloneNode(C(t)?t:!0)},classes:{set:ze,reset:Je,get:Xe},attributes:{set:Ue,reset:Be,get:ve},data:{set:Pe,reset:ke,get:$e},is:st,offset:qe,point:Ve,size:Qe,content:{set:tt,reset:rt,get:nt},closest:je,parent:it,children:ot,next:lt,previous:at,before:ct,after:At,prepend:Et,append:Ot},el:Ze,event:{set:ye,reset:we,fire:Ke,x:We},hooks:H,hook:{set:He,reset:De,fire:Me}}),Nt};