/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e,t){function ve(e){return m(e)?h(e).split(/\s+/):e}function Fe(e){return T(e)?e.join(" "):e}function Ce(e,t,n){return y(e)?y(t)?(y(w[e])||(w[e]={}),y(n)||(n=Object.keys(w[e]).length),w[e][n]=t,l):w[e]:w}function we(e,t){return y(e)?y(t)&&y(w[e])?(delete w[e][t],l):(w[e]={},l):(w={},l)}function xe(e,t,n){if(!y(w[e]))return w[e]={},l;if(y(n))y(w[e][n])&&w[e][n].apply(l,t);else for(K in w[e])w[e][K].apply(l,t);return l}function Ge(e,t,n){if(T(t))for(K in t)Ge(e,K,t[K]);else e.setAttribute(t,n)}function ke(t,n,i){if(m(n))return ke(t,[n],y(i)?i:"")[0];e=[];for(K in n)K=n[K],(K=t.getAttribute(K))&&e.push(K);return e.length?e:y(i)?i:[]}function De(e,t){if(T(t))for(K in t)De(e,t[K]);else if(y(t))e.removeAttribute(t);else for(De(e,"class"),K=0,Y=e.attributes,$=Y.length;$>K;++K)Y[K]&&De(e,Y[K].name)}function He(e,t,n){if(T(t))for(K in t)He(e,K,t[K]);else Ge(e,"data-"+t,n)}function Me(t,n,i){if(m(n))return Me(t,[n],y(i)?i:"")[0];e=[];for(K in n)K=n[K],(K=ke(t,"data-"+K))&&e.push(K);return e.length?e:y(i)?i:[]}function Ue(e,t){if(T(t))for(K in t)De(e,"data-"+t[K]);else if(y(t))De(e,"data-"+t);else for(K=0,Y=e.attributes,$=Y.length;$>K;++K)Y[K]&&"data-"===Y[K].name.slice(0,5)&&De(e,Y[K].name)}function Be(e){return e&&e.preventDefault(),!1}function Pe(e,t,n){if(t){for(e=ve(e),K=0,Y=e.length;Y>K;++K)t.addEventListener(e[K],n,!1),Ce("on:"+e[K],n,et(t));return l}}function We(e,t,n){if(t){for(e=ve(e),K=0,Y=e.length;Y>K;++K)t.removeEventListener(e[K],n,!1),we("on:"+e[K],et(t));return I(t)&&t.id.split(":")[0]===gt+"-dom"&&De(t,"id"),l}}function Ke(e,t,n){e=ve(e);var r,i="createEvent"in s;for(K=0,Y=e.length;Y>K;++K)i?(r=s.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[K],!0,!1),t.dispatchEvent(r)):xe("on:"+e[K],n,et(t));return l}function Ye(e,t,n){for(K=0,Y=t.length,$;Y>K;++K)$=t[K],e=e.replace(N($)?$:p(c($),"g"),n&&n[K]||"");return e}function $e(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,y(t[n])?t[n]:e})}function ze(e){return h(Ye(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function _e(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ve(e);return{x:n-r.l,y:i-r.t}}function Ve(e){for(z=e.offsetLeft,Z=e.offsetTop;e=e.offsetParent;)z+=e.offsetLeft,Z+=e.offsetTop;return{l:z,t:Z}}function je(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Xe(e,t){for(;(e=rt(e))&&e!==t;);return e}function Qe(e,t){t=ve(t);for(K in t)e.classList.add(t[K])}function Ze(t,n,i){if(m(n))return Ze(t,[n],y(i)?i:"")[0];e=[];for(K in n)K=n[K],t.classList.contains(K)&&e.push(K);return e.length?e:y(i)?i:!1}function Je(e,t){if(y(t)){t=ve(t);for(K in t)e.classList.remove(t[K])}else De(e,"class")}function qe(e,t,n){if(e=m(e)?s.createElement(e):e,T(n))for(K in n)if(q=n[K],"classes"===K)Qe(e,q);else if("data"===K)for(Y in q)q=q[Y],null===q?Ue(e,Y):He(e,Y,q);else"css"===K?m(q)?Ge(e,"style",q):null===q?De(e,"style"):A(e,q):L(q)?e[K]=q:null===q?De(e,K):Ge(e,K,T(q)?q.join(" "):""+q);if(I(t))pt(e,t);else if(T(t))for(K in t)q=t[K],I(q)?pt(e,q):q!==!1&&tt(e,q);else y(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=gt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(y(t)?t:"")}function it(e,t){if(t!==!1&&(H=ot(e)))for(K=0,Y=H.length;Y>K;++K)it(H[K]);tt(e,"")}function rt(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function ft(e){return e&&e.nextSibling}function ut(e){return e&&e.previousSibling}function st(e,t){return e&&m(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&L(t)?e===t(e):e===t}function lt(t,n){if(n=n||s,e=[],m(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(K=0,Y=t.length;Y>K;++K)e.push(t[K]);return e}return[]}for(t=n.querySelectorAll(t),K=0,Y=t.length;Y>K;++K)e.push(t[K]);return e}return at(t)?[t]:[]}function at(e,t){var n=rt(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,n){t=rt(e),t&&t.insertBefore(n,e)}function dt(e,n){t=rt(e),t&&t.insertBefore(n,ft(e))}function At(e,t){H=ot(e)[0],H?ct(H,t):pt(e,t)}function Et(e,t){pt(e,t)}function pt(e,t){e.appendChild(t)}function ht(e,t){var n=at(e);if(n){if(t!==!1)for(H=ot(e)[0];H;)ht(H);n.removeChild(e)}}function Ot(e){it(qe(e,!1,{style:""})),ht(e)}function bt(e,t,n){return qe(t||"div",n,{"class":e})}function Vt(e){return!e||y(e.active)&&!Q.active}function jt(){yt._word&&yt._words&&(q=(Gt.value||"").replace(p(Te[0]+"[^"+Te[0]+Te[1]+"]+?"+Te[1],"g"),""),K=(q.match(/(\w+)/g)||[]).length,tt(Wt,$e(yt["_word"+(1===K?"":"s")],[K])))}function Xt(e,t,n){return L(e)&&(e={click:e}),m(e.click)&&(e.click=(n[e.click]||{}).click),y(e.title)||(e.title=Tt[t]||""),n[t]=e,e}function Qt(){it(xt,!1);var i,r,o,f,u,s,a,e=ve(G.tools),t=gt+"-button",n=gt+"-separator";G.tools=e;for(s in e)a=e[s],r=Rt.tools[a],(r||r==={})&&(r=Xt(r,a,Rt.tools),o=r.i||a,"|"!==o&&"<"!==o[0]&&(o=ze(o)),f="|"!==o,u=ze(o).replace(/\s/g,""),zt=bt(f?t+" "+t+"-"+u:n+" "+n+"-"+s,f?"a":"span"),f?(i=t+":"+u,Ge(zt,{href:ye,id:i,tabindex:-1}),He(zt,me,a),o="<"===o[0]?o:'<i class="'+$e(Lt,[o])+'"></i>',Vt(r)&&Qe(zt,"x"),r.text&&(o=$e('<span class="'+gt+'-text">'+r.text+"</span>",[o]),Qe(zt,"text")),tt(zt,o),qe(zt,!1,r.attributes||{}),!zt.title&&(Y=r.title)&&(zt.title=T(Y)?Y[0]+(Y[1]?" ("+Y[1]+")":""):Y),Pe(de,zt,on)):zt.id=n+":"+s,Rt.tools[a].target=zt,pt(xt,zt));xe("update.tools",[l])}function Zt(){Rt.keys=function(){var n,e=Object.keys(Rt.keys).sort().reverse(),t={};for(K=0,Y=e.length;Y>K;++K)n=e[K],t[n]=Rt.keys[n];return t}(),nn(1),xe("update.keys",[l])}function Jt(e){jt(),xe("on:change",[e,l])}function tn(t){function A(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],u=n.length,s=Rt.keys,a=TE.keys_alias,d=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();V=t.TE.key(),qt[V]=1,e=Object.keys(qt).length,O(function(){l.record()},1);for(K in s){$=A(K),H=0;for(Y in $)Y=$[Y],qt[a[Y]||Y]&&++H;if($=$.length,H===$&&e===$&&(m(s[K])&&(s[K]=Rt.tools[s[K]].click),z=s[K]&&s[K](t,l),z===!1))return Be(t)}if(Ie)for(K in Ie)if(_=Ie[K],_!==!1){if(V===_&&f===_)return"\\"===o?(l.insert(V,0),Be(t)):(l.select(n.end+1),Be(t));if(K===V)return l.wrap(K,_),Be(t);if(o===K&&f===_){if("backspace"===V&&i.slice(-2)!=="\\"+K)return l.unwrap(K,_),Be(t);if(Re&&"enter"===V&&K!==_)return l.tidy("\n"+d+be,"\n"+d).scroll(!0),Be(t)}}if(Re&&!u){if("backspace"===V&&p(c(be)+"$").test(i))return l.outdent(be).scroll(!0),Be(t);if("enter"===V&&p("(^|\\n)("+c(be)+")+.*$").test(i))return l.insert("\n"+d,0,1).scroll(!0),Be(t)}}function nn(e){T(e)?delete qt[e.TE.key()]:qt={}}function rn(e){/^(focus|blur)$/.test(e.type)&&nn(1),b(en),en=O(function(){Jt(e)},G.debounce||0)}function on(e){Rt.exit(0,0,0);var t=Me(this,me),n=Rt.tools,i=n[t];return $t=e.currentTarget||e.target,!Vt(i)&&L(Y=i.click)&&(Y=Y(e,l,t),xe("on:change",[e,l,t]),Y===!1)?Be(e):(l.select(),Be(e))}function an(e){return fn=kt,Q=je(wt),Be(e)}function cn(e){fn===kt&&A(Gt,{height:_e(Ct,e).y-Q.h+Se})}function dn(){fn=0}function An(){Rt.exit(1)}function En(){e=je(Mt),ee=e.w,W=e.h,e=je(Ht),un=e.w,sn=e.h}function pn(e,t){t&&xe("exit.modal."+t,[l]),Ke(de,Ht,[e])}function hn(t){fn=t.target,e=_e(Mt,t),te=e.x,ne=e.y,En()}function On(t){var n=ln.header,i=ln.resize;fn===n||Xe(fn,n)===n?(e=_e(Ct,t),z=e.x-te,Z=e.y-ne,A(Mt,{left:(ee>un?z:E(z,0,un-ee))+Se,top:(W>sn?Z:E(Z,0,sn-W))+Se})):fn===i&&(e=_e(Mt,t),Q=je(i),A(Mt,{width:e.x+Q.w/4+Se,height:e.y+Q.h/4+Se}))}function bn(){fn=0}function Rn(e,t,n){return{header:e,body:t,footer:n}}function In(e){k=$t,D=Ut,H=e&&e.target||0,(!H||H!==k&&Xe(H,k)!==k)&&($t=0,Ot(Ut),We(de,s,In),We(pe,u,In),Rt.exit(e.target===C))}function gn(n){function i(){e&&(t=je(e),A(X,{width:t.w+Se,height:t.h+Se}))}return q=l.get(),ee="",-1===q.indexOf("</html>")&&(ee='<!DOCTYPE html><html dir="'+G.dir+'"><head><meta charset="utf-8"><style>'+G.css+"</style></head><body>"+q+"</body></html>"),X=qe("iframe",!1,{"class":gt+"-portal",src:"data:text/html,"+encodeURIComponent(ee)}),!at(Ht)&&q?Rt.overlay(X,1,function(){e=ot(Ht)[0],i(),Pe(pe,u,i),xe("enter.overlay.preview",[n,l,[q,ee],e])}):(We(pe,u,i),An()),Be(n)}var k,D,H,B,W,K,Y,$,z,_,V,e,t,X,Q,Z,q,ee,te,ne,n="⌘",i="…",o="⇥",f="⇧",u=window,s=document,l=this,a=l._,c=a.x,d=a.extend,A=a.css,E=a.edge,p=a.pattern,h=a.trim,O=a.timer.set,b=a.timer.reset,R=l.is,I=R.e,L=R.f,g=R.i,T=R.o,N=R.r,m=R.s,y=function(e){return!R.x(e)},S=s.documentElement,F=(s.head,s.body),C=l.target,w={},x=function(){},G=d({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),re="keydown",oe="keyup",fe="copy",ue="cut",se="paste",le="touchstart mousedown",ae="touchend mouseup",ce="touchmove mousemove",de="click",Ae="focus",Ee="blur",pe="orientationchange resize",he=Ee+" "+fe+" "+ue+" "+Ae+" input "+re+" "+se,Oe=G.languages,be=G.tab,Re=G.auto_tab,Ie=G.auto_close,Le=G.unit[0][0],Te=(G.unit[0][1],G.unit[1][0]),Ne=G.unit[1][1],me="tool-id",ye="javascript:;",Se="px",Rt=l.ui={};l.tidy=function(e,t){var n=l.$(),i=h(n.before)?e:"",r=h(n.after)?y(t)?t:e:"";return l.trim(i,r)},l.i=function(){return h(l.replace(/\s+/g," "))},l.format=function(e,t,n,i){T(e)||(e=[e]),y(n)||(n=" "),y(i)||(i="");var r=l.$(),o=(e[0]?Le[0]+e[0]+Le[1]:"")+i,f=i+(e[0]?Le[0]+Le[2]+(e[1]||e[0].split(p("("+Ne[3]+")+"))[0])+Le[1]:""),u=c(o),s=c(f),a=p("^"+u+"([\\s\\S]*?)"+s+"$"),d=p(u+"$"),A=p("^"+s),E=r.before,h=r.after;return r.length?n=!1:l.insert(Oe.placeholders[""]).loss(),l.toggle(t?!a.test(r.value):!d.test(E)&&!A.test(h),[function(e){e.unwrap(o,f,1).tidy(p(Te[0]+"[^"+Te[0]+Te[1]+Te[2]+"]+?"+Te[1]+"$").test(E)?"":n,p("^"+Te[0]+Te[2]+"[^"+Te[0]+Te[1]+"]+?"+Te[1]).test(h)?"":n).loss().wrap(o,f,t)},function(e){e.unwrap(o,f,t)}])};var zt,It=G.classes,Lt=It.i,gt=It[""],Tt=Oe.tools,Nt=Oe.buttons,mt=Oe.labels,yt=Oe.others,St=gt+"-textarea "+gt+"-content block",vt=bt(gt),Ft=bt(gt+"-header"),Ct=bt(gt+"-body"),wt=bt(gt+"-footer"),xt=bt(gt+"-tool"),Gt=qe(C,!1,G.attributes),kt=bt(gt+"-resize s"),Dt=bt(gt+"-description"),Ht=bt(gt+"-overlay"),Mt=qe("div"),Ut=qe("div"),Bt=qe("div"),Pt=bt("left","span"),Wt=bt("right","span"),Kt=bt(gt+"-preview","a"),Yt=0,$t=0;G.suffix||(G.suffix=Le[1]);var qt={},en=null;l.create=function(e,t){T(e)&&(G=d(G,e));var n=at(Gt);return Qe(Gt,St),n&&st(n,"p")?(ct(n,vt),Yt=n,ht(n,!1)):ct(Gt,vt),vt.dir=G.dir,pt(vt,Ft),pt(vt,Ct),pt(vt,wt),pt(vt,kt),pt(Ct,Gt),G.tools&&(pt(Ft,xt),pt(wt,Dt),pt(Dt,Pt),pt(Dt,Wt)),Pe(re,Gt,tn),Pe(oe,Gt,nn),Pe(he,Gt,rn),Pe(le,kt,an),Pe(ce,s,cn),Pe(ae,F,dn),yt.preview&&(Q=Tt.preview,Ge(Kt,{href:ye,title:T(Q)?Q[0]+(Q[1]?" ("+Q[1]+")":""):Q}),pt(Pt,Kt),tt(Kt,yt.preview)),Jt(null),Qt(),Zt(),0!==t?xe("create",[l]):l},l.update=function(e,t){return Ze(Gt,ve(St),0)&&l.destroy(0),(0!==t?xe("update",[l]):l).create(e,0)},l.destroy=function(e){return Ze(Gt,ve(St),0)?(Rt.exit(0,0,0),Je(Gt,St),G.tools=Fe(G.tools),G.keys&&(We(re,Gt,tn),We(oe,Gt,nn)),We(le,kt,an),We(ce,s,cn),We(ae,s,dn),We(he,Gt,rn),Yt?(ct(vt,Yt),pt(Yt,Gt),Yt=0):ct(vt,Gt),Ot(vt),0!==e?xe("destroy",[l]):l):l};var fn=0,te=0,ne=0,ee=0,W=0,un=0,sn=0,ln={};Rt.exit=function(e,t,n){if(B={overlay:function(){We(de,Ht,An),Ot(Ht)},modal:function(){We(le,Ct,hn),We(ce,Ct,On),We(ae,s,bn),We(de,ln.x,pn),Ot(Mt)},drop:function(){Ot(Ut)},bubble:function(){Ot(Bt)}},t)if(T(t))for(K in t)K=t[K],B[K]&&B[K](),0!==n&&xe("exit."+K,[l]);else B[t]&&B[t](),0!==n&&xe("exit."+K,[l]);else for(K in B)B[K]();return e&&l.select(),0!==n&&xe("exit",[l]),l},Rt.overlay=function(e,t,n){return Rt.exit(0,0,0),nn(1),pt(Ct,qe(Ht,e.length||I(e)?bt(gt+"-overlay-content","div",e):"")),t&&Pe(de,Ht,An),L(n)?n(Ht):qe(Ht,n),xe("enter.overlay",[l]),xe("enter",[l]),l},Rt.overlay.fit=function(){},Rt.modal=function(){Rt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],i=e[2],r=gt+"-modal";T(t)&&(t="default",n=e[0],i=e[1]),z=ze(t),qe(Mt,!1,{"class":r+" "+z}),y(n.body)&&(n.body=qe("div",n.body,{"class":r+"-content "+z}));for(K in n)r[1]=K,ln[K]=bt(r+"-"+$e(K,r)+" "+z,0,n[K]);return ln.x=bt(gt+"-x "+z),ln.resize=bt(gt+"-resize se "+z),it(Mt),pt(Ct,qe(Mt,ln,{style:""})),Rt.modal.fit(),dt(Mt,Ht),Pe(de,ln.x,pn),Pe(le,ln.header,Be),Pe(le,ln.resize,Be),Pe(le,Ct,hn),Pe(ce,Ct,On),Pe(ae,s,bn),L(i)&&(ln.overlay=Ht,ln.modal=Mt,i(ln)),xe("enter.modal."+t,[l]),xe("enter.modal",[l]),xe("enter",[l]),l},Rt.modal.fit=function(e){return En(),z=un/2-ee/2,Z=sn/2-W/2,T(e)?(z=e[0],Z=e[1]):(z=E(z,0),Z=E(Z,0)),A(Mt,{left:z+Se,top:Z+Se,"min-width":ee+Se,"min-height":W+Se,visibility:"visible"}),xe("fit.modal",[l]),xe("fit",[l]),l};var Ln={"class":gt+"-button",name:"y"};return Rt.alert=function(e,t,n,i){var r=qe("button",Nt.okay,Ln),o="alert";return n=n||x,T(e)&&(o+=":"+e[0],e=e[1]||e[0]),Pe(de,r,function(e){return n(e,l),pn(e,o+".y"),Be(e)}),Pe(re,r,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(Ke(de,r,[e]),Be(e)):void 0}),Rt.modal(o,Rn(e,t,r),i),r.focus(),l},Rt.confirm=function(e,t,n,i,r){function a(e){return L(n)&&n(e,l),pn(e,u+".y"),Be(e)}function c(e){return L(i)&&i(e,l),pn(e,u+".n"),Be(e)}var s,o=qe("button",Nt.okay,Ln),f=qe("button",Nt.cancel,Ln),u="confirm";return f.name="n",T(e)&&(u+=":"+e[0],e=e[1]||e[0]),Pe(de,o,a),Pe(de,f,c),Pe(re,o,function(e){return s=e.TE.key,s("arrowright")?(f.focus(),Be(e)):s("arrowleft")?Be(e):s("enter")?(a(e),Be(e)):s("escape")?(pn(e,u+".y"),Be(e)):void 0}),Pe(re,f,function(e){return s=e.TE.key,s("arrowright")?Be(e):s("arrowleft")?(o.focus(),Be(e)):s("enter")?(c(e),Be(e)):s("escape")?(pn(e,u+".n"),Be(e)):void 0}),Rt.modal(u,Rn(e,t,[o,f]),r),f.focus(),l},Rt.prompt=function(e,t,n,i,r,o){function E(){s.focus(),"placeholder"in s&&s.select()}function p(e){return Be(e)}function O(e){return d=s.value,!n||h(d)&&d!==t?(pn(e,a+".y"),Be(e),i(e,l,d!==t?d:"",t)):(E(),p(e))}function b(e){return pn(e,a+".n"),Be(e)}var d,A,f=qe("button",Nt.okay,Ln),u=qe("button",Nt.cancel,Ln),s=qe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":gt+"-input block"}),a="prompt",c=[];if(T(e)&&(a+=":"+e[0],e=e[1]||e[0]),L(r)&&(o=r,r=0),1===r)s=qe("textarea",t,{placeholder:t.split("\n")[0],"class":gt+"-textarea block"});else if(2===r){for(K in t)c.push(qe("option",t[K],{value:K,selected:K===n||null}));s=qe("select",c,{"class":gt+"-select block"})}return i=i||x,s.name="data",u.name="n",Pe(re,s,function(e){return A=e.TE.key,A("enter")?O(e):A("escape")||A("backspace")&&!this.value?b(e):A("arrowup")?p(e):A("arrowdown")?(f.focus(),Be(e)):void 0}),Pe(re,f,function(e){return A=e.TE.key,A("enter")?O(e):A("escape")?b(e):A("arrowup")?(s.focus(),Be(e)):A("arrowright")?(u.focus(),Be(e)):A(/^arrow(down|left)$/)?p(e):void 0}),Pe(re,u,function(e){return A=e.TE.key,A(/^(enter|escape)$/)?b(e):A("arrowup")?(s.focus(),Be(e)):A(/^arrow(right|down)$/)?p(e):A("arrowleft")?(f.focus(),Be(e)):void 0}),Pe(de,f,O),Pe(de,u,b),Rt.modal(a,Rn(e,s,[f,u]),o),E(),l},Rt.drop=function(){Rt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),z=ze(t),it(Ut),pt(F,qe(Ut,!1,{"class":gt+"-drop "+z})),L(n)?n(Ut):qe(Ut,n),Rt.drop.fit(),Pe(de,s,In),Pe(pe,u,In),xe("enter.drop."+t,[l]),xe("enter.drop",[l]),l},Rt.drop.fit=function(t){return k=je(S),D=je(Ut),z=k.w/2-D.w/2,Z=k.h/2-D.h/2,!y(t)&&$t&&(e=Ve($t),z=e.l,Z=e.t+je($t).h),T(t)?(z=t[0],Z=t[1]):(z=E(z,0,Math.max(k.w,u.innerWidth)-D.w),Z=E(Z,0,Math.max(k.h,u.innerHeight)-D.h)),A(Ut,{left:z+Se,top:Z+Se,visibility:"visible"}),xe("fit.drop",[l]),xe("fit",[l]),l},Rt.menu=function(e,t,n,i){t=!T(t)&&n[t]&&n[t].text||t;var u,r='<span class="'+gt+'-current menu">%1</span>',o="",f=0;return t===!1?Rt.tool(e,t):(T(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+$e(Lt,[o])+'"></i>',t=y(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,r=o+(0!==t?" "+r:"")),Rt.tool(e,{i:o,text:t?$e(r,[t,o]):0,click:function(s){return Rt.drop("menu menu-"+ze(e),function(s){function a(e){return u=this,_=n[Me(u,me)],_=m(_)?Rt.tools[_]:_||{},V=nt(u),!Vt(_)&&L(i=_.click)&&(i=i(e,l),t!==!1&&$t&&(Q=ot($t)[0]||$t,st(Q,"i")||tt(Q,$e(r,[V,o])),T(_.text)&&(Z=ot(Q)[0])&&st(Z,"i")&&(Je(Z),Qe(Z,$e(Lt,[_.text[0]])))),i===!1)?Be(e):(l.select(),Be(e))}function c(e){if(u=this,($=e.TE.key)("escape"))return Rt.exit(1),Be(e);if($("arrowdown")&&(z=ft(u))){for(;!st(z,"a")&&z;)z=ft(z);return z&&z.focus(),Be(e)}if($("arrowup")&&(z=ut(u))){for(;!st(z,"a")&&z;)z=ut(z);return z&&z.focus(),Be(e)}}for(i in n)if(u=n[i],ee="%"===i[0],u=m(u)&&!ee?Rt.tools[u]:u){u=Xt(u,i,Rt.tools);var A={href:ee?null:ye,"class":gt+"-"+(ee?"label":"button")};ee?Y=mt[e]&&mt[e][+i.slice(1)-1]||i:(A.data={},A.data[me]=i,Y=Tt[i]||i),X=u.text,X=T(X)?X[1]||"":X,Y=T(Y)?Y[0]:Y,Q=qe(ee?"span":"a",ee?"<span>"+(Y||"%"+f)+"</span>":u.text||Y,d(A,u.attributes||{})),!Q.title&&(Z=u.title)&&(Q.title=T(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z),ee?Ge(Q,{id:gt+"-label:"+f}):(Vt(u)&&Qe(Q,"x"),Pe(de,Q,a),Pe(re,Q,c)),n[i]=u,pt(s,Q),++f}O(function(){lt("a",s)[0].focus()},1)}),!1}},i),Rt.tools[e].data=n,l)},Rt.bubble=function(){Rt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),z=ze(t),it(Bt),pt(F,qe(Bt,!1,{"class":gt+"-bubble "+z})),L(n)?n(Bt):qe(Bt,n),Rt.bubble.fit(),xe("enter.bubble."+t,[l]),xe("enter.bubble",[l]),l},Rt.bubble.fit=function(t){Q=l.$(1),e=Ve(Gt),W=A(Gt,"line-height");var n="border-",i="-width";z=Q.caret[0].x+e.l-Gt.scrollLeft,Z=Q.caret[1].y+e.t+W-Gt.scrollTop,D=A(Ct,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=je(Ct),o=je(Bt),f=D[0]+D[1],u=D[2]+D[3];return T(t)?(z=t[0],Z=t[1]):(z=E(z,e.l,e.l+r.w-o.w-u),Z=E(Z,e.t,e.t+r.h-o.h-f)),A(Bt,{left:z+Se,top:Z+Se,visibility:"visible"}),xe("fit.bubble",[l]),xe("fit",[l]),l},Rt.overlay.exit=function(e){return Rt.exit(e,"overlay")},Rt.modal.exit=function(e){return Rt.exit(e,"modal")},Rt.drop.exit=function(e){return Rt.exit(e,"drop")},Rt.bubble.exit=function(e){return Rt.exit(e,"bubble")},Rt.tool=function(e,t,n){return Y="","|"!==e&&(G.tools=G.tools.filter(function(t,n){return t===e?(Y=n,!1):!0})),t===!1?delete Rt.tools[e]:("|"===e?(n=t,t={}):(L(t)&&(t={click:t}),Rt.tools[e]=d(Rt.tools[e]||{},t),y(n)||""===Y||(n=Y)),g(n)?G.tools.splice(n,0,e):G.tools.push(e)),Qt(),l},Rt.key=function(e,t){return G.keys?(t===!1?delete Rt.keys[e]:Rt.keys[e]=t,Zt(),l):l},Rt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(be),!1},outdent:function(e,t){return t.outdent(be),!1}},Pe(de,Kt,gn),Rt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return gn(e)},"shift+tab":Re?"outdent":0,tab:Re?"indent":0,escape:function(e,t){return Kt.focus(),!1}},Rt.el={container:vt,header:Ft,body:Ct,footer:wt,overlay:Ht,modal:Mt,drop:Ut,bubble:Bt},l.config=G,d(l._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),u=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>u&&(u="0"+u),[""+t,""+n,""+i,""+r,""+o,""+f,""+u]},replace:Ye,format:$e,dom:{set:pt,reset:ht,get:lt,id:et,copy:function(e,t){return e.cloneNode(y(t)?t:!0)},classes:{set:Qe,reset:Je,get:Ze},attributes:{set:Ge,reset:De,get:ke},data:{set:He,reset:Ue,get:Me},is:st,offset:Ve,point:_e,size:je,content:{set:tt,reset:it,get:nt},closest:Xe,parent:rt,children:ot,next:ft,previous:ut,before:ct,after:dt,prepend:At,append:Et},el:qe,event:{set:Pe,reset:We,fire:Ke,x:Be},hooks:w,hook:{set:Ce,reset:we,fire:xe}}),Rt};