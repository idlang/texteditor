/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.5.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function We(e){return $(e)?m(e).split(/\s+/):e}function $e(e){return _(e)?e.join(" "):e}function je(e,t,o){return W(e)?W(t)?(W(b[e])||(b[e]={}),W(o)||(o=Object.keys(b[e]).length),b[e][o]=t,u):b[e]:b}function De(e,t){return W(e)?W(t)&&W(b[e])?(delete b[e][t],u):(b[e]={},u):(b={},u)}function Le(e,t,o){if(!W(b[e]))return b[e]={},u;if(W(o))W(b[e][o])&&b[e][o].apply(u,t);else for(F in b[e])b[e][F].apply(u,t);return u}function Ce(e,t,o){if(_(t))for(F in t)Ce(e,F,t[F]);else e.setAttribute(t,o)}function Me(e,o,r){if($(o))return Me(e,[o],W(r)?r:"")[0];t=[];for(F in o)F=o[F],(F=e.getAttribute(F))&&t.push(F);return t.length?t:W(r)?r:[]}function He(e,t){if(_(t))for(F in t)He(e,t[F]);else if(W(t))e.removeAttribute(t);else for(He(e,"class"),F=0,I=e.attributes,X=I.length;X>F;++F)I[F]&&He(e,I[F].name)}function Ne(e,t,o){if(_(t))for(F in t)Ne(e,F,t[F]);else Ce(e,"data-"+t,o)}function Oe(e,o,r){if($(o))return Oe(e,[o],W(r)?r:"")[0];t=[];for(F in o)F=o[F],(F=Me(e,"data-"+F))&&t.push(F);return t.length?t:W(r)?r:[]}function Be(e,t){if(_(t))for(F in t)He(e,"data-"+t[F]);else if(W(t))He(e,"data-"+t);else for(F=0,I=e.attributes,X=I.length;X>F;++F)I[F]&&"data-"===I[F].name.slice(0,5)&&He(e,I[F].name)}function Se(e){return e&&e.preventDefault(),!1}function Ye(e,t,o){if(t){for(e=We(e),F=0,I=e.length;I>F;++F)t.addEventListener(e[F],o,!1),je("on:"+e[F],o,Ve(t));return u}}function Ae(e,t,o){if(t){for(e=We(e),F=0,I=e.length;I>F;++F)t.removeEventListener(e[F],o,!1),De("on:"+e[F],Ve(t));return y(t)&&t.id.split(":")[0]===yt+"-dom"&&He(t,"id"),u}}function Fe(e,t,o){e=We(e);var n,r="createEvent"in a;for(F=0,I=e.length;I>F;++F)r?(n=a.createEvent("HTMLEvents"),n.data=o,n.initEvent(e[F],!0,!1),t.dispatchEvent(n)):Le("on:"+e[F],o,Ve(t));return u}function Ie(e,t,o){for(F=0,I=t.length,X;I>F;++F)X=t[F],e=e.replace(z(X)?X:p(g(X),"g"),o&&o[F]||"");return e}function Xe(e,t){return e.replace(/%(\d+)/g,function(e,o){return--o,W(t[o])?t[o]:e})}function qe(e){return m(Ie(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ke(e,t){var o=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,n=Pe(e);return{x:o-n.l,y:r-n.t}}function Pe(e){for(q=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)q+=e.offsetLeft,J+=e.offsetTop;return{l:q,t:J}}function Re(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Ue(e,t){for(;(e=rt(e))&&e!==t;);return e}function Ze(e,t){t=We(t);for(F in t)e.classList.add(t[F])}function Ge(e,o,r){if($(o))return Ge(e,[o],W(r)?r:"")[0];t=[];for(F in o)F=o[F],e.classList.contains(F)&&t.push(F);return t.length?t:W(r)?r:!1}function Je(e,t){if(W(t)){t=We(t);for(F in t)e.classList.remove(t[F])}else He(e,"class")}function Qe(e,t,o){if(e=$(e)?a.createElement(e):e,_(o))for(F in o)if(V=o[F],"classes"===F)Ze(e,V);else if("data"===F)for(I in V)V=V[I],null===V?Be(e,I):Ne(e,I,V);else"css"===F?$(V)?Ce(e,"style",V):null===V?He(e,"style"):l(e,V):E(V)?e[F]=V:null===V?He(e,F):Ce(e,F,_(V)?V.join(" "):""+V);if(y(t))pt(e,t);else if(_(t))for(F in t)V=t[F],y(V)?pt(e,V):V!==!1&&et(e,V);else W(t)&&t!==!1&&et(e,t);return e}function Ve(e){var t=e.id;return t||(t=yt+"-dom:"+Date.now(),e.id=t),t}function et(e,t){e.innerHTML=t}function tt(e,t){return e.innerHTML||(W(t)?t:"")}function ot(e,t){if(t!==!1&&(N=nt(e)))for(F=0,I=N.length;I>F;++F)ot(N[F]);et(e,"")}function rt(e){return e&&e.parentNode}function nt(e){return e&&e.children||[]}function it(e){return e&&e.nextSibling}function ct(e){return e&&e.previousSibling}function st(e){for(F=0;e=ct(e);)++F;return F}function at(e,t){return e&&$(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&E(t)?e===t(e):e===t}function ut(e,o){if(!(o=W(o)?o:a))return[];if(t=[],$(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=o.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=o.getElementsByClassName(e.slice(1)))||(e=o.getElementsByTagName(e))){for(F=0,I=e.length;I>F;++F)t.push(e[F]);return t}return[]}for(e=o.querySelectorAll(e),F=0,I=e.length;I>F;++F)t.push(e[F]);return t}return ft(e)?[e]:[]}function ft(e,t){var o=rt(e);return 1===arguments.length?o||!1:e&&o===e?o:!1}function lt(e,t){R=rt(e),R&&R.insertBefore(t,e)}function dt(e,t){R=rt(e),R&&R.insertBefore(t,it(e))}function gt(e,t){N=nt(e)[0],N?lt(N,t):pt(e,t)}function ht(e,t){pt(e,t)}function pt(e,t){e.appendChild(t)}function wt(e,t){var o=ft(e);if(o){if(t!==!1)for(N=nt(e)[0];N;)wt(N);o.removeChild(e)}}function vt(e){ot(Qe(e,!1,{style:""})),wt(e)}function mt(e,t,o){return Qe(t||"div",o,{"class":e})}function Kt(e){return!e||W(e.active)&&!e.active}function Pt(e,t,o){return E(e)&&(e={click:e}),$(e.click)&&(e.click=(o[e.click]||{}).click),W(e.title)||(e.title=Et[t]||""),W(e.attributes)||(e.attributes={}),o[t]=e,e}function Rt(e){bt.exit(0,0,0);var t=Oe(this,"tool-id"),o=bt.tools,r=o[t];return bt.drop.target=e.currentTarget||e.target,!Kt(r)&&E(I=r.click)&&(I=I(e,u,t),Le("on:change",[e,u,t]),I===!1)?Se(e):(u.select(),Se(e))}function Ut(e){if(J=this,(X=e.TE.key)(/^(escape|f10)$/))bt.exit(1);else if(X("enter")||X("arrowdown")&&Oe(J,"ui-drop"))bt.drop.target=J,Fe(ie,J,[e]);else if(X("arrowright")&&(q=it(J))){for(;!at(q,"a")&&q;)q=it(q);q&&q.focus()}else if(X("arrowleft")&&(q=ct(J))){for(;!at(q,"a")&&q;)q=ct(q);q&&q.focus()}return Se(e)}function Zt(){ot(Lt,!1);var r,n,i,c,s,a,f,e=We(C.tools),t=yt+"-button",o=yt+"-separator";C.tools=e;for(a in e)f=e[a],n=bt.tools[f],(n||n==={})&&(n=Pt(n,f,bt.tools),i=n.i||f,"|"!==i&&"<"!==i[0]&&(i=qe(i)),c="|"!==i,s=qe(i).replace(/\s/g,""),Xt=mt(c?t+" "+t+"-"+s:o+" "+o+"-"+a,c?"a":"span"),c?(Xt=n.target||Xt,r=t+":"+s,Ce(Xt,{href:_e,id:r,tabindex:-1}),Ne(Xt,"tool-id",f),i="<"===i[0]?i:'<i class="'+Xe(kt,[i])+'"></i>',Kt(n)&&Ze(Xt,"x"),n.text&&(i=Xe('<span class="'+yt+'-text">'+n.text+"</span>",[i]),Ze(Xt,"text")),et(Xt,i),Qe(Xt,!1,n.attributes),!n.attributes.title&&(I=n.title)&&(Xt.title=_(I)?I[0]+(I[1]?" ("+I[1]+")":""):I),Ye(ie,Xt,Rt),Ye(fe,Xt,Ut)):Xt.id=o+":"+a,n.target=Xt,pt(Lt,Xt));Le("update.tools",[u])}function Gt(){bt.keys=function(){var o,e=Object.keys(bt.keys).sort().reverse(),t={};for(F=0,I=e.length;I>F;++F)o=e[F],t[o]=bt.keys[o];return t}(),eo(),Le("update.keys",[u])}function Vt(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var o=u.$(),r=o.before,n=o.after,i=r.slice(-1),c=n[0],s=o.length,a=bt.keys,f=TE.keys_alias,l=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();P=e.TE.key(),Jt[P]=1,t=Object.keys(Jt).length,v(function(){u.record()});for(F in a){X=d(F),N=0;for(I in X)I=X[I],Jt[f[I]||I]&&++N;if(X=X.length,N===X&&t===X&&($(a[F])&&(a[F]=bt.tools[a[F]].click),q=a[F]&&a[F](e,u),q===!1))return Se(e)}if(ve)for(F in ve)if(K=ve[F],K!==!1){if(P===K&&c===K)return"\\"===i?(u.insert(P,0),Se(e)):(u.select(o.end+1),Se(e));if(F===P)return u.wrap(F,K),Se(e);if(i===F&&c===K){if("backspace"===P&&r.slice(-2)!=="\\"+F)return u.unwrap(F,K),Se(e);if(me&&"enter"===P&&F!==K)return u.tidy("\n"+l+xe,"\n"+l),Se(e)}}if(me&&!s){if("backspace"===P&&p(g(xe)+"$").test(r))return u.outdent(xe),Se(e);if("enter"===P&&p("(^|\\n)("+g(xe)+")+.*$").test(r))return u.insert("\n"+l,0,1),Se(e)}}function eo(e){e&&e.TE&&e.TE.key?delete Jt[e.TE.key()]:Jt={}}function io(e){return to=Mt,G=Re(Dt),Se(e)}function co(e){to===Mt&&l(Ct,{height:Ke(jt,e).y-G.h+ze})}function so(){to=0}function ao(){bt.exit(1)}function uo(){t=Re(Bt),ee=t.w,A=t.h,t=Re(Ot),oo=t.w,ro=t.h}function fo(e,t){t&&Le("exit.modal."+t,[u]),Fe(ie,Ot,[e])}function lo(e){to=e.target,t=Ke(Bt,e),te=t.x,oe=t.y,uo()}function go(e){var o=no.header,r=no.resize;to===o||Ue(to,o)===o?(t=Ke(jt,e),q=t.x-te,J=t.y-oe,l(Bt,{left:(ee>oo?q:d(q,0,oo-ee))+ze,top:(A>ro?J:d(J,0,ro-A))+ze})):to===r&&(t=Ke(Bt,e),G=Re(r),l(Bt,{width:t.x+G.w/4+ze,height:t.y+G.h/4+ze}))}function ho(){to=0}function po(e,t,o){return{header:e,body:t,footer:o}}function wo(t){M=bt.drop.target,H=St,N=t&&t.target||0,(!N||N!==M&&Ue(N,M)!==M)&&(bt.drop.target=0,vt(St),Ae(ie,a,wo),Ae(we,s,wo),bt.exit(t.target===e))}var M,H,N,S,A,F,I,X,q,K,P,t,R,Z,G,J,V,ee,te,oe,o="⌘",r="…",i="⇥",c="⇧",s=window,a=document,u=new TE(e),f=u._,l=f.css,d=f.edge,g=f.x,h=f.extend,p=f.pattern,v=(f.timer.reset,f.timer.set),m=f.trim,b={},x=function(){},k=TE.is,y=k.e,E=k.f,T=k.i,_=k.o,z=k.r,W=function(e){return!k.x(e)},$=k.s,j=a.documentElement,L=(a.head,a.body),C=h({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",o+"+Z"],redo:["Redo",o+"+Y"],indent:["Indent",i],outdent:["Outdent",c+"+"+i]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},labels:{},others:{}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"}},t),ne="blur",ie="click",fe="keydown",le="keyup",de="touchstart mousedown",ge="touchmove mousemove",he="touchend mouseup",we="orientationchange resize",ve=C.auto_close,me=C.auto_tab,be=C.languages,xe=C.tab,ye=(C.unit[0][1],C.unit[0][0]),Ee=C.unit[1][1],Te=C.unit[1][0],_e="javascript:;",ze="px",bt=u.ui={};u.tidy=function(e,t){var o=u.$(),r=m(o.before)?e:"",n=m(o.after)?W(t)?t:e:"";return u.trim(r,n)},u.i=function(){return m(u.replace(/\s+/g," "))},u.format=function(e,t,o,r){_(e)||(e=[e]),W(o)||(o=" "),W(r)||(r="");var n=u.h,i=u[0]().$(),c=(e[0]?ye[0]+e[0]+ye[1]:"")+r,s=r+(e[0]?ye[0]+ye[2]+(e[1]||e[0].split(p("("+Ee[3]+")+"))[0])+ye[1]:""),a=g(c),f=g(s),l=p("^"+a+"([\\s\\S]*?)"+f+"$"),d=p(a+"$"),h=p("^"+f),w=i.before,v=i.after;return i.length?o=!1:u.insert(be.placeholders[""]),u.toggle(t?!l.test(i.value):!d.test(w)&&!h.test(v),[function(e){e.unwrap(c,s,1).tidy(p(Te[0]+"[^"+Te[0]+Te[1]+Te[2]+"]+?"+Te[1]+"$").test(w)?"":o,p("^"+Te[0]+Te[2]+"[^"+Te[0]+Te[1]+"]+?"+Te[1]).test(v)?"":o).wrap(c,s,t)},function(e){e.unwrap(c,s,t)}])[n]()};var Xt,xt=C.classes,kt=xt.i,yt=xt[""],Et=be.tools,Tt=be.buttons,_t=be.labels,zt=yt+"-textarea "+yt+"-content block",Wt=mt(yt),$t=mt(yt+"-header"),jt=mt(yt+"-body"),Dt=mt(yt+"-footer"),Lt=mt(yt+"-tool"),Ct=Qe(e,!1,C.attributes),Mt=mt(yt+"-resize s"),Ht=mt(yt+"-description"),Nt=mt(yt+"-panel"),Ot=mt(yt+"-overlay"),Bt=Qe("div"),St=Qe("div"),Yt=Qe("div"),At=mt("left","span"),Ft=mt("right","span"),It=0;W(C.suffix)||(C.suffix=ye[1]);var Jt={},to=0,te=0,oe=0,ee=0,A=0,oo=0,ro=0,no={};u.create=function(e,t){_(e)&&(C=h(C,e));var o=ft(Ct);return Ze(Ct,zt),o&&at(o,"p")?(lt(o,Wt),It=o,wt(o,!1)):lt(Ct,Wt),Wt.dir=C.dir,pt(Wt,$t),pt(Wt,jt),pt(Wt,Dt),pt(jt,Ct),C.tools&&(pt($t,Lt),pt(Dt,Ht),pt(Ht,At),pt(Ht,Ft)),Ye(fe,Ct,Vt),Ye(le+" "+ne,Ct,eo),C.resize&&(pt(Wt,Mt),Ze(Wt,yt+"-is-can-resize"),Ye(de,Mt,io),Ye(ge,a,co),Ye(he,L,so)),Zt(),Gt(),0!==t?Le("create",[u]):u},u.update=function(e,t){return Ge(Ct,We(zt),0)&&u.destroy(0),(0!==t?Le("update",[u]):u).create(e,0)},u.destroy=function(e){return Ge(Ct,We(zt),0)?(bt.exit(0,0,0),Je(Ct,zt),C.tools=$e(C.tools),C.keys&&(Ae(fe,Ct,Vt),Ae(le,Ct,eo)),C.resize&&(Ae(de,Mt,io),Ae(ge,a,co),Ae(he,a,so)),It?(lt(Wt,It),pt(It,Ct),It=0):lt(Wt,Ct),vt(Wt),0!==e?Le("destroy",[u]):u):u},bt.exit=function(e,t,o){if(S={panel:function(){vt(Nt)},overlay:function(){Ae(ie,Ot,ao),vt(Ot)},modal:function(){Ae(de,jt,lo),Ae(ge,jt,go),Ae(he,a,ho),Ae(ie,no.x,fo),vt(Bt)},drop:function(){vt(St)},bubble:function(){vt(Yt)}},t)if(_(t))for(F in t)F=t[F],S[F]&&S[F](),0!==o&&Le("exit."+F,[u]);else S[t]&&S[t](),0!==o&&Le("exit."+F,[u]);else for(F in S)S[F]();return e&&u.select(),0!==o&&Le("exit",[u]),u},bt.panel=function(e,t){function o(){Ae(ie,te,o),bt.panel.exit(1)}return bt.exit(0,0,0),eo(),te=mt(yt+"-x"),te.title=Tt.close,Ye(ie,te,o),pt(jt,Qe(Nt,[mt(yt+"-panel-content","div",e),te])),E(t)?t(Nt):Qe(Nt,t),Le("enter.panel",[u]),Le("enter",[u]),u},bt.panel.fit=function(){},bt.overlay=function(e,t){return bt.exit(0,0,0),eo(),pt(jt,Ot),e&&Ye(ie,Ot,ao),E(t)?t(Ot):Qe(Ot,t),Le("enter.overlay",[u]),Le("enter",[u]),u},bt.overlay.fit=function(){},bt.modal=function(){bt.overlay(1).blur();var c,s,e=arguments,t=e[0],o=e[1],r=e[2],n=yt+"-modal",i=o.footer;if(_(t)&&(t="default",o=e[0],r=e[1]),q=qe(t),Qe(Bt,!1,{"class":n+" "+q}),W(o.body)&&(o.body=Qe("div",o.body,{"class":n+"-content "+q})),W(i)&&_(i)&&!y(i)){s=[];for(F in i)I=i[F],y(I)?s.push(I):(I=Pt(I,F,i),t=F.text||Tt[F]||F,c=Qe("button",t,h({name:"y["+F+"]",type:"button","class":yt+"-button",data:{"button-id":F}},I.attributes)),Ye(ie,c,function(e){return t=i[Oe(this,"button-id")].click(e,u),t===!1?Se(e):void 0}),s.push(c));o.footer=s}for(F in o)n[1]=F,no[F]=mt(n+"-"+Xe(F,n)+" "+q,0,o[F]);return no.x=mt(yt+"-x "+q),no.resize=mt(yt+"-resize se "+q),ot(Bt),no.x.title=Tt.close,pt(jt,Qe(Bt,no,{style:""})),bt.modal.fit(),dt(Bt,Ot),Ye(ie,no.x,fo),Ye(de,no.header,Se),Ye(de,no.resize,Se),Ye(de,jt,lo),Ye(ge,jt,go),Ye(he,a,ho),E(r)&&(no.overlay=Ot,no.modal=Bt,r(no)),Le("enter.modal."+t,[u]),Le("enter.modal",[u]),Le("enter",[u]),u},bt.modal.fit=function(e){return uo(),q=oo/2-ee/2,J=ro/2-A/2,_(e)?(W(e[0])&&(q=e[0]),W(e[1])&&(J=e[1])):(q=d(q,0),J=d(J,0)),l(Bt,{left:q+ze,top:J+ze,"min-width":ee+ze,"min-height":A+ze,visibility:"visible"}),Le("fit.modal",[u]),Le("fit",[u]),u};var vo={"class":yt+"-button",name:"y"};return bt.alert=function(e,t,o,r){var n=Qe("button",Tt.okay,vo),i="alert";return o=o||x,_(e)&&(i+=":"+e[0],e=e[1]||e[0]),Ye(ie,n,function(e){return o(e,u),fo(e,i+".y"),Se(e)}),Ye(fe,n,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(Fe(ie,n,[e]),Se(e)):void 0}),bt.modal(i,po(e,t,n),r),n.focus(),u},bt.confirm=function(e,t,o,r,n){function f(e){return E(o)&&o(e,u),fo(e,s+".y"),Se(e)}function l(e){return E(r)&&r(e,u),fo(e,s+".n"),Se(e)}var a,i=Qe("button",Tt.okay,vo),c=Qe("button",Tt.cancel,vo),s="confirm";return c.name="n",_(e)&&(s+=":"+e[0],e=e[1]||e[0]),Ye(ie,i,f),Ye(ie,c,l),Ye(fe,i,function(e){return a=e.TE.key,a("arrowright")?(c.focus(),Se(e)):a("arrowleft")?Se(e):a("enter")?(f(e),Se(e)):a("escape")?(fo(e,s+".y"),Se(e)):void 0}),Ye(fe,c,function(e){return a=e.TE.key,a("arrowright")?Se(e):a("arrowleft")?(i.focus(),Se(e)):a("enter")?(l(e),Se(e)):a("escape")?(fo(e,s+".n"),Se(e)):void 0}),bt.modal(s,po(e,t,[i,c]),n),c.focus(),u},bt.prompt=function(e,t,o,r,n,i){function h(){a.focus(),"placeholder"in a&&a.select()}function p(e){return Se(e)}function w(e){return d=a.value,!o||m(d)&&d!==t?(fo(e,f+".y"),Se(e),r(e,u,d!==t?d:"",t)):(h(),p(e))}function v(e){return fo(e,f+".n"),Se(e)}var d,g,c=Qe("button",Tt.okay,vo),s=Qe("button",Tt.cancel,vo),a=Qe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":yt+"-input block"}),f="prompt",l=[];if(_(e)&&(f+=":"+e[0],e=e[1]||e[0]),E(n)&&(i=n,n=0),1===n)a=Qe("textarea",t,{placeholder:t.split("\n")[0],"class":yt+"-textarea block"});else if(2===n){for(F in t)l.push(Qe("option",t[F],{value:F,selected:F===o||null}));a=Qe("select",l,{"class":yt+"-select block"})}return r=r||x,a.name="data",s.name="n",Ye(fe,a,function(e){return g=e.TE.key,g("enter")?w(e):g("escape")||g("backspace")&&!this.value?v(e):g("arrowup")?p(e):g("arrowdown")?(c.focus(),Se(e)):void 0}),Ye(fe,c,function(e){return g=e.TE.key,g("enter")?w(e):g("escape")?v(e):g("arrowup")?(a.focus(),Se(e)):g("arrowright")?(s.focus(),Se(e)):g(/^arrow(down|left)$/)?p(e):void 0}),Ye(fe,s,function(e){return g=e.TE.key,g(/^(enter|escape)$/)?v(e):g("arrowup")?(a.focus(),Se(e)):g(/^arrow(right|down)$/)?p(e):g("arrowleft")?(c.focus(),Se(e)):void 0}),Ye(ie,c,w),Ye(ie,s,v),bt.modal(f,po(e,a,[c,s]),i),h(),u},bt.drop=function(){bt.exit(0,0,0);var e=arguments,t=e[0],o=e[1];return 1===e.length&&(t="default",o=e[0]),q=qe(t),ot(St),pt(L,Qe(St,!1,{"class":yt+"-drop "+q})),E(o)?o(St):Qe(St,o),bt.drop.fit(),Ye(ie,a,wo),Ye(we,s,wo),Le("enter.drop."+t,[u]),Le("enter.drop",[u]),u},bt.drop.fit=function(e){return M=Re(j),H=Re(St),N=bt.drop.target,q=M.w/2-H.w/2,J=M.h/2-H.h/2,!W(e)&&N&&(t=Pe(N),q=t.l,J=t.t+Re(N).h),_(e)?(W(e[0])&&(q=e[0]),W(e[1])&&(J=e[1])):(q=d(q,0,Math.max(M.w,s.innerWidth)-H.w),J=d(J,0,Math.max(M.h,s.innerHeight)-H.h)),l(St,{left:q+ze,top:J+ze,visibility:"visible"}),Le("fit.drop",[u]),Le("fit",[u]),u},bt.menu=function(e,t,o,r){t=!_(t)&&o[t]&&o[t].text||t;var a,n=bt.tools,i='<span class="'+yt+'-current menu">%1</span>',c="",s=0;return t===!1?bt.tool(e,t):(_(t)&&(c=t[0],c="<"===c[0]?c:'<i class="'+Xe(kt,[c])+'"></i>',t=W(t[1])?t[1]:0,t=t&&o[t]&&o[t].text||t,i=c+(0!==t?" "+i:"")),bt.tool(e,{i:c,text:t?Xe(i,[t,c]):0,click:function(f){var l=bt.drop.target=n[e].target;return bt.drop("menu menu-"+qe(e),function(f){function d(e){return J=this,K=o[Oe(J,"tool-id")],K=$(K)?n[K]:K||{},P=tt(J),!Kt(K)&&E(r=K.click)&&(r=r(e,u),t!==!1&&l&&(N=nt(l)[0]||l,at(N,"i")||et(N,Xe(i,[P,c])),_(K.text)&&(N=nt(N)[0])&&at(N,"i")&&(Je(N),Ze(N,Xe(kt,[K.text[0]])))),r===!1)?Se(e):(u.select(),Se(e))}function g(e){if(J=this,(X=e.TE.key)("escape"))bt.exit(1);else if(X("enter"))Fe(ie,J,[e]);else if(X("f10")&&l)l.focus();else if(X("arrowdown")&&(q=it(J))){for(;!at(q,"a")&&q;)q=it(q);q&&q.focus()}else if(X("arrowup")&&(q=ct(J))){for(;!at(q,"a")&&q;)q=ct(q);!q&&l?(bt.exit(),l.focus()):q&&q.focus()}else X("arrowup")&&l&&(bt.exit(),l.focus());return Se(e)}for(r in o)if(a=o[r],ee="%"===r[0],a=$(a)&&!ee?n[a]:a){a=Pt(a,r,n);var p={href:ee?null:_e,"class":yt+"-"+(ee?"label":"button")};ee?I=_t[e]&&_t[e][+r.slice(1)-1]||r:(p.data={},p.data["tool-id"]=r,I=Et[r]||r),Z=a.text,Z=_(Z)?Z[1]||"":Z,I=_(I)?I[0]:I,G=Qe(ee?"span":"a",ee?"<span>"+(I||"%"+s)+"</span>":a.text||I,h(p,a.attributes||{})),!p.title&&(J=a.title)&&(G.title=_(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),ee?Ce(G,{id:yt+"-label:"+s}):(Kt(a)&&Ze(G,"x"),Ye(ie,G,d),Ye(fe,G,g)),o[r]=a,pt(f,G),++s}v(function(){ut("a",f)[0].focus()},1)}),!1}},r),Ne(n[e].target,"ui-drop",e),n[e].data=o,u)},bt.bubble=function(){bt.exit(0,0,0);var e=arguments,t=e[0],o=e[1];return 1===e.length&&(t="default",o=e[0]),q=qe(t),ot(Yt),pt(L,Qe(Yt,!1,{"class":yt+"-bubble "+q})),E(o)?o(Yt):Qe(Yt,o),bt.bubble.fit(),Le("enter.bubble."+t,[u]),Le("enter.bubble",[u]),u},bt.bubble.fit=function(e){G=u.$(1),t=Pe(Ct),A=l(Ct,"line-height");var o="border-",r="-width";q=G.caret[0].x+t.l-Ct.scrollLeft,J=G.caret[1].y+t.t+A-Ct.scrollTop,H=l(jt,[o+"top"+r,o+"bottom"+r,o+"left"+r,o+"right"+r]);var n=Re(jt),i=Re(Yt),c=H[0]+H[1],s=H[2]+H[3];return _(e)?(W(e[0])&&(q=e[0]),W(e[1])&&(J=e[1])):(q=d(q,t.l,t.l+n.w-i.w-s),J=d(J,t.t,t.t+n.h-i.h-c)),l(Yt,{left:q+ze,top:J+ze,visibility:"visible"}),Le("fit.bubble",[u]),Le("fit",[u]),u},bt.panel.exit=function(e){return bt.exit(e,"panel")},bt.overlay.exit=function(e){return bt.exit(e,"overlay")},bt.modal.exit=function(e){return bt.exit(e,"modal")},bt.drop.exit=function(e){return bt.exit(e,"drop")},bt.bubble.exit=function(e){return bt.exit(e,"bubble")},bt.tool=function(e,t,o){return I="","|"!==e&&(C.tools=We(C.tools).filter(function(t,o){return t===e?(I=o,!1):!0})),t===!1?delete bt.tools[e]:("|"===e?(o=t,t={}):(E(t)&&(t={click:t}),bt.tools[e]=h(bt.tools[e]||{},t),W(o)||""===I||(o=I)),T(o)?C.tools.splice(o,0,e):C.tools.push(e)),Zt(),u},bt.key=function(e,t){return C.keys?(t===!1?delete bt.keys[e]:bt.keys[e]=t,Gt(),u):u},bt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(xe),!1},outdent:function(e,t){return t.outdent(xe),!1}},bt.keys={"control+y":"redo","control+z":"undo",f10:function(e,t){return ut("a",Lt)[0].focus(),!1},"shift+tab":me?"outdent":0,tab:me?"indent":0},bt.el={container:Wt,header:$t,body:jt,footer:Dt,overlay:Ot,modal:Bt,drop:St,bubble:Yt},u.config=C,h(TE._,{time:function(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,r=e.getDate(),n=e.getHours(),i=e.getMinutes(),c=e.getSeconds(),s=e.getMilliseconds();return 10>o&&(o="0"+o),10>r&&(r="0"+r),10>n&&(n="0"+n),10>i&&(i="0"+i),10>c&&(c="0"+c),10>s&&(s="0"+s),[""+t,""+o,""+r,""+n,""+i,""+c,""+s]},replace:Ie,format:Xe,dom:{set:pt,reset:wt,get:ut,id:Ve,copy:function(e,t){return e.cloneNode(W(t)?t:!0)},classes:{set:Ze,reset:Je,get:Ge},attributes:{set:Ce,reset:He,get:Me},data:{set:Ne,reset:Be,get:Oe},is:at,offset:Pe,pointer:Ke,size:Re,content:{set:et,reset:ot,get:tt},closest:Ue,parent:rt,children:nt,next:it,previous:ct,index:st,before:lt,after:dt,prepend:gt,append:ht},el:Qe,event:{set:Ye,reset:Ae,fire:Fe,x:Se}}),h(u._,TE._),h(u._,{hooks:b,hook:{set:je,reset:De,fire:Le}}),u.create()};