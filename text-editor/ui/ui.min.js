/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function te(e,t,n){return E(e)?E(t)?(E(_[e])||(_[e]={}),E(n)||(n=Object.keys(_[e]).length),_[e][n]=t,u):_[e]:_}function ne(e,t){return E(e)?E(t)&&E(_[e])?(delete _[e][t],u):(_[e]={},u):(_={},u)}function ie(e,t,n){if(!E(_[e]))return _[e]={},u;if(E(n))E(_[e][n])&&_[e][n].apply(u,t);else for(var i in _[e])_[e][i].apply(u,t);return u}function re(e,t,n){if(x(t))for(var i in t)re(e,i,t[i]);else e.setAttribute(t,n)}function oe(e,t,n){return e.getAttribute(t)||(E(n)?n:!1)}function fe(e,t){if(x(t))for(var n in t)fe(e,t[n]);else e.removeAttribute(t)}function le(e,t,n){if(x(t))for(var i in t)re(e,"data-"+i,t[i]);else re(e,"data-"+t,n)}function ue(e,t,n){return oe(e,"data-"+t,n)}function se(e,t){if(x(t))for(var n in t)fe(e,"data-"+t[n]);else fe(e,"data-"+t)}function ae(e){return e&&e.preventDefault(),!1}function ce(e,t,n){return t?(t.addEventListener(e,n,!1),te("on:"+e,n,Ve(t)),u):void 0}function de(e,t,n){return t?(t.removeEventListener(e,n,!1),ne("on:"+e,Ve(t)),m(t)&&t.id.split(":")[0]===Le+"-dom"&&fe(t,"id"),u):void 0}function pe(e,t,n){if("createEvent"in l){var i=l.createEvent("HTMLEvents");i.data=n,i.initEvent(e,!0,!1),t.dispatchEvent(i)}else ie("on:"+e,n,Ve(t));return u}function ve(e,t,n){e=h(e).split(/\s+/);for(var i=0,r=e.length;r>i;++i)ce(e[i],t,n);return u}function he(e,t,n){e=h(e).split(/\s+/);for(var i=0,r=e.length;r>i;++i)de(e[i],t,n);return u}function be(e,t,n){e=h(e).split(/\s+/);for(var i=0,r=e.length;r>i;++i)pe(e[i],t,n);return u}function me(e,t){return setTimeout(e,t)}function ge(e){return clearTimeout(e)}function ye(e,t,n){for(var o,i=0,r=t.length;r>i;++i)o=t[i],e=e.replace(w(o)?o:v(a(o),"g"),n&&n[i]||"");return e}function xe(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,E(t[n])?t[n]:e})}function we(e){return h(ye(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function ke(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ee(e);return{x:n-r.l,y:i-r.t}}function Ee(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{l:t,t:n}}function ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Te(e,t){for(;(e=ft(e))&&e!==t;);return e}function Qe(e,t,n){if(e=k(e)?l.createElement(e):e,x(n)){var i,r;for(r in n)i=n[r],"style"===r?k(i)?re(e,r,i):null===i?fe(e,r):e=d(e,i):g(i)?e[r]=i:null===i?fe(e,r):re(e,r,x(i)?i.join(" "):""+i)}if(m(t))bt(e,t);else if(x(t)){var i,r;for(r in t)i=t[r],m(i)?bt(e,i):i!==!1&&it(e,i)}else E(t)&&t!==!1&&it(e,t);return e}function Ve(e){var t=e.id;return t||(t=Le+"-dom:"+Date.now(),e.id=t),t}function et(e,t){tt(e,t,0)||(e.className=h(e.className+" "+(x(t)?t.join(" "):t)))}function tt(e,t,n){var i=e.className;return v("(^|\\s)"+t+"(\\s|$)").test(i)?i.split(/\s+/):E(n)?n:[]}function nt(e,t){e.className=h(e.className.replace(v("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function it(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(E(t)?t:"")}function ot(e,t){if(t!==!1){var i,n=e.children;for(i in n)ot(n[i])}it(e,"")}function ft(e){return e.parentElement||e.parentNode}function lt(e){return e.children||[]}function ut(e){return e.nextElementSibling||e.nextSibling}function st(e){return e.previousElementSibling||e.previousSibling}function at(e,t){return(t||l).querySelectorAll(e)||[]}function ct(e,t){var n=ft(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function dt(e,t){ft(e).insertBefore(t,e)}function pt(e,t){ft(e).insertBefore(t,ut(e))}function vt(e,t){var n=lt(e)[0];n?dt(n,t):bt(e,t)}function ht(e,t){bt(e,t)}function bt(e,t){e.appendChild(t)}function mt(e,t){var n=ct(e);if(n){if(t!==!1)for(var i=lt(e)[0];i;)mt(i);n.removeChild(e)}}function gt(e){ot(Qe(e,!1,{style:""})),mt(e)}function yt(e,t,n){return Qe(t||"div",n,{"class":e})}function xt(){if(Oe._word&&Oe._words){var e=(Pe.value||"").replace(v(J[0]+"[^"+J[0]+J[1]+"]+?"+J[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;it(Ue,xe(Oe["_word"+(1===t?"":"s")],[t]))}}function wt(e,t){g(e)&&(e.click=e),k(e.click)&&(e.click=($e.tools[e.click]||{}).click),E(e.active)||(e.active=1),E(e.title)||(e.title=Se[t]||"")}function kt(){ot(He,!1);var i,r,o,f,l,s,a,e=k(S.tools)?h(S.tools).split(/\s+/):S.tools,t=Le+"-button",n=Le+"-separator";S.tools=e;for(l in e)a=e[l],r=$e.tools[a],r&&(wt(r,a),"|"!==(o=r.i||a)&&(o=we(o)),f="|"!==o,Je=yt(f?t:n,f?"a":"span"),f&&(i=t+":"+we(a).replace(/\s/g,""),re(Je,{href:V,id:i,"tab-index":-1}),le(Je,Q,a),o='<i class="'+xe(_e.i,[o])+" "+i+'"></i>',r.active||et(Je,"x"),r.text&&(o=xe('<span class="'+Le+'-text">'+r.text+"</span>",[o]),et(Je,"text")),it(Je,o),Qe(Je,!1,r.attributes||{}),!Je.title&&(s=r.title)&&(Je.title=x(s)?s[0]+(s[1]?" ("+s[1]+")":""):s),ve(P,Je,Dt)),bt(He,Je));ie("update.tools",[u])}function Et(){$e.keys=function(){var n,i,e=Object.keys($e.keys).sort().reverse(),t={};for(n=0,i=e.length;i>n;++n)t[e[n]]=$e.keys[e[n]];return t}(),Lt(1),ie("update.keys",[u])}function zt(e){xt(),ie("on:change",[e,u])}function _t(e){function x(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var d,p,h,b,m,y,t=u.$(),n=t.before,i=t.after,r=n.slice(-1),o=i[0],f=t.length,l=$e.keys,s=TE.keys_alias,c=(n.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),g=e.TE.key();Tt[g]=1,y=Object.keys(Tt).length,me(function(){u.record()},1);for(d in l){var w=0;h=x(d);for(p in h)p=h[p],Tt[s[p]||p]&&++w;if(h=h.length,w===h&&y===h&&(k(l[d])&&(l[d]=$e.tools[l[d]].click),b=l[d]&&l[d](e,u),b===!1))return ae(e)}if(X)for(d in X)if(m=X[d],m!==!1){if(g===m&&o===m)return"\\"===r?(u.insert(g,0),ae(e)):(u.select(t.end+1),ae(e));if(d===g)return u.wrap(d,m),ae(e);if(r===d&&o===m){if("backspace"===g&&n.slice(-2)!=="\\"+d)return u.unwrap(d,m),ae(e);if(U&&"enter"===g&&d!==m)return u.tidy("\n"+c+R,"\n"+c).scroll(!0),ae(e)}}if(U&&!f){if("backspace"===g&&v(a(R)+"$").test(n))return u.outdent(R).scroll(!0),ae(e);if("enter"===g&&v("(^|\\n)("+a(R)+")+.*$").test(n))return u.insert("\n"+c,0,1).scroll(!0),ae(e)}}function Lt(e){x(e)?delete Tt[e.TE.key()]:Tt={}}function St(e){/^focus|blur$/.test(e.type)&&Lt(1),ge($t),$t=me(function(){zt(e)},S.debounce||0)}function Dt(e){$e.exit(0,0,0);var r,t=ue(this,Q),n=$e.tools,i=n[t];return Ze=e.currentTarget||e.target,i&&i.active&&i.click&&(r=n[t].click(e,u,t),ie("on:change",[e,u,t]),r===!1)?ae(e):(u.select(),ae(e))}function Wt(e){return Ot=Fe,Ft=ze(Ye),ae(e)}function At(e){Ot===Fe&&d(Pe,{height:ke(je,e).y-Ft.h+ee})}function It(){Ot=0}function qt(){$e.exit(1)}function Bt(){e=ze(Ie),Ct=e.w,jt=e.h,e=ze(Ae),Yt=e.w,Ht=e.h}function Rt(e,t){t&&ie("exit.modal."+t,[u]),be(P,Ae,[e])}function Ut(t){Ot=t.target,e=ke(Ie,t),Nt=e.x,Mt=e.y,Bt()}function Xt(t){var r,o,n=Pt.header,i=Pt.resize;Ot===n||Te(Ot,n)===n?(e=ke(je,t),r=e.x-Nt,o=e.y-Mt,d(Ie,{left:(Ct>Yt?r:p(r,0,Yt-Ct))+ee,top:(jt>Ht?o:p(o,0,Ht-jt))+ee})):Ot===i&&(e=ke(Ie,t),Ft=ze(i),d(Ie,{width:e.x+Ft.w/4+ee,height:e.y+Ft.h/4+ee}))}function Kt(){Ot=0}function Zt(e,t,n){return{header:e,body:t,footer:n}}function Jt(e){var t=Ze,i=e&&e.target||0;(!i||i!==t&&Te(i,t)!==t)&&(Ze=0,gt(qe),he(P,$,Jt),$e.exit(1))}function Qt(e){function l(){r&&(o=ze(r),d(i,{width:o.w+ee,height:o.h+ee}))}var i,r,o,t=u.get(),n="";return-1===t.indexOf("</html>")&&(n='<!DOCTYPE html><html dir="'+S.dir+'"><head><meta charset="utf-8"><style>'+S.css+"</style></head><body>"+t+"</body></html>"),i=Qe("iframe",!1,{"class":Le+"-portal",src:"data:text/html,"+encodeURIComponent(n)}),!ct(Ae)&&t?$e.overlay(i,1,function(){r=lt(Ae)[0],l(),ve(I,f,l),ie("enter.overlay.preview",[e,u,[t,n],r])}):(he(I,f,l),qt()),ae(e)}var t="⌘",n="…",r="⇥",o="⇧",f=window,l=document,u=this,s=u._,a=s.x,c=s.extend,d=s.css,p=s.edge,v=s.pattern,h=s.trim,b=u.is,m=b.e,g=b.f,y=b.i,x=b.o,w=b.r,k=b.s,E=function(e){return!b.x(e)},z=l.documentElement,$=(l.head,l.body),_={},L=function(){},S=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",r],outdent:["Outdent",o+"+"+r],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),D="keydown",O="keyup",N="copy",M="cut",C="paste",j="touchstart mousedown",Y="touchend mouseup",H="touchmove mousemove",P="click",F="focus",W="blur",A="input",I="orientationchange resize",q=W+" "+N+" "+M+" "+F+" "+A+" "+D+" "+C,B=S.languages,R=S.tab,U=S.auto_tab,X=S.auto_close,K=S.unit[0][0],J=(S.unit[0][1],S.unit[1][0]),G=S.unit[1][1],Q="tool-id",V="javascript:;",ee="px",$e=u.ui={};u.tidy=function(e,t){var n=u.$(),i=h(n.before)?e:"",r=h(n.after)?E(t)?t:e:"";return u.trim(i,r)},u.i=function(){return h(u.replace(/\s+/g," "))},u.format=function(e,t,n,i){x(e)||(e=[e]),E(n)||(n=" "),E(i)||(i="");var r=u[0]().$(),o=(e[0]?K[0]+e[0]+K[1]:"")+i,f=i+(e[0]?K[0]+K[2]+(e[1]||e[0].split(v("("+G[3]+")+"))[0])+K[1]:""),l=a(o),s=a(f),c=v("^"+l+"([\\s\\S]*?)"+s+"$"),d=v(l+"$"),p=v("^"+s),h=r.before,b=r.after;return r.length?n=!1:u.insert(B.placeholders[""]),u.toggle(t?!c.test(r.value):!d.test(h)&&!p.test(b),[function(e){e.unwrap(o,f,1).tidy(v(J[0]+"[^"+J[0]+J[1]+J[2]+"]+?"+J[1]+"$").test(h)?"":n,v("^"+J[0]+J[2]+"[^"+J[0]+J[1]+"]+?"+J[1]).test(b)?"":n).wrap(o,f,t)[1]()},function(e){e.unwrap(o,f,t)[1]()}])};var Je,_e=S.classes,Le=_e[""],Se=B.tools,De=B.buttons,Oe=B.others,Ne=Le+"-textarea "+Le+"-content block",Me=yt(Le),Ce=yt(Le+"-header"),je=yt(Le+"-body"),Ye=yt(Le+"-footer"),He=yt(Le+"-tool"),Pe=Qe(u.target,!1,S.attributes),Fe=yt(Le+"-resize s"),We=yt(Le+"-description"),Ae=yt(Le+"-overlay"),Ie=Qe("div"),qe=Qe("div"),Be=Qe("div"),Re=yt("left","span"),Ue=yt("right","span"),Xe=yt(Le+"-preview","a"),Ke=0,Ze=0;S.suffix||(S.suffix=K[1]);var Tt={},$t=null;u.create=function(e,t){x(e)&&(S=c(S,e));var n=ct(Pe);if(et(Pe,Ne),n&&"P"===n.nodeName?(dt(n,Me),Ke=n,mt(n,!1)):dt(Pe,Me),Me.dir=S.dir,bt(Me,Ce),bt(Me,je),bt(Me,Ye),bt(Me,Fe),bt(je,Pe),S.tools&&(bt(Ce,He),bt(Ye,We),bt(We,Re),bt(We,Ue)),ve(D,Pe,_t),ve(O,Pe,Lt),ve(q,Pe,St),ve(j,Fe,Wt),ve(H,$,At),ve(Y,$,It),Oe.preview){var i=Se.preview;re(Xe,{href:V,title:x(i)?i[0]+(i[1]?" ("+i[1]+")":""):i}),bt(Re,Xe),it(Xe,Oe.preview)}return zt(null),kt(),Et(),0!==t?ie("create",[u]):u},u.update=function(e,t){return tt(Pe,Ne,0)&&u.destroy(0),(0!==t?ie("update",[u]):u).create(e,0)},u.destroy=function(e){return tt(Pe,Ne,0)?($e.exit(0,0,0),nt(Pe,Ne),x(S.tools)&&(S.tools=S.tools.join(" ")),S.keys&&(he(D,Pe,_t),he(O,Pe,Lt)),he(j,Fe,Wt),he(H,$,At),he(Y,$,It),he(q,Pe,St),Ke?(dt(Me,Ke),bt(Ke,Pe),Ke=0):dt(Me,Pe),gt(Me),0!==e?ie("destroy",[u]):u):u};var e,Ft,Ot=0,Nt=0,Mt=0,Ct=0,jt=0,Yt=0,Ht=0,Pt={};$e.exit=function(e,t,n){var r,i={overlay:function(){he(P,Ae,qt),gt(Ae)},modal:function(){he(j,je,Ut),he(H,je,Xt),he(Y,$,Kt),he(P,Pt.x,Rt),gt(Ie)},drop:function(){gt(qe)},bubble:function(){gt(Be)}};if(t)if(x(t))for(r in t)r=t[r],i[r]&&i[r](),0!==n&&ie("exit."+r,[u]);else i[t]&&i[t](),0!==n&&ie("exit."+r,[u]);else for(r in i)i[r]();return e&&u.select(),0!==n&&ie("exit",[u]),u},$e.overlay=function(e,t,n){return $e.exit(0,0,0).blur(),Lt(1),bt(je,Qe(Ae,e.length||m(e)?yt(Le+"-overlay-content","div",e):"")),t&&ve(P,Ae,qt),g(n)?n(Ae):Qe(Ae,n),ie("enter.overlay",[u]),ie("enter",[u]),u},$e.overlay.fit=function(){},$e.modal=function(){$e.overlay("",1);var o,l,e=arguments,t=e[0],n=e[1],i=e[2],r=Le+"-modal";x(t)&&(t="default",n=e[0],i=e[1]),l=we(t),Qe(Ie,!1,{"class":r+" "+l}),E(n.body)&&(n.body=Qe("div",n.body,{"class":r+"-content "+l}));for(o in n)r[1]=o,Pt[o]=yt(r+"-"+xe(o,r)+" "+l,0,n[o]);return Pt.x=yt(Le+"-x "+l),Pt.resize=yt(Le+"-resize se "+l),ot(Ie),bt(je,Qe(Ie,Pt,{style:""})),$e.modal.fit(),pt(Ie,Ae),ve(P,Pt.x,Rt),ve(j,Pt.header,ae),ve(j,Pt.resize,ae),ve(j,je,Ut),ve(H,je,Xt),ve(Y,$,Kt),g(i)&&(Pt.overlay=Ae,Pt.modal=Ie,i(Pt)),ie("enter.modal."+t,[u]),ie("enter.modal",[u]),ie("enter",[u]),u},$e.modal.fit=function(e){Bt();var t=Ht/2-jt/2,n=Yt/2-Ct/2;return x(e)?(n=e[0],t=e[1]):(n=p(n,0),t=p(t,0)),d(Ie,{left:n+ee,top:t+ee,"min-width":Ct+ee,"min-height":jt+ee,visibility:"visible"}),ie("fit.modal",[u]),ie("fit",[u]),u};var Gt={"class":Le+"-button",name:"y"};return $e.alert=function(e,t,n,i){var r=Qe("button",De.okay,Gt),o="alert";return n=n||L,x(e)&&(o+=":"+e[0],e=e[1]||e[0]),ve(P,r,function(e){return n(e,u),Rt(e,o+".y"),ae(e)}),ve(D,r,function(e){var t=e.TE.key;return t(/^escape|enter$/)?be(P,r,[e,u]):void 0}),$e.modal(o,Zt(e,t,r),i),r.focus(),u},$e.confirm=function(e,t,n,i,r){function a(e){return g(n)&&n(e,u),Rt(e,l+".y"),ae(e)}function c(e){return g(i)&&i(e,u),Rt(e,l+".n"),ae(e)}var s,o=Qe("button",De.okay,Gt),f=Qe("button",De.cancel,Gt),l="confirm";return f.name="n",x(e)&&(l+=":"+e[0],e=e[1]||e[0]),ve(P,o,a),ve(P,f,c),ve(D,o,function(e){return s=e.TE.key,s("arrowright")?(f.focus(),ae(e)):s("arrowleft")?ae(e):s("enter")?(a(e),ae(e)):s("escape")?(Rt(e,l+".y"),ae(e)):void 0}),ve(D,f,function(e){return s=e.TE.key,s("arrowright")?ae(e):s("arrowleft")?(o.focus(),ae(e)):s("enter")?(c(e),ae(e)):s("escape")?(Rt(e,l+".n"),ae(e)):void 0}),$e.modal(l,Zt(e,t,[o,f]),r),f.focus(),u},$e.prompt=function(e,t,n,i,r,o){function b(){s.focus(),"placeholder"in s&&s.select()}function m(e){return ae(e)}function y(e){return v=s.value,!n||h(v)&&v!==t?(Rt(e,a+".y"),ae(e),i(e,u,v!==t?v:"",t)):(b(),m(e))}function w(e){return Rt(e,a+".n"),ae(e)}var d,p,v,f=Qe("button",De.okay,Gt),l=Qe("button",De.cancel,Gt),s=Qe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Le+"-input block"}),a="prompt",c=[];if(x(e)&&(a+=":"+e[0],e=e[1]||e[0]),g(r)&&(o=r,r=0),1===r)s=Qe("textarea",t,{placeholder:t.split("\n")[0],"class":Le+"-textarea block"});else if(2===r){for(p in t)c.push(Qe("option",t[p],{value:p,selected:p===n||null}));s=Qe("select",c,{"class":Le+"-select block"})}return i=i||L,s.name="data",l.name="n",ve(D,s,function(e){return d=e.TE.key,d("enter")?y(e):d("escape")||d("backspace")&&!this.value?w(e):d("arrowup")?m(e):d("arrowdown")?(f.focus(),ae(e)):void 0}),ve(D,f,function(e){return d=e.TE.key,d("enter")?y(e):d("escape")?w(e):d("arrowup")?(s.focus(),ae(e)):d("arrowright")?(l.focus(),ae(e)):d(/^arrow(down|left)$/)?m(e):void 0}),ve(D,l,function(e){return d=e.TE.key,d(/^enter|escape$/)?w(e):d("arrowup")?(s.focus(),ae(e)):d(/^arrow(right|down)$/)?m(e):d("arrowleft")?(f.focus(),ae(e)):void 0}),ve(P,f,y),ve(P,l,w),$e.modal(a,Zt(e,s,[f,l]),o),b(),u},$e.drop=function(){$e.exit(0,0,0);var i,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),i=we(t),ot(qe),bt($,Qe(qe,!1,{"class":Le+"-drop "+i})),g(n)?n(qe):Qe(qe,n),$e.drop.fit(),ve(P,$,Jt),ie("enter.drop."+t,[u]),ie("enter.drop",[u]),u},$e.drop.fit=function(e){var o,t=ze(z),n=ze(qe),i=t.w/2-n.w/2,r=t.h/2-n.h/2;return!E(e)&&Ze&&(o=Ee(Ze),i=o.l,r=o.t+ze(Ze).h),x(e)?(i=e[0],r=e[1]):(i=p(i,0,t.w-n.w),r=p(r,0,t.h-n.h)),d(qe,{left:i+ee,top:r+ee,visibility:"visible"}),ie("fit.drop",[u]),ie("fit",[u]),u},$e.menu=function(e,t,n,i){var r='<span class="'+Le+'-current menu">%1</span>',o="";return t===!1?$e.tool(e,t):(x(t)&&(o=t[0],t=t[1],r='<i class="'+xe(_e.i,[o])+'"></i> '+r),$e.tool(e,{i:o,text:xe(r,[n[t]&&n[t].text||t,o]),click:function(t){var f,l,s,a,d,p,v,i={href:V,"class":Le+"-button"};return $e.drop("menu menu-"+we(e),function(e){function t(e){return a=this,v=n[ue(a,Q)],f=rt(a),v&&v.active&&g(p=v.click)&&(p=p(e,u),Ze&&it(lt(Ze)[0]||Ze,xe(r,[f,o])),p===!1)?ae(e):(u.select(),ae(e))}for(s in n)d=n[s],d=k(d)?$e.tools[d]:d,d&&(wt(d,s),i["data-"+Q]=s,l=Qe("a",d.text||s,c(i,d.attributes||{})),!l.title&&(p=d.title)&&(l.title=x(p)?p[0]+(p[1]?" ("+p[1]+")":""):p),d.active||et(l,"x"),n[s]=d,ve(P,l,t),bt(e,l))}),!1}},i),u)},$e.bubble=function(){$e.exit(0,0,0);var i,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),i=we(t),ot(Be),bt($,Qe(Be,!1,{"class":Le+"-bubble "+i})),g(n)?n(Be):Qe(Be,n),$e.bubble.fit(),ie("enter.bubble."+t,[u]),ie("enter.bubble",[u]),u},$e.bubble.fit=function(e){var t=u.$(1),n=Ee(Pe),i=d(Pe,"line-height"),r="border-",o="-width",f=t.caret[0].x+n.l-Pe.scrollLeft,l=t.caret[1].y+n.t+i-Pe.scrollTop,s=d(je,[r+"top"+o,r+"bottom"+o,r+"left"+o,r+"right"+o]),a=ze(je),c=ze(Be),v=s[0]+s[1],h=s[2]+s[3];return x(e)?(f=e[0],l=e[1]):(f=p(f,n.l,n.l+a.w-c.w-h),l=p(l,n.t,n.t+a.h-c.h-v)),d(Be,{left:f+ee,top:l+ee,visibility:"visible"}),ie("fit.bubble",[u]),ie("fit",[u]),u},$e.overlay.exit=function(e){return $e.exit(e,"overlay")},$e.modal.exit=function(e){return $e.exit(e,"modal")},$e.drop.exit=function(e){return $e.exit(e,"drop")},$e.bubble.exit=function(e){return $e.exit(e,"bubble")},$e.tool=function(e,t,n){var i="";return"|"!==e&&(S.tools=S.tools.filter(function(t,n){return t===e?(i=n,!1):!0})),t===!1?delete $e.tools[e]:("|"===e?(n=t,t={}):(g(t)&&(t={click:t}),$e.tools[e]=c($e.tools[e]||{},t),E(n)||""===i||(n=i)),y(n)?S.tools.splice(n,0,e):S.tools.push(e)),kt(),u},$e.key=function(e,t){return S.keys?(t===!1?delete $e.keys[e]:$e.keys[e]=t,Et(),u):u},$e.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(R),!1},outdent:function(e,t){return t.outdent(R),!1}},ve(P,Xe,Qt),$e.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Qt(e)},"shift+tab":U?"outdent":0,tab:U?"indent":0,escape:function(e,t){return Xe.focus(),!1}},$e.el={container:Me,header:Ce,body:je,footer:Ye,overlay:Ae,modal:Ie,drop:qe,bubble:Be},u.config=S,c(u._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),l=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>l&&(l="0"+l),[""+t,""+n,""+i,""+r,""+o,""+f,""+l]},replace:ye,format:xe,dom:{set:bt,reset:mt,get:at,id:Ve,classes:{set:et,reset:nt,get:tt},attr:{set:re,reset:fe,get:oe},data:{set:le,reset:se,get:ue},offset:Ee,point:ke,size:ze,content:{set:it,reset:ot,get:rt},closest:Te,parent:ft,children:lt,next:ut,previous:st,before:dt,after:pt,prepend:vt,append:ht},el:Qe,event:{set:ve,reset:he,fire:be,x:ae},hooks:_,hook:{set:te,reset:ne,fire:ie}}),$e};