/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Le(e){return k(e)?b(e).split(/\s+/):e}function Ce(e){return w(e)?e.join(" "):e}function ze(e,t,n){return E(e)?E(t)?(E(C[e])||(C[e]={}),E(n)||(n=Object.keys(C[e]).length),C[e][n]=t,l):C[e]:C}function Se(e,t){return E(e)?E(t)&&E(C[e])?(delete C[e][t],l):(C[e]={},l):(C={},l)}function Oe(e,t,n){if(!E(C[e]))return C[e]={},l;if(E(n))E(C[e][n])&&C[e][n].apply(l,t);else for(N in C[e])C[e][N].apply(l,t);return l}function je(e,t,n){if(w(t))for(N in t)je(e,N,t[N]);else e.setAttribute(t,n)}function De(t,n,r){if(k(n))return De(t,[n],E(r)?r:"")[0];e=[];for(N in n)N=n[N],(N=t.getAttribute(N))&&e.push(N);return e.length?e:E(r)?r:[]}function Me(e,t){if(w(t))for(N in t)Me(e,t[N]);else if(E(t))e.removeAttribute(t);else for(Me(e,"class"),N=0,I=e.attributes,P=I.length;P>N;++N)I[N]&&Me(e,I[N].name)}function He(e,t,n){if(w(t))for(N in t)He(e,N,t[N]);else je(e,"data-"+t,n)}function Ye(t,n,r){if(k(n))return Ye(t,[n],E(r)?r:"")[0];e=[];for(N in n)N=n[N],(N=De(t,"data-"+N))&&e.push(N);return e.length?e:E(r)?r:[]}function Be(e,t){if(w(t))for(N in t)Me(e,"data-"+t[N]);else if(E(t))Me(e,"data-"+t);else for(N=0,I=e.attributes,P=I.length;P>N;++N)I[N]&&"data-"===I[N].name.slice(0,5)&&Me(e,I[N].name)}function Ae(e){return e&&e.preventDefault(),!1}function Ne(e,t,n){if(t){for(e=Le(e),N=0,I=e.length;I>N;++N)t.addEventListener(e[N],n,!1),ze("on:"+e[N],n,tt(t));return l}}function Ie(e,t,n){if(t){for(e=Le(e),N=0,I=e.length;I>N;++N)t.removeEventListener(e[N],n,!1),Se("on:"+e[N],tt(t));return v(t)&&t.id.split(":")[0]===Et+"-dom"&&Me(t,"id"),l}}function Pe(e,t,n){e=Le(e);var i,r="createEvent"in u;for(N=0,I=e.length;I>N;++N)r?(i=u.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[N],!0,!1),t.dispatchEvent(i)):Oe("on:"+e[N],n,tt(t));return l}function We(e,t){return setTimeout(e,t)}function Re(e){return clearTimeout(e)}function Fe(e,t,n){for(N=0,I=t.length,P;I>N;++N)P=t[N],e=e.replace(x(P)?P:h(a(P),"g"),n&&n[N]||"");return e}function Ue(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,E(t[n])?t[n]:e})}function qe(e){return b(Fe(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Xe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=Ke(e);return{x:n-i.l,y:r-i.t}}function Ke(e){for(W=e.offsetLeft,Z=e.offsetTop;e=e.offsetParent;)W+=e.offsetLeft,Z+=e.offsetTop;return{l:W,t:Z}}function Ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Ve(e,t){for(;(e=ot(e))&&e!==t;);return e}function Je(e,t){t=Le(t);for(N in t)e.classList.add(t[N])}function Ge(t,n,r){if(k(n))return Ge(t,[n],E(r)?r:"")[0];e=[];for(N in n)N=n[N],t.classList.contains(N)&&e.push(N);return e.length?e:E(r)?r:!1}function Qe(e,t){if(E(t)){t=Le(t);for(N in t)e.classList.remove(t[N])}else Me(e,"class")}function et(e,t,n){if(e=k(e)?u.createElement(e):e,w(n))for(N in n)if(J=n[N],"classes"===N)Je(e,J);else if("data"===N)for(I in J)J=J[I],null===J?Be(e,I):He(e,I,J);else"css"===N?k(J)?je(e,"style",J):null===J?Me(e,"style"):d(e,J):y(J)?e[N]=J:null===J?Me(e,N):je(e,N,w(J)?J.join(" "):""+J);if(v(t))gt(e,t);else if(w(t))for(N in t)J=t[N],v(J)?gt(e,J):J!==!1&&nt(e,J);else E(t)&&t!==!1&&nt(e,t);return e}function tt(e){var t=e.id;return t||(t=Et+"-dom:"+Date.now(),e.id=t),t}function nt(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(E(t)?t:"")}function it(e,t){if(t!==!1&&(D=ft(e)))for(N=0,I=D.length;I>N;++N)it(D[N]);nt(e,"")}function ot(e){return e.parentNode}function ft(e){return e.children||[]}function ut(e){return e.nextSibling}function lt(e){return e.previousSibling}function st(e,t){return k(t)?e.nodeName.toLowerCase()===t.toLowerCase():y(t)?e===t(e):e===t}function at(t,n){if(n=n||u,e=[],k(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(N=0,I=t.length;I>N;++N)e.push(t[N]);return e}return[]}for(t=n.querySelectorAll(t),N=0,I=t.length;I>N;++N)e.push(t[N]);return e}return ct(t)?[t]:[]}function ct(e,t){var n=ot(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function dt(e,t){U=ot(e),U&&U.insertBefore(t,e)}function pt(e,t){U=ot(e),U&&U.insertBefore(t,ut(e))}function ht(e,t){D=ft(e)[0],D?dt(D,t):gt(e,t)}function bt(e,t){gt(e,t)}function gt(e,t){e.appendChild(t)}function vt(e,t){var n=ct(e);if(n){if(t!==!1)for(D=ft(e)[0];D;)vt(D);n.removeChild(e)}}function yt(e){it(et(e,!1,{style:""})),vt(e)}function mt(e,t,n){return et(t||"div",n,{"class":e})}function Kt(e){return!e||E(e.active)&&!K.active}function Zt(){Lt._word&&Lt._words&&(J=(Mt.value||"").replace(h(ke[0]+"[^"+ke[0]+ke[1]+"]+?"+ke[1],"g"),""),N=(J.match(/(\w+)/g)||[]).length,nt(Wt,Ue(Lt["_word"+(1===N?"":"s")],[N])))}function Vt(e,t,n){return y(e)&&(e={click:e}),k(e.click)&&(e.click=(n[e.click]||{}).click),E(e.title)||(e.title=Tt[t]||""),n[t]=e,e}function Jt(){it(Dt,!1);var r,i,o,f,u,s,e=Le(S.tools),t=Et+"-button",n=Et+"-separator";S.tools=e;for(u in e)s=e[u],i=wt.tools[s],i&&(i=Vt(i,s,wt.tools),o=i.i||s,"|"!==o&&"<"!==o[0]&&(o=qe(o)),f="|"!==o,qt=mt(f?t:n,f?"a":"span"),f?(r=t+":"+qe(s).replace(/\s/g,""),je(qt,{href:$e,id:r,"tab-index":-1}),He(qt,Te,s),o="<"===o[0]?o:'<i class="'+Ue(kt,[o])+" "+r+'"></i>',Kt(i)&&Je(qt,"x"),i.text&&(o=Ue('<span class="'+Et+'-text">'+i.text+"</span>",[o]),Je(qt,"text")),nt(qt,o),et(qt,!1,i.attributes||{}),!qt.title&&(I=i.title)&&(qt.title=w(I)?I[0]+(I[1]?" ("+I[1]+")":""):I),wt.tools[s].target=qt,Ne(ae,qt,fn)):qt.id=Et+"-separator:"+u,gt(Dt,qt));Oe("update.tools",[l])}function Gt(){wt.keys=function(){var n,e=Object.keys(wt.keys).sort().reverse(),t={};for(N=0,I=e.length;I>N;++N)n=e[N],t[n]=wt.keys[n];return t}(),rn(1),Oe("update.keys",[l])}function Qt(e){Zt(),Oe("on:change",[e,l])}function nn(t){function p(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),r=n.before,i=n.after,o=r.slice(-1),f=i[0],u=n.length,s=wt.keys,c=TE.keys_alias,d=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();F=t.TE.key(),en[F]=1,e=Object.keys(en).length,We(function(){l.record()},1);for(N in s){P=p(N),D=0;for(I in P)I=P[I],en[c[I]||I]&&++D;if(P=P.length,D===P&&e===P&&(k(s[N])&&(s[N]=wt.tools[s[N]].click),W=s[N]&&s[N](t,l),W===!1))return Ae(t)}if(me)for(N in me)if(R=me[N],R!==!1){if(F===R&&f===R)return"\\"===o?(l.insert(F,0),Ae(t)):(l.select(n.end+1),Ae(t));if(N===F)return l.wrap(N,R),Ae(t);if(o===N&&f===R){if("backspace"===F&&r.slice(-2)!=="\\"+N)return l.unwrap(N,R),Ae(t);if(ye&&"enter"===F&&N!==R)return l.tidy("\n"+d+ve,"\n"+d).scroll(!0),Ae(t)}}if(ye&&!u){if("backspace"===F&&h(a(ve)+"$").test(r))return l.outdent(ve).scroll(!0),Ae(t);if("enter"===F&&h("(^|\\n)("+a(ve)+")+.*$").test(r))return l.insert("\n"+d,0,1).scroll(!0),Ae(t)}}function rn(e){w(e)?delete en[e.TE.key()]:en={}}function on(e){/^focus|blur$/.test(e.type)&&rn(1),Re(tn),tn=We(function(){Qt(e)},S.debounce||0)}function fn(e){wt.exit(0,0,0);var t=Ye(this,Te),n=wt.tools,r=n[t];return Ut=e.currentTarget||e.target,!Kt(r)&&y(I=r.click)&&(I=I(e,l,t),Oe("on:change",[e,l,t]),I===!1)?Ae(e):(l.select(),Ae(e))}function cn(e){return un=Ht,K=Ze(jt),Ae(e)}function dn(e){un===Ht&&d(Mt,{height:Xe(Ot,e).y-K.h+_e})}function pn(){un=0}function hn(){wt.exit(1)}function bn(){e=Ze(At),G=e.w,A=e.h,e=Ze(Bt),ln=e.w,sn=e.h}function gn(e,t){t&&Oe("exit.modal."+t,[l]),Pe(ae,Bt,[e])}function vn(t){un=t.target,e=Xe(At,t),Q=e.x,ee=e.y,bn()}function yn(t){var n=an.header,r=an.resize;un===n||Ve(un,n)===n?(e=Xe(Ot,t),W=e.x-Q,Z=e.y-ee,d(At,{left:(G>ln?W:p(W,0,ln-G))+_e,top:(A>sn?Z:p(Z,0,sn-A))+_e})):un===r&&(e=Xe(At,t),K=Ze(r),d(At,{width:e.x+K.w/4+_e,height:e.y+K.h/4+_e}))}function mn(){un=0}function wn(e,t,n){return{header:e,body:t,footer:n}}function xn(e){O=Ut,j=Nt,D=e&&e.target||0,(!D||D!==O&&Ve(D,O)!==O)&&(Ut=0,yt(Nt),Ie(ae,u,xn),wt.exit(e.target===L))}function En(t){function n(){e&&(U=Ze(e),d(X,{width:U.w+_e,height:U.h+_e}))}return J=l.get(),G="",-1===J.indexOf("</html>")&&(G='<!DOCTYPE html><html dir="'+S.dir+'"><head><meta charset="utf-8"><style>'+S.css+"</style></head><body>"+J+"</body></html>"),X=et("iframe",!1,{"class":Et+"-portal",src:"data:text/html,"+encodeURIComponent(G)}),!ct(Bt)&&J?wt.overlay(X,1,function(){e=ft(Bt)[0],n(),Ne(he,f,n),Oe("enter.overlay.preview",[t,l,[J,G],e])}):(Ie(he,f,n),hn()),Ae(t)}var O,j,D,Y,A,N,I,P,W,R,F,e,U,X,K,Z,J,G,Q,ee,t="⌘",n="…",i="⇥",o="⇧",f=window,u=document,l=this,s=l._,a=s.x,c=s.extend,d=s.css,p=s.edge,h=s.pattern,b=s.trim,g=l.is,v=g.e,y=g.f,m=g.i,w=g.o,x=g.r,k=g.s,E=function(e){return!g.x(e)},T=u.documentElement,_=(u.head,u.body),L=l.target,C={},z=function(){},S=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),ne="keydown",re="keyup",ie="copy",oe="cut",fe="paste",ue="touchstart mousedown",le="touchend mouseup",se="touchmove mousemove",ae="click",ce="focus",de="blur",pe="input",he="orientationchange resize",be=de+" "+ie+" "+oe+" "+ce+" "+pe+" "+ne+" "+fe,ge=S.languages,ve=S.tab,ye=S.auto_tab,me=S.auto_close,we=S.unit[0][0],ke=(S.unit[0][1],S.unit[1][0]),Ee=S.unit[1][1],Te="tool-id",$e="javascript:;",_e="px",wt=l.ui={};l.tidy=function(e,t){var n=l.$(),r=b(n.before)?e:"",i=b(n.after)?E(t)?t:e:"";return l.trim(r,i)},l.i=function(){return b(l.replace(/\s+/g," "))},l.format=function(e,t,n,r){w(e)||(e=[e]),E(n)||(n=" "),E(r)||(r="");var i=l[0]().$(),o=(e[0]?we[0]+e[0]+we[1]:"")+r,f=r+(e[0]?we[0]+we[2]+(e[1]||e[0].split(h("("+Ee[3]+")+"))[0])+we[1]:""),u=a(o),s=a(f),c=h("^"+u+"([\\s\\S]*?)"+s+"$"),d=h(u+"$"),p=h("^"+s),b=i.before,g=i.after;return i.length?n=!1:l.insert(ge.placeholders[""]),l.toggle(t?!c.test(i.value):!d.test(b)&&!p.test(g),[function(e){e.unwrap(o,f,1).tidy(h(ke[0]+"[^"+ke[0]+ke[1]+ke[2]+"]+?"+ke[1]+"$").test(b)?"":n,h("^"+ke[0]+ke[2]+"[^"+ke[0]+ke[1]+"]+?"+ke[1]).test(g)?"":n).wrap(o,f,t)[1]()},function(e){e.unwrap(o,f,t)[1]()}])};var qt,xt=S.classes,kt=xt.i,Et=xt[""],Tt=ge.tools,$t=ge.buttons,_t=ge.labels,Lt=ge.others,Ct=Et+"-textarea "+Et+"-content block",zt=mt(Et),St=mt(Et+"-header"),Ot=mt(Et+"-body"),jt=mt(Et+"-footer"),Dt=mt(Et+"-tool"),Mt=et(L,!1,S.attributes),Ht=mt(Et+"-resize s"),Yt=mt(Et+"-description"),Bt=mt(Et+"-overlay"),At=et("div"),Nt=et("div"),It=et("div"),Pt=mt("left","span"),Wt=mt("right","span"),Rt=mt(Et+"-preview","a"),Ft=0,Ut=0;S.suffix||(S.suffix=we[1]);var en={},tn=null;l.create=function(e,t){w(e)&&(S=c(S,e));var n=ct(Mt);return Je(Mt,Ct),n&&st(n,"p")?(dt(n,zt),Ft=n,vt(n,!1)):dt(Mt,zt),zt.dir=S.dir,gt(zt,St),gt(zt,Ot),gt(zt,jt),gt(zt,Ht),gt(Ot,Mt),S.tools&&(gt(St,Dt),gt(jt,Yt),gt(Yt,Pt),gt(Yt,Wt)),Ne(ne,Mt,nn),Ne(re,Mt,rn),Ne(be,Mt,on),Ne(ue,Ht,cn),Ne(se,u,dn),Ne(le,_,pn),Lt.preview&&(K=Tt.preview,je(Rt,{href:$e,title:w(K)?K[0]+(K[1]?" ("+K[1]+")":""):K}),gt(Pt,Rt),nt(Rt,Lt.preview)),Qt(null),Jt(),Gt(),0!==t?Oe("create",[l]):l},l.update=function(e,t){return Ge(Mt,Le(Ct),0)&&l.destroy(0),(0!==t?Oe("update",[l]):l).create(e,0)},l.destroy=function(e){return Ge(Mt,Le(Ct),0)?(wt.exit(0,0,0),Qe(Mt,Ct),S.tools=Ce(S.tools),S.keys&&(Ie(ne,Mt,nn),Ie(re,Mt,rn)),Ie(ue,Ht,cn),Ie(se,u,dn),Ie(le,u,pn),Ie(be,Mt,on),Ft?(dt(zt,Ft),gt(Ft,Mt),Ft=0):dt(zt,Mt),yt(zt),0!==e?Oe("destroy",[l]):l):l};var un=0,Q=0,ee=0,G=0,A=0,ln=0,sn=0,an={};wt.exit=function(e,t,n){if(Y={overlay:function(){Ie(ae,Bt,hn),yt(Bt)},modal:function(){Ie(ue,Ot,vn),Ie(se,Ot,yn),Ie(le,u,mn),Ie(ae,an.x,gn),yt(At)},drop:function(){yt(Nt)},bubble:function(){yt(It)}},t)if(w(t))for(N in t)N=t[N],Y[N]&&Y[N](),0!==n&&Oe("exit."+N,[l]);else Y[t]&&Y[t](),0!==n&&Oe("exit."+N,[l]);else for(N in Y)Y[N]();return e&&l.select(),0!==n&&Oe("exit",[l]),l},wt.overlay=function(e,t,n){return wt.exit(0,0,0),rn(1),gt(Ot,et(Bt,e.length||v(e)?mt(Et+"-overlay-content","div",e):"")),t&&Ne(ae,Bt,hn),y(n)?n(Bt):et(Bt,n),Oe("enter.overlay",[l]),Oe("enter",[l]),l},wt.overlay.fit=function(){},wt.modal=function(){wt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=Et+"-modal";w(t)&&(t="default",n=e[0],r=e[1]),W=qe(t),et(At,!1,{"class":i+" "+W}),E(n.body)&&(n.body=et("div",n.body,{"class":i+"-content "+W}));for(N in n)i[1]=N,an[N]=mt(i+"-"+Ue(N,i)+" "+W,0,n[N]);return an.x=mt(Et+"-x "+W),an.resize=mt(Et+"-resize se "+W),it(At),gt(Ot,et(At,an,{style:""})),wt.modal.fit(),pt(At,Bt),Ne(ae,an.x,gn),Ne(ue,an.header,Ae),Ne(ue,an.resize,Ae),Ne(ue,Ot,vn),Ne(se,Ot,yn),Ne(le,u,mn),y(r)&&(an.overlay=Bt,an.modal=At,r(an)),Oe("enter.modal."+t,[l]),Oe("enter.modal",[l]),Oe("enter",[l]),l},wt.modal.fit=function(e){return bn(),W=ln/2-G/2,Z=sn/2-A/2,w(e)?(W=e[0],Z=e[1]):(W=p(W,0),Z=p(Z,0)),d(At,{left:W+_e,top:Z+_e,"min-width":G+_e,"min-height":A+_e,visibility:"visible"}),Oe("fit.modal",[l]),Oe("fit",[l]),l};var kn={"class":Et+"-button",name:"y"};return wt.alert=function(e,t,n,r){var i=et("button",$t.okay,kn),o="alert";return n=n||z,w(e)&&(o+=":"+e[0],e=e[1]||e[0]),Ne(ae,i,function(e){return n(e,l),gn(e,o+".y"),Ae(e)}),Ne(ne,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(Pe(ae,i,[e]),Ae(e)):void 0}),wt.modal(o,wn(e,t,i),r),i.focus(),l},wt.confirm=function(e,t,n,r,i){function a(e){return y(n)&&n(e,l),gn(e,u+".y"),Ae(e)}function c(e){return y(r)&&r(e,l),gn(e,u+".n"),Ae(e)}var s,o=et("button",$t.okay,kn),f=et("button",$t.cancel,kn),u="confirm";return f.name="n",w(e)&&(u+=":"+e[0],e=e[1]||e[0]),Ne(ae,o,a),Ne(ae,f,c),Ne(ne,o,function(e){return s=e.TE.key,s("arrowright")?(f.focus(),Ae(e)):s("arrowleft")?Ae(e):s("enter")?(a(e),Ae(e)):s("escape")?(gn(e,u+".y"),Ae(e)):void 0}),Ne(ne,f,function(e){return s=e.TE.key,s("arrowright")?Ae(e):s("arrowleft")?(o.focus(),Ae(e)):s("enter")?(c(e),Ae(e)):s("escape")?(gn(e,u+".n"),Ae(e)):void 0}),wt.modal(u,wn(e,t,[o,f]),i),f.focus(),l},wt.prompt=function(e,t,n,r,i,o){function p(){s.focus(),"placeholder"in s&&s.select()}function h(e){return Ae(e)}function g(e){return K=s.value,!n||b(K)&&K!==t?(gn(e,a+".y"),Ae(e),r(e,l,K!==t?K:"",t)):(p(),h(e))}function v(e){return gn(e,a+".n"),Ae(e)}var d,f=et("button",$t.okay,kn),u=et("button",$t.cancel,kn),s=et("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Et+"-input block"}),a="prompt",c=[];if(w(e)&&(a+=":"+e[0],e=e[1]||e[0]),y(i)&&(o=i,i=0),1===i)s=et("textarea",t,{placeholder:t.split("\n")[0],"class":Et+"-textarea block"});else if(2===i){for(N in t)c.push(et("option",t[N],{value:N,selected:N===n||null}));s=et("select",c,{"class":Et+"-select block"})}return r=r||z,s.name="data",u.name="n",Ne(ne,s,function(e){return d=e.TE.key,d("enter")?g(e):d("escape")||d("backspace")&&!this.value?v(e):d("arrowup")?h(e):d("arrowdown")?(f.focus(),Ae(e)):void 0}),Ne(ne,f,function(e){return d=e.TE.key,d("enter")?g(e):d("escape")?v(e):d("arrowup")?(s.focus(),Ae(e)):d("arrowright")?(u.focus(),Ae(e)):d(/^arrow(down|left)$/)?h(e):void 0}),Ne(ne,u,function(e){return d=e.TE.key,d(/^enter|escape$/)?v(e):d("arrowup")?(s.focus(),Ae(e)):d(/^arrow(right|down)$/)?h(e):d("arrowleft")?(f.focus(),Ae(e)):void 0}),Ne(ae,f,g),Ne(ae,u,v),wt.modal(a,wn(e,s,[f,u]),o),p(),l},wt.drop=function(){wt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),W=qe(t),it(Nt),gt(_,et(Nt,!1,{"class":Et+"-drop "+W})),y(n)?n(Nt):et(Nt,n),wt.drop.fit(),Ne(ae,u,xn),Oe("enter.drop."+t,[l]),Oe("enter.drop",[l]),l},wt.drop.fit=function(t){return O=Ze(T),j=Ze(Nt),W=O.w/2-j.w/2,Z=O.h/2-j.h/2,!E(t)&&Ut&&(e=Ke(Ut),W=e.l,Z=e.t+Ze(Ut).h),w(t)?(W=t[0],Z=t[1]):(W=p(W,0,Math.max(O.w,f.innerWidth)-j.w),Z=p(Z,0,Math.max(O.h,f.innerHeight)-j.h)),d(Nt,{left:W+_e,top:Z+_e,visibility:"visible"}),Oe("fit.drop",[l]),Oe("fit",[l]),l},wt.menu=function(e,t,n,r){t=!w(t)&&n[t]&&n[t].text||t;var u,i='<span class="'+Et+'-current menu">%1</span>',o="",f=0;return t===!1?wt.tool(e,t):(w(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+Ue(kt,[o])+'"></i>',t=E(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,i=o+(0!==t?" "+i:"")),wt.tool(e,{i:o,text:t?Ue(i,[t,o]):0,click:function(s){return wt.drop("menu menu-"+qe(e),function(s){function a(e){return u=this,R=n[Ye(u,Te)],R=k(R)?wt.tools[R]:R||{},A=rt(u),!Kt(R)&&y(r=R.click)&&(r=r(e,l),t!==!1&&Ut&&(K=ft(Ut)[0]||Ut,st(K,"i")||nt(K,Ue(i,[A,o])),w(R.text)&&(Z=ft(K)[0])&&st(Z,"i")&&(Qe(Z),Je(Z,Ue(kt,[R.text[0]])))),r===!1)?Ae(e):(l.select(),Ae(e))}for(r in n)if(u=n[r],G="%"===r[0],u=k(u)&&!G?wt.tools[u]:u){u=Vt(u,r,wt.tools);var d={href:G?null:$e,"class":Et+"-"+(G?"label":"button")};G?I=_t[e]&&_t[e][+r.slice(1)-1]||r:(d.data={},d.data[Te]=r,I=Tt[r]||r),X=u.text,X=w(X)?X[1]||"":X,I=w(I)?I[0]:I,K=et(G?"span":"a",G?!1:u.text||I,c(d,u.attributes||{})),!K.title&&(Z=u.title)&&(K.title=w(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z),G?je(K,{id:Et+"-label:"+f,title:I||null}):(Kt(u)&&Je(K,"x"),Ne(ae,K,a)),n[r]=u,gt(s,K),++f}}),!1}},r),wt.tools[e].data=n,l)},wt.bubble=function(){wt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),W=qe(t),it(It),gt(_,et(It,!1,{"class":Et+"-bubble "+W})),y(n)?n(It):et(It,n),wt.bubble.fit(),Oe("enter.bubble."+t,[l]),Oe("enter.bubble",[l]),l},wt.bubble.fit=function(t){K=l.$(1),e=Ke(Mt),A=d(Mt,"line-height");var n="border-",r="-width";W=K.caret[0].x+e.l-Mt.scrollLeft,Z=K.caret[1].y+e.t+A-Mt.scrollTop,j=d(Ot,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Ze(Ot),o=Ze(It),f=j[0]+j[1],u=j[2]+j[3];return w(t)?(W=t[0],Z=t[1]):(W=p(W,e.l,e.l+i.w-o.w-u),Z=p(Z,e.t,e.t+i.h-o.h-f)),d(It,{left:W+_e,top:Z+_e,visibility:"visible"}),Oe("fit.bubble",[l]),Oe("fit",[l]),l},wt.overlay.exit=function(e){return wt.exit(e,"overlay")},wt.modal.exit=function(e){return wt.exit(e,"modal")},wt.drop.exit=function(e){return wt.exit(e,"drop")},wt.bubble.exit=function(e){return wt.exit(e,"bubble")},wt.tool=function(e,t,n){return I="","|"!==e&&(S.tools=S.tools.filter(function(t,n){return t===e?(I=n,!1):!0})),t===!1?delete wt.tools[e]:("|"===e?(n=t,t={}):(y(t)&&(t={click:t}),wt.tools[e]=c(wt.tools[e]||{},t),E(n)||""===I||(n=I)),m(n)?S.tools.splice(n,0,e):S.tools.push(e)),Jt(),l},wt.key=function(e,t){return S.keys?(t===!1?delete wt.keys[e]:wt.keys[e]=t,Gt(),l):l},wt.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ve),!1},outdent:function(e,t){return t.outdent(ve),!1}},Ne(ae,Rt,En),wt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return En(e)},"shift+tab":ye?"outdent":0,tab:ye?"indent":0,escape:function(e,t){return Rt.focus(),!1}},wt.el={container:zt,header:St,body:Ot,footer:jt,overlay:Bt,modal:At,drop:Nt,bubble:It},l.config=S,c(l._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),u=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>f&&(f="0"+f),10>u&&(u="0"+u),[""+t,""+n,""+r,""+i,""+o,""+f,""+u]},replace:Fe,format:Ue,dom:{set:gt,reset:vt,get:at,id:tt,classes:{set:Je,reset:Qe,get:Ge},attributes:{set:je,reset:Me,get:De},data:{set:He,reset:Be,get:Ye},offset:Ke,point:Xe,size:Ze,content:{set:nt,reset:it,get:rt},closest:Ve,parent:ot,children:ft,next:ut,previous:lt,before:dt,after:pt,prepend:ht,append:bt},el:et,event:{set:Ne,reset:Ie,fire:Pe,x:Ae},hooks:C,hook:{set:ze,reset:Se,fire:Oe}}),wt};