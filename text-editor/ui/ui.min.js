/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.3.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function V(e,t,r){return k(e)?k(t)?(k(C[e])||(C[e]={}),k(r)||(r=Object.keys(C[e]).length),C[e][r]=t,l):C[e]:C}function ee(e,t){return k(e)?k(t)&&k(C[e])?(delete C[e][t],l):(C[e]={},l):(C={},l)}function te(e,t,r){if(!k(C[e]))return C[e]={},l;if(k(r))k(C[e][r])&&C[e][r].apply(l,t);else for(var n in C[e])C[e][n].apply(l,t);return l}function re(e){return e&&e.preventDefault(),!1}function ne(e,t,r){return t?(t.addEventListener(e,r,!1),V("on:"+e,r,Xe(t)),l):void 0}function ie(e,t,r){return t?(t.removeEventListener(e,r,!1),ee("on:"+e,Xe(t)),l):void 0}function oe(e,t,r){if("createEvent"in f){var n=f.createEvent("HTMLEvents");n.data=r,n.initEvent(e,!0,!1),t.dispatchEvent(n)}else te("on:"+e,r,Xe(t));return l}function ue(e,t,r){e=g(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)ne(e[n],t,r);return l}function fe(e,t,r){e=g(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)ie(e[n],t,r);return l}function le(e,t,r){e=g(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)oe(e[n],t,r);return l}function ce(e,t){return setTimeout(e,t)}function ae(e){return clearTimeout(e)}function se(e,t,r){for(var o,n=0,i=t.length;i>n;++n)o=t[n],e=e.replace(x(o)?o:h(a(o),"g"),r&&r[n]||"");return e}function pe(e,t){return e.replace(/%(\d+)/g,function(e,r){return--r,k(t[r])?t[r]:e})}function de(e){return g(se(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function he(e,t){var r=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,i=ge(e);return{x:r-i.l,y:n-i.t}}function ge(e){for(var t=e.offsetLeft,r=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,r+=e.offsetTop;return{l:t,t:r}}function ve(e){return{w:e.offsetWidth,h:e.offsetHeight}}function me(e,t){for(;(e=Ge(e))&&e!==t;);return e}function Ne(e,t,r){if(e=$(e)?f.createElement(e):e,w(r)){var n,i;for(i in r)n=r[i],"style"===i?$(n)?e.setAttribute(i,n):null===n?e.removeAttribute(i):e=p(e,n):y(n)?e[i]=n:null===n?e.removeAttribute(i):e.setAttribute(i,w(n)?n.join(" "):""+n)}if(m(t))ut(e,t);else if(w(t)){var n,i;for(i in t)n=t[i],m(n)?ut(e,n):n!==!1&&Fe(e,n)}else k(t)&&t!==!1&&Fe(e,t);return e}function Xe(e){var t=e.id;return t||(t=we+"-dom:"+(new Date).getTime(),e.id=t),t}function Ze(e,t){return h("(^|\\s)"+t+"(\\s|$)").test(e.className)}function qe(e,t){Ze(e,t)||(e.className=g(e.className+" "+t))}function De(e,t){e.className=g(e.className.replace(h("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function Fe(e,t){return k(t)?void(e.innerHTML=t):e.innerHTML}function Qe(e,t){if(t!==!1){var n,r=e.children;for(n in r)Qe(r[n])}Fe(e,"")}function Ge(e){return e.parentElement||e.parentNode}function Je(e){return e.children||[]}function Ve(e){return e.nextElementSibling||e.nextSibling}function tt(e,t){var r=Ge(e);return 1===arguments.length?r||!1:e&&r===e?r:!1}function rt(e,t){Ge(e).insertBefore(t,e)}function nt(e,t){Ge(e).insertBefore(t,Ve(e))}function ut(e,t){e.appendChild(t)}function ft(e,t){var r=tt(e);if(r){if(t!==!1)for(var n=Je(e)[0];n;)ft(n);r.removeChild(e)}}function lt(e){Qe(Ne(e,!1,{style:""})),ft(e)}function ct(e,t,r){return Ne(t||"div",r,{"class":e})}function at(){if(ke._word&&ke._words){var e=(Ke.value||"").replace(h(Q[0]+"[^"+Q[0]+Q[1]+"]+?"+Q[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;Fe(Me,pe(ke["_word"+(1===t?"":"s")],[t]))}}function st(e,t){y(e)&&(e.click=e),$(e.click)&&(e.click=(ye.tools[e.click]||{}).click),k(e.active)||(e.active=1),k(e.title)||(e.title=xe[t]||"")}function pt(){Qe(ze,!1);var n,i,o,u,f,c,a,e=$(z.tools)?g(z.tools).split(/\s+/):z.tools,t=we+"-button",r=we+"-separator";z.tools=e;for(f in e)a=e[f],i=ye.tools[a],i&&(st(i,a),"|"!==(o=i.i||a)&&(o=de(o)),u="|"!==o,Pe=ct(u?t:r,u?"a":"span"),u&&(n=t+":"+de(a).replace(/\s/g,""),Pe.href="",Pe.id=n,Pe.tabIndex=-1,Pe.setAttribute(J,a),o='<i class="'+pe(be.i,[o])+" "+n+'"></i>',i.active||qe(Pe,"x"),i.text&&(o=pe('<span class="'+we+'-text">'+i.text+"</span>",[o]),qe(Pe,"text")),Fe(Pe,o),Ne(Pe,!1,i.attributes||{}),!Pe.title&&(c=i.title)&&(Pe.title=w(c)?c[0]+(c[1]?" ("+c[1]+")":""):c),ue(M,Pe,wt)),ut(ze,Pe));te("update.tools",[l])}function dt(){ye.keys=function(){var r,n,e=Object.keys(ye.keys).sort().reverse(),t={};for(r=0,n=e.length;n>r;++r)t[e[r]]=ye.keys[e[r]];return t}(),yt(1),te("update.keys",[l])}function ht(e){at(),te("on:change",[e,l])}function mt(e){function w(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var p,d,g,v,m,b,t=l.$(),r=t.before,n=t.after,i=r.slice(-1),o=n[0],u=t.length,f=ye.keys,c=TE.keys_alias,s=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),y=e.TE.key();gt[y]=1,b=Object.keys(gt).length,ce(function(){l.record()},1);for(p in f){var x=0;g=w(p);for(d in g)d=g[d],gt[c[d]||d]&&++x;if(g=g.length,x===g&&b===g&&($(f[p])&&(f[p]=ye.tools[f[p]].click),v=f[p]&&f[p](e,l),v===!1))return re(e)}if(q)for(p in q)if(m=q[p],m!==!1){if(y===m&&o===m)return"\\"===i?(l.insert(y,0),re(e)):(l.select(t.end+1),re(e));if(p===y)return l.wrap(p,m),re(e);if(i===p&&o===m){if("backspace"===y&&r.slice(-2)!=="\\"+p)return l.unwrap(p,m),re(e);if(Z&&"enter"===y&&p!==m)return l.tidy("\n"+s+X,"\n"+s).scroll(!0),re(e)}}if(Z&&!u){if("backspace"===y&&h(a(X)+"$").test(r))return l.outdent(X).scroll(!0),re(e);if("enter"===y&&h("(^|\\n)("+a(X)+")+.*$").test(r))return l.insert("\n"+s,0,1).scroll(!0),re(e)}}function yt(e){w(e)?delete gt[e.TE.key()]:gt={}}function bt(e){/^focus|blur$/.test(e.type)&&yt(1),ae(vt),vt=ce(function(){ht(e)},z.debounce||0)}function wt(e){ye.exit(0,0,0);var i,t=this.getAttribute(J),r=ye.tools,n=r[t];return Ye=e.currentTarget||e.target,n&&n.active&&n.click&&(i=r[t].click(e,l,t),te("on:change",[e,l,t]),i===!1)?re(e):(l.select(),re(e))}function Kt(e){return xt=Ae,zt=ve(Se),re(e)}function At(e){xt===Ae&&p(Ke,{height:he(Ce,e).y-zt.h+"px"})}function jt(){xt=0}function Lt(){ye.exit(1)}function Ht(){e=ve(He),_t=e.w,Et=e.h,e=ve(Le),Tt=e.w,Ct=e.h}function Rt(e,t){t&&te("exit.modal."+t,[l]),le(M,Le,[e])}function Ot(t){xt=t.target,e=he(He,t),$t=e.x,kt=e.y,Ht()}function Wt(t){var i,o,r=St.header,n=St.resize;xt===r||me(xt,r)===r?(e=he(Ce,t),i=e.x-$t,o=e.y-kt,p(He,{left:(_t>Tt?i:d(i,0,Tt-_t))+"px",top:(Et>Ct?o:d(o,0,Ct-Et))+"px"})):xt===n&&(e=he(He,t),zt=ve(n),p(He,{width:e.x+zt.w/4+"px",height:e.y+zt.h/4+"px"}))}function Mt(){xt=0}function It(e,t,r){return{header:e,body:t,footer:r}}function Bt(e){var t=Ye,n=e&&e.target||0;(!n||n!==t&&me(n,t)!==t)&&(Ye=0,lt(Re),fe(M,T,Bt),ye.exit(1))}function Pt(e){function f(){i&&(o=ve(i),p(n,{width:o.w+"px",height:o.h+"px"}))}var n,i,o,t=l.get(),r="";return-1===t.indexOf("</html>")&&(r='<!DOCTYPE html><html dir="'+z.dir+'"><head><meta charset="utf-8"><style>'+z.css+"</style></head><body>"+t+"</body></html>"),n=Ne("iframe",!1,{"class":we+"-portal",src:"data:text/html,"+encodeURIComponent(r)}),!tt(Le)&&t?ye.overlay(n,1,function(){i=Je(Le)[0],f(),ue(P,u,f),te("enter.overlay.preview",[e,l,[t,r],i])}):(fe(P,u,f),Lt()),re(e)}var t="⌘",r="…",i="⇥",o="⇧",u=window,f=document,l=this,c=l._,a=c.x,s=c.extend,p=c.css,d=c.edge,h=c.pattern,g=c.trim,v=l.is,m=v.e,y=v.f,b=v.i,w=v.o,x=v.r,$=v.s,k=function(e){return!v.x(e)},_=f.documentElement,T=(f.head,f.body),C={},S=function(){},z=s({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),K="keydown",A="keyup",j="copy",L="cut",H="paste",R="touchstart mousedown",O="touchend mouseup",W="touchmove mousemove",M="click",I="focus",B="blur",Y="input",P="orientationchange resize",U=B+" "+j+" "+L+" "+I+" "+Y+" "+K+" "+H,N=z.languages,X=z.tab,Z=z.auto_tab,q=z.auto_close,D=z.unit[0][0],Q=(z.unit[0][1],z.unit[1][0]),G=z.unit[1][1],J="data-tool-id",ye=l.ui={};l.tidy=function(e,t){var r=l.$(),n=g(r.before)?e:"",i=g(r.after)?k(t)?t:e:"";return l.trim(n,i)},l.i=function(){return g(l.replace(/\s+/g," "))},l.format=function(e,t,r,n){w(e)||(e=[e]),k(r)||(r=" "),k(n)||(n="");var i=l[0]().$(),o=(e[0]?D[0]+e[0]+D[1]:"")+n,u=n+(e[0]?D[0]+D[2]+(e[1]||e[0].split(h("("+G[3]+")+"))[0])+D[1]:""),f=a(o),c=a(u),s=h("^"+f+"([\\s\\S]*?)"+c+"$"),p=h(f+"$"),d=h("^"+c),g=i.before,v=i.after;return i.length?r=!1:l.insert(N.placeholders[""]),l.toggle(t?!s.test(i.value):!p.test(g)&&!d.test(v),[function(e){e.unwrap(o,u,1).tidy(h(Q[0]+"[^"+Q[0]+Q[1]+Q[2]+"]+?"+Q[1]+"$").test(g)?"":r,h("^"+Q[0]+Q[2]+"[^"+Q[0]+Q[1]+"]+?"+Q[1]).test(v)?"":r).wrap(o,u,t)[1]()},function(e){e.unwrap(o,u,t)[1]()}])};var Pe,be=z.classes,we=be[""],xe=N.tools,$e=N.buttons,ke=N.others,_e=we+"-textarea "+we+"-content block",Ee=ct(we),Te=ct(we+"-header"),Ce=ct(we+"-body"),Se=ct(we+"-footer"),ze=ct(we+"-tool"),Ke=Ne(l.target,!1,z.attributes),Ae=ct(we+"-resize s"),je=ct(we+"-description"),Le=ct(we+"-overlay"),He=Ne("div"),Re=Ne("div"),Oe=Ne("div"),We=ct("left","span"),Me=ct("right","span"),Ie=ct(we+"-preview","a"),Be=0,Ye=0;z.suffix||(z.suffix=D[1]);var gt={},vt=null;l.create=function(e,t){w(e)&&(z=s(z,e));var r=tt(Ke);if(qe(Ke,_e),r&&"P"===r.nodeName?(rt(r,Ee),Be=r,ft(r,!1)):rt(Ke,Ee),Ee.dir=z.dir,ut(Ee,Te),ut(Ee,Ce),ut(Ee,Se),ut(Ee,Ae),ut(Ce,Ke),z.tools&&(ut(Te,ze),ut(Se,je),ut(je,We),ut(je,Me)),ue(K,Ke,mt),ue(A,Ke,yt),ue(U,Ke,bt),ue(R,Ae,Kt),ue(W,T,At),ue(O,T,jt),ke.preview){var n=xe.preview;Ie.href="",Ie.title=w(n)?n[0]+(n[1]?" ("+n[1]+")":""):n,ut(We,Ie),Fe(Ie,ke.preview)}return ht(null),pt(),dt(),0!==t?te("create",[l]):l},l.update=function(e,t){return Ze(Ke,_e)&&l.destroy(0),(0!==t?te("update",[l]):l).create(e,0)},l.destroy=function(e){return Ze(Ke,_e)?(ye.exit(0,0,0),De(Ke,_e),w(z.tools)&&(z.tools=z.tools.join(" ")),z.keys&&(fe(K,Ke,mt),fe(A,Ke,yt)),fe(R,Ae,Kt),fe(W,T,At),fe(O,T,jt),fe(U,Ke,bt),Be?(rt(Ee,Be),ut(Be,Ke),Be=0):rt(Ee,Ke),lt(Ee),0!==e?te("destroy",[l]):l):l};var e,zt,xt=0,$t=0,kt=0,_t=0,Et=0,Tt=0,Ct=0,St={};ye.exit=function(e,t,r){var i,n={overlay:function(){fe(M,Le,Lt),lt(Le)},modal:function(){fe(R,Ce,Ot),fe(W,Ce,Wt),fe(O,T,Mt),fe(M,St.x,Rt),lt(He)},drop:function(){lt(Re)},bubble:function(){lt(Oe)}};if(t)if(w(t))for(i in t)i=t[i],n[i]&&n[i](),0!==r&&te("exit."+i,[l]);else n[t]&&n[t](),0!==r&&te("exit."+i,[l]);else for(i in n)n[i]();return e&&l.select(),0!==r&&te("exit",[l]),l},ye.overlay=function(e,t,r){return ye.exit(0,0,0).blur(),yt(1),ut(Ce,Ne(Le,e.length||m(e)?ct(we+"-overlay-content","div",e):"")),t&&ue(M,Le,Lt),y(r)?r(Le):Ne(Le,r),te("enter.overlay",[l]),te("enter",[l]),l},ye.modal=function(){ye.overlay("",1);var o,f,e=arguments,t=e[0],r=e[1],n=e[2],i=we+"-modal";w(t)&&(t="default",r=e[0],n=e[1]),f=de(t),Ne(He,!1,{"class":i+" "+f}),k(r.body)&&(r.body=Ne("div",r.body,{"class":i+"-content "+f}));for(o in r)i[1]=o,St[o]=ct(i+"-"+pe(o,i)+" "+f,0,r[o]);return St.x=ct(we+"-x "+f),St.resize=ct(we+"-resize se "+f),Qe(He),ut(Ce,Ne(He,St,{style:""})),ye.modal.fit(),nt(He,Le),ue(M,St.x,Rt),ue(R,St.header,re),ue(R,St.resize,re),ue(R,Ce,Ot),ue(W,Ce,Wt),ue(O,T,Mt),y(n)&&(St.overlay=Le,St.modal=He,n(St)),te("enter.modal."+t,[l]),te("enter.modal",[l]),te("enter",[l]),l},ye.modal.fit=function(e){Ht();var t=Ct/2-Et/2,r=Tt/2-_t/2;return w(e)?(r=e[0],t=e[1]):(r=d(r,0),t=d(t,0)),p(He,{left:r+"px",top:t+"px","min-width":_t+"px","min-height":Et+"px",visibility:"visible"}),te("fit.modal",[l]),te("fit",[l]),l};var Yt={"class":we+"-button",name:"y"};return ye.alert=function(e,t,r,n){var i=Ne("button",$e.okay,Yt),o="alert";return r=r||S,w(e)&&(o+=":"+e[0],e=e[1]||e[0]),ue(M,i,function(e){return r(e,l),Rt(e,o+".y"),re(e)}),ue(K,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?le(M,i,[e,l]):void 0}),ye.modal(o,It(e,t,i),n),i.focus(),l},ye.confirm=function(e,t,r,n,i){function a(e){return y(r)&&r(e,l),Rt(e,f+".y"),re(e)}function s(e){return y(n)&&n(e,l),Rt(e,f+".n"),re(e)}var c,o=Ne("button",$e.okay,Yt),u=Ne("button",$e.cancel,Yt),f="confirm";return u.name="n",w(e)&&(f+=":"+e[0],e=e[1]||e[0]),ue(M,o,a),ue(M,u,s),ue(K,o,function(e){return c=e.TE.key,c("arrowright")?(u.focus(),re(e)):c("arrowleft")?re(e):c("enter")?(a(e),re(e)):c("escape")?(Rt(e,f+".y"),re(e)):void 0}),ue(K,u,function(e){return c=e.TE.key,c("arrowright")?re(e):c("arrowleft")?(o.focus(),re(e)):c("enter")?(s(e),re(e)):c("escape")?(Rt(e,f+".n"),re(e)):void 0}),ye.modal(f,It(e,t,[o,u]),i),u.focus(),l},ye.prompt=function(e,t,r,n,i,o){function v(){c.focus(),"placeholder"in c&&c.select()}function m(e){return re(e)}function b(e){return h=c.value,!r||g(h)&&h!==t?(Rt(e,a+".y"),re(e),n(e,l,h!==t?h:"",t)):(v(),m(e))}function x(e){return Rt(e,a+".n"),re(e)}var s,d,h,u=Ne("button",$e.okay,Yt),f=Ne("button",$e.cancel,Yt),c=Ne("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":we+"-input block"}),a="prompt",p=[];if(w(e)&&(a+=":"+e[0],e=e[1]||e[0]),y(i)&&(o=i,i=0),1===i)c=Ne("textarea",t,{placeholder:t.split("\n")[0],"class":we+"-textarea block"});else if(2===i){for(d in t)p.push(Ne("option",t[d],{value:d,selected:d===r||null}));c=Ne("select",p,{"class":we+"-select block"})}return n=n||S,c.name="data",f.name="n",ue(K,c,function(e){return s=e.TE.key,s("enter")?b(e):s("escape")||s("backspace")&&!this.value?x(e):s("arrowup")?m(e):s("arrowdown")?(u.focus(),re(e)):void 0}),ue(K,u,function(e){return s=e.TE.key,s("enter")?b(e):s("escape")?x(e):s("arrowup")?(c.focus(),re(e)):s("arrowright")?(f.focus(),re(e)):s(/^arrow(down|left)$/)?m(e):void 0}),ue(K,f,function(e){return s=e.TE.key,s(/^enter|escape$/)?x(e):s("arrowup")?(c.focus(),re(e)):s(/^arrow(right|down)$/)?m(e):s("arrowleft")?(u.focus(),re(e)):void 0}),ue(M,u,b),ue(M,f,x),ye.modal(a,It(e,c,[u,f]),o),v(),l},ye.drop=function(){ye.exit(0,0,0);var n,e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),n=de(t),Qe(Re),ut(T,Ne(Re,!1,{"class":we+"-drop "+n})),y(r)?r(Re):Ne(Re,r),ye.drop.fit(),ue(M,T,Bt),te("enter.drop."+t,[l]),te("enter.drop",[l]),l},ye.drop.fit=function(e){var o,t=ve(_),r=ve(Re),n=t.w/2-r.w/2,i=t.h/2-r.h/2;return!k(e)&&Ye&&(o=ge(Ye),n=o.l,i=o.t+ve(Ye).h),w(e)?(n=e[0],i=e[1]):(n=d(n,0,t.w-r.w),i=d(i,0,t.h-r.h)),p(Re,{left:n+"px",top:i+"px",visibility:"visible"}),te("fit.drop",[l]),te("fit",[l]),l},ye.menu=function(e,t,r,n){var i='<span class="'+we+'-current menu">%1</span>',o="";return t===!1?ye.tool(e,t):(w(t)&&(o=t[0],t=t[1],i='<i class="'+pe(be.i,[o])+'"></i> '+i),ye.tool(e,{i:o,text:pe(i,[r[t]&&r[t].text||t,o]),click:function(t){var u,f,c,a,p,d,h,n={href:"","class":we+"-button"};return ye.drop("menu menu-"+de(e),function(e){function t(e){return a=this,h=r[a.getAttribute(J)],u=Fe(a),h&&h.active&&y(d=h.click)&&(d=d(e,l),Ye&&Fe(Je(Ye)[0]||Ye,pe(i,[u,o])),d===!1)?re(e):(l.select(),re(e))}for(c in r)p=r[c],p=$(p)?ye.tools[p]:p,p&&(st(p,c),n[J]=c,f=Ne("a",p.text||c,s(n,p.attributes||{})),!f.title&&(d=p.title)&&(f.title=w(d)?d[0]+(d[1]?" ("+d[1]+")":""):d),p.active||qe(f,"x"),r[c]=p,ue(M,f,t),ut(e,f))}),!1}},n),te("update.menus",[l]),l)},ye.menu.fit=function(e){return ye.drop.fit(e)},ye.bubble=function(){ye.exit(0,0,0);var n,e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),n=de(t),Qe(Oe),ut(T,Ne(Oe,!1,{"class":we+"-bubble "+n})),y(r)?r(Oe):Ne(Oe,r),ye.bubble.fit(),te("enter.bubble."+t,[l]),te("enter.bubble",[l]),l},ye.bubble.fit=function(e){var t=l.$(1),r=ge(Ke),n=p(Ke,"line-height"),i="border-",o="-width",u=t.caret[0].x+r.l-Ke.scrollLeft,f=t.caret[1].y+r.t+n-Ke.scrollTop,c=p(Ce,[i+"top"+o,i+"bottom"+o,i+"left"+o,i+"right"+o]),a=ve(Ce),s=ve(Oe),h=c[0]+c[1],g=c[2]+c[3];return w(e)?(u=e[0],f=e[1]):(u=d(u,r.l,r.l+a.w-s.w-g),f=d(f,r.t,r.t+a.h-s.h-h)),p(Oe,{left:u+"px",top:f+"px",visibility:"visible"}),te("fit.bubble",[l]),te("fit",[l]),l},ye.tool=function(e,t,r){var n="";return"|"!==e&&(z.tools=z.tools.filter(function(t,r){return t===e?(n=r,!1):!0})),t===!1?delete ye.tools[e]:("|"===e?(r=t,t={}):(y(t)&&(t={click:t}),ye.tools[e]=s(ye.tools[e]||{},t),k(r)||""===n||(r=n)),b(r)?z.tools.splice(r,0,e):z.tools.push(e)),pt(),l},ye.key=function(e,t){return z.keys?(t===!1?delete ye.keys[e]:ye.keys[e]=t,dt(),l):l},ye.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(X),!1},outdent:function(e,t){return t.outdent(X),!1}},ue(M,Ie,Pt),ye.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Pt(e)},"shift+tab":Z?"outdent":0,tab:Z?"indent":0,escape:function(e,t){return Ie.focus(),!1}},ye.el={container:Ee,header:Te,body:Ce,footer:Se,overlay:Le,modal:He,drop:Re,bubble:Oe},l.config=z,s(l._,{time:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours(),o=e.getMinutes(),u=e.getSeconds(),f=e.getMilliseconds();return 10>r&&(r="0"+r),10>n&&(n="0"+n),10>i&&(i="0"+i),10>o&&(o="0"+o),10>u&&(u="0"+u),10>f&&(f="0"+f),[""+t,""+r,""+n,""+i,""+o,""+u,""+f]},replace:se,format:pe,el:Ne,event:{set:ue,reset:fe,fire:le,x:re},hooks:C,hook:{set:V,reset:ee,fire:te}}),ye};