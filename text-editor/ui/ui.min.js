/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.9.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(n,e){function Tn(n){return n.toLowerCase()}function Mn(n){return j(n)?y(n).split(/\s+/):n}function Sn(n){return F(n)?n.join(" "):n}function Nn(n,e){return-1!==n.indexOf(e)}function On(n){return Object.keys(n)}function Hn(n){return n.length}function Bn(n){return Hn(On(n))}function _n(n,e,t){return A(n)?A(e)?(A(b[n])||(b[n]={}),A(t)||(t=Bn(b[n])),b[n][t]=e,s):b[n]:b}function qn(n,e){return A(n)?A(e)&&A(b[n])?(delete b[n][e],s):(b[n]={},s):(b={},s)}function zn(n,e,t){if(!A(b[n]))return b[n]={},s;if(A(t))A(b[n][t])&&b[n][t].apply(s,e);else for(W in b[n])b[n][W].apply(s,e);return s}function Rn(n,e,t){if(F(e))for(W in e)Rn(n,W,e[W]);else n[(null===t?"remove":"set")+"Attribute"](e,t)}function Dn(n,t,r){if(!t){for(e={},W=0,U=n.attributes,K=Hn(U);K>W;++W)P=U[W],e[P.name]=P.value;return Bn(e)?e:A(r)?r:{}}if(j(t))return Dn(n,[t],[A(r)?r:""])[0];e=[];for(W in t)W=t[W],W=n.getAttribute(W)||"",e.push(W);return Hn(e)?e:A(r)?r:[]}function In(n,e){if(F(e))for(W in e)In(n,e[W]);else if(A(e))n.removeAttribute(e);else for(In(n,"class"),W=0,U=n.attributes,K=Hn(U);K>W;++W)U[W]&&In(n,U[W].name)}function Wn(n,e,t){if(F(e))for(W in e)Wn(n,W,e[W]);else Rn(n,"data-"+e,t)}function Un(n,t,r){if(!t){for(e={},W=0,U=n.attributes,K=Hn(U);K>W;++W)P=U[W],"data-"===P.name.slice(0,5)&&(e[P.name]=P.value);return Bn(e)?e:A(r)?r:{}}if(j(t))return Un(n,[t],[A(r)?r:""])[0];e=[];for(W in t)W=t[W],W=Dn(n,"data-"+W),e.push(W);return Hn(e)?e:A(r)?r:[]}function Kn(n,e){if(F(e))for(W in e)In(n,"data-"+e[W]);else if(A(e))In(n,"data-"+e);else for(W=0,U=n.attributes,K=Hn(U);K>W;++W)U[W]&&"data-"===U[W].name.slice(0,5)&&In(n,U[W].name)}function Pn(n){return n&&n.preventDefault(),!1}function Jn(n,e,t){if(e){for(n=Mn(n),W=0,U=Hn(n);U>W;++W)e.addEventListener(n[W],t,!1),_n("on:"+n[W],t,ce(e));return s}}function Zn(n,e,t){if(e){for(n=Mn(n),W=0,U=Hn(n);U>W;++W)e.removeEventListener(n[W],t,!1),qn("on:"+n[W],ce(e));return k(e)&&e.id.split(":")[0]===Oe+"-dom"&&In(e,"id"),s}}function Vn(n,e,t){n=Mn(n);var i,r="createEvent"in c;for(W=0,U=Hn(n);U>W;++W)r?(i=c.createEvent("HTMLEvents"),i.data=t,i.initEvent(n[W],!0,!1),e.dispatchEvent(i)):zn("on:"+n[W],t,ce(e));return s}function Yn(n,e,t){for(W=0,U=Hn(e),K;U>W;++W)K=e[W],n=n.replace($(K)?K:v(p(K),"g"),t&&t[W]||"");return n}function Xn(n,e){return n.replace(/%(\d+)/g,function(n,t){return--t,A(e[t])?e[t]:n})}function Gn(n){return y(Yn(Tn(n),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Qn(n,e){var t=e.touches?e.touches[0].pageX:e.pageX,r=e.touches?e.touches[0].pageY:e.pageY,i=ne(n);return{x:t-i.l,y:r-i.t}}function ne(n){for(P=n.offsetLeft,Q=n.offsetTop;n=n.offsetParent;)P+=n.offsetLeft,Q+=n.offsetTop;return{l:P,t:Q}}function ee(n){return n===f?{w:n.innerWidth,h:n.innerHeight}:{w:n.offsetWidth,h:n.offsetHeight}}function te(n,e){for(;(n=pe(n))&&n!==e;);return n}function re(n,e){e=Mn(e);for(W in e)n.classList.add(e[W])}function ie(n,t,r){if(!t)return e=Mn(n.className),Hn(e)?e:A(r)?r:[];if(j(t))return ie(n,[t],[A(r)?r:""])[0];e=[];for(W in t)W=t[W],n.classList.contains(W)&&e.push(W);return Hn(e)?e:A(r)?r:[]}function ue(n,e){if(A(e)){e=Mn(e);for(W in e)n.classList.remove(e[W])}else In(n,"class")}function oe(n,e){e=Mn(e);for(W in e)n.classList.toggle(e[W])}function fe(n,e,t){if(n=n||"div",n=j(n)?c.createElement(n):n,F(t)){e||(A(t.html)?(e=t.html,delete t.html):A(t.text)&&(e=t.text,delete t.text));for(W in t)if(en=t[W],"classes"===W)re(n,en);else if("data"===W)for(U in en)en=en[U],null===en?Kn(n,U):Wn(n,U,en);else"css"===W?j(en)?Rn(n,"style",en):null===en?In(n,"style"):a(n,en):C(en)?n[W]=en:null===en?In(n,W):Rn(n,W,E(en)?en.join(" "):""+en)}if(k(e))Fe(n,e);else if(F(e))for(W in e)en=e[W],k(en)?Fe(n,en):en!==!1&&se(n,en);else A(e)&&e!==!1&&se(n,e);return n}function ce(n){var e=n.id;return e||(e=Oe+"-dom:"+Math.floor(Date.now()*Math.random()),n.id=e),e}function se(n,e){n.innerHTML=e}function le(n,e){return n.innerHTML||(A(e)?e:"")}function ae(n,e){if((!A(e)||e)&&(_=he(n)))for(W=0,U=Hn(_);U>W;++W)ae(_[W]);se(n,"")}function de(n){return Array.prototype.slice.call(n)}function pe(n){return n&&n.parentNode}function he(n){return n&&de(n.children||[])}function ve(n,e){return A(e)?j(e)?n.closest(e):te(n,e):pe(n)}function me(n){return n&&n.nextElementSibling}function ge(n){return n&&n.previousElementSibling}function ye(n){for(W=0;n=ge(n);)++W;return W}function be(n,e){return n&&j(e)?Tn(n.nodeName)===Tn(e):n&&C(e)?n===e(n):n===e}function xe(n,e){return(e=A(e)?e:c)?j(n)?/^[#.]?(?:\\.|[\w-]|[^\x00-\xa0])+$/.test(n)?"#"===n[0]&&(n=e.getElementById(n.slice(1)))?[n]:"."===n[0]&&(n=e.getElementsByClassName(n.slice(1)))||(n=e.getElementsByTagName(n))?de(n):[]:de(e.querySelectorAll(n)):we(n)?[n]:[]:[]}function we(n,e){var t=pe(n);return 1===Hn(arguments)?t||!1:n&&t===n?t:!1}function ke(n,e){V=pe(n),V&&V.insertBefore(e,n)}function Ee(n,e){V=pe(n),V&&V.insertBefore(e,me(n))}function Ce(n,e){_=n.firstChild,_?ke(_,e):Fe(n,e)}function Le(n,e){Fe(n,e)}function Fe(n,e){n.appendChild(e)}function $e(n,e){var t=pe(n);if(t){if(!A(e)||e)for(_=n.firstChild;_;)$e(_);t.removeChild(n)}}function Ae(n,e){return n.cloneNode(A(e)?!!e:!0)}function je(n,e){return pe(n).replaceChild(e,n),e}function Te(n){ae(fe(n,!1,{style:""})),$e(n)}function Me(n,e,t){return fe(e,t,{"class":n})}function ut(n){return!n||A(n.active)&&!n.active}function ot(n,e,t){return C(n)&&(n={click:n}),j(n.click)&&(n.click=(t[n.click]||{}).click),n.title=He[e]||"",A(n.attributes)||(n.attributes={}),t[e]&&(t[e]=n),n}function ft(n){Se.exit(0,0,0);var e=Un(this,"tool-id"),t=Se.tools,r=t[e];return Se.drop.target=n.currentTarget||n.target,!ut(r)&&C(U=r.click)&&(U=U(n,s,e),zn("on:change",[n,s,e]),U===!1)?Pn(n):(s.select(),Pn(n))}function ct(n){if(Q=this,(K=n.TE.key)(/^(escape|f10)$/))Se.exit(1);else if(K("enter")||K("arrowdown")&&Un(Q,"ui-drop"))Se.drop.target=Q,Vn(cn,Q,[n]);else if(K("arrowright")&&(P=me(Q))){for(;!be(P,"a")&&P;)P=me(P);P&&P.focus()}else if(K("arrowleft")&&(P=ge(Q))){for(;!be(P,"a")&&P;)P=ge(P);P&&P.focus()}return Pn(n)}function lt(){ae(Ke,0);var i,u,o,f,c,l,a,n=Se.tools,e=Mn(N.tools),t=Oe+"-button",r=Oe+"-separator";N.tools=e;for(l in e)a=e[l],u=n[a],(u||u==={})&&(u=ot(u,a,n),o=u.i||a,"|"===o||Nn(o,"<")||(o=Gn(o)),f="|"!==o,c=Gn(a).replace(/[\/\s]/g,"-"),rt=Me(f?t+" "+t+"-"+c:r+" "+r+"-"+l,f?"a":"span"),f?(rt=u.target||rt,i=t+":"+c,Rn(rt,{href:An,id:i,tabindex:-1}),Wn(rt,"tool-id",a),o=Nn(o,"<")?o:Se.i(c,o),ut(u)?re(rt,"x"):ue(rt,"x"),u.on?re(rt,"on"):ue(rt,"on"),u.text&&(o=Xn('<span class="'+Oe+'-text">'+u.text+"</span>",[o]),re(rt,"text")),se(rt,o),fe(rt,!1,u.attributes),!u.attributes.title&&(U=u.title)&&(rt.title=F(U)?U[0]+(U[1]?" ("+U[1]+")":""):U),Jn(cn,rt,ft),Jn(pn,rt,ct)):rt.id=r+":"+l,u.target=rt,(c=Un(rt,st))&&Se.menu.set(a,c),Fe(Ke,rt));zn("update.tools",[s])}function at(){Se.keys=function(){var t,n=On(Se.keys).sort().reverse(),e={};for(W=0,U=Hn(n);U>W;++W)t=n[W],e[t]=Se.keys[t];return e}(),pt(),zn("update.keys",[s])}function dt(n){function h(n){return n.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var t=s.$(),r=t.before,i=t.after,u=r.slice(-1),o=i[0],f=t.length,c=Se.keys,l=TE.keys_alias,a={control:0,shift:0,option:"alt",meta:0},d=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(W in a)n.TE[W]()&&(O[a[W]||W]=1);Z=n.TE.key(),O[Z]=1,e=Bn(O),g(function(){s.record()});for(W in c){K=h(W),_=0;for(U in K)U=K[U],O[l[U]||U]&&++_;if(K=Hn(K),_===K&&e===K&&(j(c[W])&&(c[W]=Se.tools[c[W]].click),P=C(c[W])&&c[W](n,s),P===!1))return Pn(n)}if(xn)for(W in xn)if(J=xn[W],J!==!1){if(Z===J&&o===J)return"\\"===u?(s.insert(Z,0),Pn(n)):(s.select(t.end+1),Pn(n));if(W===Z)return s.wrap(W,J),Pn(n);if(u===W&&o===J){if("backspace"===Z&&r.slice(-2)!=="\\"+W)return s.unwrap(W,J),Pn(n);if(wn&&"enter"===Z&&W!==J&&!f)return s.tidy("\n"+d+En,"\n"+d).scroll(1),Pn(n)}}if(wn&&!f){if("backspace"===Z&&v(p(En)+"$").test(r))return s.outdent(En),Pn(n);if("enter"===Z&&v("(^|\\n)("+p(En)+")+.*$").test(r))return s.insert("\n"+d,0,1).scroll(1),Pn(n)}}function pt(n){n&&n.TE&&n.TE.key?delete O[n.TE.key()]:O={}}function yt(n){return ht=ze,G=ee(Ue),Pn(n)}function bt(n){ht===ze&&a(Pe,{height:Qn(We,n).y-G.h+jn})}function xt(){ht=0}function wt(){Se.exit(1)}function kt(){e=ee(Ye),tn=e.w,I=e.h,e=ee(Ve),vt=e.w,mt=e.h}function Et(n,e){return e&&zn("exit.modal."+e,[s]),Vn(cn,Ve,[n]),Pn(n)}function Ct(n){ht=n.target,e=Qn(Ye,n),rn=e.x,un=e.y,kt()}function Lt(n){var t=gt.header,r=gt.sizer;ht===t||te(ht,t)===t?(e=Qn(We,n),P=e.x-rn,Q=e.y-un,a(Ye,{left:(tn>vt?P:d(P,0,vt-tn))+jn,top:(I>mt?Q:d(Q,0,mt-I))+jn})):ht===r&&(e=Qn(Ye,n),G=ee(r),a(Ye,{width:e.x+G.w/4+jn,height:e.y+G.h/4+jn}))}function Ft(){ht=0}function $t(n,e,t){return{header:n,body:e,footer:t}}function At(n){H=Se.drop.target,B=Xe,_=n&&n.target||0,(!_||_!==H&&te(_,H)!==H)&&(Se.drop.target=0,Se.exit(_===Pe))}var H,B,_,R,I,W,U,K,P,J,Z,e,V,X,G,Q,nn,en,tn,rn,un,t="⌘",r="…",u="⇥",o="⇧",f=window,c=document,s=new TE(n),l=s._,a=l.css,d=l.edge,p=l.x,h=l.extend,v=l.pattern,m=l.timer.reset,g=l.timer.set,y=l.trim,b={},x=function(){},w=TE.is,k=w.e,E=w.a,C=w.f,L=w.i,F=w.o,$=w.r,A=function(n){return!w.x(n)},j=w.s,T=c.documentElement,S=(c.head,c.body),N=h({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",u],outdent:["Outdent",o+"+"+u]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},e),O={},fn="blur",cn="click",pn="keydown",hn="keyup",vn="touchstart mousedown",mn="touchmove mousemove",gn="touchend mouseup",bn="orientationchange resize",xn=N.auto_close,wn=N.auto_tab,kn=N.languages,En=N.tab,Ln=(N.union[1][1],N.union[1][0]),Fn=N.union[0][1],$n=N.union[0][0],An="javascript:;",jn="px",Se=s.ui={};s.tidy=function(n,e){var t=s.$(),r=y(t.before)?n:"",i=y(t.after)?A(e)?e:n:"";return s.trim(r,i)},s.i=function(){return y(s.replace(/\s+/g," "))},s.format=function(n,e,t,r){F(n)||(n=[n]),A(t)||(t=" "),A(r)||(r="");var i=s.h,u=s[0]().$(),o=n[0].split(v("("+Fn[3]+")+"))[0],f=(n[0]?Ln[0]+n[0]+Ln[1]:"")+r,c=r+(n[0]?Ln[0]+Ln[2]+(n[1]||o)+Ln[1]:""),l=p(n[0]?Ln[0]+o+Ln[1]:""),a=p(c),d=v("^"+l+"([\\s\\S]*?)"+a+"$"),h=v(l+"$"),m=v("^"+a),g=u.before,y=u.after;return u.length?t=!1:s.insert(kn.placeholders[""]),s.toggle(e?!d.test(u.value):!h.test(g)&&!m.test(y),[function(n){n.unwrap(f,c,1).tidy(v($n[0]+"[^"+$n[0]+$n[1]+$n[2]+"]+?"+$n[1]+"$").test(g)?"":t,v("^"+$n[0]+$n[2]+"[^"+$n[0]+$n[1]+"]+?"+$n[1]).test(y)?"":t).wrap(f,c,e)},function(n){n.unwrap(f,c,e)}])[i]()};var rt,Ne=N.classes,Oe=Ne[""],He=kn.tools,Be=kn.buttons,_e=kn.labels,qe=Oe+"-textarea "+Oe+"-content block",ze=Me(Oe+"-sizer s"),Re=Me(Oe+"-sizer se"),De=Me(Oe),Ie=Me(Oe+"-header"),We=Me(Oe+"-body"),Ue=Me(Oe+"-footer"),Ke=Me(Oe+"-tool"),Pe=fe(n,!1,N.attributes),Je=Me(Oe+"-description"),Ze=fe(),Ve=fe(),Ye=fe(),Xe=fe(),Ge=fe(),Qe=fe(),nt=Me("left","span"),et=Me("right","span"),tt=0;Se.i=function(n,e,t){return n=Gn(n).replace(/[\/\s]/g,"-"),G=Xn(Ne.i,[n,e||n]),t?(ue(t),re(t,G),t):'<i class="'+G+'"></i>'},A(N.suffix)||(N.suffix=Ln[1]);var st="ui-drop-data",ht=0,rn=0,un=0,tn=0,I=0,vt=0,mt=0,gt={};s.create=function(n,e){if(s.is.create)return s;s.is.create=!0,F(n)&&(N=h(N,n));var t=we(Pe);return re(De,Oe+"-is-can-update"),re(De,Oe+"-is-can-copy"),re(Pe,qe),t&&be(t,"p")?(ke(t,De),tt=t,$e(t,!1)):ke(Pe,De),De.dir=N.direction,Fe(De,Ie),Fe(De,We),Fe(De,Ue),Fe(We,Pe),N.tools&&(Fe(Ie,Ke),Fe(Ue,Je),Fe(Je,nt),Fe(Je,et)),Jn(pn,Pe,dt),Jn(hn+" "+fn,Pe,pt),N.resize&&(Fe(De,ze),re(De,Oe+"-is-can-resize"),Jn(vn,ze,yt),Jn(mn,c,bt),Jn(gn,S,xt)),lt(),at(),0!==e?zn("create",[s]):s},s.update=function(n,e){return s.is.create&&s.destroy(0),(0!==e?zn("update",[s]):s).create(n,0)},s.destroy=function(n){return s.is.create?(s.is.create=!1,Se.exit(0,0,0),ue(Pe,qe),N.tools=Sn(N.tools),N.keys&&(Zn(pn,Pe,dt),Zn(hn,Pe,pt)),N.resize&&(Zn(vn,ze,yt),Zn(mn,c,bt),Zn(gn,c,xt)),tt?(ke(De,tt),Fe(tt,Pe),tt=0):ke(De,Pe),Te(De),0!==n?zn("destroy",[s]):s):s},s.enable=function(n){return Pe.disabled=Pe.readOnly=!1,re(De,Oe+"-is-can-update"),re(De,Oe+"-is-can-copy"),0!==n?zn("enable",[s]):s},s.disable=function(n){return Pe.disabled=!0,ue(De,Oe+"-is-can-update"),ue(De,Oe+"-is-can-copy"),0!==n?zn("disable",[s]):s},s.freeze=function(n){return Pe.disabled=!1,Pe.readOnly=!0,ue(De,Oe+"-is-can-update"),re(De,Oe+"-is-can-copy"),0!==n?zn("freeze",[s]):s},Se.exit=function(n,e,t){if(R={panel:function(){Te(Ze)},overlay:function(){Zn(cn,Ve,wt),Te(Ve)},modal:function(){Zn(cn+" "+pn,gt.x,Et),Zn(vn,We,Ct),Zn(mn,We,Lt),Zn(gn,c,Ft),Te(Ye)},drop:function(){Zn(cn,c,At),Zn(bn,f,At),Te(Xe)},bubble:function(){Te(Ge)}},pt(),e)if(F(e))for(W in e)W=e[W],R[W]&&R[W](),0!==t&&zn("exit."+W,[s]);else R[e]&&R[e](),0!==t&&zn("exit."+W,[s]);else for(W in R)R[W]();return n&&s.select(),0!==t&&zn("exit",[s]),s},Se.panel=function(n,e,t,r){function i(n){return Zn(cn+" "+pn,rn,i),Se.panel.exit(1),Pn(n)}return Se.exit(0,0,0),P=Gn(n),Q=0,r&&(P+=" "+P+"--"+Gn(r)),F(e)&&!k(e)&&(Q=Me(Oe+"-panel-header "+P,0,e.header),e=e.body),nn=Me(Oe+"-panel-body "+P,0,Me(Oe+"-panel-content "+P,0,C(e)?"":e)),C(e)&&e(nn),rn=fe("a",!1,{href:An,"class":Oe+"-a "+Oe+"-x "+P}),rn.title=Be.close,fe(Ze,!1,{"class":Oe+"-panel "+P}),Jn(cn+" "+pn,rn,i),ae(Ze,0),Q&&Fe(Ze,Q),Fe(We,fe(Ze,[nn,rn])),C(t)?t(Ze):j(t)&&fe(Ze,t),H=[s,Ze],r&&zn("enter.panel."+n+":"+r,H),zn("enter.panel."+n,H),zn("enter.panel",H),zn("enter",H),rn.focus(),s},Se.panel.fit=function(){},Se.overlay=function(n,e,t,r){return Se.exit(0,0,0),P=Gn(n),r&&(P+=" "+P+"--"+Gn(r)),Fe(We,fe(Ve,!1,{"class":Oe+"-overlay "+P})),e&&Jn(cn,Ve,wt),C(t)?t(Ve):j(t)&&fe(Ve,t),H=[s,Ve],r&&zn("enter.overlay."+n+":"+r,H),zn("enter.overlay."+n,H),zn("enter.overlay",H),zn("enter",H),s},Se.overlay.fit=function(){},Se.message=function(n,e,t,r,i){function o(n){return Zn(cn+" "+pn,rn,o),m(u),Se.overlay.exit(1),Pn(n)}var u;return P=Gn(n),i&&(P+=" "+P+"--"+Gn(i)),rn=fe("a",!1,{href:An,"class":Oe+"-a "+Oe+"-x "+P}),rn.title=Be.close,fe(Qe,C(e)?e(Qe):e,{"class":Oe+"-message "+P}),Jn(cn+" "+pn,rn,o),Se.overlay("message message-"+P,0,function(n){Fe(Qe,rn),t&&(u=g(function(){o()},t)),Fe(n,Qe)},i),C(r)?r(Qe):j(r)&&fe(Qe,r),s},Se.modal=function(){var f,l,n=arguments,e=n[0],t=n[1],r=n[2],i=n[3],u=Oe+"-modal",o=t.footer;if(F(e)&&(e="default",t=n[0],r=n[1],i=n[2]),Se.overlay(e,1,0,i).blur(),P=Gn(e),i&&(P+=" "+P+"--"+Gn(i)),fe(Ye,!1,{"class":u+" "+P}),A(t.body)&&(t.body=fe("div",t.body,{"class":u+"-content "+P})),A(o)&&F(o)&&!k(o)){l=[];for(W in o)U=o[W],k(U)?l.push(U):(U=ot(U,W,o),K=W.text||Be[W]||W,f=fe("button",K,h({name:"y["+W+"]",type:"button","class":Oe+"-button",data:{"button-id":W}},U.attributes)),Jn(cn,f,function(n){return K=o[Un(this,"button-id")].click(n,s),K===!1?Pn(n):void 0}),l.push(f));t.footer=l}for(W in t)u[1]=W,gt[W]=Me(u+"-"+Xn(W,u)+" "+P,0,t[W]);return gt.x=fe("a",!1,{href:An,"class":Oe+"-a "+Oe+"-x "+P}),gt.sizer=Re,ae(Ye,0),gt.x.title=Be.close,Fe(We,fe(Ye,gt,{style:""})),Se.modal.fit(),Ee(Ye,Ve),Jn(cn+" "+pn,gt.x,Et),Jn(vn,gt.header,Pn),Jn(vn,gt.sizer,Pn),Jn(vn,We,Ct),Jn(mn,We,Lt),Jn(gn,c,Ft),C(r)&&r(gt),H=[s,Ye,gt],i&&zn("enter.modal."+e+":"+i,H),zn("enter.modal."+e,H),zn("enter.modal",H),zn("enter",H),gt.x.focus(),s},Se.modal.fit=function(n){return kt(),P=vt/2-tn/2,Q=mt/2-I/2,F(n)?(A(n[0])&&(P=n[0]),A(n[1])&&(Q=n[1])):(P=d(P,0),Q=d(Q,0)),a(Ye,{left:P+jn,top:Q+jn,"min-width":tn+jn,"min-height":I+jn,visibility:"visible"}),H=[s,Ye,gt],zn("fit.modal",H),zn("fit",H),s};var jt={"class":Oe+"-button",name:"y"};return Se.alert=function(n,e,t,r,i){var u=fe("button",Be.okay,jt),o="alert";return t=t||x,F(n)&&(o+=":"+n[0],n=n[1]||n[0]),Jn(cn,u,function(n){return t(n,s),Et(n,o+".y")}),Jn(pn,u,function(n){var e=n.TE.key;return e(/^(escape|enter)$/)&&Vn(cn,u,[n]),Pn(n)}),Se.modal(o,$t(n,e,u),r,i),u.focus(),s},Se.confirm=function(n,e,t,r,i,u){function a(n){return C(t)&&t(n,s),Et(n,c+".y")}function d(n){return C(r)&&r(n,s),Et(n,c+".n")}var l,o=fe("button",Be.okay,jt),f=fe("button",Be.cancel,jt),c="confirm";return f.name="n",Jn(cn,o,a),Jn(cn,f,d),Jn(pn,o,function(n){return l=n.TE.key,l("arrowright")?f.focus():l("enter")?a(n):l("escape")&&Et(n,c+".y"),Pn(n)}),Jn(pn,f,function(n){return l=n.TE.key,l("arrowleft")?o.focus():l("enter")?d(n):l("escape")&&Et(n,c+".n"),Pn(n)}),Se.modal(c,$t(n,e,[o,f]),i,u),f.focus(),s},Se.prompt=function(n,e,t,r,i,u,o){function m(){l.focus(),"placeholder"in l&&l.select()}function g(n){return p=l.value,C(t)&&!t(p)?m():!t||y(p)&&p!==e?(Et(n,a+".y"),r(n,s,p!==e?p:"",e)):m(),Pn(n)}function b(n){return Et(n,a+".n")}var p,h,v,f=fe("button",Be.okay,jt),c=fe("button",Be.cancel,jt),l=fe("input",!1,{type:"text",value:e,placeholder:e,spellcheck:"false","class":Oe+"-input block"}),a="prompt",d=[];if(i=i||0,1===i)l=fe("textarea",e,{placeholder:e.split("\n")[0],"class":Oe+"-textarea block",spellcheck:"false"});else if(2===i){for(W in e)d.push(fe("option",e[W],{value:W,selected:W===t||null}));l=fe("select",d,{"class":Oe+"-select block"})}return r=r||x,l.name="data",c.name="n",Jn(pn,l,function(n){return h=n.TE.key,v=n.TE.control,h("enter")&&0===i||v("enter")?g(n):h("escape")||h("backspace")&&!this.value?b(n):h("arrowdown")&&0===i||h("enter")&&2===i||v("arrowdown")?(f.focus(),Pn(n)):void 0}),Jn(pn,f,function(n){return h=n.TE.key,h("enter")?g(n):h("escape")?b(n):h("arrowup")?l.focus():h("arrowright")&&c.focus(),Pn(n)}),Jn(pn,c,function(n){return h=n.TE.key,h(/^(enter|escape)$/)?b(n):h("arrowup")?l.focus():h("arrowleft")&&f.focus(),Pn(n)}),Jn(cn,f,g),Jn(cn,c,b),Se.modal(a,$t(n,l,[f,c]),u,o),m(),s},Se.drop=function(){Se.exit(0,0,0);var n=arguments,e=n[0],t=n[1],r=n[2];return 1===Hn(n)&&(e="default",t=n[0],r=n[1]),P=Gn(e),ae(Xe,0),Fe(S,fe(Xe,!1,{"class":Oe+"-drop "+P})),C(t)?t(Xe):fe(Xe,t),Se.drop.fit(),r===!1||(Jn(cn,c,At),Jn(bn,f,At)),H=[s,Xe],zn("enter.drop."+e,H),zn("enter.drop",H),s},Se.drop.fit=function(n){return H=ee(T),B=ee(Xe),_=Se.drop.target,P=H.w/2-B.w/2,Q=H.h/2-B.h/2,!A(n)&&_&&(e=ne(_),P=e.l,Q=e.t+ee(_).h),F(n)?(A(n[0])&&(P=n[0]),A(n[1])&&(Q=n[1])):(P=d(P,0,H.w-B.w),Q=d(Q,0,Math.max(H.h,ee(f).h)-B.h)),a(Xe,{left:P+jn,top:Q+jn,visibility:"visible"}),H=[s,Xe],zn("fit.drop",H),zn("fit",H),s},Se.menu=function(n,t,r,i){var f,u=Se.tools,o=0;if(t===!1)return Se.tool(n,t);for(i in r)tn="%"===i[0],f=r[i],f=j(f)&&!tn?u[f]:f,f&&(f=ot(f,i,u),r[i]=f);return Se.tool(n,{i:F(t)?t[0]:0,text:F(t)?t[1]||0:t&&r[t]&&r[t].text||t,click:function(c){var l=Se.drop.target=u[n].target;return Se.drop("menu menu-"+Gn(n),function(c){function a(o){return Q=this,e=Un(Q,"tool-id"),J=r[e],J=j(J)?u[J]:J||{},Z=le(Q),!ut(J)&&C(i=J.click)&&(i=i(o,s),J.i&&(u[n].i=J.i),Se.menu.set(n,F(J.text)?[J.text[0],e]:F(t)?[t[0],e]:e),i===!1)?(s.select(),Pn(o)):(s.select(),Pn(o))}function d(n){if(Q=this,(K=n.TE.key)("escape"))Se.exit(1);else if(K("enter"))Vn(cn,Q,[n]);else if(K("f10")&&l)l.focus();else if(K("arrowdown")&&(P=me(Q))){for(;!be(P,"a")&&P;)P=me(P);P&&P.focus()}else if(K("arrowup")&&(P=ge(Q))){for(;!be(P,"a")&&P;)P=ge(P);!P&&l?(Se.exit(),l.focus()):P&&P.focus()}else K("arrowup")&&l&&(Se.exit(),l.focus());return Pn(n)}for(i in r)if(f=r[i],tn="%"===i[0],f){var p={href:tn?null:An,"class":Oe+"-"+(tn?"label":"button")};tn?U=_e[n]&&_e[n][+i.slice(1)-1]||i:(p.data={},p.data["tool-id"]=i,U=He[i]||i),X=f.text,X=F(X)?X[1]||"":X,U=F(U)?U[0]:U,G=fe(tn?"span":"a","<span>"+(tn?U||"%"+o:X||U)+"</span>",h(p,f.attributes||{})),re(G,"menu-"+Gn(i).replace(/[\/\s]/g,"-")),!p.title&&(Q=f.title)&&(G.title=F(Q)?Q[0]+(Q[1]?" ("+Q[1]+")":""):Q),tn?Rn(G,{id:Oe+"-label:"+o}):(ut(f)?re(G,"x"):ue(G,"x"),f.on?re(G,"on"):ue(G,"on"),Jn(cn,G,a),Jn(pn,G,d)),Fe(c,G),++o}g(function(){(xe('[data-tool-id="'+Un(l,st)+'"]',c)[0]||xe("a",c)[0]).focus()},1)}),!1}},i),Wn(u[n].target,{"ui-drop":n}),u[n].data=r,Se.menu.set(n,t)},Se.menu.set=function(n,e){var u,o,t=Se.tools[n]||{},r=t.target,i=t.data;return r?(F(e)?Wn(r,st,e[1]||""):(Wn(r,st,e),e=i[e]&&i[e].text||e),F(e)?(o=e[0],o=Nn(o,"<")?o:Se.i(o,t.i),e=A(e[1])?e[1]:0,e=e&&i[e]&&i[e].text||e,e=o+(0!==e?"<span>"+(F(e)?e[1]||e:e)+"</span>":"")):o=Se.i(n,t.i),(u=xe("."+Oe+"-text",r)[0])?(re(r,"text"),se(u,e)):(ue(r,"text"),se(r,o)),s):s},Se.bubble=function(){Se.exit(0,0,0);var n=arguments,e=n[0],t=n[1];return 1===Hn(n)&&(e="default",t=n[0]),P=Gn(e),ae(Ge,0),Fe(S,fe(Ge,!1,{"class":Oe+"-bubble "+P})),C(t)?t(Ge):fe(Ge,t),Se.bubble.fit(),H=[s,Ge],zn("enter.bubble."+e,H),zn("enter.bubble",H),s},Se.bubble.fit=function(n){G=s.$(1),e=ne(Pe),I=a(Pe,"line-height");var t="border-",r="-width";P=G.caret[0].x+e.l-Pe.scrollLeft,Q=G.caret[1].y+e.t+I-Pe.scrollTop,B=a(We,[t+"top"+r,t+"bottom"+r,t+"left"+r,t+"right"+r]);var i=ee(We),u=ee(Ge),o=B[0]+B[1],f=B[2]+B[3];return F(n)?(A(n[0])&&(P=n[0]),A(n[1])&&(Q=n[1])):(P=d(P,e.l,e.l+i.w-u.w-f),Q=d(Q,e.t,e.t+i.h-u.h-o)),a(Ge,{left:P+jn,top:Q+jn,visibility:"visible"}),H=[s,Ge],zn("fit.bubble",H),zn("fit",H),s},Se.panel.exit=function(n){return Se.exit(n,"panel")},Se.overlay.exit=function(n){return Se.exit(n,"overlay")},Se.modal.exit=function(n){return Se.exit(n,"modal")},Se.drop.exit=function(n){return Se.exit(n,"drop")},Se.bubble.exit=function(n){return Se.exit(n,"bubble")},Se.tool=function(n,e,t){var r=Se.tools;return U="",K=A(r[n])?"update":"create","|"!==n&&(N.tools=Mn(N.tools).filter(function(e,t){return e===n?(U=t,!1):!0})),e===!1?(delete r[n],K="destroy"):("|"===n?(t=e,e={}):(C(e)&&(e={click:e}),r[n]=h(r[n]||{},e),A(t)||""===U||(t=U)),L(t)?N.tools.splice(t,0,n):N.tools.push(n)),zn(K+".tool."+n,[s,r[n]]),lt(),s},Se.separator=function(n,e){return Se.tool("|",n!==!1?{attributes:n||{}}:!1,e)},Se.key=function(n,e){var t=Se.keys;return K=A(t[n])?"update":"create",e===!1?(delete t[n],K="destroy"):t[n]=e,zn(K+".key."+n,[s,t[n]]),at(),s},Se.key.set=function(n){O[n]=1},Se.key.reset=function(n){n?delete O[n]:O={}},Se.tools={"|":{},undo:{i:"undo",click:function(n,e){return e.undo(),!1}},redo:{i:"repeat",click:function(n,e){return e.redo(),!1}},indent:function(n,e){return e.indent(En),!1},outdent:function(n,e){return e.outdent(En),!1}},Se.keys={"control+y":"redo","control+z":"undo",escape:function(n,e){return X=":not([tabindex]):not([disabled])",(G=xe("input"+X+",button"+X+",select"+X+",textarea"+X+",a[href]"+X+",[contenteditable]"+X+',[tabindex]:not([tabindex="-1"])',c,0))&&-1!==(Q=G.indexOf(Pe))?((G[Q+1]||c).focus(),!1):void 0},f10:function(n,e){return xe("a",Ke)[0].focus(),!1},tab:wn?"indent":0,"shift+tab":wn?"outdent":0},Se.el={container:De,header:Ie,body:We,footer:Ue,panel:Ze,overlay:Ve,modal:Ye,drop:Xe,bubble:Ge},s.config=N,h(TE._,{time:function(n){var e=new Date(A(n)?n:Date.now()),t=e.getFullYear(),r=e.getMonth()+1,i=e.getDate(),u=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),c=e.getMilliseconds();return 10>r&&(r="0"+r),10>i&&(i="0"+i),10>u&&(u="0"+u),10>o&&(o="0"+o),10>f&&(f="0"+f),10>c&&(c="0"+c),[""+t,""+r,""+i,""+u,""+o,""+f,""+c]},replace:Yn,format:Xn,dom:{set:Fe,reset:$e,get:xe,id:ce,copy:Ae,replace:je,classes:{set:re,reset:ue,toggle:oe,get:ie},attributes:{set:Rn,reset:In,get:Dn},data:{set:Wn,reset:Kn,get:Un},is:be,offset:ne,pointer:Qn,size:ee,content:{set:se,reset:ae,get:le},closest:te,parent:pe,children:he,closest:ve,next:me,previous:ge,index:ye,before:ke,after:Ee,prepend:Ce,append:Le},el:fe,events:{set:Jn,reset:Zn,fire:Vn,x:Pn}}),h(s._,TE._),h(s._,{hooks:{set:_n,reset:qn,fire:zn}}),s.create()};