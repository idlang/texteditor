/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.3.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function V(e,t,n){return $(e)?$(t)?($(z[e])||(z[e]={}),$(n)||(n=Object.keys(z[e]).length),z[e][n]=t,l):z[e]:z}function ee(e,t){return $(e)?$(t)&&$(z[e])?(delete z[e][t],l):(z[e]={},l):(z={},l)}function te(e,t,n){if(!$(z[e]))return z[e]={},l;if($(n))$(z[e][n])&&z[e][n].apply(l,t);else for(var r in z[e])z[e][r].apply(l,t);return l}function ne(e){return e&&e.preventDefault(),!1}function re(e,t,n){return t?(t.addEventListener(e,n,!1),V("on:"+e,n,We(t)),l):void 0}function ie(e,t,n){return t?(t.removeEventListener(e,n,!1),ee("on:"+e,We(t)),l):void 0}function oe(e,t,n){if("createEvent"in u){var r=u.createEvent("HTMLEvents");r.data=n,r.initEvent(e,!0,!1),t.dispatchEvent(r)}else te("on:"+e,n,We(t));return l}function fe(e,t,n){e=v(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)re(e[r],t,n);return l}function ue(e,t,n){e=v(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)ie(e[r],t,n);return l}function le(e,t,n){e=v(e).split(/\s+/);for(var r=0,i=e.length;i>r;++r)oe(e[r],t,n);return l}function se(e,t){return setTimeout(e,t)}function ae(e){return clearTimeout(e)}function ce(e,t,n){for(var o,r=0,i=t.length;i>r;++r)o=t[r],e=e.replace(w(o)?o:h(a(o),"g"),n&&n[r]||"");return e}function de(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,$(t[n])?t[n]:e})}function pe(e){return v(ce(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function he(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=ve(e);return{x:n-i.l,y:r-i.t}}function ve(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{l:t,t:n}}function be(e){return{w:e.offsetWidth,h:e.offsetHeight}}function ge(e,t){for(;(e=Je(e))&&e!==t;);return e}function Fe(e,t,n){if(e=k(e)?u.createElement(e):e,x(n)){var r,i;for(i in n)r=n[i],"style"===i?k(r)?e.setAttribute(i,r):null===r?e.removeAttribute(i):e=Re(e,r):m(r)?e[i]=r:null===r?e.removeAttribute(i):e.setAttribute(i,x(r)?r.join(" "):""+r)}if(g(t))ut(e,t);else if(x(t)){var r,i;for(i in t)r=t[i],g(r)?ut(e,r):r!==!1&&Qe(e,r)}else $(t)&&t!==!1&&Qe(e,t);return e}function We(e){var t=e.id;return t||(t=xe+"-dom:"+(new Date).getTime(),e.id=t),t}function Re(e,t){e=Fe(e);for(var n in t)e.style[n.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})]=t[n];return e}function Xe(e,t){return h("(^|\\s)"+t+"(\\s|$)").test(e.className)}function Ke(e,t){Xe(e,t)||(e.className=v(e.className+" "+t))}function Ze(e,t){e.className=v(e.className.replace(h("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function Qe(e,t){return $(t)?void(e.innerHTML=t):e.innerHTML}function Ge(e,t){if(t!==!1){var r,n=e.children;for(r in n)Ge(n[r])}Qe(e,"")}function Je(e){return e.parentElement||e.parentNode}function Ve(e){return e.children||[]}function et(e){return e.nextElementSibling||e.nextSibling}function nt(e,t){var n=Je(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function rt(e,t){Je(e).insertBefore(t,e)}function it(e,t){Je(e).insertBefore(t,et(e))}function ut(e,t){e.appendChild(t)}function lt(e,t){var n=nt(e);if(n){if(t!==!1)for(var r=Ve(e)[0];r;)lt(r);n.removeChild(e)}}function st(e){Ge(Fe(e,!1,{style:""})),lt(e)}function at(e,t,n){return Fe(t||"div",n,{"class":e})}function ct(){if($e._word&&$e._words){var e=(Oe.value||"").replace(h(Q[0]+"[^"+Q[0]+Q[1]+"]+?"+Q[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;Qe(je,de($e["_word"+(1===t?"":"s")],[t]))}}function dt(e,t){m(e)&&(e.click=e),k(e.click)&&(e.click=(me.tools[e.click]||{}).click),$(e.active)||(e.active=1),$(e.title)||(e.title=we[t]||"")}function pt(){Ge(Ce,!1);var r,i,o,f,u,s,a,e=k(C.tools)?v(C.tools).split(/\s+/):C.tools,t=xe+"-button",n=xe+"-separator";C.tools=e;for(u in e)a=e[u],i=me.tools[a],i&&(dt(i,a),"|"!==(o=i.i||a)&&(o=pe(o)),f="|"!==o,qe=at(f?t:n,f?"a":"span"),f&&(r=t+":"+pe(a).replace(/\s/g,""),qe.href="",qe.id=r,qe.tabIndex=-1,qe.setAttribute(J,a),o='<i class="'+de(ye.i,[o])+" "+r+'"></i>',i.active||Ke(qe,"x"),i.text&&(o=de('<span class="'+xe+'-text">'+i.text+"</span>",[o]),Ke(qe,"text")),Qe(qe,o),Fe(qe,!1,i.attributes||{}),!qe.title&&(s=i.title)&&(qe.title=x(s)?s[0]+(s[1]?" ("+s[1]+")":""):s),fe(j,qe,wt)),ut(Ce,qe));te("update.tools",[l])}function ht(){me.keys=function(){var n,r,e=Object.keys(me.keys).sort().reverse(),t={};for(n=0,r=e.length;r>n;++n)t[e[n]]=me.keys[e[n]];return t}(),yt(1),te("update.keys",[l])}function vt(e){ct(),te("on:change",[e,l])}function mt(e){function x(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var d,p,v,b,g,y,t=l.$(),n=t.before,r=t.after,i=n.slice(-1),o=r[0],f=t.length,u=me.keys,s=TE.keys_alias,c=(n.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),m=e.TE.key();bt[m]=1,y=Object.keys(bt).length,se(function(){l.record()},1);for(d in u){var w=0;v=x(d);for(p in v)p=v[p],bt[s[p]||p]&&++w;if(v=v.length,w===v&&y===v&&(k(u[d])&&(u[d]=me.tools[u[d]].click),b=u[d]&&u[d](e,l),b===!1))return ne(e)}if(X)for(d in X)if(g=X[d],g!==!1){if(m===g&&o===g)return"\\"===i?(l.insert(m,0),ne(e)):(l.select(t.end+1),ne(e));if(d===m)return l.wrap(d,g),ne(e);if(i===d&&o===g){if("backspace"===m&&n.slice(-2)!=="\\"+d)return l.unwrap(d,g),ne(e);if(R&&"enter"===m&&d!==g)return l.tidy("\n"+c+W,"\n"+c).scroll(!0),ne(e)}}if(R&&!f){if("backspace"===m&&h(a(W)+"$").test(n))return l.outdent(W).scroll(!0),ne(e);if("enter"===m&&h("(^|\\n)("+a(W)+")+.*$").test(n))return l.insert("\n"+c,0,1).scroll(!0),ne(e)}}function yt(e){x(e)?delete bt[e.TE.key()]:bt={}}function xt(e){/^focus|blur$/.test(e.type)&&yt(1),ae(gt),gt=se(function(){vt(e)},C.debounce||0)}function wt(e){me.exit(0,0,0);var i,t=this.getAttribute(J),n=me.tools,r=n[t];return Ie=e.currentTarget||e.target,r&&r.active&&r.click&&(i=n[t].click(e,l,t),te("on:change",[e,l,t]),i===!1)?ne(e):(l.select(),ne(e))}function Nt(e){return kt=Ne,Ot=be(Le),ne(e)}function At(e){kt===Ne&&Re(Oe,{height:he(ze,e).y-Ot.h+"px"})}function Dt(){kt=0}function St(){me.exit(1)}function Mt(){e=be(Se),Tt=e.w,_t=e.h,e=be(De),zt=e.w,Lt=e.h}function Ht(e,t){t&&te("exit.modal."+t,[l]),le(j,De,[e])}function Yt(t){kt=t.target,e=he(Se,t),$t=e.x,Et=e.y,Mt()}function jt(t){var i,o,n=Ct.header,r=Ct.resize;kt===n||ge(kt,n)===n?(e=he(ze,t),i=e.x-$t,o=e.y-Et,Re(Se,{left:(Tt>zt?i:p(i,0,zt-Tt))+"px",top:(_t>Lt?o:p(o,0,Lt-_t))+"px"})):kt===r&&(e=he(Se,t),Ot=be(r),Re(Se,{width:e.x+Ot.w/4+"px",height:e.y+Ot.h/4+"px"}))}function Pt(){kt=0}function Bt(e,t,n){return{header:e,body:t,footer:n}}function It(e){var t=Ie,r=e&&e.target||0;(!r||r!==t&&ge(r,t)!==t)&&(Ie=0,st(Me),ue(j,_,It),me.exit(1))}function Ut(e){function u(){i&&(o=be(i),Re(r,{width:o.w+"px",height:o.h+"px"}))}var r,i,o,t=l.get(),n="";return-1===t.indexOf("</html>")&&(n='<!DOCTYPE html><html dir="'+C.dir+'"><head><meta charset="utf-8"><style>'+C.css+"</style></head><body>"+t+"</body></html>"),r=Fe("iframe",!1,{"class":xe+"-portal",src:"data:text/html,"+encodeURIComponent(n)}),!nt(De)&&t?me.overlay(r,1,function(){i=Ve(De)[0],u(),fe(q,f,u),te("enter.overlay.preview",[e,l,[t,n],i])}):(ue(q,f,u),St()),ne(e)}var t="⌘",n="…",i="⇥",o="⇧",f=window,u=document,l=this,s=l._,a=s.x,c=s.extend,d=s.css,p=s.edge,h=s.pattern,v=s.trim,b=l.is,g=b.e,m=b.f,y=b.i,x=b.o,w=b.r,k=b.s,$=function(e){return!b.x(e)},E=u.documentElement,_=(u.head,u.body),z={},L=function(){},C=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),O="keydown",N="keyup",A="copy",D="cut",S="paste",M="touchstart mousedown",H="touchend mouseup",Y="touchmove mousemove",j="click",P="focus",B="blur",I="input",q="orientationchange resize",U=B+" "+A+" "+D+" "+P+" "+I+" "+O+" "+S,F=C.languages,W=C.tab,R=C.auto_tab,X=C.auto_close,K=C.unit[0][0],Q=(C.unit[0][1],C.unit[1][0]),G=C.unit[1][1],J="data-tool-id",me=l.ui={};l.tidy=function(e,t){var n=l.$(),r=v(n.before)?e:"",i=v(n.after)?$(t)?t:e:"";return l.trim(r,i)},l.i=function(){return v(l.replace(/\s+/g," "))},l.format=function(e,t,n,r){x(e)||(e=[e]),$(n)||(n=" "),$(r)||(r="");var i=l[0]().$(),o=(e[0]?K[0]+e[0]+K[1]:"")+r,f=r+(e[0]?K[0]+K[2]+(e[1]||e[0].split(h("("+G[3]+")+"))[0])+K[1]:""),u=a(o),s=a(f),c=h("^"+u+"([\\s\\S]*?)"+s+"$"),d=h(u+"$"),p=h("^"+s),v=i.before,b=i.after;return i.length?n=!1:l.insert(F.placeholders[""]),l.toggle(t?!c.test(i.value):!d.test(v)&&!p.test(b),[function(e){e.unwrap(o,f,1).tidy(h(Q[0]+"[^"+Q[0]+Q[1]+Q[2]+"]+?"+Q[1]+"$").test(v)?"":n,h("^"+Q[0]+Q[2]+"[^"+Q[0]+Q[1]+"]+?"+Q[1]).test(b)?"":n).wrap(o,f,t)[1]()},function(e){e.unwrap(o,f,t)[1]()}])};var qe,ye=C.classes,xe=ye[""],we=F.tools,ke=F.buttons,$e=F.others,Ee=xe+"-textarea "+xe+"-content block",Te=at(xe),_e=at(xe+"-header"),ze=at(xe+"-body"),Le=at(xe+"-footer"),Ce=at(xe+"-tool"),Oe=Fe(l.target,!1,C.attributes),Ne=at(xe+"-resize s"),Ae=at(xe+"-description"),De=at(xe+"-overlay"),Se=Fe("div"),Me=Fe("div"),He=Fe("div"),Ye=at("left","span"),je=at("right","span"),Pe=at(xe+"-preview","a"),Be=0,Ie=0;C.suffix||(C.suffix=K[1]);var bt={},gt=null;l.create=function(e,t){x(e)&&(C=c(C,e));var n=nt(Oe);if(Ke(Oe,Ee),n&&"P"===n.nodeName?(rt(n,Te),Be=n,lt(n,!1)):rt(Oe,Te),Te.dir=C.dir,ut(Te,_e),ut(Te,ze),ut(Te,Le),ut(Te,Ne),ut(ze,Oe),C.tools&&(ut(_e,Ce),ut(Le,Ae),ut(Ae,Ye),ut(Ae,je)),fe(O,Oe,mt),fe(N,Oe,yt),fe(U,Oe,xt),fe(M,Ne,Nt),fe(Y,_,At),fe(H,_,Dt),$e.preview){var r=we.preview;Pe.href="",Pe.title=x(r)?r[0]+(r[1]?" ("+r[1]+")":""):r,ut(Ye,Pe),Qe(Pe,$e.preview)}return vt(null),pt(),ht(),0!==t?te("create",[l]):l},l.update=function(e,t){return Xe(Oe,Ee)&&l.destroy(0),(0!==t?te("update",[l]):l).create(e,0)},l.destroy=function(e){return Xe(Oe,Ee)?(me.exit(0,0,0),Ze(Oe,Ee),x(C.tools)&&(C.tools=C.tools.join(" ")),C.keys&&(ue(O,Oe,mt),ue(N,Oe,yt)),ue(M,Ne,Nt),ue(Y,_,At),ue(H,_,Dt),ue(U,Oe,xt),Be?(rt(Te,Be),ut(Be,Oe),Be=0):rt(Te,Oe),st(Te),0!==e?te("destroy",[l]):l):l};var e,Ot,kt=0,$t=0,Et=0,Tt=0,_t=0,zt=0,Lt=0,Ct={};me.exit=function(e,t,n){var i,r={overlay:function(){ue(j,De,St),st(De)},modal:function(){ue(M,ze,Yt),ue(Y,ze,jt),ue(H,_,Pt),ue(j,Ct.x,Ht),st(Se)},drop:function(){st(Me)},bubble:function(){st(He)}};if(t)if(x(t))for(i in t)i=t[i],r[i]&&r[i](),0!==n&&te("exit."+i,[l]);else r[t]&&r[t](),0!==n&&te("exit."+i,[l]);else for(i in r)r[i]();return e&&l.select(),0!==n&&te("exit",[l]),l},me.overlay=function(e,t,n){return me.exit(0,0,0).blur(),yt(1),ut(ze,Fe(De,e.length||g(e)?at(xe+"-overlay-content","div",e):"")),t&&fe(j,De,St),m(n)?n(De):Fe(De,n),te("enter.overlay",[l]),te("enter",[l]),l},me.modal=function(){me.overlay("",1);var o,u,e=arguments,t=e[0],n=e[1],r=e[2],i=xe+"-modal";x(t)&&(t="default",n=e[0],r=e[1]),u=pe(t),Fe(Se,!1,{"class":i+" "+u}),$(n.body)&&(n.body=Fe("div",n.body,{"class":i+"-content "+u}));for(o in n)i[1]=o,Ct[o]=at(i+"-"+de(o,i)+" "+u,0,n[o]);return Ct.x=at(xe+"-x "+u),Ct.resize=at(xe+"-resize se "+u),Ge(Se),ut(ze,Fe(Se,Ct,{style:""})),me.modal.fit(),it(Se,De),fe(j,Ct.x,Ht),fe(M,Ct.header,ne),fe(M,Ct.resize,ne),fe(M,ze,Yt),fe(Y,ze,jt),fe(H,_,Pt),m(r)&&(Ct.overlay=De,Ct.modal=Se,r(Ct)),te("enter.modal."+t,[l]),te("enter.modal",[l]),te("enter",[l]),l},me.modal.fit=function(e){Mt();var t=Lt/2-_t/2,n=zt/2-Tt/2;return x(e)?(n=e[0],t=e[1]):(n=p(n,0),t=p(t,0)),Re(Se,{left:n+"px",top:t+"px","min-width":Tt+"px","min-height":_t+"px",visibility:"visible"}),te("fit.modal",[l]),te("fit",[l]),l};var qt={"class":xe+"-button",name:"y"};return me.alert=function(e,t,n,r){var i=Fe("button",ke.okay,qt),o="alert";return n=n||L,x(e)&&(o+=":"+e[0],e=e[1]||e[0]),fe(j,i,function(e){return n(e,l),Ht(e,o+".y"),ne(e)}),fe(O,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?le(j,i,[e,l]):void 0}),me.modal(o,Bt(e,t,i),r),i.focus(),l},me.confirm=function(e,t,n,r,i){function a(e){return m(n)&&n(e,l),Ht(e,u+".y"),ne(e)}function c(e){return m(r)&&r(e,l),Ht(e,u+".n"),ne(e)}var s,o=Fe("button",ke.okay,qt),f=Fe("button",ke.cancel,qt),u="confirm";return f.name="n",x(e)&&(u+=":"+e[0],e=e[1]||e[0]),fe(j,o,a),fe(j,f,c),fe(O,o,function(e){return s=e.TE.key,s("arrowright")?(f.focus(),ne(e)):s("arrowleft")?ne(e):s("enter")?(a(e),ne(e)):s("escape")?(Ht(e,u+".y"),ne(e)):void 0}),fe(O,f,function(e){return s=e.TE.key,s("arrowright")?ne(e):s("arrowleft")?(o.focus(),ne(e)):s("enter")?(c(e),ne(e)):s("escape")?(Ht(e,u+".n"),ne(e)):void 0}),me.modal(u,Bt(e,t,[o,f]),i),f.focus(),l},me.prompt=function(e,t,n,r,i,o){function b(){s.focus(),"placeholder"in s&&s.select()}function g(e){return ne(e)}function y(e){return h=s.value,!n||v(h)&&h!==t?(Ht(e,a+".y"),ne(e),r(e,l,h!==t?h:"",t)):(b(),g(e))}function w(e){return Ht(e,a+".n"),ne(e)}var c,p,h,f=Fe("button",ke.okay,qt),u=Fe("button",ke.cancel,qt),s=Fe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":xe+"-input block"}),a="prompt",d=[];if(x(e)&&(a+=":"+e[0],e=e[1]||e[0]),m(i)&&(o=i,i=0),1===i)s=Fe("textarea",t,{placeholder:t.split("\n")[0],"class":xe+"-textarea block"});else if(2===i){for(p in t)d.push(Fe("option",t[p],{value:p,selected:p===n||null}));s=Fe("select",d,{"class":xe+"-select block"})}return r=r||L,s.name="data",u.name="n",fe(O,s,function(e){return c=e.TE.key,c("enter")?y(e):c("escape")||c("backspace")&&!this.value?w(e):c("arrowup")?g(e):c("arrowdown")?(f.focus(),ne(e)):void 0}),fe(O,f,function(e){return c=e.TE.key,c("enter")?y(e):c("escape")?w(e):c("arrowup")?(s.focus(),ne(e)):c("arrowright")?(u.focus(),ne(e)):c(/^arrow(down|left)$/)?g(e):void 0}),fe(O,u,function(e){return c=e.TE.key,c(/^enter|escape$/)?w(e):c("arrowup")?(s.focus(),ne(e)):c(/^arrow(right|down)$/)?g(e):c("arrowleft")?(f.focus(),ne(e)):void 0}),fe(j,f,y),fe(j,u,w),me.modal(a,Bt(e,s,[f,u]),o),b(),l},me.drop=function(){me.exit(0,0,0);var r,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),r=pe(t),Ge(Me),ut(_,Fe(Me,!1,{"class":xe+"-drop "+r})),m(n)?n(Me):Fe(Me,n),me.drop.fit(),fe(j,_,It),te("enter.drop."+t,[l]),te("enter.drop",[l]),l},me.drop.fit=function(e){var o,t=be(E),n=be(Me),r=t.w/2-n.w/2,i=t.h/2-n.h/2;return!$(e)&&Ie&&(o=ve(Ie),r=o.l,i=o.t+be(Ie).h),x(e)?(r=e[0],i=e[1]):(r=p(r,0,t.w-n.w),i=p(i,0,t.h-n.h)),Re(Me,{left:r+"px",top:i+"px",visibility:"visible"}),te("fit.drop",[l]),te("fit",[l]),l},me.menu=function(e,t,n,r){var i='<span class="'+xe+'-current menu">%1</span>',o="";return t===!1?me.tool(e,t):(x(t)&&(o=t[0],t=t[1],i='<i class="'+de(ye.i,[o])+'"></i> '+i),me.tool(e,{i:o,text:de(i,[n[t]&&n[t].text||t,o]),click:function(t){var f,u,s,a,d,p,h,r={href:"","class":xe+"-button"};return me.drop("menu menu-"+pe(e),function(e){function t(e){return a=this,h=n[a.getAttribute(J)],f=Qe(a),h&&h.active&&m(p=h.click)&&(p=p(e,l),Ie&&Qe(Ve(Ie)[0]||Ie,de(i,[f,o])),p===!1)?ne(e):(l.select(),ne(e))}for(s in n)d=n[s],d=k(d)?me.tools[d]:d,d&&(dt(d,s),r[J]=s,u=Fe("a",d.text||s,c(r,d.attributes||{})),!u.title&&(p=d.title)&&(u.title=x(p)?p[0]+(p[1]?" ("+p[1]+")":""):p),d.active||Ke(u,"x"),n[s]=d,fe(j,u,t),ut(e,u))}),!1}},r),te("update.menus",[l]),l)},me.menu.fit=function(e){return me.drop.fit(e)},me.bubble=function(){me.exit(0,0,0);var r,e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),r=pe(t),Ge(He),ut(_,Fe(He,!1,{"class":xe+"-bubble "+r})),m(n)?n(He):Fe(He,n),me.bubble.fit(),te("enter.bubble."+t,[l]),te("enter.bubble",[l]),l},me.bubble.fit=function(e){var t=l.$(1),n=ve(Oe),r=d(Oe,"line-height"),i="border-",o="-width",f=t.caret[0].x+n.l-Oe.scrollLeft,u=t.caret[1].y+n.t+r-Oe.scrollTop,s=be(ze),a=be(He),c=d(ze,i+"top"+o)+d(ze,i+"bottom"+o),h=d(ze,i+"left"+o)+d(ze,i+"right"+o);return x(e)?(f=e[0],u=e[1]):(f=p(f,n.l,n.l+s.w-a.w-h),u=p(u,n.t,n.t+s.h-a.h-c)),Re(He,{left:f+"px",top:u+"px",visibility:"visible"}),te("fit.bubble",[l]),te("fit",[l]),l},me.tool=function(e,t,n){var r="";return"|"!==e&&(C.tools=C.tools.filter(function(t,n){return t===e?(r=n,!1):!0})),t===!1?delete me.tools[e]:("|"===e?(n=t,t={}):(m(t)&&(t={click:t}),me.tools[e]=c(me.tools[e]||{},t),$(n)||""===r||(n=r)),y(n)?C.tools.splice(n,0,e):C.tools.push(e)),pt(),l},me.key=function(e,t){return C.keys?(t===!1?delete me.keys[e]:me.keys[e]=t,ht(),l):l},me.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(W),!1},outdent:function(e,t){return t.outdent(W),!1}},fe(j,Pe,Ut),me.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Ut(e)},"shift+tab":R?"outdent":0,tab:R?"indent":0,escape:function(e,t){return Pe.focus(),!1}},me.el={container:Te,header:_e,body:ze,footer:Le,overlay:De,modal:Se,drop:Me,bubble:He},l.config=C,c(l._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),u=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>f&&(f="0"+f),10>u&&(u="0"+u),[""+t,""+n,""+r,""+i,""+o,""+f,""+u]},replace:ce,format:de,el:Fe,event:{set:fe,reset:ue,fire:le,x:ne},hooks:z,hook:{set:V,reset:ee,fire:te}}),me};