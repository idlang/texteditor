/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.10
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Ae(e){return _(e)?b(e).split(/\s+/):e}function Ee(e){return w(e)?e.join(" "):e}function Be(e,t,r){return T(e)?T(t)?(T(B[e])||(B[e]={}),T(r)||(r=Object.keys(B[e]).length),B[e][r]=t,s):B[e]:B}function He(e,t){return T(e)?T(t)&&T(B[e])?(delete B[e][t],s):(B[e]={},s):(B={},s)}function Ce(e,t,r){if(!T(B[e]))return B[e]={},s;if(T(r))T(B[e][r])&&B[e][r].apply(s,t);else for(N in B[e])B[e][N].apply(s,t);return s}function Ie(e,t,r){if(w(t))for(N in t)Ie(e,N,t[N]);else e.setAttribute(t,r)}function Oe(t,r,n){if(_(r))return Oe(t,[r],T(n)?n:"")[0];e=[];for(N in r)N=r[N],(N=t.getAttribute(N))&&e.push(N);return e.length?e:T(n)?n:[]}function Ue(e,t){if(w(t))for(N in t)Ue(e,t[N]);else if(T(t))e.removeAttribute(t);else for(Ue(e,"class"),N=0,F=e.attributes,D=F.length;D>N;++N)F[N]&&Ue(e,F[N].name)}function Re(e,t,r){if(w(t))for(N in t)Re(e,N,t[N]);else Ie(e,"data-"+t,r)}function je(t,r,n){if(_(r))return je(t,[r],T(n)?n:"")[0];e=[];for(N in r)N=r[N],(N=Oe(t,"data-"+N))&&e.push(N);return e.length?e:T(n)?n:[]}function Se(e,t){if(w(t))for(N in t)Ue(e,"data-"+t[N]);else if(T(t))Ue(e,"data-"+t);else for(N=0,F=e.attributes,D=F.length;D>N;++N)F[N]&&"data-"===F[N].name.slice(0,5)&&Ue(e,F[N].name)}function ze(e){return e&&e.preventDefault(),!1}function Me(e,t,r){if(t){for(e=Ae(e),N=0,F=e.length;F>N;++N)t.addEventListener(e[N],r,!1),Be("on:"+e[N],r,et(t));return s}}function Ne(e,t,r){if(t){for(e=Ae(e),N=0,F=e.length;F>N;++N)t.removeEventListener(e[N],r,!1),He("on:"+e[N],et(t));return k(t)&&t.id.split(":")[0]===xt+"-dom"&&Ue(t,"id"),s}}function Fe(e,t,r){e=Ae(e);var i,n="createEvent"in o;for(N=0,F=e.length;F>N;++N)n?(i=o.createEvent("HTMLEvents"),i.data=r,i.initEvent(e[N],!0,!1),t.dispatchEvent(i)):Ce("on:"+e[N],r,et(t));return s}function De(e,t,r){for(N=0,F=t.length,D;F>N;++N)D=t[N],e=e.replace(x(D)?D:d(c(D),"g"),r&&r[N]||"");return e}function Qe(e,t){return e.replace(/%(\d+)/g,function(e,r){return--r,T(t[r])?t[r]:e})}function Pe(e){return b(De(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ye(e,t){var r=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,i=Ke(e);return{x:r-i.l,y:n-i.t}}function Ke(e){for(Q=e.offsetLeft,Z=e.offsetTop;e=e.offsetParent;)Q+=e.offsetLeft,Z+=e.offsetTop;return{l:Q,t:Z}}function Ge(e){return{w:e.offsetWidth,h:e.offsetHeight}}function We(e,t){for(;(e=it(e))&&e!==t;);return e}function Xe(e,t){t=Ae(t);for(N in t)e.classList.add(t[N])}function Ze(t,r,n){if(_(r))return Ze(t,[r],T(n)?n:"")[0];e=[];for(N in r)N=r[N],t.classList.contains(N)&&e.push(N);return e.length?e:T(n)?n:!1}function Je(e,t){if(T(t)){t=Ae(t);for(N in t)e.classList.remove(t[N])}else Ue(e,"class")}function Ve(e,t,r){if(e=_(e)?o.createElement(e):e,w(r))for(N in r)if(V=r[N],"classes"===N)Xe(e,V);else if("data"===N)for(F in V)V=V[F],null===V?Se(e,F):Re(e,F,V);else"css"===N?_(V)?Ie(e,"style",V):null===V?Ue(e,"style"):p(e,V):$(V)?e[N]=V:null===V?Ue(e,N):Ie(e,N,w(V)?V.join(" "):""+V);if(k(t))mt(e,t);else if(w(t))for(N in t)V=t[N],k(V)?mt(e,V):V!==!1&&tt(e,V);else T(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=xt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(T(t)?t:"")}function nt(e,t){if(t!==!1&&(U=lt(e)))for(N=0,F=U.length;F>N;++N)nt(U[N]);tt(e,"")}function it(e){return e&&e.parentNode}function lt(e){return e&&e.children||[]}function at(e){return e&&e.nextSibling}function ot(e){return e&&e.previousSibling}function st(e){for(N=-1;e=ot(e);)++N;return N}function ft(e,t){return e&&_(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&$(t)?e===t(e):e===t}function ct(t,r){if(!(r=T(r)?r:o))return[];if(e=[],_(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=r.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=r.getElementsByClassName(t.slice(1)))||(t=r.getElementsByTagName(t))){for(N=0,F=t.length;F>N;++N)e.push(t[N]);return e}return[]}for(t=r.querySelectorAll(t),N=0,F=t.length;F>N;++N)e.push(t[N]);return e}return ut(t)?[t]:[]}function ut(e,t){var r=it(e);return 1===arguments.length?r||!1:e&&r===e?r:!1}function pt(e,t){K=it(e),K&&K.insertBefore(t,e)}function ht(e,t){K=it(e),K&&K.insertBefore(t,at(e))}function dt(e,t){U=lt(e)[0],U?pt(U,t):mt(e,t)}function bt(e,t){mt(e,t)}function mt(e,t){e.appendChild(t)}function gt(e,t){var r=ut(e);if(r){if(t!==!1)for(U=lt(e)[0];U;)gt(U);r.removeChild(e)}}function vt(e){nt(Ve(e,!1,{style:""})),gt(e)}function kt(e,t,r){return Ve(t||"div",r,{"class":e})}function Kt(e){return!e||T(e.active)&&!X.active}function Gt(){Lt._word&&Lt._words&&(V=(Ot.value||"").replace(d(xe[0]+"[^"+xe[0]+xe[1]+"]+?"+xe[1],"g"),""),N=(V.match(/(\w+)/g)||[]).length,tt(Ft,Qe(Lt["_word"+(1===N?"":"s")],[N])))}function Wt(e,t,r){return $(e)&&(e={click:e}),_(e.click)&&(e.click=(r[e.click]||{}).click),T(e.title)||(e.title=_t[t]||""),r[t]=e,e}function Xt(e){$t.exit(0,0,0);var t=je(this,Te),r=$t.tools,n=r[t];return $t.drop.target=e.currentTarget||e.target,!Kt(n)&&$(F=n.click)&&(F=F(e,s,t),Ce("on:change",[e,s,t]),F===!1)?ze(e):(s.select(),ze(e))}function Zt(e){if(Z=this,(D=e.TE.key)(/^(escape|f10)$/))$t.exit(1);else if(D("enter"))$t.drop.target=Z,Fe(pe,Z,[e]);else if(D("arrowright")&&(Q=at(Z))){for(;!ft(Q,"a")&&Q;)Q=at(Q);Q&&Q.focus()}else if(D("arrowleft")&&(Q=ot(Z))){for(;!ft(Q,"a")&&Q;)Q=ot(Q);Q&&Q.focus()}return ze(e)}function Jt(){nt(It,!1);var n,i,l,a,o,f,c,e=Ae(C.tools),t=xt+"-button",r=xt+"-separator";C.tools=e;for(f in e)c=e[f],i=$t.tools[c],(i||i==={})&&(i=Wt(i,c,$t.tools),l=i.i||c,"|"!==l&&"<"!==l[0]&&(l=Pe(l)),a="|"!==l,o=Pe(l).replace(/\s/g,""),Pt=kt(a?t+" "+t+"-"+o:r+" "+r+"-"+f,a?"a":"span"),a?(n=t+":"+o,Ie(Pt,{href:qe,id:n,tabindex:-1}),Re(Pt,Te,c),l="<"===l[0]?l:'<i class="'+Qe(wt,[l])+'"></i>',Kt(i)&&Xe(Pt,"x"),i.text&&(l=Qe('<span class="'+xt+'-text">'+i.text+"</span>",[l]),Xe(Pt,"text")),tt(Pt,l),Ve(Pt,!1,i.attributes||{}),!Pt.title&&(F=i.title)&&(Pt.title=w(F)?F[0]+(F[1]?" ("+F[1]+")":""):F),Me(pe,Pt,Xt),Me(ie,Pt,Zt)):Pt.id=r+":"+f,$t.tools[c].target=Pt,mt(It,Pt));Ce("update.tools",[s])}function Vt(){$t.keys=function(){var r,e=Object.keys($t.keys).sort().reverse(),t={};for(N=0,F=e.length;F>N;++N)r=e[N],t[r]=$t.keys[r];return t}(),ir(1),Ce("update.keys",[s])}function er(e){Gt(),Ce("on:change",[e,s])}function nr(t){function h(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var r=s.$(),n=r.before,i=r.after,l=n.slice(-1),a=i[0],o=r.length,f=$t.keys,u=TE.keys_alias,p=(n.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();Y=t.TE.key(),tr[Y]=1,e=Object.keys(tr).length,m(function(){s.record()});for(N in f){D=h(N),U=0;for(F in D)F=D[F],tr[u[F]||F]&&++U;if(D=D.length,U===D&&e===D&&(_(f[N])&&(f[N]=$t.tools[f[N]].click),Q=f[N]&&f[N](t,s),Q===!1))return ze(t)}if($e)for(N in $e)if(P=$e[N],P!==!1){if(Y===P&&a===P)return"\\"===l?(s.insert(Y,0),ze(t)):(s.select(r.end+1),ze(t));if(N===Y)return s.wrap(N,P),ze(t);if(l===N&&a===P){if("backspace"===Y&&n.slice(-2)!=="\\"+N)return s.unwrap(N,P),ze(t);if(ke&&"enter"===Y&&N!==P)return s.tidy("\n"+p+ve,"\n"+p),ze(t)}}if(ke&&!o){if("backspace"===Y&&d(c(ve)+"$").test(n))return s.outdent(ve),ze(t);if("enter"===Y&&d("(^|\\n)("+c(ve)+")+.*$").test(n))return s.insert("\n"+p,0,1),ze(t)}}function ir(e){w(e)?delete tr[e.TE.key()]:tr={}}function lr(e){/^(focus|blur)$/.test(e.type)&&ir(1),g(rr),rr=m(function(){er(e)},C.debounce||0)}function cr(e){return ar=Ut,X=Ge(Ct),ze(e)}function ur(e){ar===Ut&&p(Ot,{height:Ye(Ht,e).y-X.h+Le})}function pr(){ar=0}function hr(){$t.exit(1)}function dr(){e=Ge(St),ee=e.w,M=e.h,e=Ge(jt),or=e.w,sr=e.h}function br(e,t){t&&Ce("exit.modal."+t,[s]),Fe(pe,jt,[e])}function mr(t){ar=t.target,e=Ye(St,t),te=e.x,re=e.y,dr()}function gr(t){var r=fr.header,n=fr.resize;ar===r||We(ar,r)===r?(e=Ye(Ht,t),Q=e.x-te,Z=e.y-re,p(St,{left:(ee>or?Q:h(Q,0,or-ee))+Le,top:(M>sr?Z:h(Z,0,sr-M))+Le})):ar===n&&(e=Ye(St,t),X=Ge(n),p(St,{width:e.x+X.w/4+Le,height:e.y+X.h/4+Le}))}function vr(){ar=0}function kr(e,t,r){return{header:e,body:t,footer:r}}function $r(e){I=$t.drop.target,O=zt,U=e&&e.target||0,(!U||U!==I&&We(U,I)!==I)&&($t.drop.target=0,vt(zt),Ne(pe,o,$r),Ne(be,a,$r),$t.exit(e.target===E))}function xr(t){function i(){e&&(K=Ge(e),p(W,{width:K.w+Le,height:K.h+Le}))}var r=s.get(),n="";return-1===r.indexOf("</html>")&&(n='<!DOCTYPE html><html dir="'+C.dir+'"><head><meta charset="utf-8"><style>'+C.css+"</style></head><body>"+r+"</body></html>"),W=Ve("iframe",!1,{"class":xt+"-portal",src:"data:text/html,"+encodeURIComponent(n)}),!ut(jt)&&r?($t.overlay(W,1,function(){e=lt(jt)[0],i(),Me(be,a,i),Ce("enter.overlay.preview",[t,s,[r,n],e])}),wr=!0):(Ne(be,a,i),hr(),wr=!1),ze(t)}var I,O,U,j,S,M,N,F,D,Q,P,Y,e,K,W,X,Z,V,ee,te,re,t="⌘",r="…",i="⇥",l="⇧",a=window,o=document,s=this,f=s._,c=f.x,u=f.extend,p=f.css,h=f.edge,d=f.pattern,b=f.trim,m=f.timer.set,g=f.timer.reset,v=s.is,k=v.e,$=v.f,y=v.i,w=v.o,x=v.r,_=v.s,T=function(e){return!v.x(e)},q=o.documentElement,A=(o.head,o.body),E=s.target,B={},H=function(){},C=u({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{preview:["Preview","F5"],tools:["Focus Tools","F10"],undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",l+"+"+i]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",le="keyup",ae="copy",oe="cut",se="paste",fe="touchstart mousedown",ce="touchend mouseup",ue="touchmove mousemove",pe="click",he="focus",de="blur",be="orientationchange resize",me=de+" "+ae+" "+oe+" "+he+" input "+ie+" "+se,ge=C.languages,ve=C.tab,ke=C.auto_tab,$e=C.auto_close,ye=C.unit[0][0],xe=(C.unit[0][1],C.unit[1][0]),_e=C.unit[1][1],Te="tool-id",qe="javascript:;",Le="px",$t=s.ui={};s.tidy=function(e,t){var r=s.$(),n=b(r.before)?e:"",i=b(r.after)?T(t)?t:e:"";return s.trim(n,i)},s.i=function(){return b(s.replace(/\s+/g," "))},s.format=function(e,t,r,n){w(e)||(e=[e]),T(r)||(r=" "),T(n)||(n="");var i=s.h,l=s[0]().$(),a=(e[0]?ye[0]+e[0]+ye[1]:"")+n,o=n+(e[0]?ye[0]+ye[2]+(e[1]||e[0].split(d("("+_e[3]+")+"))[0])+ye[1]:""),f=c(a),u=c(o),p=d("^"+f+"([\\s\\S]*?)"+u+"$"),h=d(f+"$"),b=d("^"+u),m=l.before,g=l.after;return l.length?r=!1:s.insert(ge.placeholders[""]),s.toggle(t?!p.test(l.value):!h.test(m)&&!b.test(g),[function(e){e.unwrap(a,o,1).tidy(d(xe[0]+"[^"+xe[0]+xe[1]+xe[2]+"]+?"+xe[1]+"$").test(m)?"":r,d("^"+xe[0]+xe[2]+"[^"+xe[0]+xe[1]+"]+?"+xe[1]).test(g)?"":r).wrap(a,o,t)},function(e){e.unwrap(a,o,t)}])[i]()};var Pt,yt=C.classes,wt=yt.i,xt=yt[""],_t=ge.tools,Tt=ge.buttons,qt=ge.labels,Lt=ge.others,At=xt+"-textarea "+xt+"-content block",Et=kt(xt),Bt=kt(xt+"-header"),Ht=kt(xt+"-body"),Ct=kt(xt+"-footer"),It=kt(xt+"-tool"),Ot=Ve(E,!1,C.attributes),Ut=kt(xt+"-resize s"),Rt=kt(xt+"-description"),jt=kt(xt+"-overlay"),St=Ve("div"),zt=Ve("div"),Mt=Ve("div"),Nt=kt("left","span"),Ft=kt("right","span"),Dt=kt(xt+"-preview","a"),Qt=0;C.suffix||(C.suffix=ye[1]);var tr={},rr=null;s.create=function(e,t){w(e)&&(C=u(C,e));var r=ut(Ot);return Xe(Ot,At),r&&ft(r,"p")?(pt(r,Et),Qt=r,gt(r,!1)):pt(Ot,Et),Et.dir=C.dir,mt(Et,Bt),mt(Et,Ht),mt(Et,Ct),mt(Et,Ut),mt(Ht,Ot),C.tools&&(mt(Bt,It),mt(Ct,Rt),mt(Rt,Nt),mt(Rt,Ft)),Me(ie,Ot,nr),Me(le,Ot,ir),Me(me,Ot,lr),Me(fe,Ut,cr),Me(ue,o,ur),Me(ce,A,pr),(X=_t.preview)&&(Ie(Dt,{href:qe,title:w(X)?X[0]+(X[1]?" ("+X[1]+")":""):X}),mt(Nt,Dt),tt(Dt,Lt.preview)),er(null),Jt(),Vt(),0!==t?Ce("create",[s]):s},s.update=function(e,t){return Ze(Ot,Ae(At),0)&&s.destroy(0),(0!==t?Ce("update",[s]):s).create(e,0)},s.destroy=function(e){return Ze(Ot,Ae(At),0)?($t.exit(0,0,0),Je(Ot,At),C.tools=Ee(C.tools),C.keys&&(Ne(ie,Ot,nr),Ne(le,Ot,ir)),Ne(fe,Ut,cr),Ne(ue,o,ur),Ne(ce,o,pr),Ne(me,Ot,lr),Qt?(pt(Et,Qt),mt(Qt,Ot),Qt=0):pt(Et,Ot),vt(Et),0!==e?Ce("destroy",[s]):s):s};var ar=0,te=0,re=0,ee=0,M=0,or=0,sr=0,fr={};$t.exit=function(e,t,r){if(S={overlay:function(){Ne(pe,jt,hr),vt(jt)},modal:function(){Ne(fe,Ht,mr),Ne(ue,Ht,gr),Ne(ce,o,vr),Ne(pe,fr.x,br),vt(St)},drop:function(){vt(zt)},bubble:function(){vt(Mt)}},t)if(w(t))for(N in t)N=t[N],S[N]&&S[N](),0!==r&&Ce("exit."+N,[s]);else S[t]&&S[t](),0!==r&&Ce("exit."+N,[s]);else for(N in S)S[N]();return e&&s.select(),0!==r&&Ce("exit",[s]),s},$t.overlay=function(e,t,r){return $t.exit(0,0,0),ir(1),mt(Ht,Ve(jt,e.length||k(e)?kt(xt+"-overlay-content","div",e):"")),t&&Me(pe,jt,hr),$(r)?r(jt):Ve(jt,r),Ce("enter.overlay",[s]),Ce("enter",[s]),s},$t.overlay.fit=function(){},$t.modal=function(){$t.overlay("",1).blur();var e=arguments,t=e[0],r=e[1],n=e[2],i=xt+"-modal";w(t)&&(t="default",r=e[0],n=e[1]),Q=Pe(t),Ve(St,!1,{"class":i+" "+Q}),T(r.body)&&(r.body=Ve("div",r.body,{"class":i+"-content "+Q}));for(N in r)i[1]=N,fr[N]=kt(i+"-"+Qe(N,i)+" "+Q,0,r[N]);return fr.x=kt(xt+"-x "+Q),fr.resize=kt(xt+"-resize se "+Q),nt(St),mt(Ht,Ve(St,fr,{style:""})),$t.modal.fit(),ht(St,jt),Me(pe,fr.x,br),Me(fe,fr.header,ze),Me(fe,fr.resize,ze),Me(fe,Ht,mr),Me(ue,Ht,gr),Me(ce,o,vr),$(n)&&(fr.overlay=jt,fr.modal=St,n(fr)),Ce("enter.modal."+t,[s]),Ce("enter.modal",[s]),Ce("enter",[s]),s},$t.modal.fit=function(e){return dr(),Q=or/2-ee/2,Z=sr/2-M/2,w(e)?(T(e[0])&&(Q=e[0]),T(e[1])&&(Z=e[1])):(Q=h(Q,0),Z=h(Z,0)),p(St,{left:Q+Le,top:Z+Le,"min-width":ee+Le,"min-height":M+Le,visibility:"visible"}),Ce("fit.modal",[s]),Ce("fit",[s]),s};var yr={"class":xt+"-button",name:"y"};$t.alert=function(e,t,r,n){var i=Ve("button",Tt.okay,yr),l="alert";return r=r||H,w(e)&&(l+=":"+e[0],e=e[1]||e[0]),Me(pe,i,function(e){return r(e,s),br(e,l+".y"),ze(e)}),Me(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(Fe(pe,i,[e]),ze(e)):void 0}),$t.modal(l,kr(e,t,i),n),i.focus(),s},$t.confirm=function(e,t,r,n,i){function c(e){return $(r)&&r(e,s),br(e,o+".y"),ze(e)}function u(e){return $(n)&&n(e,s),br(e,o+".n"),ze(e)}var f,l=Ve("button",Tt.okay,yr),a=Ve("button",Tt.cancel,yr),o="confirm";return a.name="n",w(e)&&(o+=":"+e[0],e=e[1]||e[0]),Me(pe,l,c),Me(pe,a,u),Me(ie,l,function(e){return f=e.TE.key,f("arrowright")?(a.focus(),ze(e)):f("arrowleft")?ze(e):f("enter")?(c(e),ze(e)):f("escape")?(br(e,o+".y"),ze(e)):void 0}),Me(ie,a,function(e){return f=e.TE.key,f("arrowright")?ze(e):f("arrowleft")?(l.focus(),ze(e)):f("enter")?(u(e),ze(e)):f("escape")?(br(e,o+".n"),ze(e)):void 0}),$t.modal(o,kr(e,t,[l,a]),i),a.focus(),s},$t.prompt=function(e,t,r,n,i,l){function d(){f.focus(),"placeholder"in f&&f.select()}function m(e){return ze(e)}function g(e){return p=f.value,!r||b(p)&&p!==t?(br(e,c+".y"),ze(e),n(e,s,p!==t?p:"",t)):(d(),m(e))}function v(e){return br(e,c+".n"),ze(e)}var p,h,a=Ve("button",Tt.okay,yr),o=Ve("button",Tt.cancel,yr),f=Ve("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":xt+"-input block"}),c="prompt",u=[];if(w(e)&&(c+=":"+e[0],e=e[1]||e[0]),$(i)&&(l=i,i=0),1===i)f=Ve("textarea",t,{placeholder:t.split("\n")[0],"class":xt+"-textarea block"});else if(2===i){for(N in t)u.push(Ve("option",t[N],{value:N,selected:N===r||null}));f=Ve("select",u,{"class":xt+"-select block"})}return n=n||H,f.name="data",o.name="n",Me(ie,f,function(e){return h=e.TE.key,h("enter")?g(e):h("escape")||h("backspace")&&!this.value?v(e):h("arrowup")?m(e):h("arrowdown")?(a.focus(),ze(e)):void 0}),Me(ie,a,function(e){return h=e.TE.key,h("enter")?g(e):h("escape")?v(e):h("arrowup")?(f.focus(),ze(e)):h("arrowright")?(o.focus(),ze(e)):h(/^arrow(down|left)$/)?m(e):void 0}),Me(ie,o,function(e){return h=e.TE.key,h(/^(enter|escape)$/)?v(e):h("arrowup")?(f.focus(),ze(e)):h(/^arrow(right|down)$/)?m(e):h("arrowleft")?(a.focus(),ze(e)):void 0}),Me(pe,a,g),Me(pe,o,v),$t.modal(c,kr(e,f,[a,o]),l),d(),s},$t.drop=function(){$t.exit(0,0,0);var e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),Q=Pe(t),nt(zt),mt(A,Ve(zt,!1,{"class":xt+"-drop "+Q})),$(r)?r(zt):Ve(zt,r),$t.drop.fit(),Me(pe,o,$r),Me(be,a,$r),Ce("enter.drop."+t,[s]),Ce("enter.drop",[s]),s},$t.drop.fit=function(t){return I=Ge(q),O=Ge(zt),U=$t.drop.target,Q=I.w/2-O.w/2,Z=I.h/2-O.h/2,!T(t)&&U&&(e=Ke(U),Q=e.l,Z=e.t+Ge(U).h),w(t)?(T(t[0])&&(Q=t[0]),T(t[1])&&(Z=t[1])):(Q=h(Q,0,Math.max(I.w,a.innerWidth)-O.w),Z=h(Z,0,Math.max(I.h,a.innerHeight)-O.h)),p(zt,{left:Q+Le,top:Z+Le,visibility:"visible"}),Ce("fit.drop",[s]),Ce("fit",[s]),s},$t.menu=function(e,t,r,n){t=!w(t)&&r[t]&&r[t].text||t;var f,i=$t.tools,l='<span class="'+xt+'-current menu">%1</span>',a="",o=0;return t===!1?$t.tool(e,t):(w(t)&&(a=t[0],a="<"===a[0]?a:'<i class="'+Qe(wt,[a])+'"></i>',t=T(t[1])?t[1]:0,t=t&&r[t]&&r[t].text||t,l=a+(0!==t?" "+l:"")),$t.tool(e,{i:a,text:t?Qe(l,[t,a]):0,click:function(c){var p=$t.drop.target=i[e].target;return $t.drop("menu menu-"+Pe(e),function(c){function h(e){return Z=this,P=r[je(Z,Te)],P=_(P)?i[P]:P||{},Y=rt(Z),!Kt(P)&&$(n=P.click)&&(n=n(e,s),t!==!1&&p&&(U=lt(p)[0]||p,ft(U,"i")||tt(U,Qe(l,[Y,a])),w(P.text)&&(U=lt(U)[0])&&ft(U,"i")&&(Je(U),Xe(U,Qe(wt,[P.text[0]])))),n===!1)?ze(e):(s.select(),ze(e))}function d(e){if(Z=this,(D=e.TE.key)("escape"))$t.exit(1);else if(D("enter"))Fe(pe,Z,[e]);else if(D("f10")&&p)p.focus();else if(D("arrowdown")&&(Q=at(Z))){for(;!ft(Q,"a")&&Q;)Q=at(Q);Q&&Q.focus()}else if(D("arrowup")&&(Q=ot(Z))){for(;!ft(Q,"a")&&Q;)Q=ot(Q);!Q&&p?($t.exit(),p.focus()):Q&&Q.focus()}else D("arrowup")&&p&&($t.exit(),p.focus());return ze(e)}for(n in r)if(f=r[n],ee="%"===n[0],f=_(f)&&!ee?i[f]:f){f=Wt(f,n,i);var b={href:ee?null:qe,"class":xt+"-"+(ee?"label":"button")};ee?F=qt[e]&&qt[e][+n.slice(1)-1]||n:(b.data={},b.data[Te]=n,F=_t[n]||n),W=f.text,W=w(W)?W[1]||"":W,F=w(F)?F[0]:F,X=Ve(ee?"span":"a",ee?"<span>"+(F||"%"+o)+"</span>":f.text||F,u(b,f.attributes||{})),!X.title&&(Z=f.title)&&(X.title=w(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z),ee?Ie(X,{id:xt+"-label:"+o}):(Kt(f)&&Xe(X,"x"),Me(pe,X,h),Me(ie,X,d)),r[n]=f,mt(c,X),++o}m(function(){ct("a",c)[0].focus()},1)}),!1}},n),Me(ie,i[e].target,function(t){return t.TE.key("arrowdown")?($t.drop.target=this,i[e].click(j,s),ze(t)):void 0}),i[e].data=r,s)},$t.bubble=function(){$t.exit(0,0,0);var e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),Q=Pe(t),nt(Mt),mt(A,Ve(Mt,!1,{"class":xt+"-bubble "+Q})),$(r)?r(Mt):Ve(Mt,r),$t.bubble.fit(),Ce("enter.bubble."+t,[s]),Ce("enter.bubble",[s]),s},$t.bubble.fit=function(t){X=s.$(1),e=Ke(Ot),M=p(Ot,"line-height");var r="border-",n="-width";Q=X.caret[0].x+e.l-Ot.scrollLeft,Z=X.caret[1].y+e.t+M-Ot.scrollTop,O=p(Ht,[r+"top"+n,r+"bottom"+n,r+"left"+n,r+"right"+n]);var i=Ge(Ht),l=Ge(Mt),a=O[0]+O[1],o=O[2]+O[3];return w(t)?(T(t[0])&&(Q=t[0]),T(t[1])&&(Z=t[1])):(Q=h(Q,e.l,e.l+i.w-l.w-o),Z=h(Z,e.t,e.t+i.h-l.h-a)),p(Mt,{left:Q+Le,top:Z+Le,visibility:"visible"}),Ce("fit.bubble",[s]),Ce("fit",[s]),s},$t.overlay.exit=function(e){return $t.exit(e,"overlay")},$t.modal.exit=function(e){return $t.exit(e,"modal")},$t.drop.exit=function(e){return $t.exit(e,"drop")},$t.bubble.exit=function(e){return $t.exit(e,"bubble")},$t.tool=function(e,t,r){return F="","|"!==e&&(C.tools=C.tools.filter(function(t,r){return t===e?(F=r,!1):!0})),t===!1?delete $t.tools[e]:("|"===e?(r=t,t={}):($(t)&&(t={click:t}),$t.tools[e]=u($t.tools[e]||{},t),T(r)||""===F||(r=F)),y(r)?C.tools.splice(r,0,e):C.tools.push(e)),Jt(),s},$t.key=function(e,t){return C.keys?(t===!1?delete $t.keys[e]:$t.keys[e]=t,Vt(),s):s};var wr=!1;return Me(pe,Dt,xr),$t.tools={"|":{},preview:{i:"eye",click:function(e){return wr?(hr(),wr=!1):xr(e),!1}},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ve),!1},outdent:function(e,t){return t.outdent(ve),!1}},$t.keys={"control+y":"redo","control+z":"undo",f5:"preview",f10:function(e,t){return ct("a",It)[0].focus(),!1},"shift+tab":ke?"outdent":0,tab:ke?"indent":0,escape:function(e,t){return Dt.focus(),!1}},$t.el={container:Et,header:Bt,body:Ht,footer:Ct,overlay:jt,modal:St,drop:zt,bubble:Mt},s.config=C,u(s._,{time:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours(),l=e.getMinutes(),a=e.getSeconds(),o=e.getMilliseconds();return 10>r&&(r="0"+r),10>n&&(n="0"+n),10>i&&(i="0"+i),10>l&&(l="0"+l),10>a&&(a="0"+a),10>o&&(o="0"+o),[""+t,""+r,""+n,""+i,""+l,""+a,""+o]},replace:De,format:Qe,dom:{set:mt,reset:gt,get:ct,id:et,copy:function(e,t){return e.cloneNode(T(t)?t:!0)},classes:{set:Xe,reset:Je,get:Ze},attributes:{set:Ie,reset:Ue,get:Oe},data:{set:Re,reset:Se,get:je},is:ft,offset:Ke,point:Ye,size:Ge,content:{set:tt,reset:nt,get:rt},closest:We,parent:it,children:lt,next:at,previous:ot,index:st,before:pt,after:ht,prepend:dt,append:bt},el:Ve,event:{set:Me,reset:Ne,fire:Fe,x:ze},hooks:B,hook:{set:Be,reset:He,fire:Ce}}),$t};