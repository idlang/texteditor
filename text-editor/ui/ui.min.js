/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.2.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Ce(e){return e.toLowerCase()}function Me(e){return C(e)?m(e).split(/\s+/):e}function Oe(e){return $(e)?e.join(" "):e}function Ne(e,t){return-1!==e.indexOf(t)}function De(e){return Object.keys(e)}function He(e){return e.length}function Be(e){return He(De(e))}function Se(e,t,n){return _(e)?_(t)?(_(g[e])||(g[e]={}),_(n)||(n=Be(g[e])),g[e][n]=t,l):g[e]:g}function Ae(e,t){return _(e)?_(t)&&_(g[e])?(delete g[e][t],l):(g[e]={},l):(g={},l)}function Ye(e,t,n){if(!_(g[e]))return g[e]={},l;if(_(n))_(g[e][n])&&g[e][n].apply(l,t);else for(W in g[e])g[e][W].apply(l,t);return l}function Fe(e,t,n){if($(t))for(W in t)Fe(e,W,t[W]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function je(e,n,i){if(!n){for(t={},W=0,X=e.attributes,K=He(X);K>W;++W)P=X[W],t[P.name]=P.value;return Be(t)?t:_(i)?i:{}}if(C(n))return je(e,[n],[_(i)?i:""])[0];t=[];for(W in n)W=n[W],W=e.getAttribute(W)||"",t.push(W);return He(t)?t:_(i)?i:[]}function Ie(e,t){if($(t))for(W in t)Ie(e,t[W]);else if(_(t))e.removeAttribute(t);else for(Ie(e,"class"),W=0,X=e.attributes,K=He(X);K>W;++W)X[W]&&Ie(e,X[W].name)}function qe(e,t,n){if($(t))for(W in t)qe(e,W,t[W]);else Fe(e,"data-"+t,n)}function We(e,n,i){if(!n){for(t={},W=0,X=e.attributes,K=He(X);K>W;++W)P=X[W],"data-"===P.name.slice(0,5)&&(t[P.name]=P.value);return Be(t)?t:_(i)?i:{}}if(C(n))return We(e,[n],[_(i)?i:""])[0];t=[];for(W in n)W=n[W],W=je(e,"data-"+W),t.push(W);return He(t)?t:_(i)?i:[]}function Xe(e,t){if($(t))for(W in t)Ie(e,"data-"+t[W]);else if(_(t))Ie(e,"data-"+t);else for(W=0,X=e.attributes,K=He(X);K>W;++W)X[W]&&"data-"===X[W].name.slice(0,5)&&Ie(e,X[W].name)}function Ke(e){return e&&e.preventDefault(),!1}function Pe(e,t,n){if(t){for(e=Me(e),W=0,X=He(e);X>W;++W)t.addEventListener(e[W],n,!1),Se("on:"+e[W],n,st(t));return l}}function Re(e,t,n){if(t){for(e=Me(e),W=0,X=He(e);X>W;++W)t.removeEventListener(e[W],n,!1),Ae("on:"+e[W],st(t));return w(t)&&t.id.split(":")[0]===Dt+"-dom"&&Ie(t,"id"),l}}function Ue(e,t,n){e=Me(e);var r,i="createEvent"in u;for(W=0,X=He(e);X>W;++W)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[W],!0,!1),t.dispatchEvent(r)):Ye("on:"+e[W],n,st(t));return l}function Ze(e,t,n){for(W=0,X=He(t),K;X>W;++W)K=t[W],e=e.replace(L(K)?K:h(p(K),"g"),n&&n[W]||"");return e}function Ge(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,_(t[n])?t[n]:e})}function Je(e){return m(Ze(Ce(e),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Qe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ve(e);return{x:n-r.l,y:i-r.t}}function Ve(e){for(P=e.offsetLeft,V=e.offsetTop;e=e.offsetParent;)P+=e.offsetLeft,V+=e.offsetTop;return{l:P,t:V}}function et(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function tt(e,t){for(;(e=dt(e))&&e!==t;);return e}function nt(e,t){t=Me(t);for(W in t)e.classList.add(t[W])}function it(e,n,i){if(!n)return t=Me(e.className),He(t)?t:_(i)?i:[];if(C(n))return it(e,[n],[_(i)?i:""])[0];t=[];for(W in n)W=n[W],e.classList.contains(W)&&t.push(W);return He(t)?t:_(i)?i:[]}function rt(e,t){if(_(t)){t=Me(t);for(W in t)e.classList.remove(t[W])}else Ie(e,"class")}function ot(e,t){t=Me(t);for(W in t)e.classList.toggle(t[W])}function ft(e,t,n){if(e=e||"div",e=C(e)?u.createElement(e):e,$(n)){t||(_(n.html)?(t=n.html,delete n.html):_(n.text)&&(t=n.text,delete n.text));for(W in n)if(te=n[W],"classes"===W)nt(e,te);else if("data"===W)for(X in te)te=te[X],null===te?Xe(e,X):qe(e,X,te);else"css"===W?C(te)?Fe(e,"style",te):null===te?Ie(e,"style"):c(e,te):T(te)?e[W]=te:null===te?Ie(e,W):Fe(e,W,E(te)?te.join(" "):""+te)}if(w(t))zt(e,t);else if($(t))for(W in t)te=t[W],w(te)?zt(e,te):te!==!1&&ut(e,te);else _(t)&&t!==!1&&ut(e,t);return e}function st(e){var t=e.id;return t||(t=Dt+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function ut(e,t){e.innerHTML=t}function lt(e,t){return e.innerHTML||(_(t)?t:"")}function at(e,t){if((!_(t)||t)&&(A=pt(e)))for(W=0,X=He(A);X>W;++W)at(A[W]);ut(e,"")}function ct(e){return Array.prototype.slice.call(e)}function dt(e){return e&&e.parentNode}function pt(e){return e&&ct(e.children||[])}function bt(e,t){return _(t)?C(t)?e.closest(t):tt(e,t):dt(e)}function ht(e){return e&&e.nextElementSibling}function yt(e){return e&&e.previousElementSibling}function xt(e){for(W=0;e=yt(e);)++W;return W}function mt(e,t){return e&&C(t)?Ce(e.nodeName)===Ce(t):e&&T(t)?e===t(e):e===t}function gt(e,t){return(t=_(t)?t:u)?C(e)?/^[#.]?(?:\\.|[\w-]|[^\x00-\xa0])+$/.test(e)?"#"===e[0]&&(e=t.getElementById(e.slice(1)))?[e]:"."===e[0]&&(e=t.getElementsByClassName(e.slice(1)))||(e=t.getElementsByTagName(e))?ct(e):[]:ct(t.querySelectorAll(e)):vt(e)?[e]:[]:[]}function vt(e,t){var n=dt(e);return 1===He(arguments)?n||!1:e&&n===e?n:!1}function kt(e,t){Z=dt(e),Z&&Z.insertBefore(t,e)}function wt(e,t){Z=dt(e),Z&&Z.insertBefore(t,ht(e))}function Et(e,t){A=e.firstChild,A?kt(A,t):zt(e,t)}function Tt(e,t){zt(e,t)}function zt(e,t){e.appendChild(t)}function $t(e,t){var n=dt(e);if(n){if(!_(t)||t)for(A=e.firstChild;A;)$t(A);n.removeChild(e)}}function Lt(e,t){return e.cloneNode(_(t)?!!t:!0)}function _t(e,t){return dt(e).replaceChild(t,e),t}function Ct(e){at(ft(e,!1,{style:""})),$t(e)}function Mt(e,t,n){return ft(t,n,{"class":e})}function on(e){return!e||_(e.active)&&!e.active}function fn(e,t,n){return T(e)&&(e={click:e}),C(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Ht[t]||"",_(e.attributes)||(e.attributes={}),n[t]&&(n[t]=e),e}function sn(e){Ot.exit(0,0,0);var t=We(this,"tool-id"),n=Ot.tools,i=n[t];return Ot.drop.target=e.currentTarget||e.target,!on(i)&&T(X=i.click)&&(X=X(e,l,t),Ye("on:change",[e,l,t]),X===!1)?Ke(e):(l.select(),Ke(e))}function un(e){if(V=this,(K=e.TE.key)(["escape","f10"]))Ot.exit(1);else if(K("enter")||K("down")&&We(V,"ui-drop"))Ot.drop.target=V,Ue(se,V,[e]);else if(K("right")&&(P=ht(V))){for(;!mt(P,"a")&&P;)P=ht(P);P&&P.focus()}else if(K("left")&&(P=yt(V))){for(;!mt(P,"a")&&P;)P=yt(P);P&&P.focus()}return Ke(e)}function an(){at(Xt,0);var r,o,f,s,u,a,c,e=Ot.tools,t=Me(D.tools),n=Dt+"-button",i=Dt+"-separator";D.tools=t;for(a in t)c=t[a],o=e[c],(o||o==={})&&(o=fn(o,c,e),f=o.i||c,"|"===f||Ne(f,"<")||(f=Je(f)),s="|"!==f,u=Je(c).replace(/[\/\s]/g,"-"),nn=Mt(s?n+" "+n+"-"+u:i+" "+i+"-"+a,s?"a":"span"),s?(nn=o.target||nn,r=n+":"+u,Fe(nn,{href:Le,id:r,tabindex:-1}),qe(nn,"tool-id",c),f=Ne(f,"<")?f:Ot.i(u,f),on(o)?nt(nn,"x"):rt(nn,"x"),o.on?nt(nn,"on"):rt(nn,"on"),o.text&&(f=Ge('<span class="'+Dt+'-text">'+o.text+"</span>",[f]),nt(nn,"text")),ut(nn,f),ft(nn,!1,o.attributes),!o.attributes.title&&(X=o.title)&&(nn.title=$(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),Pe(se,nn,sn),Pe(de,nn,un)):nn.id=i+":"+a,o.target=nn,(u=We(nn,ln))&&Ot.menu.set(c,u),zt(Xt,nn));Ye("update.tools",[l])}function cn(){Ot.keys=function(){var n,e=De(Ot.keys).sort().reverse(),t={};for(W=0,X=He(e);X>W;++W)n=e[W],t[n]=Ot.keys[n];return t}(),pn(),Ye("update.keys",[l])}function dn(e){function b(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,u=Ot.keys,a=TE.keys_a,c={control:0,shift:0,option:"alt",meta:0},d=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(W in c)e.TE[W]()&&(H[c[W]||W]=1);U=e.TE.key(),H[U]=1,t=Be(H),x(function(){l.record()});for(W in u){K=b(W),A=0;for(X in K)X=K[X],H[a[X]||X]&&++A;if(K=He(K),A===K&&t===K&&(C(u[W])&&(u[W]=Ot.tools[u[W]].click),P=T(u[W])&&u[W](e,l),P===!1))return Ke(e)}if(ge)for(W in ge)if(R=ge[W],R!==!1){if(U===R&&f===R)return"\\"===o?(l.insert(U,0),Ke(e)):(l.select(n.end+1),Ke(e));if(W===U)return l.wrap(W,R),Ke(e);if(o===W&&f===R){if("backspace"===U&&i.slice(-2)!=="\\"+W)return l.unwrap(W,R),Ke(e);if(ve&&"enter"===U&&W!==R&&!s)return l.tidy("\n"+d+we,"\n"+d).scroll(1),Ke(e)}}if(ve&&!s){if("backspace"===U&&h(p(we)+"$").test(i))return l.outdent(we),Ke(e);if("enter"===U&&h("(^|\\n)("+p(we)+")+.*$").test(i))return l.insert("\n"+d,0,1).scroll(1),Ke(e)}}function pn(e){e&&e.TE&&e.TE.key?delete H[e.TE.key()]:H={}}function mn(e){return bn=Yt,Q=et(Wt),Ke(e)}function gn(e){bn===Yt&&c(Kt,{height:Qe(qt,e).y-Q.h+_e})}function vn(){bn=0}function kn(){Ot.exit(1)}function wn(){t=et(Zt),ne=t.w,q=t.h,t=et(Ut),hn=t.w,yn=t.h}function En(e,t){return t&&Ye("exit.modal."+t,[l]),Ue(se,Ut,[e]),Ke(e)}function Tn(e){bn=e.target,t=Qe(Zt,e),ie=t.x,re=t.y,wn()}function zn(e){var n=xn.header,i=xn.sizer;bn===n||tt(bn,n)===n?(t=Qe(qt,e),P=t.x-ie,V=t.y-re,c(Zt,{left:(ne>hn?P:d(P,0,hn-ne))+_e,top:(q>yn?V:d(V,0,yn-q))+_e})):bn===i&&(t=Qe(Zt,e),Q=et(i),c(Zt,{width:t.x+Q.w/4+_e,height:t.y+Q.h/4+_e}))}function $n(){bn=0}function Ln(e,t,n){return{header:e,body:t,footer:n}}function _n(e){B=Ot.drop.target,S=Gt,A=e&&e.target||0,(!A||A!==B&&tt(A,B)!==B)&&(Ot.drop.target=0,Ot.exit(A===Kt))}var B,S,A,j,q,W,X,K,P,R,U,t,Z,J,Q,V,ee,te,ne,ie,re,n="⌘",i="…",o="⇥",f="⇧",s=window,u=document,l=new TE(e),a=l._,c=a.css,d=a.edge,p=a.x,b=a.extend,h=a.pattern,y=a.timer.reset,x=a.timer.set,m=a.trim,g={},v=function(){},k=TE.is,w=k.e,E=k.a,T=k.f,z=k.i,$=k.o,L=k.r,_=function(e){return!k.x(e)},C=k.s,M=u.documentElement,O=u.head,N=u.body,D=b({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%2"}},t),H={},fe="blur",se="click",de="keydown",pe="keyup",be="touchstart mousedown",he="touchmove mousemove",ye="touchend mouseup",me="orientationchange resize",ge=D.auto_close,ve=D.auto_tab,ke=D.languages,we=D.tab,Te=(D.union[1][1],D.union[1][0]),ze=D.union[0][1],$e=D.union[0][0],Le="javascript:;",_e="px",Ot=l.ui={};l.tidy=function(e,t){var n=l.$(),i=m(n.before)?e:"",r=m(n.after)?_(t)?t:e:"";return l.trim(i,r)},l.i=function(){return m(l.replace(/\s+/g," "))},l.format=function(e,t,n,i){$(e)||(e=[e]),_(n)||(n=" "),_(i)||(i="");var r=l.h,o=l[0]().$(),f=e[0].split(h("("+ze[3]+")+"))[0],s=(e[0]?Te[0]+e[0]+Te[1]:"")+i,u=i+(e[0]?Te[0]+Te[2]+(e[1]||f)+Te[1]:""),a=p(e[0]?Te[0]+f+Te[1]:""),c=p(u),d=h("^"+a+"([\\s\\S]*?)"+c+"$"),b=h(a+"$"),y=h("^"+c),x=o.before,m=o.after;return o.length?n=!1:l.insert(ke.placeholders[""]),l.toggle(t?!d.test(o.value):!b.test(x)&&!y.test(m),[function(e){e.unwrap(s,u,1).tidy(h($e[0]+"[^"+$e[0]+$e[1]+$e[2]+"]+?"+$e[1]+"$").test(x)?"":n,h("^"+$e[0]+$e[2]+"[^"+$e[0]+$e[1]+"]+?"+$e[1]).test(m)?"":n).wrap(s,u,t)},function(e){e.unwrap(s,u,t)}])[r]()};var nn,Nt=D.classes,Dt=Nt[""],Ht=ke.tools,Bt=ke.buttons,St=ke.labels,At=Dt+"-textarea "+Dt+"-content block",Yt=Mt(Dt+"-sizer s"),Ft=Mt(Dt+"-sizer se"),jt=Mt(Dt),It=Mt(Dt+"-header"),qt=Mt(Dt+"-body"),Wt=Mt(Dt+"-footer"),Xt=Mt(Dt+"-tool"),Kt=ft(e,!1,D.attributes),Pt=Mt(Dt+"-description"),Rt=ft(),Ut=ft(),Zt=ft(),Gt=ft(),Jt=ft(),Qt=ft(),Vt=Mt("left","span"),en=Mt("right","span"),tn=0;Ot.i=function(e,t,n){return e=Je(e).replace(/[\/\s]/g,"-"),Q=Ge(Nt.i,[e,t||e]),n?(rt(n),nt(n,Q),n):'<i class="'+Q+'"></i>'},_(D.suffix)||(D.suffix=Te[1]);var ln="ui-drop-data",bn=0,ie=0,re=0,ne=0,q=0,hn=0,yn=0,xn={};l.create=function(e,t){if(l.is.create)return l;l.is.create=!0,$(e)&&(D=b(D,e));var n=vt(Kt);return nt(jt,Dt+"-is-can-update"),nt(jt,Dt+"-is-can-copy"),nt(Kt,At),n&&mt(n,"p")?(kt(n,jt),tn=n,$t(n,!1)):kt(Kt,jt),jt.dir=D.direction,zt(jt,It),zt(jt,qt),zt(jt,Wt),zt(qt,Kt),D.tools&&(zt(It,Xt),zt(Wt,Pt),zt(Pt,Vt),zt(Pt,en)),Pe(de,Kt,dn),Pe(pe+" "+fe,Kt,pn),U=Dt+"-is-can-resize",D.resize?(zt(jt,Yt),nt(jt,U),Pe(be,Yt,mn),Pe(he,u,gn),Pe(ye,u,vn)):rt(jt,U),an(),cn(),0!==t?Ye("create",[l]):l},l.update=function(e,t){return l.is.create&&l.destroy(0),(0!==t?Ye("update",[l]):l).create(e,0)},l.destroy=function(e){return l.is.create?(l.is.create=!1,Ot.exit(0,0,0),rt(Kt,At),D.tools=Oe(D.tools),D.keys&&(Re(de,Kt,dn),Re(pe,Kt,pn)),D.resize&&(Re(be,Yt,mn),Re(he,u,gn),Re(ye,u,vn)),tn?(kt(jt,tn),zt(tn,Kt),tn=0):kt(jt,Kt),Ct(jt),0!==e?Ye("destroy",[l]):l):l},l.enable=function(e){return Kt.disabled=Kt.readOnly=!1,nt(jt,Dt+"-is-can-update"),nt(jt,Dt+"-is-can-copy"),0!==e?Ye("enable",[l]):l},l.disable=function(e){return Kt.disabled=!0,rt(jt,Dt+"-is-can-update"),rt(jt,Dt+"-is-can-copy"),0!==e?Ye("disable",[l]):l},l.freeze=function(e){return Kt.disabled=!1,Kt.readOnly=!0,rt(jt,Dt+"-is-can-update"),nt(jt,Dt+"-is-can-copy"),0!==e?Ye("freeze",[l]):l},l.plugs={},l.plug=function(e,t,n){return Q=/\.css$/i.test(e),V=ft(Q?"link":"script",!1,t),Q?(V.href=e,V.rel="stylesheet"):V.src=e,l.plugs[e]=V,zt(n||O,V),l},Ot.exit=function(e,t,n){if(j={panel:function(){Ct(Rt)},overlay:function(){Re(se,Ut,kn),Ct(Ut)},modal:function(){Re(se+" "+de,xn.x,En),Re(be,qt,Tn),Re(he,qt,zn),Re(ye,u,$n),Ct(Zt)},drop:function(){Re(se,u,_n),Re(me,s,_n),Ct(Gt)},bubble:function(){Ct(Jt)}},pn(),t)if($(t))for(W in t)W=t[W],j[W]&&j[W](),0!==n&&Ye("exit."+W,[l]);else j[t]&&j[t](),0!==n&&Ye("exit."+W,[l]);else for(W in j)j[W]();return e&&l.select(),0!==n&&Ye("exit",[l]),l},Ot.panel=function(e,t,n,i){function r(e){return Re(se+" "+de,ie,r),Ot.panel.exit(1),Ke(e)}return Ot.exit(0,0,0),P=Je(e),V=0,i&&(P+=" "+P+"--"+Je(i)),$(t)&&!w(t)&&(V=Mt(Dt+"-panel-header "+P,0,t.header),t=t.body),ee=Mt(Dt+"-panel-body "+P,0,Mt(Dt+"-panel-content "+P,0,T(t)?"":t)),T(t)&&t(ee),ie=ft("a",!1,{href:Le,"class":Dt+"-a "+Dt+"-x "+P}),ie.title=Bt.close,ft(Rt,!1,{"class":Dt+"-panel "+P}),Pe(se+" "+de,ie,r),at(Rt,0),V&&zt(Rt,V),zt(qt,ft(Rt,[ee,ie])),T(n)?n(Rt):C(n)&&ft(Rt,n),B=[l,Rt],i&&Ye("enter.panel."+e+":"+i,B),Ye("enter.panel."+e,B),Ye("enter.panel",B),Ye("enter",B),ie.focus(),l},Ot.panel.fit=function(){},Ot.overlay=function(e,t,n,i){return Ot.exit(0,0,0),P=Je(e),i&&(P+=" "+P+"--"+Je(i)),zt(qt,ft(Ut,!1,{"class":Dt+"-overlay "+P})),t&&Pe(se,Ut,kn),T(n)?n(Ut):C(n)&&ft(Ut,n),B=[l,Ut],i&&Ye("enter.overlay."+e+":"+i,B),Ye("enter.overlay."+e,B),Ye("enter.overlay",B),Ye("enter",B),l},Ot.overlay.fit=function(){},Ot.message=function(e,t,n,i,r){function f(e){return Re(se+" "+de,ie,f),y(o),Ot.overlay.exit(1),Ke(e)}var o;return P=Je(e),r&&(P+=" "+P+"--"+Je(r)),ie=ft("a",!1,{href:Le,"class":Dt+"-a "+Dt+"-x "+P}),ie.title=Bt.close,ft(Qt,T(t)?t(Qt):t,{"class":Dt+"-message "+P}),Pe(se+" "+de,ie,f),Ot.overlay("message message-"+P,0,function(e){zt(Qt,ie),n&&(o=x(function(){f()},n)),zt(e,Qt)},r),T(i)?i(Qt):C(i)&&ft(Qt,i),l},Ot.modal=function(){var s,a,e=arguments,t=e[0],n=e[1],i=e[2],r=e[3],o=Dt+"-modal",f=n.footer;if($(t)&&(t="default",n=e[0],i=e[1],r=e[2]),Ot.overlay(t,1,0,r).blur(),P=Je(t),r&&(P+=" "+P+"--"+Je(r)),ft(Zt,!1,{"class":o+" "+P}),_(n.body)&&(n.body=ft("div",n.body,{"class":o+"-content "+P})),_(f)&&$(f)&&!w(f)){a=[];for(W in f)X=f[W],w(X)?a.push(X):(X=fn(X,W,f),K=W.text||Bt[W]||W,s=ft("button",K,b({name:"y["+W+"]",type:"button","class":Dt+"-button",data:{"button-id":W}},X.attributes)),Pe(se,s,function(e){return K=f[We(this,"button-id")].click(e,l),K===!1?Ke(e):void 0}),a.push(s));n.footer=a}for(W in n)o[1]=W,xn[W]=Mt(o+"-"+Ge(W,o)+" "+P,0,n[W]);return xn.x=ft("a",!1,{href:Le,"class":Dt+"-a "+Dt+"-x "+P}),xn.sizer=Ft,at(Zt,0),xn.x.title=Bt.close,zt(qt,ft(Zt,xn,{style:""})),Ot.modal.fit(),wt(Zt,Ut),Pe(se+" "+de,xn.x,En),Pe(be,xn.header,Ke),Pe(be,xn.sizer,Ke),Pe(be,qt,Tn),Pe(he,qt,zn),Pe(ye,u,$n),T(i)&&i(xn),B=[l,Zt,xn],r&&Ye("enter.modal."+t+":"+r,B),Ye("enter.modal."+t,B),Ye("enter.modal",B),Ye("enter",B),xn.x.focus(),l},Ot.modal.fit=function(e){return wn(),P=hn/2-ne/2,V=yn/2-q/2,$(e)?(_(e[0])&&(P=e[0]),_(e[1])&&(V=e[1])):(P=d(P,0),V=d(V,0)),c(Zt,{left:P+_e,top:V+_e,"min-width":ne+_e,"min-height":q+_e,visibility:"visible"}),B=[l,Zt,xn],Ye("fit.modal",B),Ye("fit",B),l};var Cn={"class":Dt+"-button",name:"y"};return Ot.alert=function(e,t,n,i,r){var o=ft("button",Bt.okay,Cn),f="alert";return n=n||v,$(e)&&(f+=":"+e[0],e=e[1]||e[0]),Pe(se,o,function(e){return n(e,l),En(e,f+".y")}),Pe(de,o,function(e){var t=e.TE.key;return t(["enter","escape"])&&Ue(se,o,[e]),Ke(e)}),Ot.modal(f,Ln(e,t,o),i,r),o.focus(),l},Ot.confirm=function(e,t,n,i,r,o){function c(e){return T(n)&&n(e,l),En(e,u+".y")}function d(e){return T(i)&&i(e,l),En(e,u+".n")}var a,f=ft("button",Bt.okay,Cn),s=ft("button",Bt.cancel,Cn),u="confirm";return s.name="n",Pe(se,f,c),Pe(se,s,d),Pe(de,f,function(e){return a=e.TE.key,a("right")?s.focus():a("enter")?c(e):a("escape")&&En(e,u+".y"),Ke(e)}),Pe(de,s,function(e){return a=e.TE.key,a("left")?f.focus():a("enter")?d(e):a("escape")&&En(e,u+".n"),Ke(e)}),Ot.modal(u,Ln(e,t,[f,s]),r,o),s.focus(),l},Ot.prompt=function(e,t,n,i,r,o,f){function y(){a.focus(),"placeholder"in a&&a.select()}function x(e){return p=a.value,T(n)&&!n(p)?y():!n||m(p)&&p!==t?(En(e,c+".y"),i(e,l,p!==t?p:"",t)):y(),Ke(e)}function g(e){return En(e,c+".n")}var p,b,h,s=ft("button",Bt.okay,Cn),u=ft("button",Bt.cancel,Cn),a=ft("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Dt+"-input block"}),c="prompt",d=[];if(r=r||0,1===r)a=ft("textarea",t,{placeholder:t.split("\n")[0],"class":Dt+"-textarea block",spellcheck:"false"});else if(2===r){for(W in t)d.push(ft("option",t[W],{value:W,selected:W===n||null}));a=ft("select",d,{"class":Dt+"-select block"})}return i=i||v,a.name="data",u.name="n",Pe(de,a,function(e){return b=e.TE.key,h=e.TE.control,b("enter")&&0===r||h("enter")?x(e):b("escape")||b("back")&&!this.value?g(e):b("down")&&0===r||b("enter")&&2===r||h("down")?(s.focus(),Ke(e)):void 0}),Pe(de,s,function(e){return b=e.TE.key,b("enter")?x(e):b("escape")?g(e):b("up")?a.focus():b("right")&&u.focus(),Ke(e)}),Pe(de,u,function(e){return b=e.TE.key,b(["enter","escape"])?g(e):b("up")?a.focus():b("left")&&s.focus(),Ke(e)}),Pe(se,s,x),Pe(se,u,g),Ot.modal(c,Ln(e,a,[s,u]),o,f),y(),l},Ot.drop=function(){Ot.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===He(e)&&(t="default",n=e[0],i=e[1]),P=Je(t),at(Gt,0),zt(N,ft(Gt,!1,{"class":Dt+"-drop "+P})),T(n)?n(Gt):ft(Gt,n),Ot.drop.fit(),i===!1||(Pe(se,u,_n),Pe(me,s,_n)),B=[l,Gt],Ye("enter.drop."+t,B),Ye("enter.drop",B),l},Ot.drop.fit=function(e){return B=et(M),S=et(Gt),A=Ot.drop.target,P=B.w/2-S.w/2,V=B.h/2-S.h/2,!_(e)&&A&&(t=Ve(A),P=t.l,V=t.t+et(A).h),$(e)?(_(e[0])&&(P=e[0]),_(e[1])&&(V=e[1])):(P=d(P,0,B.w-S.w),V=d(V,0,Math.max(B.h,et(s).h)-S.h)),c(Gt,{left:P+_e,top:V+_e,visibility:"visible"}),B=[l,Gt],Ye("fit.drop",B),Ye("fit",B),l},Ot.menu=function(e,n,i,r){var s,o=Ot.tools,f=0;if(n===!1)return Ot.tool(e,n);for(r in i)ne="%"===r[0],s=i[r],s=C(s)&&!ne?o[s]:s,s&&(s=fn(s,r,o),i[r]=s);return Ot.tool(e,{i:$(n)?n[0]:0,text:$(n)?n[1]||0:n&&i[n]&&i[n].text||n,click:function(u){var a=Ot.drop.target=o[e].target;return Ot.drop("menu menu-"+Je(e),function(u){function c(f){return V=this,t=We(V,"tool-id"),R=i[t],R=C(R)?o[R]:R||{},U=lt(V),!on(R)&&T(r=R.click)&&(r=r(f,l),R.i&&(o[e].i=R.i),Ot.menu.set(e,$(R.text)?[R.text[0],t]:$(n)?[n[0],t]:t),r===!1)?(l.select(),Ke(f)):(l.select(),Ke(f))}function d(e){if(V=this,(K=e.TE.key)("escape"))Ot.exit(1);else if(K("enter"))Ue(se,V,[e]);else if(K("f10")&&a)a.focus();else if(K("down")&&(P=ht(V))){for(;!mt(P,"a")&&P;)P=ht(P);P&&P.focus()}else if(K("up")&&(P=yt(V))){for(;!mt(P,"a")&&P;)P=yt(P);!P&&a?(Ot.exit(),a.focus()):P&&P.focus()}else K("up")&&a&&(Ot.exit(),a.focus());return Ke(e)}for(r in i)if(s=i[r],ne="%"===r[0],s){var p={href:ne?null:Le,"class":Dt+"-"+(ne?"label":"button")};ne?X=St[e]&&St[e][+r.slice(1)-1]||r:(p.data={},p.data["tool-id"]=r,X=Ht[r]||r),J=s.text,J=$(J)?J[1]||"":J,X=$(X)?X[0]:X,Q=ft(ne?"span":"a","<span>"+(ne?X||"%"+f:J||X)+"</span>",b(p,s.attributes||{})),nt(Q,"menu-"+Je(r).replace(/[\/\s]/g,"-")),!p.title&&(V=s.title)&&(Q.title=$(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),ne?Fe(Q,{id:Dt+"-label:"+f}):(on(s)?nt(Q,"x"):rt(Q,"x"),s.on?nt(Q,"on"):rt(Q,"on"),Pe(se,Q,c),Pe(de,Q,d)),zt(u,Q),++f}x(function(){(gt('[data-tool-id="'+We(a,ln)+'"]',u)[0]||gt("a",u)[0]).focus()},1)}),!1}},r),qe(o[e].target,{"ui-drop":e}),o[e].data=i,Ot.menu.set(e,n)},Ot.menu.set=function(e,t){var o,f,n=Ot.tools[e]||{},i=n.target,r=n.data;return i?($(t)?qe(i,ln,t[1]||""):(qe(i,ln,t),t=r[t]&&r[t].text||t),$(t)?(f=t[0],f=Ne(f,"<")?f:Ot.i(f,n.i),t=_(t[1])?t[1]:0,t=t&&r[t]&&r[t].text||t,t=f+(0!==t?"<span>"+($(t)?t[1]||t:t)+"</span>":"")):f=Ot.i(e,n.i),(o=gt("."+Dt+"-text",i)[0])?(nt(i,"text"),ut(o,t)):(rt(i,"text"),ut(i,f)),l):l},Ot.bubble=function(){Ot.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===He(e)&&(t="default",n=e[0]),P=Je(t),at(Jt,0),zt(N,ft(Jt,!1,{"class":Dt+"-bubble "+P})),T(n)?n(Jt):ft(Jt,n),Ot.bubble.fit(),B=[l,Jt],Ye("enter.bubble."+t,B),Ye("enter.bubble",B),l},Ot.bubble.fit=function(e){Q=l.$(1),t=Ve(Kt),q=c(Kt,"line-height");var n="border-",i="-width";P=Q.caret[0].x+t.l-Kt.scrollLeft,V=Q.caret[1].y+t.t+q-Kt.scrollTop,S=c(qt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=et(qt),o=et(Jt),f=S[0]+S[1],s=S[2]+S[3];return $(e)?(_(e[0])&&(P=e[0]),_(e[1])&&(V=e[1])):(P=d(P,t.l,t.l+r.w-o.w-s),V=d(V,t.t,t.t+r.h-o.h-f)),c(Jt,{left:P+_e,top:V+_e,visibility:"visible"}),B=[l,Jt],Ye("fit.bubble",B),Ye("fit",B),l},Ot.panel.exit=function(e){return Ot.exit(e,"panel")},Ot.overlay.exit=function(e){return Ot.exit(e,"overlay")},Ot.modal.exit=function(e){return Ot.exit(e,"modal")},Ot.drop.exit=function(e){return Ot.exit(e,"drop")},Ot.bubble.exit=function(e){return Ot.exit(e,"bubble")},Ot.tool=function(e,t,n){var i=Ot.tools;return X="",K=_(i[e])?"update":"create","|"!==e&&(D.tools=Me(D.tools||"").filter(function(t,n){return t===e?(X=n,!1):!0})),t===!1?(delete i[e],K="destroy"):("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),i[e]=b(i[e]||{},t),_(n)||""===X||(n=X)),z(n)?D.tools.splice(n,0,e):D.tools.push(e)),Ye(K+".tool."+e,[l,i[e]]),an(),l},Ot.separator=function(e,t){return Ot.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Ot.key=function(e,t){var n=Ot.keys;return K=_(n[e])?"update":"create",t===!1?(delete n[e],K="destroy"):n[e]=t,Ye(K+".key."+e,[l,n[e]]),cn(),l},Ot.key.set=function(e){H[e]=1},Ot.key.reset=function(e){e?delete H[e]:H={}},Ot.tools={"|":{},undo:{click:function(e,t){return t.undo(),!1}},redo:{click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(we),!1},outdent:function(e,t){return t.outdent(we),!1}},Ot.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return J=":not([tabindex]):not([disabled])",(Q=gt("input"+J+",button"+J+",select"+J+",textarea"+J+",a[href]"+J+",[contenteditable]"+J+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(V=Q.indexOf(Kt))?((Q[V+1]||u).focus(),!1):void 0},f10:function(e,t){return gt("a",Xt)[0].focus(),!1},tab:ve?"indent":0,"shift+tab":ve?"outdent":0},Ot.el={container:jt,header:It,body:qt,footer:Wt,panel:Rt,overlay:Ut,modal:Zt,drop:Gt,bubble:Jt},l.config=D,b(TE._,{time:function(e){var t=new Date(_(e)?e:Date.now()),n=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=t.getHours(),f=t.getMinutes(),s=t.getSeconds(),u=t.getMilliseconds();return 10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),10>u&&(u="0"+u),[""+n,""+i,""+r,""+o,""+f,""+s,""+u]},replace:Ze,format:Ge,dom:{set:zt,reset:$t,get:gt,id:st,copy:Lt,replace:_t,classes:{set:nt,reset:rt,toggle:ot,get:it},attributes:{set:Fe,reset:Ie,get:je},data:{set:qe,reset:Xe,get:We},is:mt,offset:Ve,pointer:Qe,size:et,content:{set:ut,reset:at,get:lt},closest:tt,parent:dt,children:pt,closest:bt,next:ht,previous:yt,index:xt,before:kt,after:wt,prepend:Et,append:Tt},el:ft,events:{set:Pe,reset:Re,fire:Ue,x:Ke}}),b(l._,TE._),b(l._,{hooks:{set:Se,reset:Ae,fire:Ye}}),l.create()};