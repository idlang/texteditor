/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.5.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function ze(e){return C(e)?y(e).split(/\s+/):e}function Ce(e){return T(e)?e.join(" "):e}function Le(e){return e.length}function Se(e,t,n){return z(e)?z(t)?(z(v[e])||(v[e]={}),z(n)||(n=Le(Object.keys(v[e]))),v[e][n]=t,a):v[e]:v}function Oe(e,t){return z(e)?z(t)&&z(v[e])?(delete v[e][t],a):(v[e]={},a):(v={},a)}function je(e,t,n){if(!z(v[e]))return v[e]={},a;if(z(n))z(v[e][n])&&v[e][n].apply(a,t);else for(N in v[e])v[e][N].apply(a,t);return a}function He(e,t,n){if(T(t))for(N in t)He(e,N,t[N]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Ae(e,n,r){if(C(n))return Ae(e,[n],z(r)?r:"")[0];t=[];for(N in n)N=n[N],(N=e.getAttribute(N))&&t.push(N);return Le(t)?t:z(r)?r:[]}function Me(e,t){if(T(t))for(N in t)Me(e,t[N]);else if(z(t))e.removeAttribute(t);else for(Me(e,"class"),N=0,I=e.attributes,Y=Le(I);Y>N;++N)I[N]&&Me(e,I[N].name)}function Be(e,t,n){if(T(t))for(N in t)Be(e,N,t[N]);else He(e,"data-"+t,n)}function Re(e,n,r){if(C(n))return Re(e,[n],z(r)?r:"")[0];t=[];for(N in n)N=n[N],(N=Ae(e,"data-"+N))&&t.push(N);return Le(t)?t:z(r)?r:[]}function Ke(e,t){if(T(t))for(N in t)Me(e,"data-"+t[N]);else if(z(t))Me(e,"data-"+t);else for(N=0,I=e.attributes,Y=Le(I);Y>N;++N)I[N]&&"data-"===I[N].name.slice(0,5)&&Me(e,I[N].name)}function qe(e){return e&&e.preventDefault(),!1}function Fe(e,t,n){if(t){for(e=ze(e),N=0,I=Le(e);I>N;++N)t.addEventListener(e[N],n,!1),Se("on:"+e[N],n,tt(t));return a}}function Ne(e,t,n){if(t){for(e=ze(e),N=0,I=Le(e);I>N;++N)t.removeEventListener(e[N],n,!1),Oe("on:"+e[N],tt(t));return x(t)&&t.id.split(":")[0]===Et+"-dom"&&Me(t,"id"),a}}function Ie(e,t,n){e=ze(e);var i,r="createEvent"in s;for(N=0,I=Le(e);I>N;++N)r?(i=s.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[N],!0,!1),t.dispatchEvent(i)):je("on:"+e[N],n,tt(t));return a}function Ye(e,t,n){for(N=0,I=Le(t),Y;I>N;++N)Y=t[N],e=e.replace(_(Y)?Y:g(d(Y),"g"),n&&n[N]||"");return e}function De(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,z(t[n])?t[n]:e})}function Pe(e){return y(Ye(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ue(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=Xe(e);return{x:n-i.l,y:r-i.t}}function Xe(e){for(D=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)D+=e.offsetLeft,J+=e.offsetTop;return{l:D,t:J}}function Ze(e){return e===u?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function Ve(e,t){for(;(e=ot(e))&&e!==t;);return e}function We(e,t){t=ze(t);for(N in t)e.classList.add(t[N])}function Je(e,n,r){if(C(n))return Je(e,[n],z(r)?r:"")[0];t=[];for(N in n)N=n[N],e.classList.contains(N)&&t.push(N);return Le(t)?t:z(r)?r:!1}function Qe(e,t){if(z(t)){t=ze(t);for(N in t)e.classList.remove(t[N])}else Me(e,"class")}function Ge(e,t){t=ze(t);for(N in t)e.classList.toggle(t[N])}function et(e,t,n){if(e=C(e)?s.createElement(e):e,T(n))for(N in n)if(G=n[N],"classes"===N)We(e,G);else if("data"===N)for(I in G)G=G[I],null===G?Ke(e,I):Be(e,I,G);else"css"===N?C(G)?He(e,"style",G):null===G?Me(e,"style"):c(e,G):$(G)?e[N]=G:null===G?Me(e,N):He(e,N,T(G)?G.join(" "):""+G);if(x(t))mt(e,t);else if(T(t))for(N in t)G=t[N],x(G)?mt(e,G):G!==!1&&nt(e,G);else z(t)&&t!==!1&&nt(e,t);return e}function tt(e){var t=e.id;return t||(t=Et+"-dom:"+Date.now(),e.id=t),t}function nt(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(z(t)?t:"")}function it(e,t){if(t!==!1&&(M=ft(e)))for(N=0,I=Le(M);I>N;++N)it(M[N]);nt(e,"")}function ot(e){return e&&e.parentNode}function ft(e){return e&&e.children||[]}function ut(e){return e&&e.nextSibling}function st(e){return e&&e.previousSibling}function at(e){for(N=0;e=st(e);)++N;return N}function lt(e,t){return e&&C(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&$(t)?e===t(e):e===t}function ct(e,n){if(!(n=z(n)?n:s))return[];if(t=[],C(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(N=0,I=Le(e);I>N;++N)t.push(e[N]);return t}return[]}for(e=n.querySelectorAll(e),N=0,I=Le(e);I>N;++N)t.push(e[N]);return t}return pt(e)?[e]:[]}function pt(e,t){var n=ot(e);return 1===Le(arguments)?n||!1:e&&n===e?n:!1}function dt(e,t){X=ot(e),X&&X.insertBefore(t,e)}function ht(e,t){X=ot(e),X&&X.insertBefore(t,ut(e))}function gt(e,t){M=ft(e)[0],M?dt(M,t):mt(e,t)}function bt(e,t){mt(e,t)}function mt(e,t){e.appendChild(t)}function yt(e,t){var n=pt(e);if(n){if(t!==!1)for(M=ft(e)[0];M;)yt(M);n.removeChild(e)}}function vt(e){it(et(e,!1,{style:""})),yt(e)}function wt(e,t,n){return et(t||"div",n,{"class":e})}function Xt(e){return!e||z(e.active)&&!e.active}function Zt(){return At.disabled||At.readOnly}function Vt(e,t,n){return $(e)&&(e={click:e}),C(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Tt[t]||"",z(e.attributes)||(e.attributes={}),n[t]=e,e}function Wt(e){if(Zt())return At.focus(),qe(e);kt.exit(0,0,0);var t=Re(this,"tool-id"),n=kt.tools,r=n[t];return kt.drop.target=e.currentTarget||e.target,!Xt(r)&&$(I=r.click)&&(I=I(e,a,t),je("on:change",[e,a,t]),I===!1)?qe(e):(a.select(),qe(e))}function Jt(e){if(J=this,(Y=e.TE.key)(/^(escape|f10)$/))kt.exit(1);else if(Y("enter")||Y("arrowdown")&&Re(J,"ui-drop"))kt.drop.target=J,Ie(oe,J,[e]);else if(Y("arrowright")&&(D=ut(J))){for(;!lt(D,"a")&&D;)D=ut(D);D&&D.focus()}else if(Y("arrowleft")&&(D=st(J))){for(;!lt(D,"a")&&D;)D=st(D);D&&D.focus()}return qe(e)}function Qt(){it(Ht,!1);var i,o,f,u,s,l,c,e=kt.tools,t=ze(j.tools),n=Et+"-button",r=Et+"-separator";j.tools=t;for(l in t)c=t[l],o=e[c],(o||o==={})&&(o=Vt(o,c,e),f=o.i||c,"|"!==f&&"<"!==f[0]&&(f=Pe(f)),u="|"!==f,s=Pe(c).replace(/[\/\s]/g,"-"),Pt=wt(u?n+" "+n+"-"+s:r+" "+r+"-"+l,u?"a":"span"),u?(Pt=o.target||Pt,i=n+":"+s,He(Pt,{href:Te,id:i,tabindex:-1}),Be(Pt,"tool-id",c),f="<"===f[0]?f:'<i class="'+De($t,[s,f])+'"></i>',Xt(o)?We(Pt,"x"):Qe(Pt,"x"),o.on?We(Pt,"on"):Qe(Pt,"on"),o.text&&(f=De('<span class="'+Et+'-text">'+o.text+"</span>",[f]),We(Pt,"text")),nt(Pt,f),et(Pt,!1,o.attributes),!o.attributes.title&&(I=o.title)&&(Pt.title=T(I)?I[0]+(I[1]?" ("+I[1]+")":""):I),Fe(oe,Pt,Wt),Fe(le,Pt,Jt)):Pt.id=r+":"+l,o.target=Pt,mt(Ht,Pt));je("update.tools",[a])}function Gt(){kt.keys=function(){var n,e=Object.keys(kt.keys).sort().reverse(),t={};for(N=0,I=Le(e);I>N;++N)n=e[N],t[n]=kt.keys[n];return t}(),rn(),je("update.keys",[a])}function nn(e){function p(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}if(Zt())return At.focus(),qe(e);var n=a.$(),r=n.before,i=n.after,o=r.slice(-1),f=i[0],u=n.length,s=kt.keys,l=TE.keys_alias,c=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();U=e.TE.key(),en[U]=1,t=Le(Object.keys(en)),m(function(){a.record()});for(N in s){Y=p(N),M=0;for(I in Y)I=Y[I],en[l[I]||I]&&++M;if(Y=Le(Y),M===Y&&t===Y&&(C(s[N])&&(s[N]=kt.tools[s[N]].click),D=s[N]&&s[N](e,a),D===!1))return qe(e)}if(me)for(N in me)if(P=me[N],P!==!1){if(U===P&&f===P)return"\\"===o?(a.insert(U,0),qe(e)):(a.select(n.end+1),qe(e));if(N===U)return a.wrap(N,P),qe(e);if(o===N&&f===P){if("backspace"===U&&r.slice(-2)!=="\\"+N)return a.unwrap(N,P),qe(e);if(ye&&"enter"===U&&N!==P)return a.tidy("\n"+c+we,"\n"+c).scroll(1),qe(e)}}if(ye&&!u){if("backspace"===U&&g(d(we)+"$").test(r))return a.outdent(we),qe(e);if("enter"===U&&g("(^|\\n)("+d(we)+")+.*$").test(r))return a.insert("\n"+c,0,1).scroll(1),qe(e)}}function rn(e){e&&e.TE&&e.TE.key?delete en[e.TE.key()]:en={}}function an(e){return on=Mt,W=Ze(jt),qe(e)}function ln(e){on===Mt&&c(At,{height:Ue(Ot,e).y-W.h+_e})}function cn(){on=0}function pn(){kt.exit(1)}function dn(){t=Ze(qt),ee=t.w,F=t.h,t=Ze(Kt),fn=t.w,un=t.h}function hn(e,t){t&&je("exit.modal."+t,[a]),Ie(oe,Kt,[e])}function gn(e){on=e.target,t=Ue(qt,e),te=t.x,ne=t.y,dn()}function bn(e){var n=sn.header,r=sn.resize;on===n||Ve(on,n)===n?(t=Ue(Ot,e),D=t.x-te,J=t.y-ne,c(qt,{left:(ee>fn?D:p(D,0,fn-ee))+_e,top:(F>un?J:p(J,0,un-F))+_e})):on===r&&(t=Ue(qt,e),W=Ze(r),c(qt,{width:t.x+W.w/4+_e,height:t.y+W.h/4+_e}))}function mn(){on=0}function yn(e,t,n){return{header:e,body:t,footer:n}}function vn(e){H=kt.drop.target,A=Ft,M=e&&e.target||0,(!M||M!==H&&Ve(M,H)!==H)&&(kt.drop.target=0,vt(Ft),Ne(oe,s,vn),Ne(be,u,vn),kt.exit(e.target===At))}var H,A,M,K,F,N,I,Y,D,P,U,t,X,V,W,J,G,ee,te,ne,n="⌘",r="…",o="⇥",f="⇧",u=window,s=document,a=new TE(e),l=a._,c=l.css,p=l.edge,d=l.x,h=l.extend,g=l.pattern,m=(l.timer.reset,l.timer.set),y=l.trim,v={},w=function(){},k=TE.is,x=k.e,$=k.f,E=k.i,T=k.o,_=k.r,z=function(e){return!k.x(e)},C=k.s,L=s.documentElement,O=(s.head,s.body),j=h({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},labels:{},others:{}},classes:{"":"text-editor",i:"icon icon-%1 icon-%1--%2 fa fa-%2"}},t),ie="blur",oe="click",le="keydown",ce="keyup",pe="touchstart mousedown",de="touchmove mousemove",he="touchend mouseup",be="orientationchange resize",me=j.auto_close,ye=j.auto_tab,ve=j.languages,we=j.tab,xe=(j.unit[0][1],j.unit[0][0]),$e=j.unit[1][1],Ee=j.unit[1][0],Te="javascript:;",_e="px",kt=a.ui={};a.tidy=function(e,t){var n=a.$(),r=y(n.before)?e:"",i=y(n.after)?z(t)?t:e:"";return a.trim(r,i)},a.i=function(){return y(a.replace(/\s+/g," "))},a.format=function(e,t,n,r){T(e)||(e=[e]),z(n)||(n=" "),z(r)||(r="");var i=a.h,o=a[0]().$(),f=(e[0]?xe[0]+e[0]+xe[1]:"")+r,u=r+(e[0]?xe[0]+xe[2]+(e[1]||e[0].split(g("("+$e[3]+")+"))[0])+xe[1]:""),s=d(f),l=d(u),c=g("^"+s+"([\\s\\S]*?)"+l+"$"),p=g(s+"$"),h=g("^"+l),b=o.before,m=o.after;return o.length?n=!1:a.insert(ve.placeholders[""]),a.toggle(t?!c.test(o.value):!p.test(b)&&!h.test(m),[function(e){e.unwrap(f,u,1).tidy(g(Ee[0]+"[^"+Ee[0]+Ee[1]+Ee[2]+"]+?"+Ee[1]+"$").test(b)?"":n,g("^"+Ee[0]+Ee[2]+"[^"+Ee[0]+Ee[1]+"]+?"+Ee[1]).test(m)?"":n).wrap(f,u,t)},function(e){e.unwrap(f,u,t)}])[i]()};var Pt,xt=j.classes,$t=xt.i,Et=xt[""],Tt=ve.tools,_t=ve.buttons,zt=ve.labels,Ct=Et+"-textarea "+Et+"-content block",Lt=wt(Et),St=wt(Et+"-header"),Ot=wt(Et+"-body"),jt=wt(Et+"-footer"),Ht=wt(Et+"-tool"),At=et(e,!1,j.attributes),Mt=wt(Et+"-resize s"),Bt=wt(Et+"-description"),Rt=wt(Et+"-panel"),Kt=wt(Et+"-overlay"),qt=et("div"),Ft=et("div"),Nt=et("div"),It=wt("left","span"),Yt=wt("right","span"),Dt=0;z(j.suffix)||(j.suffix=xe[1]);var en={},on=0,te=0,ne=0,ee=0,F=0,fn=0,un=0,sn={};a.create=function(e,t){T(e)&&(j=h(j,e));var n=pt(At);return We(Lt,Et+"-is-can-update"),We(Lt,Et+"-is-can-copy"),We(At,Ct),n&&lt(n,"p")?(dt(n,Lt),Dt=n,yt(n,!1)):dt(At,Lt),Lt.dir=j.dir,mt(Lt,St),mt(Lt,Ot),mt(Lt,jt),mt(Ot,At),j.tools&&(mt(St,Ht),mt(jt,Bt),mt(Bt,It),mt(Bt,Yt)),Fe(le,At,nn),Fe(ce+" "+ie,At,rn),j.resize&&(mt(Lt,Mt),We(Lt,Et+"-is-can-resize"),Fe(pe,Mt,an),Fe(de,s,ln),Fe(he,O,cn)),Qt(),Gt(),0!==t?je("create",[a]):a},a.update=function(e,t){return Je(At,ze(Ct),0)&&a.destroy(0),(0!==t?je("update",[a]):a).create(e,0)},a.destroy=function(e){return Je(At,ze(Ct),0)?(kt.exit(0,0,0),Qe(At,Ct),j.tools=Ce(j.tools),j.keys&&(Ne(le,At,nn),Ne(ce,At,rn)),j.resize&&(Ne(pe,Mt,an),Ne(de,s,ln),Ne(he,s,cn)),Dt?(dt(Lt,Dt),mt(Dt,At),Dt=0):dt(Lt,At),vt(Lt),0!==e?je("destroy",[a]):a):a},a.enable=function(e){return At.disabled=At.readOnly=!1,We(Lt,Et+"-is-can-update"),We(Lt,Et+"-is-can-copy"),0!==e?je("enable",[a]):a},a.disable=function(e){return At.disabled=!0,Qe(Lt,Et+"-is-can-update"),Qe(Lt,Et+"-is-can-copy"),0!==e?je("disable",[a]):a},a.freeze=function(e){return At.disabled=!1,At.readOnly=!0,Qe(Lt,Et+"-is-can-update"),We(Lt,Et+"-is-can-copy"),0!==e?je("freeze",[a]):a},kt.exit=function(e,t,n){if(K={panel:function(){vt(Rt)},overlay:function(){Ne(oe,Kt,pn),vt(Kt)},modal:function(){Ne(pe,Ot,gn),Ne(de,Ot,bn),Ne(he,s,mn),Ne(oe,sn.x,hn),vt(qt)},drop:function(){vt(Ft)},bubble:function(){vt(Nt)}},rn(),t)if(T(t))for(N in t)N=t[N],K[N]&&K[N](),0!==n&&je("exit."+N,[a]);else K[t]&&K[t](),0!==n&&je("exit."+N,[a]);else for(N in K)K[N]();return e&&a.select(),0!==n&&je("exit",[a]),a},kt.panel=function(e,t){function n(){Ne(oe,te,n),kt.panel.exit(1)}return kt.exit(0,0,0),te=wt(Et+"-x"),te.title=_t.close,Fe(oe,te,n),it(Rt),mt(Ot,et(Rt,[wt(Et+"-panel-content","div",e),te])),$(t)?t(Rt):et(Rt,t),je("enter.panel",[a]),je("enter",[a]),a},kt.panel.fit=function(){},kt.overlay=function(e,t){return kt.exit(0,0,0),mt(Ot,Kt),e&&Fe(oe,Kt,pn),$(t)?t(Kt):et(Kt,t),je("enter.overlay",[a]),je("enter",[a]),a},kt.overlay.fit=function(){},kt.modal=function(){kt.overlay(1).blur();var f,u,e=arguments,t=e[0],n=e[1],r=e[2],i=Et+"-modal",o=n.footer;if(T(t)&&(t="default",n=e[0],r=e[1]),D=Pe(t),et(qt,!1,{"class":i+" "+D}),z(n.body)&&(n.body=et("div",n.body,{"class":i+"-content "+D})),z(o)&&T(o)&&!x(o)){u=[];for(N in o)I=o[N],x(I)?u.push(I):(I=Vt(I,N,o),t=N.text||_t[N]||N,f=et("button",t,h({name:"y["+N+"]",type:"button","class":Et+"-button",data:{"button-id":N}},I.attributes)),Fe(oe,f,function(e){return t=o[Re(this,"button-id")].click(e,a),t===!1?qe(e):void 0}),u.push(f));n.footer=u}for(N in n)i[1]=N,sn[N]=wt(i+"-"+De(N,i)+" "+D,0,n[N]);return sn.x=wt(Et+"-x "+D),sn.resize=wt(Et+"-resize se "+D),it(qt),sn.x.title=_t.close,mt(Ot,et(qt,sn,{style:""})),kt.modal.fit(),ht(qt,Kt),Fe(oe,sn.x,hn),Fe(pe,sn.header,qe),Fe(pe,sn.resize,qe),Fe(pe,Ot,gn),Fe(de,Ot,bn),Fe(he,s,mn),$(r)&&(sn.overlay=Kt,sn.modal=qt,r(sn)),je("enter.modal."+t,[a]),je("enter.modal",[a]),je("enter",[a]),a},kt.modal.fit=function(e){return dn(),D=fn/2-ee/2,J=un/2-F/2,T(e)?(z(e[0])&&(D=e[0]),z(e[1])&&(J=e[1])):(D=p(D,0),J=p(J,0)),c(qt,{left:D+_e,top:J+_e,"min-width":ee+_e,"min-height":F+_e,visibility:"visible"}),je("fit.modal",[a]),je("fit",[a]),a};var wn={"class":Et+"-button",name:"y"};return kt.alert=function(e,t,n,r){var i=et("button",_t.okay,wn),o="alert";return n=n||w,T(e)&&(o+=":"+e[0],e=e[1]||e[0]),Fe(oe,i,function(e){return n(e,a),hn(e,o+".y"),qe(e)}),Fe(le,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Ie(oe,i,[e]),qe(e)}),kt.modal(o,yn(e,t,i),r),i.focus(),a},kt.confirm=function(e,t,n,r,i){function l(e){return $(n)&&n(e,a),hn(e,u+".y"),qe(e)}function c(e){return $(r)&&r(e,a),hn(e,u+".n"),qe(e)}var s,o=et("button",_t.okay,wn),f=et("button",_t.cancel,wn),u="confirm";return f.name="n",T(e)&&(u+=":"+e[0],e=e[1]||e[0]),Fe(oe,o,l),Fe(oe,f,c),Fe(le,o,function(e){return s=e.TE.key,s("arrowright")?f.focus():s("enter")?l(e):s("escape")&&hn(e,u+".y"),qe(e)}),Fe(le,f,function(e){return s=e.TE.key,s("arrowleft")?o.focus():s("enter")?c(e):s("escape")&&hn(e,u+".n"),qe(e)}),kt.modal(u,yn(e,t,[o,f]),i),f.focus(),a},kt.prompt=function(e,t,n,r,i,o){function g(){s.focus(),"placeholder"in s&&s.select()}function b(e){p=s.value,$(n)&&!n(p)?g():!n||y(p)&&p!==t?(hn(e,l+".y"),r(e,a,p!==t?p:"",t)):g()}function m(e){hn(e,l+".n")}var p,d,h,f=et("button",_t.okay,wn),u=et("button",_t.cancel,wn),s=et("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Et+"-input block"}),l="prompt",c=[];if(T(e)&&(l+=":"+e[0],e=e[1]||e[0]),$(i)&&(o=i,i=0),1===i)s=et("textarea",t,{placeholder:t.split("\n")[0],"class":Et+"-textarea block",spellcheck:"false"});else if(2===i){for(N in t)c.push(et("option",t[N],{value:N,selected:N===n||null}));s=et("select",c,{"class":Et+"-select block"})}return r=r||w,s.name="data",u.name="n",Fe(le,s,function(e){return d=e.TE.key,h=e.TE.control,d("enter")&&1!==i||h("enter")?(b(e),qe(e)):d("escape")||d("backspace")&&!this.value?(m(e),qe(e)):d("arrowdown")&&1!==i&&2!==i||h("arrowdown")?(f.focus(),qe(e)):void 0}),Fe(le,f,function(e){return d=e.TE.key,d("enter")?b(e):d("escape")?m(e):d("arrowup")?s.focus():d("arrowright")&&u.focus(),qe(e)}),Fe(le,u,function(e){return d=e.TE.key,d(/^(enter|escape)$/)?m(e):d("arrowup")?s.focus():d("arrowleft")&&f.focus(),qe(e)}),Fe(oe,f,b),Fe(oe,u,m),kt.modal(l,yn(e,s,[f,u]),o),g(),a},kt.drop=function(){kt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Le(e)&&(t="default",n=e[0]),D=Pe(t),it(Ft),mt(O,et(Ft,!1,{"class":Et+"-drop "+D})),$(n)?n(Ft):et(Ft,n),kt.drop.fit(),Fe(oe,s,vn),Fe(be,u,vn),je("enter.drop."+t,[a]),je("enter.drop",[a]),a},kt.drop.fit=function(e){return H=Ze(L),A=Ze(Ft),M=kt.drop.target,D=H.w/2-A.w/2,J=H.h/2-A.h/2,!z(e)&&M&&(t=Xe(M),D=t.l,J=t.t+Ze(M).h),T(e)?(z(e[0])&&(D=e[0]),z(e[1])&&(J=e[1])):(D=p(D,0,H.w-A.w),J=p(J,0,Math.max(H.h,Ze(u).h)-A.h)),c(Ft,{left:D+_e,top:J+_e,visibility:"visible"}),je("fit.drop",[a]),je("fit",[a]),a},kt.menu=function(e,t,n,r){t=!T(t)&&n[t]&&n[t].text||t;var s,i='<span class="'+Et+'-current menu">%1</span>',o="",f=kt.tools,u=0;if(t===!1)return kt.tool(e,t);T(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+De($t,[Pe(e).replace(/[\/\s]/g,"-"),o])+'"></i>',t=z(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,i=o+(0!==t?" "+i:""));for(r in n)ee="%"===r[0],s=n[r],s=C(s)&&!ee?f[s]:s,s&&(s=Vt(s,r,f),n[r]=s);return kt.tool(e,{i:o,text:t?De(i,[t,o]):0,click:function(l){var c=kt.drop.target=f[e].target;return kt.drop("menu menu-"+Pe(e),function(l){function p(e){return J=this,P=n[Re(J,"tool-id")],P=C(P)?f[P]:P||{},U=rt(J),!Xt(P)&&$(r=P.click)&&(r=r(e,a),t!==!1&&c&&(M=ft(c)[0]||c,lt(M,"i")||nt(M,De(i,[U,o])),T(P.text)&&(M=ft(M)[0])&&lt(M,"i")&&(Qe(M),We(M,De($t,[P.text[0]])))),r===!1)?(a.select(),qe(e)):(a.select(),qe(e))}function d(e){if(J=this,(Y=e.TE.key)("escape"))kt.exit(1);else if(Y("enter"))Ie(oe,J,[e]);else if(Y("f10")&&c)c.focus();else if(Y("arrowdown")&&(D=ut(J))){for(;!lt(D,"a")&&D;)D=ut(D);D&&D.focus()}else if(Y("arrowup")&&(D=st(J))){for(;!lt(D,"a")&&D;)D=st(D);!D&&c?(kt.exit(),c.focus()):D&&D.focus()}else Y("arrowup")&&c&&(kt.exit(),c.focus());return qe(e)}for(r in n)if(s=n[r],ee="%"===r[0],s){var g={href:ee?null:Te,"class":Et+"-"+(ee?"label":"button")};ee?I=zt[e]&&zt[e][+r.slice(1)-1]||r:(g.data={},g.data["tool-id"]=r,I=Tt[r]||r),V=s.text,V=T(V)?V[1]||"":V,I=T(I)?I[0]:I,W=et(ee?"span":"a","<span>"+(ee?I||"%"+u:V||I)+"</span>",h(g,s.attributes||{})),We(W,"menu-"+Pe(r).replace(/[\/\s]/g,"-")),!g.title&&(J=s.title)&&(W.title=T(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),ee?He(W,{id:Et+"-label:"+u}):(Xt(s)?We(W,"x"):Qe(W,"x"),s.on?We(W,"on"):Qe(W,"on"),Fe(oe,W,p),Fe(le,W,d)),mt(l,W),++u}m(function(){ct("a",l)[0].focus()},1)}),!1}},r),Be(f[e].target,"ui-drop",e),f[e].data=n,a},kt.bubble=function(){kt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Le(e)&&(t="default",n=e[0]),D=Pe(t),it(Nt),mt(O,et(Nt,!1,{"class":Et+"-bubble "+D})),$(n)?n(Nt):et(Nt,n),kt.bubble.fit(),je("enter.bubble."+t,[a]),je("enter.bubble",[a]),a},kt.bubble.fit=function(e){W=a.$(1),t=Xe(At),F=c(At,"line-height");var n="border-",r="-width";D=W.caret[0].x+t.l-At.scrollLeft,J=W.caret[1].y+t.t+F-At.scrollTop,A=c(Ot,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Ze(Ot),o=Ze(Nt),f=A[0]+A[1],u=A[2]+A[3];return T(e)?(z(e[0])&&(D=e[0]),z(e[1])&&(J=e[1])):(D=p(D,t.l,t.l+i.w-o.w-u),J=p(J,t.t,t.t+i.h-o.h-f)),c(Nt,{left:D+_e,top:J+_e,visibility:"visible"}),je("fit.bubble",[a]),je("fit",[a]),a},kt.panel.exit=function(e){return kt.exit(e,"panel")},kt.overlay.exit=function(e){return kt.exit(e,"overlay")},kt.modal.exit=function(e){return kt.exit(e,"modal")},kt.drop.exit=function(e){return kt.exit(e,"drop")},kt.bubble.exit=function(e){return kt.exit(e,"bubble")},kt.tool=function(e,t,n){return I="","|"!==e&&(j.tools=ze(j.tools).filter(function(t,n){return t===e?(I=n,!1):!0})),t===!1?delete kt.tools[e]:("|"===e?(n=t,t={}):($(t)&&(t={click:t}),kt.tools[e]=h(kt.tools[e]||{},t),z(n)||""===I||(n=I)),E(n)?j.tools.splice(n,0,e):j.tools.push(e)),Qt(),a},kt.separator=function(e,t){return kt.tool("|",e!==!1?{attributes:e||{}}:!1,t)},kt.key=function(e,t){return j.keys?(t===!1?delete kt.keys[e]:kt.keys[e]=t,Gt(),a):a},kt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(we),!1},outdent:function(e,t){return t.outdent(we),!1}},kt.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return V=":not([tabindex]):not([disabled])",(W=ct("input"+V+",button"+V+",select"+V+",textarea"+V+",a[href]"+V+",[contenteditable]"+V+',[tabindex]:not([tabindex="-1"])',s,0))&&-1!==(J=W.indexOf(At))?((W[J+1]||s).focus(),!1):void 0},f10:function(e,t){return ct("a",Ht)[0].focus(),!1},"shift+tab":ye?"outdent":0,tab:ye?"indent":0},kt.el={container:Lt,header:St,body:Ot,footer:jt,panel:Rt,overlay:Kt,modal:qt,drop:Ft,bubble:Nt},a.config=j,h(TE._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),u=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>f&&(f="0"+f),10>u&&(u="0"+u),[""+t,""+n,""+r,""+i,""+o,""+f,""+u]},replace:Ye,format:De,dom:{set:mt,reset:yt,get:ct,id:tt,copy:function(e,t){return e.cloneNode(z(t)?t:!0)},classes:{set:We,reset:Qe,toggle:Ge,get:Je},attributes:{set:He,reset:Me,get:Ae},data:{set:Be,reset:Ke,get:Re},is:lt,offset:Xe,pointer:Ue,size:Ze,content:{set:nt,reset:it,get:rt},closest:Ve,parent:ot,children:ft,next:ut,previous:st,index:at,before:dt,after:ht,prepend:gt,append:bt},el:et,event:{set:Fe,reset:Ne,fire:Ie,x:qe}}),h(a._,TE._),h(a._,{hooks:v,hook:{set:Se,reset:Oe,fire:je}}),a.create()};