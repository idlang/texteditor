/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.5.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function He(e){return H(e)?g(e).split(/\s+/):e}function ze(e){return $(e)?e.join(" "):e}function Ce(e){return e.length}function Oe(e){return Object.keys(e)}function Me(e){return Ce(Oe(e))}function Se(e,t,n){return _(e)?_(t)?(_(m[e])||(m[e]={}),_(n)||(n=Me(m[e])),m[e][n]=t,a):m[e]:m}function Be(e,t){return _(e)?_(t)&&_(m[e])?(delete m[e][t],a):(m[e]={},a):(m={},a)}function je(e,t,n){if(!_(m[e]))return m[e]={},a;if(_(n))_(m[e][n])&&m[e][n].apply(a,t);else for(R in m[e])m[e][R].apply(a,t);return a}function Ne(e,t,n){if($(t))for(R in t)Ne(e,R,t[R]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Ye(e,n,i){if(H(n))return Ye(e,[n],_(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=e.getAttribute(R))&&t.push(R);return Ce(t)?t:_(i)?i:[]}function Xe(e,t){if($(t))for(R in t)Xe(e,t[R]);else if(_(t))e.removeAttribute(t);else for(Xe(e,"class"),R=0,V=e.attributes,F=Ce(V);F>R;++R)V[R]&&Xe(e,V[R].name)}function De(e,t,n){if($(t))for(R in t)De(e,R,t[R]);else Ne(e,"data-"+t,n)}function Ae(e,n,i){if(H(n))return Ae(e,[n],_(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=Ye(e,"data-"+R))&&t.push(R);return Ce(t)?t:_(i)?i:[]}function Pe(e,t){if($(t))for(R in t)Xe(e,"data-"+t[R]);else if(_(t))Xe(e,"data-"+t);else for(R=0,V=e.attributes,F=Ce(V);F>R;++R)V[R]&&"data-"===V[R].name.slice(0,5)&&Xe(e,V[R].name)}function Re(e){return e&&e.preventDefault(),!1}function Ve(e,t,n){if(t){for(e=He(e),R=0,V=Ce(e);V>R;++R)t.addEventListener(e[R],n,!1),Se("on:"+e[R],n,rt(t));return a}}function Fe(e,t,n){if(t){for(e=He(e),R=0,V=Ce(e);V>R;++R)t.removeEventListener(e[R],n,!1),Be("on:"+e[R],rt(t));return w(t)&&t.id.split(":")[0]===_t+"-dom"&&Xe(t,"id"),a}}function Ge(e,t,n){e=He(e);var r,i="createEvent"in u;for(R=0,V=Ce(e);V>R;++R)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[R],!0,!1),t.dispatchEvent(r)):je("on:"+e[R],n,rt(t));return a}function Ie(e,t,n){for(R=0,V=Ce(t),F;V>R;++R)F=t[R],e=e.replace(L(F)?F:h(p(F),"g"),n&&n[R]||"");return e}function We(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,_(t[n])?t[n]:e})}function qe(e){return g(Ie(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ke(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ue(e);return{x:n-r.l,y:i-r.t}}function Ue(e){for(G=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)G+=e.offsetLeft,J+=e.offsetTop;return{l:G,t:J}}function Ze(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function Je(e,t){for(;(e=ut(e))&&e!==t;);return e}function Qe(e,t){t=He(t);for(R in t)e.classList.add(t[R])}function et(e,n,i){if(H(n))return et(e,[n],_(i)?i:"")[0];t=[];for(R in n)R=n[R],e.classList.contains(R)&&t.push(R);return Ce(t)?t:_(i)?i:!1}function tt(e,t){if(_(t)){t=He(t);for(R in t)e.classList.remove(t[R])}else Xe(e,"class")}function nt(e,t){t=He(t);for(R in t)e.classList.toggle(t[R])}function it(e,t,n){if(e=H(e)?u.createElement(e):e,$(n))for(R in n)if(ee=n[R],"classes"===R)Qe(e,ee);else if("data"===R)for(V in ee)ee=ee[V],null===ee?Pe(e,V):De(e,V,ee);else"css"===R?H(ee)?Ne(e,"style",ee):null===ee?Xe(e,"style"):c(e,ee):E(ee)?e[R]=ee:null===ee?Xe(e,R):Ne(e,R,$(ee)?ee.join(" "):""+ee);if(w(t))xt(e,t);else if($(t))for(R in t)ee=t[R],w(ee)?xt(e,ee):ee!==!1&&ot(e,ee);else _(t)&&t!==!1&&ot(e,t);return e}function rt(e){var t=e.id;return t||(t=_t+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function ot(e,t){e.innerHTML=t}function ft(e,t){return e.innerHTML||(_(t)?t:"")}function st(e,t){if(t!==!1&&(N=at(e)))for(R=0,V=Ce(N);V>R;++R)st(N[R]);ot(e,"")}function ut(e){return e&&e.parentNode}function at(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function ct(e){return e&&e.previousSibling}function dt(e){for(R=0;e=ct(e);)++R;return R}function pt(e,t){return e&&H(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&E(t)?e===t(e):e===t}function bt(e,n){if(!(n=_(n)?n:u))return[];if(t=[],H(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(R=0,V=Ce(e);V>R;++R)t.push(e[R]);return t}return[]}for(e=n.querySelectorAll(e),R=0,V=Ce(e);V>R;++R)t.push(e[R]);return t}return ht(e)?[e]:[]}function ht(e,t){var n=ut(e);return 1===Ce(arguments)?n||!1:e&&n===e?n:!1}function yt(e,t){q=ut(e),q&&q.insertBefore(t,e)}function vt(e,t){q=ut(e),q&&q.insertBefore(t,lt(e))}function gt(e,t){N=at(e)[0],N?yt(N,t):xt(e,t)}function mt(e,t){xt(e,t)}function xt(e,t){e.appendChild(t)}function kt(e,t){var n=ht(e);if(n){if(t!==!1)for(N=at(e)[0];N;)kt(N);n.removeChild(e)}}function wt(e){st(it(e,!1,{style:""})),kt(e)}function Et(e,t,n){return it(t||"div",n,{"class":e})}function Ut(e){return!e||_(e.active)&&!e.active}function Zt(){return Yt.disabled||Yt.readOnly}function Jt(e,t,n){return E(e)&&(e={click:e}),H(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Ht[t]||"",_(e.attributes)||(e.attributes={}),n[t]=e,e}function Qt(e){if(Zt())return Yt.focus(),Re(e);Tt.exit(0,0,0);var t=Ae(this,"tool-id"),n=Tt.tools,i=n[t];return Tt.drop.target=e.currentTarget||e.target,!Ut(i)&&E(V=i.click)&&(V=V(e,a,t),je("on:change",[e,a,t]),V===!1)?Re(e):(a.select(),Re(e))}function en(e){if(J=this,(F=e.TE.key)(/^(escape|f10)$/))Tt.exit(1);else if(F("enter")||F("arrowdown")&&Ae(J,"ui-drop"))Tt.drop.target=J,Ge(fe,J,[e]);else if(F("arrowright")&&(G=lt(J))){for(;!pt(G,"a")&&G;)G=lt(G);G&&G.focus()}else if(F("arrowleft")&&(G=ct(J))){for(;!pt(G,"a")&&G;)G=ct(G);G&&G.focus()}return Re(e)}function tn(){st(Nt,!1);var r,o,f,s,u,l,c,e=Tt.tools,t=He(M.tools),n=_t+"-button",i=_t+"-separator";M.tools=t;for(l in t)c=t[l],o=e[c],(o||o==={})&&(o=Jt(o,c,e),f=o.i||c,"|"!==f&&"<"!==f[0]&&(f=qe(f)),s="|"!==f,u=qe(c).replace(/[\/\s]/g,"-"),qt=Et(s?n+" "+n+"-"+u:i+" "+i+"-"+l,s?"a":"span"),s?(qt=o.target||qt,r=n+":"+u,Ne(qt,{href:Le,id:r,tabindex:-1}),De(qt,"tool-id",c),f="<"===f[0]?f:'<i class="'+We(Lt,[u,f])+'"></i>',Ut(o)?Qe(qt,"x"):tt(qt,"x"),o.on?Qe(qt,"on"):tt(qt,"on"),o.text&&(f=We('<span class="'+_t+'-text">'+o.text+"</span>",[f]),Qe(qt,"text")),ot(qt,f),it(qt,!1,o.attributes),!o.attributes.title&&(V=o.title)&&(qt.title=$(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),Ve(fe,qt,Qt),Ve(ce,qt,en)):qt.id=i+":"+l,o.target=qt,xt(Nt,qt));je("update.tools",[a])}function nn(){Tt.keys=function(){var n,e=Oe(Tt.keys).sort().reverse(),t={};for(R=0,V=Ce(e);V>R;++R)n=e[R],t[n]=Tt.keys[n];return t}(),on(),je("update.keys",[a])}function rn(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}if(Zt())return Yt.focus(),Re(e);var n=a.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,u=Tt.keys,l=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();W=e.TE.key(),S[W]=1,t=Me(S),v(function(){a.record()});for(R in u){F=d(R),N=0;for(V in F)V=F[V],S[l[V]||V]&&++N;if(F=Ce(F),N===F&&t===F&&(H(u[R])&&(u[R]=Tt.tools[u[R]].click),G=u[R]&&u[R](e,a),G===!1))return Re(e)}if(ge)for(R in ge)if(I=ge[R],I!==!1){if(W===I&&f===I)return"\\"===o?(a.insert(W,0),Re(e)):(a.select(n.end+1),Re(e));if(R===W)return a.wrap(R,I),Re(e);if(o===R&&f===I){if("backspace"===W&&i.slice(-2)!=="\\"+R)return a.unwrap(R,I),Re(e);if(me&&"enter"===W&&R!==I)return a.tidy("\n"+c+ke,"\n"+c).scroll(1),Re(e)}}if(me&&!s){if("backspace"===W&&h(p(ke)+"$").test(i))return a.outdent(ke),Re(e);if("enter"===W&&h("(^|\\n)("+p(ke)+")+.*$").test(i))return a.insert("\n"+c,0,1).scroll(1),Re(e)}}function on(e){e&&e.TE&&e.TE.key?delete S[e.TE.key()]:S={}}function ln(e){return fn=Xt,Z=Ze(jt),Re(e)}function cn(e){fn===Xt&&c(Yt,{height:Ke(Bt,e).y-Z.h+_e})}function dn(){fn=0}function pn(){Tt.exit(1)}function bn(){t=Ze(Rt),te=t.w,P=t.h,t=Ze(Pt),sn=t.w,un=t.h}function hn(e,t){t&&je("exit.modal."+t,[a]),Ge(fe,Pt,[e])}function yn(e){fn=e.target,t=Ke(Rt,e),ne=t.x,ie=t.y,bn()}function vn(e){var n=an.header,i=an.resize;fn===n||Je(fn,n)===n?(t=Ke(Bt,e),G=t.x-ne,J=t.y-ie,c(Rt,{left:(te>sn?G:d(G,0,sn-te))+_e,top:(P>un?J:d(J,0,un-P))+_e})):fn===i&&(t=Ke(Rt,e),Z=Ze(i),c(Rt,{width:t.x+Z.w/4+_e,height:t.y+Z.h/4+_e}))}function gn(){fn=0}function mn(e,t,n){return{header:e,body:t,footer:n}}function xn(e){B=Tt.drop.target,j=Vt,N=e&&e.target||0,(!N||N!==B&&Je(N,B)!==B)&&(Tt.drop.target=0,wt(Vt),Fe(fe,u,xn),Fe(ve,s,xn),Tt.exit(e.target===Yt))}var B,j,N,D,P,R,V,F,G,I,W,t,q,U,Z,J,ee,te,ne,ie,n="⌘",i="…",o="⇥",f="⇧",s=window,u=document,a=new TE(e),l=a._,c=l.css,d=l.edge,p=l.x,b=l.extend,h=l.pattern,v=(l.timer.reset,l.timer.set),g=l.trim,m={},x=function(){},k=TE.is,w=k.e,E=k.f,T=k.i,$=k.o,L=k.r,_=function(e){return!k.x(e)},H=k.s,z=u.documentElement,O=(u.head,u.body),M=b({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"icon icon-%1 icon-%1--%2 fa fa-%2"}},t),S={},oe="blur",fe="click",ce="keydown",de="keyup",pe="touchstart mousedown",be="touchmove mousemove",he="touchend mouseup",ve="orientationchange resize",ge=M.auto_close,me=M.auto_tab,xe=M.languages,ke=M.tab,Ee=(M.unit[0][1],M.unit[0][0]),Te=M.unit[1][1],$e=M.unit[1][0],Le="javascript:;",_e="px",Tt=a.ui={};a.tidy=function(e,t){var n=a.$(),i=g(n.before)?e:"",r=g(n.after)?_(t)?t:e:"";return a.trim(i,r)},a.i=function(){return g(a.replace(/\s+/g," "))},a.format=function(e,t,n,i){$(e)||(e=[e]),_(n)||(n=" "),_(i)||(i="");var r=a.h,o=a[0]().$(),f=(e[0]?Ee[0]+e[0]+Ee[1]:"")+i,s=i+(e[0]?Ee[0]+Ee[2]+(e[1]||e[0].split(h("("+Te[3]+")+"))[0])+Ee[1]:""),u=p(f),l=p(s),c=h("^"+u+"([\\s\\S]*?)"+l+"$"),d=h(u+"$"),b=h("^"+l),y=o.before,v=o.after;return o.length?n=!1:a.insert(xe.placeholders[""]),a.toggle(t?!c.test(o.value):!d.test(y)&&!b.test(v),[function(e){e.unwrap(f,s,1).tidy(h($e[0]+"[^"+$e[0]+$e[1]+$e[2]+"]+?"+$e[1]+"$").test(y)?"":n,h("^"+$e[0]+$e[2]+"[^"+$e[0]+$e[1]+"]+?"+$e[1]).test(v)?"":n).wrap(f,s,t)},function(e){e.unwrap(f,s,t)}])[r]()};var qt,$t=M.classes,Lt=$t.i,_t=$t[""],Ht=xe.tools,zt=xe.buttons,Ct=xe.labels,Ot=_t+"-textarea "+_t+"-content block",Mt=Et(_t),St=Et(_t+"-header"),Bt=Et(_t+"-body"),jt=Et(_t+"-footer"),Nt=Et(_t+"-tool"),Yt=it(e,!1,M.attributes),Xt=Et(_t+"-resize s"),Dt=Et(_t+"-description"),At=Et(_t+"-panel"),Pt=Et(_t+"-overlay"),Rt=it("div"),Vt=it("div"),Ft=it("div"),Gt=Et("left","span"),It=Et("right","span"),Wt=0;_(M.suffix)||(M.suffix=Ee[1]);var fn=0,ne=0,ie=0,te=0,P=0,sn=0,un=0,an={};a.create=function(e,t){$(e)&&(M=b(M,e));var n=ht(Yt);return Qe(Mt,_t+"-is-can-update"),Qe(Mt,_t+"-is-can-copy"),Qe(Yt,Ot),n&&pt(n,"p")?(yt(n,Mt),Wt=n,kt(n,!1)):yt(Yt,Mt),Mt.dir=M.dir,xt(Mt,St),xt(Mt,Bt),xt(Mt,jt),xt(Bt,Yt),M.tools&&(xt(St,Nt),xt(jt,Dt),xt(Dt,Gt),xt(Dt,It)),Ve(ce,Yt,rn),Ve(de+" "+oe,Yt,on),M.resize&&(xt(Mt,Xt),Qe(Mt,_t+"-is-can-resize"),Ve(pe,Xt,ln),Ve(be,u,cn),Ve(he,O,dn)),tn(),nn(),0!==t?je("create",[a]):a},a.update=function(e,t){return et(Yt,He(Ot),0)&&a.destroy(0),(0!==t?je("update",[a]):a).create(e,0)},a.destroy=function(e){return et(Yt,He(Ot),0)?(Tt.exit(0,0,0),tt(Yt,Ot),M.tools=ze(M.tools),M.keys&&(Fe(ce,Yt,rn),Fe(de,Yt,on)),M.resize&&(Fe(pe,Xt,ln),Fe(be,u,cn),Fe(he,u,dn)),Wt?(yt(Mt,Wt),xt(Wt,Yt),Wt=0):yt(Mt,Yt),wt(Mt),0!==e?je("destroy",[a]):a):a},a.enable=function(e){return Yt.disabled=Yt.readOnly=!1,Qe(Mt,_t+"-is-can-update"),Qe(Mt,_t+"-is-can-copy"),0!==e?je("enable",[a]):a},a.disable=function(e){return Yt.disabled=!0,tt(Mt,_t+"-is-can-update"),tt(Mt,_t+"-is-can-copy"),0!==e?je("disable",[a]):a},a.freeze=function(e){return Yt.disabled=!1,Yt.readOnly=!0,tt(Mt,_t+"-is-can-update"),Qe(Mt,_t+"-is-can-copy"),0!==e?je("freeze",[a]):a},Tt.exit=function(e,t,n){if(D={panel:function(){wt(At)},overlay:function(){Fe(fe,Pt,pn),wt(Pt)},modal:function(){Fe(pe,Bt,yn),Fe(be,Bt,vn),Fe(he,u,gn),Fe(fe,an.x,hn),wt(Rt)},drop:function(){wt(Vt)},bubble:function(){wt(Ft)}},on(),t)if($(t))for(R in t)R=t[R],D[R]&&D[R](),0!==n&&je("exit."+R,[a]);else D[t]&&D[t](),0!==n&&je("exit."+R,[a]);else for(R in D)D[R]();return e&&a.select(),0!==n&&je("exit",[a]),a},Tt.panel=function(e,t){function n(){Fe(fe,ne,n),Tt.panel.exit(1)}return Tt.exit(0,0,0),ne=Et(_t+"-x"),ne.title=zt.close,Ve(fe,ne,n),st(At),xt(Bt,it(At,[Et(_t+"-panel-content","div",e),ne])),E(t)?t(At):it(At,t),je("enter.panel",[a]),je("enter",[a]),a},Tt.panel.fit=function(){},Tt.overlay=function(e,t){return Tt.exit(0,0,0),xt(Bt,Pt),e&&Ve(fe,Pt,pn),E(t)?t(Pt):it(Pt,t),je("enter.overlay",[a]),je("enter",[a]),a},Tt.overlay.fit=function(){},Tt.modal=function(){Tt.overlay(1).blur();var f,s,e=arguments,t=e[0],n=e[1],i=e[2],r=_t+"-modal",o=n.footer;if($(t)&&(t="default",n=e[0],i=e[1]),G=qe(t),it(Rt,!1,{"class":r+" "+G}),_(n.body)&&(n.body=it("div",n.body,{"class":r+"-content "+G})),_(o)&&$(o)&&!w(o)){s=[];for(R in o)V=o[R],w(V)?s.push(V):(V=Jt(V,R,o),t=R.text||zt[R]||R,f=it("button",t,b({name:"y["+R+"]",type:"button","class":_t+"-button",data:{"button-id":R}},V.attributes)),Ve(fe,f,function(e){return t=o[Ae(this,"button-id")].click(e,a),t===!1?Re(e):void 0}),s.push(f));n.footer=s}for(R in n)r[1]=R,an[R]=Et(r+"-"+We(R,r)+" "+G,0,n[R]);return an.x=Et(_t+"-x "+G),an.resize=Et(_t+"-resize se "+G),st(Rt),an.x.title=zt.close,xt(Bt,it(Rt,an,{style:""})),Tt.modal.fit(),vt(Rt,Pt),Ve(fe,an.x,hn),Ve(pe,an.header,Re),Ve(pe,an.resize,Re),Ve(pe,Bt,yn),Ve(be,Bt,vn),Ve(he,u,gn),E(i)&&(an.overlay=Pt,an.modal=Rt,i(an)),je("enter.modal."+t,[a]),je("enter.modal",[a]),je("enter",[a]),a},Tt.modal.fit=function(e){return bn(),G=sn/2-te/2,J=un/2-P/2,$(e)?(_(e[0])&&(G=e[0]),_(e[1])&&(J=e[1])):(G=d(G,0),J=d(J,0)),c(Rt,{left:G+_e,top:J+_e,"min-width":te+_e,"min-height":P+_e,visibility:"visible"}),je("fit.modal",[a]),je("fit",[a]),a};var kn={"class":_t+"-button",name:"y"};return Tt.alert=function(e,t,n,i){var r=it("button",zt.okay,kn),o="alert";return n=n||x,$(e)&&(o+=":"+e[0],e=e[1]||e[0]),Ve(fe,r,function(e){return n(e,a),hn(e,o+".y"),Re(e)}),Ve(ce,r,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Ge(fe,r,[e]),Re(e)}),Tt.modal(o,mn(e,t,r),i),r.focus(),a},Tt.confirm=function(e,t,n,i,r){function l(e){return E(n)&&n(e,a),hn(e,s+".y"),Re(e)}function c(e){return E(i)&&i(e,a),hn(e,s+".n"),Re(e)}var u,o=it("button",zt.okay,kn),f=it("button",zt.cancel,kn),s="confirm";return f.name="n",$(e)&&(s+=":"+e[0],e=e[1]||e[0]),Ve(fe,o,l),Ve(fe,f,c),Ve(ce,o,function(e){return u=e.TE.key,u("arrowright")?f.focus():u("enter")?l(e):u("escape")&&hn(e,s+".y"),Re(e)}),Ve(ce,f,function(e){return u=e.TE.key,u("arrowleft")?o.focus():u("enter")?c(e):u("escape")&&hn(e,s+".n"),Re(e)}),Tt.modal(s,mn(e,t,[o,f]),r),f.focus(),a},Tt.prompt=function(e,t,n,i,r,o){function h(){u.focus(),"placeholder"in u&&u.select()}function y(e){d=u.value,E(n)&&!n(d)?h():!n||g(d)&&d!==t?(hn(e,l+".y"),i(e,a,d!==t?d:"",t)):h()}function v(e){hn(e,l+".n")}var d,p,b,f=it("button",zt.okay,kn),s=it("button",zt.cancel,kn),u=it("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":_t+"-input block"}),l="prompt",c=[];if($(e)&&(l+=":"+e[0],e=e[1]||e[0]),E(r)&&(o=r,r=0),1===r)u=it("textarea",t,{placeholder:t.split("\n")[0],"class":_t+"-textarea block",spellcheck:"false"});else if(2===r){for(R in t)c.push(it("option",t[R],{value:R,selected:R===n||null}));u=it("select",c,{"class":_t+"-select block"})}return i=i||x,u.name="data",s.name="n",Ve(ce,u,function(e){return p=e.TE.key,b=e.TE.control,p("enter")&&1!==r||b("enter")?(y(e),Re(e)):p("escape")||p("backspace")&&!this.value?(v(e),Re(e)):p("arrowdown")&&1!==r&&2!==r||b("arrowdown")?(f.focus(),Re(e)):void 0}),Ve(ce,f,function(e){return p=e.TE.key,p("enter")?y(e):p("escape")?v(e):p("arrowup")?u.focus():p("arrowright")&&s.focus(),Re(e)}),Ve(ce,s,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?v(e):p("arrowup")?u.focus():p("arrowleft")&&f.focus(),Re(e)}),Ve(fe,f,y),Ve(fe,s,v),Tt.modal(l,mn(e,u,[f,s]),o),h(),a},Tt.drop=function(){Tt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Ce(e)&&(t="default",n=e[0]),G=qe(t),st(Vt),xt(O,it(Vt,!1,{"class":_t+"-drop "+G})),E(n)?n(Vt):it(Vt,n),Tt.drop.fit(),Ve(fe,u,xn),Ve(ve,s,xn),je("enter.drop."+t,[a]),je("enter.drop",[a]),a},Tt.drop.fit=function(e){return B=Ze(z),j=Ze(Vt),N=Tt.drop.target,G=B.w/2-j.w/2,J=B.h/2-j.h/2,!_(e)&&N&&(t=Ue(N),G=t.l,J=t.t+Ze(N).h),$(e)?(_(e[0])&&(G=e[0]),_(e[1])&&(J=e[1])):(G=d(G,0,B.w-j.w),J=d(J,0,Math.max(B.h,Ze(s).h)-j.h)),c(Vt,{left:G+_e,top:J+_e,visibility:"visible"}),je("fit.drop",[a]),je("fit",[a]),a},Tt.menu=function(e,n,i,r){var c,o='<span class="'+_t+'-current menu">%1</span>',f="",s=n,u=Tt.tools,l=0;if(n=!$(n)&&i[n]&&i[n].text||n,n===!1)return Tt.tool(e,n);$(n)&&(f=n[0],f="<"===f[0]?f:'<i class="'+We(Lt,[qe(e).replace(/[\/\s]/g,"-"),f])+'"></i>',n=s=_(n[1])?n[1]:0,n=n&&i[n]&&i[n].text||n,o=f+(0!==n?" "+o:""));for(r in i)te="%"===r[0],c=i[r],c=H(c)&&!te?u[c]:c,c&&(c=Jt(c,r,u),i[r]=c);return Tt.tool(e,{i:f,text:n?We(o,[n,f]):0,click:function(s){var d=Tt.drop.target=u[e].target;return Tt.drop("menu menu-"+qe(e),function(s){function p(e){return J=this,t=Ae(J,"tool-id"),I=i[t],I=H(I)?u[I]:I||{},W=ft(J),!Ut(I)&&E(r=I.click)&&(r=r(e,a),n!==!1&&d&&(N=at(d)[0]||d,pt(N,"i")||ot(N,We(o,[W,f])),$(I.text)&&(N=at(N)[0])&&pt(N,"i")&&(tt(N),Qe(N,We(Lt,[I.text[0]])))),De(d,"ui-drop-menu",t),r===!1)?(a.select(),Re(e)):(a.select(),Re(e))}function h(e){if(J=this,(F=e.TE.key)("escape"))Tt.exit(1);else if(F("enter"))Ge(fe,J,[e]);else if(F("f10")&&d)d.focus();else if(F("arrowdown")&&(G=lt(J))){for(;!pt(G,"a")&&G;)G=lt(G);G&&G.focus()}else if(F("arrowup")&&(G=ct(J))){for(;!pt(G,"a")&&G;)G=ct(G);!G&&d?(Tt.exit(),d.focus()):G&&G.focus()}else F("arrowup")&&d&&(Tt.exit(),d.focus());return Re(e)}for(r in i)if(c=i[r],te="%"===r[0],c){var y={href:te?null:Le,"class":_t+"-"+(te?"label":"button")};te?V=Ct[e]&&Ct[e][+r.slice(1)-1]||r:(y.data={},y.data["tool-id"]=r,V=Ht[r]||r),U=c.text,U=$(U)?U[1]||"":U,V=$(V)?V[0]:V,Z=it(te?"span":"a","<span>"+(te?V||"%"+l:U||V)+"</span>",b(y,c.attributes||{})),Qe(Z,"menu-"+qe(r).replace(/[\/\s]/g,"-")),!y.title&&(J=c.title)&&(Z.title=$(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),te?Ne(Z,{id:_t+"-label:"+l}):(Ut(c)?Qe(Z,"x"):tt(Z,"x"),c.on?Qe(Z,"on"):tt(Z,"on"),Ve(fe,Z,p),Ve(ce,Z,h)),xt(s,Z),++l}v(function(){(bt('[data-tool-id="'+Ae(d,"ui-drop-menu")+'"]',s)[0]||bt("a",s)[0]).focus()},1)}),!1}},r),De(u[e].target,{"ui-drop":e,"ui-drop-menu":s}),u[e].data=i,a},Tt.bubble=function(){Tt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Ce(e)&&(t="default",n=e[0]),G=qe(t),st(Ft),xt(O,it(Ft,!1,{"class":_t+"-bubble "+G})),E(n)?n(Ft):it(Ft,n),Tt.bubble.fit(),je("enter.bubble."+t,[a]),je("enter.bubble",[a]),a},Tt.bubble.fit=function(e){Z=a.$(1),t=Ue(Yt),P=c(Yt,"line-height");var n="border-",i="-width";G=Z.caret[0].x+t.l-Yt.scrollLeft,J=Z.caret[1].y+t.t+P-Yt.scrollTop,j=c(Bt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=Ze(Bt),o=Ze(Ft),f=j[0]+j[1],s=j[2]+j[3];return $(e)?(_(e[0])&&(G=e[0]),_(e[1])&&(J=e[1])):(G=d(G,t.l,t.l+r.w-o.w-s),J=d(J,t.t,t.t+r.h-o.h-f)),c(Ft,{left:G+_e,top:J+_e,visibility:"visible"}),je("fit.bubble",[a]),je("fit",[a]),a},Tt.panel.exit=function(e){return Tt.exit(e,"panel")},Tt.overlay.exit=function(e){return Tt.exit(e,"overlay")},Tt.modal.exit=function(e){return Tt.exit(e,"modal")},Tt.drop.exit=function(e){return Tt.exit(e,"drop")},Tt.bubble.exit=function(e){return Tt.exit(e,"bubble")},Tt.tool=function(e,t,n){return V="","|"!==e&&(M.tools=He(M.tools).filter(function(t,n){return t===e?(V=n,!1):!0})),t===!1?delete Tt.tools[e]:("|"===e?(n=t,t={}):(E(t)&&(t={click:t}),Tt.tools[e]=b(Tt.tools[e]||{},t),_(n)||""===V||(n=V)),T(n)?M.tools.splice(n,0,e):M.tools.push(e)),tn(),a},Tt.separator=function(e,t){return Tt.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Tt.key=function(e,t){return M.keys?(t===!1?delete Tt.keys[e]:Tt.keys[e]=t,nn(),a):a},Tt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ke),!1},outdent:function(e,t){return t.outdent(ke),!1}},Tt.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return U=":not([tabindex]):not([disabled])",(Z=bt("input"+U+",button"+U+",select"+U+",textarea"+U+",a[href]"+U+",[contenteditable]"+U+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(J=Z.indexOf(Yt))?((Z[J+1]||u).focus(),!1):void 0},f10:function(e,t){return bt("a",Nt)[0].focus(),!1},"shift+tab":me?"outdent":0,tab:me?"indent":0},Tt.el={container:Mt,header:St,body:Bt,footer:jt,panel:At,overlay:Pt,modal:Rt,drop:Vt,bubble:Ft},a.config=M,b(TE._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),s=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),[""+t,""+n,""+i,""+r,""+o,""+f,""+s]},replace:Ie,format:We,dom:{set:xt,reset:kt,get:bt,id:rt,copy:function(e,t){return e.cloneNode(_(t)?t:!0)},classes:{set:Qe,reset:tt,toggle:nt,get:et},attributes:{set:Ne,reset:Xe,get:Ye},data:{set:De,reset:Pe,get:Ae},is:pt,offset:Ue,pointer:Ke,size:Ze,content:{set:ot,reset:st,get:ft},closest:Je,parent:ut,children:at,next:lt,previous:ct,index:dt,before:yt,after:vt,prepend:gt,append:mt},el:it,event:{set:Ve,reset:Fe,fire:Ge,x:Re}}),b(a._,TE._),b(a._,{hooks:m,hook:{set:Se,reset:Be,fire:je}}),a.create()};