/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.10.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Fe(e){return e.toLowerCase()}function Ke(e){return F(e)?w(e).split(/\s+/):e}function Se(e){return _(e)?e.join(" "):e}function ze(e,t){return-1!==e.indexOf(t)}function Ae(e){return Object.keys(e)}function Oe(e){return e.length}function Le(e){return Oe(Ae(e))}function Re(e,t,n){return j(e)?j(t)?(j(b[e])||(b[e]={}),j(n)||(n=Le(b[e])),b[e][n]=t,a):b[e]:b}function He(e,t){return j(e)?j(t)&&j(b[e])?(delete b[e][t],a):(b[e]={},a):(b={},a)}function Me(e,t,n){if(!j(b[e]))return b[e]={},a;if(j(n))j(b[e][n])&&b[e][n].apply(a,t);else for(Z in b[e])b[e][Z].apply(a,t);return a}function Pe(e,t,n){if(_(t))for(Z in t)Pe(e,Z,t[Z]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Be(e,n,r){if(!n){for(t={},Z=0,X=e.attributes,V=Oe(X);V>Z;++Z)N=X[Z],t[N.name]=N.value;return Le(t)?t:j(r)?r:{}}if(F(n))return Be(e,[n],[j(r)?r:""])[0];t=[];for(Z in n)Z=n[Z],Z=e.getAttribute(Z)||"",t.push(Z);return Oe(t)?t:j(r)?r:[]}function Ye(e,t){if(_(t))for(Z in t)Ye(e,t[Z]);else if(j(t))e.removeAttribute(t);else for(Ye(e,"class"),Z=0,X=e.attributes,V=Oe(X);V>Z;++Z)X[Z]&&Ye(e,X[Z].name)}function Ue(e,t,n){if(_(t))for(Z in t)Ue(e,Z,t[Z]);else Pe(e,"data-"+t,n)}function Ze(e,n,r){if(!n){for(t={},Z=0,X=e.attributes,V=Oe(X);V>Z;++Z)N=X[Z],"data-"===N.name.slice(0,5)&&(t[N.name]=N.value);return Le(t)?t:j(r)?r:{}}if(F(n))return Ze(e,[n],[j(r)?r:""])[0];t=[];for(Z in n)Z=n[Z],Z=Be(e,"data-"+Z),t.push(Z);return Oe(t)?t:j(r)?r:[]}function Xe(e,t){if(_(t))for(Z in t)Ye(e,"data-"+t[Z]);else if(j(t))Ye(e,"data-"+t);else for(Z=0,X=e.attributes,V=Oe(X);V>Z;++Z)X[Z]&&"data-"===X[Z].name.slice(0,5)&&Ye(e,X[Z].name)}function Ve(e){return e&&e.preventDefault(),!1}function Ne(e,t,n){if(t){for(e=Ke(e),Z=0,X=Oe(e);X>Z;++Z)t.addEventListener(e[Z],n,!1),Re("on:"+e[Z],n,ft(t));return a}}function De(e,t,n){if(t){for(e=Ke(e),Z=0,X=Oe(e);X>Z;++Z)t.removeEventListener(e[Z],n,!1),He("on:"+e[Z],ft(t));return x(t)&&t.id.split(":")[0]===At+"-dom"&&Ye(t,"id"),a}}function Ie(e,t,n){e=Ke(e);var o,r="createEvent"in c;for(Z=0,X=Oe(e);X>Z;++Z)r?(o=c.createEvent("HTMLEvents"),o.data=n,o.initEvent(e[Z],!0,!1),t.dispatchEvent(o)):Me("on:"+e[Z],n,ft(t));return a}function qe(e,t,n){for(Z=0,X=Oe(t),V;X>Z;++Z)V=t[Z],e=e.replace(C(V)?V:g(d(V),"g"),n&&n[Z]||"");return e}function We(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,j(t[n])?t[n]:e})}function Je(e){return w(qe(Fe(e),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ge(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,o=Qe(e);return{x:n-o.l,y:r-o.t}}function Qe(e){for(N=e.offsetLeft,Q=e.offsetTop;e=e.offsetParent;)N+=e.offsetLeft,Q+=e.offsetTop;return{l:N,t:Q}}function et(e){return e===f?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function tt(e,t){for(;(e=pt(e))&&e!==t;);return e}function nt(e,t){t=Ke(t);for(Z in t)e.classList.add(t[Z])}function rt(e,n,r){if(!n)return t=Ke(e.className),Oe(t)?t:j(r)?r:[];if(F(n))return rt(e,[n],[j(r)?r:""])[0];t=[];for(Z in n)Z=n[Z],e.classList.contains(Z)&&t.push(Z);return Oe(t)?t:j(r)?r:[]}function ot(e,t){if(j(t)){t=Ke(t);for(Z in t)e.classList.remove(t[Z])}else Ye(e,"class")}function it(e,t){t=Ke(t);for(Z in t)e.classList.toggle(t[Z])}function ut(e,t,n){if(e=e||"div",e=F(e)?c.createElement(e):e,_(n)){t||(j(n.html)?(t=n.html,delete n.html):j(n.text)&&(t=n.text,delete n.text));for(Z in n)if(te=n[Z],"classes"===Z)nt(e,te);else if("data"===Z)for(X in te)te=te[X],null===te?Xe(e,X):Ue(e,X,te);else"css"===Z?F(te)?Pe(e,"style",te):null===te?Ye(e,"style"):l(e,te):E(te)?e[Z]=te:null===te?Ye(e,Z):Pe(e,Z,$(te)?te.join(" "):""+te)}if(x(t))Tt(e,t);else if(_(t))for(Z in t)te=t[Z],x(te)?Tt(e,te):te!==!1&&ct(e,te);else j(t)&&t!==!1&&ct(e,t);return e}function ft(e){var t=e.id;return t||(t=At+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function ct(e,t){e.innerHTML=t}function at(e,t){return e.innerHTML||(j(t)?t:"")}function st(e,t){if((!j(t)||t)&&(H=dt(e)))for(Z=0,X=Oe(H);X>Z;++Z)st(H[Z]);ct(e,"")}function lt(e){return Array.prototype.slice.call(e)}function pt(e){return e&&e.parentNode}function dt(e){return e&&lt(e.children||[])}function mt(e,t){return j(t)?F(t)?e.closest(t):tt(e,t):pt(e)}function gt(e){return e&&e.nextElementSibling}function ht(e){return e&&e.previousElementSibling}function yt(e){for(Z=0;e=ht(e);)++Z;return Z}function wt(e,t){return e&&F(t)?Fe(e.nodeName)===Fe(t):e&&E(t)?e===t(e):e===t}function bt(e,t){return(t=j(t)?t:c)?F(e)?/^[#.]?(?:\\.|[\w-]|[^\x00-\xa0])+$/.test(e)?"#"===e[0]&&(e=t.getElementById(e.slice(1)))?[e]:"."===e[0]&&(e=t.getElementsByClassName(e.slice(1)))||(e=t.getElementsByTagName(e))?lt(e):[]:lt(t.querySelectorAll(e)):vt(e)?[e]:[]:[]}function vt(e,t){var n=pt(e);return 1===Oe(arguments)?n||!1:e&&n===e?n:!1}function kt(e,t){q=pt(e),q&&q.insertBefore(t,e)}function xt(e,t){q=pt(e),q&&q.insertBefore(t,gt(e))}function $t(e,t){H=e.firstChild,H?kt(H,t):Tt(e,t)}function Et(e,t){Tt(e,t)}function Tt(e,t){e.appendChild(t)}function _t(e,t){var n=pt(e);if(n){if(!j(t)||t)for(H=e.firstChild;H;)_t(H);n.removeChild(e)}}function Ct(e,t){return e.cloneNode(j(t)?!!t:!0)}function jt(e,t){return pt(e).replaceChild(t,e),t}function Ft(e){st(ut(e,!1,{style:""})),_t(e)}function Kt(e,t,n){return ut(t,n,{"class":e})}function on(e){return!e||j(e.active)&&!e.active}function un(e,t,n){return E(e)&&(e={click:e}),F(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Ot[t]||"",j(e.attributes)||(e.attributes={}),n[t]&&(n[t]=e),e}function fn(e){St.exit(0,0,0);var t=Ze(this,"tool-id"),n=St.tools,r=n[t];return St.drop.target=e.currentTarget||e.target,!on(r)&&E(X=r.click)&&(X=X(e,a,t),Me("on:change",[e,a,t]),X===!1)?Ve(e):(a.select(),Ve(e))}function cn(e){if(Q=this,(V=e.TE.key)(["escape","f10"]))St.exit(1);else if(V("enter")||V("down")&&Ze(Q,"ui-drop"))St.drop.target=Q,Ie(fe,Q,[e]);else if(V("right")&&(N=gt(Q))){for(;!wt(N,"a")&&N;)N=gt(N);N&&N.focus()}else if(V("left")&&(N=ht(Q))){for(;!wt(N,"a")&&N;)N=ht(N);N&&N.focus()}return Ve(e)}function sn(){st(Xt,0);var o,i,u,f,c,s,l,e=St.tools,t=Ke(A.tools),n=At+"-button",r=At+"-separator";A.tools=t;for(s in t)l=t[s],i=e[l],(i||i==={})&&(i=un(i,l,e),u=i.i||l,"|"===u||ze(u,"<")||(u=Je(u)),f="|"!==u,c=Je(l).replace(/[\/\s]/g,"-"),nn=Kt(f?n+" "+n+"-"+c:r+" "+r+"-"+s,f?"a":"span"),f?(nn=i.target||nn,o=n+":"+c,Pe(nn,{href:Ce,id:o,tabindex:-1}),Ue(nn,"tool-id",l),u=ze(u,"<")?u:St.i(c,u),on(i)?nt(nn,"x"):ot(nn,"x"),i.on?nt(nn,"on"):ot(nn,"on"),i.text&&(u=We('<span class="'+At+'-text">'+i.text+"</span>",[u]),nt(nn,"text")),ct(nn,u),ut(nn,!1,i.attributes),!i.attributes.title&&(X=i.title)&&(nn.title=_(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),Ne(fe,nn,fn),Ne(pe,nn,cn)):nn.id=r+":"+s,i.target=nn,(c=Ze(nn,an))&&St.menu.set(l,c),Tt(Xt,nn));Me("update.tools",[a])}function ln(){St.keys=function(){var n,e=Ae(St.keys).sort().reverse(),t={};for(Z=0,X=Oe(e);X>Z;++Z)n=e[Z],t[n]=St.keys[n];return t}(),dn(),Me("update.keys",[a])}function pn(e){function m(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=a.$(),r=n.before,o=n.after,i=r.slice(-1),u=o[0],f=n.length,c=St.keys,s=TE.keys_a,l={control:0,shift:0,option:"alt",meta:0},p=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(Z in l)e.TE[Z]()&&(O[l[Z]||Z]=1);I=e.TE.key(),O[I]=1,t=Le(O),y(function(){a.record()});for(Z in c){V=m(Z),H=0;for(X in V)X=V[X],O[s[X]||X]&&++H;if(V=Oe(V),H===V&&t===V&&(F(c[Z])&&(c[Z]=St.tools[c[Z]].click),N=E(c[Z])&&c[Z](e,a),N===!1))return Ve(e)}if(be)for(Z in be)if(D=be[Z],D!==!1){if(I===D&&u===D)return"\\"===i?(a.insert(I,0),Ve(e)):(a.select(n.end+1),Ve(e));if(Z===I)return a.wrap(Z,D),Ve(e);if(i===Z&&u===D){if("backspace"===I&&r.slice(-2)!=="\\"+Z)return a.unwrap(Z,D),Ve(e);if(ve&&"enter"===I&&Z!==D&&!f)return a.tidy("\n"+p+xe,"\n"+p).scroll(1),Ve(e)}}if(ve&&!f){if("backspace"===I&&g(d(xe)+"$").test(r))return a.outdent(xe),Ve(e);if("enter"===I&&g("(^|\\n)("+d(xe)+")+.*$").test(r))return a.insert("\n"+p,0,1).scroll(1),Ve(e)}}function dn(e){e&&e.TE&&e.TE.key?delete O[e.TE.key()]:O={}}function wn(e){return mn=Mt,G=et(Zt),Ve(e)}function bn(e){mn===Mt&&l(Vt,{height:Ge(Ut,e).y-G.h+je})}function vn(){mn=0}function kn(){St.exit(1)}function xn(){t=et(qt),ne=t.w,U=t.h,t=et(It),gn=t.w,hn=t.h}function $n(e,t){return t&&Me("exit.modal."+t,[a]),Ie(fe,It,[e]),Ve(e)}function En(e){mn=e.target,t=Ge(qt,e),re=t.x,oe=t.y,xn()}function Tn(e){var n=yn.header,r=yn.sizer;mn===n||tt(mn,n)===n?(t=Ge(Ut,e),N=t.x-re,Q=t.y-oe,l(qt,{left:(ne>gn?N:p(N,0,gn-ne))+je,top:(U>hn?Q:p(Q,0,hn-U))+je})):mn===r&&(t=Ge(qt,e),G=et(r),l(qt,{width:t.x+G.w/4+je,height:t.y+G.h/4+je}))}function _n(){mn=0}function Cn(e,t,n){return{header:e,body:t,footer:n}}function jn(e){L=St.drop.target,R=Wt,H=e&&e.target||0,(!H||H!==L&&tt(H,L)!==L)&&(St.drop.target=0,St.exit(H===Vt))}var L,R,H,B,U,Z,X,V,N,D,I,t,q,J,G,Q,ee,te,ne,re,oe,n="⌘",r="…",i="⇥",u="⇧",f=window,c=document,a=new TE(e),s=a._,l=s.css,p=s.edge,d=s.x,m=s.extend,g=s.pattern,h=s.timer.reset,y=s.timer.set,w=s.trim,b={},v=function(){},k=TE.is,x=k.e,$=k.a,E=k.f,T=k.i,_=k.o,C=k.r,j=function(e){return!k.x(e)},F=k.s,K=c.documentElement,z=(c.head,c.body),A=m({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",i],outdent:["Outdent",u+"+"+i]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%2"}},t),O={},ue="blur",fe="click",pe="keydown",de="keyup",me="touchstart mousedown",ge="touchmove mousemove",he="touchend mouseup",we="orientationchange resize",be=A.auto_close,ve=A.auto_tab,ke=A.languages,xe=A.tab,Ee=(A.union[1][1],A.union[1][0]),Te=A.union[0][1],_e=A.union[0][0],Ce="javascript:;",je="px",St=a.ui={};a.tidy=function(e,t){var n=a.$(),r=w(n.before)?e:"",o=w(n.after)?j(t)?t:e:"";return a.trim(r,o)},a.i=function(){return w(a.replace(/\s+/g," "))},a.format=function(e,t,n,r){_(e)||(e=[e]),j(n)||(n=" "),j(r)||(r="");var o=a.h,i=a[0]().$(),u=e[0].split(g("("+Te[3]+")+"))[0],f=(e[0]?Ee[0]+e[0]+Ee[1]:"")+r,c=r+(e[0]?Ee[0]+Ee[2]+(e[1]||u)+Ee[1]:""),s=d(e[0]?Ee[0]+u+Ee[1]:""),l=d(c),p=g("^"+s+"([\\s\\S]*?)"+l+"$"),m=g(s+"$"),h=g("^"+l),y=i.before,w=i.after;return i.length?n=!1:a.insert(ke.placeholders[""]),a.toggle(t?!p.test(i.value):!m.test(y)&&!h.test(w),[function(e){e.unwrap(f,c,1).tidy(g(_e[0]+"[^"+_e[0]+_e[1]+_e[2]+"]+?"+_e[1]+"$").test(y)?"":n,g("^"+_e[0]+_e[2]+"[^"+_e[0]+_e[1]+"]+?"+_e[1]).test(w)?"":n).wrap(f,c,t)},function(e){e.unwrap(f,c,t)}])[o]()};var nn,zt=A.classes,At=zt[""],Ot=ke.tools,Lt=ke.buttons,Rt=ke.labels,Ht=At+"-textarea "+At+"-content block",Mt=Kt(At+"-sizer s"),Pt=Kt(At+"-sizer se"),Bt=Kt(At),Yt=Kt(At+"-header"),Ut=Kt(At+"-body"),Zt=Kt(At+"-footer"),Xt=Kt(At+"-tool"),Vt=ut(e,!1,A.attributes),Nt=Kt(At+"-description"),Dt=ut(),It=ut(),qt=ut(),Wt=ut(),Jt=ut(),Gt=ut(),Qt=Kt("left","span"),en=Kt("right","span"),tn=0;St.i=function(e,t,n){return e=Je(e).replace(/[\/\s]/g,"-"),G=We(zt.i,[e,t||e]),n?(ot(n),nt(n,G),n):'<i class="'+G+'"></i>'},j(A.suffix)||(A.suffix=Ee[1]);var an="ui-drop-data",mn=0,re=0,oe=0,ne=0,U=0,gn=0,hn=0,yn={};a.create=function(e,t){if(a.is.create)return a;a.is.create=!0,_(e)&&(A=m(A,e));var n=vt(Vt);return nt(Bt,At+"-is-can-update"),nt(Bt,At+"-is-can-copy"),nt(Vt,Ht),n&&wt(n,"p")?(kt(n,Bt),tn=n,_t(n,!1)):kt(Vt,Bt),Bt.dir=A.direction,Tt(Bt,Yt),Tt(Bt,Ut),Tt(Bt,Zt),Tt(Ut,Vt),A.tools&&(Tt(Yt,Xt),Tt(Zt,Nt),Tt(Nt,Qt),Tt(Nt,en)),Ne(pe,Vt,pn),Ne(de+" "+ue,Vt,dn),I=At+"-is-can-resize",A.resize?(Tt(Bt,Mt),nt(Bt,I),Ne(me,Mt,wn),Ne(ge,c,bn),Ne(he,z,vn)):ot(Bt,I),sn(),ln(),0!==t?Me("create",[a]):a},a.update=function(e,t){return a.is.create&&a.destroy(0),(0!==t?Me("update",[a]):a).create(e,0)},a.destroy=function(e){return a.is.create?(a.is.create=!1,St.exit(0,0,0),ot(Vt,Ht),A.tools=Se(A.tools),A.keys&&(De(pe,Vt,pn),De(de,Vt,dn)),A.resize&&(De(me,Mt,wn),De(ge,c,bn),De(he,c,vn)),tn?(kt(Bt,tn),Tt(tn,Vt),tn=0):kt(Bt,Vt),Ft(Bt),0!==e?Me("destroy",[a]):a):a},a.enable=function(e){return Vt.disabled=Vt.readOnly=!1,nt(Bt,At+"-is-can-update"),nt(Bt,At+"-is-can-copy"),0!==e?Me("enable",[a]):a},a.disable=function(e){return Vt.disabled=!0,ot(Bt,At+"-is-can-update"),ot(Bt,At+"-is-can-copy"),0!==e?Me("disable",[a]):a},a.freeze=function(e){return Vt.disabled=!1,Vt.readOnly=!0,ot(Bt,At+"-is-can-update"),nt(Bt,At+"-is-can-copy"),0!==e?Me("freeze",[a]):a},St.exit=function(e,t,n){if(B={panel:function(){Ft(Dt)},overlay:function(){De(fe,It,kn),Ft(It)},modal:function(){De(fe+" "+pe,yn.x,$n),De(me,Ut,En),De(ge,Ut,Tn),De(he,c,_n),Ft(qt)},drop:function(){De(fe,c,jn),De(we,f,jn),Ft(Wt)},bubble:function(){Ft(Jt)}},dn(),t)if(_(t))for(Z in t)Z=t[Z],B[Z]&&B[Z](),0!==n&&Me("exit."+Z,[a]);else B[t]&&B[t](),0!==n&&Me("exit."+Z,[a]);else for(Z in B)B[Z]();return e&&a.select(),0!==n&&Me("exit",[a]),a},St.panel=function(e,t,n,r){function o(e){return De(fe+" "+pe,re,o),St.panel.exit(1),Ve(e)}return St.exit(0,0,0),N=Je(e),Q=0,r&&(N+=" "+N+"--"+Je(r)),_(t)&&!x(t)&&(Q=Kt(At+"-panel-header "+N,0,t.header),t=t.body),ee=Kt(At+"-panel-body "+N,0,Kt(At+"-panel-content "+N,0,E(t)?"":t)),E(t)&&t(ee),re=ut("a",!1,{href:Ce,"class":At+"-a "+At+"-x "+N}),re.title=Lt.close,ut(Dt,!1,{"class":At+"-panel "+N}),Ne(fe+" "+pe,re,o),st(Dt,0),Q&&Tt(Dt,Q),Tt(Ut,ut(Dt,[ee,re])),E(n)?n(Dt):F(n)&&ut(Dt,n),L=[a,Dt],r&&Me("enter.panel."+e+":"+r,L),Me("enter.panel."+e,L),Me("enter.panel",L),Me("enter",L),re.focus(),a},St.panel.fit=function(){},St.overlay=function(e,t,n,r){return St.exit(0,0,0),N=Je(e),r&&(N+=" "+N+"--"+Je(r)),Tt(Ut,ut(It,!1,{"class":At+"-overlay "+N})),t&&Ne(fe,It,kn),E(n)?n(It):F(n)&&ut(It,n),L=[a,It],r&&Me("enter.overlay."+e+":"+r,L),Me("enter.overlay."+e,L),Me("enter.overlay",L),Me("enter",L),a},St.overlay.fit=function(){},St.message=function(e,t,n,r,o){function u(e){return De(fe+" "+pe,re,u),h(i),St.overlay.exit(1),Ve(e)}var i;return N=Je(e),o&&(N+=" "+N+"--"+Je(o)),re=ut("a",!1,{href:Ce,"class":At+"-a "+At+"-x "+N}),re.title=Lt.close,ut(Gt,E(t)?t(Gt):t,{"class":At+"-message "+N}),Ne(fe+" "+pe,re,u),St.overlay("message message-"+N,0,function(e){Tt(Gt,re),n&&(i=y(function(){u()},n)),Tt(e,Gt)},o),E(r)?r(Gt):F(r)&&ut(Gt,r),a},St.modal=function(){var f,s,e=arguments,t=e[0],n=e[1],r=e[2],o=e[3],i=At+"-modal",u=n.footer;if(_(t)&&(t="default",n=e[0],r=e[1],o=e[2]),St.overlay(t,1,0,o).blur(),N=Je(t),o&&(N+=" "+N+"--"+Je(o)),ut(qt,!1,{"class":i+" "+N}),j(n.body)&&(n.body=ut("div",n.body,{"class":i+"-content "+N})),j(u)&&_(u)&&!x(u)){s=[];for(Z in u)X=u[Z],x(X)?s.push(X):(X=un(X,Z,u),V=Z.text||Lt[Z]||Z,f=ut("button",V,m({name:"y["+Z+"]",type:"button","class":At+"-button",data:{"button-id":Z}},X.attributes)),Ne(fe,f,function(e){return V=u[Ze(this,"button-id")].click(e,a),V===!1?Ve(e):void 0}),s.push(f));n.footer=s}for(Z in n)i[1]=Z,yn[Z]=Kt(i+"-"+We(Z,i)+" "+N,0,n[Z]);return yn.x=ut("a",!1,{href:Ce,"class":At+"-a "+At+"-x "+N}),yn.sizer=Pt,st(qt,0),yn.x.title=Lt.close,Tt(Ut,ut(qt,yn,{style:""})),St.modal.fit(),xt(qt,It),Ne(fe+" "+pe,yn.x,$n),Ne(me,yn.header,Ve),Ne(me,yn.sizer,Ve),Ne(me,Ut,En),Ne(ge,Ut,Tn),Ne(he,c,_n),E(r)&&r(yn),L=[a,qt,yn],o&&Me("enter.modal."+t+":"+o,L),Me("enter.modal."+t,L),Me("enter.modal",L),Me("enter",L),yn.x.focus(),a},St.modal.fit=function(e){return xn(),N=gn/2-ne/2,Q=hn/2-U/2,_(e)?(j(e[0])&&(N=e[0]),j(e[1])&&(Q=e[1])):(N=p(N,0),Q=p(Q,0)),l(qt,{left:N+je,top:Q+je,"min-width":ne+je,"min-height":U+je,visibility:"visible"}),L=[a,qt,yn],Me("fit.modal",L),Me("fit",L),a};var Fn={"class":At+"-button",name:"y"};return St.alert=function(e,t,n,r,o){var i=ut("button",Lt.okay,Fn),u="alert";return n=n||v,_(e)&&(u+=":"+e[0],e=e[1]||e[0]),Ne(fe,i,function(e){return n(e,a),$n(e,u+".y")}),Ne(pe,i,function(e){var t=e.TE.key;return t(["enter","escape"])&&Ie(fe,i,[e]),Ve(e)}),St.modal(u,Cn(e,t,i),r,o),i.focus(),a},St.confirm=function(e,t,n,r,o,i){function l(e){return E(n)&&n(e,a),$n(e,c+".y")}function p(e){return E(r)&&r(e,a),$n(e,c+".n")}var s,u=ut("button",Lt.okay,Fn),f=ut("button",Lt.cancel,Fn),c="confirm";return f.name="n",Ne(fe,u,l),Ne(fe,f,p),Ne(pe,u,function(e){return s=e.TE.key,s("right")?f.focus():s("enter")?l(e):s("escape")&&$n(e,c+".y"),Ve(e)}),Ne(pe,f,function(e){return s=e.TE.key,s("left")?u.focus():s("enter")?p(e):s("escape")&&$n(e,c+".n"),Ve(e)}),St.modal(c,Cn(e,t,[u,f]),o,i),f.focus(),a},St.prompt=function(e,t,n,r,o,i,u){function h(){s.focus(),"placeholder"in s&&s.select()}function y(e){return d=s.value,E(n)&&!n(d)?h():!n||w(d)&&d!==t?($n(e,l+".y"),r(e,a,d!==t?d:"",t)):h(),Ve(e)}function b(e){return $n(e,l+".n")}var d,m,g,f=ut("button",Lt.okay,Fn),c=ut("button",Lt.cancel,Fn),s=ut("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":At+"-input block"}),l="prompt",p=[];if(o=o||0,1===o)s=ut("textarea",t,{placeholder:t.split("\n")[0],"class":At+"-textarea block",spellcheck:"false"});else if(2===o){for(Z in t)p.push(ut("option",t[Z],{value:Z,selected:Z===n||null}));s=ut("select",p,{"class":At+"-select block"})}return r=r||v,s.name="data",c.name="n",Ne(pe,s,function(e){return m=e.TE.key,g=e.TE.control,m("enter")&&0===o||g("enter")?y(e):m("escape")||m("back")&&!this.value?b(e):m("down")&&0===o||m("enter")&&2===o||g("down")?(f.focus(),Ve(e)):void 0}),Ne(pe,f,function(e){return m=e.TE.key,m("enter")?y(e):m("escape")?b(e):m("up")?s.focus():m("right")&&c.focus(),Ve(e)}),Ne(pe,c,function(e){return m=e.TE.key,m(["enter","escape"])?b(e):m("up")?s.focus():m("left")&&f.focus(),Ve(e)}),Ne(fe,f,y),Ne(fe,c,b),St.modal(l,Cn(e,s,[f,c]),i,u),h(),a},St.drop=function(){St.exit(0,0,0);var e=arguments,t=e[0],n=e[1],r=e[2];return 1===Oe(e)&&(t="default",n=e[0],r=e[1]),N=Je(t),st(Wt,0),Tt(z,ut(Wt,!1,{"class":At+"-drop "+N})),E(n)?n(Wt):ut(Wt,n),St.drop.fit(),r===!1||(Ne(fe,c,jn),Ne(we,f,jn)),L=[a,Wt],Me("enter.drop."+t,L),Me("enter.drop",L),a},St.drop.fit=function(e){return L=et(K),R=et(Wt),H=St.drop.target,N=L.w/2-R.w/2,Q=L.h/2-R.h/2,!j(e)&&H&&(t=Qe(H),N=t.l,Q=t.t+et(H).h),_(e)?(j(e[0])&&(N=e[0]),j(e[1])&&(Q=e[1])):(N=p(N,0,L.w-R.w),Q=p(Q,0,Math.max(L.h,et(f).h)-R.h)),l(Wt,{left:N+je,top:Q+je,visibility:"visible"}),L=[a,Wt],Me("fit.drop",L),Me("fit",L),a},St.menu=function(e,n,r,o){var f,i=St.tools,u=0;if(n===!1)return St.tool(e,n);for(o in r)ne="%"===o[0],f=r[o],f=F(f)&&!ne?i[f]:f,f&&(f=un(f,o,i),r[o]=f);return St.tool(e,{i:_(n)?n[0]:0,text:_(n)?n[1]||0:n&&r[n]&&r[n].text||n,click:function(c){var s=St.drop.target=i[e].target;return St.drop("menu menu-"+Je(e),function(c){function l(u){return Q=this,t=Ze(Q,"tool-id"),D=r[t],D=F(D)?i[D]:D||{},I=at(Q),!on(D)&&E(o=D.click)&&(o=o(u,a),D.i&&(i[e].i=D.i),St.menu.set(e,_(D.text)?[D.text[0],t]:_(n)?[n[0],t]:t),o===!1)?(a.select(),Ve(u)):(a.select(),Ve(u))}function p(e){if(Q=this,(V=e.TE.key)("escape"))St.exit(1);else if(V("enter"))Ie(fe,Q,[e]);else if(V("f10")&&s)s.focus();else if(V("down")&&(N=gt(Q))){for(;!wt(N,"a")&&N;)N=gt(N);N&&N.focus()}else if(V("up")&&(N=ht(Q))){for(;!wt(N,"a")&&N;)N=ht(N);!N&&s?(St.exit(),s.focus()):N&&N.focus()}else V("up")&&s&&(St.exit(),s.focus());return Ve(e)}for(o in r)if(f=r[o],ne="%"===o[0],f){var d={href:ne?null:Ce,"class":At+"-"+(ne?"label":"button")};ne?X=Rt[e]&&Rt[e][+o.slice(1)-1]||o:(d.data={},d.data["tool-id"]=o,X=Ot[o]||o),J=f.text,J=_(J)?J[1]||"":J,X=_(X)?X[0]:X,G=ut(ne?"span":"a","<span>"+(ne?X||"%"+u:J||X)+"</span>",m(d,f.attributes||{})),nt(G,"menu-"+Je(o).replace(/[\/\s]/g,"-")),!d.title&&(Q=f.title)&&(G.title=_(Q)?Q[0]+(Q[1]?" ("+Q[1]+")":""):Q),ne?Pe(G,{id:At+"-label:"+u}):(on(f)?nt(G,"x"):ot(G,"x"),f.on?nt(G,"on"):ot(G,"on"),Ne(fe,G,l),Ne(pe,G,p)),Tt(c,G),++u}y(function(){(bt('[data-tool-id="'+Ze(s,an)+'"]',c)[0]||bt("a",c)[0]).focus()},1)}),!1}},o),Ue(i[e].target,{"ui-drop":e}),i[e].data=r,St.menu.set(e,n)},St.menu.set=function(e,t){var i,u,n=St.tools[e]||{},r=n.target,o=n.data;return r?(_(t)?Ue(r,an,t[1]||""):(Ue(r,an,t),t=o[t]&&o[t].text||t),_(t)?(u=t[0],u=ze(u,"<")?u:St.i(u,n.i),t=j(t[1])?t[1]:0,t=t&&o[t]&&o[t].text||t,t=u+(0!==t?"<span>"+(_(t)?t[1]||t:t)+"</span>":"")):u=St.i(e,n.i),(i=bt("."+At+"-text",r)[0])?(nt(r,"text"),ct(i,t)):(ot(r,"text"),ct(r,u)),a):a},St.bubble=function(){St.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Oe(e)&&(t="default",n=e[0]),N=Je(t),st(Jt,0),Tt(z,ut(Jt,!1,{"class":At+"-bubble "+N})),E(n)?n(Jt):ut(Jt,n),St.bubble.fit(),L=[a,Jt],Me("enter.bubble."+t,L),Me("enter.bubble",L),a},St.bubble.fit=function(e){G=a.$(1),t=Qe(Vt),U=l(Vt,"line-height");var n="border-",r="-width";N=G.caret[0].x+t.l-Vt.scrollLeft,Q=G.caret[1].y+t.t+U-Vt.scrollTop,R=l(Ut,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var o=et(Ut),i=et(Jt),u=R[0]+R[1],f=R[2]+R[3];return _(e)?(j(e[0])&&(N=e[0]),j(e[1])&&(Q=e[1])):(N=p(N,t.l,t.l+o.w-i.w-f),Q=p(Q,t.t,t.t+o.h-i.h-u)),l(Jt,{left:N+je,top:Q+je,visibility:"visible"}),L=[a,Jt],Me("fit.bubble",L),Me("fit",L),a},St.panel.exit=function(e){return St.exit(e,"panel")},St.overlay.exit=function(e){return St.exit(e,"overlay")},St.modal.exit=function(e){return St.exit(e,"modal")},St.drop.exit=function(e){return St.exit(e,"drop")},St.bubble.exit=function(e){return St.exit(e,"bubble")},St.tool=function(e,t,n){var r=St.tools;return X="",V=j(r[e])?"update":"create","|"!==e&&(A.tools=Ke(A.tools||"").filter(function(t,n){return t===e?(X=n,!1):!0})),t===!1?(delete r[e],V="destroy"):("|"===e?(n=t,t={}):(E(t)&&(t={click:t}),r[e]=m(r[e]||{},t),j(n)||""===X||(n=X)),T(n)?A.tools.splice(n,0,e):A.tools.push(e)),Me(V+".tool."+e,[a,r[e]]),sn(),a},St.separator=function(e,t){return St.tool("|",e!==!1?{attributes:e||{}}:!1,t)},St.key=function(e,t){var n=St.keys;return V=j(n[e])?"update":"create",t===!1?(delete n[e],V="destroy"):n[e]=t,Me(V+".key."+e,[a,n[e]]),ln(),a},St.key.set=function(e){O[e]=1},St.key.reset=function(e){e?delete O[e]:O={}},St.tools={"|":{},undo:{click:function(e,t){return t.undo(),!1}},redo:{click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(xe),!1},outdent:function(e,t){return t.outdent(xe),!1}},St.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return J=":not([tabindex]):not([disabled])",(G=bt("input"+J+",button"+J+",select"+J+",textarea"+J+",a[href]"+J+",[contenteditable]"+J+',[tabindex]:not([tabindex="-1"])',c,0))&&-1!==(Q=G.indexOf(Vt))?((G[Q+1]||c).focus(),!1):void 0},f10:function(e,t){return bt("a",Xt)[0].focus(),!1},tab:ve?"indent":0,"shift+tab":ve?"outdent":0},St.el={container:Bt,header:Yt,body:Ut,footer:Zt,panel:Dt,overlay:It,modal:qt,drop:Wt,bubble:Jt},a.config=A,m(TE._,{time:function(e){var t=new Date(j(e)?e:Date.now()),n=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),i=t.getHours(),u=t.getMinutes(),f=t.getSeconds(),c=t.getMilliseconds();return 10>r&&(r="0"+r),10>o&&(o="0"+o),10>i&&(i="0"+i),10>u&&(u="0"+u),10>f&&(f="0"+f),10>c&&(c="0"+c),[""+n,""+r,""+o,""+i,""+u,""+f,""+c]},replace:qe,format:We,dom:{set:Tt,reset:_t,get:bt,id:ft,copy:Ct,replace:jt,classes:{set:nt,reset:ot,toggle:it,get:rt},attributes:{set:Pe,reset:Ye,get:Be},data:{set:Ue,reset:Xe,get:Ze},is:wt,offset:Qe,pointer:Ge,size:et,content:{set:ct,reset:st,get:at},closest:tt,parent:pt,children:dt,closest:mt,next:gt,previous:ht,index:yt,before:kt,after:xt,prepend:$t,append:Et},el:ut,events:{set:Ne,reset:De,fire:Ie,x:Ve}}),m(a._,TE._),m(a._,{hooks:{set:Re,reset:He,fire:Me}}),a.create()};