/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.8.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(n,e){function Sn(n){return j(n)?y(n).split(/\s+/):n}function $n(n){return F(n)?n.join(" "):n}function Nn(n,e){return-1!==n.indexOf(e)}function On(n){return Object.keys(n)}function Hn(n){return n.length}function Bn(n){return Hn(On(n))}function Dn(n,e,t){return M(n)?M(e)?(M(b[n])||(b[n]={}),M(t)||(t=Bn(b[n])),b[n][t]=e,l):b[n]:b}function qn(n,e){return M(n)?M(e)&&M(b[n])?(delete b[n][e],l):(b[n]={},l):(b={},l)}function _n(n,e,t){if(!M(b[n]))return b[n]={},l;if(M(t))M(b[n][t])&&b[n][t].apply(l,e);else for(U in b[n])b[n][U].apply(l,e);return l}function zn(n,e,t){if(F(e))for(U in e)zn(n,U,e[U]);else n[(null===t?"remove":"set")+"Attribute"](e,t)}function Rn(n,t,r){if(!t){for(e={},U=0,K=n.attributes,P=Hn(K);P>U;++U)J=K[U],e[J.name]=J.value;return Bn(e)?e:M(r)?r:{}}if(j(t))return Rn(n,[t],[M(r)?r:""])[0];e=[];for(U in t)U=t[U],(U=n.getAttribute(U))&&e.push(U);return Hn(e)?e:M(r)?r:[]}function In(n,e){if(F(e))for(U in e)In(n,e[U]);else if(M(e))n.removeAttribute(e);else for(In(n,"class"),U=0,K=n.attributes,P=Hn(K);P>U;++U)K[U]&&In(n,K[U].name)}function Wn(n,e,t){if(F(e))for(U in e)Wn(n,U,e[U]);else zn(n,"data-"+e,t)}function Un(n,t,r){if(!t){for(e={},U=0,K=n.attributes,P=Hn(K);P>U;++U)J=K[U],"data-"===J.name.slice(0,5)&&(e[J.name]=J.value);return Bn(e)?e:M(r)?r:{}}if(j(t))return Un(n,[t],[M(r)?r:""])[0];e=[];for(U in t)U=t[U],(U=Rn(n,"data-"+U))&&e.push(U);return Hn(e)?e:M(r)?r:[]}function Kn(n,e){if(F(e))for(U in e)In(n,"data-"+e[U]);else if(M(e))In(n,"data-"+e);else for(U=0,K=n.attributes,P=Hn(K);P>U;++U)K[U]&&"data-"===K[U].name.slice(0,5)&&In(n,K[U].name)}function Pn(n){return n&&n.preventDefault(),!1}function Jn(n,e,t){if(e){for(n=Sn(n),U=0,K=Hn(n);K>U;++U)e.addEventListener(n[U],t,!1),Dn("on:"+n[U],t,ce(e));return l}}function Zn(n,e,t){if(e){for(n=Sn(n),U=0,K=Hn(n);K>U;++U)e.removeEventListener(n[U],t,!1),qn("on:"+n[U],ce(e));return k(e)&&e.id.split(":")[0]===Ne+"-dom"&&In(e,"id"),l}}function Vn(n,e,t){n=Sn(n);var i,r="createEvent"in c;for(U=0,K=Hn(n);K>U;++U)r?(i=c.createEvent("HTMLEvents"),i.data=t,i.initEvent(n[U],!0,!1),e.dispatchEvent(i)):_n("on:"+n[U],t,ce(e));return l}function Yn(n,e,t){for(U=0,K=Hn(e),P;K>U;++U)P=e[U],n=n.replace(A(P)?P:m(p(P),"g"),t&&t[U]||"");return n}function Qn(n,e){return n.replace(/%(\d+)/g,function(n,t){return--t,M(e[t])?e[t]:n})}function Xn(n){return y(Yn(n.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Gn(n,e){var t=e.touches?e.touches[0].pageX:e.pageX,r=e.touches?e.touches[0].pageY:e.pageY,i=ne(n);return{x:t-i.l,y:r-i.t}}function ne(n){for(J=n.offsetLeft,nn=n.offsetTop;n=n.offsetParent;)J+=n.offsetLeft,nn+=n.offsetTop;return{l:J,t:nn}}function ee(n){return n===o?{w:n.innerWidth,h:n.innerHeight}:{w:n.offsetWidth,h:n.offsetHeight}}function te(n,e){for(;(n=de(n))&&n!==e;);return n}function re(n,e){e=Sn(e);for(U in e)n.classList.add(e[U])}function ie(n,t,r){if(!t)return e=Sn(n.className),Hn(e)?e:M(r)?r:[];if(j(t))return ie(n,[t],[M(r)?r:""])[0];e=[];for(U in t)U=t[U],n.classList.contains(U)&&e.push(U);return Hn(e)?e:M(r)?r:[]}function ue(n,e){if(M(e)){e=Sn(e);for(U in e)n.classList.remove(e[U])}else In(n,"class")}function fe(n,e){e=Sn(e);for(U in e)n.classList.toggle(e[U])}function oe(n,e,t){if(n=n||"div",n=j(n)?c.createElement(n):n,F(t))for(U in t)if(tn=t[U],"classes"===U)re(n,tn);else if("data"===U)for(K in tn)tn=tn[K],null===tn?Kn(n,K):Wn(n,K,tn);else"css"===U?j(tn)?zn(n,"style",tn):null===tn?In(n,"style"):a(n,tn):L(tn)?n[U]=tn:null===tn?In(n,U):zn(n,U,E(tn)?tn.join(" "):""+tn);if(k(e))Ce(n,e);else if(F(e))for(U in e)tn=e[U],k(tn)?Ce(n,tn):tn!==!1&&le(n,tn);else M(e)&&e!==!1&&le(n,e);return n}function ce(n){var e=n.id;return e||(e=Ne+"-dom:"+Math.floor(Date.now()*Math.random()),n.id=e),e}function le(n,e){n.innerHTML=e}function se(n,e){return n.innerHTML||(M(e)?e:"")}function ae(n,e){if((!M(e)||e)&&(q=pe(n)))for(U=0,K=Hn(q);K>U;++U)ae(q[U]);le(n,"")}function de(n){return n&&n.parentNode}function pe(n){return n&&n.children||[]}function he(n,e){return M(e)?j(e)?n.closest(e):te(n,e):de(n)}function me(n){return n&&n.nextElementSibling}function ve(n){return n&&n.previousElementSibling}function ge(n){for(U=0;n=ve(n);)++U;return U}function ye(n,e){return n&&j(e)?n.nodeName.toLowerCase()===e.toLowerCase():n&&L(e)?n===e(n):n===e}function be(n,t){if(!(t=M(t)?t:c))return[];if(e=[],j(n)){if(/^[#.]?(?:\\.|[\w-]|[^\x00-\xa0])+$/.test(n)){if("#"===n[0]&&(n=t.getElementById(n.slice(1))))return[n];if("."===n[0]&&(n=t.getElementsByClassName(n.slice(1)))||(n=t.getElementsByTagName(n))){for(U=0,K=Hn(n);K>U;++U)e.push(n[U]);return e}return[]}for(n=t.querySelectorAll(n),U=0,K=Hn(n);K>U;++U)e.push(n[U]);return e}return xe(n)?[n]:[]}function xe(n,e){var t=de(n);return 1===Hn(arguments)?t||!1:n&&t===n?t:!1}function we(n,e){Y=de(n),Y&&Y.insertBefore(e,n)}function ke(n,e){Y=de(n),Y&&Y.insertBefore(e,me(n))}function Ee(n,e){q=n.firstChild,q?we(q,e):Ce(n,e)}function Le(n,e){Ce(n,e)}function Ce(n,e){n.appendChild(e)}function Fe(n,e){var t=de(n);if(t){if(!M(e)||e)for(q=n.firstChild;q;)Fe(q);t.removeChild(n)}}function Ae(n,e){return n.cloneNode(M(e)?!!e:!0)}function Me(n,e){return de(n).replaceChild(e,n),e}function je(n){ae(oe(n,!1,{style:""})),Fe(n)}function Te(n,e,t){return oe(e,t,{"class":n})}function it(n){return!n||M(n.active)&&!n.active}function ut(n,e,t){return L(n)&&(n={click:n}),j(n.click)&&(n.click=(t[n.click]||{}).click),n.title=Oe[e]||"",M(n.attributes)||(n.attributes={}),t[e]&&(t[e]=n),n}function ft(n){Se.exit(0,0,0);var e=Un(this,"tool-id"),t=Se.tools,r=t[e];return Se.drop.target=n.currentTarget||n.target,!it(r)&&L(K=r.click)&&(K=K(n,l,e),_n("on:change",[n,l,e]),K===!1)?Pn(n):(l.select(),Pn(n))}function ot(n){if(nn=this,(P=n.TE.key)(/^(escape|f10)$/))Se.exit(1);else if(P("enter")||P("arrowdown")&&Un(nn,"ui-drop"))Se.drop.target=nn,Vn(ln,nn,[n]);else if(P("arrowright")&&(J=me(nn))){for(;!ye(J,"a")&&J;)J=me(J);J&&J.focus()}else if(P("arrowleft")&&(J=ve(nn))){for(;!ye(J,"a")&&J;)J=ve(J);J&&J.focus()}return Pn(n)}function lt(){ae(Ue,0);var i,u,f,o,c,s,a,n=Se.tools,e=Sn(O.tools),t=Ne+"-button",r=Ne+"-separator";O.tools=e;for(s in e)a=e[s],u=n[a],(u||u==={})&&(u=ut(u,a,n),f=u.i||a,"|"===f||Nn(f,"<")||(f=Xn(f)),o="|"!==f,c=Xn(a).replace(/[\/\s]/g,"-"),tt=Te(o?t+" "+t+"-"+c:r+" "+r+"-"+s,o?"a":"span"),o?(tt=u.target||tt,i=t+":"+c,zn(tt,{href:jn,id:i,tabindex:-1}),Wn(tt,"tool-id",a),f=Nn(f,"<")?f:Se.i(c,f),it(u)?re(tt,"x"):ue(tt,"x"),u.on?re(tt,"on"):ue(tt,"on"),u.text&&(f=Qn('<span class="'+Ne+'-text">'+u.text+"</span>",[f]),re(tt,"text")),le(tt,f),oe(tt,!1,u.attributes),!u.attributes.title&&(K=u.title)&&(tt.title=F(K)?K[0]+(K[1]?" ("+K[1]+")":""):K),Jn(ln,tt,ft),Jn(hn,tt,ot)):tt.id=r+":"+s,u.target=tt,(c=Un(tt,ct))&&Se.menu.set(a,c),Ce(Ue,tt));_n("update.tools",[l])}function st(){Se.keys=function(){var t,n=On(Se.keys).sort().reverse(),e={};for(U=0,K=Hn(n);K>U;++U)t=n[U],e[t]=Se.keys[t];return e}(),dt(),_n("update.keys",[l])}function at(n){function h(n){return n.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var t=l.$(),r=t.before,i=t.after,u=r.slice(-1),f=i[0],o=t.length,c=Se.keys,s=TE.keys_alias,a={control:0,shift:0,option:"alt",meta:0},d=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(U in a)n.TE[U]()&&(H[a[U]||U]=1);V=n.TE.key(),H[V]=1,e=Bn(H),g(function(){l.record()});for(U in c){P=h(U),q=0;for(K in P)K=P[K],H[s[K]||K]&&++q;if(P=Hn(P),q===P&&e===P&&(j(c[U])&&(c[U]=Se.tools[c[U]].click),J=L(c[U])&&c[U](n,l),J===!1))return Pn(n)}if(wn)for(U in wn)if(Z=wn[U],Z!==!1){if(V===Z&&f===Z)return"\\"===u?(l.insert(V,0),Pn(n)):(l.select(t.end+1),Pn(n));if(U===V)return l.wrap(U,Z),Pn(n);if(u===U&&f===Z){if("backspace"===V&&r.slice(-2)!=="\\"+U)return l.unwrap(U,Z),Pn(n);if(kn&&"enter"===V&&U!==Z&&!o)return l.tidy("\n"+d+Ln,"\n"+d).scroll(1),Pn(n)}}if(kn&&!o){if("backspace"===V&&m(p(Ln)+"$").test(r))return l.outdent(Ln),Pn(n);if("enter"===V&&m("(^|\\n)("+p(Ln)+")+.*$").test(r))return l.insert("\n"+d,0,1).scroll(1),Pn(n)}}function dt(n){n&&n.TE&&n.TE.key?delete H[n.TE.key()]:H={}}function gt(n){return pt=qe,G=ee(We),Pn(n)}function yt(n){pt===qe&&a(Ke,{height:Gn(Ie,n).y-G.h+Tn})}function bt(){pt=0}function xt(){Se.exit(1)}function wt(){e=ee(Ve),rn=e.w,W=e.h,e=ee(Ze),ht=e.w,mt=e.h}function kt(n,e){return e&&_n("exit.modal."+e,[l]),Vn(ln,Ze,[n]),Pn(n)}function Et(n){pt=n.target,e=Gn(Ve,n),un=e.x,fn=e.y,wt()}function Lt(n){var t=vt.header,r=vt.sizer;pt===t||te(pt,t)===t?(e=Gn(Ie,n),J=e.x-un,nn=e.y-fn,a(Ve,{left:(rn>ht?J:d(J,0,ht-rn))+Tn,top:(W>mt?nn:d(nn,0,mt-W))+Tn})):pt===r&&(e=Gn(Ve,n),G=ee(r),a(Ve,{width:e.x+G.w/4+Tn,height:e.y+G.h/4+Tn}))}function Ct(){pt=0}function Ft(n,e,t){return{header:n,body:e,footer:t}}function At(n){B=Se.drop.target,D=Ye,q=n&&n.target||0,(!q||q!==B&&te(q,B)!==B)&&(Se.drop.target=0,Se.exit(q===Ke))}var B,D,q,R,W,U,K,P,J,Z,V,e,Y,X,G,nn,en,tn,rn,un,fn,t="⌘",r="…",u="⇥",f="⇧",o=window,c=document,l=new TE(n),s=l._,a=s.css,d=s.edge,p=s.x,h=s.extend,m=s.pattern,v=s.timer.reset,g=s.timer.set,y=s.trim,b={},x=function(){},w=TE.is,k=w.e,E=w.a,L=w.f,C=w.i,F=w.o,A=w.r,M=function(n){return!w.x(n)},j=w.s,T=c.documentElement,$=(c.head,c.body),O=(c.currentScript,h({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},union:[[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]],[["<",">","/"],["=",'"','"'," "]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",u],outdent:["Outdent",f+"+"+u]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},e)),H={},cn="blur",ln="click",hn="keydown",mn="keyup",vn="touchstart mousedown",gn="touchmove mousemove",yn="touchend mouseup",xn="orientationchange resize",wn=O.auto_close,kn=O.auto_tab,En=O.languages,Ln=O.tab,Fn=(O.union[1][1],O.union[1][0]),An=O.union[0][1],Mn=O.union[0][0],jn="javascript:;",Tn="px",Se=l.ui={};l.tidy=function(n,e){var t=l.$(),r=y(t.before)?n:"",i=y(t.after)?M(e)?e:n:"";return l.trim(r,i)},l.i=function(){return y(l.replace(/\s+/g," "))},l.format=function(n,e,t,r){F(n)||(n=[n]),M(t)||(t=" "),M(r)||(r="");var i=l.h,u=l[0]().$(),f=n[0].split(m("("+An[3]+")+"))[0],o=(n[0]?Fn[0]+n[0]+Fn[1]:"")+r,c=r+(n[0]?Fn[0]+Fn[2]+(n[1]||f)+Fn[1]:""),s=p(n[0]?Fn[0]+f+Fn[1]:""),a=p(c),d=m("^"+s+"([\\s\\S]*?)"+a+"$"),h=m(s+"$"),v=m("^"+a),g=u.before,y=u.after;return u.length?t=!1:l.insert(En.placeholders[""]),l.toggle(e?!d.test(u.value):!h.test(g)&&!v.test(y),[function(n){n.unwrap(o,c,1).tidy(m(Mn[0]+"[^"+Mn[0]+Mn[1]+Mn[2]+"]+?"+Mn[1]+"$").test(g)?"":t,m("^"+Mn[0]+Mn[2]+"[^"+Mn[0]+Mn[1]+"]+?"+Mn[1]).test(y)?"":t).wrap(o,c,e)},function(n){n.unwrap(o,c,e)}])[i]()};var tt,$e=O.classes,Ne=$e[""],Oe=En.tools,He=En.buttons,Be=En.labels,De=Ne+"-textarea "+Ne+"-content block",qe=Te(Ne+"-sizer s"),_e=Te(Ne+"-sizer se"),ze=Te(Ne),Re=Te(Ne+"-header"),Ie=Te(Ne+"-body"),We=Te(Ne+"-footer"),Ue=Te(Ne+"-tool"),Ke=oe(n,!1,O.attributes),Pe=Te(Ne+"-description"),Je=oe(),Ze=oe(),Ve=oe(),Ye=oe(),Qe=oe(),Xe=oe(),Ge=Te("left","span"),nt=Te("right","span"),et=0;Se.i=function(n,e,t){return n=Xn(n).replace(/[\/\s]/g,"-"),G=Qn($e.i,[n,e||n]),t?(ue(t),re(t,G),t):'<i class="'+G+'"></i>'},M(O.suffix)||(O.suffix=Fn[1]);var ct="ui-drop-data",pt=0,un=0,fn=0,rn=0,W=0,ht=0,mt=0,vt={};l.create=function(n,e){if(l.is.create)return l;l.is.create=!0,F(n)&&(O=h(O,n));var t=xe(Ke);return re(ze,Ne+"-is-can-update"),re(ze,Ne+"-is-can-copy"),re(Ke,De),t&&ye(t,"p")?(we(t,ze),et=t,Fe(t,!1)):we(Ke,ze),ze.dir=O.direction,Ce(ze,Re),Ce(ze,Ie),Ce(ze,We),Ce(Ie,Ke),O.tools&&(Ce(Re,Ue),Ce(We,Pe),Ce(Pe,Ge),Ce(Pe,nt)),Jn(hn,Ke,at),Jn(mn+" "+cn,Ke,dt),O.resize&&(Ce(ze,qe),re(ze,Ne+"-is-can-resize"),Jn(vn,qe,gt),Jn(gn,c,yt),Jn(yn,$,bt)),lt(),st(),0!==e?_n("create",[l]):l},l.update=function(n,e){return l.is.create&&l.destroy(0),(0!==e?_n("update",[l]):l).create(n,0)},l.destroy=function(n){return l.is.create?(l.is.create=!1,Se.exit(0,0,0),ue(Ke,De),O.tools=$n(O.tools),O.keys&&(Zn(hn,Ke,at),Zn(mn,Ke,dt)),O.resize&&(Zn(vn,qe,gt),Zn(gn,c,yt),Zn(yn,c,bt)),et?(we(ze,et),Ce(et,Ke),et=0):we(ze,Ke),je(ze),0!==n?_n("destroy",[l]):l):l},l.enable=function(n){return Ke.disabled=Ke.readOnly=!1,re(ze,Ne+"-is-can-update"),re(ze,Ne+"-is-can-copy"),0!==n?_n("enable",[l]):l},l.disable=function(n){return Ke.disabled=!0,ue(ze,Ne+"-is-can-update"),ue(ze,Ne+"-is-can-copy"),0!==n?_n("disable",[l]):l},l.freeze=function(n){return Ke.disabled=!1,Ke.readOnly=!0,ue(ze,Ne+"-is-can-update"),re(ze,Ne+"-is-can-copy"),0!==n?_n("freeze",[l]):l},Se.exit=function(n,e,t){if(R={panel:function(){je(Je)},overlay:function(){Zn(ln,Ze,xt),je(Ze)},modal:function(){Zn(ln+" "+hn,vt.x,kt),Zn(vn,Ie,Et),Zn(gn,Ie,Lt),Zn(yn,c,Ct),je(Ve)},drop:function(){Zn(ln,c,At),Zn(xn,o,At),je(Ye)},bubble:function(){je(Qe)}},dt(),e)if(F(e))for(U in e)U=e[U],R[U]&&R[U](),0!==t&&_n("exit."+U,[l]);else R[e]&&R[e](),0!==t&&_n("exit."+U,[l]);else for(U in R)R[U]();return n&&l.select(),0!==t&&_n("exit",[l]),l},Se.panel=function(n,e,t,r){function i(n){return Zn(ln+" "+hn,un,i),Se.panel.exit(1),Pn(n)}return Se.exit(0,0,0),J=Xn(n),nn=0,r&&(J+=" "+J+"--"+Xn(r)),F(e)&&!k(e)&&(nn=Te(Ne+"-panel-header "+J,0,e.header),e=e.body),en=Te(Ne+"-panel-body "+J,0,Te(Ne+"-panel-content "+J,0,L(e)?"":e)),L(e)&&e(en),un=oe("a",!1,{href:jn,"class":Ne+"-a "+Ne+"-x "+J}),un.title=He.close,oe(Je,!1,{"class":Ne+"-panel "+J}),Jn(ln+" "+hn,un,i),ae(Je,0),nn&&Ce(Je,nn),Ce(Ie,oe(Je,[en,un])),L(t)?t(Je):j(t)&&oe(Je,t),B=[l,Je],r&&_n("enter.panel."+n+":"+r,B),_n("enter.panel."+n,B),_n("enter.panel",B),_n("enter",B),un.focus(),l},Se.panel.fit=function(){},Se.overlay=function(n,e,t,r){return Se.exit(0,0,0),J=Xn(n),r&&(J+=" "+J+"--"+Xn(r)),Ce(Ie,oe(Ze,!1,{"class":Ne+"-overlay "+J})),e&&Jn(ln,Ze,xt),L(t)?t(Ze):j(t)&&oe(Ze,t),B=[l,Ze],r&&_n("enter.overlay."+n+":"+r,B),_n("enter.overlay."+n,B),_n("enter.overlay",B),_n("enter",B),l},Se.overlay.fit=function(){},Se.message=function(n,e,t,r,i){function f(n){return Zn(ln+" "+hn,un,f),v(u),Se.overlay.exit(1),Pn(n)}var u;return J=Xn(n),i&&(J+=" "+J+"--"+Xn(i)),un=oe("a",!1,{href:jn,"class":Ne+"-a "+Ne+"-x "+J}),un.title=He.close,oe(Xe,L(e)?e(Xe):e,{"class":Ne+"-message "+J}),Jn(ln+" "+hn,un,f),Se.overlay("message message-"+J,0,function(n){Ce(Xe,un),t&&(u=g(function(){f()},t)),Ce(n,Xe)},i),L(r)?r(Xe):j(r)&&oe(Xe,r),l},Se.modal=function(){var o,s,n=arguments,e=n[0],t=n[1],r=n[2],i=n[3],u=Ne+"-modal",f=t.footer;if(F(e)&&(e="default",t=n[0],r=n[1],i=n[2]),Se.overlay(e,1,0,i).blur(),J=Xn(e),i&&(J+=" "+J+"--"+Xn(i)),oe(Ve,!1,{"class":u+" "+J}),M(t.body)&&(t.body=oe("div",t.body,{"class":u+"-content "+J})),M(f)&&F(f)&&!k(f)){s=[];for(U in f)K=f[U],k(K)?s.push(K):(K=ut(K,U,f),P=U.text||He[U]||U,o=oe("button",P,h({name:"y["+U+"]",type:"button","class":Ne+"-button",data:{"button-id":U}},K.attributes)),Jn(ln,o,function(n){return P=f[Un(this,"button-id")].click(n,l),P===!1?Pn(n):void 0}),s.push(o));t.footer=s}for(U in t)u[1]=U,vt[U]=Te(u+"-"+Qn(U,u)+" "+J,0,t[U]);return vt.x=oe("a",!1,{href:jn,"class":Ne+"-a "+Ne+"-x "+J}),vt.sizer=_e,ae(Ve,0),vt.x.title=He.close,Ce(Ie,oe(Ve,vt,{style:""})),Se.modal.fit(),ke(Ve,Ze),Jn(ln+" "+hn,vt.x,kt),Jn(vn,vt.header,Pn),Jn(vn,vt.sizer,Pn),Jn(vn,Ie,Et),Jn(gn,Ie,Lt),Jn(yn,c,Ct),L(r)&&r(vt),B=[l,Ve,vt],i&&_n("enter.modal."+e+":"+i,B),_n("enter.modal."+e,B),_n("enter.modal",B),_n("enter",B),vt.x.focus(),l},Se.modal.fit=function(n){return wt(),J=ht/2-rn/2,nn=mt/2-W/2,F(n)?(M(n[0])&&(J=n[0]),M(n[1])&&(nn=n[1])):(J=d(J,0),nn=d(nn,0)),a(Ve,{left:J+Tn,top:nn+Tn,"min-width":rn+Tn,"min-height":W+Tn,visibility:"visible"}),B=[l,Ve,vt],_n("fit.modal",B),_n("fit",B),l};var Mt={"class":Ne+"-button",name:"y"};return Se.alert=function(n,e,t,r,i){var u=oe("button",He.okay,Mt),f="alert";return t=t||x,F(n)&&(f+=":"+n[0],n=n[1]||n[0]),Jn(ln,u,function(n){return t(n,l),kt(n,f+".y")}),Jn(hn,u,function(n){var e=n.TE.key;return e(/^(escape|enter)$/)&&Vn(ln,u,[n]),Pn(n)}),Se.modal(f,Ft(n,e,u),r,i),u.focus(),l},Se.confirm=function(n,e,t,r,i,u){function a(n){return L(t)&&t(n,l),kt(n,c+".y")}function d(n){return L(r)&&r(n,l),kt(n,c+".n")}var s,f=oe("button",He.okay,Mt),o=oe("button",He.cancel,Mt),c="confirm";return o.name="n",Jn(ln,f,a),Jn(ln,o,d),Jn(hn,f,function(n){return s=n.TE.key,s("arrowright")?o.focus():s("enter")?a(n):s("escape")&&kt(n,c+".y"),Pn(n)}),Jn(hn,o,function(n){return s=n.TE.key,s("arrowleft")?f.focus():s("enter")?d(n):s("escape")&&kt(n,c+".n"),Pn(n)}),Se.modal(c,Ft(n,e,[f,o]),i,u),o.focus(),l},Se.prompt=function(n,e,t,r,i,u,f){function v(){s.focus(),"placeholder"in s&&s.select()}function g(n){return p=s.value,L(t)&&!t(p)?v():!t||y(p)&&p!==e?(kt(n,a+".y"),r(n,l,p!==e?p:"",e)):v(),Pn(n)}function b(n){return kt(n,a+".n")}var p,h,m,o=oe("button",He.okay,Mt),c=oe("button",He.cancel,Mt),s=oe("input",!1,{type:"text",value:e,placeholder:e,spellcheck:"false","class":Ne+"-input block"}),a="prompt",d=[];if(i=i||0,1===i)s=oe("textarea",e,{placeholder:e.split("\n")[0],"class":Ne+"-textarea block",spellcheck:"false"});else if(2===i){for(U in e)d.push(oe("option",e[U],{value:U,selected:U===t||null}));s=oe("select",d,{"class":Ne+"-select block"})}return r=r||x,s.name="data",c.name="n",Jn(hn,s,function(n){return h=n.TE.key,m=n.TE.control,h("enter")&&0===i||m("enter")?g(n):h("escape")||h("backspace")&&!this.value?b(n):h("arrowdown")&&0===i||h("enter")&&2===i||m("arrowdown")?(o.focus(),Pn(n)):void 0}),Jn(hn,o,function(n){return h=n.TE.key,h("enter")?g(n):h("escape")?b(n):h("arrowup")?s.focus():h("arrowright")&&c.focus(),Pn(n)}),Jn(hn,c,function(n){return h=n.TE.key,h(/^(enter|escape)$/)?b(n):h("arrowup")?s.focus():h("arrowleft")&&o.focus(),Pn(n)}),Jn(ln,o,g),Jn(ln,c,b),Se.modal(a,Ft(n,s,[o,c]),u,f),v(),l},Se.drop=function(){Se.exit(0,0,0);var n=arguments,e=n[0],t=n[1],r=n[2];return 1===Hn(n)&&(e="default",t=n[0],r=n[1]),J=Xn(e),ae(Ye,0),Ce($,oe(Ye,!1,{"class":Ne+"-drop "+J})),L(t)?t(Ye):oe(Ye,t),Se.drop.fit(),r===!1||(Jn(ln,c,At),Jn(xn,o,At)),B=[l,Ye],_n("enter.drop."+e,B),_n("enter.drop",B),l},Se.drop.fit=function(n){return B=ee(T),D=ee(Ye),q=Se.drop.target,J=B.w/2-D.w/2,nn=B.h/2-D.h/2,!M(n)&&q&&(e=ne(q),J=e.l,nn=e.t+ee(q).h),F(n)?(M(n[0])&&(J=n[0]),M(n[1])&&(nn=n[1])):(J=d(J,0,B.w-D.w),nn=d(nn,0,Math.max(B.h,ee(o).h)-D.h)),a(Ye,{left:J+Tn,top:nn+Tn,visibility:"visible"}),B=[l,Ye],_n("fit.drop",B),_n("fit",B),l},Se.menu=function(n,t,r,i){var o,u=Se.tools,f=0;if(t===!1)return Se.tool(n,t);for(i in r)rn="%"===i[0],o=r[i],o=j(o)&&!rn?u[o]:o,o&&(o=ut(o,i,u),r[i]=o);return Se.tool(n,{i:F(t)?t[0]:0,text:F(t)?t[1]||0:t&&r[t]&&r[t].text||t,click:function(c){var s=Se.drop.target=u[n].target;return Se.drop("menu menu-"+Xn(n),function(c){function a(f){return nn=this,e=Un(nn,"tool-id"),Z=r[e],Z=j(Z)?u[Z]:Z||{},V=se(nn),!it(Z)&&L(i=Z.click)&&(i=i(f,l),Z.i&&(u[n].i=Z.i),Se.menu.set(n,F(Z.text)?[Z.text[0],e]:F(t)?[t[0],e]:e),i===!1)?(l.select(),Pn(f)):(l.select(),Pn(f))}function d(n){if(nn=this,(P=n.TE.key)("escape"))Se.exit(1);else if(P("enter"))Vn(ln,nn,[n]);else if(P("f10")&&s)s.focus();else if(P("arrowdown")&&(J=me(nn))){for(;!ye(J,"a")&&J;)J=me(J);J&&J.focus()}else if(P("arrowup")&&(J=ve(nn))){for(;!ye(J,"a")&&J;)J=ve(J);!J&&s?(Se.exit(),s.focus()):J&&J.focus()}else P("arrowup")&&s&&(Se.exit(),s.focus());return Pn(n)}for(i in r)if(o=r[i],rn="%"===i[0],o){var p={href:rn?null:jn,"class":Ne+"-"+(rn?"label":"button")};rn?K=Be[n]&&Be[n][+i.slice(1)-1]||i:(p.data={},p.data["tool-id"]=i,K=Oe[i]||i),X=o.text,X=F(X)?X[1]||"":X,K=F(K)?K[0]:K,G=oe(rn?"span":"a","<span>"+(rn?K||"%"+f:X||K)+"</span>",h(p,o.attributes||{})),re(G,"menu-"+Xn(i).replace(/[\/\s]/g,"-")),!p.title&&(nn=o.title)&&(G.title=F(nn)?nn[0]+(nn[1]?" ("+nn[1]+")":""):nn),rn?zn(G,{id:Ne+"-label:"+f}):(it(o)?re(G,"x"):ue(G,"x"),o.on?re(G,"on"):ue(G,"on"),Jn(ln,G,a),Jn(hn,G,d)),Ce(c,G),++f}g(function(){(be('[data-tool-id="'+Un(s,ct)+'"]',c)[0]||be("a",c)[0]).focus()},1)}),!1}},i),Wn(u[n].target,{"ui-drop":n}),u[n].data=r,Se.menu.set(n,t)},Se.menu.set=function(n,e){var u,f,t=Se.tools[n]||{},r=t.target,i=t.data;return r?(F(e)?Wn(r,ct,e[1]||""):(Wn(r,ct,e),e=i[e]&&i[e].text||e),F(e)?(f=e[0],f=Nn(f,"<")?f:Se.i(f,t.i),e=M(e[1])?e[1]:0,e=e&&i[e]&&i[e].text||e,e=f+(0!==e?"<span>"+(F(e)?e[1]||e:e)+"</span>":"")):f=Se.i(n,t.i),(u=be("."+Ne+"-text",r)[0])?(re(r,"text"),le(u,e)):(ue(r,"text"),le(r,f)),l):l},Se.bubble=function(){Se.exit(0,0,0);var n=arguments,e=n[0],t=n[1];return 1===Hn(n)&&(e="default",t=n[0]),J=Xn(e),ae(Qe,0),Ce($,oe(Qe,!1,{"class":Ne+"-bubble "+J})),L(t)?t(Qe):oe(Qe,t),Se.bubble.fit(),B=[l,Qe],_n("enter.bubble."+e,B),_n("enter.bubble",B),l},Se.bubble.fit=function(n){G=l.$(1),e=ne(Ke),W=a(Ke,"line-height");var t="border-",r="-width";J=G.caret[0].x+e.l-Ke.scrollLeft,nn=G.caret[1].y+e.t+W-Ke.scrollTop,D=a(Ie,[t+"top"+r,t+"bottom"+r,t+"left"+r,t+"right"+r]);var i=ee(Ie),u=ee(Qe),f=D[0]+D[1],o=D[2]+D[3];return F(n)?(M(n[0])&&(J=n[0]),M(n[1])&&(nn=n[1])):(J=d(J,e.l,e.l+i.w-u.w-o),nn=d(nn,e.t,e.t+i.h-u.h-f)),a(Qe,{left:J+Tn,top:nn+Tn,visibility:"visible"}),B=[l,Qe],_n("fit.bubble",B),_n("fit",B),l},Se.panel.exit=function(n){return Se.exit(n,"panel")},Se.overlay.exit=function(n){return Se.exit(n,"overlay")},Se.modal.exit=function(n){return Se.exit(n,"modal")},Se.drop.exit=function(n){return Se.exit(n,"drop")},Se.bubble.exit=function(n){return Se.exit(n,"bubble")},Se.tool=function(n,e,t){var r=Se.tools;return K="",P=M(r[n])?"update":"create","|"!==n&&(O.tools=Sn(O.tools).filter(function(e,t){return e===n?(K=t,!1):!0})),e===!1?(delete r[n],P="destroy"):("|"===n?(t=e,e={}):(L(e)&&(e={click:e}),r[n]=h(r[n]||{},e),M(t)||""===K||(t=K)),C(t)?O.tools.splice(t,0,n):O.tools.push(n)),_n(P+".tool."+n,[l,r[n]]),lt(),l},Se.separator=function(n,e){return Se.tool("|",n!==!1?{attributes:n||{}}:!1,e)},Se.key=function(n,e){var t=Se.keys;return P=M(t[n])?"update":"create",e===!1?(delete t[n],P="destroy"):t[n]=e,_n(P+".key."+n,[l,t[n]]),st(),l},Se.key.set=function(n){H[n]=1},Se.key.reset=function(n){n?delete H[n]:H={}},Se.tools={"|":{},undo:{i:"undo",click:function(n,e){return e.undo(),!1}},redo:{i:"repeat",click:function(n,e){return e.redo(),!1}},indent:function(n,e){return e.indent(Ln),!1},outdent:function(n,e){return e.outdent(Ln),!1}},Se.keys={"control+y":"redo","control+z":"undo",escape:function(n,e){return X=":not([tabindex]):not([disabled])",(G=be("input"+X+",button"+X+",select"+X+",textarea"+X+",a[href]"+X+",[contenteditable]"+X+',[tabindex]:not([tabindex="-1"])',c,0))&&-1!==(nn=G.indexOf(Ke))?((G[nn+1]||c).focus(),!1):void 0},f10:function(n,e){return be("a",Ue)[0].focus(),!1},tab:kn?"indent":0,"shift+tab":kn?"outdent":0},Se.el={container:ze,header:Re,body:Ie,footer:We,panel:Je,overlay:Ze,modal:Ve,drop:Ye,bubble:Qe},l.config=O,h(TE._,{time:function(n){var e=new Date(M(n)?n:Date.now()),t=e.getFullYear(),r=e.getMonth()+1,i=e.getDate(),u=e.getHours(),f=e.getMinutes(),o=e.getSeconds(),c=e.getMilliseconds();return 10>r&&(r="0"+r),10>i&&(i="0"+i),10>u&&(u="0"+u),10>f&&(f="0"+f),10>o&&(o="0"+o),10>c&&(c="0"+c),[""+t,""+r,""+i,""+u,""+f,""+o,""+c]},replace:Yn,format:Qn,dom:{set:Ce,reset:Fe,get:be,id:ce,copy:Ae,replace:Me,classes:{set:re,reset:ue,toggle:fe,get:ie},attributes:{set:zn,reset:In,get:Rn},data:{set:Wn,reset:Kn,get:Un},is:ye,offset:ne,pointer:Gn,size:ee,content:{set:le,reset:ae,get:se},closest:te,parent:de,children:pe,closest:he,next:me,previous:ve,index:ge,before:we,after:ke,prepend:Ee,append:Le},el:oe,event:{set:Jn,reset:Zn,fire:Vn,x:Pn}}),h(l._,TE._),h(l._,{hooks:b,hook:{set:Dn,reset:qn,fire:_n}}),l.create()};