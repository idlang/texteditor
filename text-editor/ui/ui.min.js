/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function de(e){return D(e)?a(e).split(/\s+/):e}function pe(e){return C(e)?e.join(" "):e}function Be(e,t,A){return H(e)?H(t)?(H(B[e])||(B[e]={}),H(A)||(A=Object.keys(B[e]).length),B[e][A]=t,I):B[e]:B}function Pe(e,t){return H(e)?H(t)&&H(B[e])?(delete B[e][t],I):(B[e]={},I):(B={},I)}function We(e,t,A){if(!H(B[e]))return B[e]={},I;if(H(A))H(B[e][A])&&B[e][A].apply(I,t);else for(y in B[e])B[e][y].apply(I,t);return I}function he(e,t,A){if(C(t))for(y in t)he(e,y,t[y]);else e.setAttribute(t,A)}function Ke(t,A,n){if(D(A))return Ke(t,[A],H(n)?n:"")[0];e=[];for(y in A)y=A[y],(y=t.getAttribute(y))&&e.push(y);return e.length?e:H(n)?n:[]}function me(e,t){if(C(t))for(y in t)me(e,t[y]);else if(H(t))e.removeAttribute(t);else for(me(e,"class"),y=0,k=e.attributes,w=k.length;w>y;++y)k[y]&&me(e,k[y].name)}function ge(e,t,A){if(C(t))for(y in t)ge(e,y,t[y]);else he(e,"data-"+t,A)}function be(t,A,n){if(D(A))return be(t,[A],H(n)?n:"")[0];e=[];for(y in A)y=A[y],(y=Ke(t,"data-"+y))&&e.push(y);return e.length?e:H(n)?n:[]}function Ye(e,t){if(C(t))for(y in t)me(e,"data-"+t[y]);else if(H(t))me(e,"data-"+t);else for(y=0,k=e.attributes,w=k.length;w>y;++y)k[y]&&"data-"===k[y].name.slice(0,5)&&me(e,k[y].name)}function ve(e){return e&&e.preventDefault(),!1}function $e(e,t,A){if(t){for(e=de(e),y=0,k=e.length;k>y;++y)t.addEventListener(e[y],A,!1),Be("on:"+e[y],A,et(t));return I}}function ye(e,t,A){if(t){for(e=de(e),y=0,k=e.length;k>y;++y)t.removeEventListener(e[y],A,!1),Pe("on:"+e[y],et(t));return u(t)&&t.id.split(":")[0]===Ct+"-dom"&&me(t,"id"),I}}function ke(e,t,A){e=de(e);var E,n="createEvent"in R;for(y=0,k=e.length;k>y;++y)n?(E=R.createEvent("HTMLEvents"),E.data=A,E.initEvent(e[y],!0,!1),t.dispatchEvent(E)):We("on:"+e[y],A,et(t));return I}function we(e,t,A){for(y=0,k=t.length,w;k>y;++y)w=t[y],e=e.replace(G(w)?w:l(o(w),"g"),A&&A[y]||"");return e}function Ve(e,t){return e.replace(/%(\d+)/g,function(e,A){return--A,H(t[A])?t[A]:e})}function xe(e){return a(we(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function _e(e,t){var A=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,E=Qe(e);return{x:A-E.l,y:n-E.t}}function Qe(e){for(V=e.offsetLeft,Z=e.offsetTop;e=e.offsetParent;)V+=e.offsetLeft,Z+=e.offsetTop;return{l:V,t:Z}}function Xe(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Je(e,t){for(;(e=Et(e))&&e!==t;);return e}function je(e,t){t=de(t);for(y in t)e.classList.add(t[y])}function Ze(t,A,n){if(D(A))return Ze(t,[A],H(n)?n:"")[0];e=[];for(y in A)y=A[y],t.classList.contains(y)&&e.push(y);return e.length?e:H(n)?n:!1}function ze(e,t){if(H(t)){t=de(t);for(y in t)e.classList.remove(t[y])}else me(e,"class")}function qe(e,t,A){if(e=D(e)?R.createElement(e):e,C(A))for(y in A)if(q=A[y],"classes"===y)je(e,q);else if("data"===y)for(k in q)q=q[k],null===q?Ye(e,k):ge(e,k,q);else"css"===y?D(q)?he(e,"style",q):null===q?me(e,"style"):N(e,q):c(q)?e[y]=q:null===q?me(e,y):he(e,y,C(q)?q.join(" "):""+q);if(u(t))at(e,t);else if(C(t))for(y in t)q=t[y],u(q)?at(e,q):q!==!1&&tt(e,q);else H(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=Ct+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function At(e,t){return e.innerHTML||(H(t)?t:"")}function nt(e,t){if(t!==!1&&(m=rt(e)))for(y=0,k=m.length;k>y;++y)nt(m[y]);tt(e,"")}function Et(e){return e&&e.parentNode}function rt(e){return e&&e.children||[]}function Ot(e){return e&&e.nextSibling}function Rt(e){return e&&e.previousSibling}function It(e,t){return e&&D(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&c(t)?e===t(e):e===t}function it(t,A){if(A=A||R,e=[],D(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=A.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=A.getElementsByClassName(t.slice(1)))||(t=A.getElementsByTagName(t))){for(y=0,k=t.length;k>y;++y)e.push(t[y]);return e}return[]}for(t=A.querySelectorAll(t),y=0,k=t.length;k>y;++y)e.push(t[y]);return e}return ot(t)?[t]:[]}function ot(e,t){var A=Et(e);return 1===arguments.length?A||!1:e&&A===e?A:!1}function Lt(e,t){Q=Et(e),Q&&Q.insertBefore(t,e)}function Nt(e,t){Q=Et(e),Q&&Q.insertBefore(t,Ot(e))}function Tt(e,t){m=rt(e)[0],m?Lt(m,t):at(e,t)}function lt(e,t){at(e,t)}function at(e,t){e.appendChild(t)}function ft(e,t){var A=ot(e);if(A){if(t!==!1)for(m=rt(e)[0];m;)ft(m);A.removeChild(e)}}function st(e){nt(qe(e,!1,{style:""})),ft(e)}function St(e,t,A){return qe(t||"div",A,{"class":e})}function Qt(e){return!e||H(e.active)&&!j.active}function Xt(){Mt._word&&Mt._words&&(q=(ht.value||"").replace(l(Ge[0]+"[^"+Ge[0]+Ge[1]+"]+?"+Ge[1],"g"),""),y=(q.match(/(\w+)/g)||[]).length,tt(yt,Ve(Mt["_word"+(1===y?"":"s")],[y])))}function Jt(e,t,A){return c(e)&&(e={click:e}),D(e.click)&&(e.click=(A[e.click]||{}).click),H(e.title)||(e.title=Gt[t]||""),A[t]=e,e}function jt(){nt(Wt,!1);var n,E,r,O,R,i,o,e=de(W.tools),t=Ct+"-button",A=Ct+"-separator";W.tools=e;for(i in e)o=e[i],E=ut.tools[o],(E||E==={})&&(E=Jt(E,o,ut.tools),r=E.i||o,"|"!==r&&"<"!==r[0]&&(r=xe(r)),O="|"!==r,R=xe(r).replace(/\s/g,""),xt=St(O?t+" "+t+"-"+R:A+" "+A+"-"+i,O?"a":"span"),O?(n=t+":"+R,he(xt,{href:Me,id:n,tabindex:-1}),ge(xt,He,o),r="<"===r[0]?r:'<i class="'+Ve(Ft,[r])+'"></i>',Qt(E)&&je(xt,"x"),E.text&&(r=Ve('<span class="'+Ct+'-text">'+E.text+"</span>",[r]),je(xt,"text")),tt(xt,r),qe(xt,!1,E.attributes||{}),!xt.title&&(k=E.title)&&(xt.title=C(k)?k[0]+(k[1]?" ("+k[1]+")":""):k),$e(Ne,xt,EA)):xt.id=A+":"+i,ut.tools[o].target=xt,at(Wt,xt));We("update.tools",[I])}function Zt(){ut.keys=function(){var A,e=Object.keys(ut.keys).sort().reverse(),t={};for(y=0,k=e.length;k>y;++y)A=e[y],t[A]=ut.keys[A];return t}(),AA(1),We("update.keys",[I])}function zt(e){Xt(),We("on:change",[e,I])}function tA(t){function T(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var A=I.$(),n=A.before,E=A.after,r=n.slice(-1),O=E[0],R=A.length,i=ut.keys,L=TE.keys_alias,N=(n.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();_=t.TE.key(),qt[_]=1,e=Object.keys(qt).length,f(function(){I.record()},1);for(y in i){w=T(y),m=0;for(k in w)k=w[k],qt[L[k]||k]&&++m;if(w=w.length,m===w&&e===w&&(D(i[y])&&(i[y]=ut.tools[i[y]].click),V=i[y]&&i[y](t,I),V===!1))return ve(t)}if(ce)for(y in ce)if(x=ce[y],x!==!1){if(_===x&&O===x)return"\\"===r?(I.insert(_,0),ve(t)):(I.select(A.end+1),ve(t));if(y===_)return I.wrap(y,x),ve(t);if(r===y&&O===x){if("backspace"===_&&n.slice(-2)!=="\\"+y)return I.unwrap(y,x),ve(t);if(ue&&"enter"===_&&y!==x)return I.tidy("\n"+N+Se,"\n"+N),ve(t)}}if(ue&&!R){if("backspace"===_&&l(o(Se)+"$").test(n))return I.outdent(Se),ve(t);if("enter"===_&&l("(^|\\n)("+o(Se)+")+.*$").test(n))return I.insert("\n"+N,0,1),ve(t)}}function AA(e){C(e)?delete qt[e.TE.key()]:qt={}}function nA(e){/^(focus|blur)$/.test(e.type)&&AA(1),s(eA),eA=f(function(){zt(e)},W.debounce||0)}function EA(e){ut.exit(0,0,0);var t=be(this,He),A=ut.tools,n=A[t];return Vt=e.currentTarget||e.target,!Qt(n)&&c(k=n.click)&&(k=k(e,I,t),We("on:change",[e,I,t]),k===!1)?ve(e):(I.select(),ve(e))}function iA(e){return rA=Kt,j=Xe(Pt),ve(e)}function oA(e){rA===Kt&&N(ht,{height:_e(Bt,e).y-j.h+Ue})}function LA(){rA=0}function NA(){ut.exit(1)}function TA(){e=Xe(bt),ee=e.w,$=e.h,e=Xe(gt),OA=e.w,RA=e.h}function lA(e,t){t&&We("exit.modal."+t,[I]),ke(Ne,gt,[e])}function aA(t){rA=t.target,e=_e(bt,t),te=e.x,Ae=e.y,TA()}function fA(t){var A=IA.header,n=IA.resize;rA===A||Je(rA,A)===A?(e=_e(Bt,t),V=e.x-te,Z=e.y-Ae,N(bt,{left:(ee>OA?V:T(V,0,OA-ee))+Ue,top:($>RA?Z:T(Z,0,RA-$))+Ue})):rA===n&&(e=_e(bt,t),j=Xe(n),N(bt,{width:e.x+j.w/4+Ue,height:e.y+j.h/4+Ue}))}function sA(){rA=0}function SA(e,t,A){return{header:e,body:t,footer:A}}function uA(e){h=Vt,K=Yt,m=e&&e.target||0,(!m||m!==h&&Je(m,h)!==h)&&(Vt=0,st(Yt),ye(Ne,R,uA),ye(ae,O,uA),ut.exit(e.target===p))}function FA(t){function A(){e&&(Q=Xe(e),N(J,{width:Q.w+Ue,height:Q.h+Ue}))}return q=I.get(),ee="",-1===q.indexOf("</html>")&&(ee='<!DOCTYPE html><html dir="'+W.dir+'"><head><meta charset="utf-8"><style>'+W.css+"</style></head><body>"+q+"</body></html>"),J=qe("iframe",!1,{"class":Ct+"-portal",src:"data:text/html,"+encodeURIComponent(ee)}),!ot(gt)&&q?ut.overlay(J,1,function(){e=rt(gt)[0],A(),$e(ae,O,A),We("enter.overlay.preview",[t,I,[q,ee],e])}):(ye(ae,O,A),NA()),ve(t)}var h,K,m,Y,$,y,k,w,V,x,_,e,Q,J,j,Z,q,ee,te,Ae,t="⌘",A="…",E="⇥",r="⇧",O=window,R=document,I=this,i=I._,o=i.x,L=i.extend,N=i.css,T=i.edge,l=i.pattern,a=i.trim,f=i.timer.set,s=i.timer.reset,S=I.is,u=S.e,c=S.f,F=S.i,C=S.o,G=S.r,D=S.s,H=function(e){return!S.x(e)},M=R.documentElement,d=(R.head,R.body),p=I.target,B={},P=function(){},W=L({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",E],outdent:["Outdent",r+"+"+E],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+A},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),Ee="keydown",re="keyup",Oe="copy",Re="cut",Ie="paste",ie="touchstart mousedown",oe="touchend mouseup",Le="touchmove mousemove",Ne="click",Te="focus",le="blur",ae="orientationchange resize",fe=le+" "+Oe+" "+Re+" "+Te+" input "+Ee+" "+Ie,se=W.languages,Se=W.tab,ue=W.auto_tab,ce=W.auto_close,Fe=W.unit[0][0],Ge=(W.unit[0][1],W.unit[1][0]),De=W.unit[1][1],He="tool-id",Me="javascript:;",Ue="px",ut=I.ui={};I.tidy=function(e,t){var A=I.$(),n=a(A.before)?e:"",E=a(A.after)?H(t)?t:e:"";return I.trim(n,E)},I.i=function(){return a(I.replace(/\s+/g," "))},I.format=function(e,t,A,n){C(e)||(e=[e]),H(A)||(A=" "),H(n)||(n="");var E=I.$(),r=(e[0]?Fe[0]+e[0]+Fe[1]:"")+n,O=n+(e[0]?Fe[0]+Fe[2]+(e[1]||e[0].split(l("("+De[3]+")+"))[0])+Fe[1]:""),R=o(r),i=o(O),L=l("^"+R+"([\\s\\S]*?)"+i+"$"),N=l(R+"$"),T=l("^"+i),a=E.before,f=E.after;return E.length?A=!1:I.insert(se.placeholders[""]).loss(),I.toggle(t?!L.test(E.value):!N.test(a)&&!T.test(f),[function(e){e.unwrap(r,O,1).tidy(l(Ge[0]+"[^"+Ge[0]+Ge[1]+Ge[2]+"]+?"+Ge[1]+"$").test(a)?"":A,l("^"+Ge[0]+Ge[2]+"[^"+Ge[0]+Ge[1]+"]+?"+Ge[1]).test(f)?"":A).loss().wrap(r,O,t)},function(e){e.unwrap(r,O,t)}])};var xt,ct=W.classes,Ft=ct.i,Ct=ct[""],Gt=se.tools,Dt=se.buttons,Ht=se.labels,Mt=se.others,Ut=Ct+"-textarea "+Ct+"-content block",dt=St(Ct),pt=St(Ct+"-header"),Bt=St(Ct+"-body"),Pt=St(Ct+"-footer"),Wt=St(Ct+"-tool"),ht=qe(p,!1,W.attributes),Kt=St(Ct+"-resize s"),mt=St(Ct+"-description"),gt=St(Ct+"-overlay"),bt=qe("div"),Yt=qe("div"),vt=qe("div"),$t=St("left","span"),yt=St("right","span"),kt=St(Ct+"-preview","a"),wt=0,Vt=0;W.suffix||(W.suffix=Fe[1]);var qt={},eA=null;I.create=function(e,t){C(e)&&(W=L(W,e));var A=ot(ht);return je(ht,Ut),A&&It(A,"p")?(Lt(A,dt),wt=A,ft(A,!1)):Lt(ht,dt),dt.dir=W.dir,at(dt,pt),at(dt,Bt),at(dt,Pt),at(dt,Kt),at(Bt,ht),W.tools&&(at(pt,Wt),at(Pt,mt),at(mt,$t),at(mt,yt)),$e(Ee,ht,tA),$e(re,ht,AA),$e(fe,ht,nA),$e(ie,Kt,iA),$e(Le,R,oA),$e(oe,d,LA),Mt.preview&&(j=Gt.preview,he(kt,{href:Me,title:C(j)?j[0]+(j[1]?" ("+j[1]+")":""):j}),at($t,kt),tt(kt,Mt.preview)),zt(null),jt(),Zt(),0!==t?We("create",[I]):I},I.update=function(e,t){return Ze(ht,de(Ut),0)&&I.destroy(0),(0!==t?We("update",[I]):I).create(e,0)},I.destroy=function(e){return Ze(ht,de(Ut),0)?(ut.exit(0,0,0),ze(ht,Ut),W.tools=pe(W.tools),W.keys&&(ye(Ee,ht,tA),ye(re,ht,AA)),ye(ie,Kt,iA),ye(Le,R,oA),ye(oe,R,LA),ye(fe,ht,nA),wt?(Lt(dt,wt),at(wt,ht),wt=0):Lt(dt,ht),st(dt),0!==e?We("destroy",[I]):I):I};var rA=0,te=0,Ae=0,ee=0,$=0,OA=0,RA=0,IA={};ut.exit=function(e,t,A){if(Y={overlay:function(){ye(Ne,gt,NA),st(gt)},modal:function(){ye(ie,Bt,aA),ye(Le,Bt,fA),ye(oe,R,sA),ye(Ne,IA.x,lA),st(bt)},drop:function(){st(Yt)},bubble:function(){st(vt)}},t)if(C(t))for(y in t)y=t[y],Y[y]&&Y[y](),0!==A&&We("exit."+y,[I]);else Y[t]&&Y[t](),0!==A&&We("exit."+y,[I]);else for(y in Y)Y[y]();return e&&I.select(),0!==A&&We("exit",[I]),I},ut.overlay=function(e,t,A){return ut.exit(0,0,0),AA(1),at(Bt,qe(gt,e.length||u(e)?St(Ct+"-overlay-content","div",e):"")),t&&$e(Ne,gt,NA),c(A)?A(gt):qe(gt,A),We("enter.overlay",[I]),We("enter",[I]),I},ut.overlay.fit=function(){},ut.modal=function(){ut.overlay("",1).blur();var e=arguments,t=e[0],A=e[1],n=e[2],E=Ct+"-modal";C(t)&&(t="default",A=e[0],n=e[1]),V=xe(t),qe(bt,!1,{"class":E+" "+V}),H(A.body)&&(A.body=qe("div",A.body,{"class":E+"-content "+V}));for(y in A)E[1]=y,IA[y]=St(E+"-"+Ve(y,E)+" "+V,0,A[y]);return IA.x=St(Ct+"-x "+V),IA.resize=St(Ct+"-resize se "+V),nt(bt),at(Bt,qe(bt,IA,{style:""})),ut.modal.fit(),Nt(bt,gt),$e(Ne,IA.x,lA),$e(ie,IA.header,ve),$e(ie,IA.resize,ve),$e(ie,Bt,aA),$e(Le,Bt,fA),$e(oe,R,sA),c(n)&&(IA.overlay=gt,IA.modal=bt,n(IA)),We("enter.modal."+t,[I]),We("enter.modal",[I]),We("enter",[I]),I},ut.modal.fit=function(e){return TA(),V=OA/2-ee/2,Z=RA/2-$/2,C(e)?(H(e[0])&&(V=e[0]),H(e[1])&&(Z=e[1])):(V=T(V,0),Z=T(Z,0)),N(bt,{left:V+Ue,top:Z+Ue,"min-width":ee+Ue,"min-height":$+Ue,visibility:"visible"}),We("fit.modal",[I]),We("fit",[I]),I};var cA={"class":Ct+"-button",name:"y"};return ut.alert=function(e,t,A,n){var E=qe("button",Dt.okay,cA),r="alert";return A=A||P,C(e)&&(r+=":"+e[0],e=e[1]||e[0]),$e(Ne,E,function(e){return A(e,I),lA(e,r+".y"),ve(e)}),$e(Ee,E,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(ke(Ne,E,[e]),ve(e)):void 0}),ut.modal(r,SA(e,t,E),n),E.focus(),I},ut.confirm=function(e,t,A,n,E){function o(e){return c(A)&&A(e,I),lA(e,R+".y"),ve(e)}function L(e){return c(n)&&n(e,I),lA(e,R+".n"),ve(e)}var i,r=qe("button",Dt.okay,cA),O=qe("button",Dt.cancel,cA),R="confirm";return O.name="n",C(e)&&(R+=":"+e[0],e=e[1]||e[0]),$e(Ne,r,o),$e(Ne,O,L),$e(Ee,r,function(e){return i=e.TE.key,i("arrowright")?(O.focus(),ve(e)):i("arrowleft")?ve(e):i("enter")?(o(e),ve(e)):i("escape")?(lA(e,R+".y"),ve(e)):void 0}),$e(Ee,O,function(e){return i=e.TE.key,i("arrowright")?ve(e):i("arrowleft")?(r.focus(),ve(e)):i("enter")?(L(e),ve(e)):i("escape")?(lA(e,R+".n"),ve(e)):void 0}),ut.modal(R,SA(e,t,[r,O]),E),O.focus(),I},ut.prompt=function(e,t,A,n,E,r){function l(){i.focus(),"placeholder"in i&&i.select()}function f(e){return ve(e)}function s(e){return N=i.value,!A||a(N)&&N!==t?(lA(e,o+".y"),ve(e),n(e,I,N!==t?N:"",t)):(l(),f(e))}function S(e){return lA(e,o+".n"),ve(e)}var N,T,O=qe("button",Dt.okay,cA),R=qe("button",Dt.cancel,cA),i=qe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Ct+"-input block"}),o="prompt",L=[];if(C(e)&&(o+=":"+e[0],e=e[1]||e[0]),c(E)&&(r=E,E=0),1===E)i=qe("textarea",t,{placeholder:t.split("\n")[0],"class":Ct+"-textarea block"});else if(2===E){for(y in t)L.push(qe("option",t[y],{value:y,selected:y===A||null}));i=qe("select",L,{"class":Ct+"-select block"})}return n=n||P,i.name="data",R.name="n",$e(Ee,i,function(e){return T=e.TE.key,T("enter")?s(e):T("escape")||T("backspace")&&!this.value?S(e):T("arrowup")?f(e):T("arrowdown")?(O.focus(),ve(e)):void 0}),$e(Ee,O,function(e){return T=e.TE.key,T("enter")?s(e):T("escape")?S(e):T("arrowup")?(i.focus(),ve(e)):T("arrowright")?(R.focus(),ve(e)):T(/^arrow(down|left)$/)?f(e):void 0}),$e(Ee,R,function(e){return T=e.TE.key,T(/^(enter|escape)$/)?S(e):T("arrowup")?(i.focus(),ve(e)):T(/^arrow(right|down)$/)?f(e):T("arrowleft")?(O.focus(),ve(e)):void 0}),$e(Ne,O,s),$e(Ne,R,S),ut.modal(o,SA(e,i,[O,R]),r),l(),I},ut.drop=function(){ut.exit(0,0,0);var e=arguments,t=e[0],A=e[1];return 1===e.length&&(t="default",A=e[0]),V=xe(t),nt(Yt),at(d,qe(Yt,!1,{"class":Ct+"-drop "+V})),c(A)?A(Yt):qe(Yt,A),ut.drop.fit(),$e(Ne,R,uA),$e(ae,O,uA),We("enter.drop."+t,[I]),We("enter.drop",[I]),I},ut.drop.fit=function(t){return h=Xe(M),K=Xe(Yt),V=h.w/2-K.w/2,Z=h.h/2-K.h/2,!H(t)&&Vt&&(e=Qe(Vt),V=e.l,Z=e.t+Xe(Vt).h),C(t)?(H(t[0])&&(V=t[0]),H(t[1])&&(Z=t[1])):(V=T(V,0,Math.max(h.w,O.innerWidth)-K.w),Z=T(Z,0,Math.max(h.h,O.innerHeight)-K.h)),N(Yt,{left:V+Ue,top:Z+Ue,visibility:"visible"}),We("fit.drop",[I]),We("fit",[I]),I},ut.menu=function(e,t,A,n){t=!C(t)&&A[t]&&A[t].text||t;var R,E='<span class="'+Ct+'-current menu">%1</span>',r="",O=0;return t===!1?ut.tool(e,t):(C(t)&&(r=t[0],r="<"===r[0]?r:'<i class="'+Ve(Ft,[r])+'"></i>',t=H(t[1])?t[1]:0,t=t&&A[t]&&A[t].text||t,E=r+(0!==t?" "+E:"")),ut.tool(e,{i:r,text:t?Ve(E,[t,r]):0,click:function(i){return ut.drop("menu menu-"+xe(e),function(i){function o(e){return R=this,x=A[be(R,He)],x=D(x)?ut.tools[x]:x||{},_=At(R),!Qt(x)&&c(n=x.click)&&(n=n(e,I),t!==!1&&Vt&&(j=rt(Vt)[0]||Vt,It(j,"i")||tt(j,Ve(E,[_,r])),C(x.text)&&(Z=rt(j)[0])&&It(Z,"i")&&(ze(Z),je(Z,Ve(Ft,[x.text[0]])))),n===!1)?ve(e):(I.select(),ve(e))}function N(e){if(R=this,(w=e.TE.key)("escape"))return ut.exit(1),ve(e);if(w("arrowdown")&&(V=Ot(R))){for(;!It(V,"a")&&V;)V=Ot(V);return V&&V.focus(),ve(e)}if(w("arrowup")&&(V=Rt(R))){for(;!It(V,"a")&&V;)V=Rt(V);return V&&V.focus(),ve(e)}}for(n in A)if(R=A[n],ee="%"===n[0],R=D(R)&&!ee?ut.tools[R]:R){R=Jt(R,n,ut.tools);var T={href:ee?null:Me,"class":Ct+"-"+(ee?"label":"button")};ee?k=Ht[e]&&Ht[e][+n.slice(1)-1]||n:(T.data={},T.data[He]=n,k=Gt[n]||n),J=R.text,J=C(J)?J[1]||"":J,k=C(k)?k[0]:k,j=qe(ee?"span":"a",ee?"<span>"+(k||"%"+O)+"</span>":R.text||k,L(T,R.attributes||{})),!j.title&&(Z=R.title)&&(j.title=C(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z),ee?he(j,{id:Ct+"-label:"+O}):(Qt(R)&&je(j,"x"),$e(Ne,j,o),$e(Ee,j,N)),A[n]=R,at(i,j),++O}f(function(){it("a",i)[0].focus()},1)}),!1}},n),ut.tools[e].data=A,I)},ut.bubble=function(){ut.exit(0,0,0);var e=arguments,t=e[0],A=e[1];return 1===e.length&&(t="default",A=e[0]),V=xe(t),nt(vt),at(d,qe(vt,!1,{"class":Ct+"-bubble "+V})),c(A)?A(vt):qe(vt,A),ut.bubble.fit(),We("enter.bubble."+t,[I]),We("enter.bubble",[I]),I},ut.bubble.fit=function(t){j=I.$(1),e=Qe(ht),$=N(ht,"line-height");var A="border-",n="-width";V=j.caret[0].x+e.l-ht.scrollLeft,Z=j.caret[1].y+e.t+$-ht.scrollTop,K=N(Bt,[A+"top"+n,A+"bottom"+n,A+"left"+n,A+"right"+n]);var E=Xe(Bt),r=Xe(vt),O=K[0]+K[1],R=K[2]+K[3];return C(t)?(H(t[0])&&(V=t[0]),H(t[1])&&(Z=t[1])):(V=T(V,e.l,e.l+E.w-r.w-R),Z=T(Z,e.t,e.t+E.h-r.h-O)),N(vt,{left:V+Ue,top:Z+Ue,visibility:"visible"}),We("fit.bubble",[I]),We("fit",[I]),I},ut.overlay.exit=function(e){return ut.exit(e,"overlay")},ut.modal.exit=function(e){return ut.exit(e,"modal")},ut.drop.exit=function(e){return ut.exit(e,"drop")},ut.bubble.exit=function(e){return ut.exit(e,"bubble")},ut.tool=function(e,t,A){return k="","|"!==e&&(W.tools=W.tools.filter(function(t,A){return t===e?(k=A,!1):!0})),t===!1?delete ut.tools[e]:("|"===e?(A=t,t={}):(c(t)&&(t={click:t}),ut.tools[e]=L(ut.tools[e]||{},t),H(A)||""===k||(A=k)),F(A)?W.tools.splice(A,0,e):W.tools.push(e)),jt(),I},ut.key=function(e,t){return W.keys?(t===!1?delete ut.keys[e]:ut.keys[e]=t,Zt(),I):I},ut.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Se),!1},outdent:function(e,t){return t.outdent(Se),!1}},$e(Ne,kt,FA),ut.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return FA(e)},"shift+tab":ue?"outdent":0,tab:ue?"indent":0,escape:function(e,t){return kt.focus(),!1}},ut.el={container:dt,header:pt,body:Bt,footer:Pt,overlay:gt,modal:bt,drop:Yt,bubble:vt},I.config=W,L(I._,{time:function(){var e=new Date,t=e.getFullYear(),A=e.getMonth()+1,n=e.getDate(),E=e.getHours(),r=e.getMinutes(),O=e.getSeconds(),R=e.getMilliseconds();return 10>A&&(A="0"+A),10>n&&(n="0"+n),10>E&&(E="0"+E),10>r&&(r="0"+r),10>O&&(O="0"+O),10>R&&(R="0"+R),[""+t,""+A,""+n,""+E,""+r,""+O,""+R]},replace:we,format:Ve,dom:{set:at,reset:ft,get:it,id:et,copy:function(e,t){return e.cloneNode(H(t)?t:!0)},classes:{set:je,reset:ze,get:Ze},attributes:{set:he,reset:me,get:Ke},data:{set:ge,reset:Ye,get:be},is:It,offset:Qe,point:_e,size:Xe,content:{set:tt,reset:nt,get:At},closest:Je,parent:Et,children:rt,next:Ot,previous:Rt,before:Lt,after:Nt,prepend:Tt,append:lt},el:qe,event:{set:$e,reset:ye,fire:ke,x:ve},hooks:B,hook:{set:Be,reset:Pe,fire:We}}),ut};