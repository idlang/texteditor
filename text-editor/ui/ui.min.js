/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function qe(e){return x(e)?h(e).split(/\s+/):e}function Ee(e){return v(e)?e.join(" "):e}function Le(e,t,n){return w(e)?w(t)?(w(L[e])||(L[e]={}),w(n)||(n=Object.keys(L[e]).length),L[e][n]=t,f):L[e]:L}function ze(e,t){return w(e)?w(t)&&w(L[e])?(delete L[e][t],f):(L[e]={},f):(L={},f)}function Se(e,t,n){if(!w(L[e]))return L[e]={},f;if(w(n))w(L[e][n])&&L[e][n].apply(f,t);else for(A in L[e])L[e][A].apply(f,t);return f}function Ce(e,t,n){if(v(t))for(A in t)Ce(e,A,t[A]);else e.setAttribute(t,n)}function Oe(t,n,r){if(x(n))return Oe(t,[n],w(r)?r:"")[0];e=[];for(A in n)A=n[A],(A=t.getAttribute(A))&&e.push(A);return e.length?e:w(r)?r:[]}function He(e,t){if(v(t))for(A in t)He(e,t[A]);else if(w(t))e.removeAttribute(t);else for(He(e,"class"),A=0,D=e.attributes,B=D.length;B>A;++A)D[A]&&He(e,D[A].name)}function Ie(e,t,n){if(v(t))for(A in t)Ie(e,A,t[A]);else Ce(e,"data-"+t,n)}function je(t,n,r){if(x(n))return je(t,[n],w(r)?r:"")[0];e=[];for(A in n)A=n[A],(A=Oe(t,"data-"+A))&&e.push(A);return e.length?e:w(r)?r:[]}function Re(e,t){if(v(t))for(A in t)He(e,"data-"+t[A]);else if(w(t))He(e,"data-"+t);else for(A=0,D=e.attributes,B=D.length;B>A;++A)D[A]&&"data-"===D[A].name.slice(0,5)&&He(e,D[A].name)}function Me(e){return e&&e.preventDefault(),!1}function Ue(e,t,n){if(t){for(e=qe(e),A=0,D=e.length;D>A;++A)t.addEventListener(e[A],n,!1),Le("on:"+e[A],n,et(t));return f}}function Ae(e,t,n){if(t){for(e=qe(e),A=0,D=e.length;D>A;++A)t.removeEventListener(e[A],n,!1),ze("on:"+e[A],et(t));return m(t)&&t.id.split(":")[0]===xt+"-dom"&&He(t,"id"),f}}function De(e,t,n){e=qe(e);var o,r="createEvent"in s;for(A=0,D=e.length;D>A;++A)r?(o=s.createEvent("HTMLEvents"),o.data=n,o.initEvent(e[A],!0,!1),t.dispatchEvent(o)):Se("on:"+e[A],n,et(t));return f}function Be(e,t){return setTimeout(e,t)}function Fe(e){return clearTimeout(e)}function Ke(e,t,n){for(A=0,D=t.length,B;D>A;++A)B=t[A],e=e.replace(y(B)?B:b(u(B),"g"),n&&n[A]||"");return e}function Ne(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,w(t[n])?t[n]:e})}function We(e){return h(Ke(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Pe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,o=Ye(e);return{x:n-o.l,y:r-o.t}}function Ye(e){for(F=e.offsetLeft,X=e.offsetTop;e=e.offsetParent;)F+=e.offsetLeft,X+=e.offsetTop;return{l:F,t:X}}function Ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Xe(e,t){for(;(e=ot(e))&&e!==t;);return e}function Qe(e,t){t=qe(t);for(A in t)e.classList.add(t[A])}function Ge(t,n,r){if(x(n))return Ge(t,[n],w(r)?r:"")[0];e=[];for(A in n)A=n[A],t.classList.contains(A)&&e.push(A);return e.length?e:w(r)?r:!1}function Je(e,t){if(w(t)){t=qe(t);for(A in t)e.classList.remove(t[A])}else He(e,"class")}function Ve(e,t,n){if(e=x(e)?s.createElement(e):e,v(n))for(A in n)if(G=n[A],"classes"===A)Qe(e,G);else if("data"===A)for(D in G)G=G[D],null===G?Re(e,D):Ie(e,D,G);else"css"===A?x(G)?Ce(e,"style",G):null===G?He(e,"style"):p(e,G):k(G)?e[A]=G:null===G?He(e,A):Ce(e,A,v(G)?G.join(" "):""+G);if(m(t))ht(e,t);else if(v(t))for(A in t)G=t[A],m(G)?ht(e,G):G!==!1&&tt(e,G);else w(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=xt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(w(t)?t:"")}function rt(e,t){if(t!==!1&&(H=it(e)))for(A=0,D=H.length;D>A;++A)rt(H[A]);tt(e,"")}function ot(e){return e&&e.parentNode}function it(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function st(e){return e&&e.previousSibling}function ft(e,t){return e&&x(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&k(t)?e===t(e):e===t}function ct(t,n){if(n=n||s,e=[],x(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(A=0,D=t.length;D>A;++A)e.push(t[A]);return e}return[]}for(t=n.querySelectorAll(t),A=0,D=t.length;D>A;++A)e.push(t[A]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=ot(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function at(e,t){W=ot(e),W&&W.insertBefore(t,e)}function pt(e,t){W=ot(e),W&&W.insertBefore(t,lt(e))}function dt(e,t){H=it(e)[0],H?at(H,t):ht(e,t)}function bt(e,t){ht(e,t)}function ht(e,t){e.appendChild(t)}function gt(e,t){var n=ut(e);if(n){if(t!==!1)for(H=it(e)[0];H;)gt(H);n.removeChild(e)}}function mt(e){rt(Ve(e,!1,{style:""})),gt(e)}function kt(e,t,n){return Ve(t||"div",n,{"class":e})}function Yt(e){return!e||w(e.active)&&!Z.active}function Zt(){qt._word&&qt._words&&(G=(Ht.value||"").replace(b(ye[0]+"[^"+ye[0]+ye[1]+"]+?"+ye[1],"g"),""),A=(G.match(/(\w+)/g)||[]).length,tt(Bt,Ne(qt["_word"+(1===A?"":"s")],[A])))}function Xt(e,t,n){return k(e)&&(e={click:e}),x(e.click)&&(e.click=(n[e.click]||{}).click),w(e.title)||(e.title=wt[t]||""),n[t]=e,e}function Qt(){rt(Ot,!1);var r,o,i,l,s,c,e=qe(S.tools),t=xt+"-button",n=xt+"-separator";S.tools=e;for(s in e)c=e[s],o=$t.tools[c],(o||o==={})&&(o=Xt(o,c,$t.tools),i=o.i||c,"|"!==i&&"<"!==i[0]&&(i=We(i)),l="|"!==i,Wt=kt(l?t:n,l?"a":"span"),l?(r=t+":"+We(c).replace(/\s/g,""),Ce(Wt,{href:Te,id:r,tabindex:-1}),Ie(Wt,we,c),i="<"===i[0]?i:'<i class="'+Ne(yt,[i])+" "+r+'"></i>',Yt(o)&&Qe(Wt,"x"),o.text&&(i=Ne('<span class="'+xt+'-text">'+o.text+"</span>",[i]),Qe(Wt,"text")),tt(Wt,i),Ve(Wt,!1,o.attributes||{}),!Wt.title&&(D=o.title)&&(Wt.title=v(D)?D[0]+(D[1]?" ("+D[1]+")":""):D),Ue(ue,Wt,on)):Wt.id=xt+"-separator:"+s,$t.tools[c].target=Wt,ht(Ot,Wt));Se("update.tools",[f])}function Gt(){$t.keys=function(){var n,e=Object.keys($t.keys).sort().reverse(),t={};for(A=0,D=e.length;D>A;++A)n=e[A],t[n]=$t.keys[n];return t}(),nn(1),Se("update.keys",[f])}function Jt(e){Zt(),Se("on:change",[e,f])}function tn(t){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=f.$(),r=n.before,o=n.after,i=r.slice(-1),l=o[0],s=n.length,c=$t.keys,a=TE.keys_alias,p=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();N=t.TE.key(),Vt[N]=1,e=Object.keys(Vt).length,Be(function(){f.record()},1);for(A in c){B=d(A),H=0;for(D in B)D=B[D],Vt[a[D]||D]&&++H;if(B=B.length,H===B&&e===B&&(x(c[A])&&(c[A]=$t.tools[c[A]].click),F=c[A]&&c[A](t,f),F===!1))return Me(t)}if(ke)for(A in ke)if(K=ke[A],K!==!1){if(N===K&&l===K)return"\\"===i?(f.insert(N,0),Me(t)):(f.select(n.end+1),Me(t));if(A===N)return f.wrap(A,K),Me(t);if(i===A&&l===K){if("backspace"===N&&r.slice(-2)!=="\\"+A)return f.unwrap(A,K),Me(t);if(me&&"enter"===N&&A!==K)return f.tidy("\n"+p+ge,"\n"+p).scroll(!0),Me(t)}}if(me&&!s){if("backspace"===N&&b(u(ge)+"$").test(r))return f.outdent(ge).scroll(!0),Me(t);if("enter"===N&&b("(^|\\n)("+u(ge)+")+.*$").test(r))return f.insert("\n"+p,0,1).scroll(!0),Me(t)}}function nn(e){v(e)?delete Vt[e.TE.key()]:Vt={}}function rn(e){/^focus|blur$/.test(e.type)&&nn(1),Fe(en),en=Be(function(){Jt(e)},S.debounce||0)}function on(e){$t.exit(0,0,0);var t=je(this,we),n=$t.tools,r=n[t];return Nt=e.currentTarget||e.target,!Yt(r)&&k(D=r.click)&&(D=D(e,f,t),Se("on:change",[e,f,t]),D===!1)?Me(e):(f.select(),Me(e))}function un(e){return ln=It,Z=Ze(Ct),Me(e)}function an(e){ln===It&&p(Ht,{height:Pe(St,e).y-Z.h+_e})}function pn(){ln=0}function dn(){$t.exit(1)}function bn(){e=Ze(Mt),J=e.w,U=e.h,e=Ze(Rt),sn=e.w,fn=e.h}function hn(e,t){t&&Se("exit.modal."+t,[f]),De(ue,Rt,[e])}function gn(t){ln=t.target,e=Pe(Mt,t),V=e.x,ee=e.y,bn()}function mn(t){var n=cn.header,r=cn.resize;ln===n||Xe(ln,n)===n?(e=Pe(St,t),F=e.x-V,X=e.y-ee,p(Mt,{left:(J>sn?F:d(F,0,sn-J))+_e,top:(U>fn?X:d(X,0,fn-U))+_e})):ln===r&&(e=Pe(Mt,t),Z=Ze(r),p(Mt,{width:e.x+Z.w/4+_e,height:e.y+Z.h/4+_e}))}function kn(){ln=0}function $n(e,t,n){return{header:e,body:t,footer:n}}function vn(e){C=Nt,O=Ut,H=e&&e.target||0,(!H||H!==C&&Xe(H,C)!==C)&&(Nt=0,mt(Ut),Ae(ue,s,vn),Ae(de,l,vn),$t.exit(e.target===E))}function xn(t){function n(){e&&(W=Ze(e),p(Y,{width:W.w+_e,height:W.h+_e}))}return G=f.get(),J="",-1===G.indexOf("</html>")&&(J='<!DOCTYPE html><html dir="'+S.dir+'"><head><meta charset="utf-8"><style>'+S.css+"</style></head><body>"+G+"</body></html>"),Y=Ve("iframe",!1,{"class":xt+"-portal",src:"data:text/html,"+encodeURIComponent(J)}),!ut(Rt)&&G?$t.overlay(Y,1,function(){e=it(Rt)[0],n(),Ue(de,l,n),Se("enter.overlay.preview",[t,f,[G,J],e])}):(Ae(de,l,n),dn()),Me(t)}var C,O,H,R,U,A,D,B,F,K,N,e,W,Y,Z,X,G,J,V,ee,t="⌘",n="…",o="⇥",i="⇧",l=window,s=document,f=this,c=f._,u=c.x,a=c.extend,p=c.css,d=c.edge,b=c.pattern,h=c.trim,g=f.is,m=g.e,k=g.f,$=g.i,v=g.o,y=g.r,x=g.s,w=function(e){return!g.x(e)},T=s.documentElement,q=(s.head,s.body),E=f.target,L={},z=function(){},S=a({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",o],outdent:["Outdent",i+"+"+o],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ne="keydown",re="keyup",oe="copy",ie="cut",le="paste",se="touchstart mousedown",fe="touchend mouseup",ce="touchmove mousemove",ue="click",ae="focus",pe="blur",de="orientationchange resize",be=pe+" "+oe+" "+ie+" "+ae+" input "+ne+" "+le,he=S.languages,ge=S.tab,me=S.auto_tab,ke=S.auto_close,$e=S.unit[0][0],ye=(S.unit[0][1],S.unit[1][0]),xe=S.unit[1][1],we="tool-id",Te="javascript:;",_e="px",$t=f.ui={};f.tidy=function(e,t){var n=f.$(),r=h(n.before)?e:"",o=h(n.after)?w(t)?t:e:"";return f.trim(r,o)},f.i=function(){return h(f.replace(/\s+/g," "))},f.format=function(e,t,n,r){v(e)||(e=[e]),w(n)||(n=" "),w(r)||(r="");var o=f.$(),i=(e[0]?$e[0]+e[0]+$e[1]:"")+r,l=r+(e[0]?$e[0]+$e[2]+(e[1]||e[0].split(b("("+xe[3]+")+"))[0])+$e[1]:""),s=u(i),c=u(l),a=b("^"+s+"([\\s\\S]*?)"+c+"$"),p=b(s+"$"),d=b("^"+c),h=o.before,g=o.after;return o.length?n=!1:f.insert(he.placeholders[""]).loss(),f.toggle(t?!a.test(o.value):!p.test(h)&&!d.test(g),[function(e){e.unwrap(i,l,1).tidy(b(ye[0]+"[^"+ye[0]+ye[1]+ye[2]+"]+?"+ye[1]+"$").test(h)?"":n,b("^"+ye[0]+ye[2]+"[^"+ye[0]+ye[1]+"]+?"+ye[1]).test(g)?"":n).loss().wrap(i,l,t)},function(e){e.unwrap(i,l,t)}])};var Wt,vt=S.classes,yt=vt.i,xt=vt[""],wt=he.tools,Tt=he.buttons,_t=he.labels,qt=he.others,Et=xt+"-textarea "+xt+"-content block",Lt=kt(xt),zt=kt(xt+"-header"),St=kt(xt+"-body"),Ct=kt(xt+"-footer"),Ot=kt(xt+"-tool"),Ht=Ve(E,!1,S.attributes),It=kt(xt+"-resize s"),jt=kt(xt+"-description"),Rt=kt(xt+"-overlay"),Mt=Ve("div"),Ut=Ve("div"),At=Ve("div"),Dt=kt("left","span"),Bt=kt("right","span"),Ft=kt(xt+"-preview","a"),Kt=0,Nt=0;S.suffix||(S.suffix=$e[1]);var Vt={},en=null;f.create=function(e,t){v(e)&&(S=a(S,e));var n=ut(Ht);return Qe(Ht,Et),n&&ft(n,"p")?(at(n,Lt),Kt=n,gt(n,!1)):at(Ht,Lt),Lt.dir=S.dir,ht(Lt,zt),ht(Lt,St),ht(Lt,Ct),ht(Lt,It),ht(St,Ht),S.tools&&(ht(zt,Ot),ht(Ct,jt),ht(jt,Dt),ht(jt,Bt)),Ue(ne,Ht,tn),Ue(re,Ht,nn),Ue(be,Ht,rn),Ue(se,It,un),Ue(ce,s,an),Ue(fe,q,pn),qt.preview&&(Z=wt.preview,Ce(Ft,{href:Te,title:v(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z}),ht(Dt,Ft),tt(Ft,qt.preview)),Jt(null),Qt(),Gt(),0!==t?Se("create",[f]):f},f.update=function(e,t){return Ge(Ht,qe(Et),0)&&f.destroy(0),(0!==t?Se("update",[f]):f).create(e,0)},f.destroy=function(e){return Ge(Ht,qe(Et),0)?($t.exit(0,0,0),Je(Ht,Et),S.tools=Ee(S.tools),S.keys&&(Ae(ne,Ht,tn),Ae(re,Ht,nn)),Ae(se,It,un),Ae(ce,s,an),Ae(fe,s,pn),Ae(be,Ht,rn),Kt?(at(Lt,Kt),ht(Kt,Ht),Kt=0):at(Lt,Ht),mt(Lt),0!==e?Se("destroy",[f]):f):f};var ln=0,V=0,ee=0,J=0,U=0,sn=0,fn=0,cn={};$t.exit=function(e,t,n){if(R={overlay:function(){Ae(ue,Rt,dn),mt(Rt)},modal:function(){Ae(se,St,gn),Ae(ce,St,mn),Ae(fe,s,kn),Ae(ue,cn.x,hn),mt(Mt)},drop:function(){mt(Ut)},bubble:function(){mt(At)}},t)if(v(t))for(A in t)A=t[A],R[A]&&R[A](),0!==n&&Se("exit."+A,[f]);else R[t]&&R[t](),0!==n&&Se("exit."+A,[f]);else for(A in R)R[A]();return e&&f.select(),0!==n&&Se("exit",[f]),f},$t.overlay=function(e,t,n){return $t.exit(0,0,0),nn(1),ht(St,Ve(Rt,e.length||m(e)?kt(xt+"-overlay-content","div",e):"")),t&&Ue(ue,Rt,dn),k(n)?n(Rt):Ve(Rt,n),Se("enter.overlay",[f]),Se("enter",[f]),f},$t.overlay.fit=function(){},$t.modal=function(){$t.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],o=xt+"-modal";v(t)&&(t="default",n=e[0],r=e[1]),F=We(t),Ve(Mt,!1,{"class":o+" "+F}),w(n.body)&&(n.body=Ve("div",n.body,{"class":o+"-content "+F}));for(A in n)o[1]=A,cn[A]=kt(o+"-"+Ne(A,o)+" "+F,0,n[A]);return cn.x=kt(xt+"-x "+F),cn.resize=kt(xt+"-resize se "+F),rt(Mt),ht(St,Ve(Mt,cn,{style:""})),$t.modal.fit(),pt(Mt,Rt),Ue(ue,cn.x,hn),Ue(se,cn.header,Me),Ue(se,cn.resize,Me),Ue(se,St,gn),Ue(ce,St,mn),Ue(fe,s,kn),k(r)&&(cn.overlay=Rt,cn.modal=Mt,r(cn)),Se("enter.modal."+t,[f]),Se("enter.modal",[f]),Se("enter",[f]),f},$t.modal.fit=function(e){return bn(),F=sn/2-J/2,X=fn/2-U/2,v(e)?(F=e[0],X=e[1]):(F=d(F,0),X=d(X,0)),p(Mt,{left:F+_e,top:X+_e,"min-width":J+_e,"min-height":U+_e,visibility:"visible"}),Se("fit.modal",[f]),Se("fit",[f]),f};var yn={"class":xt+"-button",name:"y"};return $t.alert=function(e,t,n,r){var o=Ve("button",Tt.okay,yn),i="alert";return n=n||z,v(e)&&(i+=":"+e[0],e=e[1]||e[0]),Ue(ue,o,function(e){return n(e,f),hn(e,i+".y"),Me(e)}),Ue(ne,o,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(De(ue,o,[e]),Me(e)):void 0}),$t.modal(i,$n(e,t,o),r),o.focus(),f},$t.confirm=function(e,t,n,r,o){function u(e){return k(n)&&n(e,f),hn(e,s+".y"),Me(e)}function a(e){return k(r)&&r(e,f),hn(e,s+".n"),Me(e)}var c,i=Ve("button",Tt.okay,yn),l=Ve("button",Tt.cancel,yn),s="confirm";return l.name="n",v(e)&&(s+=":"+e[0],e=e[1]||e[0]),Ue(ue,i,u),Ue(ue,l,a),Ue(ne,i,function(e){return c=e.TE.key,c("arrowright")?(l.focus(),Me(e)):c("arrowleft")?Me(e):c("enter")?(u(e),Me(e)):c("escape")?(hn(e,s+".y"),Me(e)):void 0}),Ue(ne,l,function(e){return c=e.TE.key,c("arrowright")?Me(e):c("arrowleft")?(i.focus(),Me(e)):c("enter")?(a(e),Me(e)):c("escape")?(hn(e,s+".n"),Me(e)):void 0}),$t.modal(s,$n(e,t,[i,l]),o),l.focus(),f},$t.prompt=function(e,t,n,r,o,i){function d(){c.focus(),"placeholder"in c&&c.select()}function b(e){return Me(e)}function g(e){return Z=c.value,!n||h(Z)&&Z!==t?(hn(e,u+".y"),Me(e),r(e,f,Z!==t?Z:"",t)):(d(),b(e))}function m(e){return hn(e,u+".n"),Me(e)}var p,l=Ve("button",Tt.okay,yn),s=Ve("button",Tt.cancel,yn),c=Ve("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":xt+"-input block"}),u="prompt",a=[];if(v(e)&&(u+=":"+e[0],e=e[1]||e[0]),k(o)&&(i=o,o=0),1===o)c=Ve("textarea",t,{placeholder:t.split("\n")[0],"class":xt+"-textarea block"});else if(2===o){for(A in t)a.push(Ve("option",t[A],{value:A,selected:A===n||null}));c=Ve("select",a,{"class":xt+"-select block"})}return r=r||z,c.name="data",s.name="n",Ue(ne,c,function(e){return p=e.TE.key,p("enter")?g(e):p("escape")||p("backspace")&&!this.value?m(e):p("arrowup")?b(e):p("arrowdown")?(l.focus(),Me(e)):void 0}),Ue(ne,l,function(e){return p=e.TE.key,p("enter")?g(e):p("escape")?m(e):p("arrowup")?(c.focus(),Me(e)):p("arrowright")?(s.focus(),Me(e)):p(/^arrow(down|left)$/)?b(e):void 0}),Ue(ne,s,function(e){return p=e.TE.key,p(/^enter|escape$/)?m(e):p("arrowup")?(c.focus(),Me(e)):p(/^arrow(right|down)$/)?b(e):p("arrowleft")?(l.focus(),Me(e)):void 0}),Ue(ue,l,g),Ue(ue,s,m),$t.modal(u,$n(e,c,[l,s]),i),d(),f},$t.drop=function(){$t.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),F=We(t),rt(Ut),ht(q,Ve(Ut,!1,{"class":xt+"-drop "+F})),k(n)?n(Ut):Ve(Ut,n),$t.drop.fit(),Ue(ue,s,vn),Ue(de,l,vn),Se("enter.drop."+t,[f]),Se("enter.drop",[f]),f},$t.drop.fit=function(t){return C=Ze(T),O=Ze(Ut),F=C.w/2-O.w/2,X=C.h/2-O.h/2,!w(t)&&Nt&&(e=Ye(Nt),F=e.l,X=e.t+Ze(Nt).h),v(t)?(F=t[0],X=t[1]):(F=d(F,0,Math.max(C.w,l.innerWidth)-O.w),X=d(X,0,Math.max(C.h,l.innerHeight)-O.h)),p(Ut,{left:F+_e,top:X+_e,visibility:"visible"}),Se("fit.drop",[f]),Se("fit",[f]),f},$t.menu=function(e,t,n,r){t=!v(t)&&n[t]&&n[t].text||t;var s,o='<span class="'+xt+'-current menu">%1</span>',i="",l=0;return t===!1?$t.tool(e,t):(v(t)&&(i=t[0],i="<"===i[0]?i:'<i class="'+Ne(yt,[i])+'"></i>',t=w(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,o=i+(0!==t?" "+o:"")),$t.tool(e,{i:i,text:t?Ne(o,[t,i]):0,click:function(c){return $t.drop("menu menu-"+We(e),function(c){function u(e){return s=this,K=n[je(s,we)],K=x(K)?$t.tools[K]:K||{},N=nt(s),!Yt(K)&&k(r=K.click)&&(r=r(e,f),t!==!1&&Nt&&(Z=it(Nt)[0]||Nt,ft(Z,"i")||tt(Z,Ne(o,[N,i])),v(K.text)&&(X=it(Z)[0])&&ft(X,"i")&&(Je(X),Qe(X,Ne(yt,[K.text[0]])))),r===!1)?Me(e):(f.select(),Me(e))}function p(e){if(s=this,(B=e.TE.key)("escape"))return $t.exit(1),Me(e);if(B("arrowdown")&&(F=lt(s))){for(;!ft(F,"a")&&F;)F=lt(F);return F&&F.focus(),Me(e)}if(B("arrowup")&&(F=st(s))){for(;!ft(F,"a")&&F;)F=st(F);return F&&F.focus(),Me(e)}}for(r in n)if(s=n[r],J="%"===r[0],s=x(s)&&!J?$t.tools[s]:s){s=Xt(s,r,$t.tools);var d={href:J?null:Te,"class":xt+"-"+(J?"label":"button")};J?D=_t[e]&&_t[e][+r.slice(1)-1]||r:(d.data={},d.data[we]=r,D=wt[r]||r),Y=s.text,Y=v(Y)?Y[1]||"":Y,D=v(D)?D[0]:D,Z=Ve(J?"span":"a",J?"<span>"+(D||"%"+l)+"</span>":s.text||D,a(d,s.attributes||{})),!Z.title&&(X=s.title)&&(Z.title=v(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),J?Ce(Z,{id:xt+"-label:"+l}):(Yt(s)&&Qe(Z,"x"),Ue(ue,Z,u),Ue(ne,Z,p)),n[r]=s,ht(c,Z),++l}Be(function(){ct("a",c)[0].focus()},1)}),!1}},r),$t.tools[e].data=n,f)},$t.bubble=function(){$t.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),F=We(t),rt(At),ht(q,Ve(At,!1,{"class":xt+"-bubble "+F})),k(n)?n(At):Ve(At,n),$t.bubble.fit(),Se("enter.bubble."+t,[f]),Se("enter.bubble",[f]),f},$t.bubble.fit=function(t){Z=f.$(1),e=Ye(Ht),U=p(Ht,"line-height");var n="border-",r="-width";F=Z.caret[0].x+e.l-Ht.scrollLeft,X=Z.caret[1].y+e.t+U-Ht.scrollTop,O=p(St,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var o=Ze(St),i=Ze(At),l=O[0]+O[1],s=O[2]+O[3];return v(t)?(F=t[0],X=t[1]):(F=d(F,e.l,e.l+o.w-i.w-s),X=d(X,e.t,e.t+o.h-i.h-l)),p(At,{left:F+_e,top:X+_e,visibility:"visible"}),Se("fit.bubble",[f]),Se("fit",[f]),f},$t.overlay.exit=function(e){return $t.exit(e,"overlay")},$t.modal.exit=function(e){return $t.exit(e,"modal")},$t.drop.exit=function(e){return $t.exit(e,"drop")},$t.bubble.exit=function(e){return $t.exit(e,"bubble")},$t.tool=function(e,t,n){return D="","|"!==e&&(S.tools=S.tools.filter(function(t,n){return t===e?(D=n,!1):!0})),t===!1?delete $t.tools[e]:("|"===e?(n=t,t={}):(k(t)&&(t={click:t}),$t.tools[e]=a($t.tools[e]||{},t),w(n)||""===D||(n=D)),$(n)?S.tools.splice(n,0,e):S.tools.push(e)),Qt(),f},$t.key=function(e,t){return S.keys?(t===!1?delete $t.keys[e]:$t.keys[e]=t,Gt(),f):f},$t.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ge),!1},outdent:function(e,t){return t.outdent(ge),!1}},Ue(ue,Ft,xn),$t.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return xn(e)},"shift+tab":me?"outdent":0,tab:me?"indent":0,escape:function(e,t){return Ft.focus(),!1}},$t.el={container:Lt,header:zt,body:St,footer:Ct,overlay:Rt,modal:Mt,drop:Ut,bubble:At},f.config=S,a(f._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),o=e.getHours(),i=e.getMinutes(),l=e.getSeconds(),s=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>o&&(o="0"+o),10>i&&(i="0"+i),10>l&&(l="0"+l),10>s&&(s="0"+s),[""+t,""+n,""+r,""+o,""+i,""+l,""+s]},replace:Ke,format:Ne,dom:{set:ht,reset:gt,get:ct,id:et,copy:function(e,t){return e.cloneNode(w(t)?t:!0)},classes:{set:Qe,reset:Je,get:Ge},attributes:{set:Ce,reset:He,get:Oe},data:{set:Ie,reset:Re,get:je},offset:Ye,point:Pe,size:Ze,content:{set:tt,reset:rt,get:nt},closest:Xe,parent:ot,children:it,next:lt,previous:st,before:at,after:pt,prepend:dt,append:bt},el:Ve,event:{set:Ue,reset:Ae,fire:De,x:Me},hooks:L,hook:{set:Le,reset:ze,fire:Se}}),$t};