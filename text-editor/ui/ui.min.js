/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.5.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Re(e){return R(e)?m(e).split(/\s+/):e}function Fe(e){return T(e)?e.join(" "):e}function Le(e){return e.length}function De(e){return Object.keys(e)}function Me(e){return Le(De(e))}function Ce(e,t,n){return z(e)?z(t)?(z(v[e])||(v[e]={}),z(n)||(n=Me(v[e])),v[e][n]=t,o):v[e]:v}function je(e,t){return z(e)?z(t)&&z(v[e])?(delete v[e][t],o):(v[e]={},o):(v={},o)}function He(e,t,n){if(!z(v[e]))return v[e]={},o;if(z(n))z(v[e][n])&&v[e][n].apply(o,t);else for(I in v[e])v[e][I].apply(o,t);return o}function Oe(e,t,n){if(T(t))for(I in t)Oe(e,I,t[I]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Se(e,n,i){if(R(n))return Se(e,[n],z(i)?i:"")[0];t=[];for(I in n)I=n[I],(I=e.getAttribute(I))&&t.push(I);return Le(t)?t:z(i)?i:[]}function Ae(e,t){if(T(t))for(I in t)Ae(e,t[I]);else if(z(t))e.removeAttribute(t);else for(Ae(e,"class"),I=0,K=e.attributes,P=Le(K);P>I;++I)K[I]&&Ae(e,K[I].name)}function Be(e,t,n){if(T(t))for(I in t)Be(e,I,t[I]);else Oe(e,"data-"+t,n)}function Ne(e,n,i){if(R(n))return Ne(e,[n],z(i)?i:"")[0];t=[];for(I in n)I=n[I],(I=Se(e,"data-"+I))&&t.push(I);return Le(t)?t:z(i)?i:[]}function Ye(e,t){if(T(t))for(I in t)Ae(e,"data-"+t[I]);else if(z(t))Ae(e,"data-"+t);else for(I=0,K=e.attributes,P=Le(K);P>I;++I)K[I]&&"data-"===K[I].name.slice(0,5)&&Ae(e,K[I].name)}function Ie(e){return e&&e.preventDefault(),!1}function Ke(e,t,n){if(t){for(e=Re(e),I=0,K=Le(e);K>I;++I)t.addEventListener(e[I],n,!1),Ce("on:"+e[I],n,rt(t));return o}}function Pe(e,t,n){if(t){for(e=Re(e),I=0,K=Le(e);K>I;++I)t.removeEventListener(e[I],n,!1),je("on:"+e[I],rt(t));return k(t)&&t.id.split(":")[0]===zt+"-dom"&&Ae(t,"id"),o}}function Xe(e,t,n){e=Re(e);var r,i="createEvent"in s;for(I=0,K=Le(e);K>I;++I)i?(r=s.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[I],!0,!1),t.dispatchEvent(r)):He("on:"+e[I],n,rt(t));return o}function We(e,t,n){for(I=0,K=Le(t),P;K>I;++I)P=t[I],e=e.replace($(P)?P:h(p(P),"g"),n&&n[I]||"");return e}function Ue(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,z(t[n])?t[n]:e})}function Ze(e){return m(We(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function qe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ve(e);return{x:n-r.l,y:i-r.t}}function Ve(e){for(X=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)X+=e.offsetLeft,J+=e.offsetTop;return{l:X,t:J}}function Ge(e){return e===f?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function Je(e,t){for(;(e=st(e))&&e!==t;);return e}function Qe(e,t){t=Re(t);for(I in t)e.classList.add(t[I])}function et(e,n,i){if(R(n))return et(e,[n],z(i)?i:"")[0];t=[];for(I in n)I=n[I],e.classList.contains(I)&&t.push(I);return Le(t)?t:z(i)?i:!1}function tt(e,t){if(z(t)){t=Re(t);for(I in t)e.classList.remove(t[I])}else Ae(e,"class")}function nt(e,t){t=Re(t);for(I in t)e.classList.toggle(t[I])}function it(e,t,n){if(e=R(e)?s.createElement(e):e,T(n))for(I in n)if(ee=n[I],"classes"===I)Qe(e,ee);else if("data"===I)for(K in ee)ee=ee[K],null===ee?Ye(e,K):Be(e,K,ee);else"css"===I?R(ee)?Oe(e,"style",ee):null===ee?Ae(e,"style"):u(e,ee):w(ee)?e[I]=ee:null===ee?Ae(e,I):Oe(e,I,T(ee)?ee.join(" "):""+ee);if(k(t))xt(e,t);else if(T(t))for(I in t)ee=t[I],k(ee)?xt(e,ee):ee!==!1&&lt(e,ee);else z(t)&&t!==!1&&lt(e,t);return e}function rt(e){var t=e.id;return t||(t=zt+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function lt(e,t){e.innerHTML=t}function at(e,t){return e.innerHTML||(z(t)?t:"")}function ft(e,t){if(t!==!1&&(O=ot(e)))for(I=0,K=Le(O);K>I;++I)ft(O[I]);lt(e,"")}function st(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function ct(e){return e&&e.nextSibling}function ut(e){return e&&e.previousSibling}function dt(e){for(I=0;e=ut(e);)++I;return I}function pt(e,t){return e&&R(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&w(t)?e===t(e):e===t}function bt(e,n){if(!(n=z(n)?n:s))return[];if(t=[],R(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(I=0,K=Le(e);K>I;++I)t.push(e[I]);return t}return[]}for(e=n.querySelectorAll(e),I=0,K=Le(e);K>I;++I)t.push(e[I]);return t}return ht(e)?[e]:[]}function ht(e,t){var n=st(e);return 1===Le(arguments)?n||!1:e&&n===e?n:!1}function yt(e,t){Z=st(e),Z&&Z.insertBefore(t,e)}function gt(e,t){Z=st(e),Z&&Z.insertBefore(t,ct(e))}function mt(e,t){O=ot(e)[0],O?yt(O,t):xt(e,t)}function vt(e,t){xt(e,t)}function xt(e,t){e.appendChild(t)}function _t(e,t){var n=ht(e);if(n){if(t!==!1)for(O=ot(e)[0];O;)_t(O);n.removeChild(e)}}function kt(e){ft(it(e,!1,{style:""})),_t(e)}function wt(e,t,n){return it(t||"div",n,{"class":e})}function Vt(e){return!e||z(e.active)&&!e.active}function Gt(){return St.disabled||St.readOnly}function Jt(e,t,n){return w(e)&&(e={click:e}),R(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Rt[t]||"",z(e.attributes)||(e.attributes={}),n[t]=e,e}function Qt(e){if(Gt())return St.focus(),Ie(e);Et.exit(0,0,0);var t=Ne(this,"tool-id"),n=Et.tools,i=n[t];return Et.drop.target=e.currentTarget||e.target,!Vt(i)&&w(K=i.click)&&(K=K(e,o,t),He("on:change",[e,o,t]),K===!1)?Ie(e):(o.select(),Ie(e))}function en(e){if(J=this,(P=e.TE.key)(/^(escape|f10)$/))Et.exit(1);else if(P("enter")||P("arrowdown")&&Ne(J,"ui-drop"))Et.drop.target=J,Xe(ae,J,[e]);else if(P("arrowright")&&(X=ct(J))){for(;!pt(X,"a")&&X;)X=ct(X);X&&X.focus()}else if(P("arrowleft")&&(X=ut(J))){for(;!pt(X,"a")&&X;)X=ut(X);X&&X.focus()}return Ie(e)}function tn(){ft(Ot,!1);var r,l,a,f,s,c,u,e=Et.tools,t=Re(M.tools),n=zt+"-button",i=zt+"-separator";M.tools=t;for(c in t)u=t[c],l=e[u],(l||l==={})&&(l=Jt(l,u,e),a=l.i||u,"|"!==a&&"<"!==a[0]&&(a=Ze(a)),f="|"!==a,s=Ze(u).replace(/[\/\s]/g,"-"),Zt=wt(f?n+" "+n+"-"+s:i+" "+i+"-"+c,f?"a":"span"),f?(Zt=l.target||Zt,r=n+":"+s,Oe(Zt,{href:$e,id:r,tabindex:-1}),Be(Zt,"tool-id",u),a="<"===a[0]?a:'<i class="'+Ue($t,[s,a])+'"></i>',Vt(l)?Qe(Zt,"x"):tt(Zt,"x"),l.on?Qe(Zt,"on"):tt(Zt,"on"),l.text&&(a=Ue('<span class="'+zt+'-text">'+l.text+"</span>",[a]),Qe(Zt,"text")),lt(Zt,a),it(Zt,!1,l.attributes),!l.attributes.title&&(K=l.title)&&(Zt.title=T(K)?K[0]+(K[1]?" ("+K[1]+")":""):K),Ke(ae,Zt,Qt),Ke(ue,Zt,en)):Zt.id=i+":"+c,l.target=Zt,xt(Ot,Zt));He("update.tools",[o])}function nn(){Et.keys=function(){var n,e=De(Et.keys).sort().reverse(),t={};for(I=0,K=Le(e);K>I;++I)n=e[I],t[n]=Et.keys[n];return t}(),ln(),He("update.keys",[o])}function rn(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}if(Gt())return St.focus(),Ie(e);var n=o.$(),i=n.before,r=n.after,l=i.slice(-1),a=r[0],f=n.length,s=Et.keys,c=TE.keys_alias,u=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();U=e.TE.key(),C[U]=1,t=Me(C),g(function(){o.record()});for(I in s){P=d(I),O=0;for(K in P)K=P[K],C[c[K]||K]&&++O;if(P=Le(P),O===P&&t===P&&(R(s[I])&&(s[I]=Et.tools[s[I]].click),X=s[I]&&s[I](e,o),X===!1))return Ie(e)}if(me)for(I in me)if(W=me[I],W!==!1){if(U===W&&a===W)return"\\"===l?(o.insert(U,0),Ie(e)):(o.select(n.end+1),Ie(e));if(I===U)return o.wrap(I,W),Ie(e);if(l===I&&a===W){if("backspace"===U&&i.slice(-2)!=="\\"+I)return o.unwrap(I,W),Ie(e);if(ve&&"enter"===U&&I!==W)return o.tidy("\n"+u+_e,"\n"+u).scroll(1),Ie(e)}}if(ve&&!f){if("backspace"===U&&h(p(_e)+"$").test(i))return o.outdent(_e),Ie(e);if("enter"===U&&h("(^|\\n)("+p(_e)+")+.*$").test(i))return o.insert("\n"+u,0,1).scroll(1),Ie(e)}}function ln(e){e&&e.TE&&e.TE.key?delete C[e.TE.key()]:C={}}function cn(e){return an=At,G=Ge(Ht),Ie(e)}function un(e){an===At&&u(St,{height:qe(jt,e).y-G.h+ze})}function dn(){an=0}function pn(){Et.exit(1)}function bn(){t=Ge(It),te=t.w,Y=t.h,t=Ge(Yt),fn=t.w,sn=t.h}function hn(e,t){t&&He("exit.modal."+t,[o]),Xe(ae,Yt,[e])}function yn(e){an=e.target,t=qe(It,e),ne=t.x,ie=t.y,bn()}function gn(e){var n=on.header,i=on.resize;an===n||Je(an,n)===n?(t=qe(jt,e),X=t.x-ne,J=t.y-ie,u(It,{left:(te>fn?X:d(X,0,fn-te))+ze,top:(Y>sn?J:d(J,0,sn-Y))+ze})):an===i&&(t=qe(It,e),G=Ge(i),u(It,{width:t.x+G.w/4+ze,height:t.y+G.h/4+ze}))}function mn(){an=0}function vn(e,t,n){return{header:e,body:t,footer:n}}function xn(e){j=Et.drop.target,H=Kt,O=e&&e.target||0,(!O||O!==j&&Je(O,j)!==j)&&(Et.drop.target=0,kt(Kt),Pe(ae,s,xn),Pe(ge,f,xn),Et.exit(e.target===St))}var j,H,O,B,Y,I,K,P,X,W,U,t,Z,V,G,J,ee,te,ne,ie,n="⌘",i="…",l="⇥",a="⇧",f=window,s=document,o=new TE(e),c=o._,u=c.css,d=c.edge,p=c.x,b=c.extend,h=c.pattern,g=(c.timer.reset,c.timer.set),m=c.trim,v={},x=function(){},_=TE.is,k=_.e,w=_.f,E=_.i,T=_.o,$=_.r,z=function(e){return!_.x(e)},R=_.s,F=s.documentElement,D=(s.head,s.body),M=b({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",l],outdent:["Outdent",a+"+"+l]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"icon icon-%1 icon-%1--%2 fa fa-%2"}},t),C={},le="blur",ae="click",ue="keydown",de="keyup",pe="touchstart mousedown",be="touchmove mousemove",he="touchend mouseup",ge="orientationchange resize",me=M.auto_close,ve=M.auto_tab,xe=M.languages,_e=M.tab,we=(M.unit[0][1],M.unit[0][0]),Ee=M.unit[1][1],Te=M.unit[1][0],$e="javascript:;",ze="px",Et=o.ui={};o.tidy=function(e,t){var n=o.$(),i=m(n.before)?e:"",r=m(n.after)?z(t)?t:e:"";return o.trim(i,r)},o.i=function(){return m(o.replace(/\s+/g," "))},o.format=function(e,t,n,i){T(e)||(e=[e]),z(n)||(n=" "),z(i)||(i="");var r=o.h,l=o[0]().$(),a=(e[0]?we[0]+e[0]+we[1]:"")+i,f=i+(e[0]?we[0]+we[2]+(e[1]||e[0].split(h("("+Ee[3]+")+"))[0])+we[1]:""),s=p(a),c=p(f),u=h("^"+s+"([\\s\\S]*?)"+c+"$"),d=h(s+"$"),b=h("^"+c),y=l.before,g=l.after;return l.length?n=!1:o.insert(xe.placeholders[""]),o.toggle(t?!u.test(l.value):!d.test(y)&&!b.test(g),[function(e){e.unwrap(a,f,1).tidy(h(Te[0]+"[^"+Te[0]+Te[1]+Te[2]+"]+?"+Te[1]+"$").test(y)?"":n,h("^"+Te[0]+Te[2]+"[^"+Te[0]+Te[1]+"]+?"+Te[1]).test(g)?"":n).wrap(a,f,t)},function(e){e.unwrap(a,f,t)}])[r]()};var Zt,Tt=M.classes,$t=Tt.i,zt=Tt[""],Rt=xe.tools,Ft=xe.buttons,Lt=xe.labels,Dt=zt+"-textarea "+zt+"-content block",Mt=wt(zt),Ct=wt(zt+"-header"),jt=wt(zt+"-body"),Ht=wt(zt+"-footer"),Ot=wt(zt+"-tool"),St=it(e,!1,M.attributes),At=wt(zt+"-resize s"),Bt=wt(zt+"-description"),Nt=wt(zt+"-panel"),Yt=wt(zt+"-overlay"),It=it("div"),Kt=it("div"),Pt=it("div"),Xt=wt("left","span"),Wt=wt("right","span"),Ut=0;z(M.suffix)||(M.suffix=we[1]);var an=0,ne=0,ie=0,te=0,Y=0,fn=0,sn=0,on={};o.create=function(e,t){T(e)&&(M=b(M,e));var n=ht(St);return Qe(Mt,zt+"-is-can-update"),Qe(Mt,zt+"-is-can-copy"),Qe(St,Dt),n&&pt(n,"p")?(yt(n,Mt),Ut=n,_t(n,!1)):yt(St,Mt),Mt.dir=M.dir,xt(Mt,Ct),xt(Mt,jt),xt(Mt,Ht),xt(jt,St),M.tools&&(xt(Ct,Ot),xt(Ht,Bt),xt(Bt,Xt),xt(Bt,Wt)),Ke(ue,St,rn),Ke(de+" "+le,St,ln),M.resize&&(xt(Mt,At),Qe(Mt,zt+"-is-can-resize"),Ke(pe,At,cn),Ke(be,s,un),Ke(he,D,dn)),tn(),nn(),0!==t?He("create",[o]):o},o.update=function(e,t){return et(St,Re(Dt),0)&&o.destroy(0),(0!==t?He("update",[o]):o).create(e,0)},o.destroy=function(e){return et(St,Re(Dt),0)?(Et.exit(0,0,0),tt(St,Dt),M.tools=Fe(M.tools),M.keys&&(Pe(ue,St,rn),Pe(de,St,ln)),M.resize&&(Pe(pe,At,cn),Pe(be,s,un),Pe(he,s,dn)),Ut?(yt(Mt,Ut),xt(Ut,St),Ut=0):yt(Mt,St),kt(Mt),0!==e?He("destroy",[o]):o):o},o.enable=function(e){return St.disabled=St.readOnly=!1,Qe(Mt,zt+"-is-can-update"),Qe(Mt,zt+"-is-can-copy"),0!==e?He("enable",[o]):o},o.disable=function(e){return St.disabled=!0,tt(Mt,zt+"-is-can-update"),tt(Mt,zt+"-is-can-copy"),0!==e?He("disable",[o]):o},o.freeze=function(e){return St.disabled=!1,St.readOnly=!0,tt(Mt,zt+"-is-can-update"),Qe(Mt,zt+"-is-can-copy"),0!==e?He("freeze",[o]):o},Et.exit=function(e,t,n){if(B={panel:function(){kt(Nt)},overlay:function(){Pe(ae,Yt,pn),kt(Yt)},modal:function(){Pe(pe,jt,yn),Pe(be,jt,gn),Pe(he,s,mn),Pe(ae,on.x,hn),kt(It)},drop:function(){kt(Kt)},bubble:function(){kt(Pt)}},ln(),t)if(T(t))for(I in t)I=t[I],B[I]&&B[I](),0!==n&&He("exit."+I,[o]);else B[t]&&B[t](),0!==n&&He("exit."+I,[o]);else for(I in B)B[I]();return e&&o.select(),0!==n&&He("exit",[o]),o},Et.panel=function(e,t){function n(){Pe(ae,ne,n),Et.panel.exit(1)}return Et.exit(0,0,0),ne=wt(zt+"-x"),ne.title=Ft.close,Ke(ae,ne,n),ft(Nt),xt(jt,it(Nt,[wt(zt+"-panel-content","div",e),ne])),w(t)?t(Nt):it(Nt,t),He("enter.panel",[o]),He("enter",[o]),o},Et.panel.fit=function(){},Et.overlay=function(e,t){return Et.exit(0,0,0),xt(jt,Yt),e&&Ke(ae,Yt,pn),w(t)?t(Yt):it(Yt,t),He("enter.overlay",[o]),He("enter",[o]),o},Et.overlay.fit=function(){},Et.modal=function(){Et.overlay(1).blur();var a,f,e=arguments,t=e[0],n=e[1],i=e[2],r=zt+"-modal",l=n.footer;if(T(t)&&(t="default",n=e[0],i=e[1]),X=Ze(t),it(It,!1,{"class":r+" "+X}),z(n.body)&&(n.body=it("div",n.body,{"class":r+"-content "+X})),z(l)&&T(l)&&!k(l)){f=[];for(I in l)K=l[I],k(K)?f.push(K):(K=Jt(K,I,l),t=I.text||Ft[I]||I,a=it("button",t,b({name:"y["+I+"]",type:"button","class":zt+"-button",data:{"button-id":I}},K.attributes)),Ke(ae,a,function(e){return t=l[Ne(this,"button-id")].click(e,o),t===!1?Ie(e):void 0}),f.push(a));n.footer=f}for(I in n)r[1]=I,on[I]=wt(r+"-"+Ue(I,r)+" "+X,0,n[I]);return on.x=wt(zt+"-x "+X),on.resize=wt(zt+"-resize se "+X),ft(It),on.x.title=Ft.close,xt(jt,it(It,on,{style:""})),Et.modal.fit(),gt(It,Yt),Ke(ae,on.x,hn),Ke(pe,on.header,Ie),Ke(pe,on.resize,Ie),Ke(pe,jt,yn),Ke(be,jt,gn),Ke(he,s,mn),w(i)&&(on.overlay=Yt,on.modal=It,i(on)),He("enter.modal."+t,[o]),He("enter.modal",[o]),He("enter",[o]),o},Et.modal.fit=function(e){return bn(),X=fn/2-te/2,J=sn/2-Y/2,T(e)?(z(e[0])&&(X=e[0]),z(e[1])&&(J=e[1])):(X=d(X,0),J=d(J,0)),u(It,{left:X+ze,top:J+ze,"min-width":te+ze,"min-height":Y+ze,visibility:"visible"}),He("fit.modal",[o]),He("fit",[o]),o};var _n={"class":zt+"-button",name:"y"};return Et.alert=function(e,t,n,i){var r=it("button",Ft.okay,_n),l="alert";return n=n||x,T(e)&&(l+=":"+e[0],e=e[1]||e[0]),Ke(ae,r,function(e){return n(e,o),hn(e,l+".y"),Ie(e)}),Ke(ue,r,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Xe(ae,r,[e]),Ie(e)}),Et.modal(l,vn(e,t,r),i),r.focus(),o},Et.confirm=function(e,t,n,i,r){function c(e){return w(n)&&n(e,o),hn(e,f+".y"),Ie(e)}function u(e){return w(i)&&i(e,o),hn(e,f+".n"),Ie(e)}var s,l=it("button",Ft.okay,_n),a=it("button",Ft.cancel,_n),f="confirm";return a.name="n",T(e)&&(f+=":"+e[0],e=e[1]||e[0]),Ke(ae,l,c),Ke(ae,a,u),Ke(ue,l,function(e){return s=e.TE.key,s("arrowright")?a.focus():s("enter")?c(e):s("escape")&&hn(e,f+".y"),Ie(e)}),Ke(ue,a,function(e){return s=e.TE.key,s("arrowleft")?l.focus():s("enter")?u(e):s("escape")&&hn(e,f+".n"),Ie(e)}),Et.modal(f,vn(e,t,[l,a]),r),a.focus(),o},Et.prompt=function(e,t,n,i,r,l){function h(){s.focus(),"placeholder"in s&&s.select()}function y(e){d=s.value,w(n)&&!n(d)?h():!n||m(d)&&d!==t?(hn(e,c+".y"),i(e,o,d!==t?d:"",t)):h()}function g(e){hn(e,c+".n")}var d,p,b,a=it("button",Ft.okay,_n),f=it("button",Ft.cancel,_n),s=it("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":zt+"-input block"}),c="prompt",u=[];if(T(e)&&(c+=":"+e[0],e=e[1]||e[0]),w(r)&&(l=r,r=0),1===r)s=it("textarea",t,{placeholder:t.split("\n")[0],"class":zt+"-textarea block",spellcheck:"false"});else if(2===r){for(I in t)u.push(it("option",t[I],{value:I,selected:I===n||null}));s=it("select",u,{"class":zt+"-select block"})}return i=i||x,s.name="data",f.name="n",Ke(ue,s,function(e){return p=e.TE.key,b=e.TE.control,p("enter")&&1!==r||b("enter")?(y(e),Ie(e)):p("escape")||p("backspace")&&!this.value?(g(e),Ie(e)):p("arrowdown")&&1!==r&&2!==r||b("arrowdown")?(a.focus(),Ie(e)):void 0}),Ke(ue,a,function(e){return p=e.TE.key,p("enter")?y(e):p("escape")?g(e):p("arrowup")?s.focus():p("arrowright")&&f.focus(),Ie(e)}),Ke(ue,f,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?g(e):p("arrowup")?s.focus():p("arrowleft")&&a.focus(),Ie(e)}),Ke(ae,a,y),Ke(ae,f,g),Et.modal(c,vn(e,s,[a,f]),l),h(),o},Et.drop=function(){Et.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===Le(e)&&(t="default",n=e[0],i=e[1]),X=Ze(t),ft(Kt),xt(D,it(Kt,!1,{"class":zt+"-drop "+X})),w(n)?n(Kt):it(Kt,n),Et.drop.fit(),i!==!1&&Ke(ae,s,xn),Ke(ge,f,xn),He("enter.drop."+t,[o]),He("enter.drop",[o]),o},Et.drop.fit=function(e){return j=Ge(F),H=Ge(Kt),O=Et.drop.target,X=j.w/2-H.w/2,J=j.h/2-H.h/2,!z(e)&&O&&(t=Ve(O),X=t.l,J=t.t+Ge(O).h),T(e)?(z(e[0])&&(X=e[0]),z(e[1])&&(J=e[1])):(X=d(X,0,j.w-H.w),J=d(J,0,Math.max(j.h,Ge(f).h)-H.h)),u(Kt,{left:X+ze,top:J+ze,visibility:"visible"}),He("fit.drop",[o]),He("fit",[o]),o},Et.menu=function(e,n,i,r){var u,l='<span class="'+zt+'-current menu">%1</span>',a="",f=n,s=Et.tools,c=0;if(n=!T(n)&&i[n]&&i[n].text||n,n===!1)return Et.tool(e,n);T(n)&&(a=n[0],a="<"===a[0]?a:'<i class="'+Ue($t,[Ze(e).replace(/[\/\s]/g,"-"),a])+'"></i>',n=f=z(n[1])?n[1]:0,n=n&&i[n]&&i[n].text||n,l=a+(0!==n?" "+l:""));for(r in i)te="%"===r[0],u=i[r],u=R(u)&&!te?s[u]:u,u&&(u=Jt(u,r,s),i[r]=u);return Et.tool(e,{i:a,text:n?Ue(l,[n,a]):0,click:function(f){var d=Et.drop.target=s[e].target;return Et.drop("menu menu-"+Ze(e),function(f){function p(e){return J=this,t=Ne(J,"tool-id"),W=i[t],W=R(W)?s[W]:W||{},U=at(J),!Vt(W)&&w(r=W.click)&&(r=r(e,o),n!==!1&&d&&(O=ot(d)[0]||d,pt(O,"i")||lt(O,Ue(l,[U,a])),T(W.text)&&(O=ot(O)[0])&&pt(O,"i")&&(tt(O),Qe(O,Ue($t,[W.text[0]])))),Be(d,"ui-drop-menu",t),r===!1)?(o.select(),Ie(e)):(o.select(),Ie(e))}function h(e){if(J=this,(P=e.TE.key)("escape"))Et.exit(1);else if(P("enter"))Xe(ae,J,[e]);else if(P("f10")&&d)d.focus();else if(P("arrowdown")&&(X=ct(J))){for(;!pt(X,"a")&&X;)X=ct(X);X&&X.focus()}else if(P("arrowup")&&(X=ut(J))){for(;!pt(X,"a")&&X;)X=ut(X);!X&&d?(Et.exit(),d.focus()):X&&X.focus()}else P("arrowup")&&d&&(Et.exit(),d.focus());return Ie(e)}for(r in i)if(u=i[r],te="%"===r[0],u){var y={href:te?null:$e,"class":zt+"-"+(te?"label":"button")};te?K=Lt[e]&&Lt[e][+r.slice(1)-1]||r:(y.data={},y.data["tool-id"]=r,K=Rt[r]||r),V=u.text,V=T(V)?V[1]||"":V,K=T(K)?K[0]:K,G=it(te?"span":"a","<span>"+(te?K||"%"+c:V||K)+"</span>",b(y,u.attributes||{})),Qe(G,"menu-"+Ze(r).replace(/[\/\s]/g,"-")),!y.title&&(J=u.title)&&(G.title=T(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),te?Oe(G,{id:zt+"-label:"+c}):(Vt(u)?Qe(G,"x"):tt(G,"x"),u.on?Qe(G,"on"):tt(G,"on"),Ke(ae,G,p),Ke(ue,G,h)),xt(f,G),++c}g(function(){(bt('[data-tool-id="'+Ne(d,"ui-drop-menu")+'"]',f)[0]||bt("a",f)[0]).focus()},1)}),!1}},r),Be(s[e].target,{"ui-drop":e,"ui-drop-menu":f}),s[e].data=i,o},Et.bubble=function(){Et.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Le(e)&&(t="default",n=e[0]),X=Ze(t),ft(Pt),xt(D,it(Pt,!1,{"class":zt+"-bubble "+X})),w(n)?n(Pt):it(Pt,n),Et.bubble.fit(),He("enter.bubble."+t,[o]),He("enter.bubble",[o]),o},Et.bubble.fit=function(e){G=o.$(1),t=Ve(St),Y=u(St,"line-height");var n="border-",i="-width";X=G.caret[0].x+t.l-St.scrollLeft,J=G.caret[1].y+t.t+Y-St.scrollTop,H=u(jt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=Ge(jt),l=Ge(Pt),a=H[0]+H[1],f=H[2]+H[3];return T(e)?(z(e[0])&&(X=e[0]),z(e[1])&&(J=e[1])):(X=d(X,t.l,t.l+r.w-l.w-f),J=d(J,t.t,t.t+r.h-l.h-a)),u(Pt,{left:X+ze,top:J+ze,visibility:"visible"}),He("fit.bubble",[o]),He("fit",[o]),o},Et.panel.exit=function(e){return Et.exit(e,"panel")},Et.overlay.exit=function(e){return Et.exit(e,"overlay")},Et.modal.exit=function(e){return Et.exit(e,"modal")},Et.drop.exit=function(e){return Et.exit(e,"drop")},Et.bubble.exit=function(e){return Et.exit(e,"bubble")},Et.tool=function(e,t,n){return K="","|"!==e&&(M.tools=Re(M.tools).filter(function(t,n){return t===e?(K=n,!1):!0})),t===!1?delete Et.tools[e]:("|"===e?(n=t,t={}):(w(t)&&(t={click:t}),Et.tools[e]=b(Et.tools[e]||{},t),z(n)||""===K||(n=K)),E(n)?M.tools.splice(n,0,e):M.tools.push(e)),tn(),o},Et.separator=function(e,t){return Et.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Et.key=function(e,t){return M.keys?(t===!1?delete Et.keys[e]:Et.keys[e]=t,nn(),o):o},Et.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(_e),!1},outdent:function(e,t){return t.outdent(_e),!1}},Et.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return V=":not([tabindex]):not([disabled])",(G=bt("input"+V+",button"+V+",select"+V+",textarea"+V+",a[href]"+V+",[contenteditable]"+V+',[tabindex]:not([tabindex="-1"])',s,0))&&-1!==(J=G.indexOf(St))?((G[J+1]||s).focus(),!1):void 0},f10:function(e,t){return bt("a",Ot)[0].focus(),!1},"shift+tab":ve?"outdent":0,tab:ve?"indent":0},Et.el={container:Mt,header:Ct,body:jt,footer:Ht,panel:Nt,overlay:Yt,modal:It,drop:Kt,bubble:Pt},o.config=M,b(TE._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=e.getHours(),l=e.getMinutes(),a=e.getSeconds(),f=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>l&&(l="0"+l),10>a&&(a="0"+a),10>f&&(f="0"+f),[""+t,""+n,""+i,""+r,""+l,""+a,""+f]},replace:We,format:Ue,dom:{set:xt,reset:_t,get:bt,id:rt,copy:function(e,t){return e.cloneNode(z(t)?t:!0)},classes:{set:Qe,reset:tt,toggle:nt,get:et},attributes:{set:Oe,reset:Ae,get:Se},data:{set:Be,reset:Ye,get:Ne},is:pt,offset:Ve,pointer:qe,size:Ge,content:{set:lt,reset:ft,get:at},closest:Je,parent:st,children:ot,next:ct,previous:ut,index:dt,before:yt,after:gt,prepend:mt,append:vt},el:it,event:{set:Ke,reset:Pe,fire:Xe,x:Ie}}),b(o._,TE._),b(o._,{hooks:v,hook:{set:Ce,reset:je,fire:He}}),o.create()};