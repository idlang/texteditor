/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.5.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function $e(e){return $(e)?m(e).split(/\s+/):e}function Pe(e){return M(e)?e.join(" "):e}function Oe(e){return e.length}function Ne(e){return Object.keys(e)}function Ie(e){return Oe(Ne(e))}function ze(e,t,n){return F(e)?F(t)?(F(y[e])||(y[e]={}),F(n)||(n=Ie(y[e])),y[e][n]=t,s):y[e]:y}function Le(e,t){return F(e)?F(t)&&F(y[e])?(delete y[e][t],s):(y[e]={},s):(y={},s)}function Re(e,t,n){if(!F(y[e]))return y[e]={},s;if(F(n))F(y[e][n])&&y[e][n].apply(s,t);else for(B in y[e])y[e][B].apply(s,t);return s}function De(e,t,n){if(M(t))for(B in t)De(e,B,t[B]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function je(e,n,i){if($(n))return je(e,[n],F(i)?i:"")[0];t=[];for(B in n)B=n[B],(B=e.getAttribute(B))&&t.push(B);return Oe(t)?t:F(i)?i:[]}function We(e,t){if(M(t))for(B in t)We(e,t[B]);else if(F(t))e.removeAttribute(t);else for(We(e,"class"),B=0,q=e.attributes,Y=Oe(q);Y>B;++B)q[B]&&We(e,q[B].name)}function Se(e,t,n){if(M(t))for(B in t)Se(e,B,t[B]);else De(e,"data-"+t,n)}function Ae(e,n,i){if($(n))return Ae(e,[n],F(i)?i:"")[0];t=[];for(B in n)B=n[B],(B=je(e,"data-"+B))&&t.push(B);return Oe(t)?t:F(i)?i:[]}function He(e,t){if(M(t))for(B in t)We(e,"data-"+t[B]);else if(F(t))We(e,"data-"+t);else for(B=0,q=e.attributes,Y=Oe(q);Y>B;++B)q[B]&&"data-"===q[B].name.slice(0,5)&&We(e,q[B].name)}function Be(e){return e&&e.preventDefault(),!1}function qe(e,t,n){if(t){for(e=$e(e),B=0,q=Oe(e);q>B;++B)t.addEventListener(e[B],n,!1),ze("on:"+e[B],n,at(t));return s}}function Ye(e,t,n){if(t){for(e=$e(e),B=0,q=Oe(e);q>B;++B)t.removeEventListener(e[B],n,!1),Le("on:"+e[B],at(t));return x(t)&&t.id.split(":")[0]===Ft+"-dom"&&We(t,"id"),s}}function Xe(e,t,n){e=$e(e);var l,i="createEvent"in f;for(B=0,q=Oe(e);q>B;++B)i?(l=f.createEvent("HTMLEvents"),l.data=n,l.initEvent(e[B],!0,!1),t.dispatchEvent(l)):Re("on:"+e[B],n,at(t));return s}function Ke(e,t,n){for(B=0,q=Oe(t),Y;q>B;++B)Y=t[B],e=e.replace(C(Y)?Y:h(p(Y),"g"),n&&n[B]||"");return e}function Ue(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,F(t[n])?t[n]:e})}function Ze(e){return m(Ke(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ge(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,l=Je(e);return{x:n-l.l,y:i-l.t}}function Je(e){for(X=e.offsetLeft,V=e.offsetTop;e=e.offsetParent;)X+=e.offsetLeft,V+=e.offsetTop;return{l:X,t:V}}function Qe(e){return e===o?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function Ve(e,t){for(;(e=st(e))&&e!==t;);return e}function et(e,t){t=$e(t);for(B in t)e.classList.add(t[B])}function tt(e,n,i){if($(n))return tt(e,[n],F(i)?i:"")[0];t=[];for(B in n)B=n[B],e.classList.contains(B)&&t.push(B);return Oe(t)?t:F(i)?i:!1}function nt(e,t){if(F(t)){t=$e(t);for(B in t)e.classList.remove(t[B])}else We(e,"class")}function it(e,t){t=$e(t);for(B in t)e.classList.toggle(t[B])}function lt(e,t,n){if(e=$(e)?f.createElement(e):e,M(n))for(B in n)if(te=n[B],"classes"===B)et(e,te);else if("data"===B)for(q in te)te=te[q],null===te?He(e,q):Se(e,q,te);else"css"===B?$(te)?De(e,"style",te):null===te?We(e,"style"):d(e,te):T(te)?e[B]=te:null===te?We(e,B):De(e,B,E(te)?te.join(" "):""+te);if(x(t))wt(e,t);else if(M(t))for(B in t)te=t[B],x(te)?wt(e,te):te!==!1&&rt(e,te);else F(t)&&t!==!1&&rt(e,t);return e}function at(e){var t=e.id;return t||(t=Ft+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function rt(e,t){e.innerHTML=t}function ot(e,t){return e.innerHTML||(F(t)?t:"")}function ft(e,t){if(t!==!1&&(D=ct(e)))for(B=0,q=Oe(D);q>B;++B)ft(D[B]);rt(e,"")}function st(e){return e&&e.parentNode}function ct(e){return e&&e.children||[]}function dt(e){return e&&e.nextSibling}function ut(e){return e&&e.previousSibling}function pt(e){for(B=0;e=ut(e);)++B;return B}function gt(e,t){return e&&$(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&T(t)?e===t(e):e===t}function ht(e,n){if(!(n=F(n)?n:f))return[];if(t=[],$(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(B=0,q=Oe(e);q>B;++B)t.push(e[B]);return t}return[]}for(e=n.querySelectorAll(e),B=0,q=Oe(e);q>B;++B)t.push(e[B]);return t}return bt(e)?[e]:[]}function bt(e,t){var n=st(e);return 1===Oe(arguments)?n||!1:e&&n===e?n:!1}function vt(e,t){Z=st(e),Z&&Z.insertBefore(t,e)}function mt(e,t){Z=st(e),Z&&Z.insertBefore(t,dt(e))}function yt(e,t){D=ct(e)[0],D?vt(D,t):wt(e,t)}function kt(e,t){wt(e,t)}function wt(e,t){e.appendChild(t)}function xt(e,t){var n=bt(e);if(n){if(t!==!1)for(D=ct(e)[0];D;)xt(D);n.removeChild(e)}}function Et(e){ft(lt(e,!1,{style:""})),xt(e)}function Tt(e,t,n){return lt(t||"div",n,{"class":e})}function Jt(e){return!e||F(e.active)&&!e.active}function Qt(){return jt.disabled||jt.readOnly}function Vt(e,t,n){return T(e)&&(e={click:e}),$(e.click)&&(e.click=(n[e.click]||{}).click),e.title=$t[t]||"",F(e.attributes)||(e.attributes={}),n[t]=e,e}function en(e){if(Qt())return jt.focus(),Be(e);_t.exit(0,0,0);var t=Ae(this,"tool-id"),n=_t.tools,i=n[t];return _t.drop.target=e.currentTarget||e.target,!Jt(i)&&T(q=i.click)&&(q=q(e,s,t),Re("on:change",[e,s,t]),q===!1)?Be(e):(s.select(),Be(e))}function tn(e){if(V=this,(Y=e.TE.key)(/^(escape|f10)$/))_t.exit(1);else if(Y("enter")||Y("arrowdown")&&Ae(V,"ui-drop"))_t.drop.target=V,Xe(oe,V,[e]);else if(Y("arrowright")&&(X=dt(V))){for(;!gt(X,"a")&&X;)X=dt(X);X&&X.focus()}else if(Y("arrowleft")&&(X=ut(V))){for(;!gt(X,"a")&&X;)X=ut(X);X&&X.focus()}return Be(e)}function nn(){ft(Dt,!1);var l,a,r,o,f,c,d,e=_t.tools,t=$e(I.tools),n=Ft+"-button",i=Ft+"-separator";I.tools=t;for(c in t)d=t[c],a=e[d],(a||a==={})&&(a=Vt(a,d,e),r=a.i||d,"|"!==r&&"<"!==r[0]&&(r=Ze(r)),o="|"!==r,f=Ze(d).replace(/[\/\s]/g,"-"),Zt=Tt(o?n+" "+n+"-"+f:i+" "+i+"-"+c,o?"a":"span"),o?(Zt=a.target||Zt,l=n+":"+f,De(Zt,{href:Ce,id:l,tabindex:-1}),Se(Zt,"tool-id",d),r="<"===r[0]?r:'<i class="'+Ue(Ct,[f,r])+'"></i>',Jt(a)?et(Zt,"x"):nt(Zt,"x"),a.on?et(Zt,"on"):nt(Zt,"on"),a.text&&(r=Ue('<span class="'+Ft+'-text">'+a.text+"</span>",[r]),et(Zt,"text")),rt(Zt,r),lt(Zt,!1,a.attributes),!a.attributes.title&&(q=a.title)&&(Zt.title=M(q)?q[0]+(q[1]?" ("+q[1]+")":""):q),qe(oe,Zt,en),qe(ue,Zt,tn)):Zt.id=i+":"+c,a.target=Zt,wt(Dt,Zt));Re("update.tools",[s])}function ln(){_t.keys=function(){var n,e=Ne(_t.keys).sort().reverse(),t={};for(B=0,q=Oe(e);q>B;++B)n=e[B],t[n]=_t.keys[n];return t}(),rn(),Re("update.keys",[s])}function an(e){function u(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}if(Qt())return jt.focus(),Be(e);var n=s.$(),i=n.before,l=n.after,a=i.slice(-1),r=l[0],o=n.length,f=_t.keys,c=TE.keys_alias,d=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();U=e.TE.key(),z[U]=1,t=Ie(z),v(function(){s.record()});for(B in f){Y=u(B),D=0;for(q in Y)q=Y[q],z[c[q]||q]&&++D;if(Y=Oe(Y),D===Y&&t===Y&&($(f[B])&&(f[B]=_t.tools[f[B]].click),X=f[B]&&f[B](e,s),X===!1))return Be(e)}if(ye)for(B in ye)if(K=ye[B],K!==!1){if(U===K&&r===K)return"\\"===a?(s.insert(U,0),Be(e)):(s.select(n.end+1),Be(e));if(B===U)return s.wrap(B,K),Be(e);if(a===B&&r===K){if("backspace"===U&&i.slice(-2)!=="\\"+B)return s.unwrap(B,K),Be(e);if(ke&&"enter"===U&&B!==K&&!o)return s.tidy("\n"+d+xe,"\n"+d).scroll(1),Be(e)}}if(ke&&!o){if("backspace"===U&&h(p(xe)+"$").test(i))return s.outdent(xe),Be(e);if("enter"===U&&h("(^|\\n)("+p(xe)+")+.*$").test(i))return s.insert("\n"+d,0,1).scroll(1),Be(e)}}function rn(e){e&&e.TE&&e.TE.key?delete z[e.TE.key()]:z={}}function dn(e){return on=Wt,Q=Qe(Rt),Be(e)}function un(e){on===Wt&&d(jt,{height:Ge(Lt,e).y-Q.h+Fe})}function pn(){on=0}function gn(){_t.exit(1)}function hn(){t=Qe(Bt),ne=t.w,H=t.h,t=Qe(Ht),fn=t.w,sn=t.h}function bn(e,t){t&&Re("exit.modal."+t,[s]),Xe(oe,Ht,[e])}function vn(e){on=e.target,t=Ge(Bt,e),ie=t.x,le=t.y,hn()}function mn(e){var n=cn.header,i=cn.resize;on===n||Ve(on,n)===n?(t=Ge(Lt,e),X=t.x-ie,V=t.y-le,d(Bt,{left:(ne>fn?X:u(X,0,fn-ne))+Fe,top:(H>sn?V:u(V,0,sn-H))+Fe})):on===i&&(t=Ge(Bt,e),Q=Qe(i),d(Bt,{width:t.x+Q.w/4+Fe,height:t.y+Q.h/4+Fe}))}function yn(){on=0}function kn(e,t,n){return{header:e,body:t,footer:n}}function wn(e){L=_t.drop.target,R=qt,D=e&&e.target||0,(!D||D!==L&&Ve(D,L)!==L)&&(_t.drop.target=0,Ye(oe,f,wn),Ye(me,o,wn),_t.exit(e.target===jt))}var L,R,D,S,H,B,q,Y,X,K,U,t,Z,J,Q,V,te,ne,ie,le,n="⌘",i="…",a="⇥",r="⇧",o=window,f=document,s=new TE(e),c=s._,d=c.css,u=c.edge,p=c.x,g=c.extend,h=c.pattern,v=(c.timer.reset,c.timer.set),m=c.trim,y={},k=function(){},w=TE.is,x=w.e,E=w.a,T=w.f,_=w.i,M=w.o,C=w.r,F=function(e){return!w.x(e)},$=w.s,P=f.documentElement,N=(f.head,f.body),I=g({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",a],outdent:["Outdent",r+"+"+a]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"icon icon-%1 icon-%1--%2 fa fa-%2"}},t),z={},re="blur",oe="click",ue="keydown",pe="keyup",ge="touchstart mousedown",he="touchmove mousemove",be="touchend mouseup",me="orientationchange resize",ye=I.auto_close,ke=I.auto_tab,we=I.languages,xe=I.tab,Te=(I.unit[0][1],I.unit[0][0]),_e=I.unit[1][1],Me=I.unit[1][0],Ce="javascript:;",Fe="px",_t=s.ui={};s.tidy=function(e,t){var n=s.$(),i=m(n.before)?e:"",l=m(n.after)?F(t)?t:e:"";return s.trim(i,l)},s.i=function(){return m(s.replace(/\s+/g," "))},s.format=function(e,t,n,i){M(e)||(e=[e]),F(n)||(n=" "),F(i)||(i="");var l=s.h,a=s[0]().$(),r=(e[0]?Te[0]+e[0]+Te[1]:"")+i,o=i+(e[0]?Te[0]+Te[2]+(e[1]||e[0].split(h("("+_e[3]+")+"))[0])+Te[1]:""),f=p(r),c=p(o),d=h("^"+f+"([\\s\\S]*?)"+c+"$"),u=h(f+"$"),g=h("^"+c),b=a.before,v=a.after;return a.length?n=!1:s.insert(we.placeholders[""]),s.toggle(t?!d.test(a.value):!u.test(b)&&!g.test(v),[function(e){e.unwrap(r,o,1).tidy(h(Me[0]+"[^"+Me[0]+Me[1]+Me[2]+"]+?"+Me[1]+"$").test(b)?"":n,h("^"+Me[0]+Me[2]+"[^"+Me[0]+Me[1]+"]+?"+Me[1]).test(v)?"":n).wrap(r,o,t)},function(e){e.unwrap(r,o,t)}])[l]()};var Zt,Mt=I.classes,Ct=Mt.i,Ft=Mt[""],$t=we.tools,Pt=we.buttons,Ot=we.labels,Nt=Ft+"-textarea "+Ft+"-content block",It=Tt(Ft),zt=Tt(Ft+"-header"),Lt=Tt(Ft+"-body"),Rt=Tt(Ft+"-footer"),Dt=Tt(Ft+"-tool"),jt=lt(e,!1,I.attributes),Wt=Tt(Ft+"-resize s"),St=Tt(Ft+"-description"),At=Tt(Ft+"-panel"),Ht=Tt(Ft+"-overlay"),Bt=lt("div"),qt=lt("div"),Yt=lt("div"),Xt=Tt("left","span"),Kt=Tt("right","span"),Ut=0;F(I.suffix)||(I.suffix=Te[1]);var on=0,ie=0,le=0,ne=0,H=0,fn=0,sn=0,cn={};s.create=function(e,t){M(e)&&(I=g(I,e));var n=bt(jt);return et(It,Ft+"-is-can-update"),et(It,Ft+"-is-can-copy"),et(jt,Nt),n&&gt(n,"p")?(vt(n,It),Ut=n,xt(n,!1)):vt(jt,It),It.dir=I.dir,wt(It,zt),wt(It,Lt),wt(It,Rt),wt(Lt,jt),I.tools&&(wt(zt,Dt),wt(Rt,St),wt(St,Xt),wt(St,Kt)),qe(ue,jt,an),qe(pe+" "+re,jt,rn),I.resize&&(wt(It,Wt),et(It,Ft+"-is-can-resize"),qe(ge,Wt,dn),qe(he,f,un),qe(be,N,pn)),nn(),ln(),0!==t?Re("create",[s]):s},s.update=function(e,t){return tt(jt,$e(Nt),0)&&s.destroy(0),(0!==t?Re("update",[s]):s).create(e,0)},s.destroy=function(e){return tt(jt,$e(Nt),0)?(_t.exit(0,0,0),nt(jt,Nt),I.tools=Pe(I.tools),I.keys&&(Ye(ue,jt,an),Ye(pe,jt,rn)),I.resize&&(Ye(ge,Wt,dn),Ye(he,f,un),Ye(be,f,pn)),Ut?(vt(It,Ut),wt(Ut,jt),Ut=0):vt(It,jt),Et(It),0!==e?Re("destroy",[s]):s):s},s.enable=function(e){return jt.disabled=jt.readOnly=!1,et(It,Ft+"-is-can-update"),et(It,Ft+"-is-can-copy"),0!==e?Re("enable",[s]):s},s.disable=function(e){return jt.disabled=!0,nt(It,Ft+"-is-can-update"),nt(It,Ft+"-is-can-copy"),0!==e?Re("disable",[s]):s},s.freeze=function(e){return jt.disabled=!1,jt.readOnly=!0,nt(It,Ft+"-is-can-update"),et(It,Ft+"-is-can-copy"),0!==e?Re("freeze",[s]):s},_t.exit=function(e,t,n){if(S={panel:function(){Et(At)},overlay:function(){Ye(oe,Ht,gn),Et(Ht)},modal:function(){Ye(ge,Lt,vn),Ye(he,Lt,mn),Ye(be,f,yn),Ye(oe,cn.x,bn),Et(Bt)},drop:function(){Et(qt)},bubble:function(){Et(Yt)}},rn(),t)if(M(t))for(B in t)B=t[B],S[B]&&S[B](),0!==n&&Re("exit."+B,[s]);else S[t]&&S[t](),0!==n&&Re("exit."+B,[s]);else for(B in S)S[B]();return e&&s.select(),0!==n&&Re("exit",[s]),s},_t.panel=function(e,t){function n(){Ye(oe,ie,n),_t.panel.exit(1)}return _t.exit(0,0,0),ie=Tt(Ft+"-x"),ie.title=Pt.close,qe(oe,ie,n),ft(At,!1),wt(Lt,lt(At,[Tt(Ft+"-panel-content","div",e),ie])),T(t)?t(At):lt(At,t),Re("enter.panel",[s]),Re("enter",[s]),s},_t.panel.fit=function(){},_t.overlay=function(e,t){return _t.exit(0,0,0),wt(Lt,Ht),e&&qe(oe,Ht,gn),T(t)?t(Ht):lt(Ht,t),Re("enter.overlay",[s]),Re("enter",[s]),s},_t.overlay.fit=function(){},_t.modal=function(){_t.overlay(1).blur();var r,o,e=arguments,t=e[0],n=e[1],i=e[2],l=Ft+"-modal",a=n.footer;if(M(t)&&(t="default",n=e[0],i=e[1]),X=Ze(t),lt(Bt,!1,{"class":l+" "+X}),F(n.body)&&(n.body=lt("div",n.body,{"class":l+"-content "+X})),F(a)&&M(a)&&!x(a)){o=[];for(B in a)q=a[B],x(q)?o.push(q):(q=Vt(q,B,a),t=B.text||Pt[B]||B,r=lt("button",t,g({name:"y["+B+"]",type:"button","class":Ft+"-button",data:{"button-id":B}},q.attributes)),qe(oe,r,function(e){return t=a[Ae(this,"button-id")].click(e,s),t===!1?Be(e):void 0}),o.push(r));n.footer=o}for(B in n)l[1]=B,cn[B]=Tt(l+"-"+Ue(B,l)+" "+X,0,n[B]);return cn.x=Tt(Ft+"-x "+X),cn.resize=Tt(Ft+"-resize se "+X),ft(Bt,!1),cn.x.title=Pt.close,wt(Lt,lt(Bt,cn,{style:""})),_t.modal.fit(),mt(Bt,Ht),qe(oe,cn.x,bn),qe(ge,cn.header,Be),qe(ge,cn.resize,Be),qe(ge,Lt,vn),qe(he,Lt,mn),qe(be,f,yn),T(i)&&(cn.overlay=Ht,cn.modal=Bt,i(cn)),Re("enter.modal."+t,[s]),Re("enter.modal",[s]),Re("enter",[s]),s},_t.modal.fit=function(e){return hn(),X=fn/2-ne/2,V=sn/2-H/2,M(e)?(F(e[0])&&(X=e[0]),F(e[1])&&(V=e[1])):(X=u(X,0),V=u(V,0)),d(Bt,{left:X+Fe,top:V+Fe,"min-width":ne+Fe,"min-height":H+Fe,visibility:"visible"}),Re("fit.modal",[s]),Re("fit",[s]),s};var xn={"class":Ft+"-button",name:"y"};return _t.alert=function(e,t,n,i){var l=lt("button",Pt.okay,xn),a="alert";return n=n||k,M(e)&&(a+=":"+e[0],e=e[1]||e[0]),qe(oe,l,function(e){return n(e,s),bn(e,a+".y"),Be(e)}),qe(ue,l,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Xe(oe,l,[e]),Be(e)}),_t.modal(a,kn(e,t,l),i),l.focus(),s},_t.confirm=function(e,t,n,i,l){function c(e){return T(n)&&n(e,s),bn(e,o+".y"),Be(e)}function d(e){return T(i)&&i(e,s),bn(e,o+".n"),Be(e)}var f,a=lt("button",Pt.okay,xn),r=lt("button",Pt.cancel,xn),o="confirm";return r.name="n",M(e)&&(o+=":"+e[0],e=e[1]||e[0]),qe(oe,a,c),qe(oe,r,d),qe(ue,a,function(e){return f=e.TE.key,f("arrowright")?r.focus():f("enter")?c(e):f("escape")&&bn(e,o+".y"),Be(e)}),qe(ue,r,function(e){return f=e.TE.key,f("arrowleft")?a.focus():f("enter")?d(e):f("escape")&&bn(e,o+".n"),Be(e)}),_t.modal(o,kn(e,t,[a,r]),l),r.focus(),s},_t.prompt=function(e,t,n,i,l,a){function h(){f.focus(),"placeholder"in f&&f.select()}function b(e){u=f.value,T(n)&&!n(u)?h():!n||m(u)&&u!==t?(bn(e,c+".y"),i(e,s,u!==t?u:"",t)):h()}function v(e){bn(e,c+".n")}var u,p,g,r=lt("button",Pt.okay,xn),o=lt("button",Pt.cancel,xn),f=lt("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Ft+"-input block"}),c="prompt",d=[];if(M(e)&&(c+=":"+e[0],e=e[1]||e[0]),T(l)&&(a=l,l=0),l=l||0,1===l)f=lt("textarea",t,{placeholder:t.split("\n")[0],"class":Ft+"-textarea block",spellcheck:"false"});else if(2===l){for(B in t)d.push(lt("option",t[B],{value:B,selected:B===n||null}));f=lt("select",d,{"class":Ft+"-select block"})}return i=i||k,f.name="data",o.name="n",qe(ue,f,function(e){return p=e.TE.key,g=e.TE.control,p("enter")&&0===l||g("enter")?(b(e),Be(e)):p("escape")||p("backspace")&&!this.value?(v(e),Be(e)):p("arrowdown")&&0===l||p("enter")&&2===l||g("arrowdown")?(r.focus(),Be(e)):void 0}),qe(ue,r,function(e){return p=e.TE.key,p("enter")?b(e):p("escape")?v(e):p("arrowup")?f.focus():p("arrowright")&&o.focus(),Be(e)}),qe(ue,o,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?v(e):p("arrowup")?f.focus():p("arrowleft")&&r.focus(),Be(e)}),qe(oe,r,b),qe(oe,o,v),_t.modal(c,kn(e,f,[r,o]),a),h(),s},_t.drop=function(){_t.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===Oe(e)&&(t="default",n=e[0],i=e[1]),X=Ze(t),ft(qt,!1),wt(N,lt(qt,!1,{"class":Ft+"-drop "+X})),T(n)?n(qt):lt(qt,n),_t.drop.fit(),i===!1||qe(oe,f,wn),qe(me,o,wn),Re("enter.drop."+t,[s]),Re("enter.drop",[s]),s},_t.drop.fit=function(e){return L=Qe(P),R=Qe(qt),D=_t.drop.target,X=L.w/2-R.w/2,V=L.h/2-R.h/2,!F(e)&&D&&(t=Je(D),X=t.l,V=t.t+Qe(D).h),M(e)?(F(e[0])&&(X=e[0]),F(e[1])&&(V=e[1])):(X=u(X,0,L.w-R.w),V=u(V,0,Math.max(L.h,Qe(o).h)-R.h)),d(qt,{left:X+Fe,top:V+Fe,visibility:"visible"}),Re("fit.drop",[s]),Re("fit",[s]),s},_t.menu=function(e,n,i,l){var d,a='<span class="'+Ft+'-current menu">%1</span>',r="",o=n,f=_t.tools,c=0;if(n=!M(n)&&i[n]&&i[n].text||n,n===!1)return _t.tool(e,n);M(n)&&(r=n[0],r="<"===r[0]?r:'<i class="'+Ue(Ct,[Ze(e).replace(/[\/\s]/g,"-"),r])+'"></i>',n=o=F(n[1])?n[1]:0,n=n&&i[n]&&i[n].text||n,a=r+(0!==n?" "+a:""));for(l in i)ne="%"===l[0],d=i[l],d=$(d)&&!ne?f[d]:d,d&&(d=Vt(d,l,f),i[l]=d);return _t.tool(e,{i:r,text:n?Ue(a,[n,r]):0,click:function(o){var u=_t.drop.target=f[e].target;return _t.drop("menu menu-"+Ze(e),function(o){function p(e){return V=this,t=Ae(V,"tool-id"),K=i[t],K=$(K)?f[K]:K||{},U=ot(V),!Jt(K)&&T(l=K.click)&&(l=l(e,s),n!==!1&&u&&(D=ct(u)[0]||u,gt(D,"i")||rt(D,Ue(a,[U,r])),M(K.text)&&(D=ct(D)[0])&&gt(D,"i")&&(nt(D),et(D,Ue(Ct,[K.text[0]])))),Se(u,"ui-drop-menu",t),l===!1)?(s.select(),Be(e)):(s.select(),Be(e))}function h(e){if(V=this,(Y=e.TE.key)("escape"))_t.exit(1);else if(Y("enter"))Xe(oe,V,[e]);else if(Y("f10")&&u)u.focus();else if(Y("arrowdown")&&(X=dt(V))){for(;!gt(X,"a")&&X;)X=dt(X);X&&X.focus()}else if(Y("arrowup")&&(X=ut(V))){for(;!gt(X,"a")&&X;)X=ut(X);!X&&u?(_t.exit(),u.focus()):X&&X.focus()}else Y("arrowup")&&u&&(_t.exit(),u.focus());return Be(e)}for(l in i)if(d=i[l],ne="%"===l[0],d){var b={href:ne?null:Ce,"class":Ft+"-"+(ne?"label":"button")};ne?q=Ot[e]&&Ot[e][+l.slice(1)-1]||l:(b.data={},b.data["tool-id"]=l,q=$t[l]||l),J=d.text,J=M(J)?J[1]||"":J,q=M(q)?q[0]:q,Q=lt(ne?"span":"a","<span>"+(ne?q||"%"+c:J||q)+"</span>",g(b,d.attributes||{})),et(Q,"menu-"+Ze(l).replace(/[\/\s]/g,"-")),!b.title&&(V=d.title)&&(Q.title=M(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),ne?De(Q,{id:Ft+"-label:"+c}):(Jt(d)?et(Q,"x"):nt(Q,"x"),d.on?et(Q,"on"):nt(Q,"on"),qe(oe,Q,p),qe(ue,Q,h)),wt(o,Q),++c}v(function(){(ht('[data-tool-id="'+Ae(u,"ui-drop-menu")+'"]',o)[0]||ht("a",o)[0]).focus()},1)}),!1}},l),Se(f[e].target,{"ui-drop":e,"ui-drop-menu":o}),f[e].data=i,s},_t.bubble=function(){_t.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Oe(e)&&(t="default",n=e[0]),X=Ze(t),ft(Yt,!1),wt(N,lt(Yt,!1,{"class":Ft+"-bubble "+X})),T(n)?n(Yt):lt(Yt,n),_t.bubble.fit(),Re("enter.bubble."+t,[s]),Re("enter.bubble",[s]),s},_t.bubble.fit=function(e){Q=s.$(1),t=Je(jt),H=d(jt,"line-height");var n="border-",i="-width";X=Q.caret[0].x+t.l-jt.scrollLeft,V=Q.caret[1].y+t.t+H-jt.scrollTop,R=d(Lt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var l=Qe(Lt),a=Qe(Yt),r=R[0]+R[1],o=R[2]+R[3];return M(e)?(F(e[0])&&(X=e[0]),F(e[1])&&(V=e[1])):(X=u(X,t.l,t.l+l.w-a.w-o),V=u(V,t.t,t.t+l.h-a.h-r)),d(Yt,{left:X+Fe,top:V+Fe,visibility:"visible"}),Re("fit.bubble",[s]),Re("fit",[s]),s},_t.panel.exit=function(e){return _t.exit(e,"panel")},_t.overlay.exit=function(e){return _t.exit(e,"overlay")},_t.modal.exit=function(e){return _t.exit(e,"modal")},_t.drop.exit=function(e){return _t.exit(e,"drop")},_t.bubble.exit=function(e){return _t.exit(e,"bubble")},_t.tool=function(e,t,n){return q="","|"!==e&&(I.tools=$e(I.tools).filter(function(t,n){return t===e?(q=n,!1):!0})),t===!1?delete _t.tools[e]:("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),_t.tools[e]=g(_t.tools[e]||{},t),F(n)||""===q||(n=q)),_(n)?I.tools.splice(n,0,e):I.tools.push(e)),nn(),s},_t.separator=function(e,t){return _t.tool("|",e!==!1?{attributes:e||{}}:!1,t)},_t.key=function(e,t){return I.keys?(t===!1?delete _t.keys[e]:_t.keys[e]=t,ln(),s):s},_t.key.set=function(e){z[e]=1},_t.key.reset=function(e){e?delete z[e]:z={}},_t.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(xe),!1},outdent:function(e,t){return _t.key.set("shift"),t.outdent(xe),!1}},_t.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return J=":not([tabindex]):not([disabled])",(Q=ht("input"+J+",button"+J+",select"+J+",textarea"+J+",a[href]"+J+",[contenteditable]"+J+',[tabindex]:not([tabindex="-1"])',f,0))&&-1!==(V=Q.indexOf(jt))?((Q[V+1]||f).focus(),!1):void 0},f10:function(e,t){return ht("a",Dt)[0].focus(),!1},"shift+tab":ke?"outdent":0,tab:ke?"indent":0},_t.el={container:It,header:zt,body:Lt,footer:Rt,panel:At,overlay:Ht,modal:Bt,drop:qt,bubble:Yt},s.config=I,g(TE._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),l=e.getHours(),a=e.getMinutes(),r=e.getSeconds(),o=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>l&&(l="0"+l),10>a&&(a="0"+a),10>r&&(r="0"+r),10>o&&(o="0"+o),[""+t,""+n,""+i,""+l,""+a,""+r,""+o]},replace:Ke,format:Ue,dom:{set:wt,reset:xt,get:ht,id:at,copy:function(e,t){return e.cloneNode(F(t)?t:!0)},classes:{set:et,reset:nt,toggle:it,get:tt},attributes:{set:De,reset:We,get:je},data:{set:Se,reset:He,get:Ae},is:gt,offset:Je,pointer:Ge,size:Qe,content:{set:rt,reset:ft,get:ot},closest:Ve,parent:st,children:ct,next:dt,previous:ut,index:pt,before:vt,after:mt,prepend:yt,append:kt},el:lt,event:{set:qe,reset:Ye,fire:Xe,x:Be}}),g(s._,TE._),g(s._,{hooks:y,hook:{set:ze,reset:Le,fire:Re}}),s.create()};