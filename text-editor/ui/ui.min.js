/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.8
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Ce(e){return g(e)?d(e).split(/\s+/):e}function ve(e){return T(e)?e.join(" "):e}function Ge(e,t,n){return m(e)?m(t)?(m(G[e])||(G[e]={}),m(n)||(n=Object.keys(G[e]).length),G[e][n]=t,a):G[e]:G}function ye(e,t){return m(e)?m(t)&&m(G[e])?(delete G[e][t],a):(G[e]={},a):(G={},a)}function He(e,t,n){if(!m(G[e]))return G[e]={},a;if(m(n))m(G[e][n])&&G[e][n].apply(a,t);else for(x in G[e])G[e][x].apply(a,t);return a}function ke(e,t,n){if(T(t))for(x in t)ke(e,x,t[x]);else e.setAttribute(t,n)}function De(t,n,r){if(g(n))return De(t,[n],m(r)?r:"")[0];e=[];for(x in n)x=n[x],(x=t.getAttribute(x))&&e.push(x);return e.length?e:m(r)?r:[]}function we(e,t){if(T(t))for(x in t)we(e,t[x]);else if(m(t))e.removeAttribute(t);else for(we(e,"class"),x=0,W=e.attributes,K=W.length;K>x;++x)W[x]&&we(e,W[x].name)}function Me(e,t,n){if(T(t))for(x in t)Me(e,x,t[x]);else ke(e,"data-"+t,n)}function Ue(t,n,r){if(g(n))return Ue(t,[n],m(r)?r:"")[0];e=[];for(x in n)x=n[x],(x=De(t,"data-"+x))&&e.push(x);return e.length?e:m(r)?r:[]}function $e(e,t){if(T(t))for(x in t)we(e,"data-"+t[x]);else if(m(t))we(e,"data-"+t);else for(x=0,W=e.attributes,K=W.length;K>x;++x)W[x]&&"data-"===W[x].name.slice(0,5)&&we(e,W[x].name)}function Be(e){return e&&e.preventDefault(),!1}function Pe(e,t,n){if(t){for(e=Ce(e),x=0,W=e.length;W>x;++x)t.addEventListener(e[x],n,!1),Ge("on:"+e[x],n,et(t));return a}}function xe(e,t,n){if(t){for(e=Ce(e),x=0,W=e.length;W>x;++x)t.removeEventListener(e[x],n,!1),ye("on:"+e[x],et(t));return I(t)&&t.id.split(":")[0]===Tt+"-dom"&&we(t,"id"),a}}function We(e,t,n){e=Ce(e);var i,r="createEvent"in f;for(x=0,W=e.length;W>x;++x)r?(i=f.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[x],!0,!1),t.dispatchEvent(i)):He("on:"+e[x],n,et(t));return a}function Ke(e,t,n){for(x=0,W=t.length,K;W>x;++x)K=t[x],e=e.replace(N(K)?K:E(u(K),"g"),n&&n[x]||"");return e}function Ye(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,m(t[n])?t[n]:e})}function _e(e){return d(Ke(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ve(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=qe(e);return{x:n-i.l,y:r-i.t}}function qe(e){for(Y=e.offsetLeft,X=e.offsetTop;e=e.offsetParent;)Y+=e.offsetLeft,X+=e.offsetTop;return{l:Y,t:X}}function ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function je(e,t){for(;(e=it(e))&&e!==t;);return e}function Qe(e,t){t=Ce(t);for(x in t)e.classList.add(t[x])}function Xe(t,n,r){if(g(n))return Xe(t,[n],m(r)?r:"")[0];e=[];for(x in n)x=n[x],t.classList.contains(x)&&e.push(x);return e.length?e:m(r)?r:!1}function Je(e,t){if(m(t)){t=Ce(t);for(x in t)e.classList.remove(t[x])}else we(e,"class")}function Ze(e,t,n){if(e=g(e)?f.createElement(e):e,T(n))for(x in n)if(Z=n[x],"classes"===x)Qe(e,Z);else if("data"===x)for(W in Z)Z=Z[W],null===Z?$e(e,W):Me(e,W,Z);else"css"===x?g(Z)?ke(e,"style",Z):null===Z?we(e,"style"):A(e,Z):L(Z)?e[x]=Z:null===Z?we(e,x):ke(e,x,T(Z)?Z.join(" "):""+Z);if(I(t))dt(e,t);else if(T(t))for(x in t)Z=t[x],I(Z)?dt(e,Z):Z!==!1&&tt(e,Z);else m(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id,n=Tt+"-dom:"+Date.now();return t?st("#"+u(n))[0]&&(n+="_",e.id=n):e.id=n,e.id}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(m(t)?t:"")}function rt(e,t){if(t!==!1&&(w=ot(e)))for(x=0,W=w.length;W>x;++x)rt(w[x]);tt(e,"")}function it(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function ft(e){return e&&e.previousSibling}function at(e,t){return e&&g(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&L(t)?e===t(e):e===t}function st(t,n){if(n=n||f,e=[],g(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(x=0,W=t.length;W>x;++x)e.push(t[x]);return e}return[]}for(t=n.querySelectorAll(t),x=0,W=t.length;W>x;++x)e.push(t[x]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=it(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){q=it(e),q&&q.insertBefore(t,e)}function At(e,t){q=it(e),q&&q.insertBefore(t,lt(e))}function pt(e,t){w=ot(e)[0],w?ct(w,t):dt(e,t)}function Et(e,t){dt(e,t)}function dt(e,t){e.appendChild(t)}function Ot(e,t){var n=ut(e);if(n){if(t!==!1)for(w=ot(e)[0];w;)Ot(w);n.removeChild(e)}}function ht(e){rt(Ze(e,!1,{style:""})),Ot(e)}function Rt(e,t,n){return Ze(t||"div",n,{"class":e})}function qt(e){return!e||m(e.active)&&!Q.active}function zt(){St._word&&St._words&&(Z=(kt.value||"").replace(E(Ne[0]+"[^"+Ne[0]+Ne[1]+"]+?"+Ne[1],"g"),""),x=(Z.match(/(\w+)/g)||[]).length,tt(xt,Ye(St["_word"+(1===x?"":"s")],[x])))}function jt(e,t,n){return L(e)&&(e={click:e}),g(e.click)&&(e.click=(n[e.click]||{}).click),m(e.title)||(e.title=Nt[t]||""),n[t]=e,e}function Qt(e){It.exit(0,0,0);var t=Ue(this,me),n=It.tools,r=n[t];return Yt=e.currentTarget||e.target,!qt(r)&&L(W=r.click)&&(W=W(e,a,t),He("on:change",[e,a,t]),W===!1)?Be(e):(a.select(),Be(e))}function Xt(e){if(X=this,(K=e.TE.key)(/^(escape|f10)$/))It.exit(1);else if(K("enter"))Yt=X,We(Ae,X,[e]);else if(K("arrowright")&&(Y=lt(X))){for(;!at(Y,"a")&&Y;)Y=lt(Y);Y&&Y.focus()}else if(K("arrowleft")&&(Y=ft(X))){for(;!at(Y,"a")&&Y;)Y=ft(Y);Y&&Y.focus()}return Be(e)}function Jt(){rt(Ht,!1);var r,i,o,l,f,s,u,e=Ce(H.tools),t=Tt+"-button",n=Tt+"-separator";H.tools=e;for(s in e)u=e[s],i=It.tools[u],(i||i==={})&&(i=jt(i,u,It.tools),o=i.i||u,"|"!==o&&"<"!==o[0]&&(o=_e(o)),l="|"!==o,f=_e(o).replace(/\s/g,""),_t=Rt(l?t+" "+t+"-"+f:n+" "+n+"-"+s,l?"a":"span"),l?(r=t+":"+f,ke(_t,{href:Se,id:r,tabindex:-1}),Me(_t,me,u),o="<"===o[0]?o:'<i class="'+Ye(bt,[o])+'"></i>',qt(i)&&Qe(_t,"x"),i.text&&(o=Ye('<span class="'+Tt+'-text">'+i.text+"</span>",[o]),Qe(_t,"text")),tt(_t,o),Ze(_t,!1,i.attributes||{}),!_t.title&&(W=i.title)&&(_t.title=T(W)?W[0]+(W[1]?" ("+W[1]+")":""):W),Pe(Ae,_t,Qt),Pe(ie,_t,Xt)):_t.id=n+":"+s,It.tools[u].target=_t,dt(Ht,_t));He("update.tools",[a])}function Zt(){It.keys=function(){var n,e=Object.keys(It.keys).sort().reverse(),t={};for(x=0,W=e.length;W>x;++x)n=e[x],t[n]=It.keys[n];return t}(),on(1),He("update.keys",[a])}function en(e){zt(),He("on:change",[e,a])}function rn(t){function p(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=a.$(),r=n.before,i=n.after,o=r.slice(-1),l=i[0],f=n.length,s=It.keys,c=TE.keys_alias,A=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();V=t.TE.key(),tn[V]=1,e=Object.keys(tn).length,O(function(){a.record()},1);for(x in s){K=p(x),w=0;for(W in K)W=K[W],tn[c[W]||W]&&++w;if(K=K.length,w===K&&e===K&&(g(s[x])&&(s[x]=It.tools[s[x]].click),Y=s[x]&&s[x](t,a),Y===!1))return Be(t)}if(Le)for(x in Le)if(_=Le[x],_!==!1){if(V===_&&l===_)return"\\"===o?(a.insert(V,0),Be(t)):(a.select(n.end+1),Be(t));if(x===V)return a.wrap(x,_),Be(t);if(o===x&&l===_){if("backspace"===V&&r.slice(-2)!=="\\"+x)return a.unwrap(x,_),Be(t);if(Ie&&"enter"===V&&x!==_)return a.tidy("\n"+A+Re,"\n"+A),Be(t)}}if(Ie&&!f){if("backspace"===V&&E(u(Re)+"$").test(r))return a.outdent(Re),Be(t);if("enter"===V&&E("(^|\\n)("+u(Re)+")+.*$").test(r))return a.insert("\n"+A,0,1),Be(t)}}function on(e){T(e)?delete tn[e.TE.key()]:tn={}}function ln(e){/^(focus|blur)$/.test(e.type)&&on(1),h(nn),nn=O(function(){en(e)},H.debounce||0)}function cn(e){return fn=Dt,Q=ze(yt),Be(e)}function An(e){fn===Dt&&A(kt,{height:Ve(Gt,e).y-Q.h+Fe})}function pn(){fn=0}function En(){It.exit(1)}function dn(){e=ze(Ut),ee=e.w,P=e.h,e=ze(Mt),an=e.w,sn=e.h}function On(e,t){t&&He("exit.modal."+t,[a]),We(Ae,Mt,[e])}function hn(t){fn=t.target,e=Ve(Ut,t),te=e.x,ne=e.y,dn()}function Rn(t){var n=un.header,r=un.resize;fn===n||je(fn,n)===n?(e=Ve(Gt,t),Y=e.x-te,X=e.y-ne,A(Ut,{left:(ee>an?Y:p(Y,0,an-ee))+Fe,top:(P>sn?X:p(X,0,sn-P))+Fe})):fn===r&&(e=Ve(Ut,t),Q=ze(r),A(Ut,{width:e.x+Q.w/4+Fe,height:e.y+Q.h/4+Fe}))}function In(){fn=0}function Ln(e,t,n){return{header:e,body:t,footer:n}}function bn(e){k=Yt,D=$t,w=e&&e.target||0,(!w||w!==k&&je(w,k)!==k)&&(Yt=0,ht($t),xe(Ae,f,bn),xe(de,l,bn),It.exit(e.target===v))}function Nn(t){function i(){e&&(q=ze(e),A(j,{width:q.w+Fe,height:q.h+Fe}))}var n=a.get(),r="";return-1===n.indexOf("</html>")&&(r='<!DOCTYPE html><html dir="'+H.dir+'"><head><meta charset="utf-8"><style>'+H.css+"</style></head><body>"+n+"</body></html>"),j=Ze("iframe",!1,{"class":Tt+"-portal",src:"data:text/html,"+encodeURIComponent(r)}),!ut(Mt)&&n?It.overlay(j,1,function(){e=ot(Mt)[0],i(),Pe(de,l,i),He("enter.overlay.preview",[t,a,[n,r],e])}):(xe(de,l,i),En()),Be(t)}var k,D,w,U,$,P,x,W,K,Y,_,V,e,q,j,Q,X,Z,ee,te,ne,t="⌘",n="…",i="⇥",o="⇧",l=window,f=document,a=this,s=a._,u=s.x,c=s.extend,A=s.css,p=s.edge,E=s.pattern,d=s.trim,O=s.timer.set,h=s.timer.reset,R=a.is,I=R.e,L=R.f,b=R.i,T=R.o,N=R.r,g=R.s,m=function(e){return!R.x(e)},S=f.documentElement,C=(f.head,f.body),v=a.target,G={},y=function(){},H=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",oe="keyup",le="copy",fe="cut",ae="paste",se="touchstart mousedown",ue="touchend mouseup",ce="touchmove mousemove",Ae="click",pe="focus",Ee="blur",de="orientationchange resize",Oe=Ee+" "+le+" "+fe+" "+pe+" input "+ie+" "+ae,he=H.languages,Re=H.tab,Ie=H.auto_tab,Le=H.auto_close,be=H.unit[0][0],Ne=(H.unit[0][1],H.unit[1][0]),ge=H.unit[1][1],me="tool-id",Se="javascript:;",Fe="px",It=a.ui={};a.tidy=function(e,t){var n=a.$(),r=d(n.before)?e:"",i=d(n.after)?m(t)?t:e:"";return a.trim(r,i)},a.i=function(){return d(a.replace(/\s+/g," "))},a.format=function(e,t,n,r){T(e)||(e=[e]),m(n)||(n=" "),m(r)||(r="");var i=a.h,o=a[0]().$(),l=(e[0]?be[0]+e[0]+be[1]:"")+r,f=r+(e[0]?be[0]+be[2]+(e[1]||e[0].split(E("("+ge[3]+")+"))[0])+be[1]:""),s=u(l),c=u(f),A=E("^"+s+"([\\s\\S]*?)"+c+"$"),p=E(s+"$"),d=E("^"+c),O=o.before,h=o.after;return o.length?n=!1:a.insert(he.placeholders[""]),a.toggle(t?!A.test(o.value):!p.test(O)&&!d.test(h),[function(e){e.unwrap(l,f,1).tidy(E(Ne[0]+"[^"+Ne[0]+Ne[1]+Ne[2]+"]+?"+Ne[1]+"$").test(O)?"":n,E("^"+Ne[0]+Ne[2]+"[^"+Ne[0]+Ne[1]+"]+?"+Ne[1]).test(h)?"":n).wrap(l,f,t)},function(e){e.unwrap(l,f,t)}])[i]()};var _t,Lt=H.classes,bt=Lt.i,Tt=Lt[""],Nt=he.tools,gt=he.buttons,mt=he.labels,St=he.others,Ft=Tt+"-textarea "+Tt+"-content block",Ct=Rt(Tt),vt=Rt(Tt+"-header"),Gt=Rt(Tt+"-body"),yt=Rt(Tt+"-footer"),Ht=Rt(Tt+"-tool"),kt=Ze(v,!1,H.attributes),Dt=Rt(Tt+"-resize s"),wt=Rt(Tt+"-description"),Mt=Rt(Tt+"-overlay"),Ut=Ze("div"),$t=Ze("div"),Bt=Ze("div"),Pt=Rt("left","span"),xt=Rt("right","span"),Wt=Rt(Tt+"-preview","a"),Kt=0,Yt=0;H.suffix||(H.suffix=be[1]);var tn={},nn=null;a.create=function(e,t){T(e)&&(H=c(H,e));var n=ut(kt);return Qe(kt,Ft),n&&at(n,"p")?(ct(n,Ct),Kt=n,Ot(n,!1)):ct(kt,Ct),Ct.dir=H.dir,dt(Ct,vt),dt(Ct,Gt),dt(Ct,yt),dt(Ct,Dt),dt(Gt,kt),H.tools&&(dt(vt,Ht),dt(yt,wt),dt(wt,Pt),dt(wt,xt)),Pe(ie,kt,rn),Pe(oe,kt,on),Pe(Oe,kt,ln),Pe(se,Dt,cn),Pe(ce,f,An),Pe(ue,C,pn),St.preview&&(Q=Nt.preview,ke(Wt,{href:Se,title:T(Q)?Q[0]+(Q[1]?" ("+Q[1]+")":""):Q}),dt(Pt,Wt),tt(Wt,St.preview)),en(null),Jt(),Zt(),0!==t?He("create",[a]):a},a.update=function(e,t){return Xe(kt,Ce(Ft),0)&&a.destroy(0),(0!==t?He("update",[a]):a).create(e,0)},a.destroy=function(e){return Xe(kt,Ce(Ft),0)?(It.exit(0,0,0),Je(kt,Ft),H.tools=ve(H.tools),H.keys&&(xe(ie,kt,rn),xe(oe,kt,on)),xe(se,Dt,cn),xe(ce,f,An),xe(ue,f,pn),xe(Oe,kt,ln),Kt?(ct(Ct,Kt),dt(Kt,kt),Kt=0):ct(Ct,kt),ht(Ct),0!==e?He("destroy",[a]):a):a};var fn=0,te=0,ne=0,ee=0,P=0,an=0,sn=0,un={};It.exit=function(e,t,n){if($={overlay:function(){xe(Ae,Mt,En),ht(Mt)},modal:function(){xe(se,Gt,hn),xe(ce,Gt,Rn),xe(ue,f,In),xe(Ae,un.x,On),ht(Ut)},drop:function(){ht($t)},bubble:function(){ht(Bt)}},t)if(T(t))for(x in t)x=t[x],$[x]&&$[x](),0!==n&&He("exit."+x,[a]);else $[t]&&$[t](),0!==n&&He("exit."+x,[a]);else for(x in $)$[x]();return e&&a.select(),0!==n&&He("exit",[a]),a},It.overlay=function(e,t,n){return It.exit(0,0,0),on(1),dt(Gt,Ze(Mt,e.length||I(e)?Rt(Tt+"-overlay-content","div",e):"")),t&&Pe(Ae,Mt,En),L(n)?n(Mt):Ze(Mt,n),He("enter.overlay",[a]),He("enter",[a]),a},It.overlay.fit=function(){},It.modal=function(){It.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=Tt+"-modal";T(t)&&(t="default",n=e[0],r=e[1]),Y=_e(t),Ze(Ut,!1,{"class":i+" "+Y}),m(n.body)&&(n.body=Ze("div",n.body,{"class":i+"-content "+Y}));for(x in n)i[1]=x,un[x]=Rt(i+"-"+Ye(x,i)+" "+Y,0,n[x]);return un.x=Rt(Tt+"-x "+Y),un.resize=Rt(Tt+"-resize se "+Y),rt(Ut),dt(Gt,Ze(Ut,un,{style:""})),It.modal.fit(),At(Ut,Mt),Pe(Ae,un.x,On),Pe(se,un.header,Be),Pe(se,un.resize,Be),Pe(se,Gt,hn),Pe(ce,Gt,Rn),Pe(ue,f,In),L(r)&&(un.overlay=Mt,un.modal=Ut,r(un)),He("enter.modal."+t,[a]),He("enter.modal",[a]),He("enter",[a]),a},It.modal.fit=function(e){return dn(),Y=an/2-ee/2,X=sn/2-P/2,T(e)?(m(e[0])&&(Y=e[0]),m(e[1])&&(X=e[1])):(Y=p(Y,0),X=p(X,0)),A(Ut,{left:Y+Fe,top:X+Fe,"min-width":ee+Fe,"min-height":P+Fe,visibility:"visible"}),He("fit.modal",[a]),He("fit",[a]),a};var Tn={"class":Tt+"-button",name:"y"};return It.alert=function(e,t,n,r){var i=Ze("button",gt.okay,Tn),o="alert";return n=n||y,T(e)&&(o+=":"+e[0],e=e[1]||e[0]),Pe(Ae,i,function(e){return n(e,a),On(e,o+".y"),Be(e)}),Pe(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(We(Ae,i,[e]),Be(e)):void 0}),It.modal(o,Ln(e,t,i),r),i.focus(),a},It.confirm=function(e,t,n,r,i){function u(e){return L(n)&&n(e,a),On(e,f+".y"),Be(e)}function c(e){return L(r)&&r(e,a),On(e,f+".n"),Be(e)}var s,o=Ze("button",gt.okay,Tn),l=Ze("button",gt.cancel,Tn),f="confirm";return l.name="n",T(e)&&(f+=":"+e[0],e=e[1]||e[0]),Pe(Ae,o,u),Pe(Ae,l,c),Pe(ie,o,function(e){return s=e.TE.key,s("arrowright")?(l.focus(),Be(e)):s("arrowleft")?Be(e):s("enter")?(u(e),Be(e)):s("escape")?(On(e,f+".y"),Be(e)):void 0}),Pe(ie,l,function(e){return s=e.TE.key,s("arrowright")?Be(e):s("arrowleft")?(o.focus(),Be(e)):s("enter")?(c(e),Be(e)):s("escape")?(On(e,f+".n"),Be(e)):void 0}),It.modal(f,Ln(e,t,[o,l]),i),l.focus(),a},It.prompt=function(e,t,n,r,i,o){function E(){s.focus(),"placeholder"in s&&s.select()}function O(e){return Be(e)}function h(e){return A=s.value,!n||d(A)&&A!==t?(On(e,u+".y"),Be(e),r(e,a,A!==t?A:"",t)):(E(),O(e))}function R(e){return On(e,u+".n"),Be(e)}var A,p,l=Ze("button",gt.okay,Tn),f=Ze("button",gt.cancel,Tn),s=Ze("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Tt+"-input block"}),u="prompt",c=[];if(T(e)&&(u+=":"+e[0],e=e[1]||e[0]),L(i)&&(o=i,i=0),1===i)s=Ze("textarea",t,{placeholder:t.split("\n")[0],"class":Tt+"-textarea block"});else if(2===i){for(x in t)c.push(Ze("option",t[x],{value:x,selected:x===n||null}));s=Ze("select",c,{"class":Tt+"-select block"})}return r=r||y,s.name="data",f.name="n",Pe(ie,s,function(e){return p=e.TE.key,p("enter")?h(e):p("escape")||p("backspace")&&!this.value?R(e):p("arrowup")?O(e):p("arrowdown")?(l.focus(),Be(e)):void 0}),Pe(ie,l,function(e){return p=e.TE.key,p("enter")?h(e):p("escape")?R(e):p("arrowup")?(s.focus(),Be(e)):p("arrowright")?(f.focus(),Be(e)):p(/^arrow(down|left)$/)?O(e):void 0}),Pe(ie,f,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?R(e):p("arrowup")?(s.focus(),Be(e)):p(/^arrow(right|down)$/)?O(e):p("arrowleft")?(l.focus(),Be(e)):void 0}),Pe(Ae,l,h),Pe(Ae,f,R),It.modal(u,Ln(e,s,[l,f]),o),E(),a},It.drop=function(){It.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),Y=_e(t),rt($t),dt(C,Ze($t,!1,{"class":Tt+"-drop "+Y})),L(n)?n($t):Ze($t,n),It.drop.fit(),Pe(Ae,f,bn),Pe(de,l,bn),He("enter.drop."+t,[a]),He("enter.drop",[a]),a},It.drop.fit=function(t){return k=ze(S),D=ze($t),Y=k.w/2-D.w/2,X=k.h/2-D.h/2,!m(t)&&Yt&&(e=qe(Yt),Y=e.l,X=e.t+ze(Yt).h),T(t)?(m(t[0])&&(Y=t[0]),m(t[1])&&(X=t[1])):(Y=p(Y,0,Math.max(k.w,l.innerWidth)-D.w),X=p(X,0,Math.max(k.h,l.innerHeight)-D.h)),A($t,{left:Y+Fe,top:X+Fe,visibility:"visible"}),He("fit.drop",[a]),He("fit",[a]),a},It.menu=function(e,t,n,r){t=!T(t)&&n[t]&&n[t].text||t;var s,i=It.tools,o='<span class="'+Tt+'-current menu">%1</span>',l="",f=0;return t===!1?It.tool(e,t):(T(t)&&(l=t[0],l="<"===l[0]?l:'<i class="'+Ye(bt,[l])+'"></i>',t=m(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,o=l+(0!==t?" "+o:"")),It.tool(e,{i:l,text:t?Ye(o,[t,l]):0,click:function(u){return It.drop("menu menu-"+_e(e),function(u){function A(e){return X=this,_=n[Ue(X,me)],_=g(_)?i[_]:_||{},V=nt(X),!qt(_)&&L(r=_.click)&&(r=r(e,a),t!==!1&&Yt&&(w=ot(Yt)[0]||Yt,at(w,"i")||tt(w,Ye(o,[V,l])),T(_.text)&&(w=ot(w)[0])&&at(w,"i")&&(Je(w),Qe(w,Ye(bt,[_.text[0]])))),r===!1)?Be(e):(a.select(),Be(e))}function p(e){if(X=this,(K=e.TE.key)("escape"))It.exit(1);else if(K("enter"))We(Ae,X,[e]);else if(K("f10")&&Yt)Yt.focus();else if(K("arrowdown")&&(Y=lt(X))){for(;!at(Y,"a")&&Y;)Y=lt(Y);Y&&Y.focus()}else if(K("arrowup")&&(Y=ft(X))){for(;!at(Y,"a")&&Y;)Y=ft(Y);!Y&&Yt?(It.exit(),Yt.focus()):Y&&Y.focus()}else K("arrowup")&&Yt&&(It.exit(),Yt.focus());return Be(e)}for(r in n)if(s=n[r],ee="%"===r[0],s=g(s)&&!ee?i[s]:s){s=jt(s,r,i);var E={href:ee?null:Se,"class":Tt+"-"+(ee?"label":"button")};ee?W=mt[e]&&mt[e][+r.slice(1)-1]||r:(E.data={},E.data[me]=r,W=Nt[r]||r),j=s.text,j=T(j)?j[1]||"":j,W=T(W)?W[0]:W,Q=Ze(ee?"span":"a",ee?"<span>"+(W||"%"+f)+"</span>":s.text||W,c(E,s.attributes||{})),!Q.title&&(X=s.title)&&(Q.title=T(X)?X[0]+(X[1]?" ("+X[1]+")":""):X),ee?ke(Q,{id:Tt+"-label:"+f}):(qt(s)&&Qe(Q,"x"),Pe(Ae,Q,A),Pe(ie,Q,p)),n[r]=s,dt(u,Q),++f}O(function(){st("a",u)[0].focus()},1)}),!1}},r),Pe(ie,i[e].target,function(t){return t.TE.key("arrowdown")?(Yt=this,i[e].click(U,a),Be(t)):void 0}),i[e].data=n,a)},It.bubble=function(){It.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),Y=_e(t),rt(Bt),dt(C,Ze(Bt,!1,{"class":Tt+"-bubble "+Y})),L(n)?n(Bt):Ze(Bt,n),It.bubble.fit(),He("enter.bubble."+t,[a]),He("enter.bubble",[a]),a},It.bubble.fit=function(t){Q=a.$(1),e=qe(kt),P=A(kt,"line-height");var n="border-",r="-width";Y=Q.caret[0].x+e.l-kt.scrollLeft,X=Q.caret[1].y+e.t+P-kt.scrollTop,D=A(Gt,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=ze(Gt),o=ze(Bt),l=D[0]+D[1],f=D[2]+D[3];return T(t)?(m(t[0])&&(Y=t[0]),m(t[1])&&(X=t[1])):(Y=p(Y,e.l,e.l+i.w-o.w-f),X=p(X,e.t,e.t+i.h-o.h-l)),A(Bt,{left:Y+Fe,top:X+Fe,visibility:"visible"}),He("fit.bubble",[a]),He("fit",[a]),a},It.overlay.exit=function(e){return It.exit(e,"overlay")},It.modal.exit=function(e){return It.exit(e,"modal")},It.drop.exit=function(e){return It.exit(e,"drop")},It.bubble.exit=function(e){return It.exit(e,"bubble")},It.tool=function(e,t,n){return W="","|"!==e&&(H.tools=H.tools.filter(function(t,n){return t===e?(W=n,!1):!0})),t===!1?delete It.tools[e]:("|"===e?(n=t,t={}):(L(t)&&(t={click:t}),It.tools[e]=c(It.tools[e]||{},t),m(n)||""===W||(n=W)),b(n)?H.tools.splice(n,0,e):H.tools.push(e)),Jt(),a},It.key=function(e,t){return H.keys?(t===!1?delete It.keys[e]:It.keys[e]=t,Zt(),a):a},It.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Re),!1},outdent:function(e,t){return t.outdent(Re),!1}},Pe(Ae,Wt,Nn),It.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Nn(e)},f10:function(e,t){return st("a",Ht)[0].focus(),!1},"shift+tab":Ie?"outdent":0,tab:Ie?"indent":0,escape:function(e,t){return Wt.focus(),!1}},It.el={container:Ct,header:vt,body:Gt,footer:yt,overlay:Mt,modal:Ut,drop:$t,bubble:Bt},a.config=H,c(a._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=e.getSeconds(),f=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>l&&(l="0"+l),10>f&&(f="0"+f),[""+t,""+n,""+r,""+i,""+o,""+l,""+f]},replace:Ke,format:Ye,dom:{set:dt,reset:Ot,get:st,id:et,copy:function(e,t){return e.cloneNode(m(t)?t:!0)},classes:{set:Qe,reset:Je,get:Xe},attributes:{set:ke,reset:we,get:De},data:{set:Me,reset:$e,get:Ue},is:at,offset:qe,point:Ve,size:ze,content:{set:tt,reset:rt,get:nt},closest:je,parent:it,children:ot,next:lt,previous:ft,before:ct,after:At,prepend:pt,append:Et},el:Ze,event:{set:Pe,reset:xe,fire:We,x:Be},hooks:G,hook:{set:Ge,reset:ye,fire:He}}),It};