/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.3.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function ee(e,t,r){return k(e)?k(t)?(k(C[e])||(C[e]={}),k(r)||(r=Object.keys(C[e]).length),C[e][r]=t,l):C[e]:C}function te(e,t){return k(e)?k(t)&&k(C[e])?(delete C[e][t],l):(C[e]={},l):(C={},l)}function re(e,t,r){if(!k(C[e]))return C[e]={},l;if(k(r))k(C[e][r])&&C[e][r].apply(l,t);else for(var n in C[e])C[e][n].apply(l,t);return l}function ne(e,t,r){if(w(t))for(var n in t)ne(e,n,t[n]);else e.setAttribute(t,r)}function ie(e,t){e.removeAttribute(t)}function oe(e){return e&&e.preventDefault(),!1}function ue(e,t,r){return t?(t.addEventListener(e,r,!1),ee("on:"+e,r,qe(t)),l):void 0}function fe(e,t,r){return t?(t.removeEventListener(e,r,!1),te("on:"+e,qe(t)),t.id.split(":")[0]===ke+"-dom"&&ie(t,"id"),l):void 0}function le(e,t,r){if("createEvent"in f){var n=f.createEvent("HTMLEvents");n.data=r,n.initEvent(e,!0,!1),t.dispatchEvent(n)}else re("on:"+e,r,qe(t));return l}function ce(e,t,r){e=g(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)ue(e[n],t,r);return l}function ae(e,t,r){e=g(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)fe(e[n],t,r);return l}function se(e,t,r){e=g(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)le(e[n],t,r);return l}function pe(e,t){return setTimeout(e,t)}function de(e){return clearTimeout(e)}function he(e,t,r){for(var o,n=0,i=t.length;i>n;++n)o=t[n],e=e.replace(x(o)?o:h(a(o),"g"),r&&r[n]||"");return e}function ge(e,t){return e.replace(/%(\d+)/g,function(e,r){return--r,k(t[r])?t[r]:e})}function ve(e){return g(he(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function me(e,t){var r=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,i=ye(e);return{x:r-i.l,y:n-i.t}}function ye(e){for(var t=e.offsetLeft,r=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,r+=e.offsetTop;return{l:t,t:r}}function be(e){return{w:e.offsetWidth,h:e.offsetHeight}}function we(e,t){for(;(e=et(e))&&e!==t;);return e}function De(e,t,r){if(e=$(e)?f.createElement(e):e,w(r)){var n,i;for(i in r)n=r[i],"style"===i?$(n)?ne(e,i,n):null===n?ie(e,i):e=p(e,n):y(n)?e[i]=n:null===n?ie(e,i):ne(e,i,w(n)?n.join(" "):""+n)}if(m(t))ct(e,t);else if(w(t)){var n,i;for(i in t)n=t[i],m(n)?ct(e,n):n!==!1&&Je(e,n)}else k(t)&&t!==!1&&Je(e,t);return e}function qe(e){var t=e.id;return t||(t=ke+"-dom:"+Date.now(),e.id=t),t}function Fe(e,t){return h("(^|\\s)"+t+"(\\s|$)").test(e.className)}function Qe(e,t){Fe(e,t)||(e.className=g(e.className+" "+t))}function Ge(e,t){e.className=g(e.className.replace(h("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function Je(e,t){return k(t)?void(e.innerHTML=t):e.innerHTML}function Ve(e,t){if(t!==!1){var n,r=e.children;for(n in r)Ve(r[n])}Je(e,"")}function et(e){return e.parentElement||e.parentNode}function tt(e){return e.children||[]}function rt(e){return e.nextElementSibling||e.nextSibling}function it(e,t){var r=et(e);return 1===arguments.length?r||!1:e&&r===e?r:!1}function ot(e,t){et(e).insertBefore(t,e)}function ut(e,t){et(e).insertBefore(t,rt(e))}function ct(e,t){e.appendChild(t)}function at(e,t){var r=it(e);if(r){if(t!==!1)for(var n=tt(e)[0];n;)at(n);r.removeChild(e)}}function st(e){Ve(De(e,!1,{style:""})),at(e)}function pt(e,t,r){return De(t||"div",r,{"class":e})}function dt(){if(Te._word&&Te._words){var e=(Le.value||"").replace(h(Q[0]+"[^"+Q[0]+Q[1]+"]+?"+Q[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;Je(Ye,ge(Te["_word"+(1===t?"":"s")],[t]))}}function ht(e,t){y(e)&&(e.click=e),$(e.click)&&(e.click=(xe.tools[e.click]||{}).click),k(e.active)||(e.active=1),k(e.title)||(e.title=_e[t]||"")}function gt(){Ve(je,!1);var n,i,o,u,f,c,a,e=$(z.tools)?g(z.tools).split(/\s+/):z.tools,t=ke+"-button",r=ke+"-separator";z.tools=e;for(f in e)a=e[f],i=xe.tools[a],i&&(ht(i,a),"|"!==(o=i.i||a)&&(o=ve(o)),u="|"!==o,Xe=pt(u?t:r,u?"a":"span"),u&&(n=t+":"+ve(a).replace(/\s/g,""),ne(Xe,{href:"",id:n,"tab-index":-1}),ne(Xe,J,a),o='<i class="'+ge($e.i,[o])+" "+n+'"></i>',i.active||Qe(Xe,"x"),i.text&&(o=ge('<span class="'+ke+'-text">'+i.text+"</span>",[o]),Qe(Xe,"text")),Je(Xe,o),De(Xe,!1,i.attributes||{}),!Xe.title&&(c=i.title)&&(Xe.title=w(c)?c[0]+(c[1]?" ("+c[1]+")":""):c),ce(M,Xe,kt)),ct(je,Xe));re("update.tools",[l])}function vt(){xe.keys=function(){var r,n,e=Object.keys(xe.keys).sort().reverse(),t={};for(r=0,n=e.length;n>r;++r)t[e[r]]=xe.keys[e[r]];return t}(),xt(1),re("update.keys",[l])}function mt(e){dt(),re("on:change",[e,l])}function wt(e){function w(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var p,d,g,v,m,b,t=l.$(),r=t.before,n=t.after,i=r.slice(-1),o=n[0],u=t.length,f=xe.keys,c=TE.keys_alias,s=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),y=e.TE.key();yt[y]=1,b=Object.keys(yt).length,pe(function(){l.record()},1);for(p in f){var x=0;g=w(p);for(d in g)d=g[d],yt[c[d]||d]&&++x;if(g=g.length,x===g&&b===g&&($(f[p])&&(f[p]=xe.tools[f[p]].click),v=f[p]&&f[p](e,l),v===!1))return oe(e)}if(D)for(p in D)if(m=D[p],m!==!1){if(y===m&&o===m)return"\\"===i?(l.insert(y,0),oe(e)):(l.select(t.end+1),oe(e));if(p===y)return l.wrap(p,m),oe(e);if(i===p&&o===m){if("backspace"===y&&r.slice(-2)!=="\\"+p)return l.unwrap(p,m),oe(e);if(Z&&"enter"===y&&p!==m)return l.tidy("\n"+s+X,"\n"+s).scroll(!0),oe(e)}}if(Z&&!u){if("backspace"===y&&h(a(X)+"$").test(r))return l.outdent(X).scroll(!0),oe(e);if("enter"===y&&h("(^|\\n)("+a(X)+")+.*$").test(r))return l.insert("\n"+s,0,1).scroll(!0),oe(e)}}function xt(e){w(e)?delete yt[e.TE.key()]:yt={}}function $t(e){/^focus|blur$/.test(e.type)&&xt(1),de(bt),bt=pe(function(){mt(e)},z.debounce||0)}function kt(e){xe.exit(0,0,0);var i,t=this.getAttribute(J),r=xe.tools,n=r[t];return Ne=e.currentTarget||e.target,n&&n.active&&n.click&&(i=r[t].click(e,l,t),re("on:change",[e,l,t]),i===!1)?oe(e):(l.select(),oe(e))}function Lt(e){return _t=He,jt=be(Ae),oe(e)}function Ht(e){_t===He&&p(Le,{height:me(Ke,e).y-jt.h+V})}function Ot(){_t=0}function Rt(){xe.exit(1)}function Wt(){e=be(We),Ct=e.w,St=e.h,e=be(Re),zt=e.w,Kt=e.h}function Mt(e,t){t&&re("exit.modal."+t,[l]),se(M,Re,[e])}function It(t){_t=t.target,e=me(We,t),Et=e.x,Tt=e.y,Wt()}function Bt(t){var i,o,r=At.header,n=At.resize;_t===r||we(_t,r)===r?(e=me(Ke,t),i=e.x-Et,o=e.y-Tt,p(We,{left:(Ct>zt?i:d(i,0,zt-Ct))+V,top:(St>Kt?o:d(o,0,Kt-St))+V})):_t===n&&(e=me(We,t),jt=be(n),p(We,{width:e.x+jt.w/4+V,height:e.y+jt.h/4+V}))}function Yt(){_t=0}function Pt(e,t,r){return{header:e,body:t,footer:r}}function Ut(e){var t=Ne,n=e&&e.target||0;(!n||n!==t&&we(n,t)!==t)&&(Ne=0,st(Me),ae(M,T,Ut),xe.exit(1))}function Xt(e){function f(){i&&(o=be(i),p(n,{width:o.w+V,height:o.h+V}))}var n,i,o,t=l.get(),r="";return-1===t.indexOf("</html>")&&(r='<!DOCTYPE html><html dir="'+z.dir+'"><head><meta charset="utf-8"><style>'+z.css+"</style></head><body>"+t+"</body></html>"),n=De("iframe",!1,{"class":ke+"-portal",src:"data:text/html,"+encodeURIComponent(r)}),!it(Re)&&t?xe.overlay(n,1,function(){i=tt(Re)[0],f(),ce(P,u,f),re("enter.overlay.preview",[e,l,[t,r],i])}):(ae(P,u,f),Rt()),oe(e)}var t="⌘",r="…",i="⇥",o="⇧",u=window,f=document,l=this,c=l._,a=c.x,s=c.extend,p=c.css,d=c.edge,h=c.pattern,g=c.trim,v=l.is,m=v.e,y=v.f,b=v.i,w=v.o,x=v.r,$=v.s,k=function(e){return!v.x(e)},_=f.documentElement,T=(f.head,f.body),C={},S=function(){},z=s({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),K="keydown",A="keyup",j="copy",L="cut",H="paste",O="touchstart mousedown",R="touchend mouseup",W="touchmove mousemove",M="click",I="focus",B="blur",Y="input",P="orientationchange resize",U=B+" "+j+" "+L+" "+I+" "+Y+" "+K+" "+H,N=z.languages,X=z.tab,Z=z.auto_tab,D=z.auto_close,q=z.unit[0][0],Q=(z.unit[0][1],z.unit[1][0]),G=z.unit[1][1],J="data-tool-id",V="px",xe=l.ui={};l.tidy=function(e,t){var r=l.$(),n=g(r.before)?e:"",i=g(r.after)?k(t)?t:e:"";return l.trim(n,i)},l.i=function(){return g(l.replace(/\s+/g," "))},l.format=function(e,t,r,n){w(e)||(e=[e]),k(r)||(r=" "),k(n)||(n="");var i=l[0]().$(),o=(e[0]?q[0]+e[0]+q[1]:"")+n,u=n+(e[0]?q[0]+q[2]+(e[1]||e[0].split(h("("+G[3]+")+"))[0])+q[1]:""),f=a(o),c=a(u),s=h("^"+f+"([\\s\\S]*?)"+c+"$"),p=h(f+"$"),d=h("^"+c),g=i.before,v=i.after;return i.length?r=!1:l.insert(N.placeholders[""]),l.toggle(t?!s.test(i.value):!p.test(g)&&!d.test(v),[function(e){e.unwrap(o,u,1).tidy(h(Q[0]+"[^"+Q[0]+Q[1]+Q[2]+"]+?"+Q[1]+"$").test(g)?"":r,h("^"+Q[0]+Q[2]+"[^"+Q[0]+Q[1]+"]+?"+Q[1]).test(v)?"":r).wrap(o,u,t)[1]()},function(e){e.unwrap(o,u,t)[1]()}])};var Xe,$e=z.classes,ke=$e[""],_e=N.tools,Ee=N.buttons,Te=N.others,Ce=ke+"-textarea "+ke+"-content block",Se=pt(ke),ze=pt(ke+"-header"),Ke=pt(ke+"-body"),Ae=pt(ke+"-footer"),je=pt(ke+"-tool"),Le=De(l.target,!1,z.attributes),He=pt(ke+"-resize s"),Oe=pt(ke+"-description"),Re=pt(ke+"-overlay"),We=De("div"),Me=De("div"),Ie=De("div"),Be=pt("left","span"),Ye=pt("right","span"),Pe=pt(ke+"-preview","a"),Ue=0,Ne=0;z.suffix||(z.suffix=q[1]);var yt={},bt=null;l.create=function(e,t){w(e)&&(z=s(z,e));var r=it(Le);if(Qe(Le,Ce),r&&"P"===r.nodeName?(ot(r,Se),Ue=r,at(r,!1)):ot(Le,Se),Se.dir=z.dir,ct(Se,ze),ct(Se,Ke),ct(Se,Ae),ct(Se,He),ct(Ke,Le),z.tools&&(ct(ze,je),ct(Ae,Oe),ct(Oe,Be),ct(Oe,Ye)),ce(K,Le,wt),ce(A,Le,xt),ce(U,Le,$t),ce(O,He,Lt),ce(W,T,Ht),ce(R,T,Ot),Te.preview){var n=_e.preview;ne(Pe,{href:"",title:w(n)?n[0]+(n[1]?" ("+n[1]+")":""):n}),ct(Be,Pe),Je(Pe,Te.preview)}return mt(null),gt(),vt(),0!==t?re("create",[l]):l},l.update=function(e,t){return Fe(Le,Ce)&&l.destroy(0),(0!==t?re("update",[l]):l).create(e,0)},l.destroy=function(e){return Fe(Le,Ce)?(xe.exit(0,0,0),Ge(Le,Ce),w(z.tools)&&(z.tools=z.tools.join(" ")),z.keys&&(ae(K,Le,wt),ae(A,Le,xt)),ae(O,He,Lt),ae(W,T,Ht),ae(R,T,Ot),ae(U,Le,$t),Ue?(ot(Se,Ue),ct(Ue,Le),Ue=0):ot(Se,Le),st(Se),0!==e?re("destroy",[l]):l):l};var e,jt,_t=0,Et=0,Tt=0,Ct=0,St=0,zt=0,Kt=0,At={};xe.exit=function(e,t,r){var i,n={overlay:function(){ae(M,Re,Rt),st(Re)},modal:function(){ae(O,Ke,It),ae(W,Ke,Bt),ae(R,T,Yt),ae(M,At.x,Mt),st(We)},drop:function(){st(Me)},bubble:function(){st(Ie)}};if(t)if(w(t))for(i in t)i=t[i],n[i]&&n[i](),0!==r&&re("exit."+i,[l]);else n[t]&&n[t](),0!==r&&re("exit."+i,[l]);else for(i in n)n[i]();return e&&l.select(),0!==r&&re("exit",[l]),l},xe.overlay=function(e,t,r){return xe.exit(0,0,0).blur(),xt(1),ct(Ke,De(Re,e.length||m(e)?pt(ke+"-overlay-content","div",e):"")),t&&ce(M,Re,Rt),y(r)?r(Re):De(Re,r),re("enter.overlay",[l]),re("enter",[l]),l},xe.modal=function(){xe.overlay("",1);var o,f,e=arguments,t=e[0],r=e[1],n=e[2],i=ke+"-modal";w(t)&&(t="default",r=e[0],n=e[1]),f=ve(t),De(We,!1,{"class":i+" "+f}),k(r.body)&&(r.body=De("div",r.body,{"class":i+"-content "+f}));for(o in r)i[1]=o,At[o]=pt(i+"-"+ge(o,i)+" "+f,0,r[o]);return At.x=pt(ke+"-x "+f),At.resize=pt(ke+"-resize se "+f),Ve(We),ct(Ke,De(We,At,{style:""})),xe.modal.fit(),ut(We,Re),ce(M,At.x,Mt),ce(O,At.header,oe),ce(O,At.resize,oe),ce(O,Ke,It),ce(W,Ke,Bt),ce(R,T,Yt),y(n)&&(At.overlay=Re,At.modal=We,n(At)),re("enter.modal."+t,[l]),re("enter.modal",[l]),re("enter",[l]),l},xe.modal.fit=function(e){Wt();var t=Kt/2-St/2,r=zt/2-Ct/2;return w(e)?(r=e[0],t=e[1]):(r=d(r,0),t=d(t,0)),p(We,{left:r+V,top:t+V,"min-width":Ct+V,"min-height":St+V,visibility:"visible"}),re("fit.modal",[l]),re("fit",[l]),l};var Nt={"class":ke+"-button",name:"y"};return xe.alert=function(e,t,r,n){var i=De("button",Ee.okay,Nt),o="alert";return r=r||S,w(e)&&(o+=":"+e[0],e=e[1]||e[0]),ce(M,i,function(e){return r(e,l),Mt(e,o+".y"),oe(e)}),ce(K,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?se(M,i,[e,l]):void 0}),xe.modal(o,Pt(e,t,i),n),i.focus(),l},xe.confirm=function(e,t,r,n,i){function a(e){return y(r)&&r(e,l),Mt(e,f+".y"),oe(e)}function s(e){return y(n)&&n(e,l),Mt(e,f+".n"),oe(e)}var c,o=De("button",Ee.okay,Nt),u=De("button",Ee.cancel,Nt),f="confirm";return u.name="n",w(e)&&(f+=":"+e[0],e=e[1]||e[0]),ce(M,o,a),ce(M,u,s),ce(K,o,function(e){return c=e.TE.key,c("arrowright")?(u.focus(),oe(e)):c("arrowleft")?oe(e):c("enter")?(a(e),oe(e)):c("escape")?(Mt(e,f+".y"),oe(e)):void 0}),ce(K,u,function(e){return c=e.TE.key,c("arrowright")?oe(e):c("arrowleft")?(o.focus(),oe(e)):c("enter")?(s(e),oe(e)):c("escape")?(Mt(e,f+".n"),oe(e)):void 0}),xe.modal(f,Pt(e,t,[o,u]),i),u.focus(),l},xe.prompt=function(e,t,r,n,i,o){function v(){c.focus(),"placeholder"in c&&c.select()}function m(e){return oe(e)}function b(e){return h=c.value,!r||g(h)&&h!==t?(Mt(e,a+".y"),oe(e),n(e,l,h!==t?h:"",t)):(v(),m(e))}function x(e){return Mt(e,a+".n"),oe(e)}var p,d,h,u=De("button",Ee.okay,Nt),f=De("button",Ee.cancel,Nt),c=De("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":ke+"-input block"}),a="prompt",s=[];if(w(e)&&(a+=":"+e[0],e=e[1]||e[0]),y(i)&&(o=i,i=0),1===i)c=De("textarea",t,{placeholder:t.split("\n")[0],"class":ke+"-textarea block"});else if(2===i){for(d in t)s.push(De("option",t[d],{value:d,selected:d===r||null}));c=De("select",s,{"class":ke+"-select block"})}return n=n||S,c.name="data",f.name="n",ce(K,c,function(e){return p=e.TE.key,p("enter")?b(e):p("escape")||p("backspace")&&!this.value?x(e):p("arrowup")?m(e):p("arrowdown")?(u.focus(),oe(e)):void 0}),ce(K,u,function(e){return p=e.TE.key,p("enter")?b(e):p("escape")?x(e):p("arrowup")?(c.focus(),oe(e)):p("arrowright")?(f.focus(),oe(e)):p(/^arrow(down|left)$/)?m(e):void 0}),ce(K,f,function(e){return p=e.TE.key,p(/^enter|escape$/)?x(e):p("arrowup")?(c.focus(),oe(e)):p(/^arrow(right|down)$/)?m(e):p("arrowleft")?(u.focus(),oe(e)):void 0}),ce(M,u,b),ce(M,f,x),xe.modal(a,Pt(e,c,[u,f]),o),v(),l},xe.drop=function(){xe.exit(0,0,0);var n,e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),n=ve(t),Ve(Me),ct(T,De(Me,!1,{"class":ke+"-drop "+n})),y(r)?r(Me):De(Me,r),xe.drop.fit(),ce(M,T,Ut),re("enter.drop."+t,[l]),re("enter.drop",[l]),l},xe.drop.fit=function(e){var o,t=be(_),r=be(Me),n=t.w/2-r.w/2,i=t.h/2-r.h/2;return!k(e)&&Ne&&(o=ye(Ne),n=o.l,i=o.t+be(Ne).h),w(e)?(n=e[0],i=e[1]):(n=d(n,0,t.w-r.w),i=d(i,0,t.h-r.h)),p(Me,{left:n+V,top:i+V,visibility:"visible"}),re("fit.drop",[l]),re("fit",[l]),l},xe.menu=function(e,t,r,n){var i='<span class="'+ke+'-current menu">%1</span>',o="";return t===!1?xe.tool(e,t):(w(t)&&(o=t[0],t=t[1],i='<i class="'+ge($e.i,[o])+'"></i> '+i),xe.tool(e,{i:o,text:ge(i,[r[t]&&r[t].text||t,o]),click:function(t){var u,f,c,a,p,d,h,n={href:"","class":ke+"-button"};return xe.drop("menu menu-"+ve(e),function(e){function t(e){return a=this,h=r[a.getAttribute(J)],u=Je(a),h&&h.active&&y(d=h.click)&&(d=d(e,l),Ne&&Je(tt(Ne)[0]||Ne,ge(i,[u,o])),d===!1)?oe(e):(l.select(),oe(e))}for(c in r)p=r[c],p=$(p)?xe.tools[p]:p,p&&(ht(p,c),n[J]=c,f=De("a",p.text||c,s(n,p.attributes||{})),!f.title&&(d=p.title)&&(f.title=w(d)?d[0]+(d[1]?" ("+d[1]+")":""):d),p.active||Qe(f,"x"),r[c]=p,ce(M,f,t),ct(e,f))}),!1}},n),re("update.menus",[l]),l)},xe.menu.fit=function(e){return xe.drop.fit(e)},xe.bubble=function(){xe.exit(0,0,0);var n,e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),n=ve(t),Ve(Ie),ct(T,De(Ie,!1,{"class":ke+"-bubble "+n})),y(r)?r(Ie):De(Ie,r),xe.bubble.fit(),re("enter.bubble."+t,[l]),re("enter.bubble",[l]),l},xe.bubble.fit=function(e){var t=l.$(1),r=ye(Le),n=p(Le,"line-height"),i="border-",o="-width",u=t.caret[0].x+r.l-Le.scrollLeft,f=t.caret[1].y+r.t+n-Le.scrollTop,c=p(Ke,[i+"top"+o,i+"bottom"+o,i+"left"+o,i+"right"+o]),a=be(Ke),s=be(Ie),h=c[0]+c[1],g=c[2]+c[3];return w(e)?(u=e[0],f=e[1]):(u=d(u,r.l,r.l+a.w-s.w-g),f=d(f,r.t,r.t+a.h-s.h-h)),p(Ie,{left:u+V,top:f+V,visibility:"visible"}),re("fit.bubble",[l]),re("fit",[l]),l},xe.tool=function(e,t,r){var n="";return"|"!==e&&(z.tools=z.tools.filter(function(t,r){return t===e?(n=r,!1):!0})),t===!1?delete xe.tools[e]:("|"===e?(r=t,t={}):(y(t)&&(t={click:t}),xe.tools[e]=s(xe.tools[e]||{},t),k(r)||""===n||(r=n)),b(r)?z.tools.splice(r,0,e):z.tools.push(e)),gt(),l},xe.key=function(e,t){return z.keys?(t===!1?delete xe.keys[e]:xe.keys[e]=t,vt(),l):l},xe.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(X),!1},outdent:function(e,t){return t.outdent(X),!1}},ce(M,Pe,Xt),xe.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Xt(e)},"shift+tab":Z?"outdent":0,tab:Z?"indent":0,escape:function(e,t){return Pe.focus(),!1}},xe.el={container:Se,header:ze,body:Ke,footer:Ae,overlay:Re,modal:We,drop:Me,bubble:Ie},l.config=z,s(l._,{time:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours(),o=e.getMinutes(),u=e.getSeconds(),f=e.getMilliseconds();return 10>r&&(r="0"+r),10>n&&(n="0"+n),10>i&&(i="0"+i),10>o&&(o="0"+o),10>u&&(u="0"+u),10>f&&(f="0"+f),[""+t,""+r,""+n,""+i,""+o,""+u,""+f]},replace:he,format:ge,el:De,event:{set:ce,reset:ae,fire:se,x:oe},hooks:C,hook:{set:ee,reset:te,fire:re}}),xe};