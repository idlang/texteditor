/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.10
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function ge(e){return F(e)?R(e).split(/\s+/):e}function me(e){return S(e)?e.join(" "):e}function He(e,t,n){return C(e)?C(t)?(C(H[e])||(H[e]={}),C(n)||(n=Object.keys(H[e]).length),H[e][n]=t,a):H[e]:H}function De(e,t){return C(e)?C(t)&&C(H[e])?(delete H[e][t],a):(H[e]={},a):(H={},a)}function Me(e,t,n){if(!C(H[e]))return H[e]={},a;if(C(n))C(H[e][n])&&H[e][n].apply(a,t);else for(K in H[e])H[e][K].apply(a,t);return a}function ve(e,t,n){if(S(t))for(K in t)ve(e,K,t[K]);else e.setAttribute(t,n)}function Ue(t,n,r){if(F(n))return Ue(t,[n],C(r)?r:"")[0];e=[];for(K in n)K=n[K],(K=t.getAttribute(K))&&e.push(K);return e.length?e:C(r)?r:[]}function Be(e,t){if(S(t))for(K in t)Be(e,t[K]);else if(C(t))e.removeAttribute(t);else for(Be(e,"class"),K=0,x=e.attributes,Y=x.length;Y>K;++K)x[K]&&Be(e,x[K].name)}function Pe(e,t,n){if(S(t))for(K in t)Pe(e,K,t[K]);else ve(e,"data-"+t,n)}function ye(t,n,r){if(F(n))return ye(t,[n],C(r)?r:"")[0];e=[];for(K in n)K=n[K],(K=Ue(t,"data-"+K))&&e.push(K);return e.length?e:C(r)?r:[]}function We(e,t){if(S(t))for(K in t)Be(e,"data-"+t[K]);else if(C(t))Be(e,"data-"+t);else for(K=0,x=e.attributes,Y=x.length;Y>K;++K)x[K]&&"data-"===x[K].name.slice(0,5)&&Be(e,x[K].name)}function ke(e){return e&&e.preventDefault(),!1}function we(e,t,n){if(t){for(e=ge(e),K=0,x=e.length;x>K;++K)t.addEventListener(e[K],n,!1),He("on:"+e[K],n,et(t));return a}}function Ke(e,t,n){if(t){for(e=ge(e),K=0,x=e.length;x>K;++K)t.removeEventListener(e[K],n,!1),De("on:"+e[K],et(t));return T(t)&&t.id.split(":")[0]===St+"-dom"&&Be(t,"id"),a}}function xe(e,t,n){e=ge(e);var i,r="createEvent"in f;for(K=0,x=e.length;x>K;++K)r?(i=f.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[K],!0,!1),t.dispatchEvent(i)):Me("on:"+e[K],n,et(t));return a}function Ye(e,t,n){for(K=0,x=t.length,Y;x>K;++K)Y=t[K],e=e.replace(h(Y)?Y:O(u(Y),"g"),n&&n[K]||"");return e}function $e(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,C(t[n])?t[n]:e})}function Ve(e){return R(Ye(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function _e(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=Qe(e);return{x:n-i.l,y:r-i.t}}function Qe(e){for($=e.offsetLeft,z=e.offsetTop;e=e.offsetParent;)$+=e.offsetLeft,z+=e.offsetTop;return{l:$,t:z}}function qe(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Xe(e,t){for(;(e=it(e))&&e!==t;);return e}function je(e,t){t=ge(t);for(K in t)e.classList.add(t[K])}function ze(t,n,r){if(F(n))return ze(t,[n],C(r)?r:"")[0];e=[];for(K in n)K=n[K],t.classList.contains(K)&&e.push(K);return e.length?e:C(r)?r:!1}function Je(e,t){if(C(t)){t=ge(t);for(K in t)e.classList.remove(t[K])}else Be(e,"class")}function Ze(e,t,n){if(e=F(e)?f.createElement(e):e,S(n))for(K in n)if(Z=n[K],"classes"===K)je(e,Z);else if("data"===K)for(x in Z)Z=Z[x],null===Z?We(e,x):Pe(e,x,Z);else"css"===K?F(Z)?ve(e,"style",Z):null===Z?Be(e,"style"):A(e,Z):d(Z)?e[K]=Z:null===Z?Be(e,K):ve(e,K,S(Z)?Z.join(" "):""+Z);if(T(t))Rt(e,t);else if(S(t))for(K in t)Z=t[K],T(Z)?Rt(e,Z):Z!==!1&&tt(e,Z);else C(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=St+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(C(t)?t:"")}function rt(e,t){if(t!==!1&&(B=ot(e)))for(K=0,x=B.length;x>K;++K)rt(B[K]);tt(e,"")}function it(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function ft(e){return e&&e.previousSibling}function at(e,t){return e&&F(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&d(t)?e===t(e):e===t}function st(t,n){if(!(n=C(n)?n:f))return[];if(e=[],F(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(K=0,x=t.length;x>K;++K)e.push(t[K]);return e}return[]}for(t=n.querySelectorAll(t),K=0,x=t.length;x>K;++K)e.push(t[K]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=it(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){Q=it(e),Q&&Q.insertBefore(t,e)}function At(e,t){Q=it(e),Q&&Q.insertBefore(t,lt(e))}function Et(e,t){B=ot(e)[0],B?ct(B,t):Rt(e,t)}function Ot(e,t){Rt(e,t)}function Rt(e,t){e.appendChild(t)}function It(e,t){var n=ut(e);if(n){if(t!==!1)for(B=ot(e)[0];B;)It(B);n.removeChild(e)}}function Lt(e){rt(Ze(e,!1,{style:""})),It(e)}function Nt(e,t,n){return Ze(t||"div",n,{"class":e})}function _t(e){return!e||C(e.active)&&!j.active}function Qt(){Gt._word&&Gt._words&&(Z=(vt.value||"").replace(O(he[0]+"[^"+he[0]+he[1]+"]+?"+he[1],"g"),""),K=(Z.match(/(\w+)/g)||[]).length,tt(Kt,$e(Gt["_word"+(1===K?"":"s")],[K])))}function qt(e,t,n){return d(e)&&(e={click:e}),F(e.click)&&(e.click=(n[e.click]||{}).click),C(e.title)||(e.title=ht[t]||""),n[t]=e,e}function Xt(e){Tt.exit(0,0,0);var t=ye(this,Ce),n=Tt.tools,r=n[t];return Tt.drop.target=e.currentTarget||e.target,!_t(r)&&d(x=r.click)&&(x=x(e,a,t),Me("on:change",[e,a,t]),x===!1)?ke(e):(a.select(),ke(e))}function jt(e){if(z=this,(Y=e.TE.key)(/^(escape|f10)$/))Tt.exit(1);else if(Y("enter"))Tt.drop.target=z,xe(Ae,z,[e]);else if(Y("arrowright")&&($=lt(z))){for(;!at($,"a")&&$;)$=lt($);$&&$.focus()}else if(Y("arrowleft")&&($=ft(z))){for(;!at($,"a")&&$;)$=ft($);$&&$.focus()}return ke(e)}function zt(){rt(Mt,!1);var r,i,o,l,f,s,u,e=ge(M.tools),t=St+"-button",n=St+"-separator";M.tools=e;for(s in e)u=e[s],i=Tt.tools[u],(i||i==={})&&(i=qt(i,u,Tt.tools),o=i.i||u,"|"!==o&&"<"!==o[0]&&(o=Ve(o)),l="|"!==o,f=Ve(o).replace(/\s/g,""),$t=Nt(l?t+" "+t+"-"+f:n+" "+n+"-"+s,l?"a":"span"),l?(r=t+":"+f,ve($t,{href:Ge,id:r,tabindex:-1}),Pe($t,Ce,u),o="<"===o[0]?o:'<i class="'+$e(pt,[o])+'"></i>',_t(i)&&je($t,"x"),i.text&&(o=$e('<span class="'+St+'-text">'+i.text+"</span>",[o]),je($t,"text")),tt($t,o),Ze($t,!1,i.attributes||{}),!$t.title&&(x=i.title)&&($t.title=S(x)?x[0]+(x[1]?" ("+x[1]+")":""):x),we(Ae,$t,Xt),we(ie,$t,jt)):$t.id=n+":"+s,Tt.tools[u].target=$t,Rt(Mt,$t));Me("update.tools",[a])}function Jt(){Tt.keys=function(){var n,e=Object.keys(Tt.keys).sort().reverse(),t={};for(K=0,x=e.length;x>K;++K)n=e[K],t[n]=Tt.keys[n];return t}(),rn(1),Me("update.keys",[a])}function Zt(e){Qt(),Me("on:change",[e,a])}function nn(t){function E(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=a.$(),r=n.before,i=n.after,o=r.slice(-1),l=i[0],f=n.length,s=Tt.keys,c=TE.keys_alias,A=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();_=t.TE.key(),en[_]=1,e=Object.keys(en).length,I(function(){a.record()},1);for(K in s){Y=E(K),B=0;for(x in Y)x=Y[x],en[c[x]||x]&&++B;if(Y=Y.length,B===Y&&e===Y&&(F(s[K])&&(s[K]=Tt.tools[s[K]].click),$=s[K]&&s[K](t,a),$===!1))return ke(t)}if(de)for(K in de)if(V=de[K],V!==!1){if(_===V&&l===V)return"\\"===o?(a.insert(_,0),ke(t)):(a.select(n.end+1),ke(t));if(K===_)return a.wrap(K,V),ke(t);if(o===K&&l===V){if("backspace"===_&&r.slice(-2)!=="\\"+K)return a.unwrap(K,V),ke(t);if(Te&&"enter"===_&&K!==V)return a.tidy("\n"+A+Ne,"\n"+A),ke(t)}}if(Te&&!f){if("backspace"===_&&O(u(Ne)+"$").test(r))return a.outdent(Ne),ke(t);if("enter"===_&&O("(^|\\n)("+u(Ne)+")+.*$").test(r))return a.insert("\n"+A,0,1),ke(t)}}function rn(e){S(e)?delete en[e.TE.key()]:en={}}function on(e){/^(focus|blur)$/.test(e.type)&&rn(1),L(tn),tn=I(function(){Zt(e)},M.debounce||0)}function un(e){return ln=Ut,j=qe(Dt),ke(e)}function cn(e){ln===Ut&&A(vt,{height:_e(Ht,e).y-j.h+be})}function An(){ln=0}function En(){Tt.exit(1)}function On(){e=qe(yt),ee=e.w,w=e.h,e=qe(Pt),fn=e.w,an=e.h}function Rn(e,t){t&&Me("exit.modal."+t,[a]),xe(Ae,Pt,[e])}function In(t){ln=t.target,e=_e(yt,t),te=e.x,ne=e.y,On()}function Ln(t){var n=sn.header,r=sn.resize;ln===n||Xe(ln,n)===n?(e=_e(Ht,t),$=e.x-te,z=e.y-ne,A(yt,{left:(ee>fn?$:E($,0,fn-ee))+be,top:(w>an?z:E(z,0,an-w))+be})):ln===r&&(e=_e(yt,t),j=qe(r),A(yt,{width:e.x+j.w/4+be,height:e.y+j.h/4+be}))}function Nn(){ln=0}function Tn(e,t,n){return{header:e,body:t,footer:n}}function dn(e){v=Tt.drop.target,U=Wt,B=e&&e.target||0,(!B||B!==v&&Xe(B,v)!==v)&&(Tt.drop.target=0,Lt(Wt),Ke(Ae,f,dn),Ke(Re,l,dn),Tt.exit(e.target===m))}function hn(t){function i(){e&&(Q=qe(e),A(X,{width:Q.w+be,height:Q.h+be}))}var n=a.get(),r="";return-1===n.indexOf("</html>")&&(r='<!DOCTYPE html><html dir="'+M.dir+'"><head><meta charset="utf-8"><style>'+M.css+"</style></head><body>"+n+"</body></html>"),X=Ze("iframe",!1,{"class":St+"-portal",src:"data:text/html,"+encodeURIComponent(r)}),!ut(Pt)&&n?(Tt.overlay(X,1,function(){e=ot(Pt)[0],i(),we(Re,l,i),Me("enter.overlay.preview",[t,a,[n,r],e])}),Sn=!0):(Ke(Re,l,i),En(),Sn=!1),ke(t)}var v,U,B,y,W,w,K,x,Y,$,V,_,e,Q,X,j,z,Z,ee,te,ne,t="⌘",n="…",i="⇥",o="⇧",l=window,f=document,a=this,s=a._,u=s.x,c=s.extend,A=s.css,E=s.edge,O=s.pattern,R=s.trim,I=s.timer.set,L=s.timer.reset,N=a.is,T=N.e,d=N.f,p=N.i,S=N.o,h=N.r,F=N.s,C=function(e){return!N.x(e)},G=f.documentElement,g=(f.head,f.body),m=a.target,H={},D=function(){},M=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{preview:["Preview","F5"],undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",oe="keyup",le="copy",fe="cut",ae="paste",se="touchstart mousedown",ue="touchend mouseup",ce="touchmove mousemove",Ae="click",Ee="focus",Oe="blur",Re="orientationchange resize",Ie=Oe+" "+le+" "+fe+" "+Ee+" input "+ie+" "+ae,Le=M.languages,Ne=M.tab,Te=M.auto_tab,de=M.auto_close,pe=M.unit[0][0],he=(M.unit[0][1],M.unit[1][0]),Fe=M.unit[1][1],Ce="tool-id",Ge="javascript:;",be="px",Tt=a.ui={};a.tidy=function(e,t){var n=a.$(),r=R(n.before)?e:"",i=R(n.after)?C(t)?t:e:"";return a.trim(r,i)},a.i=function(){return R(a.replace(/\s+/g," "))},a.format=function(e,t,n,r){S(e)||(e=[e]),C(n)||(n=" "),C(r)||(r="");var i=a.h,o=a[0]().$(),l=(e[0]?pe[0]+e[0]+pe[1]:"")+r,f=r+(e[0]?pe[0]+pe[2]+(e[1]||e[0].split(O("("+Fe[3]+")+"))[0])+pe[1]:""),s=u(l),c=u(f),A=O("^"+s+"([\\s\\S]*?)"+c+"$"),E=O(s+"$"),R=O("^"+c),I=o.before,L=o.after;return o.length?n=!1:a.insert(Le.placeholders[""]),a.toggle(t?!A.test(o.value):!E.test(I)&&!R.test(L),[function(e){e.unwrap(l,f,1).tidy(O(he[0]+"[^"+he[0]+he[1]+he[2]+"]+?"+he[1]+"$").test(I)?"":n,O("^"+he[0]+he[2]+"[^"+he[0]+he[1]+"]+?"+he[1]).test(L)?"":n).wrap(l,f,t)},function(e){e.unwrap(l,f,t)}])[i]()};var $t,dt=M.classes,pt=dt.i,St=dt[""],ht=Le.tools,Ft=Le.buttons,Ct=Le.labels,Gt=Le.others,bt=St+"-textarea "+St+"-content block",gt=Nt(St),mt=Nt(St+"-header"),Ht=Nt(St+"-body"),Dt=Nt(St+"-footer"),Mt=Nt(St+"-tool"),vt=Ze(m,!1,M.attributes),Ut=Nt(St+"-resize s"),Bt=Nt(St+"-description"),Pt=Nt(St+"-overlay"),yt=Ze("div"),Wt=Ze("div"),kt=Ze("div"),wt=Nt("left","span"),Kt=Nt("right","span"),xt=Nt(St+"-preview","a"),Yt=0;M.suffix||(M.suffix=pe[1]);var en={},tn=null;a.create=function(e,t){S(e)&&(M=c(M,e));var n=ut(vt);return je(vt,bt),n&&at(n,"p")?(ct(n,gt),Yt=n,It(n,!1)):ct(vt,gt),gt.dir=M.dir,Rt(gt,mt),Rt(gt,Ht),Rt(gt,Dt),Rt(gt,Ut),Rt(Ht,vt),M.tools&&(Rt(mt,Mt),Rt(Dt,Bt),Rt(Bt,wt),Rt(Bt,Kt)),we(ie,vt,nn),we(oe,vt,rn),we(Ie,vt,on),we(se,Ut,un),we(ce,f,cn),we(ue,g,An),(j=ht.preview)&&(ve(xt,{href:Ge,title:S(j)?j[0]+(j[1]?" ("+j[1]+")":""):j}),Rt(wt,xt),tt(xt,Gt.preview)),Zt(null),zt(),Jt(),0!==t?Me("create",[a]):a},a.update=function(e,t){return ze(vt,ge(bt),0)&&a.destroy(0),(0!==t?Me("update",[a]):a).create(e,0)},a.destroy=function(e){return ze(vt,ge(bt),0)?(Tt.exit(0,0,0),Je(vt,bt),M.tools=me(M.tools),M.keys&&(Ke(ie,vt,nn),Ke(oe,vt,rn)),Ke(se,Ut,un),Ke(ce,f,cn),Ke(ue,f,An),Ke(Ie,vt,on),Yt?(ct(gt,Yt),Rt(Yt,vt),Yt=0):ct(gt,vt),Lt(gt),0!==e?Me("destroy",[a]):a):a};var ln=0,te=0,ne=0,ee=0,w=0,fn=0,an=0,sn={};Tt.exit=function(e,t,n){if(W={overlay:function(){Ke(Ae,Pt,En),Lt(Pt)},modal:function(){Ke(se,Ht,In),Ke(ce,Ht,Ln),Ke(ue,f,Nn),Ke(Ae,sn.x,Rn),Lt(yt)},drop:function(){Lt(Wt)},bubble:function(){Lt(kt)}},t)if(S(t))for(K in t)K=t[K],W[K]&&W[K](),0!==n&&Me("exit."+K,[a]);else W[t]&&W[t](),0!==n&&Me("exit."+K,[a]);else for(K in W)W[K]();return e&&a.select(),0!==n&&Me("exit",[a]),a},Tt.overlay=function(e,t,n){return Tt.exit(0,0,0),rn(1),Rt(Ht,Ze(Pt,e.length||T(e)?Nt(St+"-overlay-content","div",e):"")),t&&we(Ae,Pt,En),d(n)?n(Pt):Ze(Pt,n),Me("enter.overlay",[a]),Me("enter",[a]),a},Tt.overlay.fit=function(){},Tt.modal=function(){Tt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=St+"-modal";S(t)&&(t="default",n=e[0],r=e[1]),$=Ve(t),Ze(yt,!1,{"class":i+" "+$}),C(n.body)&&(n.body=Ze("div",n.body,{"class":i+"-content "+$}));for(K in n)i[1]=K,sn[K]=Nt(i+"-"+$e(K,i)+" "+$,0,n[K]);return sn.x=Nt(St+"-x "+$),sn.resize=Nt(St+"-resize se "+$),rt(yt),Rt(Ht,Ze(yt,sn,{style:""})),Tt.modal.fit(),At(yt,Pt),we(Ae,sn.x,Rn),we(se,sn.header,ke),we(se,sn.resize,ke),we(se,Ht,In),we(ce,Ht,Ln),we(ue,f,Nn),d(r)&&(sn.overlay=Pt,sn.modal=yt,r(sn)),Me("enter.modal."+t,[a]),Me("enter.modal",[a]),Me("enter",[a]),a},Tt.modal.fit=function(e){return On(),$=fn/2-ee/2,z=an/2-w/2,S(e)?(C(e[0])&&($=e[0]),C(e[1])&&(z=e[1])):($=E($,0),z=E(z,0)),A(yt,{left:$+be,top:z+be,"min-width":ee+be,"min-height":w+be,visibility:"visible"}),Me("fit.modal",[a]),Me("fit",[a]),a};var pn={"class":St+"-button",name:"y"};Tt.alert=function(e,t,n,r){var i=Ze("button",Ft.okay,pn),o="alert";return n=n||D,S(e)&&(o+=":"+e[0],e=e[1]||e[0]),we(Ae,i,function(e){return n(e,a),Rn(e,o+".y"),ke(e)}),we(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(xe(Ae,i,[e]),ke(e)):void 0}),Tt.modal(o,Tn(e,t,i),r),i.focus(),a},Tt.confirm=function(e,t,n,r,i){function u(e){return d(n)&&n(e,a),Rn(e,f+".y"),ke(e)}function c(e){return d(r)&&r(e,a),Rn(e,f+".n"),ke(e)}var s,o=Ze("button",Ft.okay,pn),l=Ze("button",Ft.cancel,pn),f="confirm";return l.name="n",S(e)&&(f+=":"+e[0],e=e[1]||e[0]),we(Ae,o,u),we(Ae,l,c),we(ie,o,function(e){return s=e.TE.key,s("arrowright")?(l.focus(),ke(e)):s("arrowleft")?ke(e):s("enter")?(u(e),ke(e)):s("escape")?(Rn(e,f+".y"),ke(e)):void 0}),we(ie,l,function(e){return s=e.TE.key,s("arrowright")?ke(e):s("arrowleft")?(o.focus(),ke(e)):s("enter")?(c(e),ke(e)):s("escape")?(Rn(e,f+".n"),ke(e)):void 0}),Tt.modal(f,Tn(e,t,[o,l]),i),l.focus(),a},Tt.prompt=function(e,t,n,r,i,o){function O(){s.focus(),"placeholder"in s&&s.select()}function I(e){return ke(e)}function L(e){return A=s.value,!n||R(A)&&A!==t?(Rn(e,u+".y"),ke(e),r(e,a,A!==t?A:"",t)):(O(),I(e))}function N(e){return Rn(e,u+".n"),ke(e)}var A,E,l=Ze("button",Ft.okay,pn),f=Ze("button",Ft.cancel,pn),s=Ze("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":St+"-input block"}),u="prompt",c=[];if(S(e)&&(u+=":"+e[0],e=e[1]||e[0]),d(i)&&(o=i,i=0),1===i)s=Ze("textarea",t,{placeholder:t.split("\n")[0],"class":St+"-textarea block"});else if(2===i){for(K in t)c.push(Ze("option",t[K],{value:K,selected:K===n||null}));s=Ze("select",c,{"class":St+"-select block"})}return r=r||D,s.name="data",f.name="n",we(ie,s,function(e){return E=e.TE.key,E("enter")?L(e):E("escape")||E("backspace")&&!this.value?N(e):E("arrowup")?I(e):E("arrowdown")?(l.focus(),ke(e)):void 0}),we(ie,l,function(e){return E=e.TE.key,E("enter")?L(e):E("escape")?N(e):E("arrowup")?(s.focus(),ke(e)):E("arrowright")?(f.focus(),ke(e)):E(/^arrow(down|left)$/)?I(e):void 0}),we(ie,f,function(e){return E=e.TE.key,E(/^(enter|escape)$/)?N(e):E("arrowup")?(s.focus(),ke(e)):E(/^arrow(right|down)$/)?I(e):E("arrowleft")?(l.focus(),ke(e)):void 0}),we(Ae,l,L),we(Ae,f,N),Tt.modal(u,Tn(e,s,[l,f]),o),O(),a},Tt.drop=function(){Tt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),$=Ve(t),rt(Wt),Rt(g,Ze(Wt,!1,{"class":St+"-drop "+$})),d(n)?n(Wt):Ze(Wt,n),Tt.drop.fit(),we(Ae,f,dn),we(Re,l,dn),Me("enter.drop."+t,[a]),Me("enter.drop",[a]),a},Tt.drop.fit=function(t){return v=qe(G),U=qe(Wt),B=Tt.drop.target,$=v.w/2-U.w/2,z=v.h/2-U.h/2,!C(t)&&B&&(e=Qe(B),$=e.l,z=e.t+qe(B).h),S(t)?(C(t[0])&&($=t[0]),C(t[1])&&(z=t[1])):($=E($,0,Math.max(v.w,l.innerWidth)-U.w),z=E(z,0,Math.max(v.h,l.innerHeight)-U.h)),A(Wt,{left:$+be,top:z+be,visibility:"visible"}),Me("fit.drop",[a]),Me("fit",[a]),a},Tt.menu=function(e,t,n,r){t=!S(t)&&n[t]&&n[t].text||t;var s,i=Tt.tools,o='<span class="'+St+'-current menu">%1</span>',l="",f=0;return t===!1?Tt.tool(e,t):(S(t)&&(l=t[0],l="<"===l[0]?l:'<i class="'+$e(pt,[l])+'"></i>',t=C(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,o=l+(0!==t?" "+o:"")),Tt.tool(e,{i:l,text:t?$e(o,[t,l]):0,click:function(u){return Tt.drop("menu menu-"+Ve(e),function(u){function A(e){return z=this,V=n[ye(z,Ce)],V=F(V)?i[V]:V||{},_=nt(z),!_t(V)&&d(r=V.click)&&(r=r(e,a),t!==!1&&v&&(B=ot(v)[0]||v,at(B,"i")||tt(B,$e(o,[_,l])),S(V.text)&&(B=ot(B)[0])&&at(B,"i")&&(Je(B),je(B,$e(pt,[V.text[0]])))),r===!1)?ke(e):(a.select(),ke(e))}function E(e){if(z=this,(Y=e.TE.key)("escape"))Tt.exit(1);else if(Y("enter"))xe(Ae,z,[e]);else if(Y("f10")&&v)v.focus();else if(Y("arrowdown")&&($=lt(z))){for(;!at($,"a")&&$;)$=lt($);$&&$.focus()}else if(Y("arrowup")&&($=ft(z))){for(;!at($,"a")&&$;)$=ft($);!$&&v?(Tt.exit(),v.focus()):$&&$.focus()}else Y("arrowup")&&v&&(Tt.exit(),v.focus());return ke(e)}v=Tt.drop.target;for(r in n)if(s=n[r],ee="%"===r[0],s=F(s)&&!ee?i[s]:s){s=qt(s,r,i);var O={href:ee?null:Ge,"class":St+"-"+(ee?"label":"button")};ee?x=Ct[e]&&Ct[e][+r.slice(1)-1]||r:(O.data={},O.data[Ce]=r,x=ht[r]||r),X=s.text,X=S(X)?X[1]||"":X,x=S(x)?x[0]:x,j=Ze(ee?"span":"a",ee?"<span>"+(x||"%"+f)+"</span>":s.text||x,c(O,s.attributes||{})),!j.title&&(z=s.title)&&(j.title=S(z)?z[0]+(z[1]?" ("+z[1]+")":""):z),ee?ve(j,{id:St+"-label:"+f}):(_t(s)&&je(j,"x"),we(Ae,j,A),we(ie,j,E)),n[r]=s,Rt(u,j),++f}I(function(){st("a",u)[0].focus()},1)}),!1}},r),we(ie,i[e].target,function(t){return t.TE.key("arrowdown")?(Tt.drop.target=this,i[e].click(y,a),ke(t)):void 0}),i[e].data=n,a)},Tt.bubble=function(){Tt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),$=Ve(t),rt(kt),Rt(g,Ze(kt,!1,{"class":St+"-bubble "+$})),d(n)?n(kt):Ze(kt,n),Tt.bubble.fit(),Me("enter.bubble."+t,[a]),Me("enter.bubble",[a]),a},Tt.bubble.fit=function(t){j=a.$(1),e=Qe(vt),w=A(vt,"line-height");var n="border-",r="-width";$=j.caret[0].x+e.l-vt.scrollLeft,z=j.caret[1].y+e.t+w-vt.scrollTop,U=A(Ht,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=qe(Ht),o=qe(kt),l=U[0]+U[1],f=U[2]+U[3];return S(t)?(C(t[0])&&($=t[0]),C(t[1])&&(z=t[1])):($=E($,e.l,e.l+i.w-o.w-f),z=E(z,e.t,e.t+i.h-o.h-l)),A(kt,{left:$+be,top:z+be,visibility:"visible"}),Me("fit.bubble",[a]),Me("fit",[a]),a},Tt.overlay.exit=function(e){return Tt.exit(e,"overlay")},Tt.modal.exit=function(e){return Tt.exit(e,"modal")},Tt.drop.exit=function(e){return Tt.exit(e,"drop")},Tt.bubble.exit=function(e){return Tt.exit(e,"bubble")},Tt.tool=function(e,t,n){return x="","|"!==e&&(M.tools=M.tools.filter(function(t,n){return t===e?(x=n,!1):!0})),t===!1?delete Tt.tools[e]:("|"===e?(n=t,t={}):(d(t)&&(t={click:t}),Tt.tools[e]=c(Tt.tools[e]||{},t),C(n)||""===x||(n=x)),p(n)?M.tools.splice(n,0,e):M.tools.push(e)),zt(),a},Tt.key=function(e,t){return M.keys?(t===!1?delete Tt.keys[e]:Tt.keys[e]=t,Jt(),a):a};var Sn=!1;return we(Ae,xt,hn),Tt.tools={"|":{},preview:{i:"eye",click:function(e){return Sn?(En(),Sn=!1):hn(e),!1}},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Ne),!1},outdent:function(e,t){return t.outdent(Ne),!1}},Tt.keys={"control+y":"redo","control+z":"undo",f5:"preview",f10:function(e,t){return st("a",Mt)[0].focus(),!1},"shift+tab":Te?"outdent":0,tab:Te?"indent":0,escape:function(e,t){return xt.focus(),!1}},Tt.el={container:gt,header:mt,body:Ht,footer:Dt,overlay:Pt,modal:yt,drop:Wt,bubble:kt},a.config=M,c(a._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=e.getSeconds(),f=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>l&&(l="0"+l),10>f&&(f="0"+f),[""+t,""+n,""+r,""+i,""+o,""+l,""+f]},replace:Ye,format:$e,dom:{set:Rt,reset:It,get:st,id:et,copy:function(e,t){return e.cloneNode(C(t)?t:!0)},classes:{set:je,reset:Je,get:ze},attributes:{set:ve,reset:Be,get:Ue},data:{set:Pe,reset:We,get:ye},is:at,offset:Qe,point:_e,size:qe,content:{set:tt,reset:rt,get:nt},closest:Xe,parent:it,children:ot,next:lt,previous:ft,before:ct,after:At,prepend:Et,append:Ot},el:Ze,event:{set:we,reset:Ke,fire:xe,x:ke},hooks:H,hook:{set:He,reset:De,fire:Me}}),Tt};