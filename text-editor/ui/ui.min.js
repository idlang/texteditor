/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.3.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function te(e,t,r){return x(e)?x(t)?(x(E[e])||(E[e]={}),x(r)||(r=Object.keys(E[e]).length),E[e][r]=t,s):E[e]:E}function re(e,t){return x(e)?x(t)&&x(E[e])?(delete E[e][t],s):(E[e]={},s):(E={},s)}function ne(e,t,r){if(!x(E[e]))return E[e]={},s;if(x(r))x(E[e][r])&&E[e][r].apply(s,t);else for(var n in E[e])E[e][n].apply(s,t);return s}function ie(e,t,r){if($(t))for(var n in t)ie(e,n,t[n]);else e.setAttribute(t,r)}function oe(e,t){e.removeAttribute(t)}function le(e){return e&&e.preventDefault(),!1}function ae(e,t,r){return t?(t.addEventListener(e,r,!1),te("on:"+e,r,Ge(t)),s):void 0}function se(e,t,r){return t?(t.removeEventListener(e,r,!1),re("on:"+e,Ge(t)),m(t)&&t.id.split(":")[0]===_e+"-dom"&&oe(t,"id"),s):void 0}function ce(e,t,r){if("createEvent"in a){var n=a.createEvent("HTMLEvents");n.data=r,n.initEvent(e,!0,!1),t.dispatchEvent(n)}else ne("on:"+e,r,Ge(t));return s}function ue(e,t,r){e=b(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)ae(e[n],t,r);return s}function fe(e,t,r){e=b(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)se(e[n],t,r);return s}function pe(e,t,r){e=b(e).split(/\s+/);for(var n=0,i=e.length;i>n;++n)ce(e[n],t,r);return s}function he(e,t){return setTimeout(e,t)}function de(e){return clearTimeout(e)}function be(e,t,r){for(var o,n=0,i=t.length;i>n;++n)o=t[n],e=e.replace(y(o)?o:d(u(o),"g"),r&&r[n]||"");return e}function ge(e,t){return e.replace(/%(\d+)/g,function(e,r){return--r,x(t[r])?t[r]:e})}function me(e){return b(be(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function ve(e,t){var r=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,i=ke(e);return{x:r-i.l,y:n-i.t}}function ke(e){for(var t=e.offsetLeft,r=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,r+=e.offsetTop;return{l:t,t:r}}function $e(e){return{w:e.offsetWidth,h:e.offsetHeight}}function ye(e,t){for(;(e=tt(e))&&e!==t;);return e}function Ye(e,t,r){if(e=w(e)?a.createElement(e):e,$(r)){var n,i;for(i in r)n=r[i],"style"===i?w(n)?ie(e,i,n):null===n?oe(e,i):e=p(e,n):v(n)?e[i]=n:null===n?oe(e,i):ie(e,i,$(n)?n.join(" "):""+n)}if(m(t))ut(e,t);else if($(t)){var n,i;for(i in t)n=t[i],m(n)?ut(e,n):n!==!1&&Ve(e,n)}else x(t)&&t!==!1&&Ve(e,t);return e}function Ge(e){var t=e.id;return t||(t=_e+"-dom:"+Date.now(),e.id=t),t}function Xe(e,t){return d("(^|\\s)"+t+"(\\s|$)").test(e.className)}function Ze(e,t){Xe(e,t)||(e.className=b(e.className+" "+t))}function Je(e,t){e.className=b(e.className.replace(d("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function Ve(e,t){return x(t)?void(e.innerHTML=t):e.innerHTML}function et(e,t){if(t!==!1){var n,r=e.children;for(n in r)et(r[n])}Ve(e,"")}function tt(e){return e.parentElement||e.parentNode}function rt(e){return e.children||[]}function nt(e){return e.nextElementSibling||e.nextSibling}function ot(e,t){var r=tt(e);return 1===arguments.length?r||!1:e&&r===e?r:!1}function lt(e,t){tt(e).insertBefore(t,e)}function at(e,t){tt(e).insertBefore(t,nt(e))}function ut(e,t){e.appendChild(t)}function ft(e,t){var r=ot(e);if(r){if(t!==!1)for(var n=rt(e)[0];n;)ft(n);r.removeChild(e)}}function pt(e){et(Ye(e,!1,{style:""})),ft(e)}function ht(e,t,r){return Ye(t||"div",r,{"class":e})}function dt(){if(Ee._word&&Ee._words){var e=(Ie.value||"").replace(d(X[0]+"[^"+X[0]+X[1]+"]+?"+X[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;Ve(Ne,ge(Ee["_word"+(1===t?"":"s")],[t]))}}function bt(e,t){v(e)&&(e.click=e),w(e.click)&&(e.click=(we.tools[e.click]||{}).click),x(e.active)||(e.active=1),x(e.title)||(e.title=Te[t]||"")}function gt(){et(Oe,!1);var n,i,o,l,a,c,u,e=w(L.tools)?b(L.tools).split(/\s+/):L.tools,t=_e+"-button",r=_e+"-separator";L.tools=e;for(a in e)u=e[a],i=we.tools[u],i&&(bt(i,u),"|"!==(o=i.i||u)&&(o=me(o)),l="|"!==o,Qe=ht(l?t:r,l?"a":"span"),l&&(n=t+":"+me(u).replace(/\s/g,""),ie(Qe,{href:V,id:n,"tab-index":-1}),ie(Qe,J,u),o='<i class="'+ge(xe.i,[o])+" "+n+'"></i>',i.active||Ze(Qe,"x"),i.text&&(o=ge('<span class="'+_e+'-text">'+i.text+"</span>",[o]),Ze(Qe,"text")),Ve(Qe,o),Ye(Qe,!1,i.attributes||{}),!Qe.title&&(c=i.title)&&(Qe.title=$(c)?c[0]+(c[1]?" ("+c[1]+")":""):c),ue(A,Qe,_t)),ut(Oe,Qe));ne("update.tools",[s])}function mt(){we.keys=function(){var r,n,e=Object.keys(we.keys).sort().reverse(),t={};for(r=0,n=e.length;n>r;++r)t[e[r]]=we.keys[e[r]];return t}(),wt(1),ne("update.keys",[s])}function vt(e){dt(),ne("on:change",[e,s])}function yt(e){function $(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var p,h,b,g,m,k,t=s.$(),r=t.before,n=t.after,i=r.slice(-1),o=n[0],l=t.length,a=we.keys,c=TE.keys_alias,f=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),v=e.TE.key();kt[v]=1,k=Object.keys(kt).length,he(function(){s.record()},1);for(p in a){var y=0;b=$(p);for(h in b)h=b[h],kt[c[h]||h]&&++y;if(b=b.length,y===b&&k===b&&(w(a[p])&&(a[p]=we.tools[a[p]].click),g=a[p]&&a[p](e,s),g===!1))return le(e)}if(W)for(p in W)if(m=W[p],m!==!1){if(v===m&&o===m)return"\\"===i?(s.insert(v,0),le(e)):(s.select(t.end+1),le(e));if(p===v)return s.wrap(p,m),le(e);if(i===p&&o===m){if("backspace"===v&&r.slice(-2)!=="\\"+p)return s.unwrap(p,m),le(e);if(Q&&"enter"===v&&p!==m)return s.tidy("\n"+f+D,"\n"+f).scroll(!0),le(e)}}if(Q&&!l){if("backspace"===v&&d(u(D)+"$").test(r))return s.outdent(D).scroll(!0),le(e);if("enter"===v&&d("(^|\\n)("+u(D)+")+.*$").test(r))return s.insert("\n"+f,0,1).scroll(!0),le(e)}}function wt(e){$(e)?delete kt[e.TE.key()]:kt={}}function xt(e){/^focus|blur$/.test(e.type)&&wt(1),de($t),$t=he(function(){vt(e)},L.debounce||0)}function _t(e){we.exit(0,0,0);var i,t=this.getAttribute(J),r=we.tools,n=r[t];return De=e.currentTarget||e.target,n&&n.active&&n.click&&(i=r[t].click(e,s,t),ne("on:change",[e,s,t]),i===!1)?le(e):(s.select(),le(e))}function It(e){return Tt=je,Ot=$e(ze),le(e)}function jt(e){Tt===je&&p(Ie,{height:ve(He,e).y-Ot.h+ee})}function Ut(){Tt=0}function Rt(){we.exit(1)}function At(){e=$e(Ae),Ct=e.w,Lt=e.h,e=$e(Re),St=e.w,Ht=e.h}function Mt(e,t){t&&ne("exit.modal."+t,[s]),pe(A,Re,[e])}function Pt(t){Tt=t.target,e=ve(Ae,t),qt=e.x,Et=e.y,At()}function Kt(t){var i,o,r=zt.header,n=zt.resize;Tt===r||ye(Tt,r)===r?(e=ve(He,t),i=e.x-qt,o=e.y-Et,p(Ae,{left:(Ct>St?i:h(i,0,St-Ct))+ee,top:(Lt>Ht?o:h(o,0,Ht-Lt))+ee})):Tt===n&&(e=ve(Ae,t),Ot=$e(n),p(Ae,{width:e.x+Ot.w/4+ee,height:e.y+Ot.h/4+ee}))}function Nt(){Tt=0}function Bt(e,t,r){return{header:e,body:t,footer:r}}function Ft(e){var t=De,n=e&&e.target||0;(!n||n!==t&&ye(n,t)!==t)&&(De=0,pt(Me),fe(A,q,Ft),we.exit(1))}function Qt(e){function a(){i&&(o=$e(i),p(n,{width:o.w+ee,height:o.h+ee}))}var n,i,o,t=s.get(),r="";return-1===t.indexOf("</html>")&&(r='<!DOCTYPE html><html dir="'+L.dir+'"><head><meta charset="utf-8"><style>'+L.css+"</style></head><body>"+t+"</body></html>"),n=Ye("iframe",!1,{"class":_e+"-portal",src:"data:text/html,"+encodeURIComponent(r)}),!ot(Re)&&t?we.overlay(n,1,function(){i=rt(Re)[0],a(),ue(N,l,a),ne("enter.overlay.preview",[e,s,[t,r],i])}):(fe(N,l,a),Rt()),le(e)}var t="⌘",r="…",i="⇥",o="⇧",l=window,a=document,s=this,c=s._,u=c.x,f=c.extend,p=c.css,h=c.edge,d=c.pattern,b=c.trim,g=s.is,m=g.e,v=g.f,k=g.i,$=g.o,y=g.r,w=g.s,x=function(e){return!g.x(e)},_=a.documentElement,q=(a.head,a.body),E={},C=function(){},L=f({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+r},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),S="keydown",H="keyup",z="copy",O="cut",I="paste",j="touchstart mousedown",U="touchend mouseup",R="touchmove mousemove",A="click",M="focus",P="blur",K="input",N="orientationchange resize",B=P+" "+z+" "+O+" "+M+" "+K+" "+S+" "+I,F=L.languages,D=L.tab,Q=L.auto_tab,W=L.auto_close,Y=L.unit[0][0],X=(L.unit[0][1],L.unit[1][0]),Z=L.unit[1][1],J="data-tool-id",V="javascript:;",ee="px",we=s.ui={};s.tidy=function(e,t){var r=s.$(),n=b(r.before)?e:"",i=b(r.after)?x(t)?t:e:"";return s.trim(n,i)},s.i=function(){return b(s.replace(/\s+/g," "))},s.format=function(e,t,r,n){$(e)||(e=[e]),x(r)||(r=" "),x(n)||(n="");var i=s[0]().$(),o=(e[0]?Y[0]+e[0]+Y[1]:"")+n,l=n+(e[0]?Y[0]+Y[2]+(e[1]||e[0].split(d("("+Z[3]+")+"))[0])+Y[1]:""),a=u(o),c=u(l),f=d("^"+a+"([\\s\\S]*?)"+c+"$"),p=d(a+"$"),h=d("^"+c),b=i.before,g=i.after;return i.length?r=!1:s.insert(F.placeholders[""]),s.toggle(t?!f.test(i.value):!p.test(b)&&!h.test(g),[function(e){e.unwrap(o,l,1).tidy(d(X[0]+"[^"+X[0]+X[1]+X[2]+"]+?"+X[1]+"$").test(b)?"":r,d("^"+X[0]+X[2]+"[^"+X[0]+X[1]+"]+?"+X[1]).test(g)?"":r).wrap(o,l,t)[1]()},function(e){e.unwrap(o,l,t)[1]()}])};var Qe,xe=L.classes,_e=xe[""],Te=F.tools,qe=F.buttons,Ee=F.others,Ce=_e+"-textarea "+_e+"-content block",Le=ht(_e),Se=ht(_e+"-header"),He=ht(_e+"-body"),ze=ht(_e+"-footer"),Oe=ht(_e+"-tool"),Ie=Ye(s.target,!1,L.attributes),je=ht(_e+"-resize s"),Ue=ht(_e+"-description"),Re=ht(_e+"-overlay"),Ae=Ye("div"),Me=Ye("div"),Pe=Ye("div"),Ke=ht("left","span"),Ne=ht("right","span"),Be=ht(_e+"-preview","a"),Fe=0,De=0;L.suffix||(L.suffix=Y[1]);var kt={},$t=null;s.create=function(e,t){$(e)&&(L=f(L,e));var r=ot(Ie);if(Ze(Ie,Ce),r&&"P"===r.nodeName?(lt(r,Le),Fe=r,ft(r,!1)):lt(Ie,Le),Le.dir=L.dir,ut(Le,Se),ut(Le,He),ut(Le,ze),ut(Le,je),ut(He,Ie),L.tools&&(ut(Se,Oe),ut(ze,Ue),ut(Ue,Ke),ut(Ue,Ne)),ue(S,Ie,yt),ue(H,Ie,wt),ue(B,Ie,xt),ue(j,je,It),ue(R,q,jt),ue(U,q,Ut),Ee.preview){var n=Te.preview;ie(Be,{href:V,title:$(n)?n[0]+(n[1]?" ("+n[1]+")":""):n}),ut(Ke,Be),Ve(Be,Ee.preview)}return vt(null),gt(),mt(),0!==t?ne("create",[s]):s},s.update=function(e,t){return Xe(Ie,Ce)&&s.destroy(0),(0!==t?ne("update",[s]):s).create(e,0)},s.destroy=function(e){return Xe(Ie,Ce)?(we.exit(0,0,0),Je(Ie,Ce),$(L.tools)&&(L.tools=L.tools.join(" ")),L.keys&&(fe(S,Ie,yt),fe(H,Ie,wt)),fe(j,je,It),fe(R,q,jt),fe(U,q,Ut),fe(B,Ie,xt),Fe?(lt(Le,Fe),ut(Fe,Ie),Fe=0):lt(Le,Ie),pt(Le),0!==e?ne("destroy",[s]):s):s};var e,Ot,Tt=0,qt=0,Et=0,Ct=0,Lt=0,St=0,Ht=0,zt={};we.exit=function(e,t,r){var i,n={overlay:function(){fe(A,Re,Rt),pt(Re)},modal:function(){fe(j,He,Pt),fe(R,He,Kt),fe(U,q,Nt),fe(A,zt.x,Mt),pt(Ae)},drop:function(){pt(Me)},bubble:function(){pt(Pe)}};if(t)if($(t))for(i in t)i=t[i],n[i]&&n[i](),0!==r&&ne("exit."+i,[s]);else n[t]&&n[t](),0!==r&&ne("exit."+i,[s]);else for(i in n)n[i]();return e&&s.select(),0!==r&&ne("exit",[s]),s},we.overlay=function(e,t,r){return we.exit(0,0,0).blur(),wt(1),ut(He,Ye(Re,e.length||m(e)?ht(_e+"-overlay-content","div",e):"")),t&&ue(A,Re,Rt),v(r)?r(Re):Ye(Re,r),ne("enter.overlay",[s]),ne("enter",[s]),s},we.modal=function(){we.overlay("",1);var o,a,e=arguments,t=e[0],r=e[1],n=e[2],i=_e+"-modal";$(t)&&(t="default",r=e[0],n=e[1]),a=me(t),Ye(Ae,!1,{"class":i+" "+a}),x(r.body)&&(r.body=Ye("div",r.body,{"class":i+"-content "+a}));for(o in r)i[1]=o,zt[o]=ht(i+"-"+ge(o,i)+" "+a,0,r[o]);return zt.x=ht(_e+"-x "+a),zt.resize=ht(_e+"-resize se "+a),et(Ae),ut(He,Ye(Ae,zt,{style:""})),we.modal.fit(),at(Ae,Re),ue(A,zt.x,Mt),ue(j,zt.header,le),ue(j,zt.resize,le),ue(j,He,Pt),ue(R,He,Kt),ue(U,q,Nt),v(n)&&(zt.overlay=Re,zt.modal=Ae,n(zt)),ne("enter.modal."+t,[s]),ne("enter.modal",[s]),ne("enter",[s]),s},we.modal.fit=function(e){At();var t=Ht/2-Lt/2,r=St/2-Ct/2;return $(e)?(r=e[0],t=e[1]):(r=h(r,0),t=h(t,0)),p(Ae,{left:r+ee,top:t+ee,"min-width":Ct+ee,"min-height":Lt+ee,visibility:"visible"}),ne("fit.modal",[s]),ne("fit",[s]),s};var Dt={"class":_e+"-button",name:"y"};return we.alert=function(e,t,r,n){var i=Ye("button",qe.okay,Dt),o="alert";return r=r||C,$(e)&&(o+=":"+e[0],e=e[1]||e[0]),ue(A,i,function(e){return r(e,s),Mt(e,o+".y"),le(e)}),ue(S,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?pe(A,i,[e,s]):void 0}),we.modal(o,Bt(e,t,i),n),i.focus(),s},we.confirm=function(e,t,r,n,i){function u(e){return v(r)&&r(e,s),Mt(e,a+".y"),le(e)}function f(e){return v(n)&&n(e,s),Mt(e,a+".n"),le(e)}var c,o=Ye("button",qe.okay,Dt),l=Ye("button",qe.cancel,Dt),a="confirm";return l.name="n",$(e)&&(a+=":"+e[0],e=e[1]||e[0]),ue(A,o,u),ue(A,l,f),ue(S,o,function(e){return c=e.TE.key,c("arrowright")?(l.focus(),le(e)):c("arrowleft")?le(e):c("enter")?(u(e),le(e)):c("escape")?(Mt(e,a+".y"),le(e)):void 0}),ue(S,l,function(e){return c=e.TE.key,c("arrowright")?le(e):c("arrowleft")?(o.focus(),le(e)):c("enter")?(f(e),le(e)):c("escape")?(Mt(e,a+".n"),le(e)):void 0}),we.modal(a,Bt(e,t,[o,l]),i),l.focus(),s},we.prompt=function(e,t,r,n,i,o){function g(){c.focus(),"placeholder"in c&&c.select()}function m(e){return le(e)}function k(e){return d=c.value,!r||b(d)&&d!==t?(Mt(e,u+".y"),le(e),n(e,s,d!==t?d:"",t)):(g(),m(e))}function y(e){return Mt(e,u+".n"),le(e)}var p,h,d,l=Ye("button",qe.okay,Dt),a=Ye("button",qe.cancel,Dt),c=Ye("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":_e+"-input block"}),u="prompt",f=[];if($(e)&&(u+=":"+e[0],e=e[1]||e[0]),v(i)&&(o=i,i=0),1===i)c=Ye("textarea",t,{placeholder:t.split("\n")[0],"class":_e+"-textarea block"});else if(2===i){for(h in t)f.push(Ye("option",t[h],{value:h,selected:h===r||null}));c=Ye("select",f,{"class":_e+"-select block"})}return n=n||C,c.name="data",a.name="n",ue(S,c,function(e){return p=e.TE.key,p("enter")?k(e):p("escape")||p("backspace")&&!this.value?y(e):p("arrowup")?m(e):p("arrowdown")?(l.focus(),le(e)):void 0}),ue(S,l,function(e){return p=e.TE.key,p("enter")?k(e):p("escape")?y(e):p("arrowup")?(c.focus(),le(e)):p("arrowright")?(a.focus(),le(e)):p(/^arrow(down|left)$/)?m(e):void 0}),ue(S,a,function(e){return p=e.TE.key,p(/^enter|escape$/)?y(e):p("arrowup")?(c.focus(),le(e)):p(/^arrow(right|down)$/)?m(e):p("arrowleft")?(l.focus(),le(e)):void 0}),ue(A,l,k),ue(A,a,y),we.modal(u,Bt(e,c,[l,a]),o),g(),s},we.drop=function(){we.exit(0,0,0);var n,e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),n=me(t),et(Me),ut(q,Ye(Me,!1,{"class":_e+"-drop "+n})),v(r)?r(Me):Ye(Me,r),we.drop.fit(),ue(A,q,Ft),ne("enter.drop."+t,[s]),ne("enter.drop",[s]),s},we.drop.fit=function(e){var o,t=$e(_),r=$e(Me),n=t.w/2-r.w/2,i=t.h/2-r.h/2;return!x(e)&&De&&(o=ke(De),n=o.l,i=o.t+$e(De).h),$(e)?(n=e[0],i=e[1]):(n=h(n,0,t.w-r.w),i=h(i,0,t.h-r.h)),p(Me,{left:n+ee,top:i+ee,visibility:"visible"}),ne("fit.drop",[s]),ne("fit",[s]),s},we.menu=function(e,t,r,n){var i='<span class="'+_e+'-current menu">%1</span>',o="";return t===!1?we.tool(e,t):($(t)&&(o=t[0],t=t[1],i='<i class="'+ge(xe.i,[o])+'"></i> '+i),we.tool(e,{i:o,text:ge(i,[r[t]&&r[t].text||t,o]),click:function(t){var l,a,c,u,p,h,d,n={href:V,"class":_e+"-button"};return we.drop("menu menu-"+me(e),function(e){function t(e){return u=this,d=r[u.getAttribute(J)],l=Ve(u),d&&d.active&&v(h=d.click)&&(h=h(e,s),De&&Ve(rt(De)[0]||De,ge(i,[l,o])),h===!1)?le(e):(s.select(),le(e))}for(c in r)p=r[c],p=w(p)?we.tools[p]:p,p&&(bt(p,c),n[J]=c,a=Ye("a",p.text||c,f(n,p.attributes||{})),!a.title&&(h=p.title)&&(a.title=$(h)?h[0]+(h[1]?" ("+h[1]+")":""):h),p.active||Ze(a,"x"),r[c]=p,ue(A,a,t),ut(e,a))}),!1}},n),ne("update.menus",[s]),s)},we.menu.fit=function(e){return we.drop.fit(e)},we.bubble=function(){we.exit(0,0,0);var n,e=arguments,t=e[0],r=e[1];return 1===e.length&&(t="default",r=e[0]),n=me(t),et(Pe),ut(q,Ye(Pe,!1,{"class":_e+"-bubble "+n})),v(r)?r(Pe):Ye(Pe,r),we.bubble.fit(),ne("enter.bubble."+t,[s]),ne("enter.bubble",[s]),s},we.bubble.fit=function(e){var t=s.$(1),r=ke(Ie),n=p(Ie,"line-height"),i="border-",o="-width",l=t.caret[0].x+r.l-Ie.scrollLeft,a=t.caret[1].y+r.t+n-Ie.scrollTop,c=p(He,[i+"top"+o,i+"bottom"+o,i+"left"+o,i+"right"+o]),u=$e(He),f=$e(Pe),d=c[0]+c[1],b=c[2]+c[3];return $(e)?(l=e[0],a=e[1]):(l=h(l,r.l,r.l+u.w-f.w-b),a=h(a,r.t,r.t+u.h-f.h-d)),p(Pe,{left:l+ee,top:a+ee,visibility:"visible"}),ne("fit.bubble",[s]),ne("fit",[s]),s},we.tool=function(e,t,r){var n="";return"|"!==e&&(L.tools=L.tools.filter(function(t,r){return t===e?(n=r,!1):!0})),t===!1?delete we.tools[e]:("|"===e?(r=t,t={}):(v(t)&&(t={click:t}),we.tools[e]=f(we.tools[e]||{},t),x(r)||""===n||(r=n)),k(r)?L.tools.splice(r,0,e):L.tools.push(e)),gt(),s},we.key=function(e,t){return L.keys?(t===!1?delete we.keys[e]:we.keys[e]=t,mt(),s):s},we.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(D),!1},outdent:function(e,t){return t.outdent(D),!1}},ue(A,Be,Qt),we.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Qt(e)},"shift+tab":Q?"outdent":0,tab:Q?"indent":0,escape:function(e,t){return Be.focus(),!1}},we.el={container:Le,header:Se,body:He,footer:ze,overlay:Re,modal:Ae,drop:Me,bubble:Pe},s.config=L,f(s._,{time:function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),i=e.getHours(),o=e.getMinutes(),l=e.getSeconds(),a=e.getMilliseconds();return 10>r&&(r="0"+r),10>n&&(n="0"+n),10>i&&(i="0"+i),10>o&&(o="0"+o),10>l&&(l="0"+l),10>a&&(a="0"+a),[""+t,""+r,""+n,""+i,""+o,""+l,""+a]},replace:be,format:ge,el:Ye,event:{set:ue,reset:fe,fire:pe,x:le},hooks:E,hook:{set:te,reset:re,fire:ne}}),we};