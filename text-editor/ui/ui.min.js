/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.7.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Oe(e){return O(e)?m(e).split(/\s+/):e}function Ce(e){return L(e)?e.join(" "):e}function Me(e,t){return-1!==e.indexOf(t)}function Se(e){return e.length}function De(e){return Object.keys(e)}function He(e){return Se(De(e))}function Ne(e,t,n){return z(e)?z(t)?(z(v[e])||(v[e]={}),z(n)||(n=He(v[e])),v[e][n]=t,l):v[e]:v}function Be(e,t){return z(e)?z(t)&&z(v[e])?(delete v[e][t],l):(v[e]={},l):(v={},l)}function Ae(e,t,n){if(!z(v[e]))return v[e]={},l;if(z(n))z(v[e][n])&&v[e][n].apply(l,t);else for(R in v[e])v[e][R].apply(l,t);return l}function Fe(e,t,n){if(L(t))for(R in t)Fe(e,R,t[R]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Ye(e,n,i){if(O(n))return Ye(e,[n],z(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=e.getAttribute(R))&&t.push(R);return Se(t)?t:z(i)?i:[]}function je(e,t){if(L(t))for(R in t)je(e,t[R]);else if(z(t))e.removeAttribute(t);else for(je(e,"class"),R=0,U=e.attributes,X=Se(U);X>R;++R)U[R]&&je(e,U[R].name)}function Ie(e,t,n){if(L(t))for(R in t)Ie(e,R,t[R]);else Fe(e,"data-"+t,n)}function qe(e,n,i){if(O(n))return qe(e,[n],z(i)?i:"")[0];t=[];for(R in n)R=n[R],(R=Ye(e,"data-"+R))&&t.push(R);return Se(t)?t:z(i)?i:[]}function Re(e,t){if(L(t))for(R in t)je(e,"data-"+t[R]);else if(z(t))je(e,"data-"+t);else for(R=0,U=e.attributes,X=Se(U);X>R;++R)U[R]&&"data-"===U[R].name.slice(0,5)&&je(e,U[R].name)}function Ue(e){return e&&e.preventDefault(),!1}function Xe(e,t,n){if(t){for(e=Oe(e),R=0,U=Se(e);U>R;++R)t.addEventListener(e[R],n,!1),Ne("on:"+e[R],n,ft(t));return l}}function We(e,t,n){if(t){for(e=Oe(e),R=0,U=Se(e);U>R;++R)t.removeEventListener(e[R],n,!1),Be("on:"+e[R],ft(t));return w(t)&&t.id.split(":")[0]===zt+"-dom"&&je(t,"id"),l}}function Pe(e,t,n){e=Oe(e);var r,i="createEvent"in u;for(R=0,U=Se(e);U>R;++R)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[R],!0,!1),t.dispatchEvent(r)):Ae("on:"+e[R],n,ft(t));return l}function Ke(e,t,n){for(R=0,U=Se(t),X;U>R;++R)X=t[R],e=e.replace(_(X)?X:h(p(X),"g"),n&&n[R]||"");return e}function Ze(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,z(t[n])?t[n]:e})}function Qe(e){return m(Ke(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ge(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ve(e);return{x:n-r.l,y:i-r.t}}function Ve(e){for(W=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)W+=e.offsetLeft,J+=e.offsetTop;return{l:W,t:J}}function Je(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function et(e,t){for(;(e=at(e))&&e!==t;);return e}function tt(e,t){t=Oe(t);for(R in t)e.classList.add(t[R])}function nt(e,n,i){if(O(n))return nt(e,[n],z(i)?[i]:[""])[0];t=[];for(R in n)R=n[R],e.classList.contains(R)&&t.push(R);return Se(t)?t:z(i)?i:!1}function it(e,t){if(z(t)){t=Oe(t);for(R in t)e.classList.remove(t[R])}else je(e,"class")}function rt(e,t){t=Oe(t);for(R in t)e.classList.toggle(t[R])}function ot(e,t,n){if(e=O(e)?u.createElement(e):e,L(n))for(R in n)if(te=n[R],"classes"===R)tt(e,te);else if("data"===R)for(U in te)te=te[U],null===te?Re(e,U):Ie(e,U,te);else"css"===R?O(te)?Fe(e,"style",te):null===te?je(e,"style"):c(e,te):$(te)?e[R]=te:null===te?je(e,R):Fe(e,R,E(te)?te.join(" "):""+te);if(w(t))wt(e,t);else if(L(t))for(R in t)te=t[R],w(te)?wt(e,te):te!==!1&&st(e,te);else z(t)&&t!==!1&&st(e,t);return e}function ft(e){var t=e.id;return t||(t=zt+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function st(e,t){e.innerHTML=t}function ut(e,t){return e.innerHTML||(z(t)?t:"")}function lt(e,t){if(0!==t&&(A=ct(e)))for(R=0,U=Se(A);U>R;++R)lt(A[R]);st(e,"")}function at(e){return e&&e.parentNode}function ct(e){return e&&e.children||[]}function dt(e){return e&&e.nextSibling}function pt(e){return e&&e.previousSibling}function bt(e){for(R=0;e=pt(e);)++R;return R}function ht(e,t){return e&&O(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&$(t)?e===t(e):e===t}function gt(e,n){if(!(n=z(n)?n:u))return[];if(t=[],O(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(R=0,U=Se(e);U>R;++R)t.push(e[R]);return t}return[]}for(e=n.querySelectorAll(e),R=0,U=Se(e);U>R;++R)t.push(e[R]);return t}return yt(e)?[e]:[]}function yt(e,t){var n=at(e);return 1===Se(arguments)?n||!1:e&&n===e?n:!1}function mt(e,t){Z=at(e),Z&&Z.insertBefore(t,e)}function vt(e,t){Z=at(e),Z&&Z.insertBefore(t,dt(e))}function xt(e,t){A=ct(e)[0],A?mt(A,t):wt(e,t)}function kt(e,t){wt(e,t)}function wt(e,t){e.appendChild(t)}function Et(e,t){var n=yt(e);if(n){if(0!==t)for(A=ct(e)[0];A;)Et(A);n.removeChild(e)}}function $t(e){lt(ot(e,!1,{style:""})),Et(e)}function Tt(e,t,n){return ot(t||"div",n,{"class":e})}function Vt(e){return!e||z(e.active)&&!e.active}function Jt(e,t,n){return $(e)&&(e={click:e}),O(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Ot[t]||"",z(e.attributes)||(e.attributes={}),n[t]=e,e}function en(e){Lt.exit(0,0,0);var t=qe(this,"tool-id"),n=Lt.tools,i=n[t];return Lt.drop.target=e.currentTarget||e.target,!Vt(i)&&$(U=i.click)&&(U=U(e,l,t),Ae("on:change",[e,l,t]),U===!1)?Ue(e):(l.select(),Ue(e))}function tn(e){if(J=this,(X=e.TE.key)(/^(escape|f10)$/))Lt.exit(1);else if(X("enter")||X("arrowdown")&&qe(J,"ui-drop"))Lt.drop.target=J,Pe(se,J,[e]);else if(X("arrowright")&&(W=dt(J))){for(;!ht(W,"a")&&W;)W=dt(W);W&&W.focus()}else if(X("arrowleft")&&(W=pt(J))){for(;!ht(W,"a")&&W;)W=pt(W);W&&W.focus()}return Ue(e)}function nn(){lt(Yt,0);var r,o,f,s,u,a,c,e=Lt.tools,t=Oe(D.tools),n=zt+"-button",i=zt+"-separator";D.tools=t;for(a in t)c=t[a],o=e[c],(o||o==={})&&(o=Jt(o,c,e),f=o.i||c,"|"===f||Me(f,"<")||(f=Qe(f)),s="|"!==f,u=Qe(c).replace(/[\/\s]/g,"-"),Qt=Tt(s?n+" "+n+"-"+u:i+" "+i+"-"+a,s?"a":"span"),s?(Qt=o.target||Qt,r=n+":"+u,Fe(Qt,{href:_e,id:r,tabindex:-1}),Ie(Qt,"tool-id",c),f=Me(f,"<")?f:Lt.i(u,f),Vt(o)?tt(Qt,"x"):it(Qt,"x"),o.on?tt(Qt,"on"):it(Qt,"on"),o.text&&(f=Ze('<span class="'+zt+'-text">'+o.text+"</span>",[f]),tt(Qt,"text")),st(Qt,f),ot(Qt,!1,o.attributes),!o.attributes.title&&(U=o.title)&&(Qt.title=L(U)?U[0]+(U[1]?" ("+U[1]+")":""):U),Xe(se,Qt,en),Xe(de,Qt,tn)):Qt.id=i+":"+a,o.target=Qt,wt(Yt,Qt));Ae("update.tools",[l])}function rn(){Lt.keys=function(){var n,e=De(Lt.keys).sort().reverse(),t={};for(R=0,U=Se(e);U>R;++R)n=e[R],t[n]=Lt.keys[n];return t}(),fn(),Ae("update.keys",[l])}function on(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,u=Lt.keys,a=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();K=e.TE.key(),H[K]=1,t=He(H),y(function(){l.record()});for(R in u){X=d(R),A=0;for(U in X)U=X[U],H[a[U]||U]&&++A;if(X=Se(X),A===X&&t===X&&(O(u[R])&&(u[R]=Lt.tools[u[R]].click),W=$(u[R])&&u[R](e,l),W===!1))return Ue(e)}if(ve)for(R in ve)if(P=ve[R],P!==!1){if(K===P&&f===P)return"\\"===o?(l.insert(K,0),Ue(e)):(l.select(n.end+1),Ue(e));if(R===K)return l.wrap(R,P),Ue(e);if(o===R&&f===P){if("backspace"===K&&i.slice(-2)!=="\\"+R)return l.unwrap(R,P),Ue(e);if(xe&&"enter"===K&&R!==P&&!s)return l.tidy("\n"+c+we,"\n"+c).scroll(1),Ue(e)}}if(xe&&!s){if("backspace"===K&&h(p(we)+"$").test(i))return l.outdent(we),Ue(e);if("enter"===K&&h("(^|\\n)("+p(we)+")+.*$").test(i))return l.insert("\n"+c,0,1).scroll(1),Ue(e)}}function fn(e){e&&e.TE&&e.TE.key?delete H[e.TE.key()]:H={}}function cn(e){return sn=Dt,V=Je(Ft),Ue(e)}function dn(e){sn===Dt&&c(jt,{height:Ge(At,e).y-V.h+ze})}function pn(){sn=0}function bn(){Lt.exit(1)}function hn(){t=Je(Ut),ne=t.w,q=t.h,t=Je(Rt),un=t.w,ln=t.h}function gn(e,t){return t&&Ae("exit.modal."+t,[l]),Pe(se,Rt,[e]),Ue(e)}function yn(e){sn=e.target,t=Ge(Ut,e),ie=t.x,re=t.y,hn()}function mn(e){var n=an.header,i=an.sizer;sn===n||et(sn,n)===n?(t=Ge(At,e),W=t.x-ie,J=t.y-re,c(Ut,{left:(ne>un?W:d(W,0,un-ne))+ze,top:(q>ln?J:d(J,0,ln-q))+ze})):sn===i&&(t=Ge(Ut,e),V=Je(i),c(Ut,{width:t.x+V.w/4+ze,height:t.y+V.h/4+ze}))}function vn(){sn=0}function xn(e,t,n){return{header:e,body:t,footer:n}}function kn(e){N=Lt.drop.target,B=Xt,A=e&&e.target||0,(!A||A!==N&&et(A,N)!==N)&&(Lt.drop.target=0,We(se,u,kn),We(me,s,kn),Lt.exit(e.target===jt))}var N,B,A,j,q,R,U,X,W,P,K,t,Z,G,V,J,te,ne,ie,re,n="⌘",i="…",o="⇥",f="⇧",s=window,u=document,l=new TE(e),a=l._,c=a.css,d=a.edge,p=a.x,b=a.extend,h=a.pattern,y=(a.timer.reset,a.timer.set),m=a.trim,v={},x=function(){},k=TE.is,w=k.e,E=k.a,$=k.f,T=k.i,L=k.o,_=k.r,z=function(e){return!k.x(e)},O=k.s,C=u.documentElement,S=(u.head,u.body),D=b({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},t),H={},fe="blur",se="click",de="keydown",pe="keyup",be="touchstart mousedown",he="touchmove mousemove",ge="touchend mouseup",me="orientationchange resize",ve=D.auto_close,xe=D.auto_tab,ke=D.languages,we=D.tab,$e=(D.unit[0][1],D.unit[0][0]),Te=D.unit[1][1],Le=D.unit[1][0],_e="javascript:;",ze="px",Lt=l.ui={};l.tidy=function(e,t){var n=l.$(),i=m(n.before)?e:"",r=m(n.after)?z(t)?t:e:"";return l.trim(i,r)},l.i=function(){return m(l.replace(/\s+/g," "))},l.format=function(e,t,n,i){L(e)||(e=[e]),z(n)||(n=" "),z(i)||(i="");var r=l.h,o=l[0]().$(),f=e[0].split(h("("+Te[3]+")+"))[0],s=(e[0]?$e[0]+e[0]+$e[1]:"")+i,u=i+(e[0]?$e[0]+$e[2]+(e[1]||f)+$e[1]:""),a=p(e[0]?$e[0]+f+$e[1]:""),c=p(u),d=h("^"+a+"([\\s\\S]*?)"+c+"$"),b=h(a+"$"),g=h("^"+c),y=o.before,m=o.after;return o.length?n=!1:l.insert(ke.placeholders[""]),l.toggle(t?!d.test(o.value):!b.test(y)&&!g.test(m),[function(e){e.unwrap(s,u,1).tidy(h(Le[0]+"[^"+Le[0]+Le[1]+Le[2]+"]+?"+Le[1]+"$").test(y)?"":n,h("^"+Le[0]+Le[2]+"[^"+Le[0]+Le[1]+"]+?"+Le[1]).test(m)?"":n).wrap(s,u,t)},function(e){e.unwrap(s,u,t)}])[r]()};var Qt,_t=D.classes,zt=_t[""],Ot=ke.tools,Ct=ke.buttons,Mt=ke.labels,St=zt+"-textarea "+zt+"-content block",Dt=Tt(zt+"-sizer s"),Ht=Tt(zt+"-sizer se"),Nt=Tt(zt),Bt=Tt(zt+"-header"),At=Tt(zt+"-body"),Ft=Tt(zt+"-footer"),Yt=Tt(zt+"-tool"),jt=ot(e,!1,D.attributes),It=Tt(zt+"-description"),qt=ot("div"),Rt=ot("div"),Ut=ot("div"),Xt=ot("div"),Wt=ot("div"),Pt=Tt("left","span"),Kt=Tt("right","span"),Zt=0;Lt.i=function(e,t,n){return e=Qe(e).replace(/[\/\s]/g,"-"),V=Ze(_t.i,[e,t||e]),n?(it(n),tt(n,V),n):'<i class="'+V+'"></i>'},z(D.suffix)||(D.suffix=$e[1]);var sn=0,ie=0,re=0,ne=0,q=0,un=0,ln=0,an={};l.create=function(e,t){if(l.is.create)return l;l.is.create=!0,L(e)&&(D=b(D,e));var n=yt(jt);return tt(Nt,zt+"-is-can-update"),tt(Nt,zt+"-is-can-copy"),tt(jt,St),n&&ht(n,"p")?(mt(n,Nt),Zt=n,Et(n,!1)):mt(jt,Nt),Nt.dir=D.dir,wt(Nt,Bt),wt(Nt,At),wt(Nt,Ft),wt(At,jt),D.tools&&(wt(Bt,Yt),wt(Ft,It),wt(It,Pt),wt(It,Kt)),Xe(de,jt,on),Xe(pe+" "+fe,jt,fn),D.resize&&(wt(Nt,Dt),tt(Nt,zt+"-is-can-resize"),Xe(be,Dt,cn),Xe(he,u,dn),Xe(ge,S,pn)),nn(),rn(),0!==t?Ae("create",[l]):l},l.update=function(e,t){return l.is.create&&l.destroy(0),(0!==t?Ae("update",[l]):l).create(e,0)},l.destroy=function(e){return l.is.create?(l.is.create=!1,Lt.exit(0,0,0),it(jt,St),D.tools=Ce(D.tools),D.keys&&(We(de,jt,on),We(pe,jt,fn)),D.resize&&(We(be,Dt,cn),We(he,u,dn),We(ge,u,pn)),Zt?(mt(Nt,Zt),wt(Zt,jt),Zt=0):mt(Nt,jt),$t(Nt),0!==e?Ae("destroy",[l]):l):l},l.enable=function(e){return jt.disabled=jt.readOnly=!1,tt(Nt,zt+"-is-can-update"),tt(Nt,zt+"-is-can-copy"),0!==e?Ae("enable",[l]):l},l.disable=function(e){return jt.disabled=!0,it(Nt,zt+"-is-can-update"),it(Nt,zt+"-is-can-copy"),0!==e?Ae("disable",[l]):l},l.freeze=function(e){return jt.disabled=!1,jt.readOnly=!0,it(Nt,zt+"-is-can-update"),tt(Nt,zt+"-is-can-copy"),0!==e?Ae("freeze",[l]):l},Lt.exit=function(e,t,n){if(j={panel:function(){$t(qt)},overlay:function(){We(se,Rt,bn),$t(Rt)},modal:function(){We(se+" "+de,an.x,gn),We(be,At,yn),We(he,At,mn),We(ge,u,vn),$t(Ut)},drop:function(){$t(Xt)},bubble:function(){$t(Wt)}},fn(),t)if(L(t))for(R in t)R=t[R],j[R]&&j[R](),0!==n&&Ae("exit."+R,[l]);else j[t]&&j[t](),0!==n&&Ae("exit."+R,[l]);else for(R in j)j[R]();return e&&l.select(),0!==n&&Ae("exit",[l]),l},Lt.panel=function(e,t,n,i){function r(e){return We(se+" "+de,ie,r),Lt.panel.exit(1),Ue(e)}return Lt.exit(0,0,0),W=Qe(e),J=0,i&&(W+=" "+W+"--"+Qe(i)),L(t)&&!w(t)&&(J=Tt(zt+"-panel-header "+W,0,t.header),t=t.body),t=Tt(zt+"-panel-body "+W,0,Tt(zt+"-panel-content "+W,0,t)),ie=ot("a",!1,{href:_e,"class":zt+"-a "+zt+"-x "+W}),ie.title=Ct.close,ot(qt,!1,{"class":zt+"-panel "+W}),Xe(se+" "+de,ie,r),lt(qt,0),J&&wt(qt,J),wt(At,ot(qt,[t,ie])),$(n)?n(qt):O(n)&&ot(qt,n),N=[l,qt],i&&Ae("enter.panel."+e+":"+i,N),Ae("enter.panel."+e,N),Ae("enter.panel",N),Ae("enter",N),ie.focus(),l},Lt.panel.fit=function(){},Lt.overlay=function(e,t,n,i){return Lt.exit(0,0,0),W=Qe(e),i&&(W+=" "+W+"--"+Qe(i)),wt(At,ot(Rt,!1,{"class":zt+"-overlay "+W})),t&&Xe(se,Rt,bn),$(n)?n(Rt):O(n)&&ot(Rt,n),N=[l,Rt],i&&Ae("enter.overlay."+e+":"+i,N),Ae("enter.overlay."+e,N),Ae("enter.overlay",N),Ae("enter",N),l},Lt.overlay.fit=function(){},Lt.modal=function(){var s,a,e=arguments,t=e[0],n=e[1],i=e[2],r=e[3],o=zt+"-modal",f=n.footer;if(L(t)&&(t="default",n=e[0],i=e[1],r=e[2]),Lt.overlay(t,1,0,r).blur(),W=Qe(t),r&&(W+=" "+W+"--"+Qe(r)),ot(Ut,!1,{"class":o+" "+W}),z(n.body)&&(n.body=ot("div",n.body,{"class":o+"-content "+W})),z(f)&&L(f)&&!w(f)){a=[];for(R in f)U=f[R],w(U)?a.push(U):(U=Jt(U,R,f),X=R.text||Ct[R]||R,s=ot("button",X,b({name:"y["+R+"]",type:"button","class":zt+"-button",data:{"button-id":R}},U.attributes)),Xe(se,s,function(e){return X=f[qe(this,"button-id")].click(e,l),X===!1?Ue(e):void 0}),a.push(s));n.footer=a}for(R in n)o[1]=R,an[R]=Tt(o+"-"+Ze(R,o)+" "+W,0,n[R]);return an.x=ot("a",!1,{href:_e,"class":zt+"-a "+zt+"-x "+W}),an.sizer=Ht,lt(Ut,0),an.x.title=Ct.close,wt(At,ot(Ut,an,{style:""})),Lt.modal.fit(),vt(Ut,Rt),Xe(se+" "+de,an.x,gn),Xe(be,an.header,Ue),Xe(be,an.sizer,Ue),Xe(be,At,yn),Xe(he,At,mn),Xe(ge,u,vn),$(i)&&i(an),N=[l,Ut,an],r&&Ae("enter.modal."+t+":"+r,N),Ae("enter.modal."+t,N),Ae("enter.modal",N),Ae("enter",N),an.x.focus(),l},Lt.modal.fit=function(e){return hn(),W=un/2-ne/2,J=ln/2-q/2,L(e)?(z(e[0])&&(W=e[0]),z(e[1])&&(J=e[1])):(W=d(W,0),J=d(J,0)),c(Ut,{left:W+ze,top:J+ze,"min-width":ne+ze,"min-height":q+ze,visibility:"visible"}),N=[l,Ut,an],Ae("fit.modal",N),Ae("fit",N),l};var wn={"class":zt+"-button",name:"y"};return Lt.alert=function(e,t,n,i,r){var o=ot("button",Ct.okay,wn),f="alert";return n=n||x,L(e)&&(f+=":"+e[0],e=e[1]||e[0]),Xe(se,o,function(e){return n(e,l),gn(e,f+".y")}),Xe(de,o,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Pe(se,o,[e]),Ue(e)}),Lt.modal(f,xn(e,t,o),i,r),o.focus(),l},Lt.confirm=function(e,t,n,i,r,o){function c(e){return $(n)&&n(e,l),gn(e,u+".y")}function d(e){return $(i)&&i(e,l),gn(e,u+".n")}var a,f=ot("button",Ct.okay,wn),s=ot("button",Ct.cancel,wn),u="confirm";return s.name="n",Xe(se,f,c),Xe(se,s,d),Xe(de,f,function(e){return a=e.TE.key,a("arrowright")?s.focus():a("enter")?c(e):a("escape")&&gn(e,u+".y"),Ue(e)}),Xe(de,s,function(e){return a=e.TE.key,a("arrowleft")?f.focus():a("enter")?d(e):a("escape")&&gn(e,u+".n"),Ue(e)}),Lt.modal(u,xn(e,t,[f,s]),r,o),s.focus(),l},Lt.prompt=function(e,t,n,i,r,o,f){function g(){a.focus(),"placeholder"in a&&a.select()}function y(e){return p=a.value,$(n)&&!n(p)?g():!n||m(p)&&p!==t?(gn(e,c+".y"),i(e,l,p!==t?p:"",t)):g(),Ue(e)}function v(e){return gn(e,c+".n")}var p,b,h,s=ot("button",Ct.okay,wn),u=ot("button",Ct.cancel,wn),a=ot("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":zt+"-input block"}),c="prompt",d=[];if(r=r||0,1===r)a=ot("textarea",t,{placeholder:t.split("\n")[0],"class":zt+"-textarea block",spellcheck:"false"});else if(2===r){for(R in t)d.push(ot("option",t[R],{value:R,selected:R===n||null}));a=ot("select",d,{"class":zt+"-select block"})}return i=i||x,a.name="data",u.name="n",Xe(de,a,function(e){return b=e.TE.key,h=e.TE.control,b("enter")&&0===r||h("enter")?y(e):b("escape")||b("backspace")&&!this.value?v(e):b("arrowdown")&&0===r||b("enter")&&2===r||h("arrowdown")?(s.focus(),Ue(e)):void 0}),Xe(de,s,function(e){return b=e.TE.key,b("enter")?y(e):b("escape")?v(e):b("arrowup")?a.focus():b("arrowright")&&u.focus(),Ue(e)}),Xe(de,u,function(e){return b=e.TE.key,b(/^(enter|escape)$/)?v(e):b("arrowup")?a.focus():b("arrowleft")&&s.focus(),Ue(e)}),Xe(se,s,y),Xe(se,u,v),Lt.modal(c,xn(e,a,[s,u]),o,f),g(),l},Lt.drop=function(){Lt.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===Se(e)&&(t="default",n=e[0],i=e[1]),W=Qe(t),lt(Xt,0),wt(S,ot(Xt,!1,{"class":zt+"-drop "+W})),$(n)?n(Xt):ot(Xt,n),Lt.drop.fit(),i===!1||Xe(se,u,kn),Xe(me,s,kn),N=[l,Xt],Ae("enter.drop."+t,N),Ae("enter.drop",N),l},Lt.drop.fit=function(e){return N=Je(C),B=Je(Xt),A=Lt.drop.target,W=N.w/2-B.w/2,J=N.h/2-B.h/2,!z(e)&&A&&(t=Ve(A),W=t.l,J=t.t+Je(A).h),L(e)?(z(e[0])&&(W=e[0]),z(e[1])&&(J=e[1])):(W=d(W,0,N.w-B.w),J=d(J,0,Math.max(N.h,Je(s).h)-B.h)),c(Xt,{left:W+ze,top:J+ze,visibility:"visible"}),N=[l,Xt],Ae("fit.drop",N),Ae("fit",N),l},Lt.menu=function(e,n,i,r){var s,o=Lt.tools,f=0;if(n===!1)return Lt.tool(e,n);for(r in i)ne="%"===r[0],s=i[r],s=O(s)&&!ne?o[s]:s,s&&(s=Jt(s,r,o),i[r]=s);return Lt.tool(e,{i:L(n)?n[0]:0,text:L(n)?n[1]||0:n&&i[n]&&i[n].text||n,click:function(n){var u=Lt.drop.target=o[e].target;return Lt.drop("menu menu-"+Qe(e),function(n){function a(n){return J=this,t=qe(J,"tool-id"),P=i[t],P=O(P)?o[P]:P||{},K=ut(J),!Vt(P)&&$(r=P.click)&&(r=r(n,l),Lt.menu.set(e,t),r===!1)?(l.select(),Ue(n)):(l.select(),Ue(n))}function c(e){if(J=this,(X=e.TE.key)("escape"))Lt.exit(1);else if(X("enter"))Pe(se,J,[e]);else if(X("f10")&&u)u.focus();else if(X("arrowdown")&&(W=dt(J))){for(;!ht(W,"a")&&W;)W=dt(W);W&&W.focus()}else if(X("arrowup")&&(W=pt(J))){for(;!ht(W,"a")&&W;)W=pt(W);!W&&u?(Lt.exit(),u.focus()):W&&W.focus()}else X("arrowup")&&u&&(Lt.exit(),u.focus());return Ue(e)}for(r in i)if(s=i[r],ne="%"===r[0],s){var d={href:ne?null:_e,"class":zt+"-"+(ne?"label":"button")};ne?U=Mt[e]&&Mt[e][+r.slice(1)-1]||r:(d.data={},d.data["tool-id"]=r,U=Ot[r]||r),G=s.text,G=L(G)?G[1]||"":G,U=L(U)?U[0]:U,V=ot(ne?"span":"a","<span>"+(ne?U||"%"+f:G||U)+"</span>",b(d,s.attributes||{})),tt(V,"menu-"+Qe(r).replace(/[\/\s]/g,"-")),!d.title&&(J=s.title)&&(V.title=L(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),ne?Fe(V,{id:zt+"-label:"+f}):(Vt(s)?tt(V,"x"):it(V,"x"),s.on?tt(V,"on"):it(V,"on"),Xe(se,V,a),Xe(de,V,c)),wt(n,V),++f}y(function(){(gt('[data-tool-id="'+qe(u,"ui-drop-data")+'"]',n)[0]||gt("a",n)[0]).focus()},1)}),!1}},r),Ie(o[e].target,{"ui-drop":e}),o[e].data=i,Lt.menu.set(e,n),l},Lt.menu.set=function(e,t){var o,f,n=Lt.tools[e]||{},i=n.target,r=n.data;return i?(!L(t)&&r[t]&&(Ie(i,"ui-drop-data",t),t=r[t].text||t),L(t)?(f=t[0],f=Me(f,"<")?f:Lt.i(e,f),t=z(t[1])?t[1]:0,t=t&&r[t]&&r[t].text||t,t=f+(0!==t?" "+t:"")):f=Lt.i(n.i||e),(o=gt("."+zt+"-text",i)[0])?(tt(o,"menu"),tt(i,"text"),st(o,Ze(t,[f]))):(it(i,"text"),st(i,f)),l):l},Lt.bubble=function(){Lt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Se(e)&&(t="default",n=e[0]),W=Qe(t),lt(Wt,0),wt(S,ot(Wt,!1,{"class":zt+"-bubble "+W})),$(n)?n(Wt):ot(Wt,n),Lt.bubble.fit(),N=[l,Wt],Ae("enter.bubble."+t,N),Ae("enter.bubble",N),l},Lt.bubble.fit=function(e){V=l.$(1),t=Ve(jt),q=c(jt,"line-height");var n="border-",i="-width";W=V.caret[0].x+t.l-jt.scrollLeft,J=V.caret[1].y+t.t+q-jt.scrollTop,B=c(At,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=Je(At),o=Je(Wt),f=B[0]+B[1],s=B[2]+B[3];return L(e)?(z(e[0])&&(W=e[0]),z(e[1])&&(J=e[1])):(W=d(W,t.l,t.l+r.w-o.w-s),J=d(J,t.t,t.t+r.h-o.h-f)),c(Wt,{left:W+ze,top:J+ze,visibility:"visible"}),N=[l,Wt],Ae("fit.bubble",N),Ae("fit",N),l},Lt.panel.exit=function(e){return Lt.exit(e,"panel")},Lt.overlay.exit=function(e){return Lt.exit(e,"overlay")},Lt.modal.exit=function(e){return Lt.exit(e,"modal")},Lt.drop.exit=function(e){return Lt.exit(e,"drop")},Lt.bubble.exit=function(e){return Lt.exit(e,"bubble")},Lt.tool=function(e,t,n){return U="","|"!==e&&(D.tools=Oe(D.tools).filter(function(t,n){return t===e?(U=n,!1):!0})),t===!1?delete Lt.tools[e]:("|"===e?(n=t,t={}):($(t)&&(t={click:t}),Lt.tools[e]=b(Lt.tools[e]||{},t),z(n)||""===U||(n=U)),T(n)?D.tools.splice(n,0,e):D.tools.push(e)),nn(),l},Lt.separator=function(e,t){return Lt.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Lt.key=function(e,t){return D.keys?(t===!1?delete Lt.keys[e]:Lt.keys[e]=t,rn(),l):l},Lt.key.set=function(e){H[e]=1},Lt.key.reset=function(e){e?delete H[e]:H={}},Lt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return e&&e.TE&&e.TE.shift()?(t.outdent(we),!1):(t.indent(we),!1)},outdent:function(e,t){return t.outdent(we),!1}},Lt.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return G=":not([tabindex]):not([disabled])",(V=gt("input"+G+",button"+G+",select"+G+",textarea"+G+",a[href]"+G+",[contenteditable]"+G+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(J=V.indexOf(jt))?((V[J+1]||u).focus(),!1):void 0},f10:function(e,t){return gt("a",Yt)[0].focus(),!1},tab:xe?"indent":0,"shift+tab":xe?"outdent":0},Lt.el={container:Nt,header:Bt,body:At,footer:Ft,panel:qt,overlay:Rt,modal:Ut,drop:Xt,bubble:Wt},l.config=D,b(TE._,{time:function(e){var t=new Date(z(e)?e:Date.now()),n=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=t.getHours(),f=t.getMinutes(),s=t.getSeconds(),u=t.getMilliseconds();return 10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),10>u&&(u="0"+u),[""+n,""+i,""+r,""+o,""+f,""+s,""+u]},replace:Ke,format:Ze,dom:{set:wt,reset:Et,get:gt,id:ft,copy:function(e,t){return e.cloneNode(z(t)?t:!0)},classes:{set:tt,reset:it,toggle:rt,get:nt},attributes:{set:Fe,reset:je,get:Ye},data:{set:Ie,reset:Re,get:qe},is:ht,offset:Ve,pointer:Ge,size:Je,content:{set:st,reset:lt,get:ut},closest:et,parent:at,children:ct,next:dt,previous:pt,index:bt,before:mt,after:vt,prepend:xt,append:kt},el:ot,event:{set:Xe,reset:We,fire:Pe,x:Ue}}),b(l._,TE._),b(l._,{hooks:v,hook:{set:Ne,reset:Be,fire:Ae}}),l.create()};