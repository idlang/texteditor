/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function $e(e){return w(e)?h(e).split(/\s+/):e}function Ae(e){return y(e)?e.join(" "):e}function Le(e,t,n){return E(e)?E(t)?(E(L[e])||(L[e]={}),E(n)||(n=Object.keys(L[e]).length),L[e][n]=t,s):L[e]:L}function Oe(e,t){return E(e)?E(t)&&E(L[e])?(delete L[e][t],s):(L[e]={},s):(L={},s)}function Ie(e,t,n){if(!E(L[e]))return L[e]={},s;if(E(n))E(L[e][n])&&L[e][n].apply(s,t);else for(U in L[e])L[e][U].apply(s,t);return s}function Re(e,t,n){if(y(t))for(U in t)Re(e,U,t[U]);else e.setAttribute(t,n)}function Ne(t,n,i){if(w(n))return Ne(t,[n],E(i)?i:"")[0];e=[];for(U in n)U=n[U],(U=t.getAttribute(U))&&e.push(U);return e.length?e:E(i)?i:[]}function Se(e,t){if(y(t))for(U in t)Se(e,t[U]);else if(E(t))e.removeAttribute(t);else for(Se(e,"class"),U=0,D=e.attributes,z=D.length;z>U;++U)D[U]&&Se(e,D[U].name)}function Ce(e,t,n){if(y(t))for(U in t)Ce(e,U,t[U]);else Re(e,"data-"+t,n)}function qe(t,n,i){if(w(n))return qe(t,[n],E(i)?i:"")[0];e=[];for(U in n)U=n[U],(U=Ne(t,"data-"+U))&&e.push(U);return e.length?e:E(i)?i:[]}function Fe(e,t){if(y(t))for(U in t)Se(e,"data-"+t[U]);else if(E(t))Se(e,"data-"+t);else for(U=0,D=e.attributes,z=D.length;z>U;++U)D[U]&&"data-"===D[U].name.slice(0,5)&&Se(e,D[U].name)}function He(e){return e&&e.preventDefault(),!1}function Ge(e,t,n){if(t){for(e=$e(e),U=0,D=e.length;D>U;++U)t.addEventListener(e[U],n,!1),Le("on:"+e[U],n,et(t));return s}}function Ue(e,t,n){if(t){for(e=$e(e),U=0,D=e.length;D>U;++U)t.removeEventListener(e[U],n,!1),Oe("on:"+e[U],et(t));return g(t)&&t.id.split(":")[0]===wt+"-dom"&&Se(t,"id"),s}}function De(e,t,n){e=$e(e);var o,i="createEvent"in a;for(U=0,D=e.length;D>U;++U)i?(o=a.createEvent("HTMLEvents"),o.data=n,o.initEvent(e[U],!0,!1),t.dispatchEvent(o)):Ie("on:"+e[U],n,et(t));return s}function ze(e,t){return setTimeout(e,t)}function Me(e){return clearTimeout(e)}function Be(e,t,n){for(U=0,D=t.length,z;D>U;++U)z=t[U],e=e.replace(_(z)?z:d(c(z),"g"),n&&n[U]||"");return e}function Pe(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,E(t[n])?t[n]:e})}function We(e){return h(Be(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ke(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,o=Ye(e);return{x:n-o.l,y:i-o.t}}function Ye(e){for(M=e.offsetLeft,V=e.offsetTop;e=e.offsetParent;)M+=e.offsetLeft,V+=e.offsetTop;return{l:M,t:V}}function je(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Ve(e,t){for(;(e=ot(e))&&e!==t;);return e}function Qe(e,t){t=$e(t);for(U in t)e.classList.add(t[U])}function Xe(t,n,i){if(w(n))return Xe(t,[n],E(i)?i:"")[0];e=[];for(U in n)U=n[U],t.classList.contains(U)&&e.push(U);return e.length?e:E(i)?i:!1}function Ze(e,t){if(E(t)){t=$e(t);for(U in t)e.classList.remove(t[U])}else Se(e,"class")}function Je(e,t,n){if(e=w(e)?a.createElement(e):e,y(n))for(U in n)if(X=n[U],"classes"===U)Qe(e,X);else if("data"===U)for(D in X)X=X[D],null===X?Fe(e,D):Ce(e,D,X);else"css"===U?w(X)?Re(e,"style",X):null===X?Se(e,"style"):p(e,X):k(X)?e[U]=X:null===X?Se(e,U):Re(e,U,y(X)?X.join(" "):""+X);if(g(t))ht(e,t);else if(y(t))for(U in t)X=t[U],g(X)?ht(e,X):X!==!1&&tt(e,X);else E(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=wt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(E(t)?t:"")}function it(e,t){if(t!==!1&&(S=rt(e)))for(U=0,D=S.length;D>U;++U)it(S[U]);tt(e,"")}function ot(e){return e&&e.parentNode}function rt(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function at(e){return e&&e.previousSibling}function st(e,t){return e&&w(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&k(t)?e===t(e):e===t}function ut(t,n){if(n=n||a,e=[],w(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(U=0,D=t.length;D>U;++U)e.push(t[U]);return e}return[]}for(t=n.querySelectorAll(t),U=0,D=t.length;D>U;++U)e.push(t[U]);return e}return ct(t)?[t]:[]}function ct(e,t){var n=ot(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ft(e,t){W=ot(e),W&&W.insertBefore(t,e)}function pt(e,t){W=ot(e),W&&W.insertBefore(t,lt(e))}function bt(e,t){S=rt(e)[0],S?ft(S,t):ht(e,t)}function dt(e,t){ht(e,t)}function ht(e,t){e.appendChild(t)}function mt(e,t){var n=ct(e);if(n){if(t!==!1)for(S=rt(e)[0];S;)mt(S);n.removeChild(e)}}function gt(e){it(Je(e,!1,{style:""})),mt(e)}function kt(e,t,n){return Je(t||"div",n,{"class":e})}function Yt(e){return!e||E(e.active)&&!j.active}function jt(){$t._word&&$t._words&&(X=(St.value||"").replace(d(_e[0]+"[^"+_e[0]+_e[1]+"]+?"+_e[1],"g"),""),U=(X.match(/(\w+)/g)||[]).length,tt(zt,Pe($t["_word"+(1===U?"":"s")],[U])))}function Vt(e,t,n){return k(e)&&(e={click:e}),w(e.click)&&(e.click=(n[e.click]||{}).click),E(e.title)||(e.title=Et[t]||""),n[t]=e,e}function Qt(){it(Nt,!1);var i,o,r,l,a,u,e=$e(I.tools),t=wt+"-button",n=wt+"-separator";I.tools=e;for(a in e)u=e[a],o=vt.tools[u],(o||o==={})&&(o=Vt(o,u,vt.tools),r=o.i||u,"|"!==r&&"<"!==r[0]&&(r=We(r)),l="|"!==r,Wt=kt(l?t:n,l?"a":"span"),l?(i=t+":"+We(u).replace(/\s/g,""),Re(Wt,{href:Te,id:i,tabindex:-1}),Ce(Wt,Ee,u),r="<"===r[0]?r:'<i class="'+Pe(_t,[r])+" "+i+'"></i>',Yt(o)&&Qe(Wt,"x"),o.text&&(r=Pe('<span class="'+wt+'-text">'+o.text+"</span>",[r]),Qe(Wt,"text")),tt(Wt,r),Je(Wt,!1,o.attributes||{}),!Wt.title&&(D=o.title)&&(Wt.title=y(D)?D[0]+(D[1]?" ("+D[1]+")":""):D),Ge(ce,Wt,rn)):Wt.id=wt+"-separator:"+a,vt.tools[u].target=Wt,ht(Nt,Wt));Ie("update.tools",[s])}function Xt(){vt.keys=function(){var n,e=Object.keys(vt.keys).sort().reverse(),t={};for(U=0,D=e.length;D>U;++U)n=e[U],t[n]=vt.keys[n];return t}(),nn(1),Ie("update.keys",[s])}function Zt(e){jt(),Ie("on:change",[e,s])}function tn(t){function b(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=s.$(),i=n.before,o=n.after,r=i.slice(-1),l=o[0],a=n.length,u=vt.keys,f=TE.keys_alias,p=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();P=t.TE.key(),Jt[P]=1,e=Object.keys(Jt).length,ze(function(){s.record()},1);for(U in u){z=b(U),S=0;for(D in z)D=z[D],Jt[f[D]||D]&&++S;if(z=z.length,S===z&&e===z&&(w(u[U])&&(u[U]=vt.tools[u[U]].click),M=u[U]&&u[U](t,s),M===!1))return He(t)}if(ke)for(U in ke)if(B=ke[U],B!==!1){if(P===B&&l===B)return"\\"===r?(s.insert(P,0),He(t)):(s.select(n.end+1),He(t));if(U===P)return s.wrap(U,B),He(t);if(r===U&&l===B){if("backspace"===P&&i.slice(-2)!=="\\"+U)return s.unwrap(U,B),He(t);if(ge&&"enter"===P&&U!==B)return s.tidy("\n"+p+me,"\n"+p).scroll(!0),He(t)}}if(ge&&!a){if("backspace"===P&&d(c(me)+"$").test(i))return s.outdent(me).scroll(!0),He(t);if("enter"===P&&d("(^|\\n)("+c(me)+")+.*$").test(i))return s.insert("\n"+p,0,1).scroll(!0),He(t)}}function nn(e){y(e)?delete Jt[e.TE.key()]:Jt={}}function on(e){/^focus|blur$/.test(e.type)&&nn(1),Me(en),en=ze(function(){Zt(e)},I.debounce||0)}function rn(e){vt.exit(0,0,0);var t=qe(this,Ee),n=vt.tools,i=n[t];return Pt=e.currentTarget||e.target,!Yt(i)&&k(D=i.click)&&(D=D(e,s,t),Ie("on:change",[e,s,t]),D===!1)?He(e):(s.select(),He(e))}function cn(e){return ln=Ct,j=je(Rt),He(e)}function fn(e){ln===Ct&&p(St,{height:Ke(It,e).y-j.h+xe})}function pn(){ln=0}function bn(){vt.exit(1)}function dn(){e=je(Ht),Z=e.w,G=e.h,e=je(Ft),an=e.w,sn=e.h}function hn(e,t){t&&Ie("exit.modal."+t,[s]),De(ce,Ft,[e])}function mn(t){ln=t.target,e=Ke(Ht,t),J=e.x,ee=e.y,dn()}function gn(t){var n=un.header,i=un.resize;ln===n||Ve(ln,n)===n?(e=Ke(It,t),M=e.x-J,V=e.y-ee,p(Ht,{left:(Z>an?M:b(M,0,an-Z))+xe,top:(G>sn?V:b(V,0,sn-G))+xe})):ln===i&&(e=Ke(Ht,t),j=je(i),p(Ht,{width:e.x+j.w/4+xe,height:e.y+j.h/4+xe}))}function kn(){ln=0}function vn(e,t,n){return{header:e,body:t,footer:n}}function yn(e){R=Pt,N=Gt,S=e&&e.target||0,(!S||S!==R&&Ve(S,R)!==R)&&(Pt=0,gt(Gt),Ue(ce,a,yn),Ue(be,l,yn),vt.exit(e.target===A))}function wn(t){function n(){e&&(W=je(e),p(Y,{width:W.w+xe,height:W.h+xe}))}return X=s.get(),Z="",-1===X.indexOf("</html>")&&(Z='<!DOCTYPE html><html dir="'+I.dir+'"><head><meta charset="utf-8"><style>'+I.css+"</style></head><body>"+X+"</body></html>"),Y=Je("iframe",!1,{"class":wt+"-portal",src:"data:text/html,"+encodeURIComponent(Z)}),!ct(Ft)&&X?vt.overlay(Y,1,function(){e=rt(Ft)[0],n(),Ge(be,l,n),Ie("enter.overlay.preview",[t,s,[X,Z],e])}):(Ue(be,l,n),bn()),He(t)}var R,N,S,F,G,U,D,z,M,B,P,e,W,Y,j,V,X,Z,J,ee,t="⌘",n="…",o="⇥",r="⇧",l=window,a=document,s=this,u=s._,c=u.x,f=u.extend,p=u.css,b=u.edge,d=u.pattern,h=u.trim,m=s.is,g=m.e,k=m.f,v=m.i,y=m.o,_=m.r,w=m.s,E=function(e){return!m.x(e)},T=a.documentElement,$=(a.head,a.body),A=s.target,L={},O=function(){},I=f({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",o],outdent:["Outdent",r+"+"+o],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ne="keydown",ie="keyup",oe="copy",re="cut",le="paste",ae="touchstart mousedown",se="touchend mouseup",ue="touchmove mousemove",ce="click",fe="focus",pe="blur",be="orientationchange resize",de=pe+" "+oe+" "+re+" "+fe+" input "+ne+" "+le,he=I.languages,me=I.tab,ge=I.auto_tab,ke=I.auto_close,ve=I.unit[0][0],_e=(I.unit[0][1],I.unit[1][0]),we=I.unit[1][1],Ee="tool-id",Te="javascript:;",xe="px",vt=s.ui={};s.tidy=function(e,t){var n=s.$(),i=h(n.before)?e:"",o=h(n.after)?E(t)?t:e:"";return s.trim(i,o)},s.i=function(){return h(s.replace(/\s+/g," "))},s.format=function(e,t,n,i){y(e)||(e=[e]),E(n)||(n=" "),E(i)||(i="");var o=s.$(),r=(e[0]?ve[0]+e[0]+ve[1]:"")+i,l=i+(e[0]?ve[0]+ve[2]+(e[1]||e[0].split(d("("+we[3]+")+"))[0])+ve[1]:""),a=c(r),u=c(l),f=d("^"+a+"([\\s\\S]*?)"+u+"$"),p=d(a+"$"),b=d("^"+u),h=o.before,m=o.after;return o.length?n=!1:s.insert(he.placeholders[""]).loss(),s.toggle(t?!f.test(o.value):!p.test(h)&&!b.test(m),[function(e){e.unwrap(r,l,1).tidy(d(_e[0]+"[^"+_e[0]+_e[1]+_e[2]+"]+?"+_e[1]+"$").test(h)?"":n,d("^"+_e[0]+_e[2]+"[^"+_e[0]+_e[1]+"]+?"+_e[1]).test(m)?"":n).loss().wrap(r,l,t)},function(e){e.unwrap(r,l,t)}])};var Wt,yt=I.classes,_t=yt.i,wt=yt[""],Et=he.tools,Tt=he.buttons,xt=he.labels,$t=he.others,At=wt+"-textarea "+wt+"-content block",Lt=kt(wt),Ot=kt(wt+"-header"),It=kt(wt+"-body"),Rt=kt(wt+"-footer"),Nt=kt(wt+"-tool"),St=Je(A,!1,I.attributes),Ct=kt(wt+"-resize s"),qt=kt(wt+"-description"),Ft=kt(wt+"-overlay"),Ht=Je("div"),Gt=Je("div"),Ut=Je("div"),Dt=kt("left","span"),zt=kt("right","span"),Mt=kt(wt+"-preview","a"),Bt=0,Pt=0;I.suffix||(I.suffix=ve[1]);var Jt={},en=null;s.create=function(e,t){y(e)&&(I=f(I,e));var n=ct(St);return Qe(St,At),n&&st(n,"p")?(ft(n,Lt),Bt=n,mt(n,!1)):ft(St,Lt),Lt.dir=I.dir,ht(Lt,Ot),ht(Lt,It),ht(Lt,Rt),ht(Lt,Ct),ht(It,St),I.tools&&(ht(Ot,Nt),ht(Rt,qt),ht(qt,Dt),ht(qt,zt)),Ge(ne,St,tn),Ge(ie,St,nn),Ge(de,St,on),Ge(ae,Ct,cn),Ge(ue,a,fn),Ge(se,$,pn),$t.preview&&(j=Et.preview,Re(Mt,{href:Te,title:y(j)?j[0]+(j[1]?" ("+j[1]+")":""):j}),ht(Dt,Mt),tt(Mt,$t.preview)),Zt(null),Qt(),Xt(),0!==t?Ie("create",[s]):s},s.update=function(e,t){return Xe(St,$e(At),0)&&s.destroy(0),(0!==t?Ie("update",[s]):s).create(e,0)},s.destroy=function(e){return Xe(St,$e(At),0)?(vt.exit(0,0,0),Ze(St,At),I.tools=Ae(I.tools),I.keys&&(Ue(ne,St,tn),Ue(ie,St,nn)),Ue(ae,Ct,cn),Ue(ue,a,fn),Ue(se,a,pn),Ue(de,St,on),Bt?(ft(Lt,Bt),ht(Bt,St),Bt=0):ft(Lt,St),gt(Lt),0!==e?Ie("destroy",[s]):s):s};var ln=0,J=0,ee=0,Z=0,G=0,an=0,sn=0,un={};vt.exit=function(e,t,n){if(F={overlay:function(){Ue(ce,Ft,bn),gt(Ft)},modal:function(){Ue(ae,It,mn),Ue(ue,It,gn),Ue(se,a,kn),Ue(ce,un.x,hn),gt(Ht)},drop:function(){gt(Gt)},bubble:function(){gt(Ut)}},t)if(y(t))for(U in t)U=t[U],F[U]&&F[U](),0!==n&&Ie("exit."+U,[s]);else F[t]&&F[t](),0!==n&&Ie("exit."+U,[s]);else for(U in F)F[U]();return e&&s.select(),0!==n&&Ie("exit",[s]),s},vt.overlay=function(e,t,n){return vt.exit(0,0,0),nn(1),ht(It,Je(Ft,e.length||g(e)?kt(wt+"-overlay-content","div",e):"")),t&&Ge(ce,Ft,bn),k(n)?n(Ft):Je(Ft,n),Ie("enter.overlay",[s]),Ie("enter",[s]),s},vt.overlay.fit=function(){},vt.modal=function(){vt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],i=e[2],o=wt+"-modal";y(t)&&(t="default",n=e[0],i=e[1]),M=We(t),Je(Ht,!1,{"class":o+" "+M}),E(n.body)&&(n.body=Je("div",n.body,{"class":o+"-content "+M}));for(U in n)o[1]=U,un[U]=kt(o+"-"+Pe(U,o)+" "+M,0,n[U]);return un.x=kt(wt+"-x "+M),un.resize=kt(wt+"-resize se "+M),it(Ht),ht(It,Je(Ht,un,{style:""})),vt.modal.fit(),pt(Ht,Ft),Ge(ce,un.x,hn),Ge(ae,un.header,He),Ge(ae,un.resize,He),Ge(ae,It,mn),Ge(ue,It,gn),Ge(se,a,kn),k(i)&&(un.overlay=Ft,un.modal=Ht,i(un)),Ie("enter.modal."+t,[s]),Ie("enter.modal",[s]),Ie("enter",[s]),s},vt.modal.fit=function(e){return dn(),M=an/2-Z/2,V=sn/2-G/2,y(e)?(M=e[0],V=e[1]):(M=b(M,0),V=b(V,0)),p(Ht,{left:M+xe,top:V+xe,"min-width":Z+xe,"min-height":G+xe,visibility:"visible"}),Ie("fit.modal",[s]),Ie("fit",[s]),s};var _n={"class":wt+"-button",name:"y"};return vt.alert=function(e,t,n,i){var o=Je("button",Tt.okay,_n),r="alert";return n=n||O,y(e)&&(r+=":"+e[0],e=e[1]||e[0]),Ge(ce,o,function(e){return n(e,s),hn(e,r+".y"),He(e)}),Ge(ne,o,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(De(ce,o,[e]),He(e)):void 0}),vt.modal(r,vn(e,t,o),i),o.focus(),s},vt.confirm=function(e,t,n,i,o){function c(e){return k(n)&&n(e,s),hn(e,a+".y"),He(e)}function f(e){return k(i)&&i(e,s),hn(e,a+".n"),He(e)}var u,r=Je("button",Tt.okay,_n),l=Je("button",Tt.cancel,_n),a="confirm";return l.name="n",y(e)&&(a+=":"+e[0],e=e[1]||e[0]),Ge(ce,r,c),Ge(ce,l,f),Ge(ne,r,function(e){return u=e.TE.key,u("arrowright")?(l.focus(),He(e)):u("arrowleft")?He(e):u("enter")?(c(e),He(e)):u("escape")?(hn(e,a+".y"),He(e)):void 0}),Ge(ne,l,function(e){return u=e.TE.key,u("arrowright")?He(e):u("arrowleft")?(r.focus(),He(e)):u("enter")?(f(e),He(e)):u("escape")?(hn(e,a+".n"),He(e)):void 0}),vt.modal(a,vn(e,t,[r,l]),o),l.focus(),s},vt.prompt=function(e,t,n,i,o,r){function d(){u.focus(),"placeholder"in u&&u.select()}function m(e){return He(e)}function g(e){return p=u.value,!n||h(p)&&p!==t?(hn(e,c+".y"),He(e),i(e,s,p!==t?p:"",t)):(d(),m(e))}function v(e){return hn(e,c+".n"),He(e)}var p,b,l=Je("button",Tt.okay,_n),a=Je("button",Tt.cancel,_n),u=Je("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":wt+"-input block"}),c="prompt",f=[];if(y(e)&&(c+=":"+e[0],e=e[1]||e[0]),k(o)&&(r=o,o=0),1===o)u=Je("textarea",t,{placeholder:t.split("\n")[0],"class":wt+"-textarea block"});else if(2===o){for(U in t)f.push(Je("option",t[U],{value:U,selected:U===n||null}));u=Je("select",f,{"class":wt+"-select block"})}return i=i||O,u.name="data",a.name="n",Ge(ne,u,function(e){return b=e.TE.key,b("enter")?g(e):b("escape")||b("backspace")&&!this.value?v(e):b("arrowup")?m(e):b("arrowdown")?(l.focus(),He(e)):void 0}),Ge(ne,l,function(e){return b=e.TE.key,b("enter")?g(e):b("escape")?v(e):b("arrowup")?(u.focus(),He(e)):b("arrowright")?(a.focus(),He(e)):b(/^arrow(down|left)$/)?m(e):void 0}),Ge(ne,a,function(e){return b=e.TE.key,b(/^enter|escape$/)?v(e):b("arrowup")?(u.focus(),He(e)):b(/^arrow(right|down)$/)?m(e):b("arrowleft")?(l.focus(),He(e)):void 0}),Ge(ce,l,g),Ge(ce,a,v),vt.modal(c,vn(e,u,[l,a]),r),d(),s},vt.drop=function(){vt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),M=We(t),it(Gt),ht($,Je(Gt,!1,{"class":wt+"-drop "+M})),k(n)?n(Gt):Je(Gt,n),vt.drop.fit(),Ge(ce,a,yn),Ge(be,l,yn),Ie("enter.drop."+t,[s]),Ie("enter.drop",[s]),s},vt.drop.fit=function(t){return R=je(T),N=je(Gt),M=R.w/2-N.w/2,V=R.h/2-N.h/2,!E(t)&&Pt&&(e=Ye(Pt),M=e.l,V=e.t+je(Pt).h),y(t)?(M=t[0],V=t[1]):(M=b(M,0,Math.max(R.w,l.innerWidth)-N.w),V=b(V,0,Math.max(R.h,l.innerHeight)-N.h)),p(Gt,{left:M+xe,top:V+xe,visibility:"visible"}),Ie("fit.drop",[s]),Ie("fit",[s]),s},vt.menu=function(e,t,n,i){t=!y(t)&&n[t]&&n[t].text||t;var a,o='<span class="'+wt+'-current menu">%1</span>',r="",l=0;return t===!1?vt.tool(e,t):(y(t)&&(r=t[0],r="<"===r[0]?r:'<i class="'+Pe(_t,[r])+'"></i>',t=E(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,o=r+(0!==t?" "+o:"")),vt.tool(e,{i:r,text:t?Pe(o,[t,r]):0,click:function(u){return vt.drop("menu menu-"+We(e),function(u){function c(e){return a=this,B=n[qe(a,Ee)],B=w(B)?vt.tools[B]:B||{},P=nt(a),!Yt(B)&&k(i=B.click)&&(i=i(e,s),t!==!1&&Pt&&(j=rt(Pt)[0]||Pt,st(j,"i")||tt(j,Pe(o,[P,r])),y(B.text)&&(V=rt(j)[0])&&st(V,"i")&&(Ze(V),Qe(V,Pe(_t,[B.text[0]])))),i===!1)?He(e):(s.select(),He(e))}function p(e){if(a=this,(z=e.TE.key)("escape"))return vt.exit(1),He(e);if(z("arrowdown")&&(M=lt(a))){for(;!st(M,"a")&&M;)M=lt(M);return M&&M.focus(),He(e)}if(z("arrowup")&&(M=at(a))){for(;!st(M,"a")&&M;)M=at(M);return M&&M.focus(),He(e)}}for(i in n)if(a=n[i],Z="%"===i[0],a=w(a)&&!Z?vt.tools[a]:a){a=Vt(a,i,vt.tools);var b={href:Z?null:Te,"class":wt+"-"+(Z?"label":"button")};Z?D=xt[e]&&xt[e][+i.slice(1)-1]||i:(b.data={},b.data[Ee]=i,D=Et[i]||i),Y=a.text,Y=y(Y)?Y[1]||"":Y,D=y(D)?D[0]:D,j=Je(Z?"span":"a",Z?"<span>"+(D||"%"+l)+"</span>":a.text||D,f(b,a.attributes||{})),!j.title&&(V=a.title)&&(j.title=y(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),Z?Re(j,{id:wt+"-label:"+l}):(Yt(a)&&Qe(j,"x"),Ge(ce,j,c),Ge(ne,j,p)),n[i]=a,ht(u,j),++l}ze(function(){ut("a",u)[0].focus()},1)}),!1}},i),vt.tools[e].data=n,s)},vt.bubble=function(){vt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),M=We(t),it(Ut),ht($,Je(Ut,!1,{"class":wt+"-bubble "+M})),k(n)?n(Ut):Je(Ut,n),vt.bubble.fit(),Ie("enter.bubble."+t,[s]),Ie("enter.bubble",[s]),s},vt.bubble.fit=function(t){j=s.$(1),e=Ye(St),G=p(St,"line-height");var n="border-",i="-width";M=j.caret[0].x+e.l-St.scrollLeft,V=j.caret[1].y+e.t+G-St.scrollTop,N=p(It,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var o=je(It),r=je(Ut),l=N[0]+N[1],a=N[2]+N[3];return y(t)?(M=t[0],V=t[1]):(M=b(M,e.l,e.l+o.w-r.w-a),V=b(V,e.t,e.t+o.h-r.h-l)),p(Ut,{left:M+xe,top:V+xe,visibility:"visible"}),Ie("fit.bubble",[s]),Ie("fit",[s]),s},vt.overlay.exit=function(e){return vt.exit(e,"overlay")},vt.modal.exit=function(e){return vt.exit(e,"modal")},vt.drop.exit=function(e){return vt.exit(e,"drop")},vt.bubble.exit=function(e){return vt.exit(e,"bubble")},vt.tool=function(e,t,n){return D="","|"!==e&&(I.tools=I.tools.filter(function(t,n){return t===e?(D=n,!1):!0})),t===!1?delete vt.tools[e]:("|"===e?(n=t,t={}):(k(t)&&(t={click:t}),vt.tools[e]=f(vt.tools[e]||{},t),E(n)||""===D||(n=D)),v(n)?I.tools.splice(n,0,e):I.tools.push(e)),Qt(),s},vt.key=function(e,t){return I.keys?(t===!1?delete vt.keys[e]:vt.keys[e]=t,Xt(),s):s},vt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(me),!1},outdent:function(e,t){return t.outdent(me),!1}},Ge(ce,Mt,wn),vt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return wn(e)},"shift+tab":ge?"outdent":0,tab:ge?"indent":0,escape:function(e,t){return Mt.focus(),!1}},vt.el={container:Lt,header:Ot,body:It,footer:Rt,overlay:Ft,modal:Ht,drop:Gt,bubble:Ut},s.config=I,f(s._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),o=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),a=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>o&&(o="0"+o),10>r&&(r="0"+r),10>l&&(l="0"+l),10>a&&(a="0"+a),[""+t,""+n,""+i,""+o,""+r,""+l,""+a]},replace:Be,format:Pe,dom:{set:ht,reset:mt,get:ut,id:et,copy:function(e,t){return e.cloneNode(E(t)?t:!0)},classes:{set:Qe,reset:Ze,get:Xe},attributes:{set:Re,reset:Se,get:Ne},data:{set:Ce,reset:Fe,get:qe},is:st,offset:Ye,point:Ke,size:je,content:{set:tt,reset:it,get:nt},closest:Ve,parent:ot,children:rt,next:lt,previous:at,before:ft,after:pt,prepend:bt,append:dt},el:Je,event:{set:Ge,reset:Ue,fire:De,x:He},hooks:L,hook:{set:Le,reset:Oe,fire:Ie}}),vt};