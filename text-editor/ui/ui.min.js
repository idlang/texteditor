/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.5.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function ze(e){return _(e)?m(e).split(/\s+/):e}function _e(e){return $(e)?e.join(" "):e}function Oe(e){return e.length}function Ce(e,t,n){return z(e)?z(t)?(z(v[e])||(v[e]={}),z(n)||(n=Oe(Object.keys(v[e]))),v[e][n]=t,l):v[e]:v}function Me(e,t){return z(e)?z(t)&&z(v[e])?(delete v[e][t],l):(v[e]={},l):(v={},l)}function Be(e,t,n){if(!z(v[e]))return v[e]={},l;if(z(n))z(v[e][n])&&v[e][n].apply(l,t);else for(I in v[e])v[e][I].apply(l,t);return l}function He(e,t,n){if($(t))for(I in t)He(e,I,t[I]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Ye(e,n,i){if(_(n))return Ye(e,[n],z(i)?i:"")[0];t=[];for(I in n)I=n[I],(I=e.getAttribute(I))&&t.push(I);return Oe(t)?t:z(i)?i:[]}function je(e,t){if($(t))for(I in t)je(e,t[I]);else if(z(t))e.removeAttribute(t);else for(je(e,"class"),I=0,W=e.attributes,X=Oe(W);X>I;++I)W[I]&&je(e,W[I].name)}function Ne(e,t,n){if($(t))for(I in t)Ne(e,I,t[I]);else He(e,"data-"+t,n)}function De(e,n,i){if(_(n))return De(e,[n],z(i)?i:"")[0];t=[];for(I in n)I=n[I],(I=Ye(e,"data-"+I))&&t.push(I);return Oe(t)?t:z(i)?i:[]}function Ae(e,t){if($(t))for(I in t)je(e,"data-"+t[I]);else if(z(t))je(e,"data-"+t);else for(I=0,W=e.attributes,X=Oe(W);X>I;++I)W[I]&&"data-"===W[I].name.slice(0,5)&&je(e,W[I].name)}function Se(e){return e&&e.preventDefault(),!1}function Fe(e,t,n){if(t){for(e=ze(e),I=0,W=Oe(e);W>I;++I)t.addEventListener(e[I],n,!1),Ce("on:"+e[I],n,tt(t));return l}}function Ie(e,t,n){if(t){for(e=ze(e),I=0,W=Oe(e);W>I;++I)t.removeEventListener(e[I],n,!1),Me("on:"+e[I],tt(t));return w(t)&&t.id.split(":")[0]===Tt+"-dom"&&je(t,"id"),l}}function We(e,t,n){e=ze(e);var r,i="createEvent"in u;for(I=0,W=Oe(e);W>I;++I)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[I],!0,!1),t.dispatchEvent(r)):Be("on:"+e[I],n,tt(t));return l}function Xe(e,t,n){for(I=0,W=Oe(t),X;W>I;++I)X=t[I],e=e.replace(L(X)?X:h(p(X),"g"),n&&n[I]||"");return e}function Pe(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,z(t[n])?t[n]:e})}function qe(e){return m(Xe(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Ke(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Re(e);return{x:n-r.l,y:i-r.t}}function Re(e){for(P=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)P+=e.offsetLeft,J+=e.offsetTop;return{l:P,t:J}}function Ue(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function Ze(e,t){for(;(e=ot(e))&&e!==t;);return e}function Ge(e,t){t=ze(t);for(I in t)e.classList.add(t[I])}function Je(e,n,i){if(_(n))return Je(e,[n],z(i)?i:"")[0];t=[];for(I in n)I=n[I],e.classList.contains(I)&&t.push(I);return Oe(t)?t:z(i)?i:!1}function Qe(e,t){if(z(t)){t=ze(t);for(I in t)e.classList.remove(t[I])}else je(e,"class")}function Ve(e,t){t=ze(t);for(I in t)e.classList.toggle(t[I])}function et(e,t,n){if(e=_(e)?u.createElement(e):e,$(n))for(I in n)if(V=n[I],"classes"===I)Ge(e,V);else if("data"===I)for(W in V)V=V[W],null===V?Ae(e,W):Ne(e,W,V);else"css"===I?_(V)?He(e,"style",V):null===V?je(e,"style"):c(e,V):E(V)?e[I]=V:null===V?je(e,I):He(e,I,$(V)?V.join(" "):""+V);if(w(t))gt(e,t);else if($(t))for(I in t)V=t[I],w(V)?gt(e,V):V!==!1&&nt(e,V);else z(t)&&t!==!1&&nt(e,t);return e}function tt(e){var t=e.id;return t||(t=Tt+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function nt(e,t){e.innerHTML=t}function it(e,t){return e.innerHTML||(z(t)?t:"")}function rt(e,t){if(t!==!1&&(j=ft(e)))for(I=0,W=Oe(j);W>I;++I)rt(j[I]);nt(e,"")}function ot(e){return e&&e.parentNode}function ft(e){return e&&e.children||[]}function st(e){return e&&e.nextSibling}function ut(e){return e&&e.previousSibling}function lt(e){for(I=0;e=ut(e);)++I;return I}function at(e,t){return e&&_(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&E(t)?e===t(e):e===t}function ct(e,n){if(!(n=z(n)?n:u))return[];if(t=[],_(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(I=0,W=Oe(e);W>I;++I)t.push(e[I]);return t}return[]}for(e=n.querySelectorAll(e),I=0,W=Oe(e);W>I;++I)t.push(e[I]);return t}return dt(e)?[e]:[]}function dt(e,t){var n=ot(e);return 1===Oe(arguments)?n||!1:e&&n===e?n:!1}function pt(e,t){R=ot(e),R&&R.insertBefore(t,e)}function bt(e,t){R=ot(e),R&&R.insertBefore(t,st(e))}function ht(e,t){j=ft(e)[0],j?pt(j,t):gt(e,t)}function yt(e,t){gt(e,t)}function gt(e,t){e.appendChild(t)}function mt(e,t){var n=dt(e);if(n){if(t!==!1)for(j=ft(e)[0];j;)mt(j);n.removeChild(e)}}function vt(e){rt(et(e,!1,{style:""})),mt(e)}function xt(e,t,n){return et(t||"div",n,{"class":e})}function Rt(e){return!e||z(e.active)&&!e.active}function Ut(){return Yt.disabled||Yt.readOnly}function Zt(e,t,n){return E(e)&&(e={click:e}),_(e.click)&&(e.click=(n[e.click]||{}).click),e.title=$t[t]||"",z(e.attributes)||(e.attributes={}),n[t]=e,e}function Gt(e){if(Ut())return Yt.focus(),Se(e);kt.exit(0,0,0);var t=De(this,"tool-id"),n=kt.tools,i=n[t];return kt.drop.target=e.currentTarget||e.target,!Rt(i)&&E(W=i.click)&&(W=W(e,l,t),Be("on:change",[e,l,t]),W===!1)?Se(e):(l.select(),Se(e))}function Jt(e){if(J=this,(X=e.TE.key)(/^(escape|f10)$/))kt.exit(1);else if(X("enter")||X("arrowdown")&&De(J,"ui-drop"))kt.drop.target=J,We(oe,J,[e]);else if(X("arrowright")&&(P=st(J))){for(;!at(P,"a")&&P;)P=st(P);P&&P.focus()}else if(X("arrowleft")&&(P=ut(J))){for(;!at(P,"a")&&P;)P=ut(P);P&&P.focus()}return Se(e)}function Qt(){rt(Ht,!1);var r,o,f,s,u,a,c,e=kt.tools,t=ze(B.tools),n=Tt+"-button",i=Tt+"-separator";B.tools=t;for(a in t)c=t[a],o=e[c],(o||o==={})&&(o=Zt(o,c,e),f=o.i||c,"|"!==f&&"<"!==f[0]&&(f=qe(f)),s="|"!==f,u=qe(c).replace(/[\/\s]/g,"-"),qt=xt(s?n+" "+n+"-"+u:i+" "+i+"-"+a,s?"a":"span"),s?(qt=o.target||qt,r=n+":"+u,He(qt,{href:$e,id:r,tabindex:-1}),Ne(qt,"tool-id",c),f="<"===f[0]?f:'<i class="'+Pe(Et,[u,f])+'"></i>',Rt(o)?Ge(qt,"x"):Qe(qt,"x"),o.on?Ge(qt,"on"):Qe(qt,"on"),o.text&&(f=Pe('<span class="'+Tt+'-text">'+o.text+"</span>",[f]),Ge(qt,"text")),nt(qt,f),et(qt,!1,o.attributes),!o.attributes.title&&(W=o.title)&&(qt.title=$(W)?W[0]+(W[1]?" ("+W[1]+")":""):W),Fe(oe,qt,Gt),Fe(ae,qt,Jt)):qt.id=i+":"+a,o.target=qt,gt(Ht,qt));Be("update.tools",[l])}function Vt(){kt.keys=function(){var n,e=Object.keys(kt.keys).sort().reverse(),t={};for(I=0,W=Oe(e);W>I;++I)n=e[I],t[n]=kt.keys[n];return t}(),rn(),Be("update.keys",[l])}function nn(e){function d(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}if(Ut())return Yt.focus(),Se(e);var n=l.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,u=kt.keys,a=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();K=e.TE.key(),en[K]=1,t=Oe(Object.keys(en)),g(function(){l.record()});for(I in u){X=d(I),j=0;for(W in X)W=X[W],en[a[W]||W]&&++j;if(X=Oe(X),j===X&&t===X&&(_(u[I])&&(u[I]=kt.tools[u[I]].click),P=u[I]&&u[I](e,l),P===!1))return Se(e)}if(ge)for(I in ge)if(q=ge[I],q!==!1){if(K===q&&f===q)return"\\"===o?(l.insert(K,0),Se(e)):(l.select(n.end+1),Se(e));if(I===K)return l.wrap(I,q),Se(e);if(o===I&&f===q){if("backspace"===K&&i.slice(-2)!=="\\"+I)return l.unwrap(I,q),Se(e);if(me&&"enter"===K&&I!==q)return l.tidy("\n"+c+xe,"\n"+c).scroll(1),Se(e)}}if(me&&!s){if("backspace"===K&&h(p(xe)+"$").test(i))return l.outdent(xe),Se(e);if("enter"===K&&h("(^|\\n)("+p(xe)+")+.*$").test(i))return l.insert("\n"+c,0,1).scroll(1),Se(e)}}function rn(e){e&&e.TE&&e.TE.key?delete en[e.TE.key()]:en={}}function ln(e){return on=jt,G=Ue(Bt),Se(e)}function an(e){on===jt&&c(Yt,{height:Ke(Mt,e).y-G.h+Le})}function cn(){on=0}function dn(){kt.exit(1)}function pn(){t=Ue(St),ee=t.w,F=t.h,t=Ue(At),fn=t.w,sn=t.h}function bn(e,t){t&&Be("exit.modal."+t,[l]),We(oe,At,[e])}function hn(e){on=e.target,t=Ke(St,e),te=t.x,ne=t.y,pn()}function yn(e){var n=un.header,i=un.resize;on===n||Ze(on,n)===n?(t=Ke(Mt,e),P=t.x-te,J=t.y-ne,c(St,{left:(ee>fn?P:d(P,0,fn-ee))+Le,top:(F>sn?J:d(J,0,sn-F))+Le})):on===i&&(t=Ke(St,e),G=Ue(i),c(St,{width:t.x+G.w/4+Le,height:t.y+G.h/4+Le}))}function gn(){on=0}function mn(e,t,n){return{header:e,body:t,footer:n}}function vn(e){H=kt.drop.target,Y=Ft,j=e&&e.target||0,(!j||j!==H&&Ze(j,H)!==H)&&(kt.drop.target=0,vt(Ft),Ie(oe,u,vn),Ie(ye,s,vn),kt.exit(e.target===Yt))}var H,Y,j,A,F,I,W,X,P,q,K,t,R,Z,G,J,V,ee,te,ne,n="⌘",i="…",o="⇥",f="⇧",s=window,u=document,l=new TE(e),a=l._,c=a.css,d=a.edge,p=a.x,b=a.extend,h=a.pattern,g=(a.timer.reset,a.timer.set),m=a.trim,v={},x=function(){},k=TE.is,w=k.e,E=k.f,T=k.i,$=k.o,L=k.r,z=function(e){return!k.x(e)},_=k.s,O=u.documentElement,M=(u.head,u.body),B=b({tab:"  ",dir:"ltr",resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"icon icon-%1 icon-%1--%2 fa fa-%2"}},t),re="blur",oe="click",ae="keydown",ce="keyup",de="touchstart mousedown",pe="touchmove mousemove",be="touchend mouseup",ye="orientationchange resize",ge=B.auto_close,me=B.auto_tab,ve=B.languages,xe=B.tab,we=(B.unit[0][1],B.unit[0][0]),Ee=B.unit[1][1],Te=B.unit[1][0],$e="javascript:;",Le="px",kt=l.ui={};l.tidy=function(e,t){var n=l.$(),i=m(n.before)?e:"",r=m(n.after)?z(t)?t:e:"";return l.trim(i,r)},l.i=function(){return m(l.replace(/\s+/g," "))},l.format=function(e,t,n,i){$(e)||(e=[e]),z(n)||(n=" "),z(i)||(i="");var r=l.h,o=l[0]().$(),f=(e[0]?we[0]+e[0]+we[1]:"")+i,s=i+(e[0]?we[0]+we[2]+(e[1]||e[0].split(h("("+Ee[3]+")+"))[0])+we[1]:""),u=p(f),a=p(s),c=h("^"+u+"([\\s\\S]*?)"+a+"$"),d=h(u+"$"),b=h("^"+a),y=o.before,g=o.after;return o.length?n=!1:l.insert(ve.placeholders[""]),l.toggle(t?!c.test(o.value):!d.test(y)&&!b.test(g),[function(e){e.unwrap(f,s,1).tidy(h(Te[0]+"[^"+Te[0]+Te[1]+Te[2]+"]+?"+Te[1]+"$").test(y)?"":n,h("^"+Te[0]+Te[2]+"[^"+Te[0]+Te[1]+"]+?"+Te[1]).test(g)?"":n).wrap(f,s,t)},function(e){e.unwrap(f,s,t)}])[r]()};var qt,wt=B.classes,Et=wt.i,Tt=wt[""],$t=ve.tools,Lt=ve.buttons,zt=ve.labels,_t=Tt+"-textarea "+Tt+"-content block",Ot=xt(Tt),Ct=xt(Tt+"-header"),Mt=xt(Tt+"-body"),Bt=xt(Tt+"-footer"),Ht=xt(Tt+"-tool"),Yt=et(e,!1,B.attributes),jt=xt(Tt+"-resize s"),Nt=xt(Tt+"-description"),Dt=xt(Tt+"-panel"),At=xt(Tt+"-overlay"),St=et("div"),Ft=et("div"),It=et("div"),Wt=xt("left","span"),Xt=xt("right","span"),Pt=0;z(B.suffix)||(B.suffix=we[1]);var en={},on=0,te=0,ne=0,ee=0,F=0,fn=0,sn=0,un={};l.create=function(e,t){$(e)&&(B=b(B,e));var n=dt(Yt);return Ge(Ot,Tt+"-is-can-update"),Ge(Ot,Tt+"-is-can-copy"),Ge(Yt,_t),n&&at(n,"p")?(pt(n,Ot),Pt=n,mt(n,!1)):pt(Yt,Ot),Ot.dir=B.dir,gt(Ot,Ct),gt(Ot,Mt),gt(Ot,Bt),gt(Mt,Yt),B.tools&&(gt(Ct,Ht),gt(Bt,Nt),gt(Nt,Wt),gt(Nt,Xt)),Fe(ae,Yt,nn),Fe(ce+" "+re,Yt,rn),B.resize&&(gt(Ot,jt),Ge(Ot,Tt+"-is-can-resize"),Fe(de,jt,ln),Fe(pe,u,an),Fe(be,M,cn)),Qt(),Vt(),0!==t?Be("create",[l]):l},l.update=function(e,t){return Je(Yt,ze(_t),0)&&l.destroy(0),(0!==t?Be("update",[l]):l).create(e,0)},l.destroy=function(e){return Je(Yt,ze(_t),0)?(kt.exit(0,0,0),Qe(Yt,_t),B.tools=_e(B.tools),B.keys&&(Ie(ae,Yt,nn),Ie(ce,Yt,rn)),B.resize&&(Ie(de,jt,ln),Ie(pe,u,an),Ie(be,u,cn)),Pt?(pt(Ot,Pt),gt(Pt,Yt),Pt=0):pt(Ot,Yt),vt(Ot),0!==e?Be("destroy",[l]):l):l},l.enable=function(e){return Yt.disabled=Yt.readOnly=!1,Ge(Ot,Tt+"-is-can-update"),Ge(Ot,Tt+"-is-can-copy"),0!==e?Be("enable",[l]):l},l.disable=function(e){return Yt.disabled=!0,Qe(Ot,Tt+"-is-can-update"),Qe(Ot,Tt+"-is-can-copy"),0!==e?Be("disable",[l]):l},l.freeze=function(e){return Yt.disabled=!1,Yt.readOnly=!0,Qe(Ot,Tt+"-is-can-update"),Ge(Ot,Tt+"-is-can-copy"),0!==e?Be("freeze",[l]):l},kt.exit=function(e,t,n){if(A={panel:function(){vt(Dt)},overlay:function(){Ie(oe,At,dn),vt(At)},modal:function(){Ie(de,Mt,hn),Ie(pe,Mt,yn),Ie(be,u,gn),Ie(oe,un.x,bn),vt(St)},drop:function(){vt(Ft)},bubble:function(){vt(It)}},rn(),t)if($(t))for(I in t)I=t[I],A[I]&&A[I](),0!==n&&Be("exit."+I,[l]);else A[t]&&A[t](),0!==n&&Be("exit."+I,[l]);else for(I in A)A[I]();return e&&l.select(),0!==n&&Be("exit",[l]),l},kt.panel=function(e,t){function n(){Ie(oe,te,n),kt.panel.exit(1)}return kt.exit(0,0,0),te=xt(Tt+"-x"),te.title=Lt.close,Fe(oe,te,n),rt(Dt),gt(Mt,et(Dt,[xt(Tt+"-panel-content","div",e),te])),E(t)?t(Dt):et(Dt,t),Be("enter.panel",[l]),Be("enter",[l]),l},kt.panel.fit=function(){},kt.overlay=function(e,t){return kt.exit(0,0,0),gt(Mt,At),e&&Fe(oe,At,dn),E(t)?t(At):et(At,t),Be("enter.overlay",[l]),Be("enter",[l]),l},kt.overlay.fit=function(){},kt.modal=function(){kt.overlay(1).blur();var f,s,e=arguments,t=e[0],n=e[1],i=e[2],r=Tt+"-modal",o=n.footer;if($(t)&&(t="default",n=e[0],i=e[1]),P=qe(t),et(St,!1,{"class":r+" "+P}),z(n.body)&&(n.body=et("div",n.body,{"class":r+"-content "+P})),z(o)&&$(o)&&!w(o)){s=[];for(I in o)W=o[I],w(W)?s.push(W):(W=Zt(W,I,o),t=I.text||Lt[I]||I,f=et("button",t,b({name:"y["+I+"]",type:"button","class":Tt+"-button",data:{"button-id":I}},W.attributes)),Fe(oe,f,function(e){return t=o[De(this,"button-id")].click(e,l),t===!1?Se(e):void 0}),s.push(f));n.footer=s}for(I in n)r[1]=I,un[I]=xt(r+"-"+Pe(I,r)+" "+P,0,n[I]);return un.x=xt(Tt+"-x "+P),un.resize=xt(Tt+"-resize se "+P),rt(St),un.x.title=Lt.close,gt(Mt,et(St,un,{style:""})),kt.modal.fit(),bt(St,At),Fe(oe,un.x,bn),Fe(de,un.header,Se),Fe(de,un.resize,Se),Fe(de,Mt,hn),Fe(pe,Mt,yn),Fe(be,u,gn),E(i)&&(un.overlay=At,un.modal=St,i(un)),Be("enter.modal."+t,[l]),Be("enter.modal",[l]),Be("enter",[l]),l},kt.modal.fit=function(e){return pn(),P=fn/2-ee/2,J=sn/2-F/2,$(e)?(z(e[0])&&(P=e[0]),z(e[1])&&(J=e[1])):(P=d(P,0),J=d(J,0)),c(St,{left:P+Le,top:J+Le,"min-width":ee+Le,"min-height":F+Le,visibility:"visible"}),Be("fit.modal",[l]),Be("fit",[l]),l};var xn={"class":Tt+"-button",name:"y"};return kt.alert=function(e,t,n,i){var r=et("button",Lt.okay,xn),o="alert";return n=n||x,$(e)&&(o+=":"+e[0],e=e[1]||e[0]),Fe(oe,r,function(e){return n(e,l),bn(e,o+".y"),Se(e)}),Fe(ae,r,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&We(oe,r,[e]),Se(e)}),kt.modal(o,mn(e,t,r),i),r.focus(),l},kt.confirm=function(e,t,n,i,r){function a(e){return E(n)&&n(e,l),bn(e,s+".y"),Se(e)}function c(e){return E(i)&&i(e,l),bn(e,s+".n"),Se(e)}var u,o=et("button",Lt.okay,xn),f=et("button",Lt.cancel,xn),s="confirm";return f.name="n",$(e)&&(s+=":"+e[0],e=e[1]||e[0]),Fe(oe,o,a),Fe(oe,f,c),Fe(ae,o,function(e){return u=e.TE.key,u("arrowright")?f.focus():u("enter")?a(e):u("escape")&&bn(e,s+".y"),Se(e)}),Fe(ae,f,function(e){return u=e.TE.key,u("arrowleft")?o.focus():u("enter")?c(e):u("escape")&&bn(e,s+".n"),Se(e)}),kt.modal(s,mn(e,t,[o,f]),r),f.focus(),l},kt.prompt=function(e,t,n,i,r,o){function h(){u.focus(),"placeholder"in u&&u.select()}function y(e){d=u.value,E(n)&&!n(d)?h():!n||m(d)&&d!==t?(bn(e,a+".y"),i(e,l,d!==t?d:"",t)):h()}function g(e){bn(e,a+".n")}var d,p,b,f=et("button",Lt.okay,xn),s=et("button",Lt.cancel,xn),u=et("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Tt+"-input block"}),a="prompt",c=[];if($(e)&&(a+=":"+e[0],e=e[1]||e[0]),E(r)&&(o=r,r=0),1===r)u=et("textarea",t,{placeholder:t.split("\n")[0],"class":Tt+"-textarea block",spellcheck:"false"});else if(2===r){for(I in t)c.push(et("option",t[I],{value:I,selected:I===n||null}));u=et("select",c,{"class":Tt+"-select block"})}return i=i||x,u.name="data",s.name="n",Fe(ae,u,function(e){return p=e.TE.key,b=e.TE.control,p("enter")&&1!==r||b("enter")?(y(e),Se(e)):p("escape")||p("backspace")&&!this.value?(g(e),Se(e)):p("arrowdown")&&1!==r&&2!==r||b("arrowdown")?(f.focus(),Se(e)):void 0}),Fe(ae,f,function(e){return p=e.TE.key,p("enter")?y(e):p("escape")?g(e):p("arrowup")?u.focus():p("arrowright")&&s.focus(),Se(e)}),Fe(ae,s,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?g(e):p("arrowup")?u.focus():p("arrowleft")&&f.focus(),Se(e)}),Fe(oe,f,y),Fe(oe,s,g),kt.modal(a,mn(e,u,[f,s]),o),h(),l},kt.drop=function(){kt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Oe(e)&&(t="default",n=e[0]),P=qe(t),rt(Ft),gt(M,et(Ft,!1,{"class":Tt+"-drop "+P})),E(n)?n(Ft):et(Ft,n),kt.drop.fit(),Fe(oe,u,vn),Fe(ye,s,vn),Be("enter.drop."+t,[l]),Be("enter.drop",[l]),l},kt.drop.fit=function(e){return H=Ue(O),Y=Ue(Ft),j=kt.drop.target,P=H.w/2-Y.w/2,J=H.h/2-Y.h/2,!z(e)&&j&&(t=Re(j),P=t.l,J=t.t+Ue(j).h),$(e)?(z(e[0])&&(P=e[0]),z(e[1])&&(J=e[1])):(P=d(P,0,H.w-Y.w),J=d(J,0,Math.max(H.h,Ue(s).h)-Y.h)),c(Ft,{left:P+Le,top:J+Le,visibility:"visible"}),Be("fit.drop",[l]),Be("fit",[l]),l},kt.menu=function(e,n,i,r){var c,o='<span class="'+Tt+'-current menu">%1</span>',f="",s=n,u=kt.tools,a=0;if(n=!$(n)&&i[n]&&i[n].text||n,n===!1)return kt.tool(e,n);$(n)&&(f=n[0],f="<"===f[0]?f:'<i class="'+Pe(Et,[qe(e).replace(/[\/\s]/g,"-"),f])+'"></i>',n=s=z(n[1])?n[1]:0,n=n&&i[n]&&i[n].text||n,o=f+(0!==n?" "+o:""));for(r in i)ee="%"===r[0],c=i[r],c=_(c)&&!ee?u[c]:c,c&&(c=Zt(c,r,u),i[r]=c);return kt.tool(e,{i:f,text:n?Pe(o,[n,f]):0,click:function(s){var d=kt.drop.target=u[e].target;return kt.drop("menu menu-"+qe(e),function(s){function p(e){return J=this,t=De(J,"tool-id"),q=i[t],q=_(q)?u[q]:q||{},K=it(J),!Rt(q)&&E(r=q.click)&&(r=r(e,l),n!==!1&&d&&(j=ft(d)[0]||d,at(j,"i")||nt(j,Pe(o,[K,f])),$(q.text)&&(j=ft(j)[0])&&at(j,"i")&&(Qe(j),Ge(j,Pe(Et,[q.text[0]])))),Ne(d,"ui-drop-menu",t),r===!1)?(l.select(),Se(e)):(l.select(),Se(e))}function h(e){if(J=this,(X=e.TE.key)("escape"))kt.exit(1);else if(X("enter"))We(oe,J,[e]);else if(X("f10")&&d)d.focus();else if(X("arrowdown")&&(P=st(J))){for(;!at(P,"a")&&P;)P=st(P);P&&P.focus()}else if(X("arrowup")&&(P=ut(J))){for(;!at(P,"a")&&P;)P=ut(P);!P&&d?(kt.exit(),d.focus()):P&&P.focus()}else X("arrowup")&&d&&(kt.exit(),d.focus());return Se(e)}for(r in i)if(c=i[r],ee="%"===r[0],c){var y={href:ee?null:$e,"class":Tt+"-"+(ee?"label":"button")};ee?W=zt[e]&&zt[e][+r.slice(1)-1]||r:(y.data={},y.data["tool-id"]=r,W=$t[r]||r),Z=c.text,Z=$(Z)?Z[1]||"":Z,W=$(W)?W[0]:W,G=et(ee?"span":"a","<span>"+(ee?W||"%"+a:Z||W)+"</span>",b(y,c.attributes||{})),Ge(G,"menu-"+qe(r).replace(/[\/\s]/g,"-")),!y.title&&(J=c.title)&&(G.title=$(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),ee?He(G,{id:Tt+"-label:"+a}):(Rt(c)?Ge(G,"x"):Qe(G,"x"),c.on?Ge(G,"on"):Qe(G,"on"),Fe(oe,G,p),Fe(ae,G,h)),gt(s,G),++a}g(function(){(ct('[data-tool-id="'+De(d,"ui-drop-menu")+'"]',s)[0]||ct("a",s)[0]).focus()},1)}),!1}},r),Ne(u[e].target,{"ui-drop":e,"ui-drop-menu":s}),u[e].data=i,l},kt.bubble=function(){kt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===Oe(e)&&(t="default",n=e[0]),P=qe(t),rt(It),gt(M,et(It,!1,{"class":Tt+"-bubble "+P})),E(n)?n(It):et(It,n),kt.bubble.fit(),Be("enter.bubble."+t,[l]),Be("enter.bubble",[l]),l},kt.bubble.fit=function(e){G=l.$(1),t=Re(Yt),F=c(Yt,"line-height");var n="border-",i="-width";P=G.caret[0].x+t.l-Yt.scrollLeft,J=G.caret[1].y+t.t+F-Yt.scrollTop,Y=c(Mt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=Ue(Mt),o=Ue(It),f=Y[0]+Y[1],s=Y[2]+Y[3];return $(e)?(z(e[0])&&(P=e[0]),z(e[1])&&(J=e[1])):(P=d(P,t.l,t.l+r.w-o.w-s),J=d(J,t.t,t.t+r.h-o.h-f)),c(It,{left:P+Le,top:J+Le,visibility:"visible"}),Be("fit.bubble",[l]),Be("fit",[l]),l},kt.panel.exit=function(e){return kt.exit(e,"panel")},kt.overlay.exit=function(e){return kt.exit(e,"overlay")},kt.modal.exit=function(e){return kt.exit(e,"modal")},kt.drop.exit=function(e){return kt.exit(e,"drop")},kt.bubble.exit=function(e){return kt.exit(e,"bubble")},kt.tool=function(e,t,n){return W="","|"!==e&&(B.tools=ze(B.tools).filter(function(t,n){return t===e?(W=n,!1):!0})),t===!1?delete kt.tools[e]:("|"===e?(n=t,t={}):(E(t)&&(t={click:t}),kt.tools[e]=b(kt.tools[e]||{},t),z(n)||""===W||(n=W)),T(n)?B.tools.splice(n,0,e):B.tools.push(e)),Qt(),l},kt.separator=function(e,t){return kt.tool("|",e!==!1?{attributes:e||{}}:!1,t)},kt.key=function(e,t){return B.keys?(t===!1?delete kt.keys[e]:kt.keys[e]=t,Vt(),l):l},kt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(xe),!1},outdent:function(e,t){return t.outdent(xe),!1}},kt.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return Z=":not([tabindex]):not([disabled])",(G=ct("input"+Z+",button"+Z+",select"+Z+",textarea"+Z+",a[href]"+Z+",[contenteditable]"+Z+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(J=G.indexOf(Yt))?((G[J+1]||u).focus(),!1):void 0},f10:function(e,t){return ct("a",Ht)[0].focus(),!1},"shift+tab":me?"outdent":0,tab:me?"indent":0},kt.el={container:Ot,header:Ct,body:Mt,footer:Bt,panel:Dt,overlay:At,modal:St,drop:Ft,bubble:It},l.config=B,b(TE._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),s=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),[""+t,""+n,""+i,""+r,""+o,""+f,""+s]},replace:Xe,format:Pe,dom:{set:gt,reset:mt,get:ct,id:tt,copy:function(e,t){return e.cloneNode(z(t)?t:!0)},classes:{set:Ge,reset:Qe,toggle:Ve,get:Je},attributes:{set:He,reset:je,get:Ye},data:{set:Ne,reset:Ae,get:De},is:at,offset:Re,pointer:Ke,size:Ue,content:{set:nt,reset:rt,get:it},closest:Ze,parent:ot,children:ft,next:st,previous:ut,index:lt,before:pt,after:bt,prepend:ht,append:yt},el:et,event:{set:Fe,reset:Ie,fire:We,x:Se}}),b(l._,TE._),b(l._,{hooks:v,hook:{set:Ce,reset:Me,fire:Be}}),l.create()};