/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.8.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.ui=function(e,t){function Me(e){return C(e)?g(e).split(/\s+/):e}function Oe(e){return z(e)?e.join(" "):e}function De(e,t){return-1!==e.indexOf(t)}function He(e){return e.length}function Ne(e){return Object.keys(e)}function Se(e){return He(Ne(e))}function Be(e,t,n){return _(e)?_(t)?(_(v[e])||(v[e]={}),_(n)||(n=Se(v[e])),v[e][n]=t,a):v[e]:v}function Ye(e,t){return _(e)?_(t)&&_(v[e])?(delete v[e][t],a):(v[e]={},a):(v={},a)}function je(e,t,n){if(!_(v[e]))return v[e]={},a;if(_(n))_(v[e][n])&&v[e][n].apply(a,t);else for(q in v[e])v[e][q].apply(a,t);return a}function Ae(e,t,n){if(z(t))for(q in t)Ae(e,q,t[q]);else e[(null===n?"remove":"set")+"Attribute"](t,n)}function Fe(e,n,i){if(C(n))return Fe(e,[n],_(i)?i:"")[0];t=[];for(q in n)q=n[q],(q=e.getAttribute(q))&&t.push(q);return He(t)?t:_(i)?i:[]}function Ie(e,t){if(z(t))for(q in t)Ie(e,t[q]);else if(_(t))e.removeAttribute(t);else for(Ie(e,"class"),q=0,K=e.attributes,P=He(K);P>q;++q)K[q]&&Ie(e,K[q].name)}function We(e,t,n){if(z(t))for(q in t)We(e,q,t[q]);else Ae(e,"data-"+t,n)}function Xe(e,n,i){if(C(n))return Xe(e,[n],_(i)?i:"")[0];t=[];for(q in n)q=n[q],(q=Fe(e,"data-"+q))&&t.push(q);return He(t)?t:_(i)?i:[]}function qe(e,t){if(z(t))for(q in t)Ie(e,"data-"+t[q]);else if(_(t))Ie(e,"data-"+t);else for(q=0,K=e.attributes,P=He(K);P>q;++q)K[q]&&"data-"===K[q].name.slice(0,5)&&Ie(e,K[q].name)}function Ke(e){return e&&e.preventDefault(),!1}function Pe(e,t,n){if(t){for(e=Me(e),q=0,K=He(e);K>q;++q)t.addEventListener(e[q],n,!1),Be("on:"+e[q],n,st(t));return a}}function Re(e,t,n){if(t){for(e=Me(e),q=0,K=He(e);K>q;++q)t.removeEventListener(e[q],n,!1),Ye("on:"+e[q],st(t));return w(t)&&t.id.split(":")[0]===Ct+"-dom"&&Ie(t,"id"),a}}function Ue(e,t,n){e=Me(e);var r,i="createEvent"in u;for(q=0,K=He(e);K>q;++q)i?(r=u.createEvent("HTMLEvents"),r.data=n,r.initEvent(e[q],!0,!1),t.dispatchEvent(r)):je("on:"+e[q],n,st(t));return a}function Ze(e,t,n){for(q=0,K=He(t),P;K>q;++q)P=t[q],e=e.replace(L(P)?P:h(p(P),"g"),n&&n[q]||"");return e}function Ge(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,_(t[n])?t[n]:e})}function Je(e){return g(Ze(e.toLowerCase(),[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Qe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,r=Ve(e);return{x:n-r.l,y:i-r.t}}function Ve(e){for(R=e.offsetLeft,ee=e.offsetTop;e=e.offsetParent;)R+=e.offsetLeft,ee+=e.offsetTop;return{l:R,t:ee}}function et(e){return e===s?{w:e.innerWidth,h:e.innerHeight}:{w:e.offsetWidth,h:e.offsetHeight}}function tt(e,t){for(;(e=ct(e))&&e!==t;);return e}function nt(e,t){t=Me(t);for(q in t)e.classList.add(t[q])}function it(e,n,i){if(C(n))return it(e,[n],_(i)?[i]:[""])[0];t=[];for(q in n)q=n[q],e.classList.contains(q)&&t.push(q);return He(t)?t:_(i)?i:!1}function rt(e,t){if(_(t)){t=Me(t);for(q in t)e.classList.remove(t[q])}else Ie(e,"class")}function ot(e,t){t=Me(t);for(q in t)e.classList.toggle(t[q])}function ft(e,t,n){if(e=e||"div",e=C(e)?u.createElement(e):e,z(n))for(q in n)if(ne=n[q],"classes"===q)nt(e,ne);else if("data"===q)for(K in ne)ne=ne[K],null===ne?qe(e,K):We(e,K,ne);else"css"===q?C(ne)?Ae(e,"style",ne):null===ne?Ie(e,"style"):c(e,ne):T(ne)?e[q]=ne:null===ne?Ie(e,q):Ae(e,q,E(ne)?ne.join(" "):""+ne);if(w(t))Et(e,t);else if(z(t))for(q in t)ne=t[q],w(ne)?Et(e,ne):ne!==!1&&ut(e,ne);else _(t)&&t!==!1&&ut(e,t);return e}function st(e){var t=e.id;return t||(t=Ct+"-dom:"+Math.floor(Date.now()*Math.random()),e.id=t),t}function ut(e,t){e.innerHTML=t}function at(e,t){return e.innerHTML||(_(t)?t:"")}function lt(e,t){if((!_(t)||t)&&(j=dt(e)))for(q=0,K=He(j);K>q;++q)lt(j[q]);ut(e,"")}function ct(e){return e&&e.parentNode}function dt(e){return e&&e.children||[]}function pt(e){return e&&e.nextSibling}function bt(e){return e&&e.previousSibling}function ht(e){for(q=0;e=bt(e);)++q;return q}function yt(e,t){return e&&C(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&T(t)?e===t(e):e===t}function xt(e,n){if(!(n=_(n)?n:u))return[];if(t=[],C(e)){if(/^([#.]?[\w-]+|\*)$/.test(e)){if("#"===e[0]&&(e=n.getElementById(e.slice(1))))return[e];if("."===e[0]&&(e=n.getElementsByClassName(e.slice(1)))||(e=n.getElementsByTagName(e))){for(q=0,K=He(e);K>q;++q)t.push(e[q]);return t}return[]}for(e=n.querySelectorAll(e),q=0,K=He(e);K>q;++q)t.push(e[q]);return t}return gt(e)?[e]:[]}function gt(e,t){var n=ct(e);return 1===He(arguments)?n||!1:e&&n===e?n:!1}function vt(e,t){G=ct(e),G&&G.insertBefore(t,e)}function mt(e,t){G=ct(e),G&&G.insertBefore(t,pt(e))}function kt(e,t){j=dt(e)[0],j?vt(j,t):Et(e,t)}function wt(e,t){Et(e,t)}function Et(e,t){e.appendChild(t)}function Tt(e,t){var n=gt(e);if(n){if(!_(t)||t)for(j=dt(e)[0];j;)Tt(j);n.removeChild(e)}}function $t(e){lt(ft(e,!1,{style:""})),Tt(e)}function zt(e,t,n){return ft(t,n,{"class":e})}function en(e){return!e||_(e.active)&&!e.active}function tn(e,t,n){return T(e)&&(e={click:e}),C(e.click)&&(e.click=(n[e.click]||{}).click),e.title=Mt[t]||"",_(e.attributes)||(e.attributes={}),n[t]&&(n[t]=e),e}function nn(e){Lt.exit(0,0,0);var t=Xe(this,"tool-id"),n=Lt.tools,i=n[t];return Lt.drop.target=e.currentTarget||e.target,!en(i)&&T(K=i.click)&&(K=K(e,a,t),je("on:change",[e,a,t]),K===!1)?Ke(e):(a.select(),Ke(e))}function rn(e){if(ee=this,(P=e.TE.key)(/^(escape|f10)$/))Lt.exit(1);else if(P("enter")||P("arrowdown")&&Xe(ee,"ui-drop"))Lt.drop.target=ee,Ue(ue,ee,[e]);else if(P("arrowright")&&(R=pt(ee))){for(;!yt(R,"a")&&R;)R=pt(R);R&&R.focus()}else if(P("arrowleft")&&(R=bt(ee))){for(;!yt(R,"a")&&R;)R=bt(R);R&&R.focus()}return Ke(e)}function fn(){lt(Ft,0);var r,o,f,s,u,l,c,e=Lt.tools,t=Me(N.tools),n=Ct+"-button",i=Ct+"-separator";N.tools=t;for(l in t)c=t[l],o=e[c],(o||o==={})&&(o=tn(o,c,e),f=o.i||c,"|"===f||De(f,"<")||(f=Je(f)),s="|"!==f,u=Je(c).replace(/[\/\s]/g,"-"),Qt=zt(s?n+" "+n+"-"+u:i+" "+i+"-"+l,s?"a":"span"),s?(Qt=o.target||Qt,r=n+":"+u,Ae(Qt,{href:_e,id:r,tabindex:-1}),We(Qt,"tool-id",c),f=De(f,"<")?f:Lt.i(u,f),en(o)?nt(Qt,"x"):rt(Qt,"x"),o.on?nt(Qt,"on"):rt(Qt,"on"),o.text&&(f=Ge('<span class="'+Ct+'-text">'+o.text+"</span>",[f]),nt(Qt,"text")),ut(Qt,f),ft(Qt,!1,o.attributes),!o.attributes.title&&(K=o.title)&&(Qt.title=z(K)?K[0]+(K[1]?" ("+K[1]+")":""):K),Pe(ue,Qt,nn),Pe(pe,Qt,rn)):Qt.id=i+":"+l,o.target=Qt,(u=Xe(Qt,on))&&Lt.menu.set(c,u),Et(Ft,Qt));je("update.tools",[a])}function sn(){Lt.keys=function(){var n,e=Ne(Lt.keys).sort().reverse(),t={};for(q=0,K=He(e);K>q;++q)n=e[q],t[n]=Lt.keys[n];return t}(),an(),je("update.keys",[a])}function un(e){function b(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=a.$(),i=n.before,r=n.after,o=i.slice(-1),f=r[0],s=n.length,u=Lt.keys,l=TE.keys_alias,c={control:0,shift:0,option:"alt",meta:0},d=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();for(q in c)e.TE[q]()&&(S[c[q]||q]=1);Z=e.TE.key(),S[Z]=1,t=Se(S),x(function(){a.record()});for(q in u){P=b(q),j=0;for(K in P)K=P[K],S[l[K]||K]&&++j;if(P=He(P),j===P&&t===P&&(C(u[q])&&(u[q]=Lt.tools[u[q]].click),R=T(u[q])&&u[q](e,a),R===!1))return Ke(e)}if(me)for(q in me)if(U=me[q],U!==!1){if(Z===U&&f===U)return"\\"===o?(a.insert(Z,0),Ke(e)):(a.select(n.end+1),Ke(e));if(q===Z)return a.wrap(q,U),Ke(e);if(o===q&&f===U){if("backspace"===Z&&i.slice(-2)!=="\\"+q)return a.unwrap(q,U),Ke(e);if(ke&&"enter"===Z&&q!==U&&!s)return a.tidy("\n"+d+Ee,"\n"+d).scroll(1),Ke(e)}}if(ke&&!s){if("backspace"===Z&&h(p(Ee)+"$").test(i))return a.outdent(Ee),Ke(e);if("enter"===Z&&h("(^|\\n)("+p(Ee)+")+.*$").test(i))return a.insert("\n"+d,0,1).scroll(1),Ke(e)}}function an(e){e&&e.TE&&e.TE.key?delete S[e.TE.key()]:S={}}function bn(e){return ln=Nt,V=et(At),Ke(e)}function hn(e){ln===Nt&&c(It,{height:Qe(jt,e).y-V.h+Ce})}function yn(){ln=0}function xn(){Lt.exit(1)}function gn(){t=et(Kt),ie=t.w,X=t.h,t=et(qt),cn=t.w,dn=t.h}function vn(e,t){return t&&je("exit.modal."+t,[a]),Ue(ue,qt,[e]),Ke(e)}function mn(e){ln=e.target,t=Qe(Kt,e),re=t.x,oe=t.y,gn()}function kn(e){var n=pn.header,i=pn.sizer;ln===n||tt(ln,n)===n?(t=Qe(jt,e),R=t.x-re,ee=t.y-oe,c(Kt,{left:(ie>cn?R:d(R,0,cn-ie))+Ce,top:(X>dn?ee:d(ee,0,dn-X))+Ce})):ln===i&&(t=Qe(Kt,e),V=et(i),c(Kt,{width:t.x+V.w/4+Ce,height:t.y+V.h/4+Ce}))}function wn(){ln=0}function En(e,t,n){return{header:e,body:t,footer:n}}function Tn(e){B=Lt.drop.target,Y=Pt,j=e&&e.target||0,(!j||j!==B&&tt(j,B)!==B)&&(Lt.drop.target=0,Lt.exit(j===It))}var B,Y,j,I,X,q,K,P,R,U,Z,t,G,Q,V,ee,te,ne,ie,re,oe,n="⌘",i="…",o="⇥",f="⇧",s=window,u=document,a=new TE(e),l=a._,c=l.css,d=l.edge,p=l.x,b=l.extend,h=l.pattern,y=l.timer.reset,x=l.timer.set,g=l.trim,v={},m=function(){},k=TE.is,w=k.e,E=k.a,T=k.f,$=k.i,z=k.o,L=k.r,_=function(e){return!k.x(e)},C=k.s,M=u.documentElement,D=(u.head,u.body),N=(u.currentScript,b({tab:"  ",direction:"ltr",path:TE.path,resize:1,keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{tools:["Focus Tools","F10"],undo:["Undo",n+"+Z"],redo:["Redo",n+"+Y"],indent:["Indent",o],outdent:["Outdent",f+"+"+o]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},labels:{},others:{}},classes:{"":"text-editor",i:"text-editor-i text-editor-i-%1 text-editor-i-%1--%2 fa fa-%2"}},t)),S={},se="blur",ue="click",pe="keydown",be="keyup",he="touchstart mousedown",ye="touchmove mousemove",xe="touchend mouseup",ve="orientationchange resize",me=N.auto_close,ke=N.auto_tab,we=N.languages,Ee=N.tab,$e=(N.unit[0][1],N.unit[0][0]),ze=N.unit[1][1],Le=N.unit[1][0],_e="javascript:;",Ce="px",Lt=a.ui={};a.tidy=function(e,t){var n=a.$(),i=g(n.before)?e:"",r=g(n.after)?_(t)?t:e:"";return a.trim(i,r)},a.i=function(){return g(a.replace(/\s+/g," "))},a.format=function(e,t,n,i){z(e)||(e=[e]),_(n)||(n=" "),_(i)||(i="");var r=a.h,o=a[0]().$(),f=e[0].split(h("("+ze[3]+")+"))[0],s=(e[0]?$e[0]+e[0]+$e[1]:"")+i,u=i+(e[0]?$e[0]+$e[2]+(e[1]||f)+$e[1]:""),l=p(e[0]?$e[0]+f+$e[1]:""),c=p(u),d=h("^"+l+"([\\s\\S]*?)"+c+"$"),b=h(l+"$"),y=h("^"+c),x=o.before,g=o.after;return o.length?n=!1:a.insert(we.placeholders[""]),a.toggle(t?!d.test(o.value):!b.test(x)&&!y.test(g),[function(e){e.unwrap(s,u,1).tidy(h(Le[0]+"[^"+Le[0]+Le[1]+Le[2]+"]+?"+Le[1]+"$").test(x)?"":n,h("^"+Le[0]+Le[2]+"[^"+Le[0]+Le[1]+"]+?"+Le[1]).test(g)?"":n).wrap(s,u,t)},function(e){e.unwrap(s,u,t)}])[r]()};var Qt,_t=N.classes,Ct=_t[""],Mt=we.tools,Ot=we.buttons,Dt=we.labels,Ht=Ct+"-textarea "+Ct+"-content block",Nt=zt(Ct+"-sizer s"),St=zt(Ct+"-sizer se"),Bt=zt(Ct),Yt=zt(Ct+"-header"),jt=zt(Ct+"-body"),At=zt(Ct+"-footer"),Ft=zt(Ct+"-tool"),It=ft(e,!1,N.attributes),Wt=zt(Ct+"-description"),Xt=ft(),qt=ft(),Kt=ft(),Pt=ft(),Rt=ft(),Ut=ft(),Zt=zt("left","span"),Gt=zt("right","span"),Jt=0;Lt.i=function(e,t,n){return e=Je(e).replace(/[\/\s]/g,"-"),V=Ge(_t.i,[e,t||e]),n?(rt(n),nt(n,V),n):'<i class="'+V+'"></i>'},_(N.suffix)||(N.suffix=$e[1]);var on="ui-drop-data",ln=0,re=0,oe=0,ie=0,X=0,cn=0,dn=0,pn={};a.create=function(e,t){if(a.is.create)return a;a.is.create=!0,z(e)&&(N=b(N,e));var n=gt(It);return nt(Bt,Ct+"-is-can-update"),nt(Bt,Ct+"-is-can-copy"),nt(It,Ht),n&&yt(n,"p")?(vt(n,Bt),Jt=n,Tt(n,!1)):vt(It,Bt),Bt.dir=N.direction,Et(Bt,Yt),Et(Bt,jt),Et(Bt,At),Et(jt,It),N.tools&&(Et(Yt,Ft),Et(At,Wt),Et(Wt,Zt),Et(Wt,Gt)),Pe(pe,It,un),Pe(be+" "+se,It,an),N.resize&&(Et(Bt,Nt),nt(Bt,Ct+"-is-can-resize"),Pe(he,Nt,bn),Pe(ye,u,hn),Pe(xe,D,yn)),fn(),sn(),0!==t?je("create",[a]):a},a.update=function(e,t){return a.is.create&&a.destroy(0),(0!==t?je("update",[a]):a).create(e,0)},a.destroy=function(e){return a.is.create?(a.is.create=!1,Lt.exit(0,0,0),rt(It,Ht),N.tools=Oe(N.tools),N.keys&&(Re(pe,It,un),Re(be,It,an)),N.resize&&(Re(he,Nt,bn),Re(ye,u,hn),Re(xe,u,yn)),Jt?(vt(Bt,Jt),Et(Jt,It),Jt=0):vt(Bt,It),$t(Bt),0!==e?je("destroy",[a]):a):a},a.enable=function(e){return It.disabled=It.readOnly=!1,nt(Bt,Ct+"-is-can-update"),nt(Bt,Ct+"-is-can-copy"),0!==e?je("enable",[a]):a},a.disable=function(e){return It.disabled=!0,rt(Bt,Ct+"-is-can-update"),rt(Bt,Ct+"-is-can-copy"),0!==e?je("disable",[a]):a},a.freeze=function(e){return It.disabled=!1,It.readOnly=!0,rt(Bt,Ct+"-is-can-update"),nt(Bt,Ct+"-is-can-copy"),0!==e?je("freeze",[a]):a},Lt.exit=function(e,t,n){if(I={panel:function(){$t(Xt)},overlay:function(){Re(ue,qt,xn),$t(qt)},modal:function(){Re(ue+" "+pe,pn.x,vn),Re(he,jt,mn),Re(ye,jt,kn),Re(xe,u,wn),$t(Kt)},drop:function(){Re(ue,u,Tn),Re(ve,s,Tn),$t(Pt)},bubble:function(){$t(Rt)}},an(),t)if(z(t))for(q in t)q=t[q],I[q]&&I[q](),0!==n&&je("exit."+q,[a]);else I[t]&&I[t](),0!==n&&je("exit."+q,[a]);else for(q in I)I[q]();return e&&a.select(),0!==n&&je("exit",[a]),a},Lt.panel=function(e,t,n,i){function r(e){return Re(ue+" "+pe,re,r),Lt.panel.exit(1),Ke(e)}return Lt.exit(0,0,0),R=Je(e),ee=0,i&&(R+=" "+R+"--"+Je(i)),z(t)&&!w(t)&&(ee=zt(Ct+"-panel-header "+R,0,t.header),t=t.body),te=zt(Ct+"-panel-body "+R,0,zt(Ct+"-panel-content "+R,0,T(t)?"":t)),T(t)&&t(te),re=ft("a",!1,{href:_e,"class":Ct+"-a "+Ct+"-x "+R}),re.title=Ot.close,ft(Xt,!1,{"class":Ct+"-panel "+R}),Pe(ue+" "+pe,re,r),lt(Xt,0),ee&&Et(Xt,ee),Et(jt,ft(Xt,[te,re])),T(n)?n(Xt):C(n)&&ft(Xt,n),B=[a,Xt],i&&je("enter.panel."+e+":"+i,B),je("enter.panel."+e,B),je("enter.panel",B),je("enter",B),re.focus(),a},Lt.panel.fit=function(){},Lt.overlay=function(e,t,n,i){return Lt.exit(0,0,0),R=Je(e),i&&(R+=" "+R+"--"+Je(i)),Et(jt,ft(qt,!1,{"class":Ct+"-overlay "+R})),t&&Pe(ue,qt,xn),T(n)?n(qt):C(n)&&ft(qt,n),B=[a,qt],i&&je("enter.overlay."+e+":"+i,B),je("enter.overlay."+e,B),je("enter.overlay",B),je("enter",B),a},Lt.overlay.fit=function(){},Lt.message=function(e,t,n,i,r){function f(e){return Re(ue+" "+pe,re,f),y(o),Lt.overlay.exit(1),Ke(e)}var o;return R=Je(e),r&&(R+=" "+R+"--"+Je(r)),re=ft("a",!1,{href:_e,"class":Ct+"-a "+Ct+"-x "+R}),re.title=Ot.close,ft(Ut,T(t)?t(Ut):t,{"class":Ct+"-message "+R}),Pe(ue+" "+pe,re,f),Lt.overlay("message message-"+R,0,function(e){Et(Ut,re),n&&(o=x(function(){f()},n)),Et(e,Ut)},r),T(i)?i(Ut):C(i)&&ft(Ut,i),a},Lt.modal=function(){var s,l,e=arguments,t=e[0],n=e[1],i=e[2],r=e[3],o=Ct+"-modal",f=n.footer;if(z(t)&&(t="default",n=e[0],i=e[1],r=e[2]),Lt.overlay(t,1,0,r).blur(),R=Je(t),r&&(R+=" "+R+"--"+Je(r)),ft(Kt,!1,{"class":o+" "+R}),_(n.body)&&(n.body=ft("div",n.body,{"class":o+"-content "+R})),_(f)&&z(f)&&!w(f)){l=[];for(q in f)K=f[q],w(K)?l.push(K):(K=tn(K,q,f),P=q.text||Ot[q]||q,s=ft("button",P,b({name:"y["+q+"]",type:"button","class":Ct+"-button",data:{"button-id":q}},K.attributes)),Pe(ue,s,function(e){return P=f[Xe(this,"button-id")].click(e,a),P===!1?Ke(e):void 0}),l.push(s));n.footer=l}for(q in n)o[1]=q,pn[q]=zt(o+"-"+Ge(q,o)+" "+R,0,n[q]);return pn.x=ft("a",!1,{href:_e,"class":Ct+"-a "+Ct+"-x "+R}),pn.sizer=St,lt(Kt,0),pn.x.title=Ot.close,Et(jt,ft(Kt,pn,{style:""})),Lt.modal.fit(),mt(Kt,qt),Pe(ue+" "+pe,pn.x,vn),Pe(he,pn.header,Ke),Pe(he,pn.sizer,Ke),Pe(he,jt,mn),Pe(ye,jt,kn),Pe(xe,u,wn),T(i)&&i(pn),B=[a,Kt,pn],r&&je("enter.modal."+t+":"+r,B),je("enter.modal."+t,B),je("enter.modal",B),je("enter",B),pn.x.focus(),a},Lt.modal.fit=function(e){return gn(),R=cn/2-ie/2,ee=dn/2-X/2,z(e)?(_(e[0])&&(R=e[0]),_(e[1])&&(ee=e[1])):(R=d(R,0),ee=d(ee,0)),c(Kt,{left:R+Ce,top:ee+Ce,"min-width":ie+Ce,"min-height":X+Ce,visibility:"visible"}),B=[a,Kt,pn],je("fit.modal",B),je("fit",B),a};var $n={"class":Ct+"-button",name:"y"};return Lt.alert=function(e,t,n,i,r){var o=ft("button",Ot.okay,$n),f="alert";return n=n||m,z(e)&&(f+=":"+e[0],e=e[1]||e[0]),Pe(ue,o,function(e){return n(e,a),vn(e,f+".y")}),Pe(pe,o,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)&&Ue(ue,o,[e]),Ke(e)}),Lt.modal(f,En(e,t,o),i,r),o.focus(),a},Lt.confirm=function(e,t,n,i,r,o){function c(e){return T(n)&&n(e,a),vn(e,u+".y")}function d(e){return T(i)&&i(e,a),vn(e,u+".n")}var l,f=ft("button",Ot.okay,$n),s=ft("button",Ot.cancel,$n),u="confirm";return s.name="n",Pe(ue,f,c),Pe(ue,s,d),Pe(pe,f,function(e){return l=e.TE.key,l("arrowright")?s.focus():l("enter")?c(e):l("escape")&&vn(e,u+".y"),Ke(e)}),Pe(pe,s,function(e){return l=e.TE.key,l("arrowleft")?f.focus():l("enter")?d(e):l("escape")&&vn(e,u+".n"),Ke(e)}),Lt.modal(u,En(e,t,[f,s]),r,o),s.focus(),a},Lt.prompt=function(e,t,n,i,r,o,f){function y(){l.focus(),"placeholder"in l&&l.select()}function x(e){return p=l.value,T(n)&&!n(p)?y():!n||g(p)&&p!==t?(vn(e,c+".y"),i(e,a,p!==t?p:"",t)):y(),Ke(e)}function v(e){return vn(e,c+".n")}var p,b,h,s=ft("button",Ot.okay,$n),u=ft("button",Ot.cancel,$n),l=ft("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Ct+"-input block"}),c="prompt",d=[];if(r=r||0,1===r)l=ft("textarea",t,{placeholder:t.split("\n")[0],"class":Ct+"-textarea block",spellcheck:"false"});else if(2===r){for(q in t)d.push(ft("option",t[q],{value:q,selected:q===n||null}));l=ft("select",d,{"class":Ct+"-select block"})}return i=i||m,l.name="data",u.name="n",Pe(pe,l,function(e){return b=e.TE.key,h=e.TE.control,b("enter")&&0===r||h("enter")?x(e):b("escape")||b("backspace")&&!this.value?v(e):b("arrowdown")&&0===r||b("enter")&&2===r||h("arrowdown")?(s.focus(),Ke(e)):void 0}),Pe(pe,s,function(e){return b=e.TE.key,b("enter")?x(e):b("escape")?v(e):b("arrowup")?l.focus():b("arrowright")&&u.focus(),Ke(e)}),Pe(pe,u,function(e){return b=e.TE.key,b(/^(enter|escape)$/)?v(e):b("arrowup")?l.focus():b("arrowleft")&&s.focus(),Ke(e)}),Pe(ue,s,x),Pe(ue,u,v),Lt.modal(c,En(e,l,[s,u]),o,f),y(),a},Lt.drop=function(){Lt.exit(0,0,0);var e=arguments,t=e[0],n=e[1],i=e[2];return 1===He(e)&&(t="default",n=e[0],i=e[1]),R=Je(t),lt(Pt,0),Et(D,ft(Pt,!1,{"class":Ct+"-drop "+R})),T(n)?n(Pt):ft(Pt,n),Lt.drop.fit(),i===!1||(Pe(ue,u,Tn),Pe(ve,s,Tn)),B=[a,Pt],je("enter.drop."+t,B),je("enter.drop",B),a},Lt.drop.fit=function(e){return B=et(M),Y=et(Pt),j=Lt.drop.target,R=B.w/2-Y.w/2,ee=B.h/2-Y.h/2,!_(e)&&j&&(t=Ve(j),R=t.l,ee=t.t+et(j).h),z(e)?(_(e[0])&&(R=e[0]),_(e[1])&&(ee=e[1])):(R=d(R,0,B.w-Y.w),ee=d(ee,0,Math.max(B.h,et(s).h)-Y.h)),c(Pt,{left:R+Ce,top:ee+Ce,visibility:"visible"}),B=[a,Pt],je("fit.drop",B),je("fit",B),a},Lt.menu=function(e,n,i,r){var s,o=Lt.tools,f=0;if(n===!1)return Lt.tool(e,n);for(r in i)ie="%"===r[0],s=i[r],s=C(s)&&!ie?o[s]:s,s&&(s=tn(s,r,o),i[r]=s);return Lt.tool(e,{i:z(n)?n[0]:0,text:z(n)?n[1]||0:n&&i[n]&&i[n].text||n,click:function(u){var l=Lt.drop.target=o[e].target;return Lt.drop("menu menu-"+Je(e),function(u){function c(f){return ee=this,t=Xe(ee,"tool-id"),U=i[t],U=C(U)?o[U]:U||{},Z=at(ee),!en(U)&&T(r=U.click)&&(r=r(f,a),U.i&&(o[e].i=U.i),Lt.menu.set(e,z(U.text)?[U.text[0],t]:z(n)?[n[0],t]:t),r===!1)?(a.select(),Ke(f)):(a.select(),Ke(f))}function d(e){if(ee=this,(P=e.TE.key)("escape"))Lt.exit(1);else if(P("enter"))Ue(ue,ee,[e]);else if(P("f10")&&l)l.focus();else if(P("arrowdown")&&(R=pt(ee))){for(;!yt(R,"a")&&R;)R=pt(R);R&&R.focus()}else if(P("arrowup")&&(R=bt(ee))){for(;!yt(R,"a")&&R;)R=bt(R);!R&&l?(Lt.exit(),l.focus()):R&&R.focus()}else P("arrowup")&&l&&(Lt.exit(),l.focus());return Ke(e)}for(r in i)if(s=i[r],ie="%"===r[0],s){var p={href:ie?null:_e,"class":Ct+"-"+(ie?"label":"button")};ie?K=Dt[e]&&Dt[e][+r.slice(1)-1]||r:(p.data={},p.data["tool-id"]=r,K=Mt[r]||r),Q=s.text,Q=z(Q)?Q[1]||"":Q,K=z(K)?K[0]:K,V=ft(ie?"span":"a","<span>"+(ie?K||"%"+f:Q||K)+"</span>",b(p,s.attributes||{})),nt(V,"menu-"+Je(r).replace(/[\/\s]/g,"-")),!p.title&&(ee=s.title)&&(V.title=z(ee)?ee[0]+(ee[1]?" ("+ee[1]+")":""):ee),ie?Ae(V,{id:Ct+"-label:"+f}):(en(s)?nt(V,"x"):rt(V,"x"),s.on?nt(V,"on"):rt(V,"on"),Pe(ue,V,c),Pe(pe,V,d)),Et(u,V),++f}x(function(){(xt('[data-tool-id="'+Xe(l,on)+'"]',u)[0]||xt("a",u)[0]).focus()},1)}),!1}},r),We(o[e].target,{"ui-drop":e}),o[e].data=i,Lt.menu.set(e,n)},Lt.menu.set=function(e,t){var o,f,n=Lt.tools[e]||{},i=n.target,r=n.data;return i?(z(t)?We(i,on,t[1]||""):(We(i,on,t),t=r[t]&&r[t].text||t),z(t)?(f=t[0],f=De(f,"<")?f:Lt.i(f,n.i),t=_(t[1])?t[1]:0,t=t&&r[t]&&r[t].text||t,t=f+(0!==t?"<span>"+(z(t)?t[1]||t:t)+"</span>":"")):f=Lt.i(e,n.i),(o=xt("."+Ct+"-text",i)[0])?(nt(i,"text"),ut(o,t)):(rt(i,"text"),ut(i,f)),a):a},Lt.bubble=function(){Lt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===He(e)&&(t="default",n=e[0]),R=Je(t),lt(Rt,0),Et(D,ft(Rt,!1,{"class":Ct+"-bubble "+R})),T(n)?n(Rt):ft(Rt,n),Lt.bubble.fit(),B=[a,Rt],je("enter.bubble."+t,B),je("enter.bubble",B),a},Lt.bubble.fit=function(e){V=a.$(1),t=Ve(It),X=c(It,"line-height");var n="border-",i="-width";R=V.caret[0].x+t.l-It.scrollLeft,ee=V.caret[1].y+t.t+X-It.scrollTop,Y=c(jt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var r=et(jt),o=et(Rt),f=Y[0]+Y[1],s=Y[2]+Y[3];return z(e)?(_(e[0])&&(R=e[0]),_(e[1])&&(ee=e[1])):(R=d(R,t.l,t.l+r.w-o.w-s),ee=d(ee,t.t,t.t+r.h-o.h-f)),c(Rt,{left:R+Ce,top:ee+Ce,visibility:"visible"}),B=[a,Rt],je("fit.bubble",B),je("fit",B),a},Lt.panel.exit=function(e){return Lt.exit(e,"panel")},Lt.overlay.exit=function(e){return Lt.exit(e,"overlay")},Lt.modal.exit=function(e){return Lt.exit(e,"modal")},Lt.drop.exit=function(e){return Lt.exit(e,"drop")},Lt.bubble.exit=function(e){return Lt.exit(e,"bubble")},Lt.tool=function(e,t,n){var i=Lt.tools;return K="",P=_(i[e])?"update":"create","|"!==e&&(N.tools=Me(N.tools).filter(function(t,n){return t===e?(K=n,!1):!0})),t===!1?(delete i[e],P="destroy"):("|"===e?(n=t,t={}):(T(t)&&(t={click:t}),i[e]=b(i[e]||{},t),_(n)||""===K||(n=K)),$(n)?N.tools.splice(n,0,e):N.tools.push(e)),je(P+".tool."+e,[a,i[e]]),fn(),a},Lt.separator=function(e,t){return Lt.tool("|",e!==!1?{attributes:e||{}}:!1,t)},Lt.key=function(e,t){var n=Lt.keys;return P=_(n[e])?"update":"create",t===!1?(delete n[e],P="destroy"):n[e]=t,je(P+".key."+e,[a,n[e]]),sn(),a},Lt.key.set=function(e){S[e]=1},Lt.key.reset=function(e){e?delete S[e]:S={}},Lt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Ee),!1},outdent:function(e,t){return t.outdent(Ee),!1}},Lt.keys={"control+y":"redo","control+z":"undo",escape:function(e,t){return Q=":not([tabindex]):not([disabled])",(V=xt("input"+Q+",button"+Q+",select"+Q+",textarea"+Q+",a[href]"+Q+",[contenteditable]"+Q+',[tabindex]:not([tabindex="-1"])',u,0))&&-1!==(ee=V.indexOf(It))?((V[ee+1]||u).focus(),!1):void 0},f10:function(e,t){return xt("a",Ft)[0].focus(),!1},tab:ke?"indent":0,"shift+tab":ke?"outdent":0},Lt.el={container:Bt,header:Yt,body:jt,footer:At,panel:Xt,overlay:qt,modal:Kt,drop:Pt,bubble:Rt},a.config=N,b(TE._,{time:function(e){var t=new Date(_(e)?e:Date.now()),n=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=t.getHours(),f=t.getMinutes(),s=t.getSeconds(),u=t.getMilliseconds();return 10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>s&&(s="0"+s),10>u&&(u="0"+u),[""+n,""+i,""+r,""+o,""+f,""+s,""+u]},replace:Ze,format:Ge,dom:{set:Et,reset:Tt,get:xt,id:st,copy:function(e,t){return e.cloneNode(_(t)?t:!0)},classes:{set:nt,reset:rt,toggle:ot,get:it},attributes:{set:Ae,reset:Ie,get:Fe},data:{set:We,reset:qe,get:Xe},is:yt,offset:Ve,pointer:Qe,size:et,content:{set:ut,reset:lt,get:at},closest:tt,parent:ct,children:dt,next:pt,previous:bt,index:ht,before:vt,after:mt,prepend:kt,append:wt},el:ft,event:{set:Pe,reset:Re,fire:Ue,x:Ke}}),b(a._,TE._),b(a._,{hooks:v,hook:{set:Be,reset:Ye,fire:je}}),a.create()};