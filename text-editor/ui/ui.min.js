/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Le(e){return k(e)?b(e).split(/\s+/):e}function ze(e){return x(e)?e.join(" "):e}function Ce(e,t,n){return E(e)?E(t)?(E(z[e])||(z[e]={}),E(n)||(n=Object.keys(z[e]).length),z[e][n]=t,l):z[e]:z}function Oe(e,t){return E(e)?E(t)&&E(z[e])?(delete z[e][t],l):(z[e]={},l):(z={},l)}function Se(e,t,n){if(!E(z[e]))return z[e]={},l;if(E(n))E(z[e][n])&&z[e][n].apply(l,t);else for(var r in z[e])z[e][r].apply(l,t);return l}function Me(e,t,n){if(x(t))for(P in t)Me(e,P,t[P]);else e.setAttribute(t,n)}function je(t,n,r){if(k(n))return je(t,[n],E(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=t.getAttribute(P))&&e.push(P);return e.length?e:E(r)?r:[]}function De(e,t){if(x(t))for(P in t)De(e,t[P]);else if(E(t))e.removeAttribute(t);else for(De(e,"class"),P=0,I=e.attributes,A=I.length;A>P;++P)I[P]&&De(e,I[P].name)}function Ye(e,t,n){if(x(t))for(P in t)Ye(e,P,t[P]);else Me(e,"data-"+t,n)}function Ne(t,n,r){if(k(n))return Ne(t,[n],E(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=je(t,"data-"+P))&&e.push(P);return e.length?e:E(r)?r:[]}function Be(e,t){if(x(t))for(P in t)De(e,"data-"+t[P]);else if(E(t))De(e,"data-"+t);else for(P=0,I=e.attributes,A=I.length;A>P;++P)I[P]&&"data-"===I[P].name.slice(0,5)&&De(e,I[P].name)}function He(e){return e&&e.preventDefault(),!1}function Pe(e,t,n){if(t){for(e=Le(e),P=0,I=e.length;I>P;++P)t.addEventListener(e[P],n,!1),Ce("on:"+e[P],n,tt(t));return l}}function Ie(e,t,n){if(t){for(e=Le(e),P=0,I=e.length;I>P;++P)t.removeEventListener(e[P],n,!1),Oe("on:"+e[P],tt(t));return g(t)&&t.id.split(":")[0]===kt+"-dom"&&De(t,"id"),l}}function Ae(e,t,n){e=Le(e);var i,r="createEvent"in u;for(P=0,I=e.length;I>P;++P)r?(i=u.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[P],!0,!1),t.dispatchEvent(i)):Se("on:"+e[P],n,tt(t));return l}function Fe(e,t){return setTimeout(e,t)}function We(e){return clearTimeout(e)}function Re(e,t,n){for(P=0,I=t.length,A;I>P;++P)A=t[P],e=e.replace(w(A)?A:h(a(A),"g"),n&&n[P]||"");return e}function Ue(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,E(t[n])?t[n]:e})}function Xe(e){return b(Re(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function qe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=Ke(e);return{x:n-i.l,y:r-i.t}}function Ke(e){for(F=e.offsetLeft,Z=e.offsetTop;e=e.offsetParent;)F+=e.offsetLeft,Z+=e.offsetTop;return{l:F,t:Z}}function Ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Ge(e,t){for(;(e=ot(e))&&e!==t;);return e}function Je(e,t){t=Le(t);for(P in t)e.classList.add(t[P])}function Qe(t,n,r){if(k(n))return Qe(t,[n],E(r)?r:"")[0];e=[];for(P in n)P=n[P],t.classList.contains(P)&&e.push(P);return e.length?e:E(r)?r:!1}function Ve(e,t){if(E(t)){t=Le(t);for(P in t)e.classList.remove(t[P])}else De(e,"class")}function et(e,t,n){if(e=k(e)?u.createElement(e):e,x(n))for(P in n)if(J=n[P],"classes"===P)Je(e,J);else if("data"===P)for(I in J)J=J[I],null===J?Be(e,I):Ye(e,I,J);else"css"===P?k(J)?Me(e,"style",J):null===J?De(e,"style"):d(e,J):y(J)?e[P]=J:null===J?De(e,P):Me(e,P,x(J)?J.join(" "):""+J);if(g(t))bt(e,t);else if(x(t))for(P in t)J=t[P],g(J)?bt(e,J):J!==!1&&nt(e,J);else E(t)&&t!==!1&&nt(e,t);return e}function tt(e){var t=e.id;return t||(t=kt+"-dom:"+Date.now(),e.id=t),t}function nt(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(E(t)?t:"")}function it(e,t){if(t!==!1&&(j=ft(e)))for(P=0,I=j.length;I>P;++P)it(j[P]);nt(e,"")}function ot(e){return e.parentElement||e.parentNode}function ft(e){return e.children||[]}function ut(e){return e.nextElementSibling||e.nextSibling}function lt(e){return e.previousElementSibling||e.previousSibling}function st(t,n){if(n=n||u,e=[],k(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(P=0,I=t.length;I>P;++P)e.push(t[P]);return e}return[]}for(t=n.querySelectorAll(t),P=0,I=t.length;I>P;++P)e.push(t[P]);return e}return at(t)?[t]:[]}function at(e,t){var n=ot(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){ot(e).insertBefore(t,e)}function dt(e,t){ot(e).insertBefore(t,ut(e))}function pt(e,t){j=ft(e)[0],j?ct(j,t):bt(e,t)}function ht(e,t){bt(e,t)}function bt(e,t){e.appendChild(t)}function vt(e,t){var n=at(e);if(n){if(t!==!1)for(j=ft(e)[0];j;)vt(j);n.removeChild(e)}}function gt(e){it(et(e,!1,{style:""})),vt(e)}function yt(e,t,n){return et(t||"div",n,{"class":e})}function Xt(){$t._word&&$t._words&&(J=(Mt.value||"").replace(h(ke[0]+"[^"+ke[0]+ke[1]+"]+?"+ke[1],"g"),""),P=(J.match(/(\w+)/g)||[]).length,nt(It,Ue($t["_word"+(1===P?"":"s")],[P])))}function qt(e,t){y(e)&&(e.click=e),k(e.click)&&(e.click=(mt.tools[e.click]||{}).click),E(e.active)||(e.active=1),E(e.title)||(e.title=Et[t]||"")}function Kt(){it(St,!1);var r,i,o,f,u,e=Le(O.tools),t=kt+"-button",n=kt+"-separator";O.tools=e;for(P in e)u=e[P],i=mt.tools[u],i&&(qt(i,u),o=i.i||u,"|"!==o&&"<"!==o[0]&&(o=Xe(o)),f="|"!==o,Rt=yt(f?t:n,f?"a":"span"),f&&(r=t+":"+Xe(u).replace(/\s/g,""),Me(Rt,{href:$e,id:r,"tab-index":-1}),Ye(Rt,Te,u),o="<"===o[0]?o:'<i class="'+Ue(wt,[o])+" "+r+'"></i>',i.active||Je(Rt,"x"),i.text&&(o=Ue('<span class="'+kt+'-text">'+i.text+"</span>",[o]),Je(Rt,"text")),nt(Rt,o),et(Rt,!1,i.attributes||{}),!Rt.title&&(I=i.title)&&(Rt.title=x(I)?I[0]+(I[1]?" ("+I[1]+")":""):I),Pe(ae,Rt,nn)),bt(St,Rt));Se("update.tools",[l])}function Zt(){mt.keys=function(){var n,e=Object.keys(mt.keys).sort().reverse(),t={};for(P=0,I=e.length;I>P;++P)n=e[P],t[n]=mt.keys[n];return t}(),en(1),Se("update.keys",[l])}function Gt(e){Xt(),Se("on:change",[e,l])}function Vt(t){function p(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),r=n.before,i=n.after,o=r.slice(-1),f=i[0],u=n.length,s=mt.keys,c=TE.keys_alias,d=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();R=t.TE.key(),Jt[R]=1,e=Object.keys(Jt).length,Fe(function(){l.record()},1);for(P in s){A=p(P),j=0;for(I in A)I=A[I],Jt[c[I]||I]&&++j;if(A=A.length,j===A&&e===A&&(k(s[P])&&(s[P]=mt.tools[s[P]].click),F=s[P]&&s[P](t,l),F===!1))return He(t)}if(me)for(P in me)if(W=me[P],W!==!1){if(R===W&&f===W)return"\\"===o?(l.insert(R,0),He(t)):(l.select(n.end+1),He(t));if(P===R)return l.wrap(P,W),He(t);if(o===P&&f===W){if("backspace"===R&&r.slice(-2)!=="\\"+P)return l.unwrap(P,W),He(t);if(ye&&"enter"===R&&P!==W)return l.tidy("\n"+d+ge,"\n"+d).scroll(!0),He(t)}}if(ye&&!u){if("backspace"===R&&h(a(ge)+"$").test(r))return l.outdent(ge).scroll(!0),He(t);if("enter"===R&&h("(^|\\n)("+a(ge)+")+.*$").test(r))return l.insert("\n"+d,0,1).scroll(!0),He(t)}}function en(e){x(e)?delete Jt[e.TE.key()]:Jt={}}function tn(e){/^focus|blur$/.test(e.type)&&en(1),We(Qt),Qt=Fe(function(){Gt(e)},O.debounce||0)}function nn(e){mt.exit(0,0,0);var t=Ne(this,Te),n=mt.tools,r=n[t];return Wt=e.currentTarget||e.target,r&&r.active&&r.click&&(I=n[t].click(e,l,t),Se("on:change",[e,l,t]),I===!1)?He(e):(l.select(),He(e))}function ln(e){return rn=jt,K=Ze(Ot),He(e)}function sn(e){rn===jt&&d(Mt,{height:qe(Ct,e).y-K.h+_e})}function an(){rn=0}function cn(){mt.exit(1)}function dn(){e=Ze(Nt),Q=e.w,H=e.h,e=Ze(Yt),on=e.w,fn=e.h}function pn(e,t){t&&Se("exit.modal."+t,[l]),Ae(ae,Yt,[e])}function hn(t){rn=t.target,e=qe(Nt,t),V=e.x,ee=e.y,dn()}function bn(t){var n=un.header,r=un.resize;rn===n||Ge(rn,n)===n?(e=qe(Ct,t),F=e.x-V,Z=e.y-ee,d(Nt,{left:(Q>on?F:p(F,0,on-Q))+_e,top:(H>fn?Z:p(Z,0,fn-H))+_e})):rn===r&&(e=qe(Nt,t),K=Ze(r),d(Nt,{width:e.x+K.w/4+_e,height:e.y+K.h/4+_e}))}function vn(){rn=0}function gn(e,t,n){return{header:e,body:t,footer:n}}function yn(e){S=Wt,M=Bt,j=e&&e.target||0,(!j||j!==S&&Ge(j,S)!==S)&&(Wt=0,gt(Bt),Ie(ae,_,yn),mt.exit(e.target===L))}function xn(t){function n(){e&&(U=Ze(e),d(q,{width:U.w+_e,height:U.h+_e}))}return J=l.get(),Q="",-1===J.indexOf("</html>")&&(Q='<!DOCTYPE html><html dir="'+O.dir+'"><head><meta charset="utf-8"><style>'+O.css+"</style></head><body>"+J+"</body></html>"),q=et("iframe",!1,{"class":kt+"-portal",src:"data:text/html,"+encodeURIComponent(Q)}),!at(Yt)&&J?mt.overlay(q,1,function(){e=ft(Yt)[0],n(),Pe(he,f,n),Se("enter.overlay.preview",[t,l,[J,Q],e])}):(Ie(he,f,n),cn()),He(t)}var S,M,j,N,H,P,I,A,F,W,R,e,U,q,K,Z,J,Q,V,ee,t="⌘",n="…",i="⇥",o="⇧",f=window,u=document,l=this,s=l._,a=s.x,c=s.extend,d=s.css,p=s.edge,h=s.pattern,b=s.trim,v=l.is,g=v.e,y=v.f,m=v.i,x=v.o,w=v.r,k=v.s,E=function(e){return!v.x(e)},T=u.documentElement,_=(u.head,u.body),L=l.target,z={},C=function(){},O=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),ne="keydown",re="keyup",ie="copy",oe="cut",fe="paste",ue="touchstart mousedown",le="touchend mouseup",se="touchmove mousemove",ae="click",ce="focus",de="blur",pe="input",he="orientationchange resize",be=de+" "+ie+" "+oe+" "+ce+" "+pe+" "+ne+" "+fe,ve=O.languages,ge=O.tab,ye=O.auto_tab,me=O.auto_close,xe=O.unit[0][0],ke=(O.unit[0][1],O.unit[1][0]),Ee=O.unit[1][1],Te="tool-id",$e="javascript:;",_e="px",mt=l.ui={};l.tidy=function(e,t){var n=l.$(),r=b(n.before)?e:"",i=b(n.after)?E(t)?t:e:"";return l.trim(r,i)},l.i=function(){return b(l.replace(/\s+/g," "))},l.format=function(e,t,n,r){x(e)||(e=[e]),E(n)||(n=" "),E(r)||(r="");var i=l[0]().$(),o=(e[0]?xe[0]+e[0]+xe[1]:"")+r,f=r+(e[0]?xe[0]+xe[2]+(e[1]||e[0].split(h("("+Ee[3]+")+"))[0])+xe[1]:""),u=a(o),s=a(f),c=h("^"+u+"([\\s\\S]*?)"+s+"$"),d=h(u+"$"),p=h("^"+s),b=i.before,v=i.after;return i.length?n=!1:l.insert(ve.placeholders[""]),l.toggle(t?!c.test(i.value):!d.test(b)&&!p.test(v),[function(e){e.unwrap(o,f,1).tidy(h(ke[0]+"[^"+ke[0]+ke[1]+ke[2]+"]+?"+ke[1]+"$").test(b)?"":n,h("^"+ke[0]+ke[2]+"[^"+ke[0]+ke[1]+"]+?"+ke[1]).test(v)?"":n).wrap(o,f,t)[1]()},function(e){e.unwrap(o,f,t)[1]()}])};var Rt,xt=O.classes,wt=xt.i,kt=xt[""],Et=ve.tools,Tt=ve.buttons,$t=ve.others,_t=kt+"-textarea "+kt+"-content block",Lt=yt(kt),zt=yt(kt+"-header"),Ct=yt(kt+"-body"),Ot=yt(kt+"-footer"),St=yt(kt+"-tool"),Mt=et(L,!1,O.attributes),jt=yt(kt+"-resize s"),Dt=yt(kt+"-description"),Yt=yt(kt+"-overlay"),Nt=et("div"),Bt=et("div"),Ht=et("div"),Pt=yt("left","span"),It=yt("right","span"),At=yt(kt+"-preview","a"),Ft=0,Wt=0;O.suffix||(O.suffix=xe[1]);var Jt={},Qt=null;l.create=function(e,t){x(e)&&(O=c(O,e));var n=at(Mt);return Je(Mt,_t),n&&"P"===n.nodeName?(ct(n,Lt),Ft=n,vt(n,!1)):ct(Mt,Lt),Lt.dir=O.dir,bt(Lt,zt),bt(Lt,Ct),bt(Lt,Ot),bt(Lt,jt),bt(Ct,Mt),O.tools&&(bt(zt,St),bt(Ot,Dt),bt(Dt,Pt),bt(Dt,It)),Pe(ne,Mt,Vt),Pe(re,Mt,en),Pe(be,Mt,tn),Pe(ue,jt,ln),Pe(se,_,sn),Pe(le,_,an),$t.preview&&(K=Et.preview,Me(At,{href:$e,title:x(K)?K[0]+(K[1]?" ("+K[1]+")":""):K}),bt(Pt,At),nt(At,$t.preview)),Gt(null),Kt(),Zt(),0!==t?Se("create",[l]):l},l.update=function(e,t){return Qe(Mt,Le(_t),0)&&l.destroy(0),(0!==t?Se("update",[l]):l).create(e,0)},l.destroy=function(e){return Qe(Mt,Le(_t),0)?(mt.exit(0,0,0),Ve(Mt,_t),O.tools=ze(O.tools),O.keys&&(Ie(ne,Mt,Vt),Ie(re,Mt,en)),Ie(ue,jt,ln),Ie(se,_,sn),Ie(le,_,an),Ie(be,Mt,tn),Ft?(ct(Lt,Ft),bt(Ft,Mt),Ft=0):ct(Lt,Mt),gt(Lt),0!==e?Se("destroy",[l]):l):l};var rn=0,V=0,ee=0,Q=0,H=0,on=0,fn=0,un={};mt.exit=function(e,t,n){if(N={overlay:function(){Ie(ae,Yt,cn),gt(Yt)},modal:function(){Ie(ue,Ct,hn),Ie(se,Ct,bn),Ie(le,_,vn),Ie(ae,un.x,pn),gt(Nt)},drop:function(){gt(Bt)},bubble:function(){gt(Ht)}},t)if(x(t))for(P in t)P=t[P],N[P]&&N[P](),0!==n&&Se("exit."+P,[l]);else N[t]&&N[t](),0!==n&&Se("exit."+P,[l]);else for(P in N)N[P]();return e&&l.select(),0!==n&&Se("exit",[l]),l},mt.overlay=function(e,t,n){return mt.exit(0,0,0),en(1),bt(Ct,et(Yt,e.length||g(e)?yt(kt+"-overlay-content","div",e):"")),t&&Pe(ae,Yt,cn),y(n)?n(Yt):et(Yt,n),Se("enter.overlay",[l]),Se("enter",[l]),l},mt.overlay.fit=function(){},mt.modal=function(){mt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=kt+"-modal";x(t)&&(t="default",n=e[0],r=e[1]),F=Xe(t),et(Nt,!1,{"class":i+" "+F}),E(n.body)&&(n.body=et("div",n.body,{"class":i+"-content "+F}));for(P in n)i[1]=P,un[P]=yt(i+"-"+Ue(P,i)+" "+F,0,n[P]);return un.x=yt(kt+"-x "+F),un.resize=yt(kt+"-resize se "+F),it(Nt),bt(Ct,et(Nt,un,{style:""})),mt.modal.fit(),dt(Nt,Yt),Pe(ae,un.x,pn),Pe(ue,un.header,He),Pe(ue,un.resize,He),Pe(ue,Ct,hn),Pe(se,Ct,bn),Pe(le,_,vn),y(r)&&(un.overlay=Yt,un.modal=Nt,r(un)),Se("enter.modal."+t,[l]),Se("enter.modal",[l]),Se("enter",[l]),l},mt.modal.fit=function(e){return dn(),F=on/2-Q/2,Z=fn/2-H/2,x(e)?(F=e[0],Z=e[1]):(F=p(F,0),Z=p(Z,0)),d(Nt,{left:F+_e,top:Z+_e,"min-width":Q+_e,"min-height":H+_e,visibility:"visible"}),Se("fit.modal",[l]),Se("fit",[l]),l};var mn={"class":kt+"-button",name:"y"};return mt.alert=function(e,t,n,r){var i=et("button",Tt.okay,mn),o="alert";return n=n||C,x(e)&&(o+=":"+e[0],e=e[1]||e[0]),Pe(ae,i,function(e){return n(e,l),pn(e,o+".y"),He(e)}),Pe(ne,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?Ae(ae,i,[e]):void 0}),mt.modal(o,gn(e,t,i),r),i.focus(),l},mt.confirm=function(e,t,n,r,i){function a(e){return y(n)&&n(e,l),pn(e,u+".y"),He(e)}function c(e){return y(r)&&r(e,l),pn(e,u+".n"),He(e)}var s,o=et("button",Tt.okay,mn),f=et("button",Tt.cancel,mn),u="confirm";return f.name="n",x(e)&&(u+=":"+e[0],e=e[1]||e[0]),Pe(ae,o,a),Pe(ae,f,c),Pe(ne,o,function(e){return s=e.TE.key,s("arrowright")?(f.focus(),He(e)):s("arrowleft")?He(e):s("enter")?(a(e),He(e)):s("escape")?(pn(e,u+".y"),He(e)):void 0}),Pe(ne,f,function(e){return s=e.TE.key,s("arrowright")?He(e):s("arrowleft")?(o.focus(),He(e)):s("enter")?(c(e),He(e)):s("escape")?(pn(e,u+".n"),He(e)):void 0}),mt.modal(u,gn(e,t,[o,f]),i),f.focus(),l},mt.prompt=function(e,t,n,r,i,o){function p(){s.focus(),"placeholder"in s&&s.select()}function h(e){return He(e)}function v(e){return K=s.value,!n||b(K)&&K!==t?(pn(e,a+".y"),He(e),r(e,l,K!==t?K:"",t)):(p(),h(e))}function g(e){return pn(e,a+".n"),He(e)}var d,f=et("button",Tt.okay,mn),u=et("button",Tt.cancel,mn),s=et("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":kt+"-input block"}),a="prompt",c=[];if(x(e)&&(a+=":"+e[0],e=e[1]||e[0]),y(i)&&(o=i,i=0),1===i)s=et("textarea",t,{placeholder:t.split("\n")[0],"class":kt+"-textarea block"});else if(2===i){for(P in t)c.push(et("option",t[P],{value:P,selected:P===n||null}));s=et("select",c,{"class":kt+"-select block"})}return r=r||C,s.name="data",u.name="n",Pe(ne,s,function(e){return d=e.TE.key,d("enter")?v(e):d("escape")||d("backspace")&&!this.value?g(e):d("arrowup")?h(e):d("arrowdown")?(f.focus(),He(e)):void 0}),Pe(ne,f,function(e){return d=e.TE.key,d("enter")?v(e):d("escape")?g(e):d("arrowup")?(s.focus(),He(e)):d("arrowright")?(u.focus(),He(e)):d(/^arrow(down|left)$/)?h(e):void 0}),Pe(ne,u,function(e){return d=e.TE.key,d(/^enter|escape$/)?g(e):d("arrowup")?(s.focus(),He(e)):d(/^arrow(right|down)$/)?h(e):d("arrowleft")?(f.focus(),He(e)):void 0}),Pe(ae,f,v),Pe(ae,u,g),mt.modal(a,gn(e,s,[f,u]),o),p(),l},mt.drop=function(){mt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),F=Xe(t),it(Bt),bt(_,et(Bt,!1,{"class":kt+"-drop "+F})),y(n)?n(Bt):et(Bt,n),mt.drop.fit(),Pe(ae,_,yn),Se("enter.drop."+t,[l]),Se("enter.drop",[l]),l},mt.drop.fit=function(t){return S=Ze(T),M=Ze(Bt),F=S.w/2-M.w/2,Z=S.h/2-M.h/2,!E(t)&&Wt&&(e=Ke(Wt),F=e.l,Z=e.t+Ze(Wt).h),x(t)?(F=t[0],Z=t[1]):(F=p(F,0,S.w-M.w),Z=p(Z,0,S.h-M.h)),d(Bt,{left:F+_e,top:Z+_e,visibility:"visible"}),Se("fit.drop",[l]),Se("fit",[l]),l},mt.menu=function(e,t,n,r){t=!x(t)&&n[t]&&n[t].text||t;var u,i='<span class="'+kt+'-current menu">%1</span>',o="",f={href:$e,"class":kt+"-button",data:{}};return t===!1?mt.tool(e,t):(x(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+Ue(wt,[o])+'"></i>',t=E(t[1])?t[1]:!1,t=t&&n[t]&&n[t].text||t,i=o+(t!==!1?" "+i:"")),mt.tool(e,{i:o,text:Ue(i,[t,o]),click:function(s){return mt.drop("menu menu-"+Xe(e),function(e){function s(e){return u=this,W=n[Ne(u,Te)],H=rt(u),W&&W.active&&y(r=W.click)&&(r=r(e,l),t!==!1&&Wt&&(K=ft(Wt)[0]||Wt,nt(K,Ue(i,[H,o])),x(W.text)&&(Z=ft(K)[0])&&"I"===Z.nodeName&&(Ve(Z),Je(Z,Ue(wt,[W.text[0]])))),r===!1)?He(e):(l.select(),He(e))}for(r in n)u=n[r],u=k(u)?mt.tools[u]:u,u&&(qt(u,r),f.data[Te]=r,q=u.text,q=x(q)?q[1]||"":q,K=et("a",u.text||r,c(f,u.attributes||{})),!K.title&&(Z=u.title)&&(K.title=x(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z),u.active||Je(K,"x"),n[r]=u,Pe(ae,K,s),bt(e,K))}),!1}},r),l)},mt.bubble=function(){mt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),F=Xe(t),it(Ht),bt(_,et(Ht,!1,{"class":kt+"-bubble "+F})),y(n)?n(Ht):et(Ht,n),mt.bubble.fit(),Se("enter.bubble."+t,[l]),Se("enter.bubble",[l]),l},mt.bubble.fit=function(t){K=l.$(1),e=Ke(Mt),H=d(Mt,"line-height");var n="border-",r="-width";F=K.caret[0].x+e.l-Mt.scrollLeft,Z=K.caret[1].y+e.t+H-Mt.scrollTop,M=d(Ct,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Ze(Ct),o=Ze(Ht),f=M[0]+M[1],u=M[2]+M[3];return x(t)?(F=t[0],Z=t[1]):(F=p(F,e.l,e.l+i.w-o.w-u),Z=p(Z,e.t,e.t+i.h-o.h-f)),d(Ht,{left:F+_e,top:Z+_e,visibility:"visible"}),Se("fit.bubble",[l]),Se("fit",[l]),l},mt.overlay.exit=function(e){return mt.exit(e,"overlay")},mt.modal.exit=function(e){return mt.exit(e,"modal")},mt.drop.exit=function(e){return mt.exit(e,"drop")},mt.bubble.exit=function(e){return mt.exit(e,"bubble")},mt.tool=function(e,t,n){return I="","|"!==e&&(O.tools=O.tools.filter(function(t,n){return t===e?(I=n,!1):!0})),t===!1?delete mt.tools[e]:("|"===e?(n=t,t={}):(y(t)&&(t={click:t}),mt.tools[e]=c(mt.tools[e]||{},t),E(n)||""===I||(n=I)),m(n)?O.tools.splice(n,0,e):O.tools.push(e)),Kt(),l},mt.key=function(e,t){return O.keys?(t===!1?delete mt.keys[e]:mt.keys[e]=t,Zt(),l):l},mt.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ge),!1},outdent:function(e,t){return t.outdent(ge),!1}},Pe(ae,At,xn),mt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return xn(e)},"shift+tab":ye?"outdent":0,tab:ye?"indent":0,escape:function(e,t){return At.focus(),!1}},mt.el={container:Lt,header:zt,body:Ct,footer:Ot,overlay:Yt,modal:Nt,drop:Bt,bubble:Ht},l.config=O,c(l._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),u=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>f&&(f="0"+f),10>u&&(u="0"+u),[""+t,""+n,""+r,""+i,""+o,""+f,""+u]},replace:Re,format:Ue,dom:{set:bt,reset:vt,get:st,id:tt,classes:{set:Je,reset:Ve,get:Qe},attributes:{set:Me,reset:De,get:je},data:{set:Ye,reset:Be,get:Ne},offset:Ke,point:qe,size:Ze,content:{set:nt,reset:it,get:rt},closest:Ge,parent:ot,children:ft,next:ut,previous:lt,before:ct,after:dt,prepend:pt,append:ht},el:et,event:{set:Pe,reset:Ie,fire:Ae,x:He},hooks:z,hook:{set:Ce,reset:Oe,fire:Se}}),mt};