/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Le(e){return T(e)?h(e).split(/\s+/):e}function Ie(e){return E(e)?e.join(" "):e}function Re(e,t,n){return y(e)?y(t)?(y(R[e])||(R[e]={}),y(n)||(n=Object.keys(R[e]).length),R[e][n]=t,s):R[e]:R}function xe(e,t){return y(e)?y(t)&&y(R[e])?(delete R[e][t],s):(R[e]={},s):(R={},s)}function Ne(e,t,n){if(!y(R[e]))return R[e]={},s;if(y(n))y(R[e][n])&&R[e][n].apply(s,t);else for(U in R[e])R[e][U].apply(s,t);return s}function we(e,t,n){if(E(t))for(U in t)we(e,U,t[U]);else e.setAttribute(t,n)}function Se(t,n,i){if(T(n))return Se(t,[n],y(i)?i:"")[0];e=[];for(U in n)U=n[U],(U=t.getAttribute(U))&&e.push(U);return e.length?e:y(i)?i:[]}function Ce(e,t){if(E(t))for(U in t)Ce(e,t[U]);else if(y(t))e.removeAttribute(t);else for(Ce(e,"class"),U=0,D=e.attributes,M=D.length;M>U;++U)D[U]&&Ce(e,D[U].name)}function Fe(e,t,n){if(E(t))for(U in t)Fe(e,U,t[U]);else we(e,"data-"+t,n)}function Ge(t,n,i){if(T(n))return Ge(t,[n],y(i)?i:"")[0];e=[];for(U in n)U=n[U],(U=Se(t,"data-"+U))&&e.push(U);return e.length?e:y(i)?i:[]}function He(e,t){if(E(t))for(U in t)Ce(e,"data-"+t[U]);else if(y(t))Ce(e,"data-"+t);else for(U=0,D=e.attributes,M=D.length;M>U;++U)D[U]&&"data-"===D[U].name.slice(0,5)&&Ce(e,D[U].name)}function _e(e){return e&&e.preventDefault(),!1}function qe(e,t,n){if(t){for(e=Le(e),U=0,D=e.length;D>U;++U)t.addEventListener(e[U],n,!1),Re("on:"+e[U],n,et(t));return s}}function Ue(e,t,n){if(t){for(e=Le(e),U=0,D=e.length;D>U;++U)t.removeEventListener(e[U],n,!1),xe("on:"+e[U],et(t));return g(t)&&t.id.split(":")[0]===Tt+"-dom"&&Ce(t,"id"),s}}function De(e,t,n){e=Le(e);var o,i="createEvent"in a;for(U=0,D=e.length;D>U;++U)i?(o=a.createEvent("HTMLEvents"),o.data=n,o.initEvent(e[U],!0,!1),t.dispatchEvent(o)):Ne("on:"+e[U],n,et(t));return s}function Me(e,t){return setTimeout(e,t)}function Be(e){return clearTimeout(e)}function Pe(e,t,n){for(U=0,D=t.length,M;D>U;++U)M=t[U],e=e.replace(A(M)?M:d(u(M),"g"),n&&n[U]||"");return e}function We(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,y(t[n])?t[n]:e})}function Ke(e){return h(Pe(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function ze(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,o=Ye(e);return{x:n-o.l,y:i-o.t}}function Ye(e){for(B=e.offsetLeft,V=e.offsetTop;e=e.offsetParent;)B+=e.offsetLeft,V+=e.offsetTop;return{l:B,t:V}}function je(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Ve(e,t){for(;(e=ot(e))&&e!==t;);return e}function Qe(e,t){t=Le(t);for(U in t)e.classList.add(t[U])}function Xe(t,n,i){if(T(n))return Xe(t,[n],y(i)?i:"")[0];e=[];for(U in n)U=n[U],t.classList.contains(U)&&e.push(U);return e.length?e:y(i)?i:!1}function Ze(e,t){if(y(t)){t=Le(t);for(U in t)e.classList.remove(t[U])}else Ce(e,"class")}function Je(e,t,n){if(e=T(e)?a.createElement(e):e,E(n))for(U in n)if(X=n[U],"classes"===U)Qe(e,X);else if("data"===U)for(D in X)X=X[D],null===X?He(e,D):Fe(e,D,X);else"css"===U?T(X)?we(e,"style",X):null===X?Ce(e,"style"):p(e,X):k(X)?e[U]=X:null===X?Ce(e,U):we(e,U,E(X)?X.join(" "):""+X);if(g(t))ht(e,t);else if(E(t))for(U in t)X=t[U],g(X)?ht(e,X):X!==!1&&tt(e,X);else y(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=Tt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||(y(t)?t:"")}function it(e,t){if(t!==!1&&(C=rt(e)))for(U=0,D=C.length;D>U;++U)it(C[U]);tt(e,"")}function ot(e){return e&&e.parentNode}function rt(e){return e&&e.children||[]}function lt(e){return e&&e.nextSibling}function at(e){return e&&e.previousSibling}function st(e,t){return e&&T(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&k(t)?e===t(e):e===t}function ct(t,n){if(n=n||a,e=[],T(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(U=0,D=t.length;D>U;++U)e.push(t[U]);return e}return[]}for(t=n.querySelectorAll(t),U=0,D=t.length;D>U;++U)e.push(t[U]);return e}return ut(t)?[t]:[]}function ut(e,t){var n=ot(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ft(e,t){K=ot(e),K&&K.insertBefore(t,e)}function pt(e,t){K=ot(e),K&&K.insertBefore(t,lt(e))}function bt(e,t){C=rt(e)[0],C?ft(C,t):ht(e,t)}function dt(e,t){ht(e,t)}function ht(e,t){e.appendChild(t)}function mt(e,t){var n=ut(e);if(n){if(t!==!1)for(C=rt(e)[0];C;)mt(C);n.removeChild(e)}}function gt(e){it(Je(e,!1,{style:""})),mt(e)}function kt(e,t,n){return Je(t||"div",n,{"class":e})}function Yt(e){return!e||y(e.active)&&!j.active}function jt(){Lt._word&&Lt._words&&(X=(Ct.value||"").replace(d(Ae[0]+"[^"+Ae[0]+Ae[1]+"]+?"+Ae[1],"g"),""),U=(X.match(/(\w+)/g)||[]).length,tt(Mt,We(Lt["_word"+(1===U?"":"s")],[U])))}function Vt(e,t,n){return k(e)&&(e={click:e}),T(e.click)&&(e.click=(n[e.click]||{}).click),y(e.title)||(e.title=yt[t]||""),n[t]=e,e}function Qt(){it(St,!1);var i,o,r,l,a,c,e=Le(N.tools),t=Tt+"-button",n=Tt+"-separator";N.tools=e;for(a in e)c=e[a],o=vt.tools[c],(o||o==={})&&(o=Vt(o,c,vt.tools),r=o.i||c,"|"!==r&&"<"!==r[0]&&(r=Ke(r)),l="|"!==r,Kt=kt(l?t:n,l?"a":"span"),l?(i=t+":"+Ke(c).replace(/\s/g,""),we(Kt,{href:$e,id:i,tabindex:-1}),Fe(Kt,ye,c),r="<"===r[0]?r:'<i class="'+We(At,[r])+" "+i+'"></i>',Yt(o)&&Qe(Kt,"x"),o.text&&(r=We('<span class="'+Tt+'-text">'+o.text+"</span>",[r]),Qe(Kt,"text")),tt(Kt,r),Je(Kt,!1,o.attributes||{}),!Kt.title&&(D=o.title)&&(Kt.title=E(D)?D[0]+(D[1]?" ("+D[1]+")":""):D),qe(ue,Kt,rn)):Kt.id=Tt+"-separator:"+a,vt.tools[c].target=Kt,ht(St,Kt));Ne("update.tools",[s])}function Xt(){vt.keys=function(){var n,e=Object.keys(vt.keys).sort().reverse(),t={};for(U=0,D=e.length;D>U;++U)n=e[U],t[n]=vt.keys[n];return t}(),nn(1),Ne("update.keys",[s])}function Zt(e){jt(),Ne("on:change",[e,s])}function tn(t){function b(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=s.$(),i=n.before,o=n.after,r=i.slice(-1),l=o[0],a=n.length,c=vt.keys,f=TE.keys_alias,p=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();W=t.TE.key(),Jt[W]=1,e=Object.keys(Jt).length,Me(function(){s.record()},1);for(U in c){M=b(U),C=0;for(D in M)D=M[D],Jt[f[D]||D]&&++C;if(M=M.length,C===M&&e===M&&(T(c[U])&&(c[U]=vt.tools[c[U]].click),B=c[U]&&c[U](t,s),B===!1))return _e(t)}if(ke)for(U in ke)if(P=ke[U],P!==!1){if(W===P&&l===P)return"\\"===r?(s.insert(W,0),_e(t)):(s.select(n.end+1),_e(t));if(U===W)return s.wrap(U,P),_e(t);if(r===U&&l===P){if("backspace"===W&&i.slice(-2)!=="\\"+U)return s.unwrap(U,P),_e(t);if(ge&&"enter"===W&&U!==P)return s.tidy("\n"+p+me,"\n"+p).scroll(!0),_e(t)}}if(ge&&!a){if("backspace"===W&&d(u(me)+"$").test(i))return s.outdent(me).scroll(!0),_e(t);if("enter"===W&&d("(^|\\n)("+u(me)+")+.*$").test(i))return s.insert("\n"+p,0,1).scroll(!0),_e(t)}}function nn(e){E(e)?delete Jt[e.TE.key()]:Jt={}}function on(e){/^focus|blur$/.test(e.type)&&nn(1),Be(en),en=Me(function(){Zt(e)},N.debounce||0)}function rn(e){vt.exit(0,0,0);var t=Ge(this,ye),n=vt.tools,i=n[t];return Wt=e.currentTarget||e.target,!Yt(i)&&k(D=i.click)&&(D=D(e,s,t),Ne("on:change",[e,s,t]),D===!1)?_e(e):(s.select(),_e(e))}function un(e){return ln=Ft,j=je(wt),_e(e)}function fn(e){ln===Ft&&p(Ct,{height:ze(Nt,e).y-j.h+Oe})}function pn(){ln=0}function bn(){vt.exit(1)}function dn(){e=je(_t),Z=e.w,q=e.h,e=je(Ht),an=e.w,sn=e.h}function hn(e,t){t&&Ne("exit.modal."+t,[s]),De(ue,Ht,[e])}function mn(t){ln=t.target,e=ze(_t,t),J=e.x,ee=e.y,dn()}function gn(t){var n=cn.header,i=cn.resize;ln===n||Ve(ln,n)===n?(e=ze(Nt,t),B=e.x-J,V=e.y-ee,p(_t,{left:(Z>an?B:b(B,0,an-Z))+Oe,top:(q>sn?V:b(V,0,sn-q))+Oe})):ln===i&&(e=ze(_t,t),j=je(i),p(_t,{width:e.x+j.w/4+Oe,height:e.y+j.h/4+Oe}))}function kn(){ln=0}function vn(e,t,n){return{header:e,body:t,footer:n}}function En(e){w=Wt,S=qt,C=e&&e.target||0,(!C||C!==w&&Ve(C,w)!==w)&&(Wt=0,gt(qt),Ue(ue,a,En),Ue(be,l,En),vt.exit(e.target===I))}function Tn(t){function n(){e&&(K=je(e),p(Y,{width:K.w+Oe,height:K.h+Oe}))}return X=s.get(),Z="",-1===X.indexOf("</html>")&&(Z='<!DOCTYPE html><html dir="'+N.dir+'"><head><meta charset="utf-8"><style>'+N.css+"</style></head><body>"+X+"</body></html>"),Y=Je("iframe",!1,{"class":Tt+"-portal",src:"data:text/html,"+encodeURIComponent(Z)}),!ut(Ht)&&X?vt.overlay(Y,1,function(){e=rt(Ht)[0],n(),qe(be,l,n),Ne("enter.overlay.preview",[t,s,[X,Z],e])}):(Ue(be,l,n),bn()),_e(t)}var w,S,C,H,q,U,D,M,B,P,W,e,K,Y,j,V,X,Z,J,ee,t="⌘",n="…",o="⇥",r="⇧",l=window,a=document,s=this,c=s._,u=c.x,f=c.extend,p=c.css,b=c.edge,d=c.pattern,h=c.trim,m=s.is,g=m.e,k=m.f,v=m.i,E=m.o,A=m.r,T=m.s,y=function(e){return!m.x(e)},$=a.documentElement,L=(a.head,a.body),I=s.target,R={},x=function(){},N=f({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",o],outdent:["Outdent",r+"+"+o],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ne="keydown",ie="keyup",oe="copy",re="cut",le="paste",ae="touchstart mousedown",se="touchend mouseup",ce="touchmove mousemove",ue="click",fe="focus",pe="blur",be="orientationchange resize",de=pe+" "+oe+" "+re+" "+fe+" input "+ne+" "+le,he=N.languages,me=N.tab,ge=N.auto_tab,ke=N.auto_close,ve=N.unit[0][0],Ae=(N.unit[0][1],N.unit[1][0]),Te=N.unit[1][1],ye="tool-id",$e="javascript:;",Oe="px",vt=s.ui={};s.tidy=function(e,t){var n=s.$(),i=h(n.before)?e:"",o=h(n.after)?y(t)?t:e:"";return s.trim(i,o)},s.i=function(){return h(s.replace(/\s+/g," "))},s.format=function(e,t,n,i){E(e)||(e=[e]),y(n)||(n=" "),y(i)||(i="");var o=s.$(),r=(e[0]?ve[0]+e[0]+ve[1]:"")+i,l=i+(e[0]?ve[0]+ve[2]+(e[1]||e[0].split(d("("+Te[3]+")+"))[0])+ve[1]:""),a=u(r),c=u(l),f=d("^"+a+"([\\s\\S]*?)"+c+"$"),p=d(a+"$"),b=d("^"+c),h=o.before,m=o.after;return o.length?n=!1:s.insert(he.placeholders[""]).loss(),s.toggle(t?!f.test(o.value):!p.test(h)&&!b.test(m),[function(e){e.unwrap(r,l,1).tidy(d(Ae[0]+"[^"+Ae[0]+Ae[1]+Ae[2]+"]+?"+Ae[1]+"$").test(h)?"":n,d("^"+Ae[0]+Ae[2]+"[^"+Ae[0]+Ae[1]+"]+?"+Ae[1]).test(m)?"":n).loss().wrap(r,l,t)},function(e){e.unwrap(r,l,t)}])};var Kt,Et=N.classes,At=Et.i,Tt=Et[""],yt=he.tools,$t=he.buttons,Ot=he.labels,Lt=he.others,It=Tt+"-textarea "+Tt+"-content block",Rt=kt(Tt),xt=kt(Tt+"-header"),Nt=kt(Tt+"-body"),wt=kt(Tt+"-footer"),St=kt(Tt+"-tool"),Ct=Je(I,!1,N.attributes),Ft=kt(Tt+"-resize s"),Gt=kt(Tt+"-description"),Ht=kt(Tt+"-overlay"),_t=Je("div"),qt=Je("div"),Ut=Je("div"),Dt=kt("left","span"),Mt=kt("right","span"),Bt=kt(Tt+"-preview","a"),Pt=0,Wt=0;N.suffix||(N.suffix=ve[1]);var Jt={},en=null;s.create=function(e,t){E(e)&&(N=f(N,e));var n=ut(Ct);return Qe(Ct,It),n&&st(n,"p")?(ft(n,Rt),Pt=n,mt(n,!1)):ft(Ct,Rt),Rt.dir=N.dir,ht(Rt,xt),ht(Rt,Nt),ht(Rt,wt),ht(Rt,Ft),ht(Nt,Ct),N.tools&&(ht(xt,St),ht(wt,Gt),ht(Gt,Dt),ht(Gt,Mt)),qe(ne,Ct,tn),qe(ie,Ct,nn),qe(de,Ct,on),qe(ae,Ft,un),qe(ce,a,fn),qe(se,L,pn),Lt.preview&&(j=yt.preview,we(Bt,{href:$e,title:E(j)?j[0]+(j[1]?" ("+j[1]+")":""):j}),ht(Dt,Bt),tt(Bt,Lt.preview)),Zt(null),Qt(),Xt(),0!==t?Ne("create",[s]):s},s.update=function(e,t){return Xe(Ct,Le(It),0)&&s.destroy(0),(0!==t?Ne("update",[s]):s).create(e,0)},s.destroy=function(e){return Xe(Ct,Le(It),0)?(vt.exit(0,0,0),Ze(Ct,It),N.tools=Ie(N.tools),N.keys&&(Ue(ne,Ct,tn),Ue(ie,Ct,nn)),Ue(ae,Ft,un),Ue(ce,a,fn),Ue(se,a,pn),Ue(de,Ct,on),Pt?(ft(Rt,Pt),ht(Pt,Ct),Pt=0):ft(Rt,Ct),gt(Rt),0!==e?Ne("destroy",[s]):s):s};var ln=0,J=0,ee=0,Z=0,q=0,an=0,sn=0,cn={};vt.exit=function(e,t,n){if(H={overlay:function(){Ue(ue,Ht,bn),gt(Ht)},modal:function(){Ue(ae,Nt,mn),Ue(ce,Nt,gn),Ue(se,a,kn),Ue(ue,cn.x,hn),gt(_t)},drop:function(){gt(qt)},bubble:function(){gt(Ut)}},t)if(E(t))for(U in t)U=t[U],H[U]&&H[U](),0!==n&&Ne("exit."+U,[s]);else H[t]&&H[t](),0!==n&&Ne("exit."+U,[s]);else for(U in H)H[U]();return e&&s.select(),0!==n&&Ne("exit",[s]),s},vt.overlay=function(e,t,n){return vt.exit(0,0,0),nn(1),ht(Nt,Je(Ht,e.length||g(e)?kt(Tt+"-overlay-content","div",e):"")),t&&qe(ue,Ht,bn),k(n)?n(Ht):Je(Ht,n),Ne("enter.overlay",[s]),Ne("enter",[s]),s},vt.overlay.fit=function(){},vt.modal=function(){vt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],i=e[2],o=Tt+"-modal";E(t)&&(t="default",n=e[0],i=e[1]),B=Ke(t),Je(_t,!1,{"class":o+" "+B}),y(n.body)&&(n.body=Je("div",n.body,{"class":o+"-content "+B}));for(U in n)o[1]=U,cn[U]=kt(o+"-"+We(U,o)+" "+B,0,n[U]);return cn.x=kt(Tt+"-x "+B),cn.resize=kt(Tt+"-resize se "+B),it(_t),ht(Nt,Je(_t,cn,{style:""})),vt.modal.fit(),pt(_t,Ht),qe(ue,cn.x,hn),qe(ae,cn.header,_e),qe(ae,cn.resize,_e),qe(ae,Nt,mn),qe(ce,Nt,gn),qe(se,a,kn),k(i)&&(cn.overlay=Ht,cn.modal=_t,i(cn)),Ne("enter.modal."+t,[s]),Ne("enter.modal",[s]),Ne("enter",[s]),s},vt.modal.fit=function(e){return dn(),B=an/2-Z/2,V=sn/2-q/2,E(e)?(B=e[0],V=e[1]):(B=b(B,0),V=b(V,0)),p(_t,{left:B+Oe,top:V+Oe,"min-width":Z+Oe,"min-height":q+Oe,visibility:"visible"}),Ne("fit.modal",[s]),Ne("fit",[s]),s};var An={"class":Tt+"-button",name:"y"};return vt.alert=function(e,t,n,i){var o=Je("button",$t.okay,An),r="alert";return n=n||x,E(e)&&(r+=":"+e[0],e=e[1]||e[0]),qe(ue,o,function(e){return n(e,s),hn(e,r+".y"),_e(e)}),qe(ne,o,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(De(ue,o,[e]),_e(e)):void 0}),vt.modal(r,vn(e,t,o),i),o.focus(),s},vt.confirm=function(e,t,n,i,o){function u(e){return k(n)&&n(e,s),hn(e,a+".y"),_e(e)}function f(e){return k(i)&&i(e,s),hn(e,a+".n"),_e(e)}var c,r=Je("button",$t.okay,An),l=Je("button",$t.cancel,An),a="confirm";return l.name="n",E(e)&&(a+=":"+e[0],e=e[1]||e[0]),qe(ue,r,u),qe(ue,l,f),qe(ne,r,function(e){return c=e.TE.key,c("arrowright")?(l.focus(),_e(e)):c("arrowleft")?_e(e):c("enter")?(u(e),_e(e)):c("escape")?(hn(e,a+".y"),_e(e)):void 0}),qe(ne,l,function(e){return c=e.TE.key,c("arrowright")?_e(e):c("arrowleft")?(r.focus(),_e(e)):c("enter")?(f(e),_e(e)):c("escape")?(hn(e,a+".n"),_e(e)):void 0}),vt.modal(a,vn(e,t,[r,l]),o),l.focus(),s},vt.prompt=function(e,t,n,i,o,r){function d(){c.focus(),"placeholder"in c&&c.select()}function m(e){return _e(e)}function g(e){return p=c.value,!n||h(p)&&p!==t?(hn(e,u+".y"),_e(e),i(e,s,p!==t?p:"",t)):(d(),m(e))}function v(e){return hn(e,u+".n"),_e(e)}var p,b,l=Je("button",$t.okay,An),a=Je("button",$t.cancel,An),c=Je("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Tt+"-input block"}),u="prompt",f=[];if(E(e)&&(u+=":"+e[0],e=e[1]||e[0]),k(o)&&(r=o,o=0),1===o)c=Je("textarea",t,{placeholder:t.split("\n")[0],"class":Tt+"-textarea block"});else if(2===o){for(U in t)f.push(Je("option",t[U],{value:U,selected:U===n||null}));c=Je("select",f,{"class":Tt+"-select block"})}return i=i||x,c.name="data",a.name="n",qe(ne,c,function(e){return b=e.TE.key,b("enter")?g(e):b("escape")||b("backspace")&&!this.value?v(e):b("arrowup")?m(e):b("arrowdown")?(l.focus(),_e(e)):void 0}),qe(ne,l,function(e){return b=e.TE.key,b("enter")?g(e):b("escape")?v(e):b("arrowup")?(c.focus(),_e(e)):b("arrowright")?(a.focus(),_e(e)):b(/^arrow(down|left)$/)?m(e):void 0}),qe(ne,a,function(e){return b=e.TE.key,b(/^enter|escape$/)?v(e):b("arrowup")?(c.focus(),_e(e)):b(/^arrow(right|down)$/)?m(e):b("arrowleft")?(l.focus(),_e(e)):void 0}),qe(ue,l,g),qe(ue,a,v),vt.modal(u,vn(e,c,[l,a]),r),d(),s},vt.drop=function(){vt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),B=Ke(t),it(qt),ht(L,Je(qt,!1,{"class":Tt+"-drop "+B})),k(n)?n(qt):Je(qt,n),vt.drop.fit(),qe(ue,a,En),qe(be,l,En),Ne("enter.drop."+t,[s]),Ne("enter.drop",[s]),s},vt.drop.fit=function(t){return w=je($),S=je(qt),B=w.w/2-S.w/2,V=w.h/2-S.h/2,!y(t)&&Wt&&(e=Ye(Wt),B=e.l,V=e.t+je(Wt).h),E(t)?(B=t[0],V=t[1]):(B=b(B,0,Math.max(w.w,l.innerWidth)-S.w),V=b(V,0,Math.max(w.h,l.innerHeight)-S.h)),p(qt,{left:B+Oe,top:V+Oe,visibility:"visible"}),Ne("fit.drop",[s]),Ne("fit",[s]),s},vt.menu=function(e,t,n,i){t=!E(t)&&n[t]&&n[t].text||t;var a,o='<span class="'+Tt+'-current menu">%1</span>',r="",l=0;return t===!1?vt.tool(e,t):(E(t)&&(r=t[0],r="<"===r[0]?r:'<i class="'+We(At,[r])+'"></i>',t=y(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,o=r+(0!==t?" "+o:"")),vt.tool(e,{i:r,text:t?We(o,[t,r]):0,click:function(c){return vt.drop("menu menu-"+Ke(e),function(c){function u(e){return a=this,P=n[Ge(a,ye)],P=T(P)?vt.tools[P]:P||{},W=nt(a),!Yt(P)&&k(i=P.click)&&(i=i(e,s),t!==!1&&Wt&&(j=rt(Wt)[0]||Wt,st(j,"i")||tt(j,We(o,[W,r])),E(P.text)&&(V=rt(j)[0])&&st(V,"i")&&(Ze(V),Qe(V,We(At,[P.text[0]])))),i===!1)?_e(e):(s.select(),_e(e))}function p(e){if(a=this,(M=e.TE.key)("escape"))return vt.exit(1),_e(e);if(M("arrowdown")&&(B=lt(a))){for(;!st(B,"a")&&B;)B=lt(B);return B&&B.focus(),_e(e)}if(M("arrowup")&&(B=at(a))){for(;!st(B,"a")&&B;)B=at(B);return B&&B.focus(),_e(e)}}for(i in n)if(a=n[i],Z="%"===i[0],a=T(a)&&!Z?vt.tools[a]:a){a=Vt(a,i,vt.tools);var b={href:Z?null:$e,"class":Tt+"-"+(Z?"label":"button")};Z?D=Ot[e]&&Ot[e][+i.slice(1)-1]||i:(b.data={},b.data[ye]=i,D=yt[i]||i),Y=a.text,Y=E(Y)?Y[1]||"":Y,D=E(D)?D[0]:D,j=Je(Z?"span":"a",Z?"<span>"+(D||"%"+l)+"</span>":a.text||D,f(b,a.attributes||{})),!j.title&&(V=a.title)&&(j.title=E(V)?V[0]+(V[1]?" ("+V[1]+")":""):V),Z?we(j,{id:Tt+"-label:"+l}):(Yt(a)&&Qe(j,"x"),qe(ue,j,u),qe(ne,j,p)),n[i]=a,ht(c,j),++l}Me(function(){ct("a",c)[0].focus()},1)}),!1}},i),vt.tools[e].data=n,s)},vt.bubble=function(){vt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),B=Ke(t),it(Ut),ht(L,Je(Ut,!1,{"class":Tt+"-bubble "+B})),k(n)?n(Ut):Je(Ut,n),vt.bubble.fit(),Ne("enter.bubble."+t,[s]),Ne("enter.bubble",[s]),s},vt.bubble.fit=function(t){j=s.$(1),e=Ye(Ct),q=p(Ct,"line-height");var n="border-",i="-width";B=j.caret[0].x+e.l-Ct.scrollLeft,V=j.caret[1].y+e.t+q-Ct.scrollTop,S=p(Nt,[n+"top"+i,n+"bottom"+i,n+"left"+i,n+"right"+i]);var o=je(Nt),r=je(Ut),l=S[0]+S[1],a=S[2]+S[3];return E(t)?(B=t[0],V=t[1]):(B=b(B,e.l,e.l+o.w-r.w-a),V=b(V,e.t,e.t+o.h-r.h-l)),p(Ut,{left:B+Oe,top:V+Oe,visibility:"visible"}),Ne("fit.bubble",[s]),Ne("fit",[s]),s},vt.overlay.exit=function(e){return vt.exit(e,"overlay")},vt.modal.exit=function(e){return vt.exit(e,"modal")},vt.drop.exit=function(e){return vt.exit(e,"drop")},vt.bubble.exit=function(e){return vt.exit(e,"bubble")},vt.tool=function(e,t,n){return D="","|"!==e&&(N.tools=N.tools.filter(function(t,n){return t===e?(D=n,!1):!0})),t===!1?delete vt.tools[e]:("|"===e?(n=t,t={}):(k(t)&&(t={click:t}),vt.tools[e]=f(vt.tools[e]||{},t),y(n)||""===D||(n=D)),v(n)?N.tools.splice(n,0,e):N.tools.push(e)),Qt(),s},vt.key=function(e,t){return N.keys?(t===!1?delete vt.keys[e]:vt.keys[e]=t,Xt(),s):s},vt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(me),!1},outdent:function(e,t){return t.outdent(me),!1}},qe(ue,Bt,Tn),vt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Tn(e)},"shift+tab":ge?"outdent":0,tab:ge?"indent":0,escape:function(e,t){return Bt.focus(),!1}},vt.el={container:Rt,header:xt,body:Nt,footer:wt,overlay:Ht,modal:_t,drop:qt,bubble:Ut},s.config=N,f(s._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),o=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),a=e.getMilliseconds();return 10>n&&(n="0"+n),10>i&&(i="0"+i),10>o&&(o="0"+o),10>r&&(r="0"+r),10>l&&(l="0"+l),10>a&&(a="0"+a),[""+t,""+n,""+i,""+o,""+r,""+l,""+a]},replace:Pe,format:We,dom:{set:ht,reset:mt,get:ct,id:et,copy:function(e,t){return e.cloneNode(y(t)?t:!0)},classes:{set:Qe,reset:Ze,get:Xe},attributes:{set:we,reset:Ce,get:Se},data:{set:Fe,reset:He,get:Ge},is:st,offset:Ye,point:ze,size:je,content:{set:tt,reset:it,get:nt},closest:Ve,parent:ot,children:rt,next:lt,previous:at,before:ft,after:pt,prepend:bt,append:dt},el:Je,event:{set:qe,reset:Ue,fire:De,x:_e},hooks:R,hook:{set:Re,reset:xe,fire:Ne}}),vt};