/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Ce(e){return T(e)?b(e).split(/\s+/):e}function ze(e){return k(e)?e.join(" "):e}function Me(e,t,n){return $(e)?$(t)?($(M[e])||(M[e]={}),$(n)||(n=Object.keys(M[e]).length),M[e][n]=t,s):M[e]:M}function Oe(e,t){return $(e)?$(t)&&$(M[e])?(delete M[e][t],s):(M[e]={},s):(M={},s)}function je(e,t,n){if(!$(M[e]))return M[e]={},s;if($(n))$(M[e][n])&&M[e][n].apply(s,t);else for(P in M[e])M[e][P].apply(s,t);return s}function De(e,t,n){if(k(t))for(P in t)De(e,P,t[P]);else e.setAttribute(t,n)}function He(t,n,r){if(T(n))return He(t,[n],$(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=t.getAttribute(P))&&e.push(P);return e.length?e:$(r)?r:[]}function Ne(e,t){if(k(t))for(P in t)Ne(e,t[P]);else if($(t))e.removeAttribute(t);else for(Ne(e,"class"),P=0,W=e.attributes,F=W.length;F>P;++P)W[P]&&Ne(e,W[P].name)}function Ye(e,t,n){if(k(t))for(P in t)Ye(e,P,t[P]);else De(e,"data-"+t,n)}function Be(t,n,r){if(T(n))return Be(t,[n],$(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=He(t,"data-"+P))&&e.push(P);return e.length?e:$(r)?r:[]}function Se(e,t){if(k(t))for(P in t)Ne(e,"data-"+t[P]);else if($(t))Ne(e,"data-"+t);else for(P=0,W=e.attributes,F=W.length;F>P;++P)W[P]&&"data-"===W[P].name.slice(0,5)&&Ne(e,W[P].name)}function Ae(e){return e&&e.preventDefault(),!1}function Ie(e,t,n){if(t){for(e=Ce(e),P=0,W=e.length;W>P;++P)t.addEventListener(e[P],n,!1),Me("on:"+e[P],n,et(t));return s}}function Pe(e,t,n){if(t){for(e=Ce(e),P=0,W=e.length;W>P;++P)t.removeEventListener(e[P],n,!1),Oe("on:"+e[P],et(t));return m(t)&&t.id.split(":")[0]===kt+"-dom"&&Ne(t,"id"),s}}function We(e,t,n){e=Ce(e);var i,r="createEvent"in u;for(P=0,W=e.length;W>P;++P)r?(i=u.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[P],!0,!1),t.dispatchEvent(i)):je("on:"+e[P],n,et(t));return s}function Fe(e,t,n){for(P=0,W=t.length,F;W>P;++P)F=t[P],e=e.replace(E(F)?F:h(a(F),"g"),n&&n[P]||"");return e}function Re(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,$(t[n])?t[n]:e})}function Ue(e){return b(Fe(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function Xe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=qe(e);return{x:n-i.l,y:r-i.t}}function qe(e){for(R=e.offsetLeft,J=e.offsetTop;e=e.offsetParent;)R+=e.offsetLeft,J+=e.offsetTop;return{l:R,t:J}}function Ke(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Ze(e,t){for(;(e=it(e))&&e!==t;);return e}function Ge(e,t){t=Ce(t);for(P in t)e.classList.add(t[P])}function Je(t,n,r){if(T(n))return Je(t,[n],$(r)?r:"")[0];e=[];for(P in n)P=n[P],t.classList.contains(P)&&e.push(P);return e.length?e:$(r)?r:!1}function Qe(e,t){if($(t)){t=Ce(t);for(P in t)e.classList.remove(t[P])}else Ne(e,"class")}function Ve(e,t,n){if(e=T(e)?u.createElement(e):e,k(n))for(P in n)if(V=n[P],"classes"===P)Ge(e,V);else if("data"===P)for(W in V)V=V[W],null===V?Se(e,W):Ye(e,W,V);else"css"===P?T(V)?De(e,"style",V):null===V?Ne(e,"style"):d(e,V):w(V)?e[P]=V:null===V?Ne(e,P):De(e,P,k(V)?V.join(" "):""+V);if(m(t))bt(e,t);else if(k(t))for(P in t)V=t[P],m(V)?bt(e,V):V!==!1&&tt(e,V);else $(t)&&t!==!1&&tt(e,t);return e}function et(e){var t=e.id;return t||(t=kt+"-dom:"+Date.now(),e.id=t),t}function tt(e,t){e.innerHTML=t}function nt(e,t){return e.innerHTML||($(t)?t:"")}function rt(e,t){if(t!==!1&&(N=ot(e)))for(P=0,W=N.length;W>P;++P)rt(N[P]);tt(e,"")}function it(e){return e&&e.parentNode}function ot(e){return e&&e.children||[]}function ft(e){return e&&e.nextSibling}function ut(e){return e&&e.previousSibling}function st(e,t){return e&&T(t)?e.nodeName.toLowerCase()===t.toLowerCase():e&&w(t)?e===t(e):e===t}function lt(t,n){if(n=n||u,e=[],T(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(P=0,W=t.length;W>P;++P)e.push(t[P]);return e}return[]}for(t=n.querySelectorAll(t),P=0,W=t.length;W>P;++P)e.push(t[P]);return e}return at(t)?[t]:[]}function at(e,t){var n=it(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){q=it(e),q&&q.insertBefore(t,e)}function dt(e,t){q=it(e),q&&q.insertBefore(t,ft(e))}function pt(e,t){N=ot(e)[0],N?ct(N,t):bt(e,t)}function ht(e,t){bt(e,t)}function bt(e,t){e.appendChild(t)}function gt(e,t){var n=at(e);if(n){if(t!==!1)for(N=ot(e)[0];N;)gt(N);n.removeChild(e)}}function yt(e){rt(Ve(e,!1,{style:""})),gt(e)}function vt(e,t,n){return Ve(t||"div",n,{"class":e})}function qt(e){return!e||$(e.active)&&!G.active}function Kt(){Lt._word&&Lt._words&&(V=(Dt.value||"").replace(h(Ee[0]+"[^"+Ee[0]+Ee[1]+"]+?"+Ee[1],"g"),""),P=(V.match(/(\w+)/g)||[]).length,tt(Pt,Re(Lt["_word"+(1===P?"":"s")],[P])))}function Zt(e,t,n){return w(e)&&(e={click:e}),T(e.click)&&(e.click=(n[e.click]||{}).click),$(e.title)||(e.title=Et[t]||""),n[t]=e,e}function Gt(){rt(jt,!1);var r,i,o,f,u,l,a,e=Ce(j.tools),t=kt+"-button",n=kt+"-separator";j.tools=e;for(l in e)a=e[l],i=mt.tools[a],(i||i==={})&&(i=Zt(i,a,mt.tools),o=i.i||a,"|"!==o&&"<"!==o[0]&&(o=Ue(o)),f="|"!==o,u=Ue(o).replace(/\s/g,""),Ut=vt(f?t+" "+t+"-"+u:n+" "+n+"-"+l,f?"a":"span"),f?(r=t+":"+u,De(Ut,{href:Le,id:r,tabindex:-1}),Ye(Ut,$e,a),o="<"===o[0]?o:'<i class="'+Re(xt,[o])+'"></i>',qt(i)&&Ge(Ut,"x"),i.text&&(o=Re('<span class="'+kt+'-text">'+i.text+"</span>",[o]),Ge(Ut,"text")),tt(Ut,o),Ve(Ut,!1,i.attributes||{}),!Ut.title&&(W=i.title)&&(Ut.title=k(W)?W[0]+(W[1]?" ("+W[1]+")":""):W),Ie(de,Ut,on)):Ut.id=n+":"+l,mt.tools[a].target=Ut,bt(jt,Ut));je("update.tools",[s])}function Jt(){mt.keys=function(){var n,e=Object.keys(mt.keys).sort().reverse(),t={};for(P=0,W=e.length;W>P;++P)n=e[P],t[n]=mt.keys[n];return t}(),nn(1),je("update.keys",[s])}function Qt(e){Kt(),je("on:change",[e,s])}function tn(t){function p(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=s.$(),r=n.before,i=n.after,o=r.slice(-1),f=i[0],u=n.length,l=mt.keys,c=TE.keys_alias,d=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();X=t.TE.key(),Vt[X]=1,e=Object.keys(Vt).length,g(function(){s.record()},1);for(P in l){F=p(P),N=0;for(W in F)W=F[W],Vt[c[W]||W]&&++N;if(F=F.length,N===F&&e===F&&(T(l[P])&&(l[P]=mt.tools[l[P]].click),R=l[P]&&l[P](t,s),R===!1))return Ae(t)}if(we)for(P in we)if(U=we[P],U!==!1){if(X===U&&f===U)return"\\"===o?(s.insert(X,0),Ae(t)):(s.select(n.end+1),Ae(t));if(P===X)return s.wrap(P,U),Ae(t);if(o===P&&f===U){if("backspace"===X&&r.slice(-2)!=="\\"+P)return s.unwrap(P,U),Ae(t);if(me&&"enter"===X&&P!==U)return s.tidy("\n"+d+ve,"\n"+d).scroll(!0),Ae(t)}}if(me&&!u){if("backspace"===X&&h(a(ve)+"$").test(r))return s.outdent(ve).scroll(!0),Ae(t);if("enter"===X&&h("(^|\\n)("+a(ve)+")+.*$").test(r))return s.insert("\n"+d,0,1).scroll(!0),Ae(t)}}function nn(e){k(e)?delete Vt[e.TE.key()]:Vt={}}function rn(e){/^(focus|blur)$/.test(e.type)&&nn(1),y(en),en=g(function(){Qt(e)},j.debounce||0)}function on(e){mt.exit(0,0,0);var t=Be(this,$e),n=mt.tools,r=n[t];return Rt=e.currentTarget||e.target,!qt(r)&&w(W=r.click)&&(W=W(e,s,t),je("on:change",[e,s,t]),W===!1)?Ae(e):(s.select(),Ae(e))}function an(e){return fn=Ht,G=Ke(Ot),Ae(e)}function cn(e){fn===Ht&&d(Dt,{height:Xe(Mt,e).y-G.h+_e})}function dn(){fn=0}function pn(){mt.exit(1)}function hn(){e=Ke(Bt),ee=e.w,I=e.h,e=Ke(Yt),un=e.w,sn=e.h}function bn(e,t){t&&je("exit.modal."+t,[s]),We(de,Yt,[e])}function gn(t){fn=t.target,e=Xe(Bt,t),te=e.x,ne=e.y,hn()}function yn(t){var n=ln.header,r=ln.resize;fn===n||Ze(fn,n)===n?(e=Xe(Mt,t),R=e.x-te,J=e.y-ne,d(Bt,{left:(ee>un?R:p(R,0,un-ee))+_e,top:(I>sn?J:p(J,0,sn-I))+_e})):fn===r&&(e=Xe(Bt,t),G=Ke(r),d(Bt,{width:e.x+G.w/4+_e,height:e.y+G.h/4+_e}))}function vn(){fn=0}function mn(e,t,n){return{header:e,body:t,footer:n}}function wn(e){D=Rt,H=St,N=e&&e.target||0,(!N||N!==D&&Ze(N,D)!==D)&&(Rt=0,yt(St),Pe(de,u,wn),Pe(be,f,wn),mt.exit(e.target===z))}function kn(t){function n(){e&&(q=Ke(e),d(Z,{width:q.w+_e,height:q.h+_e}))}return V=s.get(),ee="",-1===V.indexOf("</html>")&&(ee='<!DOCTYPE html><html dir="'+j.dir+'"><head><meta charset="utf-8"><style>'+j.css+"</style></head><body>"+V+"</body></html>"),Z=Ve("iframe",!1,{"class":kt+"-portal",src:"data:text/html,"+encodeURIComponent(ee)}),!at(Yt)&&V?mt.overlay(Z,1,function(){e=ot(Yt)[0],n(),Ie(be,f,n),je("enter.overlay.preview",[t,s,[V,ee],e])}):(Pe(be,f,n),pn()),Ae(t)}var D,H,N,S,I,P,W,F,R,U,X,e,q,Z,G,J,V,ee,te,ne,t="⌘",n="…",i="⇥",o="⇧",f=window,u=document,s=this,l=s._,a=l.x,c=l.extend,d=l.css,p=l.edge,h=l.pattern,b=l.trim,g=l.timer.set,y=l.timer.reset,v=s.is,m=v.e,w=v.f,x=v.i,k=v.o,E=v.r,T=v.s,$=function(e){return!v.x(e)},L=u.documentElement,C=(u.head,u.body),z=s.target,M={},O=function(){},j=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},labels:{},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:500},e),ie="keydown",oe="keyup",fe="copy",ue="cut",se="paste",le="touchstart mousedown",ae="touchend mouseup",ce="touchmove mousemove",de="click",pe="focus",he="blur",be="orientationchange resize",ge=he+" "+fe+" "+ue+" "+pe+" input "+ie+" "+se,ye=j.languages,ve=j.tab,me=j.auto_tab,we=j.auto_close,xe=j.unit[0][0],Ee=(j.unit[0][1],j.unit[1][0]),Te=j.unit[1][1],$e="tool-id",Le="javascript:;",_e="px",mt=s.ui={};s.tidy=function(e,t){var n=s.$(),r=b(n.before)?e:"",i=b(n.after)?$(t)?t:e:"";return s.trim(r,i)},s.i=function(){return b(s.replace(/\s+/g," "))},s.format=function(e,t,n,r){k(e)||(e=[e]),$(n)||(n=" "),$(r)||(r="");var i=s.$(),o=(e[0]?xe[0]+e[0]+xe[1]:"")+r,f=r+(e[0]?xe[0]+xe[2]+(e[1]||e[0].split(h("("+Te[3]+")+"))[0])+xe[1]:""),u=a(o),l=a(f),c=h("^"+u+"([\\s\\S]*?)"+l+"$"),d=h(u+"$"),p=h("^"+l),b=i.before,g=i.after;return i.length?n=!1:s.insert(ye.placeholders[""]).loss(),s.toggle(t?!c.test(i.value):!d.test(b)&&!p.test(g),[function(e){e.unwrap(o,f,1).tidy(h(Ee[0]+"[^"+Ee[0]+Ee[1]+Ee[2]+"]+?"+Ee[1]+"$").test(b)?"":n,h("^"+Ee[0]+Ee[2]+"[^"+Ee[0]+Ee[1]+"]+?"+Ee[1]).test(g)?"":n).loss().wrap(o,f,t)},function(e){e.unwrap(o,f,t)}])};var Ut,wt=j.classes,xt=wt.i,kt=wt[""],Et=ye.tools,Tt=ye.buttons,$t=ye.labels,Lt=ye.others,_t=kt+"-textarea "+kt+"-content block",Ct=vt(kt),zt=vt(kt+"-header"),Mt=vt(kt+"-body"),Ot=vt(kt+"-footer"),jt=vt(kt+"-tool"),Dt=Ve(z,!1,j.attributes),Ht=vt(kt+"-resize s"),Nt=vt(kt+"-description"),Yt=vt(kt+"-overlay"),Bt=Ve("div"),St=Ve("div"),At=Ve("div"),It=vt("left","span"),Pt=vt("right","span"),Wt=vt(kt+"-preview","a"),Ft=0,Rt=0;j.suffix||(j.suffix=xe[1]);var Vt={},en=null;s.create=function(e,t){k(e)&&(j=c(j,e));var n=at(Dt);return Ge(Dt,_t),n&&st(n,"p")?(ct(n,Ct),Ft=n,gt(n,!1)):ct(Dt,Ct),Ct.dir=j.dir,bt(Ct,zt),bt(Ct,Mt),bt(Ct,Ot),bt(Ct,Ht),bt(Mt,Dt),j.tools&&(bt(zt,jt),bt(Ot,Nt),bt(Nt,It),bt(Nt,Pt)),Ie(ie,Dt,tn),Ie(oe,Dt,nn),Ie(ge,Dt,rn),Ie(le,Ht,an),Ie(ce,u,cn),Ie(ae,C,dn),Lt.preview&&(G=Et.preview,De(Wt,{href:Le,title:k(G)?G[0]+(G[1]?" ("+G[1]+")":""):G}),bt(It,Wt),tt(Wt,Lt.preview)),Qt(null),Gt(),Jt(),0!==t?je("create",[s]):s},s.update=function(e,t){return Je(Dt,Ce(_t),0)&&s.destroy(0),(0!==t?je("update",[s]):s).create(e,0)},s.destroy=function(e){return Je(Dt,Ce(_t),0)?(mt.exit(0,0,0),Qe(Dt,_t),j.tools=ze(j.tools),j.keys&&(Pe(ie,Dt,tn),Pe(oe,Dt,nn)),Pe(le,Ht,an),Pe(ce,u,cn),Pe(ae,u,dn),Pe(ge,Dt,rn),Ft?(ct(Ct,Ft),bt(Ft,Dt),Ft=0):ct(Ct,Dt),yt(Ct),0!==e?je("destroy",[s]):s):s};var fn=0,te=0,ne=0,ee=0,I=0,un=0,sn=0,ln={};mt.exit=function(e,t,n){if(S={overlay:function(){Pe(de,Yt,pn),yt(Yt)},modal:function(){Pe(le,Mt,gn),Pe(ce,Mt,yn),Pe(ae,u,vn),Pe(de,ln.x,bn),yt(Bt)},drop:function(){yt(St)},bubble:function(){yt(At)}},t)if(k(t))for(P in t)P=t[P],S[P]&&S[P](),0!==n&&je("exit."+P,[s]);else S[t]&&S[t](),0!==n&&je("exit."+P,[s]);else for(P in S)S[P]();return e&&s.select(),0!==n&&je("exit",[s]),s},mt.overlay=function(e,t,n){return mt.exit(0,0,0),nn(1),bt(Mt,Ve(Yt,e.length||m(e)?vt(kt+"-overlay-content","div",e):"")),t&&Ie(de,Yt,pn),w(n)?n(Yt):Ve(Yt,n),je("enter.overlay",[s]),je("enter",[s]),s},mt.overlay.fit=function(){},mt.modal=function(){mt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=kt+"-modal";k(t)&&(t="default",n=e[0],r=e[1]),R=Ue(t),Ve(Bt,!1,{"class":i+" "+R}),$(n.body)&&(n.body=Ve("div",n.body,{"class":i+"-content "+R}));for(P in n)i[1]=P,ln[P]=vt(i+"-"+Re(P,i)+" "+R,0,n[P]);return ln.x=vt(kt+"-x "+R),ln.resize=vt(kt+"-resize se "+R),rt(Bt),bt(Mt,Ve(Bt,ln,{style:""})),mt.modal.fit(),dt(Bt,Yt),Ie(de,ln.x,bn),Ie(le,ln.header,Ae),Ie(le,ln.resize,Ae),Ie(le,Mt,gn),Ie(ce,Mt,yn),Ie(ae,u,vn),w(r)&&(ln.overlay=Yt,ln.modal=Bt,r(ln)),je("enter.modal."+t,[s]),je("enter.modal",[s]),je("enter",[s]),s},mt.modal.fit=function(e){return hn(),R=un/2-ee/2,J=sn/2-I/2,k(e)?(R=e[0],J=e[1]):(R=p(R,0),J=p(J,0)),d(Bt,{left:R+_e,top:J+_e,"min-width":ee+_e,"min-height":I+_e,visibility:"visible"}),je("fit.modal",[s]),je("fit",[s]),s};var xn={"class":kt+"-button",name:"y"};return mt.alert=function(e,t,n,r){var i=Ve("button",Tt.okay,xn),o="alert";return n=n||O,k(e)&&(o+=":"+e[0],e=e[1]||e[0]),Ie(de,i,function(e){return n(e,s),bn(e,o+".y"),Ae(e)}),Ie(ie,i,function(e){var t=e.TE.key;return t(/^(escape|enter)$/)?(We(de,i,[e]),Ae(e)):void 0}),mt.modal(o,mn(e,t,i),r),i.focus(),s},mt.confirm=function(e,t,n,r,i){function a(e){return w(n)&&n(e,s),bn(e,u+".y"),Ae(e)}function c(e){return w(r)&&r(e,s),bn(e,u+".n"),Ae(e)}var l,o=Ve("button",Tt.okay,xn),f=Ve("button",Tt.cancel,xn),u="confirm";return f.name="n",k(e)&&(u+=":"+e[0],e=e[1]||e[0]),Ie(de,o,a),Ie(de,f,c),Ie(ie,o,function(e){return l=e.TE.key,l("arrowright")?(f.focus(),Ae(e)):l("arrowleft")?Ae(e):l("enter")?(a(e),Ae(e)):l("escape")?(bn(e,u+".y"),Ae(e)):void 0}),Ie(ie,f,function(e){return l=e.TE.key,l("arrowright")?Ae(e):l("arrowleft")?(o.focus(),Ae(e)):l("enter")?(c(e),Ae(e)):l("escape")?(bn(e,u+".n"),Ae(e)):void 0}),mt.modal(u,mn(e,t,[o,f]),i),f.focus(),s},mt.prompt=function(e,t,n,r,i,o){function h(){l.focus(),"placeholder"in l&&l.select()}function g(e){return Ae(e)}function y(e){return d=l.value,!n||b(d)&&d!==t?(bn(e,a+".y"),Ae(e),r(e,s,d!==t?d:"",t)):(h(),g(e))}function v(e){return bn(e,a+".n"),Ae(e)}var d,p,f=Ve("button",Tt.okay,xn),u=Ve("button",Tt.cancel,xn),l=Ve("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":kt+"-input block"}),a="prompt",c=[];if(k(e)&&(a+=":"+e[0],e=e[1]||e[0]),w(i)&&(o=i,i=0),1===i)l=Ve("textarea",t,{placeholder:t.split("\n")[0],"class":kt+"-textarea block"});else if(2===i){for(P in t)c.push(Ve("option",t[P],{value:P,selected:P===n||null}));l=Ve("select",c,{"class":kt+"-select block"})}return r=r||O,l.name="data",u.name="n",Ie(ie,l,function(e){return p=e.TE.key,p("enter")?y(e):p("escape")||p("backspace")&&!this.value?v(e):p("arrowup")?g(e):p("arrowdown")?(f.focus(),Ae(e)):void 0}),Ie(ie,f,function(e){return p=e.TE.key,p("enter")?y(e):p("escape")?v(e):p("arrowup")?(l.focus(),Ae(e)):p("arrowright")?(u.focus(),Ae(e)):p(/^arrow(down|left)$/)?g(e):void 0}),Ie(ie,u,function(e){return p=e.TE.key,p(/^(enter|escape)$/)?v(e):p("arrowup")?(l.focus(),Ae(e)):p(/^arrow(right|down)$/)?g(e):p("arrowleft")?(f.focus(),Ae(e)):void 0}),Ie(de,f,y),Ie(de,u,v),mt.modal(a,mn(e,l,[f,u]),o),h(),s},mt.drop=function(){mt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),R=Ue(t),rt(St),bt(C,Ve(St,!1,{"class":kt+"-drop "+R})),w(n)?n(St):Ve(St,n),mt.drop.fit(),Ie(de,u,wn),Ie(be,f,wn),je("enter.drop."+t,[s]),je("enter.drop",[s]),s},mt.drop.fit=function(t){return D=Ke(L),H=Ke(St),R=D.w/2-H.w/2,J=D.h/2-H.h/2,!$(t)&&Rt&&(e=qe(Rt),R=e.l,J=e.t+Ke(Rt).h),k(t)?(R=t[0],J=t[1]):(R=p(R,0,Math.max(D.w,f.innerWidth)-H.w),J=p(J,0,Math.max(D.h,f.innerHeight)-H.h)),d(St,{left:R+_e,top:J+_e,visibility:"visible"}),je("fit.drop",[s]),je("fit",[s]),s},mt.menu=function(e,t,n,r){t=!k(t)&&n[t]&&n[t].text||t;var u,i='<span class="'+kt+'-current menu">%1</span>',o="",f=0;return t===!1?mt.tool(e,t):(k(t)&&(o=t[0],o="<"===o[0]?o:'<i class="'+Re(xt,[o])+'"></i>',t=$(t[1])?t[1]:0,t=t&&n[t]&&n[t].text||t,i=o+(0!==t?" "+i:"")),mt.tool(e,{i:o,text:t?Re(i,[t,o]):0,click:function(l){return mt.drop("menu menu-"+Ue(e),function(l){function a(e){return u=this,U=n[Be(u,$e)],U=T(U)?mt.tools[U]:U||{},X=nt(u),!qt(U)&&w(r=U.click)&&(r=r(e,s),t!==!1&&Rt&&(G=ot(Rt)[0]||Rt,st(G,"i")||tt(G,Re(i,[X,o])),k(U.text)&&(J=ot(G)[0])&&st(J,"i")&&(Qe(J),Ge(J,Re(xt,[U.text[0]])))),r===!1)?Ae(e):(s.select(),Ae(e))}function d(e){if(u=this,(F=e.TE.key)("escape"))return mt.exit(1),Ae(e);if(F("arrowdown")&&(R=ft(u))){for(;!st(R,"a")&&R;)R=ft(R);return R&&R.focus(),Ae(e)}if(F("arrowup")&&(R=ut(u))){for(;!st(R,"a")&&R;)R=ut(R);return R&&R.focus(),Ae(e)}}for(r in n)if(u=n[r],ee="%"===r[0],u=T(u)&&!ee?mt.tools[u]:u){u=Zt(u,r,mt.tools);var p={href:ee?null:Le,"class":kt+"-"+(ee?"label":"button")};ee?W=$t[e]&&$t[e][+r.slice(1)-1]||r:(p.data={},p.data[$e]=r,W=Et[r]||r),Z=u.text,Z=k(Z)?Z[1]||"":Z,W=k(W)?W[0]:W,G=Ve(ee?"span":"a",ee?"<span>"+(W||"%"+f)+"</span>":u.text||W,c(p,u.attributes||{})),!G.title&&(J=u.title)&&(G.title=k(J)?J[0]+(J[1]?" ("+J[1]+")":""):J),ee?De(G,{id:kt+"-label:"+f}):(qt(u)&&Ge(G,"x"),Ie(de,G,a),Ie(ie,G,d)),n[r]=u,bt(l,G),++f}g(function(){lt("a",l)[0].focus()},1)}),!1}},r),mt.tools[e].data=n,s)},mt.bubble=function(){mt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),R=Ue(t),rt(At),bt(C,Ve(At,!1,{"class":kt+"-bubble "+R})),w(n)?n(At):Ve(At,n),mt.bubble.fit(),je("enter.bubble."+t,[s]),je("enter.bubble",[s]),s},mt.bubble.fit=function(t){G=s.$(1),e=qe(Dt),I=d(Dt,"line-height");var n="border-",r="-width";R=G.caret[0].x+e.l-Dt.scrollLeft,J=G.caret[1].y+e.t+I-Dt.scrollTop,H=d(Mt,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Ke(Mt),o=Ke(At),f=H[0]+H[1],u=H[2]+H[3];return k(t)?(R=t[0],J=t[1]):(R=p(R,e.l,e.l+i.w-o.w-u),J=p(J,e.t,e.t+i.h-o.h-f)),d(At,{left:R+_e,top:J+_e,visibility:"visible"}),je("fit.bubble",[s]),je("fit",[s]),s},mt.overlay.exit=function(e){return mt.exit(e,"overlay")},mt.modal.exit=function(e){return mt.exit(e,"modal")},mt.drop.exit=function(e){return mt.exit(e,"drop")},mt.bubble.exit=function(e){return mt.exit(e,"bubble")},mt.tool=function(e,t,n){return W="","|"!==e&&(j.tools=j.tools.filter(function(t,n){return t===e?(W=n,!1):!0})),t===!1?delete mt.tools[e]:("|"===e?(n=t,t={}):(w(t)&&(t={click:t}),mt.tools[e]=c(mt.tools[e]||{},t),$(n)||""===W||(n=W)),x(n)?j.tools.splice(n,0,e):j.tools.push(e)),Gt(),s},mt.key=function(e,t){return j.keys?(t===!1?delete mt.keys[e]:mt.keys[e]=t,Jt(),s):s},mt.tools={"|":{},undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ve),!1},outdent:function(e,t){return t.outdent(ve),!1}},Ie(de,Wt,kn),mt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return kn(e)},"shift+tab":me?"outdent":0,tab:me?"indent":0,escape:function(e,t){return Wt.focus(),!1}},mt.el={container:Ct,header:zt,body:Mt,footer:Ot,overlay:Yt,modal:Bt,drop:St,bubble:At},s.config=j,c(s._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),u=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>f&&(f="0"+f),10>u&&(u="0"+u),[""+t,""+n,""+r,""+i,""+o,""+f,""+u]},replace:Fe,format:Re,dom:{set:bt,reset:gt,get:lt,id:et,copy:function(e,t){return e.cloneNode($(t)?t:!0)},classes:{set:Ge,reset:Qe,get:Je},attributes:{set:De,reset:Ne,get:He},data:{set:Ye,reset:Se,get:Be},is:st,offset:qe,point:Xe,size:Ke,content:{set:tt,reset:rt,get:nt},closest:Ze,parent:it,children:ot,next:ft,previous:ut,before:ct,after:dt,prepend:pt,append:ht},el:Ve,event:{set:Ie,reset:Pe,fire:We,x:Ae},hooks:M,hook:{set:Me,reset:Oe,fire:je}}),mt};