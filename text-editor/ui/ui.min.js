/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function Le(e){return k(e)?b(e).split(/\s+/):e}function ze(e){return w(e)?e.join(" "):e}function Ce(e,t,n){return E(e)?E(t)?(E(z[e])||(z[e]={}),E(n)||(n=Object.keys(z[e]).length),z[e][n]=t,l):z[e]:z}function Oe(e,t){return E(e)?E(t)&&E(z[e])?(delete z[e][t],l):(z[e]={},l):(z={},l)}function Se(e,t,n){if(!E(z[e]))return z[e]={},l;if(E(n))E(z[e][n])&&z[e][n].apply(l,t);else for(var r in z[e])z[e][r].apply(l,t);return l}function je(e,t,n){if(w(t))for(P in t)je(e,P,t[P]);else e.setAttribute(t,n)}function De(t,n,r){if(k(n))return De(t,[n],E(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=t.getAttribute(P))&&e.push(P);return e.length?e:E(r)?r:[]}function Me(e,t){if(w(t))for(P in t)Me(e,t[P]);else e.removeAttribute(t)}function Ye(e,t,n){if(w(t))for(P in t)Ye(e,P,t[P]);else je(e,"data-"+t,n)}function Be(t,n,r){if(k(n))return Be(t,[n],E(r)?r:"")[0];e=[];for(P in n)P=n[P],(P=De(t,"data-"+P))&&e.push(P);return e.length?e:E(r)?r:[]}function He(e,t){if(w(t))for(P in t)Me(e,"data-"+t[P]);else Me(e,"data-"+t)}function Ne(e){return e&&e.preventDefault(),!1}function Pe(e,t,n){if(t){for(e=Le(e),P=0,A=e.length;A>P;++P)t.addEventListener(e[P],n,!1),Ce("on:"+e[P],n,tt(t));return l}}function Ae(e,t,n){if(t){for(e=Le(e),P=0,A=e.length;A>P;++P)t.removeEventListener(e[P],n,!1),Oe("on:"+e[P],tt(t));return g(t)&&t.id.split(":")[0]===xt+"-dom"&&Me(t,"id"),l}}function Ie(e,t,n){e=Le(e);var i,r="createEvent"in u;for(P=0,A=e.length;A>P;++P)r?(i=u.createEvent("HTMLEvents"),i.data=n,i.initEvent(e[P],!0,!1),t.dispatchEvent(i)):Se("on:"+e[P],n,tt(t));return l}function Fe(e,t){return setTimeout(e,t)}function We(e){return clearTimeout(e)}function Re(e,t,n){for(P=0,A=t.length,I;A>P;++P)I=t[P],e=e.replace(x(I)?I:h(a(I),"g"),n&&n[P]||"");return e}function Ue(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,E(t[n])?t[n]:e})}function Xe(e){return b(Re(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function qe(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,i=Ke(e);return{x:n-i.l,y:r-i.t}}function Ke(e){for(F=e.offsetLeft,Z=e.offsetTop;e=e.offsetParent;)F+=e.offsetLeft,Z+=e.offsetTop;return{l:F,t:Z}}function Ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Ge(e,t){for(;(e=ot(e))&&e!==t;);return e}function Je(e,t){t=Le(t);for(P in t)e.classList.add(t[P])}function Qe(t,n,r){if(k(n))return Qe(t,[n],E(r)?r:"")[0];e=[];for(P in n)P=n[P],t.classList.contains(P)&&e.push(P);return e.length?e:E(r)?r:!1}function Ve(e,t){t=Le(t);for(P in t)e.classList.remove(t[P])}function et(e,t,n){if(e=k(e)?u.createElement(e):e,w(n))for(P in n)if(J=n[P],"class"===P)Je(e,J);else if("data"===P)for(A in J)J=J[A],null===J?He(e,A):Ye(e,A,J);else"style"===P?k(J)?je(e,P,J):null===J?Me(e,P):d(e,J):y(J)?e[P]=J:null===J?Me(e,P):je(e,P,w(J)?J.join(" "):""+J);if(g(t))bt(e,t);else if(w(t))for(P in t)J=t[P],g(J)?bt(e,J):J!==!1&&nt(e,J);else E(t)&&t!==!1&&nt(e,t);return e}function tt(e){var t=e.id;return t||(t=xt+"-dom:"+Date.now(),e.id=t),t}function nt(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(E(t)?t:"")}function it(e,t){if(t!==!1&&(D=ft(e)))for(P=0,A=D.length;A>P;++P)it(D[P]);nt(e,"")}function ot(e){return e.parentElement||e.parentNode}function ft(e){return e.children||[]}function ut(e){return e.nextElementSibling||e.nextSibling}function lt(e){return e.previousElementSibling||e.previousSibling}function st(t,n){if(n=n||u,e=[],k(t)){if(/^([#.]?[\w-]+|\*)$/.test(t)){if("#"===t[0]&&(t=n.getElementById(t.slice(1))))return[t];if("."===t[0]&&(t=n.getElementsByClassName(t.slice(1)))||(t=n.getElementsByTagName(t))){for(P=0,A=t.length;A>P;++P)e.push(t[P]);return e}return[]}for(t=n.querySelectorAll(t),P=0,A=t.length;A>P;++P)e.push(t[P]);return e}return at(t)?[t]:[]}function at(e,t){var n=ot(e);return 1===arguments.length?n||!1:e&&n===e?n:!1}function ct(e,t){ot(e).insertBefore(t,e)}function dt(e,t){ot(e).insertBefore(t,ut(e))}function pt(e,t){D=ft(e)[0],D?ct(D,t):bt(e,t)}function ht(e,t){bt(e,t)}function bt(e,t){e.appendChild(t)}function vt(e,t){var n=at(e);if(n){if(t!==!1)for(D=ft(e)[0];D;)vt(D);n.removeChild(e)}}function gt(e){it(et(e,!1,{style:""})),vt(e)}function yt(e,t,n){return et(t||"div",n,{"class":e})}function Ut(){Tt._word&&Tt._words&&(J=(St.value||"").replace(h(ke[0]+"[^"+ke[0]+ke[1]+"]+?"+ke[1],"g"),""),P=(J.match(/(\w+)/g)||[]).length,nt(Pt,Ue(Tt["_word"+(1===P?"":"s")],[P])))}function Xt(e,t){y(e)&&(e.click=e),k(e.click)&&(e.click=(mt.tools[e.click]||{}).click),E(e.active)||(e.active=1),E(e.title)||(e.title=kt[t]||"")}function qt(){it(Ot,!1);var r,i,o,f,u,e=Le(O.tools),t=xt+"-button",n=xt+"-separator";O.tools=e;for(P in e)u=e[P],i=mt.tools[u],i&&(Xt(i,u),"|"!==(o=i.i||u)&&(o=Xe(o)),f="|"!==o,Wt=yt(f?t:n,f?"a":"span"),f&&(r=t+":"+Xe(u).replace(/\s/g,""),je(Wt,{href:$e,id:r,"tab-index":-1}),Ye(Wt,Te,u),o='<i class="'+Ue(wt.i,[o])+" "+r+'"></i>',i.active||Je(Wt,"x"),i.text&&(o=Ue('<span class="'+xt+'-text">'+i.text+"</span>",[o]),Je(Wt,"text")),nt(Wt,o),et(Wt,!1,i.attributes||{}),!Wt.title&&(A=i.title)&&(Wt.title=w(A)?A[0]+(A[1]?" ("+A[1]+")":""):A),Pe(ae,Wt,tn)),bt(Ot,Wt));Se("update.tools",[l])}function Kt(){mt.keys=function(){var n,e=Object.keys(mt.keys).sort().reverse(),t={};for(P=0,A=e.length;A>P;++P)n=e[P],t[n]=mt.keys[n];return t}(),Vt(1),Se("update.keys",[l])}function Zt(e){Ut(),Se("on:change",[e,l])}function Qt(t){function p(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var n=l.$(),r=n.before,i=n.after,o=r.slice(-1),f=i[0],u=n.length,s=mt.keys,c=TE.keys_alias,d=(r.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop();R=t.TE.key(),Gt[R]=1,e=Object.keys(Gt).length,Fe(function(){l.record()},1);for(P in s){I=p(P),D=0;for(A in I)A=I[A],Gt[c[A]||A]&&++D;if(I=I.length,D===I&&e===I&&(k(s[P])&&(s[P]=mt.tools[s[P]].click),F=s[P]&&s[P](t,l),F===!1))return Ne(t)}if(me)for(P in me)if(W=me[P],W!==!1){if(R===W&&f===W)return"\\"===o?(l.insert(R,0),Ne(t)):(l.select(n.end+1),Ne(t));if(P===R)return l.wrap(P,W),Ne(t);if(o===P&&f===W){if("backspace"===R&&r.slice(-2)!=="\\"+P)return l.unwrap(P,W),Ne(t);if(ye&&"enter"===R&&P!==W)return l.tidy("\n"+d+ge,"\n"+d).scroll(!0),Ne(t)}}if(ye&&!u){if("backspace"===R&&h(a(ge)+"$").test(r))return l.outdent(ge).scroll(!0),Ne(t);if("enter"===R&&h("(^|\\n)("+a(ge)+")+.*$").test(r))return l.insert("\n"+d,0,1).scroll(!0),Ne(t)}}function Vt(e){w(e)?delete Gt[e.TE.key()]:Gt={}}function en(e){/^focus|blur$/.test(e.type)&&Vt(1),We(Jt),Jt=Fe(function(){Zt(e)},O.debounce||0)}function tn(e){mt.exit(0,0,0);var t=Be(this,Te),n=mt.tools,r=n[t];return Ft=e.currentTarget||e.target,r&&r.active&&r.click&&(A=n[t].click(e,l,t),Se("on:change",[e,l,t]),A===!1)?Ne(e):(l.select(),Ne(e))}function un(e){return nn=jt,K=Ze(Ct),Ne(e)}function ln(e){nn===jt&&d(St,{height:qe(zt,e).y-K.h+_e})}function sn(){nn=0}function an(){mt.exit(1)}function cn(){e=Ze(Yt),Q=e.w,N=e.h,e=Ze(Mt),rn=e.w,on=e.h}function dn(e,t){t&&Se("exit.modal."+t,[l]),Ie(ae,Mt,[e])}function pn(t){nn=t.target,e=qe(Yt,t),V=e.x,ee=e.y,cn()}function hn(t){var n=fn.header,r=fn.resize;nn===n||Ge(nn,n)===n?(e=qe(zt,t),F=e.x-V,Z=e.y-ee,d(Yt,{left:(Q>rn?F:p(F,0,rn-Q))+_e,top:(N>on?Z:p(Z,0,on-N))+_e})):nn===r&&(e=qe(Yt,t),K=Ze(r),d(Yt,{width:e.x+K.w/4+_e,height:e.y+K.h/4+_e}))}function bn(){nn=0}function vn(e,t,n){return{header:e,body:t,footer:n}}function gn(e){S=Ft,j=Bt,D=e&&e.target||0,(!D||D!==S&&Ge(D,S)!==S)&&(Ft=0,gt(Bt),Ae(ae,_,gn),mt.exit(e.target===L))}function mn(t){function n(){e&&(U=Ze(e),d(q,{width:U.w+_e,height:U.h+_e}))}return J=l.get(),Q="",-1===J.indexOf("</html>")&&(Q='<!DOCTYPE html><html dir="'+O.dir+'"><head><meta charset="utf-8"><style>'+O.css+"</style></head><body>"+J+"</body></html>"),q=et("iframe",!1,{"class":xt+"-portal",src:"data:text/html,"+encodeURIComponent(Q)}),!at(Mt)&&J?mt.overlay(q,1,function(){e=ft(Mt)[0],n(),Pe(he,f,n),Se("enter.overlay.preview",[t,l,[J,Q],e])}):(Ae(he,f,n),an()),Ne(t)}var S,j,D,B,N,P,A,I,F,W,R,e,U,q,K,Z,J,Q,V,ee,t="⌘",n="…",i="⇥",o="⇧",f=window,u=document,l=this,s=l._,a=s.x,c=s.extend,d=s.css,p=s.edge,h=s.pattern,b=s.trim,v=l.is,g=v.e,y=v.f,m=v.i,w=v.o,x=v.r,k=v.s,E=function(e){return!v.x(e)},T=u.documentElement,_=(u.head,u.body),L=l.target,z={},C=function(){},O=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",i],outdent:["Outdent",o+"+"+i],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+n},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),ne="keydown",re="keyup",ie="copy",oe="cut",fe="paste",ue="touchstart mousedown",le="touchend mouseup",se="touchmove mousemove",ae="click",ce="focus",de="blur",pe="input",he="orientationchange resize",be=de+" "+ie+" "+oe+" "+ce+" "+pe+" "+ne+" "+fe,ve=O.languages,ge=O.tab,ye=O.auto_tab,me=O.auto_close,we=O.unit[0][0],ke=(O.unit[0][1],O.unit[1][0]),Ee=O.unit[1][1],Te="tool-id",$e="javascript:;",_e="px",mt=l.ui={};l.tidy=function(e,t){var n=l.$(),r=b(n.before)?e:"",i=b(n.after)?E(t)?t:e:"";return l.trim(r,i)},l.i=function(){return b(l.replace(/\s+/g," "))},l.format=function(e,t,n,r){w(e)||(e=[e]),E(n)||(n=" "),E(r)||(r="");var i=l[0]().$(),o=(e[0]?we[0]+e[0]+we[1]:"")+r,f=r+(e[0]?we[0]+we[2]+(e[1]||e[0].split(h("("+Ee[3]+")+"))[0])+we[1]:""),u=a(o),s=a(f),c=h("^"+u+"([\\s\\S]*?)"+s+"$"),d=h(u+"$"),p=h("^"+s),b=i.before,v=i.after;return i.length?n=!1:l.insert(ve.placeholders[""]),l.toggle(t?!c.test(i.value):!d.test(b)&&!p.test(v),[function(e){e.unwrap(o,f,1).tidy(h(ke[0]+"[^"+ke[0]+ke[1]+ke[2]+"]+?"+ke[1]+"$").test(b)?"":n,h("^"+ke[0]+ke[2]+"[^"+ke[0]+ke[1]+"]+?"+ke[1]).test(v)?"":n).wrap(o,f,t)[1]()},function(e){e.unwrap(o,f,t)[1]()}])};var Wt,wt=O.classes,xt=wt[""],kt=ve.tools,Et=ve.buttons,Tt=ve.others,$t=xt+"-textarea "+xt+"-content block",_t=yt(xt),Lt=yt(xt+"-header"),zt=yt(xt+"-body"),Ct=yt(xt+"-footer"),Ot=yt(xt+"-tool"),St=et(L,!1,O.attributes),jt=yt(xt+"-resize s"),Dt=yt(xt+"-description"),Mt=yt(xt+"-overlay"),Yt=et("div"),Bt=et("div"),Ht=et("div"),Nt=yt("left","span"),Pt=yt("right","span"),At=yt(xt+"-preview","a"),It=0,Ft=0;O.suffix||(O.suffix=we[1]);var Gt={},Jt=null;l.create=function(e,t){w(e)&&(O=c(O,e));var n=at(St);return Je(St,$t),n&&"P"===n.nodeName?(ct(n,_t),It=n,vt(n,!1)):ct(St,_t),_t.dir=O.dir,bt(_t,Lt),bt(_t,zt),bt(_t,Ct),bt(_t,jt),bt(zt,St),O.tools&&(bt(Lt,Ot),bt(Ct,Dt),bt(Dt,Nt),bt(Dt,Pt)),Pe(ne,St,Qt),Pe(re,St,Vt),Pe(be,St,en),Pe(ue,jt,un),Pe(se,_,ln),Pe(le,_,sn),Tt.preview&&(K=kt.preview,je(At,{href:$e,title:w(K)?K[0]+(K[1]?" ("+K[1]+")":""):K}),bt(Nt,At),nt(At,Tt.preview)),Zt(null),qt(),Kt(),0!==t?Se("create",[l]):l},l.update=function(e,t){return Qe(St,Le($t),0)&&l.destroy(0),(0!==t?Se("update",[l]):l).create(e,0)},l.destroy=function(e){return Qe(St,Le($t),0)?(mt.exit(0,0,0),Ve(St,$t),O.tools=ze(O.tools),O.keys&&(Ae(ne,St,Qt),Ae(re,St,Vt)),Ae(ue,jt,un),Ae(se,_,ln),Ae(le,_,sn),Ae(be,St,en),It?(ct(_t,It),bt(It,St),It=0):ct(_t,St),gt(_t),0!==e?Se("destroy",[l]):l):l};var nn=0,V=0,ee=0,Q=0,N=0,rn=0,on=0,fn={};mt.exit=function(e,t,n){if(B={overlay:function(){Ae(ae,Mt,an),gt(Mt)},modal:function(){Ae(ue,zt,pn),Ae(se,zt,hn),Ae(le,_,bn),Ae(ae,fn.x,dn),gt(Yt)},drop:function(){gt(Bt)},bubble:function(){gt(Ht)}},t)if(w(t))for(P in t)P=t[P],B[P]&&B[P](),0!==n&&Se("exit."+P,[l]);else B[t]&&B[t](),0!==n&&Se("exit."+P,[l]);else for(P in B)B[P]();return e&&l.select(),0!==n&&Se("exit",[l]),l},mt.overlay=function(e,t,n){return mt.exit(0,0,0),Vt(1),bt(zt,et(Mt,e.length||g(e)?yt(xt+"-overlay-content","div",e):"")),t&&Pe(ae,Mt,an),y(n)?n(Mt):et(Mt,n),Se("enter.overlay",[l]),Se("enter",[l]),l},mt.overlay.fit=function(){},mt.modal=function(){mt.overlay("",1).blur();var e=arguments,t=e[0],n=e[1],r=e[2],i=xt+"-modal";w(t)&&(t="default",n=e[0],r=e[1]),F=Xe(t),et(Yt,!1,{"class":i+" "+F}),E(n.body)&&(n.body=et("div",n.body,{"class":i+"-content "+F}));for(P in n)i[1]=P,fn[P]=yt(i+"-"+Ue(P,i)+" "+F,0,n[P]);return fn.x=yt(xt+"-x "+F),fn.resize=yt(xt+"-resize se "+F),it(Yt),bt(zt,et(Yt,fn,{style:""})),mt.modal.fit(),dt(Yt,Mt),Pe(ae,fn.x,dn),Pe(ue,fn.header,Ne),Pe(ue,fn.resize,Ne),Pe(ue,zt,pn),Pe(se,zt,hn),Pe(le,_,bn),y(r)&&(fn.overlay=Mt,fn.modal=Yt,r(fn)),Se("enter.modal."+t,[l]),Se("enter.modal",[l]),Se("enter",[l]),l},mt.modal.fit=function(e){return cn(),F=rn/2-Q/2,Z=on/2-N/2,w(e)?(F=e[0],Z=e[1]):(F=p(F,0),Z=p(Z,0)),d(Yt,{left:F+_e,top:Z+_e,"min-width":Q+_e,"min-height":N+_e,visibility:"visible"}),Se("fit.modal",[l]),Se("fit",[l]),l};var yn={"class":xt+"-button",name:"y"};return mt.alert=function(e,t,n,r){var i=et("button",Et.okay,yn),o="alert";return n=n||C,w(e)&&(o+=":"+e[0],e=e[1]||e[0]),Pe(ae,i,function(e){return n(e,l),dn(e,o+".y"),Ne(e)}),Pe(ne,i,function(e){var t=e.TE.key;return t(/^escape|enter$/)?Ie(ae,i,[e,l]):void 0}),mt.modal(o,vn(e,t,i),r),i.focus(),l},mt.confirm=function(e,t,n,r,i){function a(e){return y(n)&&n(e,l),dn(e,u+".y"),Ne(e)}function c(e){return y(r)&&r(e,l),dn(e,u+".n"),Ne(e)}var s,o=et("button",Et.okay,yn),f=et("button",Et.cancel,yn),u="confirm";return f.name="n",w(e)&&(u+=":"+e[0],e=e[1]||e[0]),Pe(ae,o,a),Pe(ae,f,c),Pe(ne,o,function(e){return s=e.TE.key,s("arrowright")?(f.focus(),Ne(e)):s("arrowleft")?Ne(e):s("enter")?(a(e),Ne(e)):s("escape")?(dn(e,u+".y"),Ne(e)):void 0}),Pe(ne,f,function(e){return s=e.TE.key,s("arrowright")?Ne(e):s("arrowleft")?(o.focus(),Ne(e)):s("enter")?(c(e),Ne(e)):s("escape")?(dn(e,u+".n"),Ne(e)):void 0}),mt.modal(u,vn(e,t,[o,f]),i),f.focus(),l},mt.prompt=function(e,t,n,r,i,o){function p(){s.focus(),"placeholder"in s&&s.select()}function h(e){return Ne(e)}function v(e){return K=s.value,!n||b(K)&&K!==t?(dn(e,a+".y"),Ne(e),r(e,l,K!==t?K:"",t)):(p(),h(e))}function g(e){return dn(e,a+".n"),Ne(e)}var d,f=et("button",Et.okay,yn),u=et("button",Et.cancel,yn),s=et("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":xt+"-input block"}),a="prompt",c=[];if(w(e)&&(a+=":"+e[0],e=e[1]||e[0]),y(i)&&(o=i,i=0),1===i)s=et("textarea",t,{placeholder:t.split("\n")[0],"class":xt+"-textarea block"});else if(2===i){for(P in t)c.push(et("option",t[P],{value:P,selected:P===n||null}));s=et("select",c,{"class":xt+"-select block"})}return r=r||C,s.name="data",u.name="n",Pe(ne,s,function(e){return d=e.TE.key,d("enter")?v(e):d("escape")||d("backspace")&&!this.value?g(e):d("arrowup")?h(e):d("arrowdown")?(f.focus(),Ne(e)):void 0}),Pe(ne,f,function(e){return d=e.TE.key,d("enter")?v(e):d("escape")?g(e):d("arrowup")?(s.focus(),Ne(e)):d("arrowright")?(u.focus(),Ne(e)):d(/^arrow(down|left)$/)?h(e):void 0}),Pe(ne,u,function(e){return d=e.TE.key,d(/^enter|escape$/)?g(e):d("arrowup")?(s.focus(),Ne(e)):d(/^arrow(right|down)$/)?h(e):d("arrowleft")?(f.focus(),Ne(e)):void 0}),Pe(ae,f,v),Pe(ae,u,g),mt.modal(a,vn(e,s,[f,u]),o),p(),l},mt.drop=function(){mt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),F=Xe(t),it(Bt),bt(_,et(Bt,!1,{"class":xt+"-drop "+F})),y(n)?n(Bt):et(Bt,n),mt.drop.fit(),Pe(ae,_,gn),Se("enter.drop."+t,[l]),Se("enter.drop",[l]),l},mt.drop.fit=function(t){return S=Ze(T),j=Ze(Bt),F=S.w/2-j.w/2,Z=S.h/2-j.h/2,!E(t)&&Ft&&(e=Ke(Ft),F=e.l,Z=e.t+Ze(Ft).h),w(t)?(F=t[0],Z=t[1]):(F=p(F,0,S.w-j.w),Z=p(Z,0,S.h-j.h)),d(Bt,{left:F+_e,top:Z+_e,visibility:"visible"}),Se("fit.drop",[l]),Se("fit",[l]),l},mt.menu=function(e,t,n,r){var i='<span class="'+xt+'-current menu">%1</span>',o="";return t===!1?mt.tool(e,t):(w(t)&&(o=t[0],t=t[1],i='<i class="'+Ue(wt.i,[o])+'"></i> '+i),mt.tool(e,{i:o,text:Ue(i,[n[t]&&n[t].text||t,o]),click:function(t){var u,f={href:$e,"class":xt+"-button"};return mt.drop("menu menu-"+Xe(e),function(e){function t(e){return u=this,W=n[Be(u,Te)],N=rt(u),W&&W.active&&y(r=W.click)&&(r=r(e,l),Ft&&nt(ft(Ft)[0]||Ft,Ue(i,[N,o])),r===!1)?Ne(e):(l.select(),Ne(e))}for(r in n)u=n[r],u=k(u)?mt.tools[u]:u,u&&(Xt(u,r),f["data-"+Te]=r,K=et("a",u.text||r,c(f,u.attributes||{})),!K.title&&(Z=u.title)&&(Z.title=w(Z)?Z[0]+(Z[1]?" ("+Z[1]+")":""):Z),u.active||Je(K,"x"),n[r]=u,Pe(ae,K,t),bt(e,K))}),!1}},r),l)},mt.bubble=function(){mt.exit(0,0,0);var e=arguments,t=e[0],n=e[1];return 1===e.length&&(t="default",n=e[0]),F=Xe(t),it(Ht),bt(_,et(Ht,!1,{"class":xt+"-bubble "+F})),y(n)?n(Ht):et(Ht,n),mt.bubble.fit(),Se("enter.bubble."+t,[l]),Se("enter.bubble",[l]),l},mt.bubble.fit=function(t){K=l.$(1),e=Ke(St),N=d(St,"line-height");var n="border-",r="-width";F=K.caret[0].x+e.l-St.scrollLeft,Z=K.caret[1].y+e.t+N-St.scrollTop,j=d(zt,[n+"top"+r,n+"bottom"+r,n+"left"+r,n+"right"+r]);var i=Ze(zt),o=Ze(Ht),f=j[0]+j[1],u=j[2]+j[3];return w(t)?(F=t[0],Z=t[1]):(F=p(F,e.l,e.l+i.w-o.w-u),Z=p(Z,e.t,e.t+i.h-o.h-f)),d(Ht,{left:F+_e,top:Z+_e,visibility:"visible"}),Se("fit.bubble",[l]),Se("fit",[l]),l},mt.overlay.exit=function(e){return mt.exit(e,"overlay")},mt.modal.exit=function(e){return mt.exit(e,"modal")},mt.drop.exit=function(e){return mt.exit(e,"drop")},mt.bubble.exit=function(e){return mt.exit(e,"bubble")},mt.tool=function(e,t,n){return A="","|"!==e&&(O.tools=O.tools.filter(function(t,n){return t===e?(A=n,!1):!0})),t===!1?delete mt.tools[e]:("|"===e?(n=t,t={}):(y(t)&&(t={click:t}),mt.tools[e]=c(mt.tools[e]||{},t),E(n)||""===A||(n=A)),m(n)?O.tools.splice(n,0,e):O.tools.push(e)),qt(),l},mt.key=function(e,t){return O.keys?(t===!1?delete mt.keys[e]:mt.keys[e]=t,Kt(),l):l},mt.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(ge),!1},outdent:function(e,t){return t.outdent(ge),!1}},Pe(ae,At,mn),mt.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return mn(e)},"shift+tab":ye?"outdent":0,tab:ye?"indent":0,escape:function(e,t){return At.focus(),!1}},mt.el={container:_t,header:Lt,body:zt,footer:Ct,overlay:Mt,modal:Yt,drop:Bt,bubble:Ht},l.config=O,c(l._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),u=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>i&&(i="0"+i),10>o&&(o="0"+o),10>f&&(f="0"+f),10>u&&(u="0"+u),[""+t,""+n,""+r,""+i,""+o,""+f,""+u]},replace:Re,format:Ue,dom:{set:bt,reset:vt,get:st,id:tt,classes:{set:Je,reset:Ve,get:Qe},attr:{set:je,reset:Me,get:De},data:{set:Ye,reset:He,get:Be},offset:Ke,point:qe,size:Ze,content:{set:nt,reset:it,get:rt},closest:Ge,parent:ot,children:ft,next:ut,previous:lt,before:ct,after:dt,prepend:pt,append:ht},el:et,event:{set:Pe,reset:Ae,fire:Ie,x:Ne},hooks:z,hook:{set:Ce,reset:Oe,fire:Se}}),mt};