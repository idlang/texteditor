/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.4.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.ui=function(e){function te(e,t,i){return E(e)?E(t)?(E(_[e])||(_[e]={}),E(i)||(i=Object.keys(_[e]).length),_[e][i]=t,s):_[e]:_}function ie(e,t){return E(e)?E(t)&&E(_[e])?(delete _[e][t],s):(_[e]={},s):(_={},s)}function ne(e,t,i){if(!E(_[e]))return _[e]={},s;if(E(i))E(_[e][i])&&_[e][i].apply(s,t);else for(var n in _[e])_[e][n].apply(s,t);return s}function re(e,t,i){if(x(t))for(var n in t)re(e,n,t[n]);else e.setAttribute(t,i)}function oe(e,t,i){return e.getAttribute(t)||(E(i)?i:!1)}function fe(e,t){if(x(t))for(var i in t)fe(e,t[i]);else e.removeAttribute(t)}function le(e,t,i){if(x(t))for(var n in t)re(e,"data-"+n,t[n]);else re(e,"data-"+t,i)}function se(e,t,i){return oe(e,"data-"+t,i)}function ue(e,t){if(x(t))for(var i in t)fe(e,"data-"+t[i]);else fe(e,"data-"+t)}function ae(e){return e&&e.preventDefault(),!1}function ce(e,t,i){return t?(t.addEventListener(e,i,!1),te("on:"+e,i,Ve(t)),s):void 0}function de(e,t,i){return t?(t.removeEventListener(e,i,!1),ie("on:"+e,Ve(t)),m(t)&&t.id.split(":")[0]===Se+"-dom"&&fe(t,"id"),s):void 0}function pe(e,t,i){if("createEvent"in l){var n=l.createEvent("HTMLEvents");n.data=i,n.initEvent(e,!0,!1),t.dispatchEvent(n)}else ne("on:"+e,i,Ve(t));return s}function ve(e,t,i){e=h(e).split(/\s+/);for(var n=0,r=e.length;r>n;++n)ce(e[n],t,i);return s}function he(e,t,i){e=h(e).split(/\s+/);for(var n=0,r=e.length;r>n;++n)de(e[n],t,i);return s}function be(e,t,i){e=h(e).split(/\s+/);for(var n=0,r=e.length;r>n;++n)pe(e[n],t,i);return s}function me(e,t){return setTimeout(e,t)}function ge(e){return clearTimeout(e)}function ye(e,t,i){for(var o,n=0,r=t.length;r>n;++n)o=t[n],e=e.replace(w(o)?o:v(a(o),"g"),i&&i[n]||"");return e}function xe(e,t){return e.replace(/%(\d+)/g,function(e,i){return--i,E(t[i])?t[i]:e})}function we(e){return h(ye(e,[/[^ \/a-z\d-]/g,/([ -])+/g,/^-|-$/g],["-","$1",""]))}function ke(e,t){var i=t.touches?t.touches[0].pageX:t.pageX,n=t.touches?t.touches[0].pageY:t.pageY,r=Ee(e);return{x:i-r.l,y:n-r.t}}function Ee(e){for(var t=e.offsetLeft,i=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,i+=e.offsetTop;return{l:t,t:i}}function ze(e){return{w:e.offsetWidth,h:e.offsetHeight}}function Te(e,t){for(;(e=ft(e))&&e!==t;);return e}function Qe(e,t,i){if(e=k(e)?l.createElement(e):e,x(i)){var n,r;for(r in i)n=i[r],"style"===r?k(n)?re(e,r,n):null===n?fe(e,r):e=d(e,n):g(n)?e[r]=n:null===n?fe(e,r):re(e,r,x(n)?n.join(" "):""+n)}if(m(t))bt(e,t);else if(x(t)){var n,r;for(r in t)n=t[r],m(n)?bt(e,n):n!==!1&&nt(e,n)}else E(t)&&t!==!1&&nt(e,t);return e}function Ve(e){var t=e.id;return t||(t=Se+"-dom:"+Date.now(),e.id=t),t}function et(e,t){tt(e,t)||(e.className=h(e.className+" "+t))}function tt(e,t,i){var n=e.className;return v("(^|\\s)"+t+"(\\s|$)").test(n)?n:E(i)?i:!1}function it(e,t){e.className=h(e.className.replace(v("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function nt(e,t){e.innerHTML=t}function rt(e,t){return e.innerHTML||(E(t)?t:"")}function ot(e,t){if(t!==!1){var n,i=e.children;for(n in i)ot(i[n])}nt(e,"")}function ft(e){return e.parentElement||e.parentNode}function lt(e){return e.children||[]}function st(e){return e.nextElementSibling||e.nextSibling}function ut(e){return e.previousElementSibling||e.previousSibling}function at(e,t){return(t||l).querySelectorAll(e)||[]}function ct(e,t){var i=ft(e);return 1===arguments.length?i||!1:e&&i===e?i:!1}function dt(e,t){ft(e).insertBefore(t,e)}function pt(e,t){ft(e).insertBefore(t,st(e))}function vt(e,t){var i=lt(e)[0];i?dt(i,t):bt(e,t)}function ht(e,t){bt(e,t)}function bt(e,t){e.appendChild(t)}function mt(e,t){var i=ct(e);if(i){if(t!==!1)for(var n=lt(e)[0];n;)mt(n);i.removeChild(e)}}function gt(e){ot(Qe(e,!1,{style:""})),mt(e)}function yt(e,t,i){return Qe(t||"div",i,{"class":e})}function xt(){if(Oe._word&&Oe._words){var e=(Fe.value||"").replace(v(J[0]+"[^"+J[0]+J[1]+"]+?"+J[1],"g"),""),t=(e.match(/(\w+)/g)||[]).length;nt(Ue,xe(Oe["_word"+(1===t?"":"s")],[t]))}}function wt(e,t){g(e)&&(e.click=e),k(e.click)&&(e.click=($e.tools[e.click]||{}).click),E(e.active)||(e.active=1),E(e.title)||(e.title=De[t]||"")}function kt(){ot(Ye,!1);var n,r,o,f,l,u,a,e=k(D.tools)?h(D.tools).split(/\s+/):D.tools,t=Se+"-button",i=Se+"-separator";D.tools=e;for(l in e)a=e[l],r=$e.tools[a],r&&(wt(r,a),"|"!==(o=r.i||a)&&(o=we(o)),f="|"!==o,Je=yt(f?t:i,f?"a":"span"),f&&(n=t+":"+we(a).replace(/\s/g,""),re(Je,{href:V,id:n,"tab-index":-1}),le(Je,Q,a),o='<i class="'+xe(_e.i,[o])+" "+n+'"></i>',r.active||et(Je,"x"),r.text&&(o=xe('<span class="'+Se+'-text">'+r.text+"</span>",[o]),et(Je,"text")),nt(Je,o),Qe(Je,!1,r.attributes||{}),!Je.title&&(u=r.title)&&(Je.title=x(u)?u[0]+(u[1]?" ("+u[1]+")":""):u),ve(F,Je,Lt)),bt(Ye,Je));ne("update.tools",[s])}function Et(){$e.keys=function(){var i,n,e=Object.keys($e.keys).sort().reverse(),t={};for(i=0,n=e.length;n>i;++i)t[e[i]]=$e.keys[e[i]];return t}(),St(1),ne("update.keys",[s])}function zt(e){xt(),ne("on:change",[e,s])}function _t(e){function x(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var d,p,h,b,m,y,t=s.$(),i=t.before,n=t.after,r=i.slice(-1),o=n[0],f=t.length,l=$e.keys,u=TE.keys_alias,c=(i.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),g=e.TE.key();Tt[g]=1,y=Object.keys(Tt).length,me(function(){s.record()},1);for(d in l){var w=0;h=x(d);for(p in h)p=h[p],Tt[u[p]||p]&&++w;if(h=h.length,w===h&&y===h&&(k(l[d])&&(l[d]=$e.tools[l[d]].click),b=l[d]&&l[d](e,s),b===!1))return ae(e)}if(X)for(d in X)if(m=X[d],m!==!1){if(g===m&&o===m)return"\\"===r?(s.insert(g,0),ae(e)):(s.select(t.end+1),ae(e));if(d===g)return s.wrap(d,m),ae(e);if(r===d&&o===m){if("backspace"===g&&i.slice(-2)!=="\\"+d)return s.unwrap(d,m),ae(e);if(U&&"enter"===g&&d!==m)return s.tidy("\n"+c+R,"\n"+c).scroll(!0),ae(e)}}if(U&&!f){if("backspace"===g&&v(a(R)+"$").test(i))return s.outdent(R).scroll(!0),ae(e);if("enter"===g&&v("(^|\\n)("+a(R)+")+.*$").test(i))return s.insert("\n"+c,0,1).scroll(!0),ae(e)}}function St(e){x(e)?delete Tt[e.TE.key()]:Tt={}}function Dt(e){/^focus|blur$/.test(e.type)&&St(1),ge($t),$t=me(function(){zt(e)},D.debounce||0)}function Lt(e){$e.exit(0,0,0);var r,t=se(this,Q),i=$e.tools,n=i[t];return Ze=e.currentTarget||e.target,n&&n.active&&n.click&&(r=i[t].click(e,s,t),ne("on:change",[e,s,t]),r===!1)?ae(e):(s.select(),ae(e))}function Wt(e){return Ot=Pe,Pt=ze(He),ae(e)}function At(e){Ot===Pe&&d(Fe,{height:ke(je,e).y-Pt.h+ee})}function It(){Ot=0}function qt(){$e.exit(1)}function Bt(){e=ze(Ie),Ct=e.w,jt=e.h,e=ze(Ae),Ht=e.w,Yt=e.h}function Rt(e,t){t&&ne("exit.modal."+t,[s]),be(F,Ae,[e])}function Ut(t){Ot=t.target,e=ke(Ie,t),Nt=e.x,Mt=e.y,Bt()}function Xt(t){var r,o,i=Ft.header,n=Ft.resize;Ot===i||Te(Ot,i)===i?(e=ke(je,t),r=e.x-Nt,o=e.y-Mt,d(Ie,{left:(Ct>Ht?r:p(r,0,Ht-Ct))+ee,top:(jt>Yt?o:p(o,0,Yt-jt))+ee})):Ot===n&&(e=ke(Ie,t),Pt=ze(n),d(Ie,{width:e.x+Pt.w/4+ee,height:e.y+Pt.h/4+ee}))}function Kt(){Ot=0}function Zt(e,t,i){return{header:e,body:t,footer:i}}function Jt(e){var t=Ze,n=e&&e.target||0;(!n||n!==t&&Te(n,t)!==t)&&(Ze=0,gt(qe),he(F,$,Jt),$e.exit(1))}function Qt(e){function l(){r&&(o=ze(r),d(n,{width:o.w+ee,height:o.h+ee}))}var n,r,o,t=s.get(),i="";return-1===t.indexOf("</html>")&&(i='<!DOCTYPE html><html dir="'+D.dir+'"><head><meta charset="utf-8"><style>'+D.css+"</style></head><body>"+t+"</body></html>"),n=Qe("iframe",!1,{"class":Se+"-portal",src:"data:text/html,"+encodeURIComponent(i)}),!ct(Ae)&&t?$e.overlay(n,1,function(){r=lt(Ae)[0],l(),ve(I,f,l),ne("enter.overlay.preview",[e,s,[t,i],r])}):(he(I,f,l),qt()),ae(e)}var t="⌘",i="…",r="⇥",o="⇧",f=window,l=document,s=this,u=s._,a=u.x,c=u.extend,d=u.css,p=u.edge,v=u.pattern,h=u.trim,b=s.is,m=b.e,g=b.f,y=b.i,x=b.o,w=b.r,k=b.s,E=function(e){return!b.x(e)},z=l.documentElement,$=(l.head,l.body),_={},S=function(){},D=c({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",unit:[[["<",">","/"],["=",'"','"'," "]],[["\\u003C","\\u003E","\\u002F"],["\\u003D","\\u0022","\\u0022","\\u0020"]]],suffix:0,auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:["Undo",t+"+Z"],redo:["Redo",t+"+Y"],indent:["Indent",r],outdent:["Outdent",o+"+"+r],preview:["Preview","F5"]},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+i},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{"":"text-editor",i:"icon icon-%1 fa fa-%1"},debounce:250},e),L="keydown",O="keyup",N="copy",M="cut",C="paste",j="touchstart mousedown",H="touchend mouseup",Y="touchmove mousemove",F="click",P="focus",W="blur",A="input",I="orientationchange resize",q=W+" "+N+" "+M+" "+P+" "+A+" "+L+" "+C,B=D.languages,R=D.tab,U=D.auto_tab,X=D.auto_close,K=D.unit[0][0],J=(D.unit[0][1],D.unit[1][0]),G=D.unit[1][1],Q="tool-id",V="javascript:;",ee="px",$e=s.ui={};s.tidy=function(e,t){var i=s.$(),n=h(i.before)?e:"",r=h(i.after)?E(t)?t:e:"";return s.trim(n,r)},s.i=function(){return h(s.replace(/\s+/g," "))},s.format=function(e,t,i,n){x(e)||(e=[e]),E(i)||(i=" "),E(n)||(n="");var r=s[0]().$(),o=(e[0]?K[0]+e[0]+K[1]:"")+n,f=n+(e[0]?K[0]+K[2]+(e[1]||e[0].split(v("("+G[3]+")+"))[0])+K[1]:""),l=a(o),u=a(f),c=v("^"+l+"([\\s\\S]*?)"+u+"$"),d=v(l+"$"),p=v("^"+u),h=r.before,b=r.after;return r.length?i=!1:s.insert(B.placeholders[""]),s.toggle(t?!c.test(r.value):!d.test(h)&&!p.test(b),[function(e){e.unwrap(o,f,1).tidy(v(J[0]+"[^"+J[0]+J[1]+J[2]+"]+?"+J[1]+"$").test(h)?"":i,v("^"+J[0]+J[2]+"[^"+J[0]+J[1]+"]+?"+J[1]).test(b)?"":i).wrap(o,f,t)[1]()},function(e){e.unwrap(o,f,t)[1]()}])};var Je,_e=D.classes,Se=_e[""],De=B.tools,Le=B.buttons,Oe=B.others,Ne=Se+"-textarea "+Se+"-content block",Me=yt(Se),Ce=yt(Se+"-header"),je=yt(Se+"-body"),He=yt(Se+"-footer"),Ye=yt(Se+"-tool"),Fe=Qe(s.target,!1,D.attributes),Pe=yt(Se+"-resize s"),We=yt(Se+"-description"),Ae=yt(Se+"-overlay"),Ie=Qe("div"),qe=Qe("div"),Be=Qe("div"),Re=yt("left","span"),Ue=yt("right","span"),Xe=yt(Se+"-preview","a"),Ke=0,Ze=0;D.suffix||(D.suffix=K[1]);var Tt={},$t=null;s.create=function(e,t){x(e)&&(D=c(D,e));var i=ct(Fe);if(et(Fe,Ne),i&&"P"===i.nodeName?(dt(i,Me),Ke=i,mt(i,!1)):dt(Fe,Me),Me.dir=D.dir,bt(Me,Ce),bt(Me,je),bt(Me,He),bt(Me,Pe),bt(je,Fe),D.tools&&(bt(Ce,Ye),bt(He,We),bt(We,Re),bt(We,Ue)),ve(L,Fe,_t),ve(O,Fe,St),ve(q,Fe,Dt),ve(j,Pe,Wt),ve(Y,$,At),ve(H,$,It),Oe.preview){var n=De.preview;re(Xe,{href:V,title:x(n)?n[0]+(n[1]?" ("+n[1]+")":""):n}),bt(Re,Xe),nt(Xe,Oe.preview)}return zt(null),kt(),Et(),0!==t?ne("create",[s]):s},s.update=function(e,t){return tt(Fe,Ne)&&s.destroy(0),(0!==t?ne("update",[s]):s).create(e,0)},s.destroy=function(e){return tt(Fe,Ne)?($e.exit(0,0,0),it(Fe,Ne),x(D.tools)&&(D.tools=D.tools.join(" ")),D.keys&&(he(L,Fe,_t),he(O,Fe,St)),he(j,Pe,Wt),he(Y,$,At),he(H,$,It),he(q,Fe,Dt),Ke?(dt(Me,Ke),bt(Ke,Fe),Ke=0):dt(Me,Fe),gt(Me),0!==e?ne("destroy",[s]):s):s};var e,Pt,Ot=0,Nt=0,Mt=0,Ct=0,jt=0,Ht=0,Yt=0,Ft={};$e.exit=function(e,t,i){var r,n={overlay:function(){he(F,Ae,qt),gt(Ae)},modal:function(){he(j,je,Ut),he(Y,je,Xt),he(H,$,Kt),he(F,Ft.x,Rt),gt(Ie)},drop:function(){gt(qe)},bubble:function(){gt(Be)}};if(t)if(x(t))for(r in t)r=t[r],n[r]&&n[r](),0!==i&&ne("exit."+r,[s]);else n[t]&&n[t](),0!==i&&ne("exit."+r,[s]);else for(r in n)n[r]();return e&&s.select(),0!==i&&ne("exit",[s]),s},$e.overlay=function(e,t,i){return $e.exit(0,0,0).blur(),St(1),bt(je,Qe(Ae,e.length||m(e)?yt(Se+"-overlay-content","div",e):"")),t&&ve(F,Ae,qt),g(i)?i(Ae):Qe(Ae,i),ne("enter.overlay",[s]),ne("enter",[s]),s},$e.overlay.fit=function(){},$e.modal=function(){$e.overlay("",1);var o,l,e=arguments,t=e[0],i=e[1],n=e[2],r=Se+"-modal";x(t)&&(t="default",i=e[0],n=e[1]),l=we(t),Qe(Ie,!1,{"class":r+" "+l}),E(i.body)&&(i.body=Qe("div",i.body,{"class":r+"-content "+l}));for(o in i)r[1]=o,Ft[o]=yt(r+"-"+xe(o,r)+" "+l,0,i[o]);return Ft.x=yt(Se+"-x "+l),Ft.resize=yt(Se+"-resize se "+l),ot(Ie),bt(je,Qe(Ie,Ft,{style:""})),$e.modal.fit(),pt(Ie,Ae),ve(F,Ft.x,Rt),ve(j,Ft.header,ae),ve(j,Ft.resize,ae),ve(j,je,Ut),ve(Y,je,Xt),ve(H,$,Kt),g(n)&&(Ft.overlay=Ae,Ft.modal=Ie,n(Ft)),ne("enter.modal."+t,[s]),ne("enter.modal",[s]),ne("enter",[s]),s},$e.modal.fit=function(e){Bt();var t=Yt/2-jt/2,i=Ht/2-Ct/2;return x(e)?(i=e[0],t=e[1]):(i=p(i,0),t=p(t,0)),d(Ie,{left:i+ee,top:t+ee,"min-width":Ct+ee,"min-height":jt+ee,visibility:"visible"}),ne("fit.modal",[s]),ne("fit",[s]),s};var Gt={"class":Se+"-button",name:"y"};return $e.alert=function(e,t,i,n){var r=Qe("button",Le.okay,Gt),o="alert";return i=i||S,x(e)&&(o+=":"+e[0],e=e[1]||e[0]),ve(F,r,function(e){return i(e,s),Rt(e,o+".y"),ae(e)}),ve(L,r,function(e){var t=e.TE.key;return t(/^escape|enter$/)?be(F,r,[e,s]):void 0}),$e.modal(o,Zt(e,t,r),n),r.focus(),s},$e.confirm=function(e,t,i,n,r){function a(e){return g(i)&&i(e,s),Rt(e,l+".y"),ae(e)}function c(e){return g(n)&&n(e,s),Rt(e,l+".n"),ae(e)}var u,o=Qe("button",Le.okay,Gt),f=Qe("button",Le.cancel,Gt),l="confirm";return f.name="n",x(e)&&(l+=":"+e[0],e=e[1]||e[0]),ve(F,o,a),ve(F,f,c),ve(L,o,function(e){return u=e.TE.key,u("arrowright")?(f.focus(),ae(e)):u("arrowleft")?ae(e):u("enter")?(a(e),ae(e)):u("escape")?(Rt(e,l+".y"),ae(e)):void 0}),ve(L,f,function(e){return u=e.TE.key,u("arrowright")?ae(e):u("arrowleft")?(o.focus(),ae(e)):u("enter")?(c(e),ae(e)):u("escape")?(Rt(e,l+".n"),ae(e)):void 0}),$e.modal(l,Zt(e,t,[o,f]),r),f.focus(),s},$e.prompt=function(e,t,i,n,r,o){function b(){u.focus(),"placeholder"in u&&u.select()}function m(e){return ae(e)}function y(e){return v=u.value,!i||h(v)&&v!==t?(Rt(e,a+".y"),ae(e),n(e,s,v!==t?v:"",t)):(b(),m(e))}function w(e){return Rt(e,a+".n"),ae(e)}var d,p,v,f=Qe("button",Le.okay,Gt),l=Qe("button",Le.cancel,Gt),u=Qe("input",!1,{type:"text",value:t,placeholder:t,spellcheck:"false","class":Se+"-input block"}),a="prompt",c=[];if(x(e)&&(a+=":"+e[0],e=e[1]||e[0]),g(r)&&(o=r,r=0),1===r)u=Qe("textarea",t,{placeholder:t.split("\n")[0],"class":Se+"-textarea block"});else if(2===r){for(p in t)c.push(Qe("option",t[p],{value:p,selected:p===i||null}));u=Qe("select",c,{"class":Se+"-select block"})}return n=n||S,u.name="data",l.name="n",ve(L,u,function(e){return d=e.TE.key,d("enter")?y(e):d("escape")||d("backspace")&&!this.value?w(e):d("arrowup")?m(e):d("arrowdown")?(f.focus(),ae(e)):void 0}),ve(L,f,function(e){return d=e.TE.key,d("enter")?y(e):d("escape")?w(e):d("arrowup")?(u.focus(),ae(e)):d("arrowright")?(l.focus(),ae(e)):d(/^arrow(down|left)$/)?m(e):void 0}),ve(L,l,function(e){return d=e.TE.key,d(/^enter|escape$/)?w(e):d("arrowup")?(u.focus(),ae(e)):d(/^arrow(right|down)$/)?m(e):d("arrowleft")?(f.focus(),ae(e)):void 0}),ve(F,f,y),ve(F,l,w),$e.modal(a,Zt(e,u,[f,l]),o),b(),s},$e.drop=function(){$e.exit(0,0,0);var n,e=arguments,t=e[0],i=e[1];return 1===e.length&&(t="default",i=e[0]),n=we(t),ot(qe),bt($,Qe(qe,!1,{"class":Se+"-drop "+n})),g(i)?i(qe):Qe(qe,i),$e.drop.fit(),ve(F,$,Jt),ne("enter.drop."+t,[s]),ne("enter.drop",[s]),s},$e.drop.fit=function(e){var o,t=ze(z),i=ze(qe),n=t.w/2-i.w/2,r=t.h/2-i.h/2;return!E(e)&&Ze&&(o=Ee(Ze),n=o.l,r=o.t+ze(Ze).h),x(e)?(n=e[0],r=e[1]):(n=p(n,0,t.w-i.w),r=p(r,0,t.h-i.h)),d(qe,{left:n+ee,top:r+ee,visibility:"visible"}),ne("fit.drop",[s]),ne("fit",[s]),s},$e.menu=function(e,t,i,n){var r='<span class="'+Se+'-current menu">%1</span>',o="";return t===!1?$e.tool(e,t):(x(t)&&(o=t[0],t=t[1],r='<i class="'+xe(_e.i,[o])+'"></i> '+r),$e.tool(e,{i:o,text:xe(r,[i[t]&&i[t].text||t,o]),click:function(t){var f,l,u,a,d,p,v,n={href:V,"class":Se+"-button"};return $e.drop("menu menu-"+we(e),function(e){function t(e){return a=this,v=i[se(a,Q)],f=rt(a),v&&v.active&&g(p=v.click)&&(p=p(e,s),Ze&&nt(lt(Ze)[0]||Ze,xe(r,[f,o])),p===!1)?ae(e):(s.select(),ae(e))}for(u in i)d=i[u],d=k(d)?$e.tools[d]:d,d&&(wt(d,u),n["data-"+Q]=u,l=Qe("a",d.text||u,c(n,d.attributes||{})),!l.title&&(p=d.title)&&(l.title=x(p)?p[0]+(p[1]?" ("+p[1]+")":""):p),d.active||et(l,"x"),i[u]=d,ve(F,l,t),bt(e,l))}),!1}},n),s)},$e.bubble=function(){$e.exit(0,0,0);var n,e=arguments,t=e[0],i=e[1];return 1===e.length&&(t="default",i=e[0]),n=we(t),ot(Be),bt($,Qe(Be,!1,{"class":Se+"-bubble "+n})),g(i)?i(Be):Qe(Be,i),$e.bubble.fit(),ne("enter.bubble."+t,[s]),ne("enter.bubble",[s]),s},$e.bubble.fit=function(e){var t=s.$(1),i=Ee(Fe),n=d(Fe,"line-height"),r="border-",o="-width",f=t.caret[0].x+i.l-Fe.scrollLeft,l=t.caret[1].y+i.t+n-Fe.scrollTop,u=d(je,[r+"top"+o,r+"bottom"+o,r+"left"+o,r+"right"+o]),a=ze(je),c=ze(Be),v=u[0]+u[1],h=u[2]+u[3];return x(e)?(f=e[0],l=e[1]):(f=p(f,i.l,i.l+a.w-c.w-h),l=p(l,i.t,i.t+a.h-c.h-v)),d(Be,{left:f+ee,top:l+ee,visibility:"visible"}),ne("fit.bubble",[s]),ne("fit",[s]),s},$e.overlay.exit=function(e){return $e.exit(e,"overlay")},$e.modal.exit=function(e){return $e.exit(e,"modal")},$e.drop.exit=function(e){return $e.exit(e,"drop")},$e.bubble.exit=function(e){return $e.exit(e,"bubble")},$e.tool=function(e,t,i){var n="";return"|"!==e&&(D.tools=D.tools.filter(function(t,i){return t===e?(n=i,!1):!0})),t===!1?delete $e.tools[e]:("|"===e?(i=t,t={}):(g(t)&&(t={click:t}),$e.tools[e]=c($e.tools[e]||{},t),E(i)||""===n||(i=n)),y(i)?D.tools.splice(i,0,e):D.tools.push(e)),kt(),s},$e.key=function(e,t){return D.keys?(t===!1?delete $e.keys[e]:$e.keys[e]=t,Et(),s):s},$e.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(R),!1},outdent:function(e,t){return t.outdent(R),!1}},ve(F,Xe,Qt),$e.keys={"control+y":"redo","control+z":"undo",f5:function(e,t){return Qt(e)},"shift+tab":U?"outdent":0,tab:U?"indent":0,escape:function(e,t){return Xe.focus(),!1}},$e.el={container:Me,header:Ce,body:je,footer:He,overlay:Ae,modal:Ie,drop:qe,bubble:Be},s.config=D,c(s._,{time:function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,n=e.getDate(),r=e.getHours(),o=e.getMinutes(),f=e.getSeconds(),l=e.getMilliseconds();return 10>i&&(i="0"+i),10>n&&(n="0"+n),10>r&&(r="0"+r),10>o&&(o="0"+o),10>f&&(f="0"+f),10>l&&(l="0"+l),[""+t,""+i,""+n,""+r,""+o,""+f,""+l]},replace:ye,format:xe,dom:{set:bt,reset:mt,get:at,id:Ve,classes:{set:et,reset:it,get:tt},attr:{set:re,reset:fe,get:oe},data:{set:le,reset:ue,get:se},offset:Ee,point:ke,size:ze,content:{set:nt,reset:ot,get:rt},closest:Te,parent:ft,children:lt,next:st,previous:ut,before:dt,after:pt,prepend:vt,append:ht},el:Qe,event:{set:ve,reset:he,fire:be,x:ae},hooks:_,hook:{set:te,reset:ie,fire:ne}}),$e};