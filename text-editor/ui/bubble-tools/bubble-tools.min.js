/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function P(e,t,n){i.tools[e].click(null,n);for(M in t)(U=O("[name=data]",s)[0])&&(U.value=t[M],($=O("[name=y]",s)[0])&&N.fire("click",$))}function W(l,f,u){k=t.languages.tools[f],l=o[f]&&o[f].i||f,D=T("a","<"===l[0]?l:'<i class="'+m(r,[l])+'"></i>',{"class":n+"-button",href:"javascript:;",title:"object"==typeof k?k[0]+(k[1]?" ("+k[1]+")":""):k,data:{"tool-id":f}}),N.set("keydown",D,function(t){if(U=this,$=t.TE.key,B=e.$(),$("arrowdown"))return e.select(B.end+("\n"===B.after[0]?1:0)),N.x(t);if($(/^(arrowup|escape)$/))return e.select(),N.x(t);if($("arrowright")&&(x=I(U))){for(;!R(x,"a")&&x;)x=I(x);x.focus()}else if($("arrowleft")&&(x=L(U))){for(;!R(x,"a")&&x;)x=L(x);x.focus()}}),N.set("click",D,function(t){return w=h(this,"tool-id"),o[w].click(t,e,w),($=O("[name=data]",s)[0])&&i.bubble(a,function(t){p(t,{"font-size":"80%"}),B=$.value,x=T("input",!1,{type:"text",value:B,placeholder:B,"class":n+"-input"}),N.set("keydown",x,function(t){return $=t.TE.key,B=this.value,$("escape")||$(/^(backspace|enter)$/)&&!B?(i.bubble.exit(1),N.x(t)):$("enter")?(P(w,[B,"",""],e),N.x(t)):void 0}),E(t,x),F(function(){x.focus(),x.select()})}),v(),N.x(t)}),E(u,D)}var l,G,y,k,H,D,w,M,U,$,B,x,t=e.config,n=t.classes[""],r=t.classes.i,i=e.ui,o=i.tools,f=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],a="tool "+n+"-tool",s=i.el.modal,u=i.el.bubble,c=e.target,A=e._,p=A.css,d=A.dom,E=d.append,h=d.data.get,O=d.get,R=d.is,I=d.next,L=d.previous,T=(A.edge,A.el),N=A.event,g=A.extend,m=A.format,S=A.hook,F=A.timer.set,C=A.trim,v=function(){F(function(){i.bubble.fit()})};N.set("keydown",c,function(t){return $=t.TE.key,B=!t.TE.shift()&&O(u)[0],x=e.$(),B&&$("arrowup")?(e.select(x.start-("\n"===x.before.slice(-1)?1:0)),N.x(t)):B&&$("arrowdown")?(O("a",u)[0].focus(),N.x(t)):void 0}),N.set("copy cut keyup mouseup paste scroll",c,function(n){$=e.$(),G=e.get(0)&&/(^|\n)$/.test($.before)&&/(\n|$)$/.test($.after),$.length||G?i.bubble(a,function(e){p(e,{padding:0,"font-size":"80%"}),l=t.tools_alt||f,l="string"==typeof l?[l,l]:g(l,f),y=C(l[G?1:0]).split(/\s+/);for(U in y)U=y[U],(H=o[U])&&W(H,U,e)}):i.bubble.exit()}),S.set("enter.bubble",v)});