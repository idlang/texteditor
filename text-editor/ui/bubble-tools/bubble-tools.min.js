/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(A){function v(A,E,e){R.tools[A].click(null,e);for(Y in E)(m=C("[name=data]",n)[0])&&(m.value=E[Y],(b=C("[name=y]",n)[0])&&D.fire("click",b))}function V(t,L,T){p=E.languages.tools[L],t=I[L]&&I[L].i||L,h=c("a","<"===t[0]?t:'<i class="'+f(O,[t])+'"></i>',{"class":e+"-button",href:"javascript:;",title:"object"==typeof p?p[0]+(p[1]?" ("+p[1]+")":""):p,data:{"tool-id":L}}),D.set("keydown",h,function(E){if(m=this,(b=E.TE.key)("arrowdown"))return D.x(E);if(b("arrowup"))return A.select(),D.x(E);if(b("arrowright")&&($=o(m))){for(;!a($,"a")&&$;)$=o($);$.focus()}else if(b("arrowleft")&&($=G(m))){for(;!a($,"a")&&$;)$=G($);$.focus()}}),D.set("click",h,function(E){return K=l(this,"tool-id"),I[K].click(E,A,K),(b=C("[name=data]",n)[0])&&R.bubble(N,function(E){S(E,{"font-size":"80%"}),g=b.value,$=c("input",!1,{type:"text",value:g,placeholder:g,"class":e+"-input"}),D.set("keydown",$,function(E){return b=E.TE.key,g=this.value,b("escape")||b(/^(backspace|enter)$/)&&!g?(R.bubble.exit(1),D.x(E)):b("enter")?(v(K,[g,"",""],A),D.x(E)):void 0}),i(E,$),M(function(){$.focus(),$.select()})}),B(),D.x(E)}),i(T,h)}var t,P,W,p,d,h,K,Y,m,b,g,$,E=A.config,e=E.classes[""],O=E.classes.i,R=A.ui,I=R.tools,L=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],N="tool "+e+"-tool",T=A.target,n=R.el.modal,r=A._,S=r.css,F=r.dom,i=F.append,l=F.data.get,C=F.get,a=F.is,o=F.next,G=F.previous,c=(r.edge,r.el),D=r.event,H=r.extend,f=r.format,u=r.hook,M=r.timer.set,U=r.trim,B=function(){M(function(){R.bubble.fit()})};D.set("keydown",T,function(A){return b=A.TE.key,b("arrowup")?D.x(A):b("arrowdown")?(C("a",R.el.bubble)[0].focus(),D.x(A)):void 0}),D.set("copy cut keyup mouseup paste scroll",T,function(e){b=A.$(),P=T.value&&/(^|\n)$/.test(b.before)&&/(\n|$)$/.test(b.after),b.length||P?R.bubble(N,function(A){S(A,{padding:0,"font-size":"80%"}),t=E.tools_alt||L,t="string"==typeof t?[t,t]:H(t,L),W=U(t[P?1:0]).split(/\s+/);for(m in W)m=W[m],(d=I[m])&&V(d,m,A)}):R.bubble.exit()}),u.set("enter.bubble",B)});