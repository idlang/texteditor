/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function $(e,t,n){i.tools[e].click(null,n);for(B in t)(P=L("[name=data]",s)[0])&&(P.value=t[B],(k=L("[name=y]",s)[0])&&S.fire("click",k))}function x(l,f,u){v=t.languages.tools[f],l=o[f]&&o[f].i||f,U="|"===f,y=h(U?"span":"a",U?!1:"<"===l[0]?l:'<i class="'+b(r,[l])+'"></i>',U?{"class":n+"-separator"}:{"class":n+"-button",href:"javascript:;",title:"object"==typeof v?v[0]+(v[1]?" ("+v[1]+")":""):v,data:{"tool-id":f}}),S.set("keydown",y,function(t){if(P=this,k=t.TE.key,w=e.$(),k("arrowdown"))return e.select(w.end+("\n"===w.after[0]?1:0)),S.x(t);if(k(/^(arrowup|escape)$/))return e.select(),S.x(t);if(k("arrowright")&&(W=p(P))){for(;!d(W,"a")&&W;)W=p(W);W.focus()}else if(k("arrowleft")&&(W=N(P))){for(;!d(W,"a")&&W;)W=N(W);W.focus()}}),S.set("click",y,function(t){return B=I(this,"tool-id"),o[B].click(t,e,B),(k=L("[name=data]",s)[0])&&i.bubble(a,function(t){E(t,{"font-size":"80%"}),w=k.value,W=h("input",!1,{type:"text",value:w,placeholder:w,"class":n+"-input"}),S.set("keydown",W,function(t){return k=t.TE.key,w=this.value,k("escape")||k(/^(backspace|enter)$/)&&!w?(i.bubble.exit(1),S.x(t)):k("enter")?($(B,[w,"",""],e),S.x(t)):void 0}),R(t,W),G(function(){W.focus(),W.select()})}),m(),S.x(t)}),R(u,y)}var l,H,D,v,M,U,y,B,P,k,w,W,t=e.config,n=t.classes[""],r=t.classes.i,i=e.ui,o=i.tools,f=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],a="tool "+n+"-tool",s=i.el.modal,u=i.el.bubble,c=e.target,A=e._,E=A.css,O=A.dom,R=O.append,I=O.data.get,L=O.get,d=O.is,p=O.next,N=O.previous,h=(A.edge,A.el),S=A.event,F=A.extend,b=A.format,C=A.hook,G=A.timer.set,g=A.trim,m=function(){G(function(){i.bubble.fit()})};t.tools_alt&&(S.set("keydown",c,function(t){return k=t.TE.key,w=!t.TE.shift()&&L(u)[0],W=e.$(),w&&k("arrowup")?(e.select(W.start-("\n"===W.before.slice(-1)?1:0)),S.x(t)):w&&k("arrowdown")?(L("a",u)[0].focus(),S.x(t)):void 0}),S.set("copy cut keyup mouseup paste scroll",c,function(n){k=e.$(),H=e.get(0)&&/(^|\n)$/.test(k.before)&&/(\n|$)$/.test(k.after),k.length||H?i.bubble(a,function(e){E(e,{padding:0,"font-size":"80%"}),l=t.tools_alt,l=l===!0?f:l,l="string"==typeof l?[l,l]:F(l,f),D=g(l[H?1:0]).split(/\s+/);for(P in D)P=D[P],(M=o[P])&&x(M,P,e)}):i.bubble.exit()}),C.set("enter.bubble",m))});