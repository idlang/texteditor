/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(A){function $(A,E,e){R.tools[A].click(null,e);for(Y in E)(m=o("[name=data]",n)[0])&&(m.value=E[Y],(g=o("[name=y]",n)[0])&&D.fire("click",g))}function V(t,L,T){d=E.languages.tools[L],t=I[L]&&I[L].i||L,K=c("a","<"===t[0]?t:'<i class="'+H(O,[t])+'"></i>',{"class":e+"-button",href:"javascript:;",title:"object"==typeof d?d[0]+(d[1]?" ("+d[1]+")":""):d,data:{"tool-id":L}}),D.set("keydown",K,function(E){if(m=this,(g=E.TE.key)("arrowdown"))return D.x(E);if(g("arrowup"))return A.select(),D.x(E);if(g("arrowright")&&(v=G(m))){for(;!l(v,"a")&&v;)v=G(v);v.focus()}else if(g("arrowleft")&&(v=a(m))){for(;!l(v,"a")&&v;)v=a(v);v.focus()}}),D.set("click",K,function(E){return h=C(this,"tool-id"),I[h].click(E,A,h),(g=o("[name=data]",n)[0])&&R.bubble(N,function(E){S(E,{"font-size":"80%"}),b=g.value,v=c("input",!1,{type:"text",value:b,placeholder:b,"class":e+"-input"}),D.set("keydown",v,function(E){return g=E.TE.key,b=this.value,g("escape")||g(/^(backspace|enter)$/)&&!b?(R.bubble.exit(1),D.x(E)):g("enter")?($(h,[b,"",""],A),D.x(E)):void 0}),i(E,v),M(function(){v.focus(),v.select()})}),B(),D.x(E)}),i(T,K)}var t,P,W,d,p,K,h,Y,m,g,b,v,E=A.config,e=E.classes[""],O=E.classes.i,R=A.ui,I=R.tools,L=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],N="tool "+e+"-tool",T=A.target,n=R.el.modal,r=A._,S=r.css,F=r.dom,i=F.append,C=F.data.get,o=F.get,l=F.is,G=F.next,a=F.previous,c=(r.edge,r.el),D=r.event,f=r.extend,H=r.format,u=r.hook,M=r.timer.set,U=r.trim,B=function(){M(function(){R.bubble.fit()})};D.set("keydown",T,function(A){return g=A.TE.key,b=!A.TE.shift(),b&&g("arrowup")?D.x(A):b&&g("arrowdown")?(o("a",R.el.bubble)[0].focus(),D.x(A)):void 0}),D.set("copy cut keyup mouseup paste scroll",T,function(e){g=A.$(),P=T.value&&/(^|\n)$/.test(g.before)&&/(\n|$)$/.test(g.after),g.length||P?R.bubble(N,function(A){S(A,{padding:0,"font-size":"80%"}),t=E.tools_alt||L,t="string"==typeof t?[t,t]:f(t,L),W=U(t[P?1:0]).split(/\s+/);for(m in W)m=W[m],(p=I[m])&&V(p,m,A)}):R.bubble.exit()}),u.set("enter.bubble",B)});