/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.5
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function w(e,t,n){i.tools[e].click(null,n);for(P in t)($=p("[name=data]",f)[0])&&($.value=t[P],(k=p("[name=y]",f)[0])&&S.fire("click",k))}function K(l,a,c){M=t.languages.tools[a],l=o[a]&&o[a].i||a,v=h("a","<"===l[0]?l:'<i class="'+b(r,[l])+'"></i>',{"class":n+"-button",href:"javascript:;",title:"object"==typeof M?M[0]+(M[1]?" ("+M[1]+")":""):M,data:{"tool-id":a}}),S.set("keydown",v,function(t){if($=this,k=t.TE.key,W=e.$(),k("arrowdown"))return e.select(W.end+("\n"===W.after[0]?1:0)),S.x(t);if(k(/^(arrowup|escape)$/))return e.select(),S.x(t);if(k("arrowright")&&(y=N($))){for(;!L(y,"a")&&y;)y=N(y);y.focus()}else if(k("arrowleft")&&(y=T($))){for(;!L(y,"a")&&y;)y=T(y);y.focus()}}),S.set("click",v,function(t){return B=I(this,"tool-id"),o[B].click(t,e,B),(k=p("[name=data]",f)[0])&&i.bubble(s,function(t){E(t,{"font-size":"80%"}),W=k.value,y=h("input",!1,{type:"text",value:W,placeholder:W,"class":n+"-input"}),S.set("keydown",y,function(t){return k=t.TE.key,W=this.value,k("escape")||k(/^(backspace|enter)$/)&&!W?(i.bubble.exit(1),S.x(t)):k("enter")?(w(B,[W,"",""],e),S.x(t)):void 0}),R(t,y),G(function(){y.focus(),y.select()})}),m(),S.x(t)}),R(c,v)}var l,H,D,M,U,v,B,P,$,k,W,y,t=e.config,n=t.classes[""],r=t.classes.i,i=e.ui,o=i.tools,a=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],s="tool "+n+"-tool",f=i.el.modal,c=i.el.bubble,u=e.target,A=e._,E=A.css,O=A.dom,R=O.append,I=O.data.get,p=O.get,L=O.is,N=O.next,T=O.previous,h=(A.edge,A.el),S=A.event,F=A.extend,b=A.format,C=A.hook,G=A.timer.set,g=A.trim,m=function(){G(function(){i.bubble.fit()})};S.set("keydown",u,function(t){return k=t.TE.key,W=!t.TE.shift()&&p(c)[0],y=e.$(),W&&k("arrowup")?(e.select(y.start-("\n"===y.before.slice(-1)?1:0)),S.x(t)):W&&k("arrowdown")?(p("a",c)[0].focus(),S.x(t)):void 0}),S.set("copy cut keyup mouseup paste scroll",u,function(n){k=e.$(),H=e.get(0)&&/(^|\n)$/.test(k.before)&&/(\n|$)$/.test(k.after),k.length||H?i.bubble(s,function(e){E(e,{padding:0,"font-size":"80%"}),l=t.tools_alt||a,l="string"==typeof l?[l,l]:F(l,a),D=g(l[H?1:0]).split(/\s+/);for($ in D)$=D[$],(U=o[$])&&K(U,$,e)}):i.bubble.exit()}),C.set("enter.bubble",m)});