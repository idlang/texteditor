/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.3
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function K(e,n,i){t.tools[e].click(null,i);for(P in n)(W=C("[name=data]",f)[0])&&(W.value=n[P],(y=C("[name=y]",f)[0])&&I.fire("click",y))}function k(A,E,u){g=n.languages.tools[E],A=r[E]&&r[E].i||E,U=l("a","<"===A[0]?A:'<i class="'+T(o,[A])+'"></i>',{"class":i+"-button",href:"javascript:;",title:"object"==typeof g?g[0]+(g[1]?" ("+g[1]+")":""):g,data:{"tool-id":E}}),I.set("keydown",U,function(t){if(W=this,(y=t.TE.key)("arrowdown"))return I.x(t);if(y("arrowup"))return e.select(),I.x(t);if(y("arrowright")&&(w=p(W))){for(;!h(w,"a")&&w;)w=p(w);w.focus()}else if(y("arrowleft")&&(w=G(W))){for(;!h(w,"a")&&w;)w=G(w);w.focus()}}),I.set("click",U,function(n){return B=F(this,"tool-id"),r[B].click(n,e,B),(y=C("[name=data]",f)[0])&&t.bubble(s,function(n){O(n,{"font-size":"80%"}),x=y.value,w=l("input",!1,{type:"text",value:x,placeholder:x,"class":i+"-input"}),I.set("keydown",w,function(n){return y=n.TE.key,x=this.value,y("escape")||y(/^(backspace|enter)$/)&&!x?(t.bubble.exit(1),I.x(n)):y("enter")?(K(B,[x,"",""],e),I.x(n)):void 0}),m(n,w),d(function(){w.focus(),w.select()})}),b(),I.x(n)}),m(u,U)}var A,D,H,g,M,U,B,P,W,y,x,w,t=e.ui,n=e.config,i=n.classes[""],o=n.classes.i,r=t.tools,E=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],s="tool "+i+"-tool",u=e.target,f=t.el.modal,a=e._,l=a.el,c=a.extend,O=a.css,R=a.trim,I=a.event,L=a.hook,T=(a.edge,a.format),d=a.timer.set,S=a.dom,F=S.data.get,C=S.get,p=S.next,G=S.previous,h=S.is,m=S.append,b=function(){d(function(){t.bubble.fit()})};I.set("keydown",u,function(e){return y=e.TE.key,y("arrowup")?I.x(e):y("arrowdown")?(C("a",t.el.bubble)[0].focus(),I.x(e)):void 0}),I.set("copy cut keyup mouseup paste scroll",u,function(i){y=e.$(),D=u.value&&/(^|\n)$/.test(y.before)&&/(\n|$)$/.test(y.after),y.length||D?t.bubble(s,function(e){O(e,{padding:0,"font-size":"80%"}),A=n.tools_alt||E,A="string"==typeof A?[A,A]:c(A,E),H=R(A[D?1:0]).split(/\s+/);for(W in H)W=H[W],(M=r[W])&&k(M,W,e)}):t.bubble.exit()}),L.set("enter.bubble",b)});