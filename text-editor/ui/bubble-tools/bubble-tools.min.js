/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function P(e,t,n){i.tools[e].click(null,n);for(M in t)(U=O("[name=data]",s)[0])&&(U.value=t[M],($=O("[name=y]",s)[0])&&N.fire("click",$))}function W(l,f,u){k=t.languages.tools[f],l=o[f]&&o[f].i||f,D="|"===f,w=T(D?"span":"a",D?!1:"<"===l[0]?l:'<i class="'+m(r,[l])+'"></i>',D?{"class":n+"-separator"}:{"class":n+"-button",href:"javascript:;",title:"object"==typeof k?k[0]+(k[1]?" ("+k[1]+")":""):k,data:{"tool-id":f}}),N.set("keydown",w,function(t){if(U=this,$=t.TE.key,x=e.$(),$("arrowdown"))return e.select(x.end+("\n"===x.after[0]?1:0)),N.x(t);if($(/^(arrowup|escape)$/))return e.select(),N.x(t);if($("arrowright")&&(B=I(U))){for(;!R(B,"a")&&B;)B=I(B);B.focus()}else if($("arrowleft")&&(B=b(U))){for(;!R(B,"a")&&B;)B=b(B);B.focus()}}),N.set("click",w,function(t){return M=h(this,"tool-id"),o[M].click(t,e,M),($=O("[name=data]",s)[0])&&i.bubble(a,function(t){p(t,{"font-size":"80%"}),x=$.value,B=T("input",!1,{type:"text",value:x,placeholder:x,"class":n+"-input"}),N.set("keydown",B,function(t){return $=t.TE.key,x=this.value,$("escape")||$(/^(backspace|enter)$/)&&!x?(i.bubble.exit(1),N.x(t)):$("enter")?(P(M,[x,"",""],e),N.x(t)):void 0}),E(t,B),F(function(){B.focus(),B.select()})}),v(),N.x(t)}),E(u,w)}var l,G,y,k,H,D,w,M,U,$,x,B,t=e.config,n=t.classes[""],r=t.classes.i,i=e.ui,o=i.tools,f=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],a="tool "+n+"-tool",s=i.el.modal,u=i.el.bubble,c=e.target,A=e._,p=A.css,d=A.dom,E=d.append,h=d.data.get,O=d.get,R=d.is,I=d.next,b=d.previous,T=(A.edge,A.el),N=A.event,g=A.extend,m=A.format,S=A.hook,F=A.timer.set,C=A.trim,v=function(){F(function(){i.bubble.fit()})};t.tools_alt&&(N.set("keydown",c,function(t){return $=t.TE.key,x=!t.TE.shift()&&O(u)[0],B=e.$(),x&&$("arrowup")?(e.select(B.start-("\n"===B.before.slice(-1)?1:0)),N.x(t)):x&&$("arrowdown")?(O("a",u)[0].focus(),N.x(t)):void 0}),N.set("copy cut keyup mouseup paste scroll",c,function(n){$=e.$(),G=e.get(0)&&/(^|\n)$/.test($.before)&&/(\n|$)$/.test($.after),$.length||G?i.bubble(a,function(e){p(e,{padding:0,"font-size":"80%"}),l=t.tools_alt,l=l===!0?f:l,l="string"==typeof l?[l,l]:g(l,f),y=C(l[G?1:0]).split(/\s+/);for(U in y)U=y[U],(H=o[U])&&W(H,U,e)}):i.bubble.exit()}),S.set("enter.bubble",v))});