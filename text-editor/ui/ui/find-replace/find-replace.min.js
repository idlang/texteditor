/*!
 * ===========================================================
 *  FIND AND REPLACE PLUGIN FOR USER INTERFACE MODULE 1.0.0
 * ===========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * -----------------------------------------------------------
 */
TE.each(function(e){function I(e,t,n){n=n||0;var i=e.slice(n).search(t);return i>=0?i+n:i}function j(){C=O.value,L=f.modals.find_alert,z=e.get(),l=1===r?z.indexOf(C,o):2===r?I(z,w(C),o):3===r?I(z,w(C,"i"),o):z.toLowerCase().indexOf(C.toLowerCase(),o),-1===l?n.alert(L[0],x(L[1],[C]),R):(2!==r&&3!==r&&(C=g(C)),z=(z.slice(l).match(w("^"+C,0===r||2===r?"i":""))||[""])[0].length,o=l+z,e.select(l,l+z),a.scrollTop=e.$(1).caret[0].y)}function H(){l=e.$().length,l||e.select(!0),l=O.value,e.replace(w(0!==r&&1!==r?l:g(l),"g"+(1!==r&&3!==r?"i":"")),F.value)}function P(e){L=f.modals.find,n.prompt(L[0],L[1],""+r,function(e,t,n){R(),c(D,L[1][r=+n])},2)}function B(e){return M=e.TE.key,M("alt")?(P(),v(e)):M(/^(arrowdown|enter)$/)?(j(),v(e)):void 0}function R(){o=0,l=e.blur().$(),!d(S)[0]&&(l=l.value)&&(O.value=l),b(n.el.header,S),E(function(){O.focus(),O.select()}),m("keydown",a,B)}function Y(){n.key.set("control"),p(S,!1),e.select(),y("keydown",a,B)}var M,l,C,L,z,t=Date.now(),n=e.ui,i=e.config,r=0,o=0,f=i.languages,l=i.classes[""],a=e.target,s=e._,u=s.dom,c=u.content.set,d=u.get,p=u.reset,b=u.set,h=s.el,g=s.x,y=s.event.reset,m=s.event.set,v=s.event.x,k=s.extend,x=s.format,w=s.pattern,E=s.timer.set,T="-find-replace",$=l+T+"--"+t;k(f,{tools:{find:["Find and Replace","⌘+F"]},modals:{find:["Mode",["Ignore Case","Match Case","Match Pattern","Match Case and Pattern"]],find_alert:["Not Found","Can’t find “%1”. Find again from top?"]},placeholders:{find:["find…","replace with…"]},labels:{find:["Find","Replace"]}}),L=f.placeholders.find;var O=h("input",!1,{type:"text","class":l+"-input "+l+"-input-find",id:l+"-find:"+t,title:L[0]}),F=h("input",!1,{type:"text","class":l+"-input "+l+"-input-replace",id:l+"-replace:"+t,title:L[1]}),N=h("a",n.i("config","cogs"),{href:"javascript:;","class":l+"-a",title:f.modals.find[0],style:"padding:0 .25em 0 .5em;"}),D=h("span",f.modals.find[1][0],{"class":l+"-label"});N.firstChild.style.backgroundSize="100% auto",L=f.labels.find;var S=h("div",[h("label",L[0],{"class":l+"-label "+l+"-label-find","for":l+"-find:"+t,style:"padding:0 .5em;"}),O,h("label",L[1],{"class":l+"-label "+l+"-label-replace","for":l+"-replace:"+t,style:"padding:0 .5em;"}),F,N,D],{"class":l+T+" "+$,id:l+T+":"+t,style:"font-size:80%;line-height:1.25em;padding:.25em;border-top:1px solid;border-top-color:inherit;"});m("click",a,Y),m("keydown",O,function(e){return M=e.TE.key,C=this.value,e.TE.control("f")||M("backspace")&&!C?(Y(),v(e)):M("alt")?(P(),v(e)):M("tab")?(F.value=O.value,F.focus(),F.select(),v(e)):M("enter")&&C?(j(),v(e)):void 0}),m("keydown",F,function(e){return M=e.TE.key,C=this.value,e.TE.control("f")?(Y(),v(e)):M("backspace")&&!C?(O.focus(),v(e)):M("alt")?(P(),v(e)):M("tab")?(N.focus(),v(e)):M("enter")?(H(),v(e)):void 0}),m("click",N,P),m("click",D,P),n.tool("find",{i:"binoculars",click:function(e,t){return d(S)[0]?Y():R(),!1}}),n.key("control+f","find")});