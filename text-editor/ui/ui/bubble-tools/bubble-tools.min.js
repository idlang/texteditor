/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.6
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function G(e,t,n){i.tools[e].click(null,n);for(M in t)(z=m("[name=data]",s)[0])&&(z.value=t[M],(_=m("[name=y]",s)[0])&&E.fire("click",_))}function U(f,u,a){N=t.languages.tools[u],f=o[u]&&o[u].i||u,F="|"===u,H=x(F?"span":"a",F?!1:"<"===f[0]?f:'<i class="'+$(r,[f])+'"></i>',F?{"class":n+"-separator"}:{"class":n+"-button",href:"javascript:;",title:"object"==typeof N?N[0]+(N[1]?" ("+N[1]+")":""):N,data:{"tool-id":u}}),E.set("keydown",H,function(t){if(z=this,_=t.TE.key,D=e.$(),_("arrowdown"))return e.select(D.end+("\n"===D.after[0]?1:0)),E.x(t);if(_(/^(arrowup|escape)$/))return e.select(),E.x(t);if(_("arrowright")&&(B=y(z))){for(;!v(B,"a")&&B;)B=y(B);B.focus()}else if(_("arrowleft")&&(B=w(z))){for(;!v(B,"a")&&B;)B=w(B);B.focus()}}),E.set("click",H,function(t){return M=g(this,"tool-id"),o[M].click(t,e,M),(_=m("[name=data]",s)[0])&&i.bubble(l,function(t){p(t,{"font-size":"80%"}),D=_.value,B=x("input",!1,{type:"text",value:D,placeholder:D,"class":n+"-input"}),E.set("keydown",B,function(t){return _=t.TE.key,D=this.value,_("escape")||_(/^(backspace|enter)$/)&&!D?(i.bubble.exit(1),E.x(t)):_("enter")?(G(M,[D,"",""],e),E.x(t)):void 0}),b(t,B),L(function(){B.focus(),B.select()})}),I(),E.x(t)}),b(a,H)}var f,R,C,N,S,F,H,M,z,_,D,B,t=e.config,n=t.classes[""],r=t.classes.i,i=e.ui,o=i.tools,u=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],l="tool "+n+"-tool",s=i.el.modal,a=i.el.bubble,c=e.target,d=e._,p=d.css,h=d.dom,b=h.append,g=h.data.get,m=h.get,v=h.is,y=h.next,w=h.previous,x=(d.edge,d.el),E=d.event,T=d.extend,$=d.format,A=d.hook,L=d.timer.set,O=d.trim,I=function(){L(function(){i.bubble.fit()})};t.tools_alt&&(E.set("keydown",c,function(t){return _=t.TE.key,D=!t.TE.shift()&&m(a)[0],B=e.$(),D&&_("arrowup")?(e.select(B.start-("\n"===B.before.slice(-1)?1:0)),E.x(t)):D&&_("arrowdown")?(m("a",a)[0].focus(),E.x(t)):void 0}),E.set("copy cut keyup mouseup paste scroll",c,function(n){_=e.$(),R=e.get(0)&&/(^|\n)$/.test(_.before)&&/(\n|$)$/.test(_.after),_.length||R?i.bubble(l,function(e){p(e,{padding:0,"font-size":"80%"}),f=t.tools_alt,f=f===!0?u:f,f="string"==typeof f?[f,f]:T(f,u),C=O(f[R?1:0]).split(/\s+/);for(z in C)z=C[z],(S=o[z])&&U(S,z,e)}):i.bubble.exit()}),A.set("enter.bubble",I))});