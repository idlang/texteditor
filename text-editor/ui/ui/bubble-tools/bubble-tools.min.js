/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.0.7
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function P(e,t,n){i.tools[e].click(null,n);for(R in t)(B=b("[name=data]",s)[0])&&(B.value=t[R],(K=b("[name=y]",s)[0])&&k.fire("click",K))}function N(f,u,c){j=t.languages.tools[u],R=o[u],f=R&&R.i||u,M="|"===u,H=x(M?"span":"a",M?!1:"<"===f[0]?f:'<i class="'+T(r,[R.target?m(R.target,"tool-id"):u,f])+'"></i>',M?{"class":n+"-separator"}:{"class":n+"-button",href:"javascript:;",title:"object"==typeof j?j[0]+(j[1]?" ("+j[1]+")":""):j,data:{"tool-id":u}}),k.set("keydown",H,function(t){if(B=this,K=t.TE.key,q=e.$(),K("arrowdown"))return e.select(q.end+("\n"===q.after[0]?1:0)),k.x(t);if(K(/^(arrowup|escape)$/))return e.select(),k.x(t);if(K("arrowright")&&(I=v(B))){for(;!y(I,"a")&&I;)I=v(I);I.focus()}else if(K("arrowleft")&&(I=w(B))){for(;!y(I,"a")&&I;)I=w(I);I.focus()}}),k.set("click",H,function(t){return R=m(this,"tool-id"),o[R].click(t,e,R),(K=b("[name=data]",s)[0])&&i.bubble(a,function(t){d(t,{"font-size":"80%"}),q=K.value,I=x("input",!1,{type:"text",value:q,placeholder:q,"class":n+"-input",spellcheck:"false"}),k.set("keydown",I,function(t){return K=t.TE.key,q=this.value,K("escape")||K(/^(backspace|enter)$/)&&!q?(i.bubble.exit(1),k.x(t)):K("enter")?(P(R,[q,"",""],e),k.x(t)):void 0}),g(t,I),z(function(){I.focus(),I.select()})}),S(),k.x(t)}),g(c,H)}var f,L,O,j,A,M,H,R,B,K,q,I,t=e.config,n=t.classes[""],r=t.classes.i,i=e.ui,o=i.tools,u=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ol ul hr"],a="tool "+n+"-tool",s=i.el.modal,c=i.el.bubble,l=e.target,p=e._,d=p.css,h=p.dom,g=h.append,m=h.data.get,b=h.get,y=h.is,v=h.next,w=h.previous,x=(p.edge,p.el),k=p.event,E=p.extend,T=p.format,_=p.hook,z=p.timer.set,C=p.trim,S=function(){z(function(){i.bubble.fit()})};t.tools_alt&&(k.set("keydown",l,function(t){return K=t.TE.key,q=!t.TE.shift()&&b(c)[0],I=e.$(),q&&K("arrowup")?(e.select(I.start-("\n"===I.before.slice(-1)?1:0)),k.x(t)):q&&K("arrowdown")?(b("a",c)[0].focus(),k.x(t)):void 0}),k.set("copy cut keyup mouseup paste scroll",l,function(n){K=e.$(),L=e.get(0)&&/(^|\n)$/.test(K.before)&&/(\n|$)$/.test(K.after),K.length||L?i.bubble(a,function(e){d(e,{padding:0,"font-size":"80%"}),f=t.tools_alt,f=f===!0?u:f,f="string"==typeof f?[f,f]:E(f,u),O=C(f[L?1:0]).split(/\s+/);for(B in O)B=O[B],(A=o[B])&&N(A,B,e)}):i.bubble.exit()}),_.set("enter.bubble",S))});