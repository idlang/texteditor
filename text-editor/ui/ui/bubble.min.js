/*!
 * ==========================================================
 *  BUBBLE TOOLS PLUGIN FOR USER INTERFACE MODULE 1.2.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.each(function(e){function x(e,A,E){t.tools[e].click(null,E);for(K in A)(Y=s("[name=data]",L)[0])&&(Y.value=A[K],(b=s("[name=y]",L)[0])&&G.fire("click",b))}function k(R,I,N){P=A.languages.tools[I],K=O[I],R=K&&K.i||I,W="|"===I,p=u(W?"span":"a",W?!1:-1!==R.indexOf("<")?R:t.i(I,K.i),W?{"class":E+"-separator"}:{"class":E+"-button",href:"javascript:;",title:"object"==typeof P?P[0]+(P[1]?" ("+P[1]+")":""):P,data:{"tool-id":I}}),G.set("keydown",p,function(A){if(Y=this,b=A.TE.key,v=e.$(),b("down"))return e.select(v.end+("\n"===v.after[0]?1:0)),G.x(A);if(b(["up","escape"]))return e.select(),G.x(A);if(b("right")&&(g=r(Y))){for(;!F(g,"a")&&g;)g=r(g);g.focus()}else if(b("left")&&(g=c(Y))){for(;!F(g,"a")&&g;)g=c(g);g.focus()}}),G.set("click",p,function(A){return K=o(this,"tool-id"),O[K].click(A,e,K),(b=s("[name=data]",L)[0])&&t.bubble(i,function(A){T(A,{"font-size":"80%"}),v=b.value,g=u("input",!1,{type:"text",value:v,placeholder:v,"class":E+"-input",spellcheck:"false"}),G.set("keydown",g,function(A){return b=A.TE.key,v=this.value,b("escape")||b(["back","enter"])&&!v?(t.bubble.exit(1),G.x(A)):b("enter")?(x(K,[v,"",""],e),G.x(A)):void 0}),S(A,g),d(function(){g.focus(),g.select()})}),B(),G.x(A)}),S(N,p)}var R,U,h,P,m,W,p,K,Y,b,v,g,A=e.config,E=A.classes[""],t=e.ui,O=t.tools,I=["b i a img pre,code","p blockquote,q p,h1,h2,h3,h4,h5,h6 ul ol hr"],i="tool "+E+"-tool",L=t.el.modal,N=t.el.bubble,n=e.target,l=e._,T=l.css,a=l.dom,S=a.append,o=a.data.get,s=a.get,F=a.is,r=a.next,c=a.previous,u=(l.edge,l.el),G=l.events,f=l.extend,H=(l.format,l.hooks),d=l.timer.set,M=l.trim,B=function(){d(function(){t.bubble.fit()})};A.bubble&&(G.set("keydown",n,function(A){return b=A.TE.key,v=!A.TE.shift()&&s(N)[0],g=e.$(),v&&b("up")?(e.select(g.start-("\n"===g.before.slice(-1)?1:0)),G.x(A)):v&&b("down")?(s("a",N)[0].focus(),G.x(A)):void 0}),G.set("copy cut keyup mouseup paste scroll",n,function(E){b=e.$(),U=e.get(0)&&/(^|\n)$/.test(b.before)&&/(\n|$)$/.test(b.after),b.length||U?t.bubble(i,function(e){if(T(e,{padding:0,"font-size":"80%"}),R=A.bubble,R=R===!0?I:R,R="string"==typeof R?[R,R]:f(I,R),E=R[U?1:0]){h=M(E||"").split(/\s+/);for(Y in h)Y=h[Y],(m=O[Y])&&k(m,Y,e)}else t.bubble.exit()}):t.bubble.exit()}),H.set("enter.bubble",B))});