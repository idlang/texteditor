/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e){return"function"==typeof e}function r(e,t){return RegExp(e,t)}function o(e){return e.replace(/^\s*|\s*$/g,"")}function i(e){return e.split(/\s+/)[0]}function l(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function u(e,t,n){var o=w.$(),u=o.before,c=j[t],a=j[n]||n,s=i(c),p=i(a),d=l(u);if(f=c,o.length)w[0]().tidy("\n\n","").replace(/\n/g,"</"+p+">\n"+M+"<"+a+">").wrap("<"+c+">\n"+M+"<"+a+">","</"+p+">\n</"+s+">\n\n",1).replace(r("\\n"+M+"<"+a+">\\s*<\\/"+p+">\\n","g"),"\n</"+s+">\n\n<"+c+">\n").select(w.$().end),A&&E.tools.p.click(e,w),w[1]();else{var h=u.match(r("<"+p+z+">.*$"));h?r("<\\/"+p+">\\s*$").test(u)?w.tidy("\n"+d,!1).wrap("<"+p+h[1]+">","</"+p+">"):/>\s*$/.test(u)?r("<\\/"+p+">\\s*$").test(u)||w.wrap("\n"+d+M+"<"+c+">\n"+d+M+M+"<"+p+h[1]+">","</"+p+">\n"+d+M+"</"+s+">\n"+d):w.insert("</"+p+">\n"+d+"<"+p+h[1]+">",-1):w.tidy("\n\n","").wrap("<"+c+">\n"+M+"<"+a+">","</"+p+">\n</"+s+">")}return w}function c(e,t,n){var o,l,u=(t.$(),j.align),c=i(u);n=n.split("-"),o=r("<"+C(T(u),[n[0],"(?:"+S.formats.align.join("|")+")"])+">\\s*"),l=r("\\s*<\\/"+c+">"),t[0]().unwrap(o,l).unwrap(o,l,1).format(C(u,n),0,"\n\n","\n")[1]()}function a(e,t){return!t.get(0)&&A&&E.tools.p.click(e,t),t}function s(e){return e.replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}var f,p="\u2013",d="\u2026",h="\u2191",g="\u2193",v="\u21B5",m="\u2318",b="\u2718",y="\u21E5",$="\u21E7",k=window,w=new TE(e),x=w._.extend,_=w._.each,T=w._.x,E=w.create(x({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | a img | p | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | align-left align-center align-right align-justify | hr | undo redo",css:"html,body{background:#fff;color:#000}.align-left{text-align:left}.align-center{text-align:center}.align-right{text-align:right}.align-justify{text-align:justify}",languages:{tools:{clear:"Clear Format ("+b+")",b:"Bold ("+m+"+B)",i:"Italic ("+m+"+I)",u:"Underline ("+m+"+U)",s:"Strike ("+m+"+"+b+")",a:"Link ("+m+"+L)",img:"Image ("+m+"+G)",sub:"Subscript ("+m+"+"+g+")",sup:"Superscript ("+m+"+"+h+")",p:"Paragraph ("+m+"+"+v+")","p,h1,h2,h3,h4,h5,h6":"H1 "+p+" H6 ("+m+"+H)","blockquote,q":"Quote ("+m+"+Q)","pre,code":"Code ("+m+"+K)",ul:"Unordered List ("+m+"+-)",ol:"Ordered List ("+m+"++)",indent:"Indent ("+y+")",outdent:"Outdent ("+$+"+"+y+")","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify","align-top":"Align Top","align-middle":"Align Middle","align-bottom":"Align Bottom",hr:"Horizontal Rule ("+m+"+R)"},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+d]},img:{title:["Image URL","Image Caption"],placeholder:["http://","image caption here"+d]}}},classes:{formats:{align:["left","center","right","justify","top","middle","bottom",""]}},formats:{align:'div class="%1-%2"',b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",hr:"hr"}},t)),C=w._.format,L=w.config,q=L.languages,j=L.formats,S=L.classes,M=L.tab,H=L.suffix,I="(?:\\s[^<>]*?)?",z="(|\\s[^<>]*?)",O="([\\s\\S]*?)",R=q.others.placeholder,A=L.auto_p;return TE.HTML.__instance__.push(w),x(E.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;if(r.length)return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after.slice(0,1)?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!1}},b:{i:"bold",click:function(e,t){return a(e,t).format(j.b),!1}},i:{i:"italic",click:function(e,t){return a(e,t).format(j.i),!1}},u:{i:"underline",click:function(e,t){return a(e,t).format(j.u),!1}},s:{i:"strikethrough",click:function(e,t){return a(e,t).format(C(j.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=j.a,i=q.modals.a;return t.record().ui.prompt(i.title[0],i.placeholder[0],1,function(e,t,l){n=l;var u,c,f=k.location.host;-1!==n.indexOf("://")&&(u=1),""!==f&&-1!==n.indexOf("://"+f)&&(u=0),/^([.\/?&#]|javascript:)/.test(n)&&(u=0),t.blur().ui.prompt(i.title[1],i.placeholder[1],0,function(e,t,i){r=s(i),a(e,t).$().length||t.insert(R),c=u?' rel="nofollow" target="_blank"':"",t.format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+c)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),l=j.img,u=j.figure,c=j.figcaption,f=o.value,p=q.modals.img;return t.record().ui.prompt(p.title[0],p.placeholder[0],1,function(e,t,o){n=o,t.blur().ui.prompt(p.title[1],p.placeholder[1],0,function(e,t,o){r=o,f.length||(f=n.split(/[\/\\\\]/).pop()),f=s(f),t[0]().insert(""),r?(t.tidy("\n\n","").insert("<"+u+">\n"+M+"<"+l+' alt="'+f+'" src="'+n+'"'+H+"\n"+M+"<"+c+">"+r+"</"+i(c)+">\n</"+i(u)+">\n\n",-1),A&&E.tools.p.click(e,w)):a(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+l+' alt="'+f+'" src="'+n+'"'+H+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=j.sub,o=j.sup,l=i(o);return a(e,t)[0]().unwrap(r("<"+l+I+">"),"</"+l+">").format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=j.sub,o=j.sup,l=i(n);return a(e,t)[0]().unwrap(r("<"+l+I+">"),"</"+l+">").format(o)[1](),!1}},p:{i:"paragraph",click:function(e,t){var n=t.$(),o=j.p,u=j.br,c=i(o),a=i(u),s=n.before,f=n.after,p=l(s);if(n.length&&-1!==n.value.indexOf("\n")){var d=r("^(?:\\s*<"+c+I+">\\s*)+"+O+"(?:\\s*<\\/"+c+">\\s*)+$");d.test(n.value)?t[0]().replace(d,"$1").replace(r("\\s*<\\/"+c+">\\s*<"+c+I+">\\s*","g"),"\n\n").replace(r("\\s*<"+a+I+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+u+H+"\n").replace(r("(\\s*<"+a+I+H+"\\s*){2,}","g"),"</"+c+">\n<"+o+">").wrap("<"+o+">","</"+c+">",1).replace(r("(<"+c+I+">)+","g"),"$1").replace(r("(<\\/"+c+">)+","g"),"$1").tidy("\n")[1]()}else r("^\\s*<\\/"+c+">").test(f)?r("<"+c+I+">\\s*$").test(s)?t[0]().unwrap(r("\\s*<"+c+I+">\\s*"),r("\\s*<\\/"+c+">")).tidy("\n","\n"+p)[1]():(match=s.match(r("<"+c+z+">.*$")))&&t.wrap("</"+c+">\n"+p+"<"+c+match[1]+">",""):t[0]().format(o,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),o=[j.p,j.h1,j.h2,j.h3,j.h4,j.h5,j.h6],l=[];_(o,function(e,t){l[t]=i(e)});var u=(T(o).join("|"),T(l).join("|")),c="\\s*<("+u+")"+z+">\\s*",a=r("\\s*<(?:"+u+")"+I+">\\s*"),s=r("\\s*<\\/(?:"+u+")>\\s*"),f=n.value.match(r("^"+c));f||(f=n.before.match(r(c+"$"))||[]);var p=f[2]||"",d=+(f[1]||"h0").slice(1);return t[0]().replace(/\s+/g," ").unwrap(a,s).unwrap(a,s,1).format(d>5?l[0]+p:l[d+1]+p,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var n=t.$(),o=j.blockquote,l=j.q,u=j.p,c=i(u),a="<"+c+I+">";if(r("(^|\\n|"+a+")$").test(n.before)){if(A&&(n.value===R||r("("+a+")$").test(n.before)))return t.select(),!1;t[0]().format(o,0,"\n\n","\n"),A&&(!n.length||t.match(/^[^<\n]*?[^>]$/)?t.wrap(M+"<"+u+">","</"+c+">"):t[r("((^|\\n)"+M+")+").test(n.value)?"outdent":"indent"](M)),t[1]()}else t.format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function n(e){return u?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return u?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var l=t.$(),u=L.auto_encode_html,c=j.pre,a=j.code,s=i(c),f=i(a),p="<"+s+I+">\\s*<"+f+I+">\\s*",d="\\s*<\\/"+f+">\\s*<\\/"+s+">",h=r(p+"\\s*$"),g=r("^\\s*"+d),v=r("^"+O+"$");return r("(^|\\n|"+p+")$").test(l.before)?h.test(l.before)&&g.test(l.after)?t[0]().unwrap(r(h),r(g)).replace(v,o)[1]():t[0]().tidy("\n\n").wrap("<"+c+"><"+a+">","</"+f+"></"+s+">").insert(l.length?l.value:R).replace(v,n)[1]():t[0]().format(a).loss().replace(v,function(e){return r("^<\\/"+f+">").test(t.$().after)?n(e):o(e)})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=j.ol,o=j.ul,l=i(n),c=i(o),a=c+"|"+l;return t.match(r("<"+a+I+">"+O+"<\\/"+a+">"))?t[0]().replace(r("<"+l+z+">","g"),"<"+c+"$1>").replace(r("</"+l+">","g"),"</"+c+">")[1]():u(e,o,j.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=j.ol,o=j.ul,l=i(n),c=i(o),a=c+"|"+l;return t.match(r("<"+a+I+">"+O+"<\\/"+a+">"))?t[0]().replace(r("<"+c+z+">","g"),"<"+l+"$1>").replace(r("</"+c+">","g"),"</"+l+">")[1]():u(e,n,j.li),!1}},"align-left":c,"align-center":c,"align-right":c,"align-justify":c,hr:{i:"ellipsis-h",click:function(e,t){var n=l(t.$().before);return t.tidy("\n\n","").insert(n+"<"+j.hr+H+"\n\n",-1),!1}}}),_(E.tools,function(e,t){var r=q.tools[t]||"";n(e)?E.tools[t]={title:r,click:e}:e.title||(e.title=r)}),L.keys&&x(E.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+enter":"p","shift+enter":function(e,t){var n=l(t.$().before);return t.tidy("\n","").insert(n+"<"+j.br+H+"\n",-1),!1},enter:function(e,t){{var n,u,c=t.$(),a=t.get(),s=j.p,p=j.li,d=i(s),h=i(p);l(c.before)}if(!c.length){if(match=c.after.match(r("^\\s*<\\/("+d+"|"+h+")>")))n=match[1],E.tools["li"===n?f:n].click(e,t);else{if(!(A&&o(a).length&&c.end===a.length&&/^\s*[^<\n]*?[^>]\s*$/.test(a)))return;a="<"+s+">"+a+"</"+d+">\n<"+s+">",u="</"+d+">",t.set(a+u).select(a.length)}return!1}},backspace:function(e,t){var n,o=t.$(),i=o.before,l=o.after,u="<[^<>]+?>";return!o.length&&r(u+"$").test(i)?(n=i.split("<").pop().match(/^([^\/\s]+).*?>$/),n=n&&n[1]||0,n&&r("^\\s*<\\/"+n+">").test(l)?t.unwrap(r("<"+n+I+">"),r("\\s*<\\/"+n+">")):t.outdent(r(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+r":"hr"}),w.update({},0)},TE.HTML.__instance__=[];