/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e,t){return RegExp(e,t)}function r(e){return e.replace(/^\s*|\s*$/g,"")}function o(e,t,n){return t>e?t:e>n?n:e}function i(e){return e.split(/\s+/)[0]}function l(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function a(e,t,r){var o,a=y.$(),c=a.value,u=a.before,s=C[t],p=C[r]||r,d=i(s),h=i(p),b=l(u),g=j[""];return f=s,y[0](),c&&c!==g?(y.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+h+">\n"+I+"<"+p+">").wrap("<"+s+">\n"+I+"<"+p+">","</"+h+">\n</"+d+">\n\n",1).replace(n("\\n"+I+"<"+p+">\\s*<\\/"+h+">\\n","g"),"\n</"+d+">\n\n<"+s+">\n").select(y.$().end),S&&T.tools.p.click(e,y),y[1](),!1):void((o=u.match(n("(?:^|\\n)[\\t ]+<(\\/?)(?:"+i(C.ul)+"|"+i(C.ol)+")"+H+">\\s*$")))?y.insert("\n"+b+(o[1]?"":I),-1):(o=u.match(n("<"+h+z+">.*?$")))?n("<\\/"+h+">\\s*$").test(u)?y.tidy("\n"+b,!1).insert(g).wrap("<"+h+o[1]+">","</"+h+">"):/>\s*$/.test(u)?y.insert(g).wrap("\n"+b+I+"<"+s+">\n"+b+I+I+"<"+h+o[1]+">","</"+h+">\n"+b+I+"</"+d+">\n"+b):y.insert("</"+h+">\n"+b+"<"+h+o[1]+">",-1).insert(g):n("<\\/"+h+">\\s*$").test(u)?y.insert(g).wrap("\n"+b+"<"+p+">","</"+h+">"):y.tidy("\n\n").insert(g).wrap("<"+s+">\n"+I+"<"+p+">","</"+h+">\n</"+d+">"))}function c(e,t){return!t.get(0)&&S&&T.tools.p.click(e,t),t}function u(e){return s(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function s(e){return r(e.replace(/\s+/g," "))}var f,p="\u2013",d="\u2026",h="\u2191",b="\u2193",g="\u21b5",m="\u2318",v="\u2718",$="\u21e7",k=window,y=new TE(e),w=y._.extend,x=y._.each,_=y._.x,T=y.ui(w({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",v],b:["Bold",m+"+B"],i:["Italic",m+"+I"],u:["Underline",m+"+U"],s:["Strike",m+"+"+v],a:["Link",m+"+L"],img:["Image",m+"+G"],sub:["Subscript",m+"+"+b],sup:["Superscript",m+"+"+h],abbr:["Abbreviation",m+"+"+$+"+?"],p:["Paragraph",m+"+"+g],"p,h1,h2,h3,h4,h5,h6":["H1 "+p+" H6",m+"+H"],"blockquote,q":["Quote",m+"+Q"],"pre,code":["Code",m+"+K"],ul:["Unordered List",m+"+-"],ol:["Ordered List",m+"++"],table:["Table",m+"+T"],hr:["Horizontal Rule",m+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+d]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+d,"image caption here"+d]},abbr:{title:"Abbreviation",placeholder:"meaning here"+d},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+d]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),E=y._.format,q=y.config,L=q.states,O=q.languages,C=q.formats,I=(q.classes,q.tab),M=q.suffix,H="(?:\\s[^<>]*?)?",z="(|\\s[^<>]*?)",R="([\\s\\S]*?)",j=O.placeholders,S=q.auto_p;return y.type="HTML",w(T.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return c(e,t).i().format(C.b),!1}},i:{i:"italic",click:function(e,t){return c(e,t).i().format(C.i),!1}},u:{i:"underline",click:function(e,t){return c(e,t).i().format(C.u),!1}},s:{i:"strikethrough",click:function(e,t){return c(e,t).i().format(E(C.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=C.a,i=O.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,l){l=s(l),n=l;var a,f,p=k.location.host;-1!==n.indexOf("://")&&(a=1),""!==p&&-1!==n.indexOf("://"+p)&&(a=0),/^([.\/?&#]|javascript:)/.test(n)&&(a=0),t.blur().ui.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=u(i),c(e,t).$().length||t.insert(j[""]),f=q.advance_a&&a?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+f)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),l=C.img,a=C.figure,f=C.figcaption,p=o.value,d=O.modals.img,h=q.advance_img;return t.ui.prompt(["img[src]",d.title[0]],d.placeholder[0],1,function(e,t,o){o=s(o),n=o,t.blur().ui.prompt(["img[title]",d.title[h?2:1]],d.placeholder[h?2:1],0,function(e,t,o){r=u(o),p||(p=n.split(/[\/\\\\]/).pop()),p=u(p),t[0](),h&&r?(t.tidy("\n\n","").insert("<"+a+">\n"+I+"<"+l+' alt="'+p+'" src="'+n+'"'+M+"\n"+I+"<"+f+">"+r+"</"+i(f)+">\n</"+i(a)+">\n\n",-1,1),S&&T.tools.p.click(e,y)):c(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+l+' alt="'+p+'" src="'+n+'"'+(r?' title="'+r+'"':"")+M+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=C.sub,o=C.sup,l=i(o);return c(e,t)[0]().unwrap(n("<"+l+H+">"),"</"+l+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=C.sub,o=C.sup,l=i(r);return c(e,t)[0]().unwrap(n("<"+l+H+">"),"</"+l+">").i().format(o)[1](),!1}},abbr:{i:"question",click:function(e,t){var o,l,a=t.$(),u=r(a.value),s=O.modals.abbr,f=t.get(),p=r(u||j[""]),d=C.abbr,h=i(d),b="<"+_(d)+z+">",g="<"+_(d)+H+">",m="<\\/"+h+">",v=n(b+R+m);return f.replace(v,function(e,t,n){(n=r(n))&&(L.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),o=L.abbr,u&&o[u]?(t.i().format(d+' title="'+o[u]+'"'),!1):(t.record().ui.prompt(["abbr[title]",s.title],o[p]||s.placeholder,!o[u],function(e,t,i,a){i=r(i||a),t[0]();for(l in o)if(o[l]===i){t.insert(l);break}c(e,t).unwrap(n(g),n(m)).unwrap(n(g),n(m),1).i().format(d+' title="'+i+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r,o=t.$(),a=o.value,c=C.p,u=C.br,s=i(c),f=i(u),p=o.before,d=o.after,h=l(p),b=j[""];return t[0](),a&&-1!==a.indexOf("\n")?(r=n("^(?:\\s*<"+s+H+">\\s*)+"+R+"(?:\\s*<\\/"+s+">\\s*)+$"),r.test(o.value)?t.replace(r,"$1").replace(n("\\s*<\\/"+s+">\\s*<"+s+H+">\\s*","g"),"\n\n").replace(n("\\s*<"+f+H+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+u+M+"\n").replace(n("(\\s*<"+f+H+M+"\\s*){2,}","g"),"</"+s+">\n<"+c+">").wrap("<"+c+">","</"+s+">",1).replace(n("(<"+s+H+">)+","g"),"$1").replace(n("(<\\/"+s+">)+","g"),"$1").tidy("\n")):n("^\\s*<\\/"+s+">").test(d)?n("<"+s+H+">\\s*$").test(p)?t.unwrap(n("\\s*<"+s+H+">\\s*"),n("\\s*<\\/"+s+">")).replace(b,"").tidy("\n","\n"+h):(match=p.match(n("<"+s+z+">.*?$")))&&t.wrap("</"+s+">\n"+h+"<"+s+match[1]+">","").insert(b):t.format(c,0,"\n\n"),t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r,o,l,a,c,u,s,f,p=t.$(),d=[C.p,C.h1,C.h2,C.h3,C.h4,C.h5,C.h6],h=[];return x(d,function(e,t){h[t]=i(e)}),r=_(d).join("|"),o=_(h).join("|"),l="\\s*<("+o+")"+z+">\\s*",a=n("\\s*<(?:"+o+")"+H+">\\s*"),c=n("\\s*<\\/(?:"+o+")>\\s*"),u=p.value.match(n("^"+l)),u||(u=p.before.match(n(l+"$"))||[]),s=u[2]||"",f=+(u[1]||"h0").slice(1),t[0]().unwrap(a,c).unwrap(a,c,1).i().tidy("\n\n").format(f>5?h[0]+s:h[f+1]+s,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var r=t.$(),o=r.value,l=C.blockquote,a=C.q,c=C.p,u=i(c),s="<"+u+H+">";if(n("(^|\\n|"+s+")$").test(r.before)){if(S&&(r.value===j[""]||n("("+s+")$").test(r.before)))return t.select(),!1;t[0]().format(l,0,"\n\n","\n"),S&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(I+"<"+c+">","</"+u+">"):t[n("((^|\\n)"+I+")+").test(r.value)?"outdent":"indent"](I)),t[1]()}else t.i().format(a);return!1}},"pre,code":{i:"code",click:function(e,t){function r(e){return c?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return c?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var l=t.$(),a=l.value,c=q.auto_encode_html,u=C.pre,f=C.code,p=i(u),d=i(f),h="<"+p+H+">\\s*<"+d+H+">\\s*",b="\\s*<\\/"+d+">\\s*<\\/"+p+">",g=n(h+"\\s*$"),m=n("^\\s*"+b),v=n("^"+R+"$");return n("(^|\\n|"+h+")$").test(l.before)?g.test(l.before)&&m.test(l.after)?t[0]().unwrap(n(g),n(m)).replace(v,o)[1]():t[0]().tidy("\n\n").wrap("<"+u+"><"+f+">","</"+d+"></"+p+">").insert(a||j[""]).replace(v,r)[1]():t[0]().format(f).loss().replace(v,function(e){return s(n("^<\\/"+d+">").test(t.$().after)?r(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=C.ol,o=C.ul,l=i(r),c=i(o),u="("+_(c)+"|"+_(l)+")";return t.match(n("<"+u+H+">"+R+"<\\/"+u+">"))?t[0]().replace(n("<"+l+z+">","g"),"<"+c+"$1>").replace(n("</"+l+">","g"),"</"+c+">")[1]():a(e,o,C.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=C.ol,o=C.ul,l=i(r),c=i(o),u="("+_(c)+"|"+_(l)+")";return t.match(n("<"+u+H+">"+R+"<\\/"+u+">"))?t[0]().replace(n("<"+c+z+">","g"),"<"+l+"$1>").replace(n("</"+c+">","g"),"</"+l+">")[1]():a(e,r,C.li),!1}},table:function(e,t){var n,l,a,c,u=L.tr,f=L.td,p=O.modals.table,d=O.placeholders.table,h=r(E(d[0],[1,1])),b=q.advance_table?I:"",g=C.table,m=C.caption,v=C.thead,$=C.tbody,k=C.tfoot,y=C.tr,w=C.th,x=C.td,_=i(g),T=i(m),M=i(v),H=i($),z=i(k),R=i(y),j=i(w),S=i(x),D=[];return t.$().value===h?(t.select(),!1):(t[0]().ui.prompt(["table>td",p.title[0]],p.placeholder[0],0,function(e,t,i,q){l=o(parseInt(i,10)||q,f[0],f[1]),t.blur().ui.prompt(["table>tr",p.title[1]],p.placeholder[1],0,function(e,t,i,f){a=o(parseInt(i,10)||f,u[0],u[1]),t.blur().ui.prompt(["table>caption",p.title[2]],p.placeholder[2],0,function(e,t,o){var i,u,f,p,q,L="";for(c=s(o),i=0;a>i;++i){for(n=b+I+"<"+y+">\n",u=0;l>u;++u)n+=b+I+I+"<"+x+">"+r(E(d[1],[i+1,u+1]))+"</"+S+">\n";n+=b+I+"</"+R+">",D.push(n)}for(D=D.join("\n"),n=I+(b?"<"+v+">\n"+I+I+"<"+y+">":"<"+R+">")+"\n",f=0;l>f;++f)n+=b+I+I+"<"+w+">"+r(E(d[0],[1,f+1]))+"</"+j+">\n";if(b){for(L+=I+"<"+k+">\n",L+=I+I+"<"+y+">\n",f=0;l>f;++f)L+=I+I+I+"<"+x+">"+r(E(d[2],[1,f+1]))+"</"+S+">\n";L+=I+I+"</"+y+">\n",L+=I+"</"+z+">\n"}n+=b+I+"</"+R+">"+(b?"\n"+I+"</"+M+">\n"+L+I+"<"+$+">":"")+"\n",D=n+D+(b?"\n"+I+"</"+H+">":"")+"\n",t.tidy("\n\n").insert("<"+g+">\n"+(c?I+"<"+m+">"+c+"</"+T+">\n":"")+D+"</"+_+">",0),p=t.$(),q=p.start+p.value.indexOf(h),t.select(q,q+h.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=l(t.$().before);return t.tidy("\n\n","").insert(n+"<"+C.hr+M+"\n\n",-1),!1}}}),q.keys&&w(T.keys,{delete:"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=l(t.$().before);return t.tidy("\n","").insert(n+"<"+C.br+M+"\n",-1),!1},enter:function(e,t){var o,a,c=t.$(),u=c.value,s=t.get(),p=C.p,d=C.li,h=i(p),b=i(d),g=(l(c.before),j[""]);if(!u||u===g){if(match=c.after.match(n("^\\s*<\\/("+h+"|"+b+")>")))o=match[1],T.tools["li"===o?f:o].click(e,t);else{if(!(S&&r(s)&&c.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+p+">"+s+"</"+h+">\n<"+p+">",a=g+"</"+h+">",t.set(s+a).select(s.length,(s+g).length)}return!1}},tab:function(e,t){var r=t.$(),o=C.li,a=i(o),c=l(r.before);return n("<\\/"+o+">").test(r.after)?(t[0]().wrap("\n"+c+I+"<"+(C[f]||f)+">\n"+c+I+I+"<"+o+">","</"+a+">\n"+c+I+"</"+f+">\n"+c).insert(j[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var r,o=t.$(),i=o.value,l=o.before,a=o.after,c="<[^<>]+?>";return!i&&n(c+"$").test(l)?(r=l.split("<").pop().match(/^([^\/\s]+).*?>$/),r=r&&r[1]||0,r&&n("^\\s*<\\/"+r+">").test(a)?t.unwrap(n("<"+r+H+">"),n("\\s*<\\/"+r+">")):t.outdent(n(c)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),y.update({},0)};