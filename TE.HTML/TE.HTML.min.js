/*!
 * ==========================================================
 *  HTML EDITOR PLUGIN 1.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(t,e){function n(t){return"function"==typeof t}function r(t,e){return RegExp(t,e)}function l(t){return t.replace(/^\s*|\s*$/g,"")}function i(t){return t.split(/\s+/)[0]}function o(t){var e=t.match(/(?:^|\n)([\t ]*).*$/);return e&&e[1]||""}function a(t,e,n){var l=y.$(),a=l.before,c=R[e],u=R[n]||n,s=i(c),f=i(u),g=o(a);if(p=c,l.length)y[0]().tidy("\n\n","").replace(/\n/g,"</"+f+">\n"+H+"<"+u+">").wrap("<"+c+">\n"+H+"<"+u+">","</"+f+">\n</"+s+">\n\n",1).replace(r("\\n"+H+"<"+u+">\\s*<\\/"+f+">\\n","g"),"\n</"+s+">\n\n<"+c+">\n").select(y.$().end),S&&j.tools.p.click(t,y),y[1]();else{var h=a.match(r("<"+f+U+">.*$"));h?/>\s*$/.test(a)?r("<\\/"+f+">\\s*$").test(a)||y.wrap("\n"+g+H+"<"+c+">\n"+g+H+H+"<"+f+h[1]+">","</"+f+">\n"+g+H+"</"+s+">\n"+g):y.insert("</"+f+">\n"+g+"<"+f+h[1]+">",-1):y.tidy("\n\n","").wrap("<"+c+">\n"+H+"<"+u+">","</"+f+">\n</"+s+">")}return y}function c(t,e,n){var l,o,a=(e.$(),R.align),c=i(a);n=n.split("-"),l=r("<"+L(_(a),[n[0],"(?:"+E.formats.align.join("|")+")"])+">\\s*"),o=r("\\s*<\\/"+c+">"),e[0]().unwrap(l,o).unwrap(l,o,1).format(L(a,n),0,"\n\n","\n")[1]()}function u(t,e){return!e.get(0)&&S&&j.tools.p.click(t,e),e}function s(t){return t.replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}var p,f="\u2013",g="\u2026",h="\u2191",d="\u2193",m="\u21B5",b="\u2318",$="\u2718",k="\u21E5",v="\u21E7",w=window,y=new TE(t),q=y._.extend,x=y._.each,_=y._.x,j=y.create(q({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | a img | p | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | align-left align-center align-right align-justify | hr | undo redo",css:"html,body{background:#fff;color:#000}.align-left{text-align:left}.align-center{text-align:center}.align-right{text-align:right}.align-justify{text-align:justify}",languages:{tools:{clear:"Clear Format ("+$+")",b:"Bold ("+b+"+B)",i:"Italic ("+b+"+I)",u:"Underline ("+b+"+U)",s:"Strike ("+b+"+"+$+")",a:"Link ("+b+"+L)",img:"Image ("+b+"+G)",sub:"Subscript ("+b+"+"+d+")",sup:"Subscript ("+b+"+"+h+")",p:"Paragraph ("+b+"+"+m+")","p,h1,h2,h3,h4,h5,h6":"H1 "+f+" H6 ("+b+"+H)","blockquote,q":"Quote ("+b+"+Q)","pre,code":"Code ("+b+"+K)",ul:"Unordered List ("+b+"+-)",ol:"Ordered List ("+b+"++)",indent:"Indent ("+k+")",outdent:"Outdent ("+v+"+"+k+")","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify","align-top":"Align Top","align-middle":"Align Middle","align-bottom":"Align Bottom",hr:"Horizontal Rule ("+b+"+R)"},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+g]},img:{title:["Image URL","Image Caption"],placeholder:["http://","image caption here"+g]}}},classes:{formats:{align:["left","center","right","justify","top","middle","bottom",""]}},formats:{align:'div class="%1-%2"',b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",hr:"hr"}},e)),L=y._.format,A=y.config,I=A.languages,R=A.formats,E=A.classes,H=A.tab,O=A.suffix,T="(?:\\s[^<>]*?)?",U="(|\\s[^<>]*?)",B="([\\s\\S]*?)",C=I.others.placeholder,S=A.auto_p;return q(j.tools,{clear:{i:"eraser",click:function(t,e){var n=e.$().value;if(n.length)return e[0]().replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/),e.$().value===n&&e.insert(""),e[1](),!1}},b:{i:"bold",click:function(t,e){return u(t,e).format(R.b),!1}},i:{i:"italic",click:function(t,e){return u(t,e).format(R.i),!1}},u:{i:"underline",click:function(t,e){return u(t,e).format(R.u),!1}},s:{i:"strikethrough",click:function(t,e){return u(t,e).format(L(R.s,e._.time())),!1}},a:{i:"link",click:function(t,e){var n,r,l=R.a,i=I.modals.a;return e.record().ui.prompt(i.title[0],i.placeholder[0],1,function(t,e,o){n=o;var a,c,p=w.location.host;-1!==n.indexOf("://")&&(a=1),""!==p&&-1!==n.indexOf("://"+p)&&(a=0),/^([.\/?&#]|javascript:)/.test(n)&&(a=0),e.blur().ui.prompt(i.title[1],i.placeholder[1],0,function(t,e,i){r=s(i),u(t,e).$().length||e.insert(C),c=a?' rel="nofollow" target="_blank"':"",e.format(l+' href="'+n+'"'+(r?' title="'+r+'"':"")+c)})}),!1}},img:{i:"image",click:function(t,e){var n,r,l=e.$(),o=R.img,a=R.figure,c=R.figcaption,p=l.value,f=I.modals.img;return e.record().ui.prompt(f.title[0],f.placeholder[0],1,function(t,e,l){n=l,e.blur().ui.prompt(f.title[1],f.placeholder[1],0,function(t,e,l){r=l,p.length||(p=n.split(/[\/\\\\]/).pop()),p=s(p),e[0]().insert(""),r?(e.tidy("\n\n","").insert("<"+a+">\n"+H+"<"+o+' alt="'+p+'" src="'+n+'"'+O+"\n"+H+"<"+c+">"+r+"</"+i(c)+">\n</"+i(a)+">\n\n",-1),S&&j.tools.p.click(t,y)):u(t,e).tidy(/<[^\/<>]+?>\s*$/.test(e.$().before)?"":" ","").insert("<"+o+' alt="'+p+'" src="'+n+'"'+O+" ",-1),e[1]()})}),!1}},sub:{i:"subscript",click:function(t,e){var n=R.sub,l=R.sup,o=i(l);return u(t,e)[0]().unwrap(r("<"+o+T+">"),"</"+o+">").format(n)[1](),!1}},sup:{i:"superscript",click:function(t,e){var n=R.sub,l=R.sup,o=i(n);return u(t,e)[0]().unwrap(r("<"+o+T+">"),"</"+o+">").format(l)[1](),!1}},p:{i:"paragraph",click:function(t,e){var n=e.$(),l=R.p,a=R.br,c=i(l),u=i(a),s=n.before,p=n.after,f=o(s);if(n.length&&-1!==n.value.indexOf("\n")){var g=r("^(?:\\s*<"+c+T+">\\s*)+"+B+"(?:\\s*<\\/"+c+">\\s*)+$");g.test(n.value)?e[0]().replace(g,"$1").replace(r("\\s*<\\/"+c+">\\s*<"+c+T+">\\s*","g"),"\n\n").replace(r("\\s*<"+u+T+">\\s*","g"),"\n")[1]():e[0]().replace(/\n/g,"\n<"+a+O+"\n").replace(r("(\\s*<"+u+T+O+"\\s*){2,}","g"),"</"+c+">\n<"+l+">").wrap("<"+l+">","</"+c+">",1).replace(r("(<"+c+T+">)+","g"),"$1").replace(r("(<\\/"+c+">)+","g"),"$1").tidy("\n")[1]()}else r("^\\s*<\\/"+c+">").test(p)?r("<"+c+T+">\\s*$").test(s)?e[0]().unwrap(r("\\s*<"+c+T+">\\s*"),r("\\s*<\\/"+c+">")).tidy("\n","\n"+f)[1]():(match=s.match(r("<"+c+U+">.*$")))&&e.wrap("</"+c+">\n"+f+"<"+c+match[1]+">",""):e[0]().format(l,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(t,e){var n=e.$(),l=[R.p,R.h1,R.h2,R.h3,R.h4,R.h5,R.h6],o=[];x(l,function(t,e){o[e]=i(t)});var a=(_(l).join("|"),_(o).join("|")),c="\\s*<("+a+")"+U+">\\s*",u=r("\\s*<(?:"+a+")"+T+">\\s*"),s=r("\\s*<\\/(?:"+a+")>\\s*"),p=n.value.match(r("^"+c));p||(p=n.before.match(r(c+"$"))||[]);var f=p[2]||"",g=+(p[1]||"h0").slice(1);return e[0]().replace(/\s+/g," ").unwrap(u,s).unwrap(u,s,1).format(g>5?o[0]+f:o[g+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(t,e){var n=e.$(),l=R.blockquote,o=R.q,a=R.p,c=i(a),u="<"+c+T+">";if(r("(^|\\n|"+u+")$").test(n.before)){if(S&&(n.value===C||r("("+u+")$").test(n.before)))return e.select(),!1;e[0]().format(l,0,"\n\n","\n"),S&&(!n.length||e.match(/^[^<\n]*?[^>]$/)?e.wrap(H+"<"+a+">","</"+c+">"):e[r("((^|\\n)"+H+")+").test(n.value)?"outdent":"indent"](H)),e[1]()}else e.format(o);return!1}},"pre,code":{i:"code",click:function(t,e){function n(t){return a?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}function l(t){return a?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}var o=e.$(),a=A.auto_encode_html,c=R.pre,u=R.code,s=i(c),p=i(u),f="<"+s+T+">\\s*<"+p+T+">\\s*",g="\\s*<\\/"+p+">\\s*<\\/"+s+">",h=r(f+"\\s*$"),d=r("^\\s*"+g),m=r("^"+B+"$");return r("(^|\\n|"+f+")$").test(o.before)?h.test(o.before)&&d.test(o.after)?e[0]().unwrap(r(h),r(d)).replace(m,l)[1]():e[0]().tidy("\n\n").wrap("<"+c+"><"+u+">","</"+p+"></"+s+">").insert(o.length?o.value:C).replace(m,n)[1]():e[0]().format(u).loss().replace(m,function(t){return r("^<\\/"+p+">").test(e.$().after)?n(t):l(t)})[1](),!1}},ul:{i:"list-ul",click:function(t,e){var n=R.ol,l=R.ul,o=i(n),c=i(l),u=c+"|"+o;return e.match(r("<"+u+T+">"+B+"<\\/"+u+">"))?e[0]().replace(r("<"+o+U+">","g"),"<"+c+"$1>").replace(r("</"+o+">","g"),"</"+c+">")[1]():a(t,l,R.li),!1}},ol:{i:"list-ol",click:function(t,e){var n=R.ol,l=R.ul,o=i(n),c=i(l),u=c+"|"+o;return e.match(r("<"+u+T+">"+B+"<\\/"+u+">"))?e[0]().replace(r("<"+c+U+">","g"),"<"+o+"$1>").replace(r("</"+c+">","g"),"</"+o+">")[1]():a(t,n,R.li),!1}},"align-left":c,"align-center":c,"align-right":c,"align-justify":c,hr:{i:"ellipsis-h",click:function(t,e){var n=o(e.$().before);return e.tidy("\n\n","").insert(n+"<"+R.hr+O+"\n\n",-1),!1}}}),x(j.tools,function(t,e){var r=I.tools[e]||"";n(t)?j.tools[e]={title:r,click:t}:t.title||(t.title=r)}),q(j.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+enter":"p","shift+enter":function(t,e){var n=o(e.$().before);return e.tidy("\n","").insert(n+"<"+R.br+O+"\n",-1),!1},enter:function(t,e){{var n,a,c=e.$(),u=e.get(),s=R.p,f=R.li,g=i(s),h=i(f);o(c.before)}if(!c.length){if(match=c.after.match(r("^\\s*<\\/("+g+"|"+h+")>")))n=match[1],j.tools["li"===n?p:n].click(t,e);else{if(!(S&&l(u).length&&c.end===u.length&&/^\s*[^<\n]*?[^>]\s*$/.test(u)))return;u="<"+s+">"+u+"</"+g+">\n<"+s+">",a="</"+g+">",e.set(u+a).select(u.length)}return!1}},backspace:function(t,e){var n,l=e.$(),i=l.before,o=l.after,a="<[^<>]+?>";return!l.length&&r(a+"$").test(i)?(n=i.split("<").pop().match(/^([^\/\s]+).*?>$/),n=n&&n[1]||0,n&&r("^\\s*<\\/"+n+">").test(o)?e.unwrap(r("<"+n+T+">"),r("\\s*<\\/"+n+">")):e.outdent(r(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+r":"hr"}),y.update()};