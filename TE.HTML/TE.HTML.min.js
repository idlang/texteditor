/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e,t){return RegExp(e,t)}function r(e){return e.replace(/^\s*|\s*$/g,"")}function o(e,t,n){return t>e?t:e>n?n:e}function i(e){return e.split(/\s+/)[0]}function a(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function l(e,t,r){var o=y.$(),l=o.value,u=o.before,c=C[t],s=C[r]||r,p=i(c),d=i(s),h=a(u);if(f=c,l)y[0]().tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+d+">\n"+I+"<"+s+">").wrap("<"+c+">\n"+I+"<"+s+">","</"+d+">\n</"+p+">\n\n",1).replace(n("\\n"+I+"<"+s+">\\s*<\\/"+d+">\\n","g"),"\n</"+p+">\n\n<"+c+">\n").select(y.$().end),z&&T.tools.p.click(e,y),y[1]();else{if(n("\\s+<\\/"+i(C.ul)+"|"+i(C.ol)+">\\s*").test(u))return y.select(),!1;var b=u.match(n("<"+d+N+">.*$"));b?n("<\\/"+d+">\\s*$").test(u)?y.tidy("\n"+h,!1).wrap("<"+d+b[1]+">","</"+d+">"):/>\s*$/.test(u)?n("<\\/"+d+">\\s*$").test(u)||y.wrap("\n"+h+I+"<"+c+">\n"+h+I+I+"<"+d+b[1]+">","</"+d+">\n"+h+I+"</"+p+">\n"+h):y.insert("</"+d+">\n"+h+"<"+d+b[1]+">",-1):y.tidy("\n\n","").wrap("<"+c+">\n"+I+"<"+s+">","</"+d+">\n</"+p+">")}}function u(e,t){return!t.get(0)&&z&&T.tools.p.click(e,t),t}function c(e){return s(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function s(e){return r(e.replace(/\s+/g," "))}var f,p="\u2013",d="\u2026",h="\u2191",b="\u2193",m="\u21B5",g="\u2318",v="\u2718",$="\u21E7",k=window,y=new TE(e),w=y._.extend,x=y._.each,_=y._.x,T=y.create(w({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",v],b:["Bold",g+"+B"],i:["Italic",g+"+I"],u:["Underline",g+"+U"],s:["Strike",g+"+"+v],a:["Link",g+"+L"],img:["Image",g+"+G"],sub:["Subscript",g+"+"+b],sup:["Superscript",g+"+"+h],abbr:["Abbreviation",g+"+"+$+"+?"],p:["Paragraph",g+"+"+m],"p,h1,h2,h3,h4,h5,h6":["H1 "+p+" H6",g+"+H"],"blockquote,q":["Quote",g+"+Q"],"pre,code":["Code",g+"+K"],ul:["Unordered List",g+"+-"],ol:["Ordered List",g+"++"],table:["Table",g+"+T"],hr:["Horizontal Rule",g+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+d]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+d,"image caption here"+d]},abbr:{title:"Abbreviation",placeholder:"meaning here"+d},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+d]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),q=y._.format,E=y.config,L=E.states,O=E.languages,C=E.formats,I=(E.classes,E.tab),H=E.suffix,R="(?:\\s[^<>]*?)?",N="(|\\s[^<>]*?)",M="([\\s\\S]*?)",j=O.placeholders,z=E.auto_p;return y.type="HTML",y.i=function(){return y.replace(/\s+/g," ")},w(T.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return u(e,t).i().format(C.b),!1}},i:{i:"italic",click:function(e,t){return u(e,t).i().format(C.i),!1}},u:{i:"underline",click:function(e,t){return u(e,t).i().format(C.u),!1}},s:{i:"strikethrough",click:function(e,t){return u(e,t).i().format(q(C.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=C.a,i=O.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,a){a=s(a),n=a;var l,f,p=k.location.host;-1!==n.indexOf("://")&&(l=1),""!==p&&-1!==n.indexOf("://"+p)&&(l=0),/^([.\/?&#]|javascript:)/.test(n)&&(l=0),t.blur().ui.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=c(i),u(e,t).$().length||t.insert(j[""]),f=E.advance_a&&l?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+f)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),a=C.img,l=C.figure,f=C.figcaption,p=o.value,d=O.modals.img,h=E.advance_img;return t.ui.prompt(["img[src]",d.title[0]],d.placeholder[0],1,function(e,t,o){o=s(o),n=o,t.blur().ui.prompt(["img[title]",d.title[h?2:1]],d.placeholder[h?2:1],0,function(e,t,o){r=c(o),p||(p=n.split(/[\/\\\\]/).pop()),p=c(p),t[0]().insert(""),h&&r?(t.tidy("\n\n","").insert("<"+l+">\n"+I+"<"+a+' alt="'+p+'" src="'+n+'"'+H+"\n"+I+"<"+f+">"+r+"</"+i(f)+">\n</"+i(l)+">\n\n",-1),z&&T.tools.p.click(e,y)):u(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+a+' alt="'+p+'" src="'+n+'"'+(r?' title="'+r+'"':"")+H+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=C.sub,o=C.sup,a=i(o);return u(e,t)[0]().unwrap(n("<"+a+R+">"),"</"+a+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=C.sub,o=C.sup,a=i(r);return u(e,t)[0]().unwrap(n("<"+a+R+">"),"</"+a+">").i().format(o)[1](),!1}},abbr:{i:"question",click:function(e,t){var o,a,l=t.$(),u=r(l.value),c=O.modals.abbr,s=t.get(),f=r(u||j[""]),p=C.abbr,d=i(p),h="<"+_(p)+N+">",b="<"+_(p)+R+">",m="<\\/"+d+">",g=n(h+M+m);return s.replace(g,function(e,t,n){(n=r(n))&&(L.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),o=L.abbr,u&&o[u]?(t.i().format(p+' title="'+o[u]+'"'),!1):(t.record().ui.prompt(["abbr[title]",c.title],o[f]||c.placeholder,!o[u],function(e,t,i,l){i=r(i||l),t[0]();for(a in o)if(o[a]===i){t.insert(a);break}t.unwrap(n(b),n(m)).unwrap(n(b),n(m),1).i().format(p+' title="'+i+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r=t.$(),o=r.value,l=C.p,u=C.br,c=i(l),s=i(u),f=r.before,p=r.after,d=a(f);if(o&&-1!==o.indexOf("\n")){var h=n("^(?:\\s*<"+c+R+">\\s*)+"+M+"(?:\\s*<\\/"+c+">\\s*)+$");h.test(r.value)?t[0]().replace(h,"$1").replace(n("\\s*<\\/"+c+">\\s*<"+c+R+">\\s*","g"),"\n\n").replace(n("\\s*<"+s+R+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+u+H+"\n").replace(n("(\\s*<"+s+R+H+"\\s*){2,}","g"),"</"+c+">\n<"+l+">").wrap("<"+l+">","</"+c+">",1).replace(n("(<"+c+R+">)+","g"),"$1").replace(n("(<\\/"+c+">)+","g"),"$1").tidy("\n")[1]()}else n("^\\s*<\\/"+c+">").test(p)?n("<"+c+R+">\\s*$").test(f)?t[0]().unwrap(n("\\s*<"+c+R+">\\s*"),n("\\s*<\\/"+c+">")).tidy("\n","\n"+d)[1]():(match=f.match(n("<"+c+N+">.*$")))&&t.wrap("</"+c+">\n"+d+"<"+c+match[1]+">",""):t[0]().format(l,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),o=[C.p,C.h1,C.h2,C.h3,C.h4,C.h5,C.h6],a=[];x(o,function(e,t){a[t]=i(e)});var l=(_(o).join("|"),_(a).join("|")),u="\\s*<("+l+")"+N+">\\s*",c=n("\\s*<(?:"+l+")"+R+">\\s*"),s=n("\\s*<\\/(?:"+l+")>\\s*"),f=r.value.match(n("^"+u));f||(f=r.before.match(n(u+"$"))||[]);var p=f[2]||"",d=+(f[1]||"h0").slice(1);return t[0]().unwrap(c,s).unwrap(c,s,1).i().format(d>5?a[0]+p:a[d+1]+p,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var r=t.$(),o=r.value,a=C.blockquote,l=C.q,u=C.p,c=i(u),s="<"+c+R+">";if(n("(^|\\n|"+s+")$").test(r.before)){if(z&&(r.value===j[""]||n("("+s+")$").test(r.before)))return t.select(),!1;t[0]().format(a,0,"\n\n","\n"),z&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(I+"<"+u+">","</"+c+">"):t[n("((^|\\n)"+I+")+").test(r.value)?"outdent":"indent"](I)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function r(e){return u?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return u?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var a=t.$(),l=a.value,u=E.auto_encode_html,c=C.pre,f=C.code,p=i(c),d=i(f),h="<"+p+R+">\\s*<"+d+R+">\\s*",b="\\s*<\\/"+d+">\\s*<\\/"+p+">",m=n(h+"\\s*$"),g=n("^\\s*"+b),v=n("^"+M+"$");return n("(^|\\n|"+h+")$").test(a.before)?m.test(a.before)&&g.test(a.after)?t[0]().unwrap(n(m),n(g)).replace(v,o)[1]():t[0]().tidy("\n\n").wrap("<"+c+"><"+f+">","</"+d+"></"+p+">").insert(l||j[""]).replace(v,r)[1]():t[0]().format(f).loss().replace(v,function(e){return s(n("^<\\/"+d+">").test(t.$().after)?r(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=C.ol,o=C.ul,a=i(r),u=i(o),c="("+_(u)+"|"+_(a)+")";return t.match(n("<"+c+R+">"+M+"<\\/"+c+">"))?t[0]().replace(n("<"+a+N+">","g"),"<"+u+"$1>").replace(n("</"+a+">","g"),"</"+u+">")[1]():l(e,o,C.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=C.ol,o=C.ul,a=i(r),u=i(o),c="("+_(u)+"|"+_(a)+")";return t.match(n("<"+c+R+">"+M+"<\\/"+c+">"))?t[0]().replace(n("<"+u+N+">","g"),"<"+a+"$1>").replace(n("</"+u+">","g"),"</"+a+">")[1]():l(e,r,C.li),!1}},table:function(e,t){var n,a,l,u,c=L.tr,f=L.td,p=O.modals.table,d=O.placeholders.table,h=r(q(d[0],[1,1])),b=E.advance_table?I:"",m=C.table,g=C.caption,v=C.thead,$=C.tbody,k=C.tfoot,y=C.tr,w=C.th,x=C.td,_=i(m),T=i(g),H=i(v),R=i($),N=i(k),M=i(y),j=i(w),z=i(x),A=[];return t.$().value===h?(t.select(),!1):(t[0]().insert("").ui.prompt(["table>td",p.title[0]],p.placeholder[0],0,function(e,t,i,E){a=o(parseInt(i,10)||E,f[0],f[1]),t.blur().ui.prompt(["table>tr",p.title[1]],p.placeholder[1],0,function(e,t,i,f){l=o(parseInt(i,10)||f,c[0],c[1]),t.blur().ui.prompt(["table>caption",p.title[2]],p.placeholder[2],0,function(e,t,o){var i,c,f,p,E,L="";for(u=s(o),i=0;l>i;++i){for(n=b+I+"<"+y+">\n",c=0;a>c;++c)n+=b+I+I+"<"+x+">"+r(q(d[1],[i+1,c+1]))+"</"+z+">\n";n+=b+I+"</"+M+">",A.push(n)}for(A=A.join("\n"),n=I+(b?"<"+v+">\n"+I+I+"<"+y+">":"<"+M+">")+"\n",f=0;a>f;++f)n+=b+I+I+"<"+w+">"+r(q(d[0],[1,f+1]))+"</"+j+">\n";if(b){for(L+=I+"<"+k+">\n",f=0;a>f;++f)L+=I+I+"<"+x+">"+r(q(d[2],[1,f+1]))+"</"+z+">\n";L+=I+"</"+N+">\n"}n+=b+I+"</"+M+">"+(b?"\n"+I+"</"+H+">\n"+L+I+"<"+$+">":"")+"\n",A=n+A+(b?"\n"+I+"</"+R+">":"")+"\n",t.tidy("\n\n").insert("<"+m+">\n"+(u?I+"<"+g+">"+u+"</"+T+">\n":"")+A+"</"+_+">",1),p=t.$(),E=p.start+p.after.indexOf(h),t.select(E,E+h.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=a(t.$().before);return t.tidy("\n\n","").insert(n+"<"+C.hr+H+"\n\n",-1),!1}}}),E.keys&&w(T.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=a(t.$().before);return t.tidy("\n","").insert(n+"<"+C.br+H+"\n",-1),!1},enter:function(e,t){{var o,l,u=t.$(),c=u.value,s=t.get(),p=C.p,d=C.li,h=i(p),b=i(d);a(u.before)}if(!c){if(match=u.after.match(n("^\\s*<\\/("+h+"|"+b+")>")))o=match[1],T.tools["li"===o?f:o].click(e,t);else{if(!(z&&r(s)&&u.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+p+">"+s+"</"+h+">\n<"+p+">",l="</"+h+">",t.set(s+l).select(s.length)}return!1}},tab:function(e,t){var r=t.$(),o=C.li,l=i(o),u=a(r.before);return n("<\\/"+o+">").test(r.after)?(t.wrap("\n"+u+I+"<"+(C[f]||f)+">\n"+u+I+I+"<"+o+">","</"+l+">\n"+u+I+"</"+f+">\n"+u),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var r,o=t.$(),i=o.value,a=o.before,l=o.after,u="<[^<>]+?>";return!i&&n(u+"$").test(a)?(r=a.split("<").pop().match(/^([^\/\s]+).*?>$/),r=r&&r[1]||0,r&&n("^\\s*<\\/"+r+">").test(l)?t.unwrap(n("<"+r+R+">"),n("\\s*<\\/"+r+">")):t.outdent(n(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),y.update({},0)};