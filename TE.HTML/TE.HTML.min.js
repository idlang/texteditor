/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function S(e,t){return new RegExp(e,t)}function M(e){return e.replace(/^\s*|\s*$/g,"")}function A(e,t,r){return t>e?t:e>r?r:e}function B(e){return e.split(/\s+/)[0]}function F(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function N(e,t,r){var h,n=p.$(),a=n.value,l=n.before,i=w[t],o=w[r]||r,c=B(i),s=B(o),u=F(l),f=H[""];return R=i,p[0](),a&&a!==f?(p.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+s+">\n"+q+"<"+o+">").wrap("<"+i+">\n"+q+"<"+o+">","</"+s+">\n</"+c+">\n\n",1).replace(S("\\n"+q+"<"+o+">\\s*<\\/"+s+">\\n","g"),"\n</"+c+">\n\n<"+i+">\n").select(p.$().end),I&&m.tools.p.click(e,p),p[1](),!1):void((h=l.match(S("(?:^|\\n)[\\t ]+<(\\/?)(?:"+B(w.ul)+"|"+B(w.ol)+")"+T+">\\s*$")))?p.insert("\n"+u+(h[1]?"":q),-1):(h=l.match(S("<"+s+L+">.*?$")))?S("<\\/"+s+">\\s*$").test(l)?p.tidy("\n"+u,!1).insert(f).wrap("<"+s+h[1]+">","</"+s+">"):/>\s*$/.test(l)?p.insert(f).wrap("\n"+u+q+"<"+i+">\n"+u+q+q+"<"+s+h[1]+">","</"+s+">\n"+u+q+"</"+c+">\n"+u):p.insert("</"+s+">\n"+u+"<"+s+h[1]+">",-1).insert(f):S("<\\/"+s+">\\s*$").test(l)?p.insert(f).wrap("\n"+u+"<"+o+">","</"+s+">"):p.tidy("\n\n","").insert(f).wrap("<"+i+">\n"+q+"<"+o+">","</"+s+">\n</"+c+">"))}function Q(e,t){return!t.get(0)&&I&&m.tools.p.click(e,t),t}function z(e){return D(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function D(e){return M(e.replace(/\s+/g," "))}var R,r="–",n="…",a="↑",l="↓",i="↵",o="⌘",c="✘",s="⇧",u=window,p=(document,new TE(e)),h=p._.extend,b=p._.each,d=p._.x,m=p.create(h({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",c],b:["Bold",o+"+B"],i:["Italic",o+"+I"],u:["Underline",o+"+U"],s:["Strike",o+"+"+c],a:["Link",o+"+L"],img:["Image",o+"+G"],sub:["Subscript",o+"+"+l],sup:["Superscript",o+"+"+a],abbr:["Abbreviation",o+"+"+s+"+?"],p:["Paragraph",o+"+"+i],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",o+"+H"],"blockquote,q":["Quote",o+"+Q"],"pre,code":["Code",o+"+K"],ul:["Unordered List",o+"+-"],ol:["Ordered List",o+"++"],table:["Table",o+"+T"],hr:["Horizontal Rule",o+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),g=p._.format,v=p.config,$=v.states,k=v.languages,w=v.formats,q=(v.classes,v.tab),_=v.suffix,T="(?:\\s[^<>]*?)?",L="(|\\s[^<>]*?)",x="([\\s\\S]*?)",H=k.placeholders,I=v.auto_p;return p.type="HTML",p.i=function(){return p.replace(/\s+/g," ")},h(m.tools,{clear:{i:"eraser",click:function(e,t){var r=t[0]().$(),n=r.value;return/<[^<>]+?>/.test(n)||">"===r.before.slice(-1)||"<"===r.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!r.after}},b:{i:"bold",click:function(e,t){return Q(e,t).i().format(w.b),!1}},i:{i:"italic",click:function(e,t){return Q(e,t).i().format(w.i),!1}},u:{i:"underline",click:function(e,t){return Q(e,t).i().format(w.u),!1}},s:{i:"strikethrough",click:function(e,t){return Q(e,t).i().format(g(w.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var a,l,r=w.a,n=k.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,i){i=D(i),a=i;var c,s,o=u.location.host;-1!==a.indexOf("://")&&(c=1),""!==o&&-1!==a.indexOf("://"+o)&&(c=0),/^([.\/?&#]|javascript:)/.test(a)&&(c=0),t.blur().ui.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){l=z(n),Q(e,t).$().length||t.insert(H[""]),s=v.advance_a&&c?' rel="nofollow" target="_blank"':"",t.i().format(r+' href="'+a+'"'+(l?' title="'+l+'"':"")+s)})}),!1}},img:{i:"image",click:function(e,t){var s,u,r=t.$(),n=w.img,a=w.figure,l=w.figcaption,i=r.value,o=k.modals.img,c=v.advance_img;return t.ui.prompt(["img[src]",o.title[0]],o.placeholder[0],1,function(e,t,r){r=D(r),s=r,t.blur().ui.prompt(["img[title]",o.title[c?2:1]],o.placeholder[c?2:1],0,function(e,t,r){u=z(r),i||(i=s.split(/[\/\\\\]/).pop()),i=z(i),t[0](),c&&u?(t.tidy("\n\n","").insert("<"+a+">\n"+q+"<"+n+' alt="'+i+'" src="'+s+'"'+_+"\n"+q+"<"+l+">"+u+"</"+B(l)+">\n</"+B(a)+">\n\n",-1,1),I&&m.tools.p.click(e,p)):Q(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+n+' alt="'+i+'" src="'+s+'"'+(u?' title="'+u+'"':"")+_+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=w.sub,n=w.sup,a=B(n);return Q(e,t)[0]().unwrap(S("<"+a+T+">"),"</"+a+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=w.sub,n=w.sup,a=B(r);return Q(e,t)[0]().unwrap(S("<"+a+T+">"),"</"+a+">").i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var h,b,r=t.$(),n=M(r.value),a=k.modals.abbr,l=t.get(),i=M(n||H[""]),o=w.abbr,c=B(o),s="<"+d(o)+L+">",u="<"+d(o)+T+">",f="<\\/"+c+">",p=S(s+x+f);return l.replace(p,function(e,t,r){(r=M(r))&&($.abbr[r]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),h=$.abbr,n&&h[n]?(t.i().format(o+' title="'+h[n]+'"'),!1):(t.record().ui.prompt(["abbr[title]",a.title],h[i]||a.placeholder,!h[n],function(e,t,r,n){r=M(r||n),t[0]();for(b in h)if(h[b]===r){t.insert(b);break}Q(e,t).unwrap(S(u),S(f)).unwrap(S(u),S(f),1).i().format(o+' title="'+r+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r=t.$(),n=r.value,a=w.p,l=w.br,i=B(a),o=B(l),c=r.before,s=r.after,u=F(c),f=H[""];if(t[0](),n&&-1!==n.indexOf("\n")){var p=S("^(?:\\s*<"+i+T+">\\s*)+"+x+"(?:\\s*<\\/"+i+">\\s*)+$");p.test(r.value)?t.replace(p,"$1").replace(S("\\s*<\\/"+i+">\\s*<"+i+T+">\\s*","g"),"\n\n").replace(S("\\s*<"+o+T+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+l+_+"\n").replace(S("(\\s*<"+o+T+_+"\\s*){2,}","g"),"</"+i+">\n<"+a+">").wrap("<"+a+">","</"+i+">",1).replace(S("(<"+i+T+">)+","g"),"$1").replace(S("(<\\/"+i+">)+","g"),"$1").tidy("\n")}else S("^\\s*<\\/"+i+">").test(s)?S("<"+i+T+">\\s*$").test(c)?t.unwrap(S("\\s*<"+i+T+">\\s*"),S("\\s*<\\/"+i+">")).replace(f,"").tidy("\n","\n"+u):(match=c.match(S("<"+i+L+">.*?$")))&&t.wrap("</"+i+">\n"+u+"<"+i+match[1]+">","").insert(f):t.format(a,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[w.p,w.h1,w.h2,w.h3,w.h4,w.h5,w.h6],a=[];b(n,function(e,t){a[t]=B(e)});var i=(d(n).join("|"),d(a).join("|")),o="\\s*<("+i+")"+L+">\\s*",c=S("\\s*<(?:"+i+")"+T+">\\s*"),s=S("\\s*<\\/(?:"+i+")>\\s*"),u=r.value.match(S("^"+o));u||(u=r.before.match(S(o+"$"))||[]);var f=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(c,s).unwrap(c,s,1).i().tidy("\n\n").format(p>5?a[0]+f:a[p+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var r=t.$(),n=r.value,a=w.blockquote,l=w.q,i=w.p,o=B(i),c="<"+o+T+">";if(S("(^|\\n|"+c+")$").test(r.before)){if(I&&(r.value===H[""]||S("("+c+")$").test(r.before)))return t.select(),!1;t[0]().format(a,0,"\n\n","\n"),I&&(!n||t.match(/^[^<\n]*?[^>]$/)?t.wrap(q+"<"+i+">","</"+o+">"):t[S("((^|\\n)"+q+")+").test(r.value)?"outdent":"indent"](q)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function b(e){return a?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function d(e){return a?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,a=v.auto_encode_html,l=w.pre,i=w.code,o=B(l),c=B(i),s="<"+o+T+">\\s*<"+c+T+">\\s*",u="\\s*<\\/"+c+">\\s*<\\/"+o+">",f=S(s+"\\s*$"),p=S("^\\s*"+u),h=S("^"+x+"$");return S("(^|\\n|"+s+")$").test(r.before)?f.test(r.before)&&p.test(r.after)?t[0]().unwrap(S(f),S(p)).replace(h,d)[1]():t[0]().tidy("\n\n").wrap("<"+l+"><"+i+">","</"+c+"></"+o+">").insert(n||H[""]).replace(h,b)[1]():t[0]().format(i).loss().replace(h,function(e){return D(S("^<\\/"+c+">").test(t.$().after)?b(e):d(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=w.ol,n=w.ul,a=B(r),l=B(n),i="("+d(l)+"|"+d(a)+")";return t.match(S("<"+i+T+">"+x+"<\\/"+i+">"))?t[0]().replace(S("<"+a+L+">","g"),"<"+l+"$1>").replace(S("</"+a+">","g"),"</"+l+">")[1]():N(e,n,w.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=w.ol,n=w.ul,a=B(r),l=B(n),i="("+d(l)+"|"+d(a)+")";return t.match(S("<"+i+T+">"+x+"<\\/"+i+">"))?t[0]().replace(S("<"+l+L+">","g"),"<"+a+"$1>").replace(S("</"+l+">","g"),"</"+a+">")[1]():N(e,r,w.li),!1}},table:function(e,t){var j,C,O,U,r=$.tr,n=$.td,a=k.modals.table,l=k.placeholders.table,i=M(g(l[0],[1,1])),o=v.advance_table?q:"",c=w.table,s=w.caption,u=w.thead,f=w.tbody,p=w.tfoot,h=w.tr,b=w.th,d=w.td,m=B(c),y=B(s),_=B(u),T=B(f),L=B(p),x=B(h),H=B(b),I=B(d),R=[];return t.$().value===i?(t.select(),!1):(t[0]().ui.prompt(["table>td",a.title[0]],a.placeholder[0],0,function(e,t,v,$){C=A(parseInt(v,10)||$,n[0],n[1]),t.blur().ui.prompt(["table>tr",a.title[1]],a.placeholder[1],0,function(e,t,n,v){O=A(parseInt(n,10)||v,r[0],r[1]),t.blur().ui.prompt(["table>caption",a.title[2]],a.placeholder[2],0,function(e,t,r){var a,v,$,w,E,n="";for(U=D(r),a=0;O>a;++a){for(j=o+q+"<"+h+">\n",v=0;C>v;++v)j+=o+q+q+"<"+d+">"+M(g(l[1],[a+1,v+1]))+"</"+I+">\n";j+=o+q+"</"+x+">",R.push(j)}for(R=R.join("\n"),j=q+(o?"<"+u+">\n"+q+q+"<"+h+">":"<"+x+">")+"\n",$=0;C>$;++$)j+=o+q+q+"<"+b+">"+M(g(l[0],[1,$+1]))+"</"+H+">\n";if(o){for(n+=q+"<"+p+">\n",$=0;C>$;++$)n+=q+q+"<"+d+">"+M(g(l[2],[1,$+1]))+"</"+I+">\n";n+=q+"</"+L+">\n"}j+=o+q+"</"+x+">"+(o?"\n"+q+"</"+_+">\n"+n+q+"<"+f+">":"")+"\n",R=j+R+(o?"\n"+q+"</"+T+">":"")+"\n",t.tidy("\n\n").insert("<"+c+">\n"+(U?q+"<"+s+">"+U+"</"+y+">\n":"")+R+"</"+m+">",0),w=t.$(),E=w.start+w.value.indexOf(i),t.select(E,E+i.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=F(t.$().before);return t.tidy("\n\n","").insert(r+"<"+w.hr+_+"\n\n",-1),!1}}}),v.keys&&h(m.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=F(t.$().before);return t.tidy("\n","").insert(r+"<"+w.br+_+"\n",-1),!1},enter:function(e,t){var f,p,r=t.$(),n=r.value,a=t.get(),l=w.p,i=w.li,o=B(l),c=B(i),u=(F(r.before),H[""]);if(!n||n===u){if(match=r.after.match(S("^\\s*<\\/("+o+"|"+c+")>")))f=match[1],m.tools["li"===f?R:f].click(e,t);else{if(!(I&&M(a)&&r.end===a.length&&/^\s*[^<\n]*?[^>]\s*$/.test(a)))return;a="<"+l+">"+a+"</"+o+">\n<"+l+">",p=u+"</"+o+">",t.set(a+p).select(a.length,(a+u).length)}return!1}},tab:function(e,t){var r=t.$(),n=w.li,a=B(n),l=F(r.before);return S("<\\/"+n+">").test(r.after)?(t.wrap("\n"+l+q+"<"+(w[R]||R)+">\n"+l+q+q+"<"+n+">","</"+a+">\n"+l+q+"</"+R+">\n"+l),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var a,r=t.$(),n=r.value,l=r.before,i=r.after,o="<[^<>]+?>";return!n&&S(o+"$").test(l)?(a=l.split("<").pop().match(/^([^\/\s]+).*?>$/),a=a&&a[1]||0,a&&S("^\\s*<\\/"+a+">").test(i)?t.unwrap(S("<"+a+T+">"),S("\\s*<\\/"+a+">")):t.outdent(S(o)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),p.update({},0)};