/*!
 * ==========================================================
 *  HTML EDITOR PLUGIN 0.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e){return"function"==typeof e}function r(e,t){return RegExp(e,t)}function o(e){return e.split(/\s+/)[0]}function i(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function l(e,t,n){var o,i,l=(t.$(),E.formats),a=[];b(l,function(e){"align-"===e.slice(0,6)&&a.push(e)}),o=r('<div class="(?:'+a.join("|")+')">\\s*'),i=r("\\s*<\\/div>"),t[0]().unwrap(o,i).unwrap(o,i,1).format('div class="'+n+'"',0,"\n\n","\n")[1]()}var a,u="\u2013",c="\u2026",s="\u2191",f="\u2193",p="\u21B5",d="\u2318",g="\u2718",h=window,v=new TE(e),m=v._.extend,b=v._.each,y=v._.esc,k=v.create(m({suffix:">",tools:"clear | bold italic underline strike | subscript superscript | link image | paragraph | header | quote code | bullet list | align-left align-center align-right align-justify | horizontal | undo redo",languages:{tools:{clear:"Clear Format ("+g+")",bold:"Bold ("+d+"+B)",italic:"Italic ("+d+"+I)",underline:"Underline ("+d+"+U)",strike:"Strike ("+d+"+"+g+")",link:"Link ("+d+"+L)",image:"Image ("+d+"+G)",subscript:"Subscript ("+d+"+"+f+")",superscript:"Subscript ("+d+"+"+s+")",paragraph:"Paragraph ("+d+"+"+p+")",header:"H1 "+u+" H6 ("+d+"+H)",quote:"Quote ("+d+"+Q)",code:"Code ("+d+"+K)",bullet:"Unordered List ("+d+"+-)",list:"Ordered List ("+d+"++)","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify","align-top":"Align Top","align-middle":"Align Middle","align-bottom":"Align Bottom",horizontal:"Horizontal Rule ("+d+"+R)"},modals:{link:{title:["URL","Title"],placeholder:["http://","link title here"+c]},image:{title:["Source URL","Caption"],placeholder:["http://","image caption here"+c]}}},classes:{formats:{left:"align-left",center:"align-center",right:"align-right",justify:"align-justify",top:"align-top",middle:"align-middle",bottom:"align-bottom"}},formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',hr:"hr"}},t)),w=v._.format,$=v.config,x=$.languages,T=$.formats,E=$.classes,_=$.tab,L=$.suffix,C="(?:\\s[^<>]*?)?",j="(|\\s[^<>]*?)",q=x.others.placeholder;return v.tree=function(e,t){var n=v.$(),l=n.before,u=T[e],c=T[t]||t,s=o(u),f=o(c),p=i(l);if(a=u,n.length)v[0]().gap("\n\n","").replace(/\n/g,"</"+f+">\n"+_+"<"+c+">").wrap("<"+u+">\n"+_+"<"+c+">","</"+f+">\n</"+s+">\n\n",1).replace(r("\\n"+_+"<"+c+">\\s*<\\/"+f+">\\n","g"),"\n</"+s+">\n\n<"+u+">\n").select(v.$().end)[1]();else{var d=l.match(r("<"+f+j+">.*$"));d?/>\s*$/.test(l)?r("<\\/"+f+">\\s*$").test(l)||v.wrap("\n"+p+_+"<"+u+">\n"+p+_+_+"<"+f+d[1]+">","</"+f+">\n"+p+_+"</"+s+">\n"+p):v.insert("</li>\n"+p+"<li>",-1):v.gap("\n\n","").wrap("<"+u+">\n"+_+"<"+c+">","</"+f+">\n</"+s+">")}return v},m(k.tools,{clear:{i:"eraser",click:function(e,t){var n=t.$().value;if(n.length)return e.TE&&e.TE.control()?k.tools.strike.click(e,t):(t[0]().replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/),t.$().value===n&&t.insert(""),t[1](),!1)}},bold:function(e,t){return t.format(T.b),!1},italic:function(e,t){return t.format(T.i),!1},underline:function(e,t){return t.format(T.u),!1},strike:{i:"strikethrough",click:function(e,t){return t.format(w(T.s,t._.time())),!1}},link:{click:function(e,t){var n,r,i=T.a,l=x.modals.link;return t.record().ui.prompt(l.title[0],l.placeholder[0],1,function(e,t,a){n=a;var u,c,s=h.location.host;-1!==n.indexOf("://")&&(u=1),""!==s&&-1!==n.indexOf("://"+s)&&(u=0),/^([.\/?&#]|javascript:)/.test(n)&&(u=0),t.blur().ui.prompt(l.title[1],l.placeholder[1],0,function(e,t,l){r=l.replace(/"/g,"&quot;").replace(/'/g,"&apos;"),t.$().length||t.insert(q),c=u?' rel="nofollow" target="_blank"':"",t.gap(" ").wrap("<"+i+' href="'+n+'"'+(r?' title="'+r+'"':"")+c+">","</"+o(i)+">")})}),!1}},image:{click:function(e,t){var n,r,i=T.img,l=T.figure,a=T.figcaption,u=t.$().value.replace(/<.*?>/g,""),c=x.modals.image;return t.record().ui.prompt(c.title[0],c.placeholder[0],1,function(e,t,s){n=s,t.blur().ui.prompt(c.title[1],c.placeholder[1],0,function(e,t,c){r=c,u.length||(u=n.split(/[\/\\\\]/).pop()),t[0]().insert(""),r?t.gap("\n\n","").insert("<"+l+">\n"+_+"<"+i+' alt="'+u+'" src="'+n+'"'+L+"\n"+_+"<"+a+">"+r+"</"+o(a)+">\n</"+o(l)+">\n\n",-1):t.gap(" ","").insert("<"+i+' alt="'+u+'" src="'+n+'"'+L+" ",-1),t[1]()})}),!1}},subscript:function(e,t){var n=T.sub,i=T.sup,l=o(i);return t[0]().unwrap(r("<"+l+C+">"),"</"+l+">").format(n)[1](),!1},superscript:function(e,t){var n=T.sub,i=T.sup,l=o(n);return t[0]().unwrap(r("<"+l+C+">"),"</"+l+">").format(i)[1](),!1},paragraph:function(e,t){var n=t.$(),l=T.p,a=T.br,u=o(l),c=o(a),s=n.before,f=n.after,p=i(s);if(n.length&&-1!==n.value.indexOf("\n")){var d=r("^(?:\\s*<"+u+C+">\\s*)+([\\s\\S]*?)(?:\\s*<\\/"+u+">\\s*)+$");d.test(n.value)?t[0]().replace(d,"$1").replace(r("\\s*<\\/"+u+">\\s*<"+u+C+">\\s*","g"),"\n\n").replace(r("\\s*<"+c+C+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+a+L+"\n").replace(r("(\\s*<"+c+C+L+"\\s*){2,}","g"),"</"+u+">\n<"+l+">").wrap("<"+l+">","</"+u+">",1).replace(r("(<"+u+C+">)+","g"),"$1").replace(r("(<\\/"+u+">)+","g"),"$1").gap("\n")[1]()}else r("^\\s*<\\/"+u+">").test(f)?r("<"+u+C+">\\s*$").test(s)?t[0]().unwrap(r("\\s*<"+u+C+">\\s*"),r("\\s*<\\/"+u+">")).gap("\n")[1]():(match=s.match(r("<"+u+j+">.*$")))&&t.wrap("</"+u+">\n"+p+"<"+u+match[1]+">",""):t[0]().format(l,0,"\n\n")[1]();return!1},header:function(e,t){var n="",i=0,l=t.$(),a=[T.p,T.h1,T.h2,T.h3,T.h4,T.h5,T.h6],u=[];b(a,function(e,t){u[t]=o(e)});var c=y(a).join("|"),s=y(u).join("|"),f="\\s*<("+c+")"+j+">\\s*",p=r("\\s*<(?:"+c+")"+C+">\\s*"),d=r("\\s*<\\/(?:"+s+")>\\s*"),g=l.value.match(r("^"+f));return g||(g=l.before.match(r(f+"$"))||[]),n=g[2]||"",i=+(g[1]||"h0").slice(1),t[0]().replace(/\s+/g," ").unwrap(p,d).unwrap(p,d,1).format(i>5?u[0]+n:u[i+1]+n,0,"\n\n")[1](),!1},quote:{i:"quote-left",click:function(e,t){var n=t.$(),r=T.blockquote,o=T.q;return/(^|\n)$/.test(n.before)?t.format(r,0,"\n\n","\n"):t.format(o),!1}},code:function(e,t){var n=t.$(),i=T.pre,l=T.code,a=o(i),u=o(l),c="<"+a+C+">\\s*<"+u+C+">\\s*",s="\\s*<\\/"+u+">\\s*<\\/"+a+">",f=r(c+"\\s*$"),p=r("^\\s*"+s),d=/^[\s\S]*?$/;return r("(^|\\n|"+c+")$").test(n.before)?f.test(n.before)&&p.test(n.after)?t[0]().unwrap(r(f),r(p)).replace(d,function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")})[1]():t[0]().gap("\n\n").wrap("<"+i+"><"+l+">","</"+u+"></"+a+">").insert(n.length?n.value:q).replace(d,function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")})[1]():t.format(l),!1},bullet:{i:"list-ul",click:function(e,t){var n=(t.$(),T.ol),i=T.ul,l=o(n),a=o(i);return t.match(r("<"+(a+"|"+l)+C+">([\\s\\S]*?)<\\/"+(a+"|"+l)+">"))?t[0]().replace(r("<"+l+j+">","g"),"<"+a+"$1>").replace(r("</"+l+">","g"),"</"+a+">")[1]():t.tree(i,T.li),!1}},list:{i:"list-ol",click:function(e,t){return ol=T.ol,ul=T.ul,ol_o=o(ol),ul_o=o(ul),t.match(r("<"+(ul_o+"|"+ol_o)+C+">([\\s\\S]*?)<\\/"+(ul_o+"|"+ol_o)+">"))?t[0]().replace(r("<"+ul_o+j+">","g"),"<"+ol_o+"$1>").replace(r("</"+ul_o+">","g"),"</"+ol_o+">")[1]():t.tree(ol,T.li),!1}},"align-left":l,"align-center":l,"align-right":l,"align-justify":l,horizontal:{i:"ellipsis-h",click:function(e,t){var n=i(t.$().before);return t.gap("\n\n","").insert(n+"<"+T.hr+L+"\n\n",-1),!1}}}),b(k.tools,function(e,t){var r=x.tools[t]||"";n(e)?k.tools[t]={title:r,click:e}:e.title||(e.title=r)}),m(k.keys,{"delete":"clear","control+b":"bold","control+i":"italic","control+u":"underline","control+l":"link","control+g":"image","control+arrowdown":"subscript","control+arrowup":"superscript","control+enter":"paragraph","shift+enter":function(e,t){var n=i(t.$().before);return t.gap("\n","").insert(n+"<br"+L+"\n",-1),!1},enter:function(e,t){if(!e.TE.key(/^control|shift|alt$/)){var n=t.$(),l=T.p,u=T.li,c=o(l),s=o(u),f=i(n.before);if(!n.length){if(match=n.after.match(r("^\\s*<\\/("+c+"|"+s+")>")))k.tools[match[1]===c?"paragraph":"ol"===a?"list":"bullet"].click(e,t);else{if(!f.length)return;t.insert("\n"+f,-1).scroll(t.scroll()+1)}return!1}}},"control+h":"header","control+q":"quote","control+k":"code","control+-":"bullet","control++":"list","control+r":"horizontal"}),v.update()};