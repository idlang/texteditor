/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e){return"function"==typeof e}function r(e,t){return RegExp(e,t)}function o(e){return e.replace(/^\s*|\s*$/g,"")}function i(e,t,n){return t>e?t:e>n?n:e}function a(e){return e.split(/\s+/)[0]}function l(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function u(e,t,n){var o=x.$(),i=o.value,u=o.before,c=I[t],s=I[n]||n,f=a(c),d=a(s),h=l(u);if(p=c,i)x[0]().tidy("\n\n","").replace(/\n/g,"</"+d+">\n"+H+"<"+s+">").wrap("<"+c+">\n"+H+"<"+s+">","</"+d+">\n</"+f+">\n\n",1).replace(r("\\n"+H+"<"+s+">\\s*<\\/"+d+">\\n","g"),"\n</"+f+">\n\n<"+c+">\n").select(x.$().end),U&&C.tools.p.click(e,x),x[1]();else{var g=u.match(r("<"+d+j+">.*$"));g?r("<\\/"+d+">\\s*$").test(u)?x.tidy("\n"+h,!1).wrap("<"+d+g[1]+">","</"+d+">"):/>\s*$/.test(u)?r("<\\/"+d+">\\s*$").test(u)||x.wrap("\n"+h+H+"<"+c+">\n"+h+H+H+"<"+d+g[1]+">","</"+d+">\n"+h+H+"</"+f+">\n"+h):x.insert("</"+d+">\n"+h+"<"+d+g[1]+">",-1):x.tidy("\n\n","").wrap("<"+c+">\n"+H+"<"+s+">","</"+d+">\n</"+f+">")}}function c(e,t){return!t.get(0)&&U&&C.tools.p.click(e,t),t}function s(e){return f(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function f(e){return o(e.replace(/\s+/g," "))}var p,d="\u2013",h="\u2026",g="\u2191",v="\u2193",b="\u21B5",m="\u2318",$="\u2718",y="\u21E5",k="\u21E7",w=window,x=new TE(e),_=x._.extend,T=x._.each,E=x._.x,C=x.create(_({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20]},languages:{tools:{clear:"Clear Format ("+$+")",b:"Bold ("+m+"+B)",i:"Italic ("+m+"+I)",u:"Underline ("+m+"+U)",s:"Strike ("+m+"+"+$+")",a:"Link ("+m+"+L)",img:"Image ("+m+"+G)",sub:"Subscript ("+m+"+"+v+")",sup:"Superscript ("+m+"+"+g+")",p:"Paragraph ("+m+"+"+b+")","p,h1,h2,h3,h4,h5,h6":"H1 "+d+" H6 ("+m+"+H)","blockquote,q":"Quote ("+m+"+Q)","pre,code":"Code ("+m+"+K)",ul:"Unordered List ("+m+"+-)",ol:"Ordered List ("+m+"++)",indent:"Indent ("+y+")",outdent:"Outdent ("+k+"+"+y+")",table:"Table ("+m+"+T)",hr:"Horizontal Rule ("+m+"+R)"},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+h]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+h,"image caption here"+h]},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+h]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),L=x._.format,q=x.config,S=q.states,O=q.languages,I=q.formats,H=(q.classes,q.tab),z=q.suffix,M="(?:\\s[^<>]*?)?",j="(|\\s[^<>]*?)",R="([\\s\\S]*?)",N=O.placeholders[""],U=q.auto_p;return x.type="HTML",x.i=function(){return x.replace(/\s+/g," ")},_(C.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return r?(/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after.slice(0,1)?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!1):(t.select(),!1)}},b:{i:"bold",click:function(e,t){return c(e,t).i().format(I.b),!1}},i:{i:"italic",click:function(e,t){return c(e,t).i().format(I.i),!1}},u:{i:"underline",click:function(e,t){return c(e,t).i().format(I.u),!1}},s:{i:"strikethrough",click:function(e,t){return c(e,t).i().format(L(I.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=I.a,i=O.modals.a;return t.record().ui.prompt(i.title[0],i.placeholder[0],1,function(e,t,a){a=f(a),n=a;var l,u,p=w.location.host;-1!==n.indexOf("://")&&(l=1),""!==p&&-1!==n.indexOf("://"+p)&&(l=0),/^([.\/?&#]|javascript:)/.test(n)&&(l=0),t.blur().ui.prompt(i.title[1],i.placeholder[1],0,function(e,t,i){r=s(i),c(e,t).$().length||t.insert(N),u=l?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+u)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),i=I.img,l=I.figure,u=I.figcaption,p=o.value,d=O.modals.img,h=q.advance_img;return t.ui.prompt(d.title[0],d.placeholder[0],1,function(e,t,o){o=f(o),n=o,t.blur().ui.prompt(d.title[h?2:1],d.placeholder[h?2:1],0,function(e,t,o){r=s(o),p||(p=n.split(/[\/\\\\]/).pop()),p=s(p),t[0]().insert(""),h&&r?(t.tidy("\n\n","").insert("<"+l+">\n"+H+"<"+i+' alt="'+p+'" src="'+n+'"'+z+"\n"+H+"<"+u+">"+r+"</"+a(u)+">\n</"+a(l)+">\n\n",-1),U&&C.tools.p.click(e,x)):c(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+i+' alt="'+p+'" src="'+n+'"'+(r?' title="'+r+'"':"")+z+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=I.sub,o=I.sup,i=a(o);return c(e,t)[0]().unwrap(r("<"+i+M+">"),"</"+i+">").i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=I.sub,o=I.sup,i=a(n);return c(e,t)[0]().unwrap(r("<"+i+M+">"),"</"+i+">").i().format(o)[1](),!1}},p:{i:"paragraph",click:function(e,t){var n=t.$(),o=n.value,i=I.p,u=I.br,c=a(i),s=a(u),f=n.before,p=n.after,d=l(f);if(o&&-1!==o.indexOf("\n")){var h=r("^(?:\\s*<"+c+M+">\\s*)+"+R+"(?:\\s*<\\/"+c+">\\s*)+$");h.test(n.value)?t[0]().replace(h,"$1").replace(r("\\s*<\\/"+c+">\\s*<"+c+M+">\\s*","g"),"\n\n").replace(r("\\s*<"+s+M+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+u+z+"\n").replace(r("(\\s*<"+s+M+z+"\\s*){2,}","g"),"</"+c+">\n<"+i+">").wrap("<"+i+">","</"+c+">",1).replace(r("(<"+c+M+">)+","g"),"$1").replace(r("(<\\/"+c+">)+","g"),"$1").tidy("\n")[1]()}else r("^\\s*<\\/"+c+">").test(p)?r("<"+c+M+">\\s*$").test(f)?t[0]().unwrap(r("\\s*<"+c+M+">\\s*"),r("\\s*<\\/"+c+">")).tidy("\n","\n"+d)[1]():(match=f.match(r("<"+c+j+">.*$")))&&t.wrap("</"+c+">\n"+d+"<"+c+match[1]+">",""):t[0]().format(i,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),o=[I.p,I.h1,I.h2,I.h3,I.h4,I.h5,I.h6],i=[];T(o,function(e,t){i[t]=a(e)});var l=(E(o).join("|"),E(i).join("|")),u="\\s*<("+l+")"+j+">\\s*",c=r("\\s*<(?:"+l+")"+M+">\\s*"),s=r("\\s*<\\/(?:"+l+")>\\s*"),f=n.value.match(r("^"+u));f||(f=n.before.match(r(u+"$"))||[]);var p=f[2]||"",d=+(f[1]||"h0").slice(1);return t[0]().unwrap(c,s).unwrap(c,s,1).i().format(d>5?i[0]+p:i[d+1]+p,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var n=t.$(),o=n.value,i=I.blockquote,l=I.q,u=I.p,c=a(u),s="<"+c+M+">";if(r("(^|\\n|"+s+")$").test(n.before)){if(U&&(n.value===N||r("("+s+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),U&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(H+"<"+u+">","</"+c+">"):t[r("((^|\\n)"+H+")+").test(n.value)?"outdent":"indent"](H)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function n(e){return u?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return u?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var i=t.$(),l=i.value,u=q.auto_encode_html,c=I.pre,s=I.code,p=a(c),d=a(s),h="<"+p+M+">\\s*<"+d+M+">\\s*",g="\\s*<\\/"+d+">\\s*<\\/"+p+">",v=r(h+"\\s*$"),b=r("^\\s*"+g),m=r("^"+R+"$");return r("(^|\\n|"+h+")$").test(i.before)?v.test(i.before)&&b.test(i.after)?t[0]().unwrap(r(v),r(b)).replace(m,o)[1]():t[0]().tidy("\n\n").wrap("<"+c+"><"+s+">","</"+d+"></"+p+">").insert(l||N).replace(m,n)[1]():t[0]().format(s).loss().replace(m,function(e){return f(r("^<\\/"+d+">").test(t.$().after)?n(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=I.ol,o=I.ul,i=a(n),l=a(o),c=l+"|"+i;return t.match(r("<"+c+M+">"+R+"<\\/"+c+">"))?t[0]().replace(r("<"+i+j+">","g"),"<"+l+"$1>").replace(r("</"+i+">","g"),"</"+l+">")[1]():u(e,o,I.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=I.ol,o=I.ul,i=a(n),l=a(o),c=l+"|"+i;return t.match(r("<"+c+M+">"+R+"<\\/"+c+">"))?t[0]().replace(r("<"+l+j+">","g"),"<"+i+"$1>").replace(r("</"+l+">","g"),"</"+i+">")[1]():u(e,n,I.li),!1}},table:function(e,t){var n,r,o,l,u=S.tr,c=S.td,s=O.modals.table,p=O.placeholders.table,d=L(p[0],[1,1]),h=q.advance_table?H:"",g=I.table,v=I.caption,b=I.thead,m=I.tbody,$=I.tfoot,y=I.tr,k=I.th,w=I.td,x=a(g),_=a(v),T=a(b),E=a(m),C=a($),z=a(y),M=a(k),j=a(w),R=[];return t.$().value===d?(t.select(),!1):(t[0]().insert("").ui.prompt(s.title[0],s.placeholder[0],0,function(e,t,a,q){r=i(parseInt(a,10)||q,c[0],c[1]),t.blur().ui.prompt(s.title[1],s.placeholder[1],0,function(e,t,a,c){o=i(parseInt(a,10)||c,u[0],u[1]),t.blur().ui.prompt(s.title[2],s.placeholder[2],0,function(e,t,i){var a,u,c,s,q,S="";for(l=f(i),a=0;o>a;++a){for(n=h+H+"<"+y+">\n",u=0;r>u;++u)n+=h+H+H+"<"+w+">"+L(p[1],[a+1,u+1])+"</"+j+">\n";n+=h+H+"</"+z+">",R.push(n)}for(R=R.join("\n"),n=H+(h?"<"+b+">\n"+H+H+"<"+y+">":"<"+z+">")+"\n",c=0;o>c;++c)n+=h+H+H+"<"+k+">"+L(p[0],[1,c+1])+"</"+M+">\n";if(h){for(S+=H+"<"+$+">\n",c=0;o>c;++c)S+=H+H+"<"+w+">"+L(p[2],[1,c+1])+"</"+j+">\n";S+=H+"</"+C+">\n"}n+=h+H+"</"+z+">"+(h?"\n"+H+"</"+T+">\n"+S+H+"<"+m+">":"")+"\n",R=n+R+(h?"\n"+H+"</"+E+">":"")+"\n",t.tidy("\n\n").insert("<"+g+">\n"+(l?H+"<"+v+">"+l+"</"+_+">\n":"")+R+"</"+x+">",1),s=t.$(),q=s.start+s.after.indexOf(d),t.select(q,q+d.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=l(t.$().before);return t.tidy("\n\n","").insert(n+"<"+I.hr+z+"\n\n",-1),!1}}}),T(C.tools,function(e,t){var r=O.tools[t]||"";n(e)?C.tools[t]={title:r,click:e}:e.title||(e.title=r)}),q.keys&&_(C.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+enter":"p","shift+enter":function(e,t){var n=l(t.$().before);return t.tidy("\n","").insert(n+"<"+I.br+z+"\n",-1),!1},enter:function(e,t){{var n,i,u=t.$(),c=u.value,s=t.get(),f=I.p,d=I.li,h=a(f),g=a(d);l(u.before)}if(!c){if(match=u.after.match(r("^\\s*<\\/("+h+"|"+g+")>")))n=match[1],C.tools["li"===n?p:n].click(e,t);else{if(!(U&&o(s)&&u.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+f+">"+s+"</"+h+">\n<"+f+">",i="</"+h+">",t.set(s+i).select(s.length)}return!1}},backspace:function(e,t){var n,o=t.$(),i=o.value,a=o.before,l=o.after,u="<[^<>]+?>";return!i&&r(u+"$").test(a)?(n=a.split("<").pop().match(/^([^\/\s]+).*?>$/),n=n&&n[1]||0,n&&r("^\\s*<\\/"+n+">").test(l)?t.unwrap(r("<"+n+M+">"),r("\\s*<\\/"+n+">")):t.outdent(r(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),x.update({},0)};