/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function N(e,t){return new RegExp(e,t)}function R(e){return e.replace(/^\s*|\s*$/g,"")}function I(e,t,r){return t>e?t:e>r?r:e}function O(e){return e.split(/\s+/)[0]}function A(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function Y(e,t,r){var d,n=p.$(),i=n.value,o=n.before,u=x[t],f=x[r]||r,l=O(u),a=O(f),s=A(o),c=S[""];return L=u,p[0](),i&&i!==c?(p.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+a+">\n"+k+"<"+f+">").wrap("<"+u+">\n"+k+"<"+f+">","</"+a+">\n</"+l+">\n\n",1).replace(N("\\n"+k+"<"+f+">\\s*<\\/"+a+">\\n","g"),"\n</"+l+">\n\n<"+u+">\n").select(p.$().end),z&&v.tools.p.click(e,p),p[1](),!1):void((d=o.match(N("(?:^|\\n)[\\t ]+<(\\/?)(?:"+O(x.ul)+"|"+O(x.ol)+")"+E+">\\s*$")))?p.insert("\n"+s+(d[1]?"":k),-1):(d=o.match(N("<"+a+T+">.*?$")))?N("<\\/"+a+">\\s*$").test(o)?p.tidy("\n"+s,!1).insert(c).wrap("<"+a+d[1]+">","</"+a+">"):/>\s*$/.test(o)?p.insert(c).wrap("\n"+s+k+"<"+u+">\n"+s+k+k+"<"+a+d[1]+">","</"+a+">\n"+s+k+"</"+l+">\n"+s):p.insert("</"+a+">\n"+s+"<"+a+d[1]+">",-1).insert(c):N("<\\/"+a+">\\s*$").test(o)?p.insert(c).wrap("\n"+s+"<"+f+">","</"+a+">"):p.tidy("\n\n","").insert(c).wrap("<"+u+">\n"+k+"<"+f+">","</"+a+">\n</"+l+">"))}function D(e,t){return!t.get(0)&&z&&v.tools.p.click(e,t),t}function P(e){return U(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function U(e){return R(e.replace(/\s+/g," "))}var L,r="–",n="…",i="↑",o="↓",u="↵",f="⌘",l="✘",a="⇧",s=window,p=(document,new TE(e)),d=p._.extend,h=p._.each,g=p._.x,v=p.create(d({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",l],b:["Bold",f+"+B"],i:["Italic",f+"+I"],u:["Underline",f+"+U"],s:["Strike",f+"+"+l],a:["Link",f+"+L"],img:["Image",f+"+G"],sub:["Subscript",f+"+"+o],sup:["Superscript",f+"+"+i],abbr:["Abbreviation",f+"+"+a+"+?"],p:["Paragraph",f+"+"+u],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",f+"+H"],"blockquote,q":["Quote",f+"+Q"],"pre,code":["Code",f+"+K"],ul:["Unordered List",f+"+-"],ol:["Ordered List",f+"++"],table:["Table",f+"+T"],hr:["Horizontal Rule",f+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),m=p._.format,b=p.config,y=b.states,w=b.languages,x=b.formats,k=(b.classes,b.tab),_=b.suffix,E="(?:\\s[^<>]*?)?",T="(|\\s[^<>]*?)",C="([\\s\\S]*?)",S=w.placeholders,z=b.auto_p;return p.type="HTML",p.i=function(){return p.replace(/\s+/g," ")},d(v.tools,{clear:{i:"eraser",click:function(e,t){var r=t[0]().$(),n=r.value;return/<[^<>]+?>/.test(n)||">"===r.before.slice(-1)||"<"===r.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!r.after}},b:{i:"bold",click:function(e,t){return D(e,t).i().format(x.b),!1}},i:{i:"italic",click:function(e,t){return D(e,t).i().format(x.i),!1}},u:{i:"underline",click:function(e,t){return D(e,t).i().format(x.u),!1}},s:{i:"strikethrough",click:function(e,t){return D(e,t).i().format(m(x.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,r=x.a,n=w.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,u){u=U(u),i=u;var l,a,f=s.location.host;-1!==i.indexOf("://")&&(l=1),""!==f&&-1!==i.indexOf("://"+f)&&(l=0),/^([.\/?&#]|javascript:)/.test(i)&&(l=0),t.blur().ui.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){o=P(n),D(e,t).$().length||t.insert(S[""]),a=b.advance_a&&l?' rel="nofollow" target="_blank"':"",t.i().format(r+' href="'+i+'"'+(o?' title="'+o+'"':"")+a)})}),!1}},img:{i:"image",click:function(e,t){var a,s,r=t.$(),n=x.img,i=x.figure,o=x.figcaption,u=r.value,f=w.modals.img,l=b.advance_img;return t.ui.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,r){r=U(r),a=r,t.blur().ui.prompt(["img[title]",f.title[l?2:1]],f.placeholder[l?2:1],0,function(e,t,r){s=P(r),u||(u=a.split(/[\/\\\\]/).pop()),u=P(u),t[0](),l&&s?(t.tidy("\n\n","").insert("<"+i+">\n"+k+"<"+n+' alt="'+u+'" src="'+a+'"'+_+"\n"+k+"<"+o+">"+s+"</"+O(o)+">\n</"+O(i)+">\n\n",-1,1),z&&v.tools.p.click(e,p)):D(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+n+' alt="'+u+'" src="'+a+'"'+(s?' title="'+s+'"':"")+_+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=x.sub,n=x.sup,i=O(n);return D(e,t)[0]().unwrap(N("<"+i+E+">"),"</"+i+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=x.sub,n=x.sup,i=O(r);return D(e,t)[0]().unwrap(N("<"+i+E+">"),"</"+i+">").i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var d,h,r=t.$(),n=R(r.value),i=w.modals.abbr,o=t.get(),u=R(n||S[""]),f=x.abbr,l=O(f),a="<"+g(f)+T+">",s="<"+g(f)+E+">",c="<\\/"+l+">",p=N(a+C+c);return o.replace(p,function(e,t,r){(r=R(r))&&(y.abbr[r]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),d=y.abbr,n&&d[n]?(t.i().format(f+' title="'+d[n]+'"'),!1):(t.record().ui.prompt(["abbr[title]",i.title],d[u]||i.placeholder,!d[n],function(e,t,r,n){r=R(r||n),t[0]();for(h in d)if(d[h]===r){t.insert(h);break}D(e,t).unwrap(N(s),N(c)).unwrap(N(s),N(c),1).i().format(f+' title="'+r+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r=t.$(),n=r.value,i=x.p,o=x.br,u=O(i),f=O(o),l=r.before,a=r.after,s=A(l),c=S[""];if(t[0](),n&&-1!==n.indexOf("\n")){var p=N("^(?:\\s*<"+u+E+">\\s*)+"+C+"(?:\\s*<\\/"+u+">\\s*)+$");p.test(r.value)?t.replace(p,"$1").replace(N("\\s*<\\/"+u+">\\s*<"+u+E+">\\s*","g"),"\n\n").replace(N("\\s*<"+f+E+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+o+_+"\n").replace(N("(\\s*<"+f+E+_+"\\s*){2,}","g"),"</"+u+">\n<"+i+">").wrap("<"+i+">","</"+u+">",1).replace(N("(<"+u+E+">)+","g"),"$1").replace(N("(<\\/"+u+">)+","g"),"$1").tidy("\n")}else N("^\\s*<\\/"+u+">").test(a)?N("<"+u+E+">\\s*$").test(l)?t.unwrap(N("\\s*<"+u+E+">\\s*"),N("\\s*<\\/"+u+">")).replace(c,"").tidy("\n","\n"+s):(match=l.match(N("<"+u+T+">.*?$")))&&t.wrap("</"+u+">\n"+s+"<"+u+match[1]+">","").insert(c):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[x.p,x.h1,x.h2,x.h3,x.h4,x.h5,x.h6],i=[];h(n,function(e,t){i[t]=O(e)});var u=(g(n).join("|"),g(i).join("|")),f="\\s*<("+u+")"+T+">\\s*",l=N("\\s*<(?:"+u+")"+E+">\\s*"),a=N("\\s*<\\/(?:"+u+")>\\s*"),s=r.value.match(N("^"+f));s||(s=r.before.match(N(f+"$"))||[]);var c=s[2]||"",p=+(s[1]||"h0").slice(1);return t[0]().unwrap(l,a).unwrap(l,a,1).i().tidy("\n\n").format(p>5?i[0]+c:i[p+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var r=t.$(),n=r.value,i=x.blockquote,o=x.q,u=x.p,f=O(u),l="<"+f+E+">";if(N("(^|\\n|"+l+")$").test(r.before)){if(z&&(r.value===S[""]||N("("+l+")$").test(r.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),z&&(!n||t.match(/^[^<\n]*?[^>]$/)?t.wrap(k+"<"+u+">","</"+f+">"):t[N("((^|\\n)"+k+")+").test(r.value)?"outdent":"indent"](k)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function g(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,i=b.auto_encode_html,o=x.pre,u=x.code,f=O(o),l=O(u),a="<"+f+E+">\\s*<"+l+E+">\\s*",s="\\s*<\\/"+l+">\\s*<\\/"+f+">",c=N(a+"\\s*$"),p=N("^\\s*"+s),d=N("^"+C+"$");return N("(^|\\n|"+a+")$").test(r.before)?c.test(r.before)&&p.test(r.after)?t[0]().unwrap(N(c),N(p)).replace(d,g)[1]():t[0]().tidy("\n\n").wrap("<"+o+"><"+u+">","</"+l+"></"+f+">").insert(n||S[""]).replace(d,h)[1]():t[0]().format(u).loss().replace(d,function(e){return U(N("^<\\/"+l+">").test(t.$().after)?h(e):g(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=x.ol,n=x.ul,i=O(r),o=O(n),u="("+g(o)+"|"+g(i)+")";return t.match(N("<"+u+E+">"+C+"<\\/"+u+">"))?t[0]().replace(N("<"+i+T+">","g"),"<"+o+"$1>").replace(N("</"+i+">","g"),"</"+o+">")[1]():Y(e,n,x.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=x.ol,n=x.ul,i=O(r),o=O(n),u="("+g(o)+"|"+g(i)+")";return t.match(N("<"+u+E+">"+C+"<\\/"+u+">"))?t[0]().replace(N("<"+o+T+">","g"),"<"+i+"$1>").replace(N("</"+o+">","g"),"</"+i+">")[1]():Y(e,r,x.li),!1}},table:function(e,t){var M,j,H,K,r=y.tr,n=y.td,i=w.modals.table,o=w.placeholders.table,u=R(m(o[0],[1,1])),f=b.advance_table?k:"",l=x.table,a=x.caption,s=x.thead,c=x.tbody,p=x.tfoot,d=x.tr,h=x.th,g=x.td,v=O(l),$=O(a),_=O(s),E=O(c),T=O(p),C=O(d),S=O(h),z=O(g),L=[];return t.$().value===u?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,b,y){j=I(parseInt(b,10)||y,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,b){H=I(parseInt(n,10)||b,r[0],r[1]),t.blur().ui.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,r){var i,b,y,x,W,n="";for(K=U(r),i=0;H>i;++i){for(M=f+k+"<"+d+">\n",b=0;j>b;++b)M+=f+k+k+"<"+g+">"+R(m(o[1],[i+1,b+1]))+"</"+z+">\n";M+=f+k+"</"+C+">",L.push(M)}for(L=L.join("\n"),M=k+(f?"<"+s+">\n"+k+k+"<"+d+">":"<"+C+">")+"\n",y=0;j>y;++y)M+=f+k+k+"<"+h+">"+R(m(o[0],[1,y+1]))+"</"+S+">\n";if(f){for(n+=k+"<"+p+">\n",y=0;j>y;++y)n+=k+k+"<"+g+">"+R(m(o[2],[1,y+1]))+"</"+z+">\n";n+=k+"</"+T+">\n"}M+=f+k+"</"+C+">"+(f?"\n"+k+"</"+_+">\n"+n+k+"<"+c+">":"")+"\n",L=M+L+(f?"\n"+k+"</"+E+">":"")+"\n",t.tidy("\n\n").insert("<"+l+">\n"+(K?k+"<"+a+">"+K+"</"+$+">\n":"")+L+"</"+v+">",0),x=t.$(),W=x.start+x.value.indexOf(u),t.select(W,W+u.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=A(t.$().before);return t.tidy("\n\n","").insert(r+"<"+x.hr+_+"\n\n",-1),!1}}}),b.keys&&d(v.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=A(t.$().before);return t.tidy("\n","").insert(r+"<"+x.br+_+"\n",-1),!1},enter:function(e,t){var c,p,r=t.$(),n=r.value,i=t.get(),o=x.p,u=x.li,f=O(o),l=O(u),s=(A(r.before),S[""]);if(!n||n===s){if(match=r.after.match(N("^\\s*<\\/("+f+"|"+l+")>")))c=match[1],v.tools["li"===c?L:c].click(e,t);else{if(!(z&&R(i)&&r.end===i.length&&/^\s*[^<\n]*?[^>]\s*$/.test(i)))return;i="<"+o+">"+i+"</"+f+">\n<"+o+">",p=s+"</"+f+">",t.set(i+p).select(i.length,(i+s).length)}return!1}},tab:function(e,t){var r=t.$(),n=x.li,i=O(n),o=A(r.before);return N("<\\/"+n+">").test(r.after)?(t[0]().wrap("\n"+o+k+"<"+(x[L]||L)+">\n"+o+k+k+"<"+n+">","</"+i+">\n"+o+k+"</"+L+">\n"+o).insert(S[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var i,r=t.$(),n=r.value,o=r.before,u=r.after,f="<[^<>]+?>";return!n&&N(f+"$").test(o)?(i=o.split("<").pop().match(/^([^\/\s]+).*?>$/),i=i&&i[1]||0,i&&N("^\\s*<\\/"+i+">").test(u)?t.unwrap(N("<"+i+E+">"),N("\\s*<\\/"+i+">")):t.outdent(N(f)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),p.update({},0)};