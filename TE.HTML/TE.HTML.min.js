/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(t,e){function n(t,e){return RegExp(t,e)}function i(t){return t.replace(/^\s*|\s*$/g,"")}function r(t,e,n){return e>t?e:t>n?n:t}function s(t){return t.split(/\s+/)[0]}function a(t){var e=t.match(/(?:^|\n)([\t ]*).*$/);return e&&e[1]||""}function o(t,e,i){var r,o=w.$(),h=o.value,l=o.before,c=L[e],p=L[i]||i,_=s(c),d=s(p),f=a(l);if(u=c,h)w[0]().tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+d+">\n"+S+"<"+p+">").wrap("<"+c+">\n"+S+"<"+p+">","</"+d+">\n</"+_+">\n\n",1).replace(n("\\n"+S+"<"+p+">\\s*<\\/"+d+">\\n","g"),"\n</"+_+">\n\n<"+c+">\n").select(w.$().end),G&&$.tools.p.click(t,w),w[1]();else{if(n("\\s+<\\/"+s(L.ul)+"|"+s(L.ol)+">\\s*").test(l))return w.select(),!1;r=l.match(n("<"+d+K+">.*$")),r?n("<\\/"+d+">\\s*$").test(l)?w.tidy("\n"+f,!1).wrap("<"+d+r[1]+">","</"+d+">"):/>\s*$/.test(l)?n("<\\/"+d+">\\s*$").test(l)||w.wrap("\n"+f+S+"<"+c+">\n"+f+S+S+"<"+d+r[1]+">","</"+d+">\n"+f+S+"</"+_+">\n"+f):w.insert("</"+d+">\n"+f+"<"+d+r[1]+">",-1):w.tidy("\n\n","").wrap("<"+c+">\n"+S+"<"+p+">","</"+d+">\n</"+_+">")}}function h(t,e){return!e.get(0)&&G&&$.tools.p.click(t,e),e}function l(t){return c(t).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function c(t){return i(t.replace(/\s+/g," "))}var u,p="\u2013",_="\u2026",d="\u2191",f="\u2193",g="\u21b5",b="\u2318",m="\u2718",k="\u21e7",v=window,w=new TE(t),y=w._.extend,T=w._.each,x=w._.x,$=w.create(y({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",m],b:["Bold",b+"+B"],i:["Italic",b+"+I"],u:["Underline",b+"+U"],s:["Strike",b+"+"+m],a:["Link",b+"+L"],img:["Image",b+"+G"],sub:["Subscript",b+"+"+f],sup:["Superscript",b+"+"+d],abbr:["Abbreviation",b+"+"+k+"+?"],p:["Paragraph",b+"+"+g],"p,h1,h2,h3,h4,h5,h6":["H1 "+p+" H6",b+"+H"],"blockquote,q":["Quote",b+"+Q"],"pre,code":["Code",b+"+K"],ul:["Unordered List",b+"+-"],ol:["Ordered List",b+"++"],table:["Table",b+"+T"],hr:["Horizontal Rule",b+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+_]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+_,"image caption here"+_]},abbr:{title:"Abbreviation",placeholder:"meaning here"+_},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+_]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},e)),A=w._.format,N=w.config,E=N.states,O=N.languages,L=N.formats,S=(N.classes,N.tab),I=N.suffix,C="(?:\\s[^<>]*?)?",K="(|\\s[^<>]*?)",U="([\\s\\S]*?)",j=O.placeholders,G=N.auto_p;return w.type="HTML",w.i=function(){return w.replace(/\s+/g," ")},y($.tools,{clear:{i:"eraser",click:function(t,e){var n=e[0]().$(),i=n.value;return/<[^<>]+?>/.test(i)||">"===n.before.slice(-1)||"<"===n.after[0]?e.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):e.insert(""),e[1](),!!n.after}},b:{i:"bold",click:function(t,e){return h(t,e).i().format(L.b),!1}},i:{i:"italic",click:function(t,e){return h(t,e).i().format(L.i),!1}},u:{i:"underline",click:function(t,e){return h(t,e).i().format(L.u),!1}},s:{i:"strikethrough",click:function(t,e){return h(t,e).i().format(A(L.s,e._.time())),!1}},a:{i:"link",click:function(t,e){var n,i,r=L.a,s=O.modals.a;return e.record().ui.prompt(["a[href]",s.title[0]],s.placeholder[0],1,function(t,e,a){a=c(a),n=a;var o,u,p=v.location.host;-1!==n.indexOf("://")&&(o=1),""!==p&&-1!==n.indexOf("://"+p)&&(o=0),/^([.\/?&#]|javascript:)/.test(n)&&(o=0),e.blur().ui.prompt(["a[title]",s.title[1]],s.placeholder[1],0,function(t,e,s){i=l(s),h(t,e).$().length||e.insert(j[""]),u=N.advance_a&&o?' rel="nofollow" target="_blank"':"",e.i().format(r+' href="'+n+'"'+(i?' title="'+i+'"':"")+u)})}),!1}},img:{i:"image",click:function(t,e){var n,i,r=e.$(),a=L.img,o=L.figure,u=L.figcaption,p=r.value,_=O.modals.img,d=N.advance_img;return e.ui.prompt(["img[src]",_.title[0]],_.placeholder[0],1,function(t,e,r){r=c(r),n=r,e.blur().ui.prompt(["img[title]",_.title[d?2:1]],_.placeholder[d?2:1],0,function(t,e,r){i=l(r),p||(p=n.split(/[\/\\\\]/).pop()),p=l(p),e[0]().insert(""),d&&i?(e.tidy("\n\n","").insert("<"+o+">\n"+S+"<"+a+' alt="'+p+'" src="'+n+'"'+I+"\n"+S+"<"+u+">"+i+"</"+s(u)+">\n</"+s(o)+">\n\n",-1),G&&$.tools.p.click(t,w)):h(t,e).tidy(/<[^\/<>]+?>\s*$/.test(e.$().before)?"":" ","").insert("<"+a+' alt="'+p+'" src="'+n+'"'+(i?' title="'+i+'"':"")+I+" ",-1),e[1]()})}),!1}},sub:{i:"subscript",click:function(t,e){var i=L.sub,r=L.sup,a=s(r);return h(t,e)[0]().unwrap(n("<"+a+C+">"),"</"+a+">").i().format(i)[1](),!1}},sup:{i:"superscript",click:function(t,e){var i=L.sub,r=L.sup,a=s(i);return h(t,e)[0]().unwrap(n("<"+a+C+">"),"</"+a+">").i().format(r)[1](),!1}},abbr:{i:"question",click:function(t,e){var r,a,o=e.$(),l=i(o.value),c=O.modals.abbr,u=e.get(),p=i(l||j[""]),_=L.abbr,d=s(_),f="<"+x(_)+K+">",g="<"+x(_)+C+">",b="<\\/"+d+">",m=n(f+U+b);return u.replace(m,function(t,e,n){(n=i(n))&&(E.abbr[n]=(e.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),r=E.abbr,l&&r[l]?(e.i().format(_+' title="'+r[l]+'"'),!1):(e.record().ui.prompt(["abbr[title]",c.title],r[p]||c.placeholder,!r[l],function(t,e,s,o){s=i(s||o),e[0]();for(a in r)if(r[a]===s){e.insert(a);break}h(t,e).unwrap(n(g),n(b)).unwrap(n(g),n(b),1).i().format(_+' title="'+s+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(t,e){var i,r=e.$(),o=r.value,h=L.p,l=L.br,c=s(h),u=s(l),p=r.before,_=r.after,d=a(p);return o&&-1!==o.indexOf("\n")?(i=n("^(?:\\s*<"+c+C+">\\s*)+"+U+"(?:\\s*<\\/"+c+">\\s*)+$"),i.test(r.value)?e[0]().replace(i,"$1").replace(n("\\s*<\\/"+c+">\\s*<"+c+C+">\\s*","g"),"\n\n").replace(n("\\s*<"+u+C+">\\s*","g"),"\n")[1]():e[0]().replace(/\n/g,"\n<"+l+I+"\n").replace(n("(\\s*<"+u+C+I+"\\s*){2,}","g"),"</"+c+">\n<"+h+">").wrap("<"+h+">","</"+c+">",1).replace(n("(<"+c+C+">)+","g"),"$1").replace(n("(<\\/"+c+">)+","g"),"$1").tidy("\n")[1]()):n("^\\s*<\\/"+c+">").test(_)?n("<"+c+C+">\\s*$").test(p)?e[0]().unwrap(n("\\s*<"+c+C+">\\s*"),n("\\s*<\\/"+c+">")).tidy("\n","\n"+d)[1]():(match=p.match(n("<"+c+K+">.*$")))&&e.wrap("</"+c+">\n"+d+"<"+c+match[1]+">",""):e[0]().format(h,0,"\n\n")[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(t,e){var i,r,a,o,h,l,c,u,p=e.$(),_=[L.p,L.h1,L.h2,L.h3,L.h4,L.h5,L.h6],d=[];return T(_,function(t,e){d[e]=s(t)}),i=x(_).join("|"),r=x(d).join("|"),a="\\s*<("+r+")"+K+">\\s*",o=n("\\s*<(?:"+r+")"+C+">\\s*"),h=n("\\s*<\\/(?:"+r+")>\\s*"),l=p.value.match(n("^"+a)),l||(l=p.before.match(n(a+"$"))||[]),c=l[2]||"",u=+(l[1]||"h0").slice(1),e[0]().unwrap(o,h).unwrap(o,h,1).i().tidy("\n\n").format(u>5?d[0]+c:d[u+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(t,e){var i=e.$(),r=i.value,a=L.blockquote,o=L.q,h=L.p,l=s(h),c="<"+l+C+">";if(n("(^|\\n|"+c+")$").test(i.before)){if(G&&(i.value===j[""]||n("("+c+")$").test(i.before)))return e.select(),!1;e[0]().format(a,0,"\n\n","\n"),G&&(!r||e.match(/^[^<\n]*?[^>]$/)?e.wrap(S+"<"+h+">","</"+l+">"):e[n("((^|\\n)"+S+")+").test(i.value)?"outdent":"indent"](S)),e[1]()}else e.i().format(o);return!1}},"pre,code":{i:"code",click:function(t,e){function i(t){return h?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}function r(t){return h?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}var a=e.$(),o=a.value,h=N.auto_encode_html,l=L.pre,u=L.code,p=s(l),_=s(u),d="<"+p+C+">\\s*<"+_+C+">\\s*",f="\\s*<\\/"+_+">\\s*<\\/"+p+">",g=n(d+"\\s*$"),b=n("^\\s*"+f),m=n("^"+U+"$");return n("(^|\\n|"+d+")$").test(a.before)?g.test(a.before)&&b.test(a.after)?e[0]().unwrap(n(g),n(b)).replace(m,r)[1]():e[0]().tidy("\n\n").wrap("<"+l+"><"+u+">","</"+_+"></"+p+">").insert(o||j[""]).replace(m,i)[1]():e[0]().format(u).loss().replace(m,function(t){return c(n("^<\\/"+_+">").test(e.$().after)?i(t):r(t))})[1](),!1}},ul:{i:"list-ul",click:function(t,e){var i=L.ol,r=L.ul,a=s(i),h=s(r),l="("+x(h)+"|"+x(a)+")";return e.match(n("<"+l+C+">"+U+"<\\/"+l+">"))?e[0]().replace(n("<"+a+K+">","g"),"<"+h+"$1>").replace(n("</"+a+">","g"),"</"+h+">")[1]():o(t,r,L.li),!1}},ol:{i:"list-ol",click:function(t,e){var i=L.ol,r=L.ul,a=s(i),h=s(r),l="("+x(h)+"|"+x(a)+")";return e.match(n("<"+l+C+">"+U+"<\\/"+l+">"))?e[0]().replace(n("<"+h+K+">","g"),"<"+a+"$1>").replace(n("</"+h+">","g"),"</"+a+">")[1]():o(t,i,L.li),!1}},table:function(t,e){var n,a,o,h,l=E.tr,u=E.td,p=O.modals.table,_=O.placeholders.table,d=i(A(_[0],[1,1])),f=N.advance_table?S:"",g=L.table,b=L.caption,m=L.thead,k=L.tbody,v=L.tfoot,w=L.tr,y=L.th,T=L.td,x=s(g),$=s(b),I=s(m),C=s(k),K=s(v),U=s(w),j=s(y),G=s(T),q=[];return e.$().value===d?(e.select(),!1):(e[0]().ui.prompt(["table>td",p.title[0]],p.placeholder[0],0,function(t,e,s,N){a=r(parseInt(s,10)||N,u[0],u[1]),e.blur().ui.prompt(["table>tr",p.title[1]],p.placeholder[1],0,function(t,e,s,u){o=r(parseInt(s,10)||u,l[0],l[1]),e.blur().ui.prompt(["table>caption",p.title[2]],p.placeholder[2],0,function(t,e,r){var s,l,u,p,N,E="";for(h=c(r),s=0;o>s;++s){for(n=f+S+"<"+w+">\n",l=0;a>l;++l)n+=f+S+S+"<"+T+">"+i(A(_[1],[s+1,l+1]))+"</"+G+">\n";n+=f+S+"</"+U+">",q.push(n)}for(q=q.join("\n"),n=S+(f?"<"+m+">\n"+S+S+"<"+w+">":"<"+U+">")+"\n",u=0;a>u;++u)n+=f+S+S+"<"+y+">"+i(A(_[0],[1,u+1]))+"</"+j+">\n";if(f){for(E+=S+"<"+v+">\n",u=0;a>u;++u)E+=S+S+"<"+T+">"+i(A(_[2],[1,u+1]))+"</"+G+">\n";E+=S+"</"+K+">\n"}n+=f+S+"</"+U+">"+(f?"\n"+S+"</"+I+">\n"+E+S+"<"+k+">":"")+"\n",q=n+q+(f?"\n"+S+"</"+C+">":"")+"\n",e.tidy("\n\n").insert("").insert("<"+g+">\n"+(h?S+"<"+b+">"+h+"</"+$+">\n":"")+q+"</"+x+">",1),p=e.$(),N=p.start+p.after.indexOf(d),e.select(N,N+d.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(t,e){var n=a(e.$().before);return e.tidy("\n\n","").insert(n+"<"+L.hr+I+"\n\n",-1),!1}}}),N.keys&&y($.keys,{delete:"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(t,e){var n=a(e.$().before);return e.tidy("\n","").insert(n+"<"+L.br+I+"\n",-1),!1},enter:function(t,e){{var r,o,h=e.$(),l=h.value,c=e.get(),p=L.p,_=L.li,d=s(p),f=s(_);a(h.before)}if(!l){if(match=h.after.match(n("^\\s*<\\/("+d+"|"+f+")>")))r=match[1],$.tools["li"===r?u:r].click(t,e);else{if(!(G&&i(c)&&h.end===c.length&&/^\s*[^<\n]*?[^>]\s*$/.test(c)))return;c="<"+p+">"+c+"</"+d+">\n<"+p+">",o="</"+d+">",e.set(c+o).select(c.length)}return!1}},tab:function(t,e){var i=e.$(),r=L.li,o=s(r),h=a(i.before);return n("<\\/"+r+">").test(i.after)?(e.wrap("\n"+h+S+"<"+(L[u]||u)+">\n"+h+S+S+"<"+r+">","</"+o+">\n"+h+S+"</"+u+">\n"+h),!1):e.ui.tools.indent.click(t,e)},backspace:function(t,e){var i,r=e.$(),s=r.value,a=r.before,o=r.after,h="<[^<>]+?>";return!s&&n(h+"$").test(a)?(i=a.split("<").pop().match(/^([^\/\s]+).*?>$/),i=i&&i[1]||0,i&&n("^\\s*<\\/"+i+">").test(o)?e.unwrap(n("<"+i+C+">"),n("\\s*<\\/"+i+">")):e.outdent(n(h)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),w.update({},0)};