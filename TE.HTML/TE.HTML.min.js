/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(t,e){function r(t,e){return RegExp(t,e)}function n(t){return t.replace(/^\s*|\s*$/g,"")}function a(t,e,r){return e>t?e:t>r?r:t}function l(t){return t.split(/\s+/)[0]}function i(t){var e=t.match(/(?:^|\n)([\t ]*).*$/);return e&&e[1]||""}function o(t,e,n){var a,o=w.$(),c=o.value,u=o.before,s=R[e],f=R[n]||n,h=l(s),b=l(f),d=i(u),m=E[""];return p=s,w[0](),c&&c!==m?(w.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+b+">\n"+C+"<"+f+">").wrap("<"+s+">\n"+C+"<"+f+">","</"+b+">\n</"+h+">\n\n",1).replace(r("\\n"+C+"<"+f+">\\s*<\\/"+b+">\\n","g"),"\n</"+h+">\n\n<"+s+">\n").select(w.$().end),A&&T.tools.p.click(t,w),w[1](),!1):void((a=u.match(r("(?:^|\\n)[\\t ]+<(\\/?)(?:"+l(R.ul)+"|"+l(R.ol)+")"+U+">\\s*$")))?w.insert("\n"+d+(a[1]?"":C),-1):(a=u.match(r("<"+b+j+">.*?$")))?r("<\\/"+b+">\\s*$").test(u)?w.tidy("\n"+d,!1).insert(m).wrap("<"+b+a[1]+">","</"+b+">"):/>\s*$/.test(u)?w.insert(m).wrap("\n"+d+C+"<"+s+">\n"+d+C+C+"<"+b+a[1]+">","</"+b+">\n"+d+C+"</"+h+">\n"+d):w.insert("</"+b+">\n"+d+"<"+b+a[1]+">",-1).insert(m):r("<\\/"+b+">\\s*$").test(u)?w.insert(m).wrap("\n"+d+"<"+f+">","</"+b+">"):w.tidy("\n\n").insert(m).wrap("<"+s+">\n"+C+"<"+f+">","</"+b+">\n</"+h+">"))}function c(t,e){return!e.get(0)&&A&&T.tools.p.click(t,e),e}function u(t){return s(t).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function s(t){return n(t.replace(/\s+/g," "))}var p,f="\u2013",h="\u2026",b="\u2191",d="\u2193",m="\u21b5",g="\u2318",v="\u2718",$="\u21e7",k=window,w=new TE(t),q=w._.extend,y=w._.each,_=w._.x,T=w.ui(q({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",v],b:["Bold",g+"+B"],i:["Italic",g+"+I"],u:["Underline",g+"+U"],s:["Strike",g+"+"+v],a:["Link",g+"+L"],img:["Image",g+"+G"],sub:["Subscript",g+"+"+d],sup:["Superscript",g+"+"+b],abbr:["Abbreviation",g+"+"+$+"+?"],p:["Paragraph",g+"+"+m],"p,h1,h2,h3,h4,h5,h6":["H1 "+f+" H6",g+"+H"],"blockquote,q":["Quote",g+"+Q"],"pre,code":["Code",g+"+K"],ul:["Unordered List",g+"+-"],ol:["Ordered List",g+"++"],table:["Table",g+"+T"],hr:["Horizontal Rule",g+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+h]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+h,"image caption here"+h]},abbr:{title:"Abbreviation",placeholder:"meaning here"+h},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+h]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},e)),L=w._.format,x=w.config,I=x.states,H=x.languages,R=x.formats,C=(x.classes,x.tab),O=x.suffix,U="(?:\\s[^<>]*?)?",j="(|\\s[^<>]*?)",S="([\\s\\S]*?)",E=H.placeholders,A=x.auto_p;return w.type="HTML",q(T.tools,{clear:{i:"eraser",click:function(t,e){var r=e[0]().$(),n=r.value;return/<[^<>]+?>/.test(n)||">"===r.before.slice(-1)||"<"===r.after[0]?e.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):e.insert(""),e[1](),!!r.after}},b:{i:"bold",click:function(t,e){return c(t,e).i().format(R.b),!1}},i:{i:"italic",click:function(t,e){return c(t,e).i().format(R.i),!1}},u:{i:"underline",click:function(t,e){return c(t,e).i().format(R.u),!1}},s:{i:"strikethrough",click:function(t,e){return c(t,e).i().format(L(R.s,e._.time())),!1}},a:{i:"link",click:function(t,e){var r,n,a=R.a,l=H.modals.a;return e.record().ui.prompt(["a[href]",l.title[0]],l.placeholder[0],1,function(t,e,i){i=s(i),r=i;var o,p,f=k.location.host;-1!==r.indexOf("://")&&(o=1),""!==f&&-1!==r.indexOf("://"+f)&&(o=0),/^([.\/?&#]|javascript:)/.test(r)&&(o=0),e.blur().ui.prompt(["a[title]",l.title[1]],l.placeholder[1],0,function(t,e,l){n=u(l),c(t,e).$().length||e.insert(E[""]),p=x.advance_a&&o?' rel="nofollow" target="_blank"':"",e.i().format(a+' href="'+r+'"'+(n?' title="'+n+'"':"")+p)})}),!1}},img:{i:"image",click:function(t,e){var r,n,a=e.$(),i=R.img,o=R.figure,p=R.figcaption,f=a.value,h=H.modals.img,b=x.advance_img;return e.ui.prompt(["img[src]",h.title[0]],h.placeholder[0],1,function(t,e,a){a=s(a),r=a,e.blur().ui.prompt(["img[title]",h.title[b?2:1]],h.placeholder[b?2:1],0,function(t,e,a){n=u(a),f||(f=r.split(/[\/\\\\]/).pop()),f=u(f),e[0](),b&&n?(e.tidy("\n\n","").insert("<"+o+">\n"+C+"<"+i+' alt="'+f+'" src="'+r+'"'+O+"\n"+C+"<"+p+">"+n+"</"+l(p)+">\n</"+l(o)+">\n\n",-1,1),A&&T.tools.p.click(t,w)):c(t,e).tidy(/<[^\/<>]+?>\s*$/.test(e.$().before)?"":" ","").insert("<"+i+' alt="'+f+'" src="'+r+'"'+(n?' title="'+n+'"':"")+O+" ",-1,1),e[1]()})}),!1}},sub:{i:"subscript",click:function(t,e){var n=R.sub,a=R.sup,i=l(a);return c(t,e)[0]().unwrap(r("<"+i+U+">"),"</"+i+">").i().format(n)[1](),!1}},sup:{i:"superscript",click:function(t,e){var n=R.sub,a=R.sup,i=l(n);return c(t,e)[0]().unwrap(r("<"+i+U+">"),"</"+i+">").i().format(a)[1](),!1}},abbr:{i:"question",click:function(t,e){var a,i,o=e.$(),u=n(o.value),s=H.modals.abbr,p=e.get(),f=n(u||E[""]),h=R.abbr,b=l(h),d="<"+_(h)+j+">",m="<"+_(h)+U+">",g="<\\/"+b+">",v=r(d+S+g);return p.replace(v,function(t,e,r){(r=n(r))&&(I.abbr[r]=(e.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),a=I.abbr,u&&a[u]?(e.i().format(h+' title="'+a[u]+'"'),!1):(e.record().ui.prompt(["abbr[title]",s.title],a[f]||s.placeholder,!a[u],function(t,e,l,o){l=n(l||o),e[0]();for(i in a)if(a[i]===l){e.insert(i);break}c(t,e).unwrap(r(m),r(g)).unwrap(r(m),r(g),1).i().format(h+' title="'+l+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(t,e){var n,a=e.$(),o=a.value,c=R.p,u=R.br,s=l(c),p=l(u),f=a.before,h=a.after,b=i(f),d=E[""];return e[0](),o&&-1!==o.indexOf("\n")?(n=r("^(?:\\s*<"+s+U+">\\s*)+"+S+"(?:\\s*<\\/"+s+">\\s*)+$"),n.test(a.value)?e.replace(n,"$1").replace(r("\\s*<\\/"+s+">\\s*<"+s+U+">\\s*","g"),"\n\n").replace(r("\\s*<"+p+U+">\\s*","g"),"\n"):e.replace(/\n/g,"\n<"+u+O+"\n").replace(r("(\\s*<"+p+U+O+"\\s*){2,}","g"),"</"+s+">\n<"+c+">").wrap("<"+c+">","</"+s+">",1).replace(r("(<"+s+U+">)+","g"),"$1").replace(r("(<\\/"+s+">)+","g"),"$1").tidy("\n")):r("^\\s*<\\/"+s+">").test(h)?r("<"+s+U+">\\s*$").test(f)?e.unwrap(r("\\s*<"+s+U+">\\s*"),r("\\s*<\\/"+s+">")).replace(d,"").tidy("\n","\n"+b):(match=f.match(r("<"+s+j+">.*?$")))&&e.wrap("</"+s+">\n"+b+"<"+s+match[1]+">","").insert(d):e.format(c,0,"\n\n"),e[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(t,e){var n,a,i,o,c,u,s,p,f=e.$(),h=[R.p,R.h1,R.h2,R.h3,R.h4,R.h5,R.h6],b=[];return y(h,function(t,e){b[e]=l(t)}),n=_(h).join("|"),a=_(b).join("|"),i="\\s*<("+a+")"+j+">\\s*",o=r("\\s*<(?:"+a+")"+U+">\\s*"),c=r("\\s*<\\/(?:"+a+")>\\s*"),u=f.value.match(r("^"+i)),u||(u=f.before.match(r(i+"$"))||[]),s=u[2]||"",p=+(u[1]||"h0").slice(1),e[0]().unwrap(o,c).unwrap(o,c,1).i().tidy("\n\n").format(p>5?b[0]+s:b[p+1]+s,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(t,e){var n=e.$(),a=n.value,i=R.blockquote,o=R.q,c=R.p,u=l(c),s="<"+u+U+">";if(r("(^|\\n|"+s+")$").test(n.before)){if(A&&(n.value===E[""]||r("("+s+")$").test(n.before)))return e.select(),!1;e[0]().format(i,0,"\n\n","\n"),A&&(!a||e.match(/^[^<\n]*?[^>]$/)?e.wrap(C+"<"+c+">","</"+u+">"):e[r("((^|\\n)"+C+")+").test(n.value)?"outdent":"indent"](C)),e[1]()}else e.i().format(o);return!1}},"pre,code":{i:"code",click:function(t,e){function n(t){return c?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}function a(t){return c?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}var i=e.$(),o=i.value,c=x.auto_encode_html,u=R.pre,p=R.code,f=l(u),h=l(p),b="<"+f+U+">\\s*<"+h+U+">\\s*",d="\\s*<\\/"+h+">\\s*<\\/"+f+">",m=r(b+"\\s*$"),g=r("^\\s*"+d),v=r("^"+S+"$");return r("(^|\\n|"+b+")$").test(i.before)?m.test(i.before)&&g.test(i.after)?e[0]().unwrap(r(m),r(g)).replace(v,a)[1]():e[0]().tidy("\n\n").wrap("<"+u+"><"+p+">","</"+h+"></"+f+">").insert(o||E[""]).replace(v,n)[1]():e[0]().format(p).loss().replace(v,function(t){return s(r("^<\\/"+h+">").test(e.$().after)?n(t):a(t))})[1](),!1}},ul:{i:"list-ul",click:function(t,e){var n=R.ol,a=R.ul,i=l(n),c=l(a),u="("+_(c)+"|"+_(i)+")";return e.match(r("<"+u+U+">"+S+"<\\/"+u+">"))?e[0]().replace(r("<"+i+j+">","g"),"<"+c+"$1>").replace(r("</"+i+">","g"),"</"+c+">")[1]():o(t,a,R.li),!1}},ol:{i:"list-ol",click:function(t,e){var n=R.ol,a=R.ul,i=l(n),c=l(a),u="("+_(c)+"|"+_(i)+")";return e.match(r("<"+u+U+">"+S+"<\\/"+u+">"))?e[0]().replace(r("<"+c+j+">","g"),"<"+i+"$1>").replace(r("</"+c+">","g"),"</"+i+">")[1]():o(t,n,R.li),!1}},table:function(t,e){var r,i,o,c,u=I.tr,p=I.td,f=H.modals.table,h=H.placeholders.table,b=n(L(h[0],[1,1])),d=x.advance_table?C:"",m=R.table,g=R.caption,v=R.thead,$=R.tbody,k=R.tfoot,w=R.tr,q=R.th,y=R.td,_=l(m),T=l(g),O=l(v),U=l($),j=l(k),S=l(w),E=l(q),A=l(y),B=[];return e.$().value===b?(e.select(),!1):(e[0]().ui.prompt(["table>td",f.title[0]],f.placeholder[0],0,function(t,e,l,x){i=a(parseInt(l,10)||x,p[0],p[1]),e.blur().ui.prompt(["table>tr",f.title[1]],f.placeholder[1],0,function(t,e,l,p){o=a(parseInt(l,10)||p,u[0],u[1]),e.blur().ui.prompt(["table>caption",f.title[2]],f.placeholder[2],0,function(t,e,a){var l,u,p,f,x,I="";for(c=s(a),l=0;o>l;++l){for(r=d+C+"<"+w+">\n",u=0;i>u;++u)r+=d+C+C+"<"+y+">"+n(L(h[1],[l+1,u+1]))+"</"+A+">\n";r+=d+C+"</"+S+">",B.push(r)}for(B=B.join("\n"),r=C+(d?"<"+v+">\n"+C+C+"<"+w+">":"<"+S+">")+"\n",p=0;i>p;++p)r+=d+C+C+"<"+q+">"+n(L(h[0],[1,p+1]))+"</"+E+">\n";if(d){for(I+=C+"<"+k+">\n",p=0;i>p;++p)I+=C+C+"<"+y+">"+n(L(h[2],[1,p+1]))+"</"+A+">\n";I+=C+"</"+j+">\n"}r+=d+C+"</"+S+">"+(d?"\n"+C+"</"+O+">\n"+I+C+"<"+$+">":"")+"\n",B=r+B+(d?"\n"+C+"</"+U+">":"")+"\n",e.tidy("\n\n").insert("<"+m+">\n"+(c?C+"<"+g+">"+c+"</"+T+">\n":"")+B+"</"+_+">",0),f=e.$(),x=f.start+f.value.indexOf(b),e.select(x,x+b.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(t,e){var r=i(e.$().before);return e.tidy("\n\n","").insert(r+"<"+R.hr+O+"\n\n",-1),!1}}}),x.keys&&q(T.keys,{delete:"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(t,e){var r=i(e.$().before);return e.tidy("\n","").insert(r+"<"+R.br+O+"\n",-1),!1},enter:function(t,e){var a,o,c=e.$(),u=c.value,s=e.get(),f=R.p,h=R.li,b=l(f),d=l(h),m=(i(c.before),E[""]);if(!u||u===m){if(match=c.after.match(r("^\\s*<\\/("+b+"|"+d+")>")))a=match[1],T.tools["li"===a?p:a].click(t,e);else{if(!(A&&n(s)&&c.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+f+">"+s+"</"+b+">\n<"+f+">",o=m+"</"+b+">",e.set(s+o).select(s.length,(s+m).length)}return!1}},tab:function(t,e){var n=e.$(),a=R.li,o=l(a),c=i(n.before);return r("<\\/"+a+">").test(n.after)?(e[0]().wrap("\n"+c+C+"<"+(R[p]||p)+">\n"+c+C+C+"<"+a+">","</"+o+">\n"+c+C+"</"+p+">\n"+c).insert(E[""])[1](),!1):e.ui.tools.indent.click(t,e)},backspace:function(t,e){var n,a=e.$(),l=a.value,i=a.before,o=a.after,c="<[^<>]+?>";return!l&&r(c+"$").test(i)?(n=i.split("<").pop().match(/^([^\/\s]+).*?>$/),n=n&&n[1]||0,n&&r("^\\s*<\\/"+n+">").test(o)?e.unwrap(r("<"+n+U+">"),r("\\s*<\\/"+n+">")):e.outdent(r(c)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),w.update({},0)};