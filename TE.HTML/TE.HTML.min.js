/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function S(e,t){return new RegExp(e,t)}function Y(e){return e.replace(/^\s*|\s*$/g,"")}function I(e,t,n){return t>e?t:e>n?n:e}function D(e){return e.split(/\s+/)[0]}function P(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function R(e,t,n){var p,r=d.$(),i=r.value,o=r.before,u=x[t],f=x[n]||n,s=D(u),l=D(f),a=P(o),c=N[""];return z=u,d[0](),i&&i!==c?(d.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+l+">\n"+$+"<"+f+">").wrap("<"+u+">\n"+$+"<"+f+">","</"+l+">\n</"+s+">\n\n",1).replace(S("\\n"+$+"<"+f+">\\s*<\\/"+l+">\\n","g"),"\n</"+s+">\n\n<"+u+">\n").select(d.$().end),L&&g.tools.p.click(e,d),d[1](),!1):void((p=o.match(S("(?:^|\\n)[\\t ]+<(\\/?)(?:"+D(x.ul)+"|"+D(x.ol)+")"+E+">\\s*$")))?d.insert("\n"+a+(p[1]?"":$),-1):(p=o.match(S("<"+l+_+">.*?$")))?S("<\\/"+l+">\\s*$").test(o)?d.tidy("\n"+a,!1).insert(c).wrap("<"+l+p[1]+">","</"+l+">"):/>\s*$/.test(o)?d.insert(c).wrap("\n"+a+$+"<"+u+">\n"+a+$+$+"<"+l+p[1]+">","</"+l+">\n"+a+$+"</"+s+">\n"+a):d.insert("</"+l+">\n"+a+"<"+l+p[1]+">",-1).insert(c):S("<\\/"+l+">\\s*$").test(o)?d.insert(c).wrap("\n"+a+"<"+f+">","</"+l+">"):d.tidy("\n\n","").insert(c).wrap("<"+u+">\n"+$+"<"+f+">","</"+l+">\n</"+s+">"))}function W(e,t){return!t.get(0)&&L&&g.tools.p.click(e,t),t}function U(e){return B(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function B(e){return Y(e.replace(/\s+/g," "))}var z,n="–",r="…",i="↑",o="↓",u="↵",f="⌘",s="✘",l="⇧",a=window,d=(document,new TE(e)),p=d._.extend,h=d._.each,v=d._.x,g=d.ui(p({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",s],b:["Bold",f+"+B"],i:["Italic",f+"+I"],u:["Underline",f+"+U"],s:["Strike",f+"+"+s],a:["Link",f+"+L"],img:["Image",f+"+G"],sub:["Subscript",f+"+"+o],sup:["Superscript",f+"+"+i],abbr:["Abbreviation",f+"+"+l+"+?"],p:["Paragraph",f+"+"+u],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",f+"+H"],"blockquote,q":["Quote",f+"+Q"],"pre,code":["Code",f+"+K"],ul:["Unordered List",f+"+-"],ol:["Ordered List",f+"++"],table:["Table",f+"+T"],hr:["Horizontal Rule",f+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),y=d._.format,b=d.config,m=b.states,w=b.languages,x=b.formats,$=(b.classes,b.tab),T=b.suffix,E="(?:\\s[^<>]*?)?",_="(|\\s[^<>]*?)",C="([\\s\\S]*?)",N=w.placeholders,L=b.auto_p;return d.type="HTML",d.i=function(){return d.replace(/\s+/g," ")},p(g.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return W(e,t).i().format(x.b),!1}},i:{i:"italic",click:function(e,t){return W(e,t).i().format(x.i),!1}},u:{i:"underline",click:function(e,t){return W(e,t).i().format(x.u),!1}},s:{i:"strikethrough",click:function(e,t){return W(e,t).i().format(y(x.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,n=x.a,r=w.modals.a;return t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,u){u=B(u),i=u;var s,l,f=a.location.host;-1!==i.indexOf("://")&&(s=1),""!==f&&-1!==i.indexOf("://"+f)&&(s=0),/^([.\/?&#]|javascript:)/.test(i)&&(s=0),t.blur().ui.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){o=U(r),W(e,t).$().length||t.insert(N[""]),l=b.advance_a&&s?' rel="nofollow" target="_blank"':"",t.i().format(n+' href="'+i+'"'+(o?' title="'+o+'"':"")+l)})}),!1}},img:{i:"image",click:function(e,t){var l,a,n=t.$(),r=x.img,i=x.figure,o=x.figcaption,u=n.value,f=w.modals.img,s=b.advance_img;return t.ui.prompt(["img[src]",f.title[0]],f.placeholder[0],1,function(e,t,n){n=B(n),l=n,t.blur().ui.prompt(["img[title]",f.title[s?2:1]],f.placeholder[s?2:1],0,function(e,t,n){a=U(n),u||(u=l.split(/[\/\\\\]/).pop()),u=U(u),t[0](),s&&a?(t.tidy("\n\n","").insert("<"+i+">\n"+$+"<"+r+' alt="'+u+'" src="'+l+'"'+T+"\n"+$+"<"+o+">"+a+"</"+D(o)+">\n</"+D(i)+">\n\n",-1,1),L&&g.tools.p.click(e,d)):W(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+r+' alt="'+u+'" src="'+l+'"'+(a?' title="'+a+'"':"")+T+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=x.sub,r=x.sup,i=D(r);return W(e,t)[0]().unwrap(S("<"+i+E+">"),"</"+i+">").i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=x.sub,r=x.sup,i=D(n);return W(e,t)[0]().unwrap(S("<"+i+E+">"),"</"+i+">").i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var p,h,n=t.$(),r=Y(n.value),i=w.modals.abbr,o=t.get(),u=Y(r||N[""]),f=x.abbr,s=D(f),l="<"+v(f)+_+">",a="<"+v(f)+E+">",c="<\\/"+s+">",d=S(l+C+c);return o.replace(d,function(e,t,n){(n=Y(n))&&(m.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),p=m.abbr,r&&p[r]?(t.i().format(f+' title="'+p[r]+'"'),!1):(t.record().ui.prompt(["abbr[title]",i.title],p[u]||i.placeholder,!p[r],function(e,t,n,r){n=Y(n||r),t[0]();for(h in p)if(p[h]===n){t.insert(h);break}W(e,t).unwrap(S(a),S(c)).unwrap(S(a),S(c),1).i().format(f+' title="'+n+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var n=t.$(),r=n.value,i=x.p,o=x.br,u=D(i),f=D(o),s=n.before,l=n.after,a=P(s),c=N[""];if(t[0](),r&&-1!==r.indexOf("\n")){var d=S("^(?:\\s*<"+u+E+">\\s*)+"+C+"(?:\\s*<\\/"+u+">\\s*)+$");d.test(n.value)?t.replace(d,"$1").replace(S("\\s*<\\/"+u+">\\s*<"+u+E+">\\s*","g"),"\n\n").replace(S("\\s*<"+f+E+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+o+T+"\n").replace(S("(\\s*<"+f+E+T+"\\s*){2,}","g"),"</"+u+">\n<"+i+">").wrap("<"+i+">","</"+u+">",1).replace(S("(<"+u+E+">)+","g"),"$1").replace(S("(<\\/"+u+">)+","g"),"$1").tidy("\n")}else S("^\\s*<\\/"+u+">").test(l)?S("<"+u+E+">\\s*$").test(s)?t.unwrap(S("\\s*<"+u+E+">\\s*"),S("\\s*<\\/"+u+">")).replace(c,"").tidy("\n","\n"+a):(match=s.match(S("<"+u+_+">.*?$")))&&t.wrap("</"+u+">\n"+a+"<"+u+match[1]+">","").insert(c):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),r=[x.p,x.h1,x.h2,x.h3,x.h4,x.h5,x.h6],i=[];h(r,function(e,t){i[t]=D(e)});var u=(v(r).join("|"),v(i).join("|")),f="\\s*<("+u+")"+_+">\\s*",s=S("\\s*<(?:"+u+")"+E+">\\s*"),l=S("\\s*<\\/(?:"+u+")>\\s*"),a=n.value.match(S("^"+f));a||(a=n.before.match(S(f+"$"))||[]);var c=a[2]||"",d=+(a[1]||"h0").slice(1);return t[0]().unwrap(s,l).unwrap(s,l,1).i().tidy("\n\n").format(d>5?i[0]+c:i[d+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var n=t.$(),r=n.value,i=x.blockquote,o=x.q,u=x.p,f=D(u),s="<"+f+E+">";if(S("(^|\\n|"+s+")$").test(n.before)){if(L&&(n.value===N[""]||S("("+s+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),L&&(!r||t.match(/^[^<\n]*?[^>]$/)?t.wrap($+"<"+u+">","</"+f+">"):t[S("((^|\\n)"+$+")+").test(n.value)?"outdent":"indent"]($)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function v(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var n=t.$(),r=n.value,i=b.auto_encode_html,o=x.pre,u=x.code,f=D(o),s=D(u),l="<"+f+E+">\\s*<"+s+E+">\\s*",a="\\s*<\\/"+s+">\\s*<\\/"+f+">",c=S(l+"\\s*$"),d=S("^\\s*"+a),p=S("^"+C+"$");return S("(^|\\n|"+l+")$").test(n.before)?c.test(n.before)&&d.test(n.after)?t[0]().unwrap(S(c),S(d)).replace(p,v)[1]():t[0]().tidy("\n\n").wrap("<"+o+"><"+u+">","</"+s+"></"+f+">").insert(r||N[""]).replace(p,h)[1]():t[0]().format(u).loss().replace(p,function(e){return B(S("^<\\/"+s+">").test(t.$().after)?h(e):v(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=x.ol,r=x.ul,i=D(n),o=D(r),u="("+v(o)+"|"+v(i)+")";return t.match(S("<"+u+E+">"+C+"<\\/"+u+">"))?t[0]().replace(S("<"+i+_+">","g"),"<"+o+"$1>").replace(S("</"+i+">","g"),"</"+o+">")[1]():R(e,r,x.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=x.ol,r=x.ul,i=D(n),o=D(r),u="("+v(o)+"|"+v(i)+")";return t.match(S("<"+u+E+">"+C+"<\\/"+u+">"))?t[0]().replace(S("<"+o+_+">","g"),"<"+i+"$1>").replace(S("</"+o+">","g"),"</"+i+">")[1]():R(e,n,x.li),!1}},table:function(e,t){var M,O,H,A,n=m.tr,r=m.td,i=w.modals.table,o=w.placeholders.table,u=Y(y(o[0],[1,1])),f=b.advance_table?$:"",s=x.table,l=x.caption,a=x.thead,c=x.tbody,d=x.tfoot,p=x.tr,h=x.th,v=x.td,g=D(s),k=D(l),T=D(a),E=D(c),_=D(d),C=D(p),N=D(h),L=D(v),z=[];return t.$().value===u?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,b,m){O=I(parseInt(b,10)||m,r[0],r[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,b){H=I(parseInt(r,10)||b,n[0],n[1]),t.blur().ui.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,b,m,x,j,r="";for(A=B(n),i=0;H>i;++i){for(M=f+$+"<"+p+">\n",b=0;O>b;++b)M+=f+$+$+"<"+v+">"+Y(y(o[1],[i+1,b+1]))+"</"+L+">\n";M+=f+$+"</"+C+">",z.push(M)}for(z=z.join("\n"),M=$+(f?"<"+a+">\n"+$+$+"<"+p+">":"<"+C+">")+"\n",m=0;O>m;++m)M+=f+$+$+"<"+h+">"+Y(y(o[0],[1,m+1]))+"</"+N+">\n";if(f){for(r+=$+"<"+d+">\n",m=0;O>m;++m)r+=$+$+"<"+v+">"+Y(y(o[2],[1,m+1]))+"</"+L+">\n";r+=$+"</"+_+">\n"}M+=f+$+"</"+C+">"+(f?"\n"+$+"</"+T+">\n"+r+$+"<"+c+">":"")+"\n",z=M+z+(f?"\n"+$+"</"+E+">":"")+"\n",t.tidy("\n\n").insert("<"+s+">\n"+(A?$+"<"+l+">"+A+"</"+k+">\n":"")+z+"</"+g+">",0),x=t.$(),j=x.start+x.value.indexOf(u),t.select(j,j+u.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=P(t.$().before);return t.tidy("\n\n","").insert(n+"<"+x.hr+T+"\n\n",-1),!1}}}),b.keys&&p(g.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=P(t.$().before);return t.tidy("\n","").insert(n+"<"+x.br+T+"\n",-1),!1},enter:function(e,t){var c,d,n=t.$(),r=n.value,i=t.get(),o=x.p,u=x.li,f=D(o),s=D(u),a=(P(n.before),N[""]);if(!r||r===a){if(match=n.after.match(S("^\\s*<\\/("+f+"|"+s+")>")))c=match[1],g.tools["li"===c?z:c].click(e,t);else{if(!(L&&Y(i)&&n.end===i.length&&/^\s*[^<\n]*?[^>]\s*$/.test(i)))return;i="<"+o+">"+i+"</"+f+">\n<"+o+">",d=a+"</"+f+">",t.set(i+d).select(i.length,(i+a).length)}return!1}},tab:function(e,t){var n=t.$(),r=x.li,i=D(r),o=P(n.before);return S("<\\/"+r+">").test(n.after)?(t[0]().wrap("\n"+o+$+"<"+(x[z]||z)+">\n"+o+$+$+"<"+r+">","</"+i+">\n"+o+$+"</"+z+">\n"+o).insert(N[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,o=n.before,u=n.after,f="<[^<>]+?>";return!r&&S(f+"$").test(o)?(i=o.split("<").pop().match(/^([^\/\s]+).*?>$/),i=i&&i[1]||0,i&&S("^\\s*<\\/"+i+">").test(u)?t.unwrap(S("<"+i+E+">"),S("\\s*<\\/"+i+">")):t.outdent(S(f)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),d.update({},0)};