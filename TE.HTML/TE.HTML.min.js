/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function M(e){return e.split(/\s+/)[0]}function R(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function K(e,t,r){var d,n=p.$(),i=n.value,o=n.before,l=T[t],a=T[r]||r,f=M(l),s=M(a),u=R(o),c=H[""];return I=l,p[0](),i&&i!==c?(p.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+s+">\n"+S+"<"+a+">").wrap("<"+l+">\n"+S+"<"+a+">","</"+s+">\n</"+f+">\n\n",1).replace(y("\\n"+S+"<"+a+">\\s*<\\/"+s+">\\n","g"),"\n</"+f+">\n\n<"+l+">\n").select(p.$().end),q&&w.tools.p.click(e,p),p[1](),!1):void((d=o.match(y("(?:^|\\n)[\\t ]+<(\\/?)(?:"+M(T.ul)+"|"+M(T.ol)+")"+z+">\\s*$")))?p.insert("\n"+u+(d[1]?"":S),-1):(d=o.match(y("<"+s+O+">.*?$")))?y("<\\/"+s+">\\s*$").test(o)?p.tidy("\n"+u,!1).insert(c).wrap("<"+s+d[1]+">","</"+s+">"):/>\s*$/.test(o)?p.insert(c).wrap("\n"+u+S+"<"+l+">\n"+u+S+S+"<"+s+d[1]+">","</"+s+">\n"+u+S+"</"+f+">\n"+u):p.insert("</"+s+">\n"+u+"<"+s+d[1]+">",-1).insert(c):y("<\\/"+s+">\\s*$").test(o)?p.insert(c).wrap("\n"+u+"<"+a+">","</"+s+">"):p.tidy("\n\n").insert(c).wrap("<"+l+">\n"+S+"<"+a+">","</"+s+">\n</"+f+">"))}function A(e,t){return!t.get(0)&&q&&w.tools.p.click(e,t),t}function U(e){return W(e).replace(/<.*?>/g,"").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;")}function N(e){return W(e).replace(/<.*?>/g,"").replace(/\s/g,"%20").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29")}function W(e){return v(e.replace(/\s+/g," "))}var I,r="–",n="…",i="↑",o="↓",l="↵",a="⌘",f="✘",s="⇧",u=window,p=(document,new TE(e)),d=p._,h=d.extend,g=d.each,b=d.x,v=d.trim,m=d.edge,y=d.pattern,$=d.i,w=p.ui(h({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",f],b:["Bold",a+"+B"],i:["Italic",a+"+I"],u:["Underline",a+"+U"],s:["Strike",a+"+"+f],a:["Link",a+"+L"],img:["Image",a+"+G"],sub:["Subscript",a+"+"+o],sup:["Superscript",a+"+"+i],abbr:["Abbreviation",a+"+"+s+"+?"],p:["Paragraph",a+"+"+l],"p,h1,h2,h3,h4,h5,h6":["H1 "+r+" H6",a+"+H"],"blockquote,q":["Quote",a+"+Q"],"pre,code":["Code",a+"+K"],ul:["Unordered List",a+"+-"],ol:["Ordered List",a+"++"],table:["Table",a+"+T"],hr:["Horizontal Rule",a+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+n]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+n,"image caption here"+n]},abbr:{title:"Abbreviation",placeholder:"meaning here"+n},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+n]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),k=d.format,x=p.config,_=x.states,E=x.languages,T=x.formats,S=(x.classes,x.tab),L=x.suffix,z="(?:\\s[^<>]*?)?",O="(|\\s[^<>]*?)",j="([\\s\\S]*?)",H=E.placeholders,q=x.auto_p;return p.type="HTML",h(w.tools,{clear:{i:"eraser",click:function(e,t){var r=t[0]().$(),n=r.value;return/<[^<>]+?>/.test(n)||">"===r.before.slice(-1)||"<"===r.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!r.after}},b:{i:"bold",click:function(e,t){return A(e,t).i().format(T.b),!1}},i:{i:"italic",click:function(e,t){return A(e,t).i().format(T.i),!1}},u:{i:"underline",click:function(e,t){return A(e,t).i().format(T.u),!1}},s:{i:"strikethrough",click:function(e,t){return A(e,t).i().format(k(T.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,o,r=T.a,n=E.modals.a;return t.record().ui.prompt(["a[href]",n.title[0]],n.placeholder[0],1,function(e,t,l){l=N(l),i=l;var f,s,a=u.location.host;-1!==i.indexOf("://")&&(f=1),""!==a&&-1!==i.indexOf("://"+a)&&(f=0),/^([.\/?&#]|javascript:)/.test(i)&&(f=0),t.blur().ui.prompt(["a[title]",n.title[1]],n.placeholder[1],0,function(e,t,n){o=U(n),A(e,t).$().length||t.insert(H[""]),s=x.advance_a&&f?' rel="nofollow" target="_blank"':"",t.i().format(r+' href="'+i+'"'+(o?' title="'+o+'"':"")+s)})}),!1}},img:{i:"image",click:function(e,t){var s,u,r=t.$(),n=T.img,i=T.figure,o=T.figcaption,l=r.value,a=E.modals.img,f=x.advance_img;return t.ui.prompt(["img[src]",a.title[0]],a.placeholder[0],1,function(e,t,r){r=N(r),s=r,t.blur().ui.prompt(["img[title]",a.title[f?2:1]],a.placeholder[f?2:1],0,function(e,t,r){u=U(r),l||(l=s.split(/[\/\\\\]/).pop()),l=U(l),t[0](),f&&u?(t.tidy("\n\n","").insert("<"+i+">\n"+S+"<"+n+' alt="'+l+'" src="'+s+'"'+L+"\n"+S+"<"+o+">"+u+"</"+M(o)+">\n</"+M(i)+">\n\n",-1,1),q&&w.tools.p.click(e,t)):A(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+n+' alt="'+l+'" src="'+s+'"'+(u?' title="'+u+'"':"")+L+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=T.sub,n=T.sup,i=M(n);return A(e,t)[0]().unwrap(y("<"+i+z+">"),"</"+i+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=T.sub,n=T.sup,i=M(r);return A(e,t)[0]().unwrap(y("<"+i+z+">"),"</"+i+">").i().format(n)[1](),!1}},abbr:{i:"question",click:function(e,t){var d,h,r=t.$(),n=v(r.value),i=E.modals.abbr,o=t.get(),l=v(n||H[""]),a=T.abbr,f=M(a),s="<"+b(a)+O+">",u="<"+b(a)+z+">",c="<\\/"+f+">",p=y(s+j+c);return o.replace(p,function(e,t,r){(r=v(r))&&(_.abbr[r]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),d=_.abbr,n&&d[n]?(t.i().format(a+' title="'+d[n]+'"'),!1):(t.record().ui.prompt(["abbr[title]",i.title],d[l]||i.placeholder,!d[n],function(e,t,r,i){r=U(r||i),t[0](),n||t.insert(r.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(h in d)if(U(d[h])===r){t.insert(h);break}A(e,t).unwrap(y(u),y(c)).unwrap(y(u),y(c),1).i().format(a+' title="'+r+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r=t.$(),n=r.value,i=T.p,o=T.br,l=M(i),a=M(o),f=r.before,s=r.after,u=R(f),c=H[""];if(t[0](),n&&-1!==n.indexOf("\n")){var p=y("^(?:\\s*<"+l+z+">\\s*)+"+j+"(?:\\s*<\\/"+l+">\\s*)+$");p.test(r.value)?t.replace(p,"$1").replace(y("\\s*<\\/"+l+">\\s*<"+l+z+">\\s*","g"),"\n\n").replace(y("\\s*<"+a+z+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+o+L+"\n").replace(y("(\\s*<"+a+z+L+"\\s*){2,}","g"),"</"+l+">\n<"+i+">").wrap("<"+i+">","</"+l+">",1).replace(y("(<"+l+z+">)+","g"),"$1").replace(y("(<\\/"+l+">)+","g"),"$1").tidy("\n")}else y("^\\s*<\\/"+l+">").test(s)?y("<"+l+z+">\\s*$").test(f)?t.unwrap(y("\\s*<"+l+z+">\\s*"),y("\\s*<\\/"+l+">")).replace(c,"").tidy("\n","\n"+u):(match=f.match(y("<"+l+O+">.*?$")))&&t.wrap("</"+l+">\n"+u+"<"+l+match[1]+">","").insert(c):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),n=[T.p,T.h1,T.h2,T.h3,T.h4,T.h5,T.h6],i=[];g(n,function(e,t){i[t]=M(e)});var l=(b(n).join("|"),b(i).join("|")),a="\\s*<("+l+")"+O+">\\s*",f=y("\\s*<(?:"+l+")"+z+">\\s*"),s=y("\\s*<\\/(?:"+l+")>\\s*"),u=r.value.match(y("^"+a));u||(u=r.before.match(y(a+"$"))||[]);var c=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(f,s).unwrap(f,s,1).i().tidy("\n\n").format(p>5?i[0]+c:i[p+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-right",click:function(e,t){var r=t.$(),n=r.value,i=T.blockquote,o=T.q,l=T.p,a=M(l),f="<"+a+z+">";if(y("(^|\\n|"+f+")$").test(r.before)){if(q&&(r.value===H[""]||y("("+f+")$").test(r.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),q&&(!n||t.match(/^[^<\n]*?[^>]$/)?t.wrap(S+"<"+l+">","</"+a+">"):t[y("((^|\\n)"+S+")+").test(r.value)?"outdent":"indent"](S)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function g(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var r=t.$(),n=r.value,i=x.auto_encode_html,o=T.pre,l=T.code,a=M(o),f=M(l),s="<"+a+z+">\\s*<"+f+z+">\\s*",u="\\s*<\\/"+f+">\\s*<\\/"+a+">",c=y(s+"\\s*$"),p=y("^\\s*"+u),d=y("^"+j+"$");return y("(^|\\n|"+s+")$").test(r.before)?c.test(r.before)&&p.test(r.after)?t[0]().unwrap(y(c),y(p)).replace(d,g)[1]():t[0]().tidy("\n\n").wrap("<"+o+"><"+l+">","</"+f+"></"+a+">").insert(n||H[""]).replace(d,h)[1]():t[0]().format(l).loss().replace(d,function(e){return W(y("^<\\/"+f+">").test(t.$().after)?h(e):g(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=T.ol,n=T.ul,i=M(r),o=M(n),l="("+b(o)+"|"+b(i)+")";return t.match(y("<"+l+z+">"+j+"<\\/"+l+">"))?t[0]().replace(y("<"+i+O+">","g"),"<"+o+"$1>").replace(y("</"+i+">","g"),"</"+o+">")[1]():K(e,n,T.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=T.ol,n=T.ul,i=M(r),o=M(n),l="("+b(o)+"|"+b(i)+")";return t.match(y("<"+l+z+">"+j+"<\\/"+l+">"))?t[0]().replace(y("<"+o+O+">","g"),"<"+i+"$1>").replace(y("</"+o+">","g"),"</"+i+">")[1]():K(e,r,T.li),!1}},table:function(e,t){var q,I,R,K,r=_.tr,n=_.td,i=E.modals.table,o=E.placeholders.table,l=v(k(o[0],[1,1])),a=x.advance_table?S:"",f=T.table,s=T.caption,u=T.thead,c=T.tbody,p=T.tfoot,d=T.tr,h=T.th,g=T.td,b=M(f),y=M(s),w=M(u),C=M(c),L=M(p),z=M(d),O=M(h),j=M(g),H=[];return t.$().value===l?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,x,_){I=m($(x)||_,n[0],n[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,n,x){R=m($(n)||x,r[0],r[1]),t.blur().ui.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,r){var i,m,$,_,E,n="";for(K=W(r),i=0;R>i;++i){for(q=a+S+"<"+d+">\n",m=0;I>m;++m)q+=a+S+S+"<"+g+">"+v(k(o[1],[i+1,m+1]))+"</"+j+">\n";q+=a+S+"</"+z+">",H.push(q)}for(H=H.join("\n"),q=S+(a?"<"+u+">\n"+S+S+"<"+d+">":"<"+z+">")+"\n",$=0;I>$;++$)q+=a+S+S+"<"+h+">"+v(k(o[0],[1,$+1]))+"</"+O+">\n";if(a){for(n+=S+"<"+p+">\n",n+=S+S+"<"+d+">\n",$=0;I>$;++$)n+=S+S+S+"<"+g+">"+v(k(o[2],[1,$+1]))+"</"+j+">\n";n+=S+S+"</"+d+">\n",n+=S+"</"+L+">\n"}q+=a+S+"</"+z+">"+(a?"\n"+S+"</"+w+">\n"+n+S+"<"+c+">":"")+"\n",H=q+H+(a?"\n"+S+"</"+C+">":"")+"\n",t.tidy("\n\n").insert("<"+f+">\n"+(K?S+"<"+s+">"+K+"</"+y+">\n":"")+H+"</"+b+">",0),_=t.$(),E=_.start+_.value.indexOf(l),t.select(E,E+l.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=R(t.$().before);return t.tidy("\n\n","").insert(r+"<"+T.hr+L+"\n\n",-1),!1}}}),x.keys&&h(w.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=R(t.$().before);return t.tidy("\n","").insert(r+"<"+T.br+L+"\n",-1),!1},enter:function(e,t){var c,p,r=t.$(),n=r.value,i=t.get(),o=T.p,l=T.li,a=M(o),f=M(l),u=(R(r.before),H[""]);if(!n||n===u){if(match=r.after.match(y("^\\s*<\\/("+a+"|"+f+")>")))c=match[1],w.tools["li"===c?I:c].click(e,t);else{if(!(q&&v(i)&&r.end===i.length&&/^\s*[^<\n]*?[^>]\s*$/.test(i)))return;i="<"+o+">"+i+"</"+a+">\n<"+o+">",p=u+"</"+a+">",t.set(i+p).select(i.length,(i+u).length)}return!1}},tab:function(e,t){var r=t.$(),n=T.li,i=M(n),o=R(r.before);return y("<\\/"+n+">").test(r.after)?(t[0]().wrap("\n"+o+S+"<"+(T[I]||I)+">\n"+o+S+S+"<"+n+">","</"+i+">\n"+o+S+"</"+I+">\n"+o).insert(H[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var i,r=t.$(),n=r.value,o=r.before,l=r.after,a="<[^<>]+?>";return!n&&y(a+"$").test(o)?(i=o.split("<").pop().match(/^([^\/\s]+).*?>$/),i=i&&i[1]||0,i&&y("^\\s*<\\/"+i+">").test(l)?t.unwrap(y("<"+i+z+">"),y("\\s*<\\/"+i+">")):t.outdent(y(a)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),p.update({},0)};