/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e){return"function"==typeof e}function r(e,t){return RegExp(e,t)}function o(e){return e.replace(/^\s*|\s*$/g,"")}function i(e,t,n){return t>e?t:e>n?n:e}function a(e){return e.split(/\s+/)[0]}function l(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function c(e,t,n){var o=x.$(),i=o.value,c=o.before,u=S[t],s=S[n]||n,f=a(u),d=a(s),h=l(c);if(p=u,i)x[0]().tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+d+">\n"+H+"<"+s+">").wrap("<"+u+">\n"+H+"<"+s+">","</"+d+">\n</"+f+">\n\n",1).replace(r("\\n"+H+"<"+s+">\\s*<\\/"+d+">\\n","g"),"\n</"+f+">\n\n<"+u+">\n").select(x.$().end),U&&E.tools.p.click(e,x),x[1]();else{if(r("\\s+<\\/"+a(S.ul)+"|"+a(S.ol)+">\\s*").test(c))return x.select(),!1;var b=c.match(r("<"+d+M+">.*$"));b?r("<\\/"+d+">\\s*$").test(c)?x.tidy("\n"+h,!1).wrap("<"+d+b[1]+">","</"+d+">"):/>\s*$/.test(c)?r("<\\/"+d+">\\s*$").test(c)||x.wrap("\n"+h+H+"<"+u+">\n"+h+H+H+"<"+d+b[1]+">","</"+d+">\n"+h+H+"</"+f+">\n"+h):x.insert("</"+d+">\n"+h+"<"+d+b[1]+">",-1):x.tidy("\n\n","").wrap("<"+u+">\n"+H+"<"+s+">","</"+d+">\n</"+f+">")}}function u(e,t){return!t.get(0)&&U&&E.tools.p.click(e,t),t}function s(e){return f(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function f(e){return o(e.replace(/\s+/g," "))}var p,d="\u2013",h="\u2026",b="\u2191",g="\u2193",m="\u21B5",v="\u2318",$="\u2718",k="\u21E5",y="\u21E7",w=window,x=new TE(e),_=x._.extend,T=x._.each,q=x._.x,E=x.create(_({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:"Clear Format ("+$+")",b:"Bold ("+v+"+B)",i:"Italic ("+v+"+I)",u:"Underline ("+v+"+U)",s:"Strike ("+v+"+"+$+")",a:"Link ("+v+"+L)",img:"Image ("+v+"+G)",sub:"Subscript ("+v+"+"+g+")",sup:"Superscript ("+v+"+"+b+")",abbr:"Abbreviation ("+v+"+"+y+"+?)",p:"Paragraph ("+v+"+"+m+")","p,h1,h2,h3,h4,h5,h6":"H1 "+d+" H6 ("+v+"+H)","blockquote,q":"Quote ("+v+"+Q)","pre,code":"Code ("+v+"+K)",ul:"Unordered List ("+v+"+-)",ol:"Ordered List ("+v+"++)",indent:"Indent ("+k+")",outdent:"Outdent ("+y+"+"+k+")",table:"Table ("+v+"+T)",hr:"Horizontal Rule ("+v+"+R)"},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+h]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+h,"image caption here"+h]},abbr:{title:"Abbreviation",placeholder:"meaning here"+h},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+h]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),L=x._.format,C=x.config,I=C.states,O=C.languages,S=C.formats,H=(C.classes,C.tab),R=C.suffix,j="(?:\\s[^<>]*?)?",M="(|\\s[^<>]*?)",z="([\\s\\S]*?)",N=O.placeholders[""],U=C.auto_p;return x.type="HTML",x.i=function(){return x.replace(/\s+/g," ")},_(E.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return u(e,t).i().format(S.b),!1}},i:{i:"italic",click:function(e,t){return u(e,t).i().format(S.i),!1}},u:{i:"underline",click:function(e,t){return u(e,t).i().format(S.u),!1}},s:{i:"strikethrough",click:function(e,t){return u(e,t).i().format(L(S.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=S.a,i=O.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,a){a=f(a),n=a;var l,c,p=w.location.host;-1!==n.indexOf("://")&&(l=1),""!==p&&-1!==n.indexOf("://"+p)&&(l=0),/^([.\/?&#]|javascript:)/.test(n)&&(l=0),t.blur().ui.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=s(i),u(e,t).$().length||t.insert(N),c=C.advance_a&&l?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+c)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),i=S.img,l=S.figure,c=S.figcaption,p=o.value,d=O.modals.img,h=C.advance_img;return t.ui.prompt(["img[src]",d.title[0]],d.placeholder[0],1,function(e,t,o){o=f(o),n=o,t.blur().ui.prompt(["img[title]",d.title[h?2:1]],d.placeholder[h?2:1],0,function(e,t,o){r=s(o),p||(p=n.split(/[\/\\\\]/).pop()),p=s(p),t[0]().insert(""),h&&r?(t.tidy("\n\n","").insert("<"+l+">\n"+H+"<"+i+' alt="'+p+'" src="'+n+'"'+R+"\n"+H+"<"+c+">"+r+"</"+a(c)+">\n</"+a(l)+">\n\n",-1),U&&E.tools.p.click(e,x)):u(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+i+' alt="'+p+'" src="'+n+'"'+(r?' title="'+r+'"':"")+R+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=S.sub,o=S.sup,i=a(o);return u(e,t)[0]().unwrap(r("<"+i+j+">"),"</"+i+">").i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=S.sub,o=S.sup,i=a(n);return u(e,t)[0]().unwrap(r("<"+i+j+">"),"</"+i+">").i().format(o)[1](),!1}},abbr:{i:"question",click:function(e,t){var n,i,l=t.$(),c=o(l.value),u=O.modals.abbr,s=t.get(),f=o(c||N),p=S.abbr,d=a(p),h="<"+q(p)+M+">",b="<"+q(p)+j+">",g="<\\/"+d+">",m=r(h+z+g);return s.replace(m,function(e,t,n){(n=o(n))&&(I.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),n=I.abbr,c&&n[c]?(t.i().format(p+' title="'+n[c]+'"'),!1):(t.record().ui.prompt(["abbr[title]",u.title],n[f]||u.placeholder,!n[c],function(e,t,a,l){a=o(a||l),t[0]();for(i in n)if(n[i]===a){t.insert(i);break}t.unwrap(r(b),r(g)).unwrap(r(b),r(g),1).i().format(p+' title="'+a+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var n=t.$(),o=n.value,i=S.p,c=S.br,u=a(i),s=a(c),f=n.before,p=n.after,d=l(f);if(o&&-1!==o.indexOf("\n")){var h=r("^(?:\\s*<"+u+j+">\\s*)+"+z+"(?:\\s*<\\/"+u+">\\s*)+$");h.test(n.value)?t[0]().replace(h,"$1").replace(r("\\s*<\\/"+u+">\\s*<"+u+j+">\\s*","g"),"\n\n").replace(r("\\s*<"+s+j+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+c+R+"\n").replace(r("(\\s*<"+s+j+R+"\\s*){2,}","g"),"</"+u+">\n<"+i+">").wrap("<"+i+">","</"+u+">",1).replace(r("(<"+u+j+">)+","g"),"$1").replace(r("(<\\/"+u+">)+","g"),"$1").tidy("\n")[1]()}else r("^\\s*<\\/"+u+">").test(p)?r("<"+u+j+">\\s*$").test(f)?t[0]().unwrap(r("\\s*<"+u+j+">\\s*"),r("\\s*<\\/"+u+">")).tidy("\n","\n"+d)[1]():(match=f.match(r("<"+u+M+">.*$")))&&t.wrap("</"+u+">\n"+d+"<"+u+match[1]+">",""):t[0]().format(i,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),o=[S.p,S.h1,S.h2,S.h3,S.h4,S.h5,S.h6],i=[];T(o,function(e,t){i[t]=a(e)});var l=(q(o).join("|"),q(i).join("|")),c="\\s*<("+l+")"+M+">\\s*",u=r("\\s*<(?:"+l+")"+j+">\\s*"),s=r("\\s*<\\/(?:"+l+")>\\s*"),f=n.value.match(r("^"+c));f||(f=n.before.match(r(c+"$"))||[]);var p=f[2]||"",d=+(f[1]||"h0").slice(1);return t[0]().unwrap(u,s).unwrap(u,s,1).i().format(d>5?i[0]+p:i[d+1]+p,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var n=t.$(),o=n.value,i=S.blockquote,l=S.q,c=S.p,u=a(c),s="<"+u+j+">";if(r("(^|\\n|"+s+")$").test(n.before)){if(U&&(n.value===N||r("("+s+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),U&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(H+"<"+c+">","</"+u+">"):t[r("((^|\\n)"+H+")+").test(n.value)?"outdent":"indent"](H)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function n(e){return c?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return c?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var i=t.$(),l=i.value,c=C.auto_encode_html,u=S.pre,s=S.code,p=a(u),d=a(s),h="<"+p+j+">\\s*<"+d+j+">\\s*",b="\\s*<\\/"+d+">\\s*<\\/"+p+">",g=r(h+"\\s*$"),m=r("^\\s*"+b),v=r("^"+z+"$");return r("(^|\\n|"+h+")$").test(i.before)?g.test(i.before)&&m.test(i.after)?t[0]().unwrap(r(g),r(m)).replace(v,o)[1]():t[0]().tidy("\n\n").wrap("<"+u+"><"+s+">","</"+d+"></"+p+">").insert(l||N).replace(v,n)[1]():t[0]().format(s).loss().replace(v,function(e){return f(r("^<\\/"+d+">").test(t.$().after)?n(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=S.ol,o=S.ul,i=a(n),l=a(o),u="("+q(l)+"|"+q(i)+")";return t.match(r("<"+u+j+">"+z+"<\\/"+u+">"))?t[0]().replace(r("<"+i+M+">","g"),"<"+l+"$1>").replace(r("</"+i+">","g"),"</"+l+">")[1]():c(e,o,S.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=S.ol,o=S.ul,i=a(n),l=a(o),u="("+q(l)+"|"+q(i)+")";return t.match(r("<"+u+j+">"+z+"<\\/"+u+">"))?t[0]().replace(r("<"+l+M+">","g"),"<"+i+"$1>").replace(r("</"+l+">","g"),"</"+i+">")[1]():c(e,n,S.li),!1}},table:function(e,t){var n,r,o,l,c=I.tr,u=I.td,s=O.modals.table,p=O.placeholders.table,d=L(p[0],[1,1]),h=C.advance_table?H:"",b=S.table,g=S.caption,m=S.thead,v=S.tbody,$=S.tfoot,k=S.tr,y=S.th,w=S.td,x=a(b),_=a(g),T=a(m),q=a(v),E=a($),R=a(k),j=a(y),M=a(w),z=[];return t.$().value===d?(t.select(),!1):(t[0]().insert("").ui.prompt(["table>td",s.title[0]],s.placeholder[0],0,function(e,t,a,C){r=i(parseInt(a,10)||C,u[0],u[1]),t.blur().ui.prompt(["table>tr",s.title[1]],s.placeholder[1],0,function(e,t,a,u){o=i(parseInt(a,10)||u,c[0],c[1]),t.blur().ui.prompt(["table>caption",s.title[2]],s.placeholder[2],0,function(e,t,i){var a,c,u,s,C,I="";for(l=f(i),a=0;o>a;++a){for(n=h+H+"<"+k+">\n",c=0;r>c;++c)n+=h+H+H+"<"+w+">"+L(p[1],[a+1,c+1])+"</"+M+">\n";n+=h+H+"</"+R+">",z.push(n)}for(z=z.join("\n"),n=H+(h?"<"+m+">\n"+H+H+"<"+k+">":"<"+R+">")+"\n",u=0;o>u;++u)n+=h+H+H+"<"+y+">"+L(p[0],[1,u+1])+"</"+j+">\n";if(h){for(I+=H+"<"+$+">\n",u=0;o>u;++u)I+=H+H+"<"+w+">"+L(p[2],[1,u+1])+"</"+M+">\n";I+=H+"</"+E+">\n"}n+=h+H+"</"+R+">"+(h?"\n"+H+"</"+T+">\n"+I+H+"<"+v+">":"")+"\n",z=n+z+(h?"\n"+H+"</"+q+">":"")+"\n",t.tidy("\n\n").insert("<"+b+">\n"+(l?H+"<"+g+">"+l+"</"+_+">\n":"")+z+"</"+x+">",1),s=t.$(),C=s.start+s.after.indexOf(d),t.select(C,C+d.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=l(t.$().before);return t.tidy("\n\n","").insert(n+"<"+S.hr+R+"\n\n",-1),!1}}}),T(E.tools,function(e,t){var r=O.tools[t]||"";n(e)?E.tools[t]={title:r,click:e}:e.title||(e.title=r)}),C.keys&&_(E.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=l(t.$().before);return t.tidy("\n","").insert(n+"<"+S.br+R+"\n",-1),!1},enter:function(e,t){{var n,i,c=t.$(),u=c.value,s=t.get(),f=S.p,d=S.li,h=a(f),b=a(d);l(c.before)}if(!u){if(match=c.after.match(r("^\\s*<\\/("+h+"|"+b+")>")))n=match[1],E.tools["li"===n?p:n].click(e,t);else{if(!(U&&o(s)&&c.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+f+">"+s+"</"+h+">\n<"+f+">",i="</"+h+">",t.set(s+i).select(s.length)}return!1}},tab:function(e,t){var n=t.$(),o=S.li,i=a(o),c=l(n.before);return r("<\\/"+o+">").test(n.after)?(t.wrap("\n"+c+H+"<"+(S[p]||p)+">\n"+c+H+H+"<"+o+">","</"+i+">\n"+c+H+"</"+p+">\n"+c),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var n,o=t.$(),i=o.value,a=o.before,l=o.after,c="<[^<>]+?>";return!i&&r(c+"$").test(a)?(n=a.split("<").pop().match(/^([^\/\s]+).*?>$/),n=n&&n[1]||0,n&&r("^\\s*<\\/"+n+">").test(l)?t.unwrap(r("<"+n+j+">"),r("\\s*<\\/"+n+">")):t.outdent(r(c)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),x.update({},0)};