/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function M(e,t){return new RegExp(e,t)}function U(e){return e.replace(/^\s*|\s*$/g,"")}function j(e,t,n){return t>e?t:e>n?n:e}function C(e){return parseInt(e,10)}function F(e){return e.split(/\s+/)[0]}function A(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function N(e,t,n){var d,r=p.$(),i=r.value,l=r.before,a=y[t],s=y[n]||n,f=F(a),o=F(s),u=A(l),c=E[""];return L=a,p[0](),i&&i!==c?(p.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+o+">\n"+x+"<"+s+">").wrap("<"+a+">\n"+x+"<"+s+">","</"+o+">\n</"+f+">\n\n",1).replace(M("\\n"+x+"<"+s+">\\s*<\\/"+o+">\\n","g"),"\n</"+f+">\n\n<"+a+">\n").select(p.$().end),I&&g.tools.p.click(e,p),p[1](),!1):void((d=l.match(M("(?:^|\\n)[\\t ]+<(\\/?)(?:"+F(y.ul)+"|"+F(y.ol)+")"+T+">\\s*$")))?p.insert("\n"+u+(d[1]?"":x),-1):(d=l.match(M("<"+o+q+">.*?$")))?M("<\\/"+o+">\\s*$").test(l)?p.tidy("\n"+u,!1).insert(c).wrap("<"+o+d[1]+">","</"+o+">"):/>\s*$/.test(l)?p.insert(c).wrap("\n"+u+x+"<"+a+">\n"+u+x+x+"<"+o+d[1]+">","</"+o+">\n"+u+x+"</"+f+">\n"+u):p.insert("</"+o+">\n"+u+"<"+o+d[1]+">",-1).insert(c):M("<\\/"+o+">\\s*$").test(l)?p.insert(c).wrap("\n"+u+"<"+s+">","</"+o+">"):p.tidy("\n\n").insert(c).wrap("<"+a+">\n"+x+"<"+s+">","</"+o+">\n</"+f+">"))}function Z(e,t){return!t.get(0)&&I&&g.tools.p.click(e,t),t}function Y(e){return W(e).replace(/<.*?>/g,"").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;")}function P(e){return W(e).replace(/<.*?>/g,"").replace(/\s/g,"%20").replace(/"/g,"%22").replace(/\(/g,"%28").replace(/\)/g,"%29")}function W(e){return U(e.replace(/\s+/g," "))}var L,n="–",r="…",i="↑",l="↓",a="↵",s="⌘",f="✘",o="⇧",u=window,p=(document,new TE(e)),d=p._.extend,h=p._.each,$=p._.x,g=p.ui(d({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",f],b:["Bold",s+"+B"],i:["Italic",s+"+I"],u:["Underline",s+"+U"],s:["Strike",s+"+"+f],a:["Link",s+"+L"],img:["Image",s+"+G"],sub:["Subscript",s+"+"+l],sup:["Superscript",s+"+"+i],abbr:["Abbreviation",s+"+"+o+"+?"],p:["Paragraph",s+"+"+a],"p,h1,h2,h3,h4,h5,h6":["H1 "+n+" H6",s+"+H"],"blockquote,q":["Quote",s+"+Q"],"pre,code":["Code",s+"+K"],ul:["Unordered List",s+"+-"],ol:["Ordered List",s+"++"],table:["Table",s+"+T"],hr:["Horizontal Rule",s+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+r]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+r,"image caption here"+r]},abbr:{title:"Abbreviation",placeholder:"meaning here"+r},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+r]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),b=p._.format,m=p.config,v=m.states,k=m.languages,y=m.formats,x=(m.classes,m.tab),_=m.suffix,T="(?:\\s[^<>]*?)?",q="(|\\s[^<>]*?)",S="([\\s\\S]*?)",E=k.placeholders,I=m.auto_p;return p.type="HTML",d(g.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return Z(e,t).i().format(y.b),!1}},i:{i:"italic",click:function(e,t){return Z(e,t).i().format(y.i),!1}},u:{i:"underline",click:function(e,t){return Z(e,t).i().format(y.u),!1}},s:{i:"strikethrough",click:function(e,t){return Z(e,t).i().format(b(y.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var i,l,n=y.a,r=k.modals.a;return t.record().ui.prompt(["a[href]",r.title[0]],r.placeholder[0],1,function(e,t,a){a=P(a),i=a;var f,o,s=u.location.host;-1!==i.indexOf("://")&&(f=1),""!==s&&-1!==i.indexOf("://"+s)&&(f=0),/^([.\/?&#]|javascript:)/.test(i)&&(f=0),t.blur().ui.prompt(["a[title]",r.title[1]],r.placeholder[1],0,function(e,t,r){l=Y(r),Z(e,t).$().length||t.insert(E[""]),o=m.advance_a&&f?' rel="nofollow" target="_blank"':"",t.i().format(n+' href="'+i+'"'+(l?' title="'+l+'"':"")+o)})}),!1}},img:{i:"image",click:function(e,t){var o,u,n=t.$(),r=y.img,i=y.figure,l=y.figcaption,a=n.value,s=k.modals.img,f=m.advance_img;return t.ui.prompt(["img[src]",s.title[0]],s.placeholder[0],1,function(e,t,n){n=P(n),o=n,t.blur().ui.prompt(["img[title]",s.title[f?2:1]],s.placeholder[f?2:1],0,function(e,t,n){u=Y(n),a||(a=o.split(/[\/\\\\]/).pop()),a=Y(a),t[0](),f&&u?(t.tidy("\n\n","").insert("<"+i+">\n"+x+"<"+r+' alt="'+a+'" src="'+o+'"'+_+"\n"+x+"<"+l+">"+u+"</"+F(l)+">\n</"+F(i)+">\n\n",-1,1),I&&g.tools.p.click(e,p)):Z(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+r+' alt="'+a+'" src="'+o+'"'+(u?' title="'+u+'"':"")+_+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=y.sub,r=y.sup,i=F(r);return Z(e,t)[0]().unwrap(M("<"+i+T+">"),"</"+i+">").i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=y.sub,r=y.sup,i=F(n);return Z(e,t)[0]().unwrap(M("<"+i+T+">"),"</"+i+">").i().format(r)[1](),!1}},abbr:{i:"question",click:function(e,t){var d,h,n=t.$(),r=U(n.value),i=k.modals.abbr,l=t.get(),a=U(r||E[""]),s=y.abbr,f=F(s),o="<"+$(s)+q+">",u="<"+$(s)+T+">",c="<\\/"+f+">",p=M(o+S+c);return l.replace(p,function(e,t,n){(n=U(n))&&(v.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),d=v.abbr,r&&d[r]?(t.i().format(s+' title="'+d[r]+'"'),!1):(t.record().ui.prompt(["abbr[title]",i.title],d[a]||i.placeholder,!d[r],function(e,t,n,i){n=Y(n||i),t[0](),r||t.insert(n.replace(/[^a-z\d]/gi," ").replace(/([a-z\d])[^ ]* */gi,"$1").toUpperCase());for(h in d)if(Y(d[h])===n){t.insert(h);break}Z(e,t).unwrap(M(u),M(c)).unwrap(M(u),M(c),1).i().format(s+' title="'+n+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var n=t.$(),r=n.value,i=y.p,l=y.br,a=F(i),s=F(l),f=n.before,o=n.after,u=A(f),c=E[""];if(t[0](),r&&-1!==r.indexOf("\n")){var p=M("^(?:\\s*<"+a+T+">\\s*)+"+S+"(?:\\s*<\\/"+a+">\\s*)+$");p.test(n.value)?t.replace(p,"$1").replace(M("\\s*<\\/"+a+">\\s*<"+a+T+">\\s*","g"),"\n\n").replace(M("\\s*<"+s+T+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+l+_+"\n").replace(M("(\\s*<"+s+T+_+"\\s*){2,}","g"),"</"+a+">\n<"+i+">").wrap("<"+i+">","</"+a+">",1).replace(M("(<"+a+T+">)+","g"),"$1").replace(M("(<\\/"+a+">)+","g"),"$1").tidy("\n")}else M("^\\s*<\\/"+a+">").test(o)?M("<"+a+T+">\\s*$").test(f)?t.unwrap(M("\\s*<"+a+T+">\\s*"),M("\\s*<\\/"+a+">")).replace(c,"").tidy("\n","\n"+u):(match=f.match(M("<"+a+q+">.*?$")))&&t.wrap("</"+a+">\n"+u+"<"+a+match[1]+">","").insert(c):t.format(i,0,"\n\n");return t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),r=[y.p,y.h1,y.h2,y.h3,y.h4,y.h5,y.h6],i=[];h(r,function(e,t){i[t]=F(e)});var a=($(r).join("|"),$(i).join("|")),s="\\s*<("+a+")"+q+">\\s*",f=M("\\s*<(?:"+a+")"+T+">\\s*"),o=M("\\s*<\\/(?:"+a+")>\\s*"),u=n.value.match(M("^"+s));u||(u=n.before.match(M(s+"$"))||[]);var c=u[2]||"",p=+(u[1]||"h0").slice(1);return t[0]().unwrap(f,o).unwrap(f,o,1).i().tidy("\n\n").format(p>5?i[0]+c:i[p+1]+c,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var n=t.$(),r=n.value,i=y.blockquote,l=y.q,a=y.p,s=F(a),f="<"+s+T+">";if(M("(^|\\n|"+f+")$").test(n.before)){if(I&&(n.value===E[""]||M("("+f+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),I&&(!r||t.match(/^[^<\n]*?[^>]$/)?t.wrap(x+"<"+a+">","</"+s+">"):t[M("((^|\\n)"+x+")+").test(n.value)?"outdent":"indent"](x)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function h(e){return i?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function $(e){return i?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var n=t.$(),r=n.value,i=m.auto_encode_html,l=y.pre,a=y.code,s=F(l),f=F(a),o="<"+s+T+">\\s*<"+f+T+">\\s*",u="\\s*<\\/"+f+">\\s*<\\/"+s+">",c=M(o+"\\s*$"),p=M("^\\s*"+u),d=M("^"+S+"$");return M("(^|\\n|"+o+")$").test(n.before)?c.test(n.before)&&p.test(n.after)?t[0]().unwrap(M(c),M(p)).replace(d,$)[1]():t[0]().tidy("\n\n").wrap("<"+l+"><"+a+">","</"+f+"></"+s+">").insert(r||E[""]).replace(d,h)[1]():t[0]().format(a).loss().replace(d,function(e){return W(M("^<\\/"+f+">").test(t.$().after)?h(e):$(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=y.ol,r=y.ul,i=F(n),l=F(r),a="("+$(l)+"|"+$(i)+")";return t.match(M("<"+a+T+">"+S+"<\\/"+a+">"))?t[0]().replace(M("<"+i+q+">","g"),"<"+l+"$1>").replace(M("</"+i+">","g"),"</"+l+">")[1]():N(e,r,y.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=y.ol,r=y.ul,i=F(n),l=F(r),a="("+$(l)+"|"+$(i)+")";return t.match(M("<"+a+T+">"+S+"<\\/"+a+">"))?t[0]().replace(M("<"+l+q+">","g"),"<"+i+"$1>").replace(M("</"+l+">","g"),"</"+i+">")[1]():N(e,n,y.li),!1}},table:function(e,t){var O,R,z,D,n=v.tr,r=v.td,i=k.modals.table,l=k.placeholders.table,a=U(b(l[0],[1,1])),s=m.advance_table?x:"",f=y.table,o=y.caption,u=y.thead,c=y.tbody,p=y.tfoot,d=y.tr,h=y.th,$=y.td,g=F(f),w=F(o),_=F(u),T=F(c),q=F(p),S=F(d),E=F(h),I=F($),L=[];return t.$().value===a?(t.select(),!1):(t[0]().ui.prompt(["table>td",i.title[0]],i.placeholder[0],0,function(e,t,m,v){R=j(C(m)||v,r[0],r[1]),t.blur().ui.prompt(["table>tr",i.title[1]],i.placeholder[1],0,function(e,t,r,m){z=j(C(r)||m,n[0],n[1]),t.blur().ui.prompt(["table>caption",i.title[2]],i.placeholder[2],0,function(e,t,n){var i,m,v,y,H,r="";for(D=W(n),i=0;z>i;++i){for(O=s+x+"<"+d+">\n",m=0;R>m;++m)O+=s+x+x+"<"+$+">"+U(b(l[1],[i+1,m+1]))+"</"+I+">\n";O+=s+x+"</"+S+">",L.push(O)}for(L=L.join("\n"),O=x+(s?"<"+u+">\n"+x+x+"<"+d+">":"<"+S+">")+"\n",v=0;R>v;++v)O+=s+x+x+"<"+h+">"+U(b(l[0],[1,v+1]))+"</"+E+">\n";if(s){for(r+=x+"<"+p+">\n",r+=x+x+"<"+d+">\n",v=0;R>v;++v)r+=x+x+x+"<"+$+">"+U(b(l[2],[1,v+1]))+"</"+I+">\n";r+=x+x+"</"+d+">\n",r+=x+"</"+q+">\n"}O+=s+x+"</"+S+">"+(s?"\n"+x+"</"+_+">\n"+r+x+"<"+c+">":"")+"\n",L=O+L+(s?"\n"+x+"</"+T+">":"")+"\n",t.tidy("\n\n").insert("<"+f+">\n"+(D?x+"<"+o+">"+D+"</"+w+">\n":"")+L+"</"+g+">",0),y=t.$(),H=y.start+y.value.indexOf(a),t.select(H,H+a.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=A(t.$().before);return t.tidy("\n\n","").insert(n+"<"+y.hr+_+"\n\n",-1),!1}}}),m.keys&&d(g.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=A(t.$().before);return t.tidy("\n","").insert(n+"<"+y.br+_+"\n",-1),!1},enter:function(e,t){var c,p,n=t.$(),r=n.value,i=t.get(),l=y.p,a=y.li,s=F(l),f=F(a),u=(A(n.before),E[""]);if(!r||r===u){if(match=n.after.match(M("^\\s*<\\/("+s+"|"+f+")>")))c=match[1],g.tools["li"===c?L:c].click(e,t);else{if(!(I&&U(i)&&n.end===i.length&&/^\s*[^<\n]*?[^>]\s*$/.test(i)))return;i="<"+l+">"+i+"</"+s+">\n<"+l+">",p=u+"</"+s+">",t.set(i+p).select(i.length,(i+u).length)}return!1}},tab:function(e,t){var n=t.$(),r=y.li,i=F(r),l=A(n.before);return M("<\\/"+r+">").test(n.after)?(t[0]().wrap("\n"+l+x+"<"+(y[L]||L)+">\n"+l+x+x+"<"+r+">","</"+i+">\n"+l+x+"</"+L+">\n"+l).insert(E[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var i,n=t.$(),r=n.value,l=n.before,a=n.after,s="<[^<>]+?>";return!r&&M(s+"$").test(l)?(i=l.split("<").pop().match(/^([^\/\s]+).*?>$/),i=i&&i[1]||0,i&&M("^\\s*<\\/"+i+">").test(a)?t.unwrap(M("<"+i+T+">"),M("\\s*<\\/"+i+">")):t.outdent(M(s)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),p.update({},0)};