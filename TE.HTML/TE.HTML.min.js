/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e){return"function"==typeof e}function r(e,t){return RegExp(e,t)}function o(e){return e.replace(/^\s*|\s*$/g,"")}function i(e){return e.split(/\s+/)[0]}function l(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function a(e,t,n){var o=_.$(),a=o.value,u=o.before,c=I[t],s=I[n]||n,f=i(c),d=i(s),h=l(u);if(p=c,a)_[0]().tidy("\n\n","").replace(/\n/g,"</"+d+">\n"+C+"<"+s+">").wrap("<"+c+">\n"+C+"<"+s+">","</"+d+">\n</"+f+">\n\n",1).replace(r("\\n"+C+"<"+s+">\\s*<\\/"+d+">\\n","g"),"\n</"+f+">\n\n<"+c+">\n").select(_.$().end),N&&E.tools.p.click(e,_),_[1]();else{var g=u.match(r("<"+d+R+">.*$"));g?r("<\\/"+d+">\\s*$").test(u)?_.tidy("\n"+h,!1).wrap("<"+d+g[1]+">","</"+d+">"):/>\s*$/.test(u)?r("<\\/"+d+">\\s*$").test(u)||_.wrap("\n"+h+C+"<"+c+">\n"+h+C+C+"<"+d+g[1]+">","</"+d+">\n"+h+C+"</"+f+">\n"+h):_.insert("</"+d+">\n"+h+"<"+d+g[1]+">",-1):_.tidy("\n\n","").wrap("<"+c+">\n"+C+"<"+s+">","</"+d+">\n</"+f+">")}}function u(e,t,n){var o,l,a=(t.$(),I.align),u=i(a);n=n.split("-"),o=r("<"+L(q(a),[n[0],"(?:"+A.formats.align.join("|")+")"])+">\\s*"),l=r("\\s*<\\/"+u+">"),t[0]().unwrap(o,l).unwrap(o,l,1).format(L(a,n),0,"\n\n","\n")[1]()}function c(e,t){return!t.get(0)&&N&&E.tools.p.click(e,t),t}function s(e){return f(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function f(e){return o(e.replace(/\s+/g," "))}var p,d="\u2013",h="\u2026",g="\u2191",m="\u2193",b="\u21B5",v="\u2318",$="\u2718",k="\u21E5",y="\u21E7",w=window,_=new TE(e),x=_._.extend,T=_._.each,q=_._.x,E=_.create(x({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | a img | p | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | align-left align-center align-right align-justify | hr | undo redo",css:"html,body{background:#fff;color:#000}.align-left{text-align:left}.align-center{text-align:center}.align-right{text-align:right}.align-justify{text-align:justify}",languages:{tools:{clear:"Clear Format ("+$+")",b:"Bold ("+v+"+B)",i:"Italic ("+v+"+I)",u:"Underline ("+v+"+U)",s:"Strike ("+v+"+"+$+")",a:"Link ("+v+"+L)",img:"Image ("+v+"+G)",sub:"Subscript ("+v+"+"+m+")",sup:"Superscript ("+v+"+"+g+")",p:"Paragraph ("+v+"+"+b+")","p,h1,h2,h3,h4,h5,h6":"H1 "+d+" H6 ("+v+"+H)","blockquote,q":"Quote ("+v+"+Q)","pre,code":"Code ("+v+"+K)",ul:"Unordered List ("+v+"+-)",ol:"Ordered List ("+v+"++)",indent:"Indent ("+k+")",outdent:"Outdent ("+y+"+"+k+")","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify","align-top":"Align Top","align-middle":"Align Middle","align-bottom":"Align Bottom",hr:"Horizontal Rule ("+v+"+R)"},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+h]},img:{title:["Image URL","Image Caption"],placeholder:["http://","image caption here"+h]}}},classes:{formats:{align:["left","center","right","justify","top","middle","bottom",""]}},formats:{align:'div class="%1-%2"',b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",hr:"hr"}},t)),L=_._.format,j=_.config,O=j.languages,I=j.formats,A=j.classes,C=j.tab,M=j.suffix,H="(?:\\s[^<>]*?)?",R="(|\\s[^<>]*?)",S="([\\s\\S]*?)",U=O.others.placeholder,N=j.auto_p;return TE.HTML.__instance__.push(_),_.i=function(){return _.replace(/\s+/g," ")},x(E.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;if(r)return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after.slice(0,1)?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!1}},b:{i:"bold",click:function(e,t){return c(e,t).i().format(I.b),!1}},i:{i:"italic",click:function(e,t){return c(e,t).i().format(I.i),!1}},u:{i:"underline",click:function(e,t){return c(e,t).i().format(I.u),!1}},s:{i:"strikethrough",click:function(e,t){return c(e,t).i().format(L(I.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=I.a,i=O.modals.a;return t.record().ui.prompt(i.title[0],i.placeholder[0],1,function(e,t,l){l=f(l),n=l;var a,u,p=w.location.host;-1!==n.indexOf("://")&&(a=1),""!==p&&-1!==n.indexOf("://"+p)&&(a=0),/^([.\/?&#]|javascript:)/.test(n)&&(a=0),t.blur().ui.prompt(i.title[1],i.placeholder[1],0,function(e,t,i){r=s(i),c(e,t).$().length||t.insert(U),u=a?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+u)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),l=I.img,a=I.figure,u=I.figcaption,p=o.value,d=O.modals.img;return t.record().ui.prompt(d.title[0],d.placeholder[0],1,function(e,t,o){o=f(o),n=o,t.blur().ui.prompt(d.title[1],d.placeholder[1],0,function(e,t,o){r=s(o),p||(p=n.split(/[\/\\\\]/).pop()),p=s(p),t[0]().insert(""),r?(t.tidy("\n\n","").insert("<"+a+">\n"+C+"<"+l+' alt="'+p+'" src="'+n+'"'+M+"\n"+C+"<"+u+">"+r+"</"+i(u)+">\n</"+i(a)+">\n\n",-1),N&&E.tools.p.click(e,_)):c(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+l+' alt="'+p+'" src="'+n+'"'+M+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=I.sub,o=I.sup,l=i(o);return c(e,t)[0]().unwrap(r("<"+l+H+">"),"</"+l+">").i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=I.sub,o=I.sup,l=i(n);return c(e,t)[0]().unwrap(r("<"+l+H+">"),"</"+l+">").i().format(o)[1](),!1}},p:{i:"paragraph",click:function(e,t){var n=t.$(),o=n.value,a=I.p,u=I.br,c=i(a),s=i(u),f=n.before,p=n.after,d=l(f);if(o&&-1!==o.indexOf("\n")){var h=r("^(?:\\s*<"+c+H+">\\s*)+"+S+"(?:\\s*<\\/"+c+">\\s*)+$");h.test(n.value)?t[0]().replace(h,"$1").replace(r("\\s*<\\/"+c+">\\s*<"+c+H+">\\s*","g"),"\n\n").replace(r("\\s*<"+s+H+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+u+M+"\n").replace(r("(\\s*<"+s+H+M+"\\s*){2,}","g"),"</"+c+">\n<"+a+">").wrap("<"+a+">","</"+c+">",1).replace(r("(<"+c+H+">)+","g"),"$1").replace(r("(<\\/"+c+">)+","g"),"$1").tidy("\n")[1]()}else r("^\\s*<\\/"+c+">").test(p)?r("<"+c+H+">\\s*$").test(f)?t[0]().unwrap(r("\\s*<"+c+H+">\\s*"),r("\\s*<\\/"+c+">")).tidy("\n","\n"+d)[1]():(match=f.match(r("<"+c+R+">.*$")))&&t.wrap("</"+c+">\n"+d+"<"+c+match[1]+">",""):t[0]().format(a,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),o=[I.p,I.h1,I.h2,I.h3,I.h4,I.h5,I.h6],l=[];T(o,function(e,t){l[t]=i(e)});var a=(q(o).join("|"),q(l).join("|")),u="\\s*<("+a+")"+R+">\\s*",c=r("\\s*<(?:"+a+")"+H+">\\s*"),s=r("\\s*<\\/(?:"+a+")>\\s*"),f=n.value.match(r("^"+u));f||(f=n.before.match(r(u+"$"))||[]);var p=f[2]||"",d=+(f[1]||"h0").slice(1);return t[0]().unwrap(c,s).unwrap(c,s,1).i().format(d>5?l[0]+p:l[d+1]+p,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var n=t.$(),o=n.value,l=I.blockquote,a=I.q,u=I.p,c=i(u),s="<"+c+H+">";if(r("(^|\\n|"+s+")$").test(n.before)){if(N&&(n.value===U||r("("+s+")$").test(n.before)))return t.select(),!1;t[0]().format(l,0,"\n\n","\n"),N&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(C+"<"+u+">","</"+c+">"):t[r("((^|\\n)"+C+")+").test(n.value)?"outdent":"indent"](C)),t[1]()}else t.i().format(a);return!1}},"pre,code":{i:"code",click:function(e,t){function n(e){return u?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return u?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var l=t.$(),a=l.value,u=j.auto_encode_html,c=I.pre,s=I.code,p=i(c),d=i(s),h="<"+p+H+">\\s*<"+d+H+">\\s*",g="\\s*<\\/"+d+">\\s*<\\/"+p+">",m=r(h+"\\s*$"),b=r("^\\s*"+g),v=r("^"+S+"$");return r("(^|\\n|"+h+")$").test(l.before)?m.test(l.before)&&b.test(l.after)?t[0]().unwrap(r(m),r(b)).replace(v,o)[1]():t[0]().tidy("\n\n").wrap("<"+c+"><"+s+">","</"+d+"></"+p+">").insert(a||U).replace(v,n)[1]():t[0]().format(s).loss().replace(v,function(e){return f(r("^<\\/"+d+">").test(t.$().after)?n(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=I.ol,o=I.ul,l=i(n),u=i(o),c=u+"|"+l;return t.match(r("<"+c+H+">"+S+"<\\/"+c+">"))?t[0]().replace(r("<"+l+R+">","g"),"<"+u+"$1>").replace(r("</"+l+">","g"),"</"+u+">")[1]():a(e,o,I.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=I.ol,o=I.ul,l=i(n),u=i(o),c=u+"|"+l;return t.match(r("<"+c+H+">"+S+"<\\/"+c+">"))?t[0]().replace(r("<"+u+R+">","g"),"<"+l+"$1>").replace(r("</"+u+">","g"),"</"+l+">")[1]():a(e,n,I.li),!1}},"align-left":u,"align-center":u,"align-right":u,"align-justify":u,hr:{i:"ellipsis-h",click:function(e,t){var n=l(t.$().before);return t.tidy("\n\n","").insert(n+"<"+I.hr+M+"\n\n",-1),!1}}}),T(E.tools,function(e,t){var r=O.tools[t]||"";n(e)?E.tools[t]={title:r,click:e}:e.title||(e.title=r)}),j.keys&&x(E.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+enter":"p","shift+enter":function(e,t){var n=l(t.$().before);return t.tidy("\n","").insert(n+"<"+I.br+M+"\n",-1),!1},enter:function(e,t){{var n,a,u=t.$(),c=u.value,s=t.get(),f=I.p,d=I.li,h=i(f),g=i(d);l(u.before)}if(!c){if(match=u.after.match(r("^\\s*<\\/("+h+"|"+g+")>")))n=match[1],E.tools["li"===n?p:n].click(e,t);else{if(!(N&&o(s)&&u.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+f+">"+s+"</"+h+">\n<"+f+">",a="</"+h+">",t.set(s+a).select(s.length)}return!1}},backspace:function(e,t){var n,o=t.$(),i=o.value,l=o.before,a=o.after,u="<[^<>]+?>";return!i&&r(u+"$").test(l)?(n=l.split("<").pop().match(/^([^\/\s]+).*?>$/),n=n&&n[1]||0,n&&r("^\\s*<\\/"+n+">").test(a)?t.unwrap(r("<"+n+H+">"),r("\\s*<\\/"+n+">")):t.outdent(r(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+r":"hr"}),_.update({},0)},TE.HTML.__instance__=[];