/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e,t){return RegExp(e,t)}function r(e){return e.replace(/^\s*|\s*$/g,"")}function l(e,t,n){return t>e?t:e>n?n:e}function i(e){return e.split(/\s+/)[0]}function a(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function o(e,t,r){var l,o=_.$(),c=o.value,s=o.before,u=T[t],f=T[r]||r,h=i(u),d=i(f),g=a(s),$=D[""];return p=u,_[0](),c&&c!==$?(_.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+d+">\n"+S+"<"+f+">").wrap("<"+u+">\n"+S+"<"+f+">","</"+d+">\n</"+h+">\n\n",1).replace(n("\\n"+S+"<"+f+">\\s*<\\/"+d+">\\n","g"),"\n</"+h+">\n\n<"+u+">\n").select(_.$().end),H&&x.tools.p.click(e,_),_[1](),!1):void((l=s.match(n("(?:^|\\n)[\\t ]+<(\\/?)(?:"+i(T.ul)+"|"+i(T.ol)+")"+E+">\\s*$")))?_.insert("\n"+g+(l[1]?"":S),-1):(l=s.match(n("<"+d+M+">.*?$")))?n("<\\/"+d+">\\s*$").test(s)?_.tidy("\n"+g,!1).insert($).wrap("<"+d+l[1]+">","</"+d+">"):/>\s*$/.test(s)?_.insert($).wrap("\n"+g+S+"<"+u+">\n"+g+S+S+"<"+d+l[1]+">","</"+d+">\n"+g+S+"</"+h+">\n"+g):_.insert("</"+d+">\n"+g+"<"+d+l[1]+">",-1).insert($):n("<\\/"+d+">\\s*$").test(s)?_.insert($).wrap("\n"+g+"<"+f+">","</"+d+">"):_.tidy("\n\n").insert($).wrap("<"+u+">\n"+S+"<"+f+">","</"+d+">\n</"+h+">"))}function c(e,t){return!t.get(0)&&H&&x.tools.p.click(e,t),t}function s(e){return u(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function u(e){return r(e.replace(/\s+/g," "))}var p,f="\u2013",h="\u2026",d="\u2191",g="\u2193",$="\u21b5",b="\u2318",m="\u2718",v="\u21e7",k=window,_=new TE(e),y=_._.extend,w=_._.each,q=_._.x,x=_.ui(y({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",m],b:["Bold",b+"+B"],i:["Italic",b+"+I"],u:["Underline",b+"+U"],s:["Strike",b+"+"+m],a:["Link",b+"+L"],img:["Image",b+"+G"],sub:["Subscript",b+"+"+g],sup:["Superscript",b+"+"+d],abbr:["Abbreviation",b+"+"+v+"+?"],p:["Paragraph",b+"+"+$],"p,h1,h2,h3,h4,h5,h6":["H1 "+f+" H6",b+"+H"],"blockquote,q":["Quote",b+"+Q"],"pre,code":["Code",b+"+K"],ul:["Unordered List",b+"+-"],ol:["Ordered List",b+"++"],table:["Table",b+"+T"],hr:["Horizontal Rule",b+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+h]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+h,"image caption here"+h]},abbr:{title:"Abbreviation",placeholder:"meaning here"+h},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+h]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),O=_._.format,I=_.config,L=I.states,R=I.languages,T=I.formats,S=(I.classes,I.tab),j=I.suffix,E="(?:\\s[^<>]*?)?",M="(|\\s[^<>]*?)",U="([\\s\\S]*?)",D=R.placeholders,H=I.auto_p;return _.type="HTML",y(x.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return c(e,t).i().format(T.b),!1}},i:{i:"italic",click:function(e,t){return c(e,t).i().format(T.i),!1}},u:{i:"underline",click:function(e,t){return c(e,t).i().format(T.u),!1}},s:{i:"strikethrough",click:function(e,t){return c(e,t).i().format(O(T.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,l=T.a,i=R.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,a){a=u(a),n=a;var o,p,f=k.location.host;-1!==n.indexOf("://")&&(o=1),""!==f&&-1!==n.indexOf("://"+f)&&(o=0),/^([.\/?&#]|javascript:)/.test(n)&&(o=0),t.blur().ui.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=s(i),c(e,t).$().length||t.insert(D[""]),p=I.advance_a&&o?' rel="nofollow" target="_blank"':"",t.i().format(l+' href="'+n+'"'+(r?' title="'+r+'"':"")+p)})}),!1}},img:{i:"image",click:function(e,t){var n,r,l=t.$(),a=T.img,o=T.figure,p=T.figcaption,f=l.value,h=R.modals.img,d=I.advance_img;return t.ui.prompt(["img[src]",h.title[0]],h.placeholder[0],1,function(e,t,l){l=u(l),n=l,t.blur().ui.prompt(["img[title]",h.title[d?2:1]],h.placeholder[d?2:1],0,function(e,t,l){r=s(l),f||(f=n.split(/[\/\\\\]/).pop()),f=s(f),t[0](),d&&r?(t.tidy("\n\n","").insert("<"+o+">\n"+S+"<"+a+' alt="'+f+'" src="'+n+'"'+j+"\n"+S+"<"+p+">"+r+"</"+i(p)+">\n</"+i(o)+">\n\n",-1,1),H&&x.tools.p.click(e,_)):c(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+a+' alt="'+f+'" src="'+n+'"'+(r?' title="'+r+'"':"")+j+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=T.sub,l=T.sup,a=i(l);return c(e,t)[0]().unwrap(n("<"+a+E+">"),"</"+a+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=T.sub,l=T.sup,a=i(r);return c(e,t)[0]().unwrap(n("<"+a+E+">"),"</"+a+">").i().format(l)[1](),!1}},abbr:{i:"question",click:function(e,t){var l,a,o=t.$(),s=r(o.value),u=R.modals.abbr,p=t.get(),f=r(s||D[""]),h=T.abbr,d=i(h),g="<"+q(h)+M+">",$="<"+q(h)+E+">",b="<\\/"+d+">",m=n(g+U+b);return p.replace(m,function(e,t,n){(n=r(n))&&(L.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),l=L.abbr,s&&l[s]?(t.i().format(h+' title="'+l[s]+'"'),!1):(t.record().ui.prompt(["abbr[title]",u.title],l[f]||u.placeholder,!l[s],function(e,t,i,o){i=r(i||o),t[0]();for(a in l)if(l[a]===i){t.insert(a);break}c(e,t).unwrap(n($),n(b)).unwrap(n($),n(b),1).i().format(h+' title="'+i+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r,l=t.$(),o=l.value,c=T.p,s=T.br,u=i(c),p=i(s),f=l.before,h=l.after,d=a(f),g=D[""];return t[0](),o&&-1!==o.indexOf("\n")?(r=n("^(?:\\s*<"+u+E+">\\s*)+"+U+"(?:\\s*<\\/"+u+">\\s*)+$"),r.test(l.value)?t.replace(r,"$1").replace(n("\\s*<\\/"+u+">\\s*<"+u+E+">\\s*","g"),"\n\n").replace(n("\\s*<"+p+E+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+s+j+"\n").replace(n("(\\s*<"+p+E+j+"\\s*){2,}","g"),"</"+u+">\n<"+c+">").wrap("<"+c+">","</"+u+">",1).replace(n("(<"+u+E+">)+","g"),"$1").replace(n("(<\\/"+u+">)+","g"),"$1").tidy("\n")):n("^\\s*<\\/"+u+">").test(h)?n("<"+u+E+">\\s*$").test(f)?t.unwrap(n("\\s*<"+u+E+">\\s*"),n("\\s*<\\/"+u+">")).replace(g,"").tidy("\n","\n"+d):(match=f.match(n("<"+u+M+">.*?$")))&&t.wrap("</"+u+">\n"+d+"<"+u+match[1]+">","").insert(g):t.format(c,0,"\n\n"),t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r,l,a,o,c,s,u,p,f=t.$(),h=[T.p,T.h1,T.h2,T.h3,T.h4,T.h5,T.h6],d=[];return w(h,function(e,t){d[t]=i(e)}),r=q(h).join("|"),l=q(d).join("|"),a="\\s*<("+l+")"+M+">\\s*",o=n("\\s*<(?:"+l+")"+E+">\\s*"),c=n("\\s*<\\/(?:"+l+")>\\s*"),s=f.value.match(n("^"+a)),s||(s=f.before.match(n(a+"$"))||[]),u=s[2]||"",p=+(s[1]||"h0").slice(1),t[0]().unwrap(o,c).unwrap(o,c,1).i().tidy("\n\n").format(p>5?d[0]+u:d[p+1]+u,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var r=t.$(),l=r.value,a=T.blockquote,o=T.q,c=T.p,s=i(c),u="<"+s+E+">";if(n("(^|\\n|"+u+")$").test(r.before)){if(H&&(r.value===D[""]||n("("+u+")$").test(r.before)))return t.select(),!1;t[0]().format(a,0,"\n\n","\n"),H&&(!l||t.match(/^[^<\n]*?[^>]$/)?t.wrap(S+"<"+c+">","</"+s+">"):t[n("((^|\\n)"+S+")+").test(r.value)?"outdent":"indent"](S)),t[1]()}else t.i().format(o);return!1}},"pre,code":{i:"code",click:function(e,t){function r(e){return c?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function l(e){return c?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var a=t.$(),o=a.value,c=I.auto_encode_html,s=T.pre,p=T.code,f=i(s),h=i(p),d="<"+f+E+">\\s*<"+h+E+">\\s*",g="\\s*<\\/"+h+">\\s*<\\/"+f+">",$=n(d+"\\s*$"),b=n("^\\s*"+g),m=n("^"+U+"$");return n("(^|\\n|"+d+")$").test(a.before)?$.test(a.before)&&b.test(a.after)?t[0]().unwrap(n($),n(b)).replace(m,l)[1]():t[0]().tidy("\n\n").wrap("<"+s+"><"+p+">","</"+h+"></"+f+">").insert(o||D[""]).replace(m,r)[1]():t[0]().format(p).loss().replace(m,function(e){return u(n("^<\\/"+h+">").test(t.$().after)?r(e):l(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=T.ol,l=T.ul,a=i(r),c=i(l),s="("+q(c)+"|"+q(a)+")";return t.match(n("<"+s+E+">"+U+"<\\/"+s+">"))?t[0]().replace(n("<"+a+M+">","g"),"<"+c+"$1>").replace(n("</"+a+">","g"),"</"+c+">")[1]():o(e,l,T.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=T.ol,l=T.ul,a=i(r),c=i(l),s="("+q(c)+"|"+q(a)+")";return t.match(n("<"+s+E+">"+U+"<\\/"+s+">"))?t[0]().replace(n("<"+c+M+">","g"),"<"+a+"$1>").replace(n("</"+c+">","g"),"</"+a+">")[1]():o(e,r,T.li),!1}},table:function(e,t){var n,a,o,c,s=L.tr,p=L.td,f=R.modals.table,h=R.placeholders.table,d=r(O(h[0],[1,1])),g=I.advance_table?S:"",$=T.table,b=T.caption,m=T.thead,v=T.tbody,k=T.tfoot,_=T.tr,y=T.th,w=T.td,q=i($),x=i(b),j=i(m),E=i(v),M=i(k),U=i(_),D=i(y),H=i(w),F=[];return t.$().value===d?(t.select(),!1):(t[0]().ui.prompt(["table>td",f.title[0]],f.placeholder[0],0,function(e,t,i,I){a=l(parseInt(i,10)||I,p[0],p[1]),t.blur().ui.prompt(["table>tr",f.title[1]],f.placeholder[1],0,function(e,t,i,p){o=l(parseInt(i,10)||p,s[0],s[1]),t.blur().ui.prompt(["table>caption",f.title[2]],f.placeholder[2],0,function(e,t,l){var i,s,p,f,I,L="";for(c=u(l),i=0;o>i;++i){for(n=g+S+"<"+_+">\n",s=0;a>s;++s)n+=g+S+S+"<"+w+">"+r(O(h[1],[i+1,s+1]))+"</"+H+">\n";n+=g+S+"</"+U+">",F.push(n)}for(F=F.join("\n"),n=S+(g?"<"+m+">\n"+S+S+"<"+_+">":"<"+U+">")+"\n",p=0;a>p;++p)n+=g+S+S+"<"+y+">"+r(O(h[0],[1,p+1]))+"</"+D+">\n";if(g){for(L+=S+"<"+k+">\n",L+=S+S+"<"+_+">\n",p=0;a>p;++p)L+=S+S+S+"<"+w+">"+r(O(h[2],[1,p+1]))+"</"+H+">\n";L+=S+S+"</"+_+">\n",L+=S+"</"+M+">\n"}n+=g+S+"</"+U+">"+(g?"\n"+S+"</"+j+">\n"+L+S+"<"+v+">":"")+"\n",F=n+F+(g?"\n"+S+"</"+E+">":"")+"\n",t.tidy("\n\n").insert("<"+$+">\n"+(c?S+"<"+b+">"+c+"</"+x+">\n":"")+F+"</"+q+">",0),f=t.$(),I=f.start+f.value.indexOf(d),t.select(I,I+d.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=a(t.$().before);return t.tidy("\n\n","").insert(n+"<"+T.hr+j+"\n\n",-1),!1}}}),I.keys&&y(x.keys,{delete:"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=a(t.$().before);return t.tidy("\n","").insert(n+"<"+T.br+j+"\n",-1),!1},enter:function(e,t){var l,o,c=t.$(),s=c.value,u=t.get(),f=T.p,h=T.li,d=i(f),g=i(h),$=(a(c.before),D[""]);if(!s||s===$){if(match=c.after.match(n("^\\s*<\\/("+d+"|"+g+")>")))l=match[1],x.tools["li"===l?p:l].click(e,t);else{if(!(H&&r(u)&&c.end===u.length&&/^\s*[^<\n]*?[^>]\s*$/.test(u)))return;u="<"+f+">"+u+"</"+d+">\n<"+f+">",o=$+"</"+d+">",t.set(u+o).select(u.length,(u+$).length)}return!1}},tab:function(e,t){var r=t.$(),l=T.li,o=i(l),c=a(r.before);return n("<\\/"+l+">").test(r.after)?(t[0]().wrap("\n"+c+S+"<"+(T[p]||p)+">\n"+c+S+S+"<"+l+">","</"+o+">\n"+c+S+"</"+p+">\n"+c).insert(D[""])[1](),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var r,l=t.$(),i=l.value,a=l.before,o=l.after,c="<[^<>]+?>";return!i&&n(c+"$").test(a)?(r=a.split("<").pop().match(/^([^\/\s]+).*?>$/),r=r&&r[1]||0,r&&n("^\\s*<\\/"+r+">").test(o)?t.unwrap(n("<"+r+E+">"),n("\\s*<\\/"+r+">")):t.outdent(n(c)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),_.update({},0)};