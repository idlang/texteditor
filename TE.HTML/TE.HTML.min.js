/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e,t){return RegExp(e,t)}function r(e){return e.replace(/^\s*|\s*$/g,"")}function o(e,t,n){return t>e?t:e>n?n:e}function i(e){return e.split(/\s+/)[0]}function a(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function l(e,t,r){var o,l=k.$(),c=l.value,u=l.before,s=S[t],p=S[r]||r,d=i(s),h=i(p),g=a(u),b=j[""];return f=s,k[0](),c&&c!==b?(k.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+h+">\n"+O+"<"+p+">").wrap("<"+s+">\n"+O+"<"+p+">","</"+h+">\n</"+d+">\n\n",1).replace(n("\\n"+O+"<"+p+">\\s*<\\/"+h+">\\n","g"),"\n</"+d+">\n\n<"+s+">\n").select(k.$().end),R&&T.tools.p.click(e,k),k[1](),!1):void((o=u.match(n("(?:^|\\n)[\\t ]+<(\\/?)(?:"+i(S.ul)+"|"+i(S.ol)+")"+z+">\\s*$")))?k.insert("\n"+g+(o[1]?"":O),-1):(o=u.match(n("<"+h+H+">.*?$")))?n("<\\/"+h+">\\s*$").test(u)?k.tidy("\n"+g,!1).insert(b).wrap("<"+h+o[1]+">","</"+h+">"):/>\s*$/.test(u)?k.insert(b).wrap("\n"+g+O+"<"+s+">\n"+g+O+O+"<"+h+o[1]+">","</"+h+">\n"+g+O+"</"+d+">\n"+g):k.insert("</"+h+">\n"+g+"<"+h+o[1]+">",-1).insert(b):n("<\\/"+h+">\\s*$").test(u)?k.insert(b).wrap("\n"+g+"<"+p+">","</"+h+">"):k.tidy("\n\n","").insert(b).wrap("<"+s+">\n"+O+"<"+p+">","</"+h+">\n</"+d+">"))}function c(e,t){return!t.get(0)&&R&&T.tools.p.click(e,t),t}function u(e){return s(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function s(e){return r(e.replace(/\s+/g," "))}var f,p="\u2013",d="\u2026",h="\u2191",g="\u2193",b="\u21b5",m="\u2318",v="\u2718",$="\u21e7",y=window,k=new TE(e),w=k._.extend,x=k._.each,_=k._.x,T=k.create(w({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",v],b:["Bold",m+"+B"],i:["Italic",m+"+I"],u:["Underline",m+"+U"],s:["Strike",m+"+"+v],a:["Link",m+"+L"],img:["Image",m+"+G"],sub:["Subscript",m+"+"+g],sup:["Superscript",m+"+"+h],abbr:["Abbreviation",m+"+"+$+"+?"],p:["Paragraph",m+"+"+b],"p,h1,h2,h3,h4,h5,h6":["H1 "+p+" H6",m+"+H"],"blockquote,q":["Quote",m+"+Q"],"pre,code":["Code",m+"+K"],ul:["Unordered List",m+"+-"],ol:["Ordered List",m+"++"],table:["Table",m+"+T"],hr:["Horizontal Rule",m+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+d]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+d,"image caption here"+d]},abbr:{title:"Abbreviation",placeholder:"meaning here"+d},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+d]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),E=k._.format,C=k.config,q=C.states,L=C.languages,S=C.formats,O=(C.classes,C.tab),I=C.suffix,z="(?:\\s[^<>]*?)?",H="(|\\s[^<>]*?)",M="([\\s\\S]*?)",j=L.placeholders,R=C.auto_p;return k.type="HTML",k.i=function(){return k.replace(/\s+/g," ")},w(T.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return c(e,t).i().format(S.b),!1}},i:{i:"italic",click:function(e,t){return c(e,t).i().format(S.i),!1}},u:{i:"underline",click:function(e,t){return c(e,t).i().format(S.u),!1}},s:{i:"strikethrough",click:function(e,t){return c(e,t).i().format(E(S.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=S.a,i=L.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,a){a=s(a),n=a;var l,f,p=y.location.host;-1!==n.indexOf("://")&&(l=1),""!==p&&-1!==n.indexOf("://"+p)&&(l=0),/^([.\/?&#]|javascript:)/.test(n)&&(l=0),t.blur().ui.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=u(i),c(e,t).$().length||t.insert(j[""]),f=C.advance_a&&l?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+f)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),a=S.img,l=S.figure,f=S.figcaption,p=o.value,d=L.modals.img,h=C.advance_img;return t.ui.prompt(["img[src]",d.title[0]],d.placeholder[0],1,function(e,t,o){o=s(o),n=o,t.blur().ui.prompt(["img[title]",d.title[h?2:1]],d.placeholder[h?2:1],0,function(e,t,o){r=u(o),p||(p=n.split(/[\/\\\\]/).pop()),p=u(p),t[0](),h&&r?(t.tidy("\n\n","").insert("<"+l+">\n"+O+"<"+a+' alt="'+p+'" src="'+n+'"'+I+"\n"+O+"<"+f+">"+r+"</"+i(f)+">\n</"+i(l)+">\n\n",-1,1),R&&T.tools.p.click(e,k)):c(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+a+' alt="'+p+'" src="'+n+'"'+(r?' title="'+r+'"':"")+I+" ",-1,1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=S.sub,o=S.sup,a=i(o);return c(e,t)[0]().unwrap(n("<"+a+z+">"),"</"+a+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=S.sub,o=S.sup,a=i(r);return c(e,t)[0]().unwrap(n("<"+a+z+">"),"</"+a+">").i().format(o)[1](),!1}},abbr:{i:"question",click:function(e,t){var o,a,l=t.$(),u=r(l.value),s=L.modals.abbr,f=t.get(),p=r(u||j[""]),d=S.abbr,h=i(d),g="<"+_(d)+H+">",b="<"+_(d)+z+">",m="<\\/"+h+">",v=n(g+M+m);return f.replace(v,function(e,t,n){(n=r(n))&&(q.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),o=q.abbr,u&&o[u]?(t.i().format(d+' title="'+o[u]+'"'),!1):(t.record().ui.prompt(["abbr[title]",s.title],o[p]||s.placeholder,!o[u],function(e,t,i,l){i=r(i||l),t[0]();for(a in o)if(o[a]===i){t.insert(a);break}c(e,t).unwrap(n(b),n(m)).unwrap(n(b),n(m),1).i().format(d+' title="'+i+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r,o=t.$(),l=o.value,c=S.p,u=S.br,s=i(c),f=i(u),p=o.before,d=o.after,h=a(p),g=j[""];return t[0](),l&&-1!==l.indexOf("\n")?(r=n("^(?:\\s*<"+s+z+">\\s*)+"+M+"(?:\\s*<\\/"+s+">\\s*)+$"),r.test(o.value)?t.replace(r,"$1").replace(n("\\s*<\\/"+s+">\\s*<"+s+z+">\\s*","g"),"\n\n").replace(n("\\s*<"+f+z+">\\s*","g"),"\n"):t.replace(/\n/g,"\n<"+u+I+"\n").replace(n("(\\s*<"+f+z+I+"\\s*){2,}","g"),"</"+s+">\n<"+c+">").wrap("<"+c+">","</"+s+">",1).replace(n("(<"+s+z+">)+","g"),"$1").replace(n("(<\\/"+s+">)+","g"),"$1").tidy("\n")):n("^\\s*<\\/"+s+">").test(d)?n("<"+s+z+">\\s*$").test(p)?t.unwrap(n("\\s*<"+s+z+">\\s*"),n("\\s*<\\/"+s+">")).replace(g,"").tidy("\n","\n"+h):(match=p.match(n("<"+s+H+">.*?$")))&&t.wrap("</"+s+">\n"+h+"<"+s+match[1]+">","").insert(g):t.format(c,0,"\n\n"),t[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r,o,a,l,c,u,s,f,p=t.$(),d=[S.p,S.h1,S.h2,S.h3,S.h4,S.h5,S.h6],h=[];return x(d,function(e,t){h[t]=i(e)}),r=_(d).join("|"),o=_(h).join("|"),a="\\s*<("+o+")"+H+">\\s*",l=n("\\s*<(?:"+o+")"+z+">\\s*"),c=n("\\s*<\\/(?:"+o+")>\\s*"),u=p.value.match(n("^"+a)),u||(u=p.before.match(n(a+"$"))||[]),s=u[2]||"",f=+(u[1]||"h0").slice(1),t[0]().unwrap(l,c).unwrap(l,c,1).i().tidy("\n\n").format(f>5?h[0]+s:h[f+1]+s,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var r=t.$(),o=r.value,a=S.blockquote,l=S.q,c=S.p,u=i(c),s="<"+u+z+">";if(n("(^|\\n|"+s+")$").test(r.before)){if(R&&(r.value===j[""]||n("("+s+")$").test(r.before)))return t.select(),!1;t[0]().format(a,0,"\n\n","\n"),R&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(O+"<"+c+">","</"+u+">"):t[n("((^|\\n)"+O+")+").test(r.value)?"outdent":"indent"](O)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function r(e){return c?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return c?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var a=t.$(),l=a.value,c=C.auto_encode_html,u=S.pre,f=S.code,p=i(u),d=i(f),h="<"+p+z+">\\s*<"+d+z+">\\s*",g="\\s*<\\/"+d+">\\s*<\\/"+p+">",b=n(h+"\\s*$"),m=n("^\\s*"+g),v=n("^"+M+"$");return n("(^|\\n|"+h+")$").test(a.before)?b.test(a.before)&&m.test(a.after)?t[0]().unwrap(n(b),n(m)).replace(v,o)[1]():t[0]().tidy("\n\n").wrap("<"+u+"><"+f+">","</"+d+"></"+p+">").insert(l||j[""]).replace(v,r)[1]():t[0]().format(f).loss().replace(v,function(e){return s(n("^<\\/"+d+">").test(t.$().after)?r(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=S.ol,o=S.ul,a=i(r),c=i(o),u="("+_(c)+"|"+_(a)+")";return t.match(n("<"+u+z+">"+M+"<\\/"+u+">"))?t[0]().replace(n("<"+a+H+">","g"),"<"+c+"$1>").replace(n("</"+a+">","g"),"</"+c+">")[1]():l(e,o,S.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=S.ol,o=S.ul,a=i(r),c=i(o),u="("+_(c)+"|"+_(a)+")";return t.match(n("<"+u+z+">"+M+"<\\/"+u+">"))?t[0]().replace(n("<"+c+H+">","g"),"<"+a+"$1>").replace(n("</"+c+">","g"),"</"+a+">")[1]():l(e,r,S.li),!1}},table:function(e,t){var n,a,l,c,u=q.tr,f=q.td,p=L.modals.table,d=L.placeholders.table,h=r(E(d[0],[1,1])),g=C.advance_table?O:"",b=S.table,m=S.caption,v=S.thead,$=S.tbody,y=S.tfoot,k=S.tr,w=S.th,x=S.td,_=i(b),T=i(m),I=i(v),z=i($),H=i(y),M=i(k),j=i(w),R=i(x),N=[];return t.$().value===h?(t.select(),!1):(t[0]().ui.prompt(["table>td",p.title[0]],p.placeholder[0],0,function(e,t,i,C){a=o(parseInt(i,10)||C,f[0],f[1]),t.blur().ui.prompt(["table>tr",p.title[1]],p.placeholder[1],0,function(e,t,i,f){l=o(parseInt(i,10)||f,u[0],u[1]),t.blur().ui.prompt(["table>caption",p.title[2]],p.placeholder[2],0,function(e,t,o){var i,u,f,p,C,q="";for(c=s(o),i=0;l>i;++i){for(n=g+O+"<"+k+">\n",u=0;a>u;++u)n+=g+O+O+"<"+x+">"+r(E(d[1],[i+1,u+1]))+"</"+R+">\n";n+=g+O+"</"+M+">",N.push(n)}for(N=N.join("\n"),n=O+(g?"<"+v+">\n"+O+O+"<"+k+">":"<"+M+">")+"\n",f=0;a>f;++f)n+=g+O+O+"<"+w+">"+r(E(d[0],[1,f+1]))+"</"+j+">\n";if(g){for(q+=O+"<"+y+">\n",f=0;a>f;++f)q+=O+O+"<"+x+">"+r(E(d[2],[1,f+1]))+"</"+R+">\n";q+=O+"</"+H+">\n"}n+=g+O+"</"+M+">"+(g?"\n"+O+"</"+I+">\n"+q+O+"<"+$+">":"")+"\n",N=n+N+(g?"\n"+O+"</"+z+">":"")+"\n",t.tidy("\n\n").insert("<"+b+">\n"+(c?O+"<"+m+">"+c+"</"+T+">\n":"")+N+"</"+_+">",0),p=t.$(),C=p.start+p.value.indexOf(h),t.select(C,C+h.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=a(t.$().before);return t.tidy("\n\n","").insert(n+"<"+S.hr+I+"\n\n",-1),!1}}}),C.keys&&w(T.keys,{delete:"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=a(t.$().before);return t.tidy("\n","").insert(n+"<"+S.br+I+"\n",-1),!1},enter:function(e,t){var o,l,c=t.$(),u=c.value,s=t.get(),p=S.p,d=S.li,h=i(p),g=i(d),b=(a(c.before),j[""]);if(!u||u===b){if(match=c.after.match(n("^\\s*<\\/("+h+"|"+g+")>")))o=match[1],T.tools["li"===o?f:o].click(e,t);else{if(!(R&&r(s)&&c.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+p+">"+s+"</"+h+">\n<"+p+">",l=b+"</"+h+">",t.set(s+l).select(s.length,(s+b).length)}return!1}},tab:function(e,t){var r=t.$(),o=S.li,l=i(o),c=a(r.before);return n("<\\/"+o+">").test(r.after)?(t.wrap("\n"+c+O+"<"+(S[f]||f)+">\n"+c+O+O+"<"+o+">","</"+l+">\n"+c+O+"</"+f+">\n"+c),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var r,o=t.$(),i=o.value,a=o.before,l=o.after,c="<[^<>]+?>";return!i&&n(c+"$").test(a)?(r=a.split("<").pop().match(/^([^\/\s]+).*?>$/),r=r&&r[1]||0,r&&n("^\\s*<\\/"+r+">").test(l)?t.unwrap(n("<"+r+z+">"),n("\\s*<\\/"+r+">")):t.outdent(n(c)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),k.update({},0)};