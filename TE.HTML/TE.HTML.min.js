/*!
 * ==========================================================
 *  HTML EDITOR PLUGIN 0.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e){return"function"==typeof e}function r(e,t){return RegExp(e,t)}function l(e){return e.replace(/^\s*|\s*$/g,"")}function i(e){return e.split(/\s+/)[0]}function o(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function a(e,t){var n=k.$(),l=n.before,a=L[e],c=L[t]||t,u=i(a),p=i(c),g=o(l);if(s=a,n.length)k[0]().gap("\n\n","").replace(/\n/g,"</"+p+">\n"+R+"<"+c+">").wrap("<"+a+">\n"+R+"<"+c+">","</"+p+">\n</"+u+">\n\n",1).replace(r("\\n"+R+"<"+c+">\\s*<\\/"+p+">\\n","g"),"\n</"+u+">\n\n<"+a+">\n").select(k.$().end)[1]();else{var f=l.match(r("<"+p+S+">.*$"));f?/>\s*$/.test(l)?r("<\\/"+p+">\\s*$").test(l)||k.wrap("\n"+g+R+"<"+a+">\n"+g+R+R+"<"+p+f[1]+">","</"+p+">\n"+g+R+"</"+u+">\n"+g):k.insert("</"+p+">\n"+g+"<"+p+f[1]+">",-1):k.gap("\n\n","").wrap("<"+a+">\n"+R+"<"+c+">","</"+p+">\n</"+u+">")}return k}function c(e,t,n){var l,i,o=(t.$(),A.formats),a=[];w(o,function(e){"align-"===e.slice(0,6)&&a.push(e)}),l=r('<div class="(?:'+a.join("|")+')">\\s*'),i=r("\\s*<\\/div>"),t[0]().unwrap(l,i).unwrap(l,i,1).format('div class="'+n+'"',0,"\n\n","\n")[1]()}function u(e,t){return t.get(0)||_.tools.p.click(e,t),t}var s,p="\u2013",g="\u2026",f="\u2191",h="\u2193",m="\u21B5",d="\u2318",b="\u2718",v=window,k=new TE(e),$=k._.extend,w=k._.each,q=k._.x,_=k.create($({suffix:">",auto_encode_html:1,tools:"clear | b i u s | sub sup | a img | p | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | align-left align-center align-right align-justify | hr | undo redo",languages:{tools:{clear:"Clear Format ("+b+")",b:"Bold ("+d+"+B)",i:"Italic ("+d+"+I)",u:"Underline ("+d+"+U)",s:"Strike ("+d+"+"+b+")",a:"Link ("+d+"+L)",img:"Image ("+d+"+G)",sub:"Subscript ("+d+"+"+h+")",sup:"Subscript ("+d+"+"+f+")",p:"Paragraph ("+d+"+"+m+")","p,h1,h2,h3,h4,h5,h6":"H1 "+p+" H6 ("+d+"+H)","blockquote,q":"Quote ("+d+"+Q)","pre,code":"Code ("+d+"+K)",ul:"Unordered List ("+d+"+-)",li:"Ordered List ("+d+"++)","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify","align-top":"Align Top","align-middle":"Align Middle","align-bottom":"Align Bottom",hr:"Horizontal Rule ("+d+"+R)"},modals:{a:{title:["URL","Title"],placeholder:["http://","link title here"+g]},img:{title:["Source URL","Caption"],placeholder:["http://","image caption here"+g]}}},classes:{formats:{left:"align-left",center:"align-center",right:"align-right",justify:"align-justify",top:"align-top",middle:"align-middle",bottom:"align-bottom"}},formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',hr:"hr"}},t)),j=k._.format,x=k.config,y=x.languages,L=x.formats,A=x.classes,R=x.tab,H=x.suffix,O="(?:\\s[^<>]*?)?",S="(|\\s[^<>]*?)",T="([\\s\\S]*?)",U=y.others.placeholder;return $(_.tools,{clear:{i:"eraser",click:function(e,t){var n=t.$().value;if(n.length)return t[0]().replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/),t.$().value===n&&t.insert(""),t[1](),!1}},b:{i:"bold",click:function(e,t){return u(e,t).format(L.b),!1}},i:{i:"italic",click:function(e,t){return u(e,t).format(L.i),!1}},u:{i:"underline",click:function(e,t){return u(e,t).format(L.u),!1}},s:{i:"strikethrough",click:function(e,t){return u(e,t).format(j(L.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,l=L.a,i=y.modals.a;return t.record().ui.prompt(i.title[0],i.placeholder[0],1,function(e,t,o){n=o;var a,c,s=v.location.host;-1!==n.indexOf("://")&&(a=1),""!==s&&-1!==n.indexOf("://"+s)&&(a=0),/^([.\/?&#]|javascript:)/.test(n)&&(a=0),t.blur().ui.prompt(i.title[1],i.placeholder[1],0,function(e,t,i){r=i.replace(/"/g,"&quot;").replace(/'/g,"&apos;"),u(e,t).$().length||t.insert(U),c=a?' rel="nofollow" target="_blank"':"",t.format(l+' href="'+n+'"'+(r?' title="'+r+'"':"")+c)})}),!1}},img:{i:"image",click:function(e,t){var n,r,l=t.$(),o=L.img,a=L.figure,c=L.figcaption,s=l.value.replace(/<.*?>/g,""),p=y.modals.img;return t.record().ui.prompt(p.title[0],p.placeholder[0],1,function(e,t,g){n=g,t.blur().ui.prompt(p.title[1],p.placeholder[1],0,function(e,t,p){r=p,s.length||(s=n.split(/[\/\\\\]/).pop()),t[0]().insert(""),r?t.gap("\n\n","").insert("<"+a+">\n"+R+"<"+o+' alt="'+s+'" src="'+n+'"'+H+"\n"+R+"<"+c+">"+r+"</"+i(c)+">\n</"+i(a)+">\n\n",-1):u(e,t).gap(/<[^\/<>]+?>\s*$/.test(l.before)?"":" ","").insert("<"+o+' alt="'+s+'" src="'+n+'"'+H+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=L.sub,l=L.sup,o=i(l);return u(e,t)[0]().unwrap(r("<"+o+O+">"),"</"+o+">").format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=L.sub,l=L.sup,o=i(n);return u(e,t)[0]().unwrap(r("<"+o+O+">"),"</"+o+">").format(l)[1](),!1}},p:{i:"paragraph",click:function(e,t){var n=t.$(),l=L.p,a=L.br,c=i(l),u=i(a),s=n.before,p=n.after,g=o(s);if(n.length&&-1!==n.value.indexOf("\n")){var f=r("^(?:\\s*<"+c+O+">\\s*)+"+T+"(?:\\s*<\\/"+c+">\\s*)+$");f.test(n.value)?t[0]().replace(f,"$1").replace(r("\\s*<\\/"+c+">\\s*<"+c+O+">\\s*","g"),"\n\n").replace(r("\\s*<"+u+O+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+a+H+"\n").replace(r("(\\s*<"+u+O+H+"\\s*){2,}","g"),"</"+c+">\n<"+l+">").wrap("<"+l+">","</"+c+">",1).replace(r("(<"+c+O+">)+","g"),"$1").replace(r("(<\\/"+c+">)+","g"),"$1").gap("\n")[1]()}else r("^\\s*<\\/"+c+">").test(p)?r("<"+c+O+">\\s*$").test(s)?t[0]().unwrap(r("\\s*<"+c+O+">\\s*"),r("\\s*<\\/"+c+">")).gap("\n")[1]():(match=s.match(r("<"+c+S+">.*$")))&&t.wrap("</"+c+">\n"+g+"<"+c+match[1]+">",""):t[0]().format(l,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),l=[L.p,L.h1,L.h2,L.h3,L.h4,L.h5,L.h6],o=[];w(l,function(e,t){o[t]=i(e)});var a=q(l).join("|"),c=q(o).join("|"),u="\\s*<("+a+")"+S+">\\s*",s=r("\\s*<(?:"+a+")"+O+">\\s*"),p=r("\\s*<\\/(?:"+c+")>\\s*"),g=n.value.match(r("^"+u));g||(g=n.before.match(r(u+"$"))||[]);var f=g[2]||"",h=+(g[1]||"h0").slice(1);return t[0]().replace(/\s+/g," ").unwrap(s,p).unwrap(s,p,1).format(h>5?o[0]+f:o[h+1]+f,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){{var n=t.$(),r=L.blockquote,l=L.q;L.p}return/(^|\n)$/.test(n.before)?t.format(r,0,"\n\n","\n"):t.format(l),!1}},"pre,code":{i:"code",click:function(e,t){function n(e){return a?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function l(e){return a?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var o=t.$(),a=x.auto_encode_html,c=L.pre,u=L.code,s=i(c),p=i(u),g="<"+s+O+">\\s*<"+p+O+">\\s*",f="\\s*<\\/"+p+">\\s*<\\/"+s+">",h=r(g+"\\s*$"),m=r("^\\s*"+f),d=r("^"+T+"$");return r("(^|\\n|"+g+")$").test(o.before)?h.test(o.before)&&m.test(o.after)?t[0]().unwrap(r(h),r(m)).replace(d,l)[1]():t[0]().gap("\n\n").wrap("<"+c+"><"+u+">","</"+p+"></"+s+">").insert(o.length?o.value:U).replace(d,n)[1]():t.format(u),!1}},ul:{i:"list-ul",click:function(e,t){var n=L.ol,l=L.ul,o=i(n),c=i(l),u=c+"|"+o;return t.match(r("<"+u+O+">"+T+"<\\/"+u+">"))?t[0]().replace(r("<"+o+S+">","g"),"<"+c+"$1>").replace(r("</"+o+">","g"),"</"+c+">")[1]():a(l,L.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=L.ol,l=L.ul,o=i(n),c=i(l),u=c+"|"+o;return t.match(r("<"+u+O+">"+T+"<\\/"+u+">"))?t[0]().replace(r("<"+c+S+">","g"),"<"+o+"$1>").replace(r("</"+c+">","g"),"</"+o+">")[1]():a(n,L.li),!1}},"align-left":c,"align-center":c,"align-right":c,"align-justify":c,hr:{i:"ellipsis-h",click:function(e,t){var n=o(t.$().before);return t.gap("\n\n","").insert(n+"<"+L.hr+H+"\n\n",-1),!1}}}),w(_.tools,function(e,t){var r=y.tools[t]||"";n(e)?_.tools[t]={title:r,click:e}:e.title||(e.title=r)}),$(_.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+enter":"p","shift+enter":function(e,t){var n=o(t.$().before);return t.gap("\n","").insert(n+"<"+L.br+H+"\n",-1),!1},enter:function(e,t){var n,a,c=t.$(),u=t.get(),p=L.p,g=L.li,f=i(p),h=i(g),m=o(c.before);if(!c.length){if(match=c.after.match(r("^\\s*<\\/("+f+"|"+h+")>")))n=match[1],_.tools["li"===n?s:n].click(e,t);else if(l(u).length&&c.end===u.length&&!r("^\\s*<[^\\/<>]+?>"+T+"<\\/[^<>]+?>\\s*$").test(u)&&-1===u.indexOf("\n"))u="<"+p+">"+u+"</"+f+">\n<"+p+">",a="</"+f+">",t.set(u+a).select(u.length);else{if(!m.length)return;t.insert("\n"+m,-1).scroll("+")}return!1}},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+r":"hr"}),k.update()};