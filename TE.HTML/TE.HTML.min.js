/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function r(e,t){return RegExp(e,t)}function n(e){return e.replace(/^\s*|\s*$/g,"")}function o(e,t,r){return t>e?t:e>r?r:e}function a(e){return e.split(/\s+/)[0]}function i(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function l(e,t,n){var o=y.$(),l=o.value,c=o.before,s=L[t],u=L[n]||n,p=a(s),h=a(u),d=i(c);if(f=s,l)y[0]().tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+h+">\n"+O+"<"+u+">").wrap("<"+s+">\n"+O+"<"+u+">","</"+h+">\n</"+p+">\n\n",1).replace(r("\\n"+O+"<"+u+">\\s*<\\/"+h+">\\n","g"),"\n</"+p+">\n\n<"+s+">\n").select(y.$().end),U&&q.tools.p.click(e,y),y[1]();else{if(r("\\s+<\\/"+a(L.ul)+"|"+a(L.ol)+">\\s*").test(c))return y.select(),!1;var g=c.match(r("<"+h+H+">.*$"));g?r("<\\/"+h+">\\s*$").test(c)?y.tidy("\n"+d,!1).wrap("<"+h+g[1]+">","</"+h+">"):/>\s*$/.test(c)?r("<\\/"+h+">\\s*$").test(c)||y.wrap("\n"+d+O+"<"+s+">\n"+d+O+O+"<"+h+g[1]+">","</"+h+">\n"+d+O+"</"+p+">\n"+d):y.insert("</"+h+">\n"+d+"<"+h+g[1]+">",-1):y.tidy("\n\n","").wrap("<"+s+">\n"+O+"<"+u+">","</"+h+">\n</"+p+">")}}function c(e,t){return!t.get(0)&&U&&q.tools.p.click(e,t),t}function s(e){return u(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function u(e){return n(e.replace(/\s+/g," "))}var f,p="\u2013",h="\u2026",d="\u2191",g="\u2193",b="\u21B5",m="\u2318",v="\u2718",$="\u21E5",k="\u21E7",w=window,y=new TE(e),_=y._.extend,x=y._.each,T=y._.x,q=y.create(_({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:"Clear Format ("+v+")",b:"Bold ("+m+"+B)",i:"Italic ("+m+"+I)",u:"Underline ("+m+"+U)",s:"Strike ("+m+"+"+v+")",a:"Link ("+m+"+L)",img:"Image ("+m+"+G)",sub:"Subscript ("+m+"+"+g+")",sup:"Superscript ("+m+"+"+d+")",abbr:"Abbreviation ("+m+"+"+k+"+?)",p:"Paragraph ("+m+"+"+b+")","p,h1,h2,h3,h4,h5,h6":"H1 "+p+" H6 ("+m+"+H)","blockquote,q":"Quote ("+m+"+Q)","pre,code":"Code ("+m+"+K)",ul:"Unordered List ("+m+"+-)",ol:"Ordered List ("+m+"++)",indent:"Indent ("+$+")",outdent:"Outdent ("+k+"+"+$+")",table:"Table ("+m+"+T)",hr:"Horizontal Rule ("+m+"+R)"},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+h]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+h,"image caption here"+h]},abbr:{title:"Abbreviation",placeholder:"meaning here"+h},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+h]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),E=y._.format,S=y.config,I=S.states,C=S.languages,L=S.formats,O=(S.classes,S.tab),R=S.suffix,j="(?:\\s[^<>]*?)?",H="(|\\s[^<>]*?)",z="([\\s\\S]*?)",M=C.placeholders,U=S.auto_p;return y.type="HTML",y.i=function(){return y.replace(/\s+/g," ")},_(q.tools,{clear:{i:"eraser",click:function(e,t){var r=t[0]().$(),n=r.value;return/<[^<>]+?>/.test(n)||">"===r.before.slice(-1)||"<"===r.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!r.after}},b:{i:"bold",click:function(e,t){return c(e,t).i().format(L.b),!1}},i:{i:"italic",click:function(e,t){return c(e,t).i().format(L.i),!1}},u:{i:"underline",click:function(e,t){return c(e,t).i().format(L.u),!1}},s:{i:"strikethrough",click:function(e,t){return c(e,t).i().format(E(L.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var r,n,o=L.a,a=C.modals.a;return t.record().ui.prompt(["a[href]",a.title[0]],a.placeholder[0],1,function(e,t,i){i=u(i),r=i;var l,f,p=w.location.host;-1!==r.indexOf("://")&&(l=1),""!==p&&-1!==r.indexOf("://"+p)&&(l=0),/^([.\/?&#]|javascript:)/.test(r)&&(l=0),t.blur().ui.prompt(["a[title]",a.title[1]],a.placeholder[1],0,function(e,t,a){n=s(a),c(e,t).$().length||t.insert(M[""]),f=S.advance_a&&l?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+r+'"'+(n?' title="'+n+'"':"")+f)})}),!1}},img:{i:"image",click:function(e,t){var r,n,o=t.$(),i=L.img,l=L.figure,f=L.figcaption,p=o.value,h=C.modals.img,d=S.advance_img;return t.ui.prompt(["img[src]",h.title[0]],h.placeholder[0],1,function(e,t,o){o=u(o),r=o,t.blur().ui.prompt(["img[title]",h.title[d?2:1]],h.placeholder[d?2:1],0,function(e,t,o){n=s(o),p||(p=r.split(/[\/\\\\]/).pop()),p=s(p),t[0]().insert(""),d&&n?(t.tidy("\n\n","").insert("<"+l+">\n"+O+"<"+i+' alt="'+p+'" src="'+r+'"'+R+"\n"+O+"<"+f+">"+n+"</"+a(f)+">\n</"+a(l)+">\n\n",-1),U&&q.tools.p.click(e,y)):c(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+i+' alt="'+p+'" src="'+r+'"'+(n?' title="'+n+'"':"")+R+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var n=L.sub,o=L.sup,i=a(o);return c(e,t)[0]().unwrap(r("<"+i+j+">"),"</"+i+">").i().format(n)[1](),!1}},sup:{i:"superscript",click:function(e,t){var n=L.sub,o=L.sup,i=a(n);return c(e,t)[0]().unwrap(r("<"+i+j+">"),"</"+i+">").i().format(o)[1](),!1}},abbr:{i:"question",click:function(e,t){var o,i,l=t.$(),c=n(l.value),s=C.modals.abbr,u=t.get(),f=n(c||M[""]),p=L.abbr,h=a(p),d="<"+T(p)+H+">",g="<"+T(p)+j+">",b="<\\/"+h+">",m=r(d+z+b);return u.replace(m,function(e,t,r){(r=n(r))&&(I.abbr[r]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),o=I.abbr,c&&o[c]?(t.i().format(p+' title="'+o[c]+'"'),!1):(t.record().ui.prompt(["abbr[title]",s.title],o[f]||s.placeholder,!o[c],function(e,t,a,l){a=n(a||l),t[0]();for(i in o)if(o[i]===a){t.insert(i);break}t.unwrap(r(g),r(b)).unwrap(r(g),r(b),1).i().format(p+' title="'+a+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var n=t.$(),o=n.value,l=L.p,c=L.br,s=a(l),u=a(c),f=n.before,p=n.after,h=i(f);if(o&&-1!==o.indexOf("\n")){var d=r("^(?:\\s*<"+s+j+">\\s*)+"+z+"(?:\\s*<\\/"+s+">\\s*)+$");d.test(n.value)?t[0]().replace(d,"$1").replace(r("\\s*<\\/"+s+">\\s*<"+s+j+">\\s*","g"),"\n\n").replace(r("\\s*<"+u+j+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+c+R+"\n").replace(r("(\\s*<"+u+j+R+"\\s*){2,}","g"),"</"+s+">\n<"+l+">").wrap("<"+l+">","</"+s+">",1).replace(r("(<"+s+j+">)+","g"),"$1").replace(r("(<\\/"+s+">)+","g"),"$1").tidy("\n")[1]()}else r("^\\s*<\\/"+s+">").test(p)?r("<"+s+j+">\\s*$").test(f)?t[0]().unwrap(r("\\s*<"+s+j+">\\s*"),r("\\s*<\\/"+s+">")).tidy("\n","\n"+h)[1]():(match=f.match(r("<"+s+H+">.*$")))&&t.wrap("</"+s+">\n"+h+"<"+s+match[1]+">",""):t[0]().format(l,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var n=t.$(),o=[L.p,L.h1,L.h2,L.h3,L.h4,L.h5,L.h6],i=[];x(o,function(e,t){i[t]=a(e)});var l=(T(o).join("|"),T(i).join("|")),c="\\s*<("+l+")"+H+">\\s*",s=r("\\s*<(?:"+l+")"+j+">\\s*"),u=r("\\s*<\\/(?:"+l+")>\\s*"),f=n.value.match(r("^"+c));f||(f=n.before.match(r(c+"$"))||[]);var p=f[2]||"",h=+(f[1]||"h0").slice(1);return t[0]().unwrap(s,u).unwrap(s,u,1).i().format(h>5?i[0]+p:i[h+1]+p,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var n=t.$(),o=n.value,i=L.blockquote,l=L.q,c=L.p,s=a(c),u="<"+s+j+">";if(r("(^|\\n|"+u+")$").test(n.before)){if(U&&(n.value===M[""]||r("("+u+")$").test(n.before)))return t.select(),!1;t[0]().format(i,0,"\n\n","\n"),U&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(O+"<"+c+">","</"+s+">"):t[r("((^|\\n)"+O+")+").test(n.value)?"outdent":"indent"](O)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function n(e){return c?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return c?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var i=t.$(),l=i.value,c=S.auto_encode_html,s=L.pre,f=L.code,p=a(s),h=a(f),d="<"+p+j+">\\s*<"+h+j+">\\s*",g="\\s*<\\/"+h+">\\s*<\\/"+p+">",b=r(d+"\\s*$"),m=r("^\\s*"+g),v=r("^"+z+"$");return r("(^|\\n|"+d+")$").test(i.before)?b.test(i.before)&&m.test(i.after)?t[0]().unwrap(r(b),r(m)).replace(v,o)[1]():t[0]().tidy("\n\n").wrap("<"+s+"><"+f+">","</"+h+"></"+p+">").insert(l||M[""]).replace(v,n)[1]():t[0]().format(f).loss().replace(v,function(e){return u(r("^<\\/"+h+">").test(t.$().after)?n(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var n=L.ol,o=L.ul,i=a(n),c=a(o),s="("+T(c)+"|"+T(i)+")";return t.match(r("<"+s+j+">"+z+"<\\/"+s+">"))?t[0]().replace(r("<"+i+H+">","g"),"<"+c+"$1>").replace(r("</"+i+">","g"),"</"+c+">")[1]():l(e,o,L.li),!1}},ol:{i:"list-ol",click:function(e,t){var n=L.ol,o=L.ul,i=a(n),c=a(o),s="("+T(c)+"|"+T(i)+")";return t.match(r("<"+s+j+">"+z+"<\\/"+s+">"))?t[0]().replace(r("<"+c+H+">","g"),"<"+i+"$1>").replace(r("</"+c+">","g"),"</"+i+">")[1]():l(e,n,L.li),!1}},table:function(e,t){var r,i,l,c,s=I.tr,f=I.td,p=C.modals.table,h=C.placeholders.table,d=n(E(h[0],[1,1])),g=S.advance_table?O:"",b=L.table,m=L.caption,v=L.thead,$=L.tbody,k=L.tfoot,w=L.tr,y=L.th,_=L.td,x=a(b),T=a(m),q=a(v),R=a($),j=a(k),H=a(w),z=a(y),M=a(_),U=[];return t.$().value===d?(t.select(),!1):(t[0]().insert("").ui.prompt(["table>td",p.title[0]],p.placeholder[0],0,function(e,t,a,S){i=o(parseInt(a,10)||S,f[0],f[1]),t.blur().ui.prompt(["table>tr",p.title[1]],p.placeholder[1],0,function(e,t,a,f){l=o(parseInt(a,10)||f,s[0],s[1]),t.blur().ui.prompt(["table>caption",p.title[2]],p.placeholder[2],0,function(e,t,o){var a,s,f,p,S,I="";for(c=u(o),a=0;l>a;++a){for(r=g+O+"<"+w+">\n",s=0;i>s;++s)r+=g+O+O+"<"+_+">"+n(E(h[1],[a+1,s+1]))+"</"+M+">\n";r+=g+O+"</"+H+">",U.push(r)}for(U=U.join("\n"),r=O+(g?"<"+v+">\n"+O+O+"<"+w+">":"<"+H+">")+"\n",f=0;i>f;++f)r+=g+O+O+"<"+y+">"+n(E(h[0],[1,f+1]))+"</"+z+">\n";if(g){for(I+=O+"<"+k+">\n",f=0;i>f;++f)I+=O+O+"<"+_+">"+n(E(h[2],[1,f+1]))+"</"+M+">\n";I+=O+"</"+j+">\n"}r+=g+O+"</"+H+">"+(g?"\n"+O+"</"+q+">\n"+I+O+"<"+$+">":"")+"\n",U=r+U+(g?"\n"+O+"</"+R+">":"")+"\n",t.tidy("\n\n").insert("<"+b+">\n"+(c?O+"<"+m+">"+c+"</"+T+">\n":"")+U+"</"+x+">",1),p=t.$(),S=p.start+p.after.indexOf(d),t.select(S,S+d.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var r=i(t.$().before);return t.tidy("\n\n","").insert(r+"<"+L.hr+R+"\n\n",-1),!1}}}),S.keys&&_(q.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var r=i(t.$().before);return t.tidy("\n","").insert(r+"<"+L.br+R+"\n",-1),!1},enter:function(e,t){{var o,l,c=t.$(),s=c.value,u=t.get(),p=L.p,h=L.li,d=a(p),g=a(h);i(c.before)}if(!s){if(match=c.after.match(r("^\\s*<\\/("+d+"|"+g+")>")))o=match[1],q.tools["li"===o?f:o].click(e,t);else{if(!(U&&n(u)&&c.end===u.length&&/^\s*[^<\n]*?[^>]\s*$/.test(u)))return;u="<"+p+">"+u+"</"+d+">\n<"+p+">",l="</"+d+">",t.set(u+l).select(u.length)}return!1}},tab:function(e,t){var n=t.$(),o=L.li,l=a(o),c=i(n.before);return r("<\\/"+o+">").test(n.after)?(t.wrap("\n"+c+O+"<"+(L[f]||f)+">\n"+c+O+O+"<"+o+">","</"+l+">\n"+c+O+"</"+f+">\n"+c),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var n,o=t.$(),a=o.value,i=o.before,l=o.after,c="<[^<>]+?>";return!a&&r(c+"$").test(i)?(n=i.split("<").pop().match(/^([^\/\s]+).*?>$/),n=n&&n[1]||0,n&&r("^\\s*<\\/"+n+">").test(l)?t.unwrap(r("<"+n+j+">"),r("\\s*<\\/"+n+">")):t.outdent(r(c)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),y.update({},0)};