/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(e,t){function n(e,t){return RegExp(e,t)}function r(e){return e.replace(/^\s*|\s*$/g,"")}function o(e,t,n){return t>e?t:e>n?n:e}function i(e){return e.split(/\s+/)[0]}function a(e){var t=e.match(/(?:^|\n)([\t ]*).*$/);return t&&t[1]||""}function l(e,t,r){var o=w.$(),l=o.value,u=o.before,c=O[t],s=O[r]||r,p=i(c),d=i(s),h=a(u);if(f=c,l)w[0]().tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+d+">\n"+I+"<"+s+">").wrap("<"+c+">\n"+I+"<"+s+">","</"+d+">\n</"+p+">\n\n",1).replace(n("\\n"+I+"<"+s+">\\s*<\\/"+d+">\\n","g"),"\n</"+p+">\n\n<"+c+">\n").select(w.$().end),N&&E.tools.p.click(e,w),w[1]();else{if(n("\\s+<\\/"+i(O.ul)+"|"+i(O.ol)+">\\s*").test(u))return w.select(),!1;var g=u.match(n("<"+d+M+">.*$"));g?n("<\\/"+d+">\\s*$").test(u)?w.tidy("\n"+h,!1).wrap("<"+d+g[1]+">","</"+d+">"):/>\s*$/.test(u)?n("<\\/"+d+">\\s*$").test(u)||w.wrap("\n"+h+I+"<"+c+">\n"+h+I+I+"<"+d+g[1]+">","</"+d+">\n"+h+I+"</"+p+">\n"+h):w.insert("</"+d+">\n"+h+"<"+d+g[1]+">",-1):w.tidy("\n\n","").wrap("<"+c+">\n"+I+"<"+s+">","</"+d+">\n</"+p+">")}}function u(e,t){return!t.get(0)&&N&&E.tools.p.click(e,t),t}function c(e){return s(e).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function s(e){return r(e.replace(/\s+/g," "))}var f,p="\u2013",d="\u2026",h="\u2191",g="\u2193",b="\u21B5",v="\u2318",m="\u2718",$="\u21E5",y="\u21E7",k=window,w=new TE(e),x=w._.extend,_=w._.each,T=w._.x,E=w.create(x({type:"HTML",suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:"Clear Format ("+m+")",b:"Bold ("+v+"+B)",i:"Italic ("+v+"+I)",u:"Underline ("+v+"+U)",s:"Strike ("+v+"+"+m+")",a:"Link ("+v+"+L)",img:"Image ("+v+"+G)",sub:"Subscript ("+v+"+"+g+")",sup:"Superscript ("+v+"+"+h+")",abbr:"Abbreviation ("+v+"+"+y+"+?)",p:"Paragraph ("+v+"+"+b+")","p,h1,h2,h3,h4,h5,h6":"H1 "+p+" H6 ("+v+"+H)","blockquote,q":"Quote ("+v+"+Q)","pre,code":"Code ("+v+"+K)",ul:"Unordered List ("+v+"+-)",ol:"Ordered List ("+v+"++)",indent:"Indent ("+$+")",outdent:"Outdent ("+y+"+"+$+")",table:"Table ("+v+"+T)",hr:"Horizontal Rule ("+v+"+R)"},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+d]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+d,"image caption here"+d]},abbr:{title:"Abbreviation",placeholder:"meaning here"+d},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+d]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},t)),C=w._.format,q=w.config,L=q.states,S=q.languages,O=q.formats,I=(q.classes,q.tab),z=q.suffix,H="(?:\\s[^<>]*?)?",M="(|\\s[^<>]*?)",j="([\\s\\S]*?)",R=S.placeholders,N=q.auto_p;return w.i=function(){return w.replace(/\s+/g," ")},x(E.tools,{clear:{i:"eraser",click:function(e,t){var n=t[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?t.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):t.insert(""),t[1](),!!n.after}},b:{i:"bold",click:function(e,t){return u(e,t).i().format(O.b),!1}},i:{i:"italic",click:function(e,t){return u(e,t).i().format(O.i),!1}},u:{i:"underline",click:function(e,t){return u(e,t).i().format(O.u),!1}},s:{i:"strikethrough",click:function(e,t){return u(e,t).i().format(C(O.s,t._.time())),!1}},a:{i:"link",click:function(e,t){var n,r,o=O.a,i=S.modals.a;return t.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(e,t,a){a=s(a),n=a;var l,f,p=k.location.host;-1!==n.indexOf("://")&&(l=1),""!==p&&-1!==n.indexOf("://"+p)&&(l=0),/^([.\/?&#]|javascript:)/.test(n)&&(l=0),t.blur().ui.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(e,t,i){r=c(i),u(e,t).$().length||t.insert(R[""]),f=q.advance_a&&l?' rel="nofollow" target="_blank"':"",t.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+f)})}),!1}},img:{i:"image",click:function(e,t){var n,r,o=t.$(),a=O.img,l=O.figure,f=O.figcaption,p=o.value,d=S.modals.img,h=q.advance_img;return t.ui.prompt(["img[src]",d.title[0]],d.placeholder[0],1,function(e,t,o){o=s(o),n=o,t.blur().ui.prompt(["img[title]",d.title[h?2:1]],d.placeholder[h?2:1],0,function(e,t,o){r=c(o),p||(p=n.split(/[\/\\\\]/).pop()),p=c(p),t[0]().insert(""),h&&r?(t.tidy("\n\n","").insert("<"+l+">\n"+I+"<"+a+' alt="'+p+'" src="'+n+'"'+z+"\n"+I+"<"+f+">"+r+"</"+i(f)+">\n</"+i(l)+">\n\n",-1),N&&E.tools.p.click(e,w)):u(e,t).tidy(/<[^\/<>]+?>\s*$/.test(t.$().before)?"":" ","").insert("<"+a+' alt="'+p+'" src="'+n+'"'+(r?' title="'+r+'"':"")+z+" ",-1),t[1]()})}),!1}},sub:{i:"subscript",click:function(e,t){var r=O.sub,o=O.sup,a=i(o);return u(e,t)[0]().unwrap(n("<"+a+H+">"),"</"+a+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(e,t){var r=O.sub,o=O.sup,a=i(r);return u(e,t)[0]().unwrap(n("<"+a+H+">"),"</"+a+">").i().format(o)[1](),!1}},abbr:{i:"question",click:function(e,t){var o,a,l=t.$(),u=r(l.value),c=S.modals.abbr,s=t.get(),f=r(u||R[""]),p=O.abbr,d=i(p),h="<"+T(p)+M+">",g="<"+T(p)+H+">",b="<\\/"+d+">",v=n(h+j+b);return s.replace(v,function(e,t,n){(n=r(n))&&(L.abbr[n]=(t.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),o=L.abbr,u&&o[u]?(t.i().format(p+' title="'+o[u]+'"'),!1):(t.record().ui.prompt(["abbr[title]",c.title],o[f]||c.placeholder,!o[u],function(e,t,i,l){i=r(i||l),t[0]();for(a in o)if(o[a]===i){t.insert(a);break}t.unwrap(n(g),n(b)).unwrap(n(g),n(b),1).i().format(p+' title="'+i+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(e,t){var r=t.$(),o=r.value,l=O.p,u=O.br,c=i(l),s=i(u),f=r.before,p=r.after,d=a(f);if(o&&-1!==o.indexOf("\n")){var h=n("^(?:\\s*<"+c+H+">\\s*)+"+j+"(?:\\s*<\\/"+c+">\\s*)+$");h.test(r.value)?t[0]().replace(h,"$1").replace(n("\\s*<\\/"+c+">\\s*<"+c+H+">\\s*","g"),"\n\n").replace(n("\\s*<"+s+H+">\\s*","g"),"\n")[1]():t[0]().replace(/\n/g,"\n<"+u+z+"\n").replace(n("(\\s*<"+s+H+z+"\\s*){2,}","g"),"</"+c+">\n<"+l+">").wrap("<"+l+">","</"+c+">",1).replace(n("(<"+c+H+">)+","g"),"$1").replace(n("(<\\/"+c+">)+","g"),"$1").tidy("\n")[1]()}else n("^\\s*<\\/"+c+">").test(p)?n("<"+c+H+">\\s*$").test(f)?t[0]().unwrap(n("\\s*<"+c+H+">\\s*"),n("\\s*<\\/"+c+">")).tidy("\n","\n"+d)[1]():(match=f.match(n("<"+c+M+">.*$")))&&t.wrap("</"+c+">\n"+d+"<"+c+match[1]+">",""):t[0]().format(l,0,"\n\n")[1]();return!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(e,t){var r=t.$(),o=[O.p,O.h1,O.h2,O.h3,O.h4,O.h5,O.h6],a=[];_(o,function(e,t){a[t]=i(e)});var l=(T(o).join("|"),T(a).join("|")),u="\\s*<("+l+")"+M+">\\s*",c=n("\\s*<(?:"+l+")"+H+">\\s*"),s=n("\\s*<\\/(?:"+l+")>\\s*"),f=r.value.match(n("^"+u));f||(f=r.before.match(n(u+"$"))||[]);var p=f[2]||"",d=+(f[1]||"h0").slice(1);return t[0]().unwrap(c,s).unwrap(c,s,1).i().format(d>5?a[0]+p:a[d+1]+p,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(e,t){var r=t.$(),o=r.value,a=O.blockquote,l=O.q,u=O.p,c=i(u),s="<"+c+H+">";if(n("(^|\\n|"+s+")$").test(r.before)){if(N&&(r.value===R[""]||n("("+s+")$").test(r.before)))return t.select(),!1;t[0]().format(a,0,"\n\n","\n"),N&&(!o||t.match(/^[^<\n]*?[^>]$/)?t.wrap(I+"<"+u+">","</"+c+">"):t[n("((^|\\n)"+I+")+").test(r.value)?"outdent":"indent"](I)),t[1]()}else t.i().format(l);return!1}},"pre,code":{i:"code",click:function(e,t){function r(e){return u?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):e}function o(e){return u?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):e}var a=t.$(),l=a.value,u=q.auto_encode_html,c=O.pre,f=O.code,p=i(c),d=i(f),h="<"+p+H+">\\s*<"+d+H+">\\s*",g="\\s*<\\/"+d+">\\s*<\\/"+p+">",b=n(h+"\\s*$"),v=n("^\\s*"+g),m=n("^"+j+"$");return n("(^|\\n|"+h+")$").test(a.before)?b.test(a.before)&&v.test(a.after)?t[0]().unwrap(n(b),n(v)).replace(m,o)[1]():t[0]().tidy("\n\n").wrap("<"+c+"><"+f+">","</"+d+"></"+p+">").insert(l||R[""]).replace(m,r)[1]():t[0]().format(f).loss().replace(m,function(e){return s(n("^<\\/"+d+">").test(t.$().after)?r(e):o(e))})[1](),!1}},ul:{i:"list-ul",click:function(e,t){var r=O.ol,o=O.ul,a=i(r),u=i(o),c="("+T(u)+"|"+T(a)+")";return t.match(n("<"+c+H+">"+j+"<\\/"+c+">"))?t[0]().replace(n("<"+a+M+">","g"),"<"+u+"$1>").replace(n("</"+a+">","g"),"</"+u+">")[1]():l(e,o,O.li),!1}},ol:{i:"list-ol",click:function(e,t){var r=O.ol,o=O.ul,a=i(r),u=i(o),c="("+T(u)+"|"+T(a)+")";return t.match(n("<"+c+H+">"+j+"<\\/"+c+">"))?t[0]().replace(n("<"+u+M+">","g"),"<"+a+"$1>").replace(n("</"+u+">","g"),"</"+a+">")[1]():l(e,r,O.li),!1}},table:function(e,t){var n,a,l,u,c=L.tr,f=L.td,p=S.modals.table,d=S.placeholders.table,h=r(C(d[0],[1,1])),g=q.advance_table?I:"",b=O.table,v=O.caption,m=O.thead,$=O.tbody,y=O.tfoot,k=O.tr,w=O.th,x=O.td,_=i(b),T=i(v),E=i(m),z=i($),H=i(y),M=i(k),j=i(w),R=i(x),N=[];return t.$().value===h?(t.select(),!1):(t[0]().insert("").ui.prompt(["table>td",p.title[0]],p.placeholder[0],0,function(e,t,i,q){a=o(parseInt(i,10)||q,f[0],f[1]),t.blur().ui.prompt(["table>tr",p.title[1]],p.placeholder[1],0,function(e,t,i,f){l=o(parseInt(i,10)||f,c[0],c[1]),t.blur().ui.prompt(["table>caption",p.title[2]],p.placeholder[2],0,function(e,t,o){var i,c,f,p,q,L="";for(u=s(o),i=0;l>i;++i){for(n=g+I+"<"+k+">\n",c=0;a>c;++c)n+=g+I+I+"<"+x+">"+r(C(d[1],[i+1,c+1]))+"</"+R+">\n";n+=g+I+"</"+M+">",N.push(n)}for(N=N.join("\n"),n=I+(g?"<"+m+">\n"+I+I+"<"+k+">":"<"+M+">")+"\n",f=0;a>f;++f)n+=g+I+I+"<"+w+">"+r(C(d[0],[1,f+1]))+"</"+j+">\n";if(g){for(L+=I+"<"+y+">\n",f=0;a>f;++f)L+=I+I+"<"+x+">"+r(C(d[2],[1,f+1]))+"</"+R+">\n";L+=I+"</"+H+">\n"}n+=g+I+"</"+M+">"+(g?"\n"+I+"</"+E+">\n"+L+I+"<"+$+">":"")+"\n",N=n+N+(g?"\n"+I+"</"+z+">":"")+"\n",t.tidy("\n\n").insert("<"+b+">\n"+(u?I+"<"+v+">"+u+"</"+T+">\n":"")+N+"</"+_+">",1),p=t.$(),q=p.start+p.after.indexOf(h),t.select(q,q+h.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(e,t){var n=a(t.$().before);return t.tidy("\n\n","").insert(n+"<"+O.hr+z+"\n\n",-1),!1}}}),q.keys&&x(E.keys,{"delete":"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(e,t){var n=a(t.$().before);return t.tidy("\n","").insert(n+"<"+O.br+z+"\n",-1),!1},enter:function(e,t){{var o,l,u=t.$(),c=u.value,s=t.get(),p=O.p,d=O.li,h=i(p),g=i(d);a(u.before)}if(!c){if(match=u.after.match(n("^\\s*<\\/("+h+"|"+g+")>")))o=match[1],E.tools["li"===o?f:o].click(e,t);else{if(!(N&&r(s)&&u.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+p+">"+s+"</"+h+">\n<"+p+">",l="</"+h+">",t.set(s+l).select(s.length)}return!1}},tab:function(e,t){var r=t.$(),o=O.li,l=i(o),u=a(r.before);return n("<\\/"+o+">").test(r.after)?(t.wrap("\n"+u+I+"<"+(O[f]||f)+">\n"+u+I+I+"<"+o+">","</"+l+">\n"+u+I+"</"+f+">\n"+u),!1):t.ui.tools.indent.click(e,t)},backspace:function(e,t){var r,o=t.$(),i=o.value,a=o.before,l=o.after,u="<[^<>]+?>";return!i&&n(u+"$").test(a)?(r=a.split("<").pop().match(/^([^\/\s]+).*?>$/),r=r&&r[1]||0,r&&n("^\\s*<\\/"+r+">").test(l)?t.unwrap(n("<"+r+H+">"),n("\\s*<\\/"+r+">")):t.outdent(n(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),w.update({},0)};