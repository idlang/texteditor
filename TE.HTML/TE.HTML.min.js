/*!
 * ==========================================================
 *  HTML TEXT EDITOR PLUGIN 1.1.2
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.HTML=function(t,e){function n(t,e){return RegExp(t,e)}function r(t){return t.replace(/^\s*|\s*$/g,"")}function o(t,e,n){return e>t?e:t>n?n:t}function i(t){return t.split(/\s+/)[0]}function a(t){var e=t.match(/(?:^|\n)([\t ]*).*$/);return e&&e[1]||""}function l(t,e,r){var o,l=w.$(),u=l.value,c=l.before,s=H[e],p=H[r]||r,d=i(s),h=i(p),b=a(c),g=j[""];return f=s,w[0](),u&&u!==g?(w.tidy("\n\n","").replace(/[\t ]*\n[\t ]*/g,"</"+h+">\n"+O+"<"+p+">").wrap("<"+s+">\n"+O+"<"+p+">","</"+h+">\n</"+d+">\n\n",1).replace(n("\\n"+O+"<"+p+">\\s*<\\/"+h+">\\n","g"),"\n</"+d+">\n\n<"+s+">\n").select(w.$().end),A&&_.tools.p.click(t,w),w[1](),!1):void((o=c.match(n("(?:^|\\n)[\\t ]+<(\\/?)(?:"+i(H.ul)+"|"+i(H.ol)+")"+z+">\\s*$")))?w.insert("\n"+b+(o[1]?"":O),-1):(o=c.match(n("<"+h+M+">.*?$")))?n("<\\/"+h+">\\s*$").test(c)?w.tidy("\n"+b,!1).insert(g).wrap("<"+h+o[1]+">","</"+h+">"):/>\s*$/.test(c)?w.insert(g).wrap("\n"+b+O+"<"+s+">\n"+b+O+O+"<"+h+o[1]+">","</"+h+">\n"+b+O+"</"+d+">\n"+b):w.insert("</"+h+">\n"+b+"<"+h+o[1]+">",-1).insert(g):n("<\\/"+h+">\\s*$").test(c)?w.insert(g).wrap("\n"+b+"<"+p+">","</"+h+">"):w.tidy("\n\n").insert(g).wrap("<"+s+">\n"+O+"<"+p+">","</"+h+">\n</"+d+">"))}function u(t,e){return!e.get(0)&&A&&_.tools.p.click(t,e),e}function c(t){return s(t).replace(/<.*?>/g,"").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function s(t){return r(t.replace(/\s+/g," "))}var f,p="\u2013",d="\u2026",h="\u2191",b="\u2193",g="\u21b5",v="\u2318",m="\u2718",y="\u21e7",k=window,w=new TE(t),x=w._.extend,$=w._.each,T=w._.x,_=w.ui(x({suffix:">",auto_encode_html:1,auto_p:1,tools:"clear | b i u s | sub sup | abbr | a img | p,h1,h2,h3,h4,h5,h6 | blockquote,q pre,code | ul ol | indent outdent | table | hr | undo redo",states:{tr:[1,20],td:[1,20],abbr:{}},languages:{tools:{clear:["Clear Format",m],b:["Bold",v+"+B"],i:["Italic",v+"+I"],u:["Underline",v+"+U"],s:["Strike",v+"+"+m],a:["Link",v+"+L"],img:["Image",v+"+G"],sub:["Subscript",v+"+"+b],sup:["Superscript",v+"+"+h],abbr:["Abbreviation",v+"+"+y+"+?"],p:["Paragraph",v+"+"+g],"p,h1,h2,h3,h4,h5,h6":["H1 "+p+" H6",v+"+H"],"blockquote,q":["Quote",v+"+Q"],"pre,code":["Code",v+"+K"],ul:["Unordered List",v+"+-"],ol:["Ordered List",v+"++"],table:["Table",v+"+T"],hr:["Horizontal Rule",v+"+R"]},modals:{a:{title:["Link URL","Link Title"],placeholder:["http://","link title here"+d]},img:{title:["Image URL","Image Title","Image Caption"],placeholder:["http://","image title here"+d,"image caption here"+d]},abbr:{title:"Abbreviation",placeholder:"meaning here"+d},table:{title:["Number of Columns","Number of Rows","Table Caption"],placeholder:["3","3","table caption here"+d]}},placeholders:{table:["Table Head %1.%2","Table Data %1.%2","Table Foot %1.%2"]}},classes:{},advance_a:1,advance_img:1,advance_table:1,formats:{b:"strong",i:"em",u:"u",s:'del datetime="%1-%2-%3"',a:"a",figure:"figure",figcaption:"figcaption",img:"img",sub:"sub",sup:"sup",abbr:"abbr",p:"p",br:"br",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",blockquote:"blockquote",q:"q",pre:"pre",code:"code",ul:"ul",ol:"ol",li:"li",table:'table border="1"',caption:"caption",thead:"thead",tbody:"tbody",tfoot:"tfoot",tr:"tr",th:"th",td:"td",hr:"hr"}},e)),E=w._.format,L=w.config,C=L.states,q=L.languages,H=L.formats,O=(L.classes,L.tab),I=L.suffix,z="(?:\\s[^<>]*?)?",M="(|\\s[^<>]*?)",N="([\\s\\S]*?)",j=q.placeholders,A=L.auto_p;return w.type="HTML",x(_.tools,{clear:{i:"eraser",click:function(t,e){var n=e[0]().$(),r=n.value;return/<[^<>]+?>/.test(r)||">"===n.before.slice(-1)||"<"===n.after[0]?e.replace(/<[^<>]+?>/g,"").unwrap(/<[^\/<>]+?>/,/<\/[^<>]+?>/):e.insert(""),e[1](),!!n.after}},b:{i:"bold",click:function(t,e){return u(t,e).i().format(H.b),!1}},i:{i:"italic",click:function(t,e){return u(t,e).i().format(H.i),!1}},u:{i:"underline",click:function(t,e){return u(t,e).i().format(H.u),!1}},s:{i:"strikethrough",click:function(t,e){return u(t,e).i().format(E(H.s,e._.time())),!1}},a:{i:"link",click:function(t,e){var n,r,o=H.a,i=q.modals.a;return e.record().ui.prompt(["a[href]",i.title[0]],i.placeholder[0],1,function(t,e,a){a=s(a),n=a;var l,f,p=k.location.host;-1!==n.indexOf("://")&&(l=1),""!==p&&-1!==n.indexOf("://"+p)&&(l=0),/^([.\/?&#]|javascript:)/.test(n)&&(l=0),e.blur().ui.prompt(["a[title]",i.title[1]],i.placeholder[1],0,function(t,e,i){r=c(i),u(t,e).$().length||e.insert(j[""]),f=L.advance_a&&l?' rel="nofollow" target="_blank"':"",e.i().format(o+' href="'+n+'"'+(r?' title="'+r+'"':"")+f)})}),!1}},img:{i:"image",click:function(t,e){var n,r,o=e.$(),a=H.img,l=H.figure,f=H.figcaption,p=o.value,d=q.modals.img,h=L.advance_img;return e.ui.prompt(["img[src]",d.title[0]],d.placeholder[0],1,function(t,e,o){o=s(o),n=o,e.blur().ui.prompt(["img[title]",d.title[h?2:1]],d.placeholder[h?2:1],0,function(t,e,o){r=c(o),p||(p=n.split(/[\/\\\\]/).pop()),p=c(p),e[0](),h&&r?(e.tidy("\n\n","").insert("<"+l+">\n"+O+"<"+a+' alt="'+p+'" src="'+n+'"'+I+"\n"+O+"<"+f+">"+r+"</"+i(f)+">\n</"+i(l)+">\n\n",-1,1),A&&_.tools.p.click(t,w)):u(t,e).tidy(/<[^\/<>]+?>\s*$/.test(e.$().before)?"":" ","").insert("<"+a+' alt="'+p+'" src="'+n+'"'+(r?' title="'+r+'"':"")+I+" ",-1,1),e[1]()})}),!1}},sub:{i:"subscript",click:function(t,e){var r=H.sub,o=H.sup,a=i(o);return u(t,e)[0]().unwrap(n("<"+a+z+">"),"</"+a+">").i().format(r)[1](),!1}},sup:{i:"superscript",click:function(t,e){var r=H.sub,o=H.sup,a=i(r);return u(t,e)[0]().unwrap(n("<"+a+z+">"),"</"+a+">").i().format(o)[1](),!1}},abbr:{i:"question",click:function(t,e){var o,a,l=e.$(),c=r(l.value),s=q.modals.abbr,f=e.get(),p=r(c||j[""]),d=H.abbr,h=i(d),b="<"+T(d)+M+">",g="<"+T(d)+z+">",v="<\\/"+h+">",m=n(b+N+v);return f.replace(m,function(t,e,n){(n=r(n))&&(C.abbr[n]=(e.match(/\s+title="\s*(.*?)\s*"/i)||["",""])[1])}),o=C.abbr,c&&o[c]?(e.i().format(d+' title="'+o[c]+'"'),!1):(e.record().ui.prompt(["abbr[title]",s.title],o[p]||s.placeholder,!o[c],function(t,e,i,l){i=r(i||l),e[0]();for(a in o)if(o[a]===i){e.insert(a);break}u(t,e).unwrap(n(g),n(v)).unwrap(n(g),n(v),1).i().format(d+' title="'+i+'"')[1]()}),!1)}},p:{i:"paragraph",click:function(t,e){var r,o=e.$(),l=o.value,u=H.p,c=H.br,s=i(u),f=i(c),p=o.before,d=o.after,h=a(p),b=j[""];return e[0](),l&&-1!==l.indexOf("\n")?(r=n("^(?:\\s*<"+s+z+">\\s*)+"+N+"(?:\\s*<\\/"+s+">\\s*)+$"),r.test(o.value)?e.replace(r,"$1").replace(n("\\s*<\\/"+s+">\\s*<"+s+z+">\\s*","g"),"\n\n").replace(n("\\s*<"+f+z+">\\s*","g"),"\n"):e.replace(/\n/g,"\n<"+c+I+"\n").replace(n("(\\s*<"+f+z+I+"\\s*){2,}","g"),"</"+s+">\n<"+u+">").wrap("<"+u+">","</"+s+">",1).replace(n("(<"+s+z+">)+","g"),"$1").replace(n("(<\\/"+s+">)+","g"),"$1").tidy("\n")):n("^\\s*<\\/"+s+">").test(d)?n("<"+s+z+">\\s*$").test(p)?e.unwrap(n("\\s*<"+s+z+">\\s*"),n("\\s*<\\/"+s+">")).replace(b,"").tidy("\n","\n"+h):(match=p.match(n("<"+s+M+">.*?$")))&&e.wrap("</"+s+">\n"+h+"<"+s+match[1]+">","").insert(b):e.format(u,0,"\n\n"),e[1](),!1}},"p,h1,h2,h3,h4,h5,h6":{i:"header",click:function(t,e){var r,o,a,l,u,c,s,f,p=e.$(),d=[H.p,H.h1,H.h2,H.h3,H.h4,H.h5,H.h6],h=[];return $(d,function(t,e){h[e]=i(t)}),r=T(d).join("|"),o=T(h).join("|"),a="\\s*<("+o+")"+M+">\\s*",l=n("\\s*<(?:"+o+")"+z+">\\s*"),u=n("\\s*<\\/(?:"+o+")>\\s*"),c=p.value.match(n("^"+a)),c||(c=p.before.match(n(a+"$"))||[]),s=c[2]||"",f=+(c[1]||"h0").slice(1),e[0]().unwrap(l,u).unwrap(l,u,1).i().tidy("\n\n").format(f>5?h[0]+s:h[f+1]+s,0,"\n\n")[1](),!1}},"blockquote,q":{i:"quote-left",click:function(t,e){var r=e.$(),o=r.value,a=H.blockquote,l=H.q,u=H.p,c=i(u),s="<"+c+z+">";if(n("(^|\\n|"+s+")$").test(r.before)){if(A&&(r.value===j[""]||n("("+s+")$").test(r.before)))return e.select(),!1;e[0]().format(a,0,"\n\n","\n"),A&&(!o||e.match(/^[^<\n]*?[^>]$/)?e.wrap(O+"<"+u+">","</"+c+">"):e[n("((^|\\n)"+O+")+").test(r.value)?"outdent":"indent"](O)),e[1]()}else e.i().format(l);return!1}},"pre,code":{i:"code",click:function(t,e){function r(t){return u?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}function o(t){return u?t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):t}var a=e.$(),l=a.value,u=L.auto_encode_html,c=H.pre,f=H.code,p=i(c),d=i(f),h="<"+p+z+">\\s*<"+d+z+">\\s*",b="\\s*<\\/"+d+">\\s*<\\/"+p+">",g=n(h+"\\s*$"),v=n("^\\s*"+b),m=n("^"+N+"$");return n("(^|\\n|"+h+")$").test(a.before)?g.test(a.before)&&v.test(a.after)?e[0]().unwrap(n(g),n(v)).replace(m,o)[1]():e[0]().tidy("\n\n").wrap("<"+c+"><"+f+">","</"+d+"></"+p+">").insert(l||j[""]).replace(m,r)[1]():e[0]().format(f).loss().replace(m,function(t){return s(n("^<\\/"+d+">").test(e.$().after)?r(t):o(t))})[1](),!1}},ul:{i:"list-ul",click:function(t,e){var r=H.ol,o=H.ul,a=i(r),u=i(o),c="("+T(u)+"|"+T(a)+")";return e.match(n("<"+c+z+">"+N+"<\\/"+c+">"))?e[0]().replace(n("<"+a+M+">","g"),"<"+u+"$1>").replace(n("</"+a+">","g"),"</"+u+">")[1]():l(t,o,H.li),!1}},ol:{i:"list-ol",click:function(t,e){var r=H.ol,o=H.ul,a=i(r),u=i(o),c="("+T(u)+"|"+T(a)+")";return e.match(n("<"+c+z+">"+N+"<\\/"+c+">"))?e[0]().replace(n("<"+u+M+">","g"),"<"+a+"$1>").replace(n("</"+u+">","g"),"</"+a+">")[1]():l(t,r,H.li),!1}},table:function(t,e){var n,a,l,u,c=C.tr,f=C.td,p=q.modals.table,d=q.placeholders.table,h=r(E(d[0],[1,1])),b=L.advance_table?O:"",g=H.table,v=H.caption,m=H.thead,y=H.tbody,k=H.tfoot,w=H.tr,x=H.th,$=H.td,T=i(g),_=i(v),I=i(m),z=i(y),M=i(k),N=i(w),j=i(x),A=i($),R=[];return e.$().value===h?(e.select(),!1):(e[0]().ui.prompt(["table>td",p.title[0]],p.placeholder[0],0,function(t,e,i,L){a=o(parseInt(i,10)||L,f[0],f[1]),e.blur().ui.prompt(["table>tr",p.title[1]],p.placeholder[1],0,function(t,e,i,f){l=o(parseInt(i,10)||f,c[0],c[1]),e.blur().ui.prompt(["table>caption",p.title[2]],p.placeholder[2],0,function(t,e,o){var i,c,f,p,L,C="";for(u=s(o),i=0;l>i;++i){for(n=b+O+"<"+w+">\n",c=0;a>c;++c)n+=b+O+O+"<"+$+">"+r(E(d[1],[i+1,c+1]))+"</"+A+">\n";n+=b+O+"</"+N+">",R.push(n)}for(R=R.join("\n"),n=O+(b?"<"+m+">\n"+O+O+"<"+w+">":"<"+N+">")+"\n",f=0;a>f;++f)n+=b+O+O+"<"+x+">"+r(E(d[0],[1,f+1]))+"</"+j+">\n";if(b){for(C+=O+"<"+k+">\n",C+=O+O+"<"+w+">\n",f=0;a>f;++f)C+=O+O+O+"<"+$+">"+r(E(d[2],[1,f+1]))+"</"+A+">\n";C+=O+O+"</"+w+">\n",C+=O+"</"+M+">\n"}n+=b+O+"</"+N+">"+(b?"\n"+O+"</"+I+">\n"+C+O+"<"+y+">":"")+"\n",R=n+R+(b?"\n"+O+"</"+z+">":"")+"\n",e.tidy("\n\n").insert("<"+g+">\n"+(u?O+"<"+v+">"+u+"</"+_+">\n":"")+R+"</"+T+">",0),p=e.$(),L=p.start+p.value.indexOf(h),e.select(L,L+h.length)[1]()})})}),!1)},hr:{i:"ellipsis-h",click:function(t,e){var n=a(e.$().before);return e.tidy("\n\n","").insert(n+"<"+H.hr+I+"\n\n",-1),!1}}}),L.keys&&x(_.keys,{delete:"clear","control+delete":"s","control+b":"b","control+i":"i","control+u":"u","control+l":"a","control+g":"img","control+arrowdown":"sub","control+arrowup":"sup","control+shift+?":"abbr","control+enter":"p","shift+enter":function(t,e){var n=a(e.$().before);return e.tidy("\n","").insert(n+"<"+H.br+I+"\n",-1),!1},enter:function(t,e){var o,l,u=e.$(),c=u.value,s=e.get(),p=H.p,d=H.li,h=i(p),b=i(d),g=(a(u.before),j[""]);if(!c||c===g){if(match=u.after.match(n("^\\s*<\\/("+h+"|"+b+")>")))o=match[1],_.tools["li"===o?f:o].click(t,e);else{if(!(A&&r(s)&&u.end===s.length&&/^\s*[^<\n]*?[^>]\s*$/.test(s)))return;s="<"+p+">"+s+"</"+h+">\n<"+p+">",l=g+"</"+h+">",e.set(s+l).select(s.length,(s+g).length)}return!1}},tab:function(t,e){var r=e.$(),o=H.li,l=i(o),u=a(r.before);return n("<\\/"+o+">").test(r.after)?(e[0]().wrap("\n"+u+O+"<"+(H[f]||f)+">\n"+u+O+O+"<"+o+">","</"+l+">\n"+u+O+"</"+f+">\n"+u).insert(j[""])[1](),!1):e.ui.tools.indent.click(t,e)},backspace:function(t,e){var r,o=e.$(),i=o.value,a=o.before,l=o.after,u="<[^<>]+?>";return!i&&n(u+"$").test(a)?(r=a.split("<").pop().match(/^([^\/\s]+).*?>$/),r=r&&r[1]||0,r&&n("^\\s*<\\/"+r+">").test(l)?e.unwrap(n("<"+r+z+">"),n("\\s*<\\/"+r+">")):e.outdent(n(u)),!1):void 0},"control+h":"p,h1,h2,h3,h4,h5,h6","control+q":"blockquote,q","control+k":"pre,code","control+-":"ul","control++":"ol","control+=":"ol","control+shift++":"ol","control+t":"table","control+r":"hr"}),w.update({},0)};