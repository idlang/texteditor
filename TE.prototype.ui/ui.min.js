/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 0.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
var TE_ui=function(e,t){function n(e){return e instanceof HTMLElement}function r(e){return void 0!==e}function o(e){return"function"==typeof e}function i(e){return"string"==typeof e}function u(e){return"object"==typeof e}function a(e){return"number"==typeof e}function c(e,n,o){return r(e)?r(n)?(r(at[e])||(at[e]={}),r(o)||(o=Object.keys(at[e]).length),at[e][o]=n,t):at[e]:at}function l(e,n){return r(e)?r(n)&&r(at[e])?(delete at[e][n],t):(at[e]={},t):(at={},t)}function s(e,n,o){if(!r(at[e]))return t;if(r(o))r(at[e][o])&&at[e][o].apply(t,n);else for(var i in at[e])at[e][i].apply(t,n);return t}function f(e){return e&&e.preventDefault(),!1}function p(e,t,n){t.addEventListener(e,n,!1),c("on:"+e,n,L(t))}function d(e,t,n){t.removeEventListener(e,n,!1),l("on:"+e,L(t))}function v(e,t,n){s("on:"+e,t,L(n))}function g(e,t,n){e=k(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)p(e[r],t,n)}function h(e,t,n){e=k(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)d(e[r],t,n)}function y(e,t,n){e=k(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)v(e[r],t,n)}function m(e,t){rt.setTimeout(e,t)}function b(e){rt.clearTimeout(e)}function k(e){return e.replace(/^\s*|\s*$/g,"")}function w(e,t,n){return t>e?t:e>n?n:e}function x(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,r(t[n])?t[n]:e})}function $(e){return k(e.toLowerCase().replace(/[^ \/a-z\d-]/g,"-").replace(/([ -])+/g,"$1").replace(/^-|-$/g,""))}function E(e,t){return RegExp(e,t)}function T(e,t){for(var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,o=_(e).l,i=_(e).t;e=e.offsetParent;)o+=_(e).l,i+=_(e).t;return{x:n-o,y:r-i}}function _(e){return{l:e.offsetLeft,t:e.offsetTop}}function C(e){return{w:e.offsetWidth,h:e.offsetHeight}}function N(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function L(e){var t=e.id;return t||(t=Ct+"-dom:"+(new Date).getTime(),e.id=t),t}function z(e,t,a){if(e=i(e)?ot.createElement(e):e,u(a)){var c,l;for(l in a)c=a[l],"style"===l?i(c)?e.setAttribute(l,c):null===c?e.removeAttribute(l):e=j(e,c):o(c)?e[l]=c:null===c?e.removeAttribute(l):e.setAttribute(l,u(c)?c.join(" "):""+c)}if(n(t))e.appendChild(t);else if(u(t)){var c,l;for(l in t)c=t[l],n(c)?e.appendChild(c):c!==!1&&(e.innerHTML=c)}else r(t)&&t!==!1&&(e.innerHTML=t);return e}function j(e,t){e=z(e);for(var n in t)e.style[n.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})]=t[n];return e}function H(e,t){return E("(^|\\s)"+t+"(\\s|$)").test(e.className)}function A(e,t){H(e,t)||(e.className=k(e.className+" "+t))}function O(e,t){e.className=k(e.className.replace(E("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function M(e,t){e.innerHTML=t}function Y(e,t){if(t!==!1){var n,r=e.children;for(n in r)Y(r[n])}M(e,"")}function R(e,t){return 1===arguments.length?e.parentNode||!1:e&&t.parentNode===e?t.parentNode:!1}function U(e,t){e.parentNode.insertBefore(t,e)}function q(e,t){e.appendChild(t)}function S(e,t){var n=R(e);if(n){if(t!==!1)for(var r=e.firstChild;r;)S(r);n.removeChild(e)}}function P(e){Y(z(e,!1,{style:""})),S(e)}function W(e,t,n){return z(t||"div",n,{"class":e})}function D(){var e=(Ut.value||"").replace(/<[^<>]+?>/g,""),t=(e.match(/(\w+)/g)||[]).length;M(Bt,x(jt["_word"+(1===t?"":"s")],[t]))}function X(e){D(),s("change",[e,t])}function B(e){function n(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var r,o,u,a,c=e.TE.key,l=it.keys,s=TE.keys_alt;Zt[c()]=1,m(function(){t.record()},1);for(r in l){var p=0;u=n(r);for(o in u)o=u[o],Zt[s[o]||o]&&++p;p===u.length&&(i(l[r])&&(l[r]=it.tools[l[r]].click),a=l[r](e,t),a===!1&&f(e))}}function I(e){u(e)?Zt[e.TE.key()]=0:Zt={}}function K(e){/^focus|blur$/.test(e.type)&&I(1),b(Qt),Qt=m(X,1e3)}function Z(e){var n=this.hash.replace("#","");return it.tools[n]&&it.tools[n].click?(it.tools[n].click(e,t,n),s("change",[e,t,n]),f(e)):void 0}function Q(){P(St),d(kt,St,Q),t.select()}function F(){e=C(Pt),Vt=e.w,en=e.h,e=C(St),tn=e.w,nn=e.h}function G(){v(kt,[],St)}function J(t){Ft=t.target,e=T(Pt,t),Gt=e.x,Jt=e.y,F()}function V(t){var n,r,o=rn.header,i=rn.resize;(Ft===o||N(Ft,o)===o)&&(e=T(Mt,t),n=e.x-Gt,r=e.y-Jt,j(Pt,{left:w(n,0,tn-Vt)+"px",top:w(r,0,nn-en)+"px"})),(Ft===i||N(Ft,i)===i)&&(e=T(Pt,t),j(Pt,{width:e.x+"px",height:e.y+"px"}))}function et(){Ft=0}function tt(e,t,n){return{header:e,body:t,footer:n}}var nt="\u2318",rt=window,ot=document,it=this,ut=(ot.documentElement,ot.head,ot.body),at={},ct=t.target,lt=function(){},st=t._.extend,ft=st({keys:1,tools:"undo redo",languages:{tools:{undo:"Undo ("+nt+"+Z)",redo:"Redo ("+nt+"+Y)"},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{editor:"text-editor",i:"fa fa-%1"},tab:"  "},e),pt="keydown",dt="keyup",vt="copy",gt="cut",ht="paste",yt="mousedown",mt="mouseup",bt="mousemove",kt="click",wt="focus",xt="blur",$t="input",Et=xt+" "+vt+" "+gt+" "+wt+" "+$t+" "+pt+" "+ht;t.gap=function(e,n){var o=t.$(),i=o.before.length?e:"",u=o.after.length?r(n)?n:e:"";return t.trim(i,u)},t.format=function(e,n,o,i){r(o)||(o=" "),r(i)||(i="");var u=t.$(),a="<"+e+">"+i,c=i+"</"+e.split(" ")[0]+">",l=t._.esc(a),s=t._.esc(c),f=E("^"+l+"([\\s\\S]*?)"+s+"$"),p=E(l+"$"),d=E("^"+s),v=o,g=o;return/<[^\/<>]+?>$/.test(u.before)&&(v=""),/^<\/[^<>]+?>/.test(u.after)&&(g=""),t.toggle(n?!f.test(u.value):!p.test(u.before)&&!d.test(u.after),[function(e){e[0]().unwrap(a,c,1).gap(v,g).wrap(a,c,n)[1]()},function(e){e[0]().unwrap(a,c,n)[1]()}])};var Tt,_t=ft.classes,Ct=_t.editor,Nt=ft.languages,Lt=Nt.tools,zt=Nt.buttons,jt=Nt.others,Ht=Ct+"-textarea "+Ct+"-content",At=W(Ct),Ot=W(Ct+"-header"),Mt=W(Ct+"-body"),Yt=W(Ct+"-footer"),Rt=W(Ct+"-tool"),Ut=ct,qt=W(Ct+"-description"),St=W(Ct+"-overlay"),Pt=W(Ct+"-modal"),Wt=W(Ct+"-drop"),Dt=W(Ct+"-bubble"),Xt=W("left","span"),Bt=W("right","span"),It=W(Ct+"-preview","span"),Kt=null;p(kt,It,function(e){var n=t.get();return!R(St)&&n.length?it.overlay(n,0,function(){p(kt,St,Q),s("on:preview",[n,St.firstChild])}):Q(),f(e)});var Zt={},Qt=null;t.create=function(e,n){u(e)&&(ft=st(ft,e)),A(Ut,Ht);var r,a,c,l,f,d,v=i(ft.tools)?k(ft.tools).split(/\s+/):ft.tools,h=R(Ut),y=Ct+"-button",m=Ct+"-separator";if(ft.tools=v,h&&"p"===h.tagName.toLowerCase()?(U(h,At),Kt=h,S(h,!1)):U(Ut,At),q(At,Ot),q(At,Mt),q(At,Yt),q(Mt,Ut),ft.tools&&(q(Ot,Rt),q(Yt,qt),q(qt,Xt),q(qt,Bt)),ft.tools)for(f in v){if(d=v[f],!it.tools[d])return!0;a=it.tools[d],o(a)&&(it.tools[d].click=a),"|"!==(c=a.i||d)&&(c=$(c)),l="|"!==c,Tt=W(l?y:m,l?"a":"span"),l&&(r=y+":"+d,Tt.href="#"+d,Tt.id=r,c='<i class="'+x(_t.i,[c])+" "+r+'"></i>',a.text&&(c=x(a.text,[c])),M(Tt,c),a.title&&(Tt.title=a.title),u(a.attributes)&&z(Tt,!1,a.attributes),p(kt,Tt,Z)),q(Rt,Tt)}return ft.keys&&(it.keys=function(){var e,t=Object.keys(it.keys).sort().reverse(),n={};for(e=0,len=t.length;len>e;++e)n[t[e]]=it.keys[t[e]];return n}(),p(pt,Ut,B),p(dt,Ut,I)),g(Et,Ut,K),q(Xt,It),M(It,jt.preview),X(),0!==n?s("create",[t]):t},t.update=function(e,n){return H(Ut,Ht)&&t.destroy(0),(0!==n?s("update",[t]):t).create(e,0)},t.destroy=function(e){return H(Ut,Ht)?(O(Ut,Ht),ft.tools=ft.tools.join(" "),ft.keys&&(d(pt,Ut,B),d(dt,Ut,I)),h(Et,Ut,K),Kt?(U(At,Kt),q(Kt,Ut),Kt=null):U(At,Ut),P(At),0!==e?s("destroy",[t]):t):t},it.tool=function(e,n,r){return n===!1?(delete it.tools[e],ft.tools=ft.tools.filter(function(t){return t!==e})):(it.tools[e]=n,a(r)?ft.tools.splice(r,0,e):ft.tools.push(e)),t.update(0)},it.key=function(e,n){return n===!1?delete it.keys[e]:it.keys[e]=n,t.update(0)};var e,Ft=0,Gt=0,Jt=0,Vt=0,en=0,tn=0,nn=0,rn={};it.exit=function(e,n){var r,o={overlay:Q,modal:function(){d(yt,Mt,J),d(bt,Mt,V),d(mt,ut,et),d(kt,rn.x,G),P(Pt)},drop:function(){P(Wt)},bubble:function(){P(Dt)}};if(n)if(u(n))for(r in n)o[n[r]]&&o[n[r]]();else o[n]&&o[n]();else for(r in o)o[r]();return e&&t.select(),t},it.overlay=function(e,n,r){function i(){it.exit(1),d(kt,St,i)}return I(1),q(Mt,z(St,e.length?W(Ct+"-overlay-content","div",e):"")),n&&p(kt,St,i),o(r)&&r(St),t},it.modal=function(){var e,n=arguments,i=n[0],a=n[1],c=n[2],l=Ct+"-modal";u(i)&&(i="default",a=n[0],c=n[1]),A(Pt,i),r(a.body)&&(a.body=z("div",a.body,{"class":l+"-content "+i}));for(e in a)l[1]=e,rn[e]=W(l+"-"+x(e,l)+" "+i,0,a[e]);rn.x=W(l+"-x "+i),rn.resize=W(l+"-resize "+i),Y(Pt),q(Mt,z(Pt,rn,{style:""})),it.overlay("",1),F();var s=nn/2-en/2,d=tn/2-Vt/2;return j(Pt,{top:s+"px",left:d+"px"}),p(kt,rn.x,G),p(yt,rn.header,f),p(yt,rn.resize,f),p(yt,Mt,J),p(bt,Mt,V),p(mt,ut,et),o(c)&&(rn.overlay=St,rn.modal=Pt,c(rn)),t};var on={"class":Ct+"-button"};return it.alert=function(e,t){var n=z("button",zt.okay,on);return p(kt,n,G),p(pt,n,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(G(),f(e)):void 0}),m(function(){n.focus()},1),it.modal("alert",tt(e,t,n))},it.confirm=function(e,n,r,i){function u(e){return o(r)&&r(e,t),G(),f(e)}function a(e){return o(i)&&i(e,t),G(),f(e)}var c,l=z("button",zt.okay,on),s=z("button",zt.cancel,on);return p(kt,l,u),p(kt,s,a),p(pt,l,function(e){return c=e.TE.key,c("arrowright")?(s.focus(),f(e)):c("arrowleft")?f(e):c(/^escape|enter$/)?(u(e),f(e)):void 0}),p(pt,s,function(e){return c=e.TE.key,c("arrowright")?f(e):c("arrowleft")?(l.focus(),f(e)):c(/^escape|enter$/)?(a(e),f(e)):void 0}),m(function(){s.focus()},1),it.modal("confirm",tt(e,n,[l,s]))},it.prompt=function(e,n,r,o){function i(){v.focus(),v.select()}function u(e){return!r||k(v.value).length&&v.value!==n?(a(e),o(e,t,v.value)):(i(),c(e))}function a(e){return G(),f(e)}function c(e){return f(e)}var l,s=z("button",zt.okay,on),d=z("button",zt.cancel,on),v=z("input",!1,{type:"text",value:n,placeholder:n,"class":Ct+"-input block"});return o=o||lt,p(pt,v,function(e){return l=e.TE.key,l("enter")?u(e):l("escape")?a(e):l("arrowup")?c(e):l("arrowdown")?(s.focus(),f(e)):void 0}),p(pt,s,function(e){return l=e.TE.key,l("enter")?u(e):l("escape")?a(e):l("arrowup")?(v.focus(),f(e)):l("arrowright")?(d.focus(),f(e)):l(/arrow(down|left)/)?c(e):void 0}),p(pt,d,function(e){return l=e.TE.key,l(/^enter|escape$/)?a(e):l("arrowup")?(v.focus(),f(e)):l(/arrow(right|down)/)?c(e):l("arrowleft")?(s.focus(),f(e)):void 0}),p(kt,s,u),p(kt,d,a),m(i,.4),it.modal("prompt",tt(e,v,[s,d]))},it.drop=function(e,n){return q(ut,z(Wt,e)),it.overlay("",1),o(n)&&n(Wt),t},it.bubble=function(e,n){return q(ut,z(Dt,e)),it.overlay("",1),o(n)&&n(Dt),t},it.tools={undo:{i:"undo",title:Lt.undo,click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",title:Lt.redo,click:function(e,t){return t.redo(),!1}},"|":1},it.keys={"control+y":"redo","control+z":"undo"},it.parent=t,it.dom={container:At,header:Ot,body:Mt,footer:Yt,overlay:St,modal:Pt,drop:Wt,bubble:Dt},t.config=ft,t.ui=it,st(t._,{format:x,el:z,event:{set:g,reset:h,fire:y},hooks:at,hook:{set:c,reset:l,fire:s}}),t.create(),it};TE.prototype.create=function(e){return new TE_ui(e,this)};