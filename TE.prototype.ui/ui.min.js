/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 0.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
var TE_ui=function(e,t){function n(e){return e instanceof HTMLElement}function o(e){return void 0!==e}function r(e){return"function"==typeof e}function i(e){return"string"==typeof e}function u(e){return"object"==typeof e}function c(e){return"number"==typeof e}function a(e,n,r){return o(e)?o(n)?(o(dt[e])||(dt[e]={}),o(r)||(r=Object.keys(dt[e]).length),dt[e][r]=n,t):dt[e]:dt}function s(e,n){return o(e)?o(n)&&o(dt[e])?(delete dt[e][n],t):(dt[e]={},t):(dt={},t)}function f(e,n,r){if(!o(dt[e]))return t;if(o(r))o(dt[e][r])&&dt[e][r].apply(t,n);else for(var i in dt[e])dt[e][i].apply(t,n);return t}function l(e){return e&&e.preventDefault(),!1}function d(e,t,n){t&&(t.addEventListener(e,n,!1),a("on:"+e,n,_(t)))}function p(e,t,n){t&&(t.removeEventListener(e,n,!1),s("on:"+e,_(t)))}function v(e,t,n){f("on:"+e,t,_(n))}function h(e,t,n){e=w(e).split(/\s+/);for(var o=0,r=e.length;r>o;++o)d(e[o],t,n)}function y(e,t,n){e=w(e).split(/\s+/);for(var o=0,r=e.length;r>o;++o)p(e[o],t,n)}function g(e,t,n){e=w(e).split(/\s+/);for(var o=0,r=e.length;r>o;++o)v(e[o],t,n)}function m(e,t){ct.setTimeout(e,t)}function b(e){ct.clearTimeout(e)}function w(e){return e.replace(/^\s*|\s*$/g,"")}function k(e,t,n){return t>e?t:e>n?n:e}function x(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,o(t[n])?t[n]:e})}function T(e){return w(e.toLowerCase().replace(/[^ \/a-z\d-]/g,"-").replace(/([ -])+/g,"$1").replace(/^-|-$/g,""))}function E(e,t){return RegExp(e,t)}function $(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,o=t.touches?t.touches[0].pageY:t.pageY,r=C(e);return{x:n-r.l,y:o-r.t}}function C(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{l:t,t:n}}function N(e){return{w:e.offsetWidth,h:e.offsetHeight}}function L(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function _(e){var t=e.id;return t||(t=At+"-dom:"+(new Date).getTime(),e.id=t),t}function j(e,t,c){if(e=i(e)?at.createElement(e):e,u(c)){var a,s;for(s in c)a=c[s],"style"===s?i(a)?e.setAttribute(s,a):null===a?e.removeAttribute(s):e=z(e,a):r(a)?e[s]=a:null===a?e.removeAttribute(s):e.setAttribute(s,u(a)?a.join(" "):""+a)}if(n(t))e.appendChild(t);else if(u(t)){var a,s;for(s in t)a=t[s],n(a)?e.appendChild(a):a!==!1&&(e.innerHTML=a)}else o(t)&&t!==!1&&(e.innerHTML=t);return e}function z(e,t){e=j(e);for(var n in t)e.style[n.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})]=t[n];return e}function O(e,t){return E("(^|\\s)"+t+"(\\s|$)").test(e.className)}function A(e,t){O(e,t)||(e.className=w(e.className+" "+t))}function H(e,t){e.className=w(e.className.replace(E("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function Y(e,t){e.innerHTML=t}function M(e,t){if(t!==!1){var n,o=e.children;for(n in o)M(o[n])}Y(e,"")}function D(e,t){return 1===arguments.length?e.parentNode||!1:e&&t.parentNode===e?t.parentNode:!1}function P(e,t){e.parentNode.insertBefore(t,e)}function R(e,t){e.appendChild(t)}function U(e,t){var n=D(e);if(n){if(t!==!1)for(var o=e.firstChild;o;)U(o);n.removeChild(e)}}function W(e){M(j(e,!1,{style:""})),U(e)}function I(e,t,n){return j(t||"div",n,{"class":e})}function X(){var e=(It.value||"").replace(/<[^<>]+?>/g,""),t=(e.match(/(\w+)/g)||[]).length;Y(Ft,x(Yt["_word"+(1===t?"":"s")],[t]))}function B(){M(Wt,!1);var e,t,n,c,a,s,f=i(yt.tools)?w(yt.tools).split(/\s+/):yt.tools,l=At+"-button",d=At+"-separator";yt.tools=f;for(a in f)s=f[a],st.tools[s]&&(t=st.tools[s],r(t)&&(st.tools[s].click=t),"|"!==(n=t.i||s)&&(n=T(n)),c="|"!==n,zt=I(c?l:d,c?"a":"span"),c&&(e=l+":"+T(s).replace(/\s/g,""),zt.href="javascript:;",zt.id=e,zt.setAttribute("data-tool-id",s),n='<i class="'+x(Ot.i,[n])+" "+e+'"></i>',o(t.active)?t.active||A(zt,"x"):t.active=1,t.text&&(n=x(t.text,[n])),Y(zt,n),t.title&&(zt.title=t.title),u(t.attributes)&&j(zt,!1,t.attributes),h($t,zt,G)),R(Wt,zt))}function K(){st.keys=function(){var e,t=Object.keys(st.keys).sort().reverse(),n={};for(e=0,len=t.length;len>e;++e)n[t[e]]=st.keys[t[e]];return n}(),q(1)}function S(e){X(),f("change",[e,t])}function Z(e){function n(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var o,r,u,c,a=e.TE.key,s=st.keys,f=TE.keys_alt;Vt[a()]=1,m(function(){t.record()},1);for(o in s){var d=0;u=n(o);for(r in u)r=u[r],Vt[f[r]||r]&&++d;u=u.length,d===u&&Object.keys(Vt).length===u&&(i(s[o])&&(s[o]=st.tools[s[o]].click),c=s[o](e,t),c===!1&&l(e))}}function q(e){u(e)?delete Vt[e.TE.key()]:Vt={}}function F(e){/^focus|blur$/.test(e.type)&&q(1),b(en),en=m(S,1e3)}function G(e){var n=this.getAttribute("data-tool-id"),o=st.tools;return Qt=e.currentTarget||e.target,o[n]&&o[n].click&&o[n].active?(o[n].click(e,t,n),f("change",[e,t,n])):t.select(),l(e)}function J(){st.exit(1)}function Q(e){var t=Qt,n=e&&e.target||0;(!n||n!==t&&L(n,t)!==t)&&(Qt=0,W(St),y($t,lt,Q),st.exit(1))}function V(){e=N(Kt),rn=e.w,un=e.h,e=N(Bt),cn=e.w,an=e.h}function et(){g($t,[],Bt)}function tt(t){tn=t.target,e=$(Kt,t),nn=e.x,on=e.y,V()}function nt(t){var n,o,r=sn.header,i=sn.resize;(tn===r||L(tn,r)===r)&&(e=$(Rt,t),n=e.x-nn,o=e.y-on,z(Kt,{left:k(n,0,cn-rn)+"px",top:k(o,0,an-un)+"px"})),(tn===i||L(tn,i)===i)&&(e=$(Kt,t),z(Kt,{width:e.x+"px",height:e.y+"px"}))}function ot(){tn=0}function rt(e,t,n){return{header:e,body:t,footer:n}}var it="\u2318",ut="\u2026",ct=window,at=document,st=this,ft=at.documentElement,lt=(at.head,at.body),dt={},pt=t.target,vt=function(){},ht=t._.extend,yt=ht({tab:"  ",dir:"ltr",keys:1,tools:"undo redo",css:"html,body{background:#fff;color:#000}",languages:{tools:{undo:"Undo ("+it+"+Z)",redo:"Redo ("+it+"+Y)"},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},others:{placeholder:"text here"+ut,preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{editor:"text-editor",i:"fa fa-%1"}},e),gt="keydown",mt="keyup",bt="copy",wt="cut",kt="paste",xt="mousedown touchstart",Tt="mouseup touchend",Et="mousemove touchmove",$t="click",Ct="focus",Nt="blur",Lt="input",_t=Nt+" "+bt+" "+wt+" "+Ct+" "+Lt+" "+gt+" "+kt,jt=yt.languages;t.gap=function(e,n){var r=t.$(),i=r.before.length?e:"",u=r.after.length?o(n)?n:e:"";return t.trim(i,u)},t.format=function(e,n,r,i){o(r)||(r=" "),o(i)||(i="");var u=t[0]().$(),c="<"+e+">"+i,a=i+"</"+e.split(" ")[0]+">",s=t._.x(c),f=t._.x(a),l=E("^"+s+"([\\s\\S]*?)"+f+"$"),d=E(s+"$"),p=E("^"+f),v=r,h=r,y=u.before,g=u.after;return/<[^\/<>]+?>$/.test(y)&&(v=""),/^<\/[^<>]+?>/.test(g)&&(h=""),u.length||t.insert(Yt.placeholder),t.toggle(n?!l.test(u.value):!d.test(y)&&!p.test(g),[function(e){e.unwrap(c,a,1).gap(v,h).wrap(c,a,n)[1]()},function(e){e.unwrap(c,a,n)[1]()}])};var zt,Ot=yt.classes,At=Ot.editor,Ht=(jt.tools,jt.buttons),Yt=jt.others,Mt=At+"-textarea "+At+"-content",Dt=I(At),Pt=I(At+"-header"),Rt=I(At+"-body"),Ut=I(At+"-footer"),Wt=I(At+"-tool"),It=pt,Xt=I(At+"-description"),Bt=I(At+"-overlay"),Kt=j("div"),St=j("div"),Zt=j("div"),qt=I("left","span"),Ft=I("right","span"),Gt=I(At+"-preview","span"),Jt=0,Qt=0;h($t,Gt,function(e){var n=t.get();if(!D(Bt)&&n.length){-1===n.indexOf("</html>")&&(n='<!DOCTYPE html><html dir="'+yt.dir+'"><head><meta charset="utf-8"><style>'+yt.css+"</style></head><body>"+n+"</body></html>");var o=j("iframe",!1,{"class":At+"-portal",src:"data:text/html,"+encodeURIComponent(n)});st.overlay(o,1,function(){f("on:preview",[n,Bt.firstChild])})}else J();return l(e)});var Vt={},en=null;t.create=function(e,n){u(e)&&(yt=ht(yt,e)),A(It,Mt);var o=D(It);return o&&"p"===o.tagName.toLowerCase()?(P(o,Dt),Jt=o,U(o,!1)):P(It,Dt),Dt.dir=yt.dir,R(Dt,Pt),R(Dt,Rt),R(Dt,Ut),R(Rt,It),yt.tools&&(R(Pt,Wt),R(Ut,Xt),R(Xt,qt),R(Xt,Ft)),yt.keys&&(h(gt,It,Z),h(mt,It,q)),h(_t,It,F),R(qt,Gt),Y(Gt,Yt.preview),S(),B(),K(),0!==n?f("create",[t]):t},t.update=function(e,n){return O(It,Mt)&&t.destroy(0),(0!==n?f("update",[t]):t).create(e,0)},t.destroy=function(e){return O(It,Mt)?(H(It,Mt),yt.tools=yt.tools.join(" "),yt.keys&&(y(gt,It,Z),y(mt,It,q)),y(_t,It,F),Jt?(P(Dt,Jt),R(Jt,It),Jt=0):P(Dt,It),W(Dt),0!==e?f("destroy",[t]):t):t},st.tool=function(e,n,o){return yt.tools=yt.tools.filter(function(t){return t!==e}),n===!1?delete st.tools[e]:(st.tools[e]=ht(st.tools[e]||{},n),c(o)?yt.tools.splice(o,0,e):yt.tools.push(e)),B(),t},st.key=function(e,n){return n===!1?delete st.keys[e]:st.keys[e]=n,K(),t};var e,tn=0,nn=0,on=0,rn=0,un=0,cn=0,an=0,sn={};st.exit=function(e,n){var o,r={overlay:function(){y($t,Bt,J),W(Bt)},modal:function(){y(xt,Rt,tt),y(Et,Rt,nt),y(Tt,lt,ot),y($t,sn.x,et),W(Kt)},drop:function(){W(St)},bubble:function(){W(Zt)}};if(n)if(u(n))for(o in n)r[n[o]]&&r[n[o]]();else r[n]&&r[n]();else for(o in r)r[o]();return e&&t.select(),t},st.overlay=function(e,o,i){return q(1),R(Rt,j(Bt,e.length||n(e)?I(At+"-overlay-content","div",e):"")),o&&h($t,Bt,J),r(i)&&i(Bt),t},st.modal=function(){st.exit();var e,n=arguments,i=n[0],c=n[1],a=n[2],s=At+"-modal";u(i)&&(i="default",c=n[0],a=n[1]),j(Kt,!1,{"class":At+"-modal "+i}),o(c.body)&&(c.body=j("div",c.body,{"class":s+"-content "+i}));for(e in c)s[1]=e,sn[e]=I(s+"-"+x(e,s)+" "+i,0,c[e]);sn.x=I(s+"-x "+i),sn.resize=I(s+"-resize "+i),M(Kt),R(Rt,j(Kt,sn,{style:""})),st.overlay("",1),V();var f=an/2-un/2,d=cn/2-rn/2;return z(Kt,{top:f+"px",left:d+"px"}),h($t,sn.x,et),h(xt,sn.header,l),h(xt,sn.resize,l),h(xt,Rt,tt),h(Et,Rt,nt),h(Tt,lt,ot),r(a)&&(sn.overlay=Bt,sn.modal=Kt,a(sn)),t};var fn={"class":At+"-button"};return st.alert=function(e,t){var n=j("button",Ht.okay,fn);return h($t,n,et),h(gt,n,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(et(),l(e)):void 0}),m(function(){n.focus()},1),st.modal("alert",rt(e,t,n))},st.confirm=function(e,n,o,i){function u(e){return r(o)&&o(e,t),et(),l(e)}function c(e){return r(i)&&i(e,t),et(),l(e)}var a,s=j("button",Ht.okay,fn),f=j("button",Ht.cancel,fn);return h($t,s,u),h($t,f,c),h(gt,s,function(e){return a=e.TE.key,a("arrowright")?(f.focus(),l(e)):a("arrowleft")?l(e):a("enter")?(u(e),l(e)):a("escape")?(et(),l(e)):void 0}),h(gt,f,function(e){return a=e.TE.key,a(/^escape|arrowright$/)?l(e):a("arrowleft")?(s.focus(),l(e)):a("enter")?(c(e),l(e)):a("escape")?(et(),l(e)):void 0}),m(function(){f.focus()},1),st.modal("confirm",rt(e,n,[s,f]))},st.prompt=function(e,n,o,r){function i(){p.focus(),p.select()}function u(e){return!o||w(p.value).length&&p.value!==n?(c(e),r(e,t,p.value)):(i(),a(e))}function c(e){return et(),l(e)}function a(e){return l(e)}var s,f=j("button",Ht.okay,fn),d=j("button",Ht.cancel,fn),p=j("input",!1,{type:"text",value:n,placeholder:n,"class":At+"-input block"});return r=r||vt,h(gt,p,function(e){return s=e.TE.key,s("enter")?u(e):s("escape")?c(e):s("arrowup")?a(e):s("arrowdown")?(f.focus(),l(e)):void 0}),h(gt,f,function(e){return s=e.TE.key,s("enter")?u(e):s("escape")?c(e):s("arrowup")?(p.focus(),l(e)):s("arrowright")?(d.focus(),l(e)):s(/arrow(down|left)/)?a(e):void 0}),h(gt,d,function(e){return s=e.TE.key,s(/^enter|escape$/)?c(e):s("arrowup")?(p.focus(),l(e)):s(/arrow(right|down)/)?a(e):s("arrowleft")?(f.focus(),l(e)):void 0}),h($t,f,u),h($t,d,c),m(i,.4),st.modal("prompt",rt(e,p,[f,d]))},st.drop=function(e,n){st.exit(),R(lt,j(St,!1,{"class":At+"-drop "+e})),r(n)&&n(St);var o,i=N(ft),u=N(St),c=i.w/2-u.w/2,a=i.h/2-u.h/2;return Qt&&(o=C(Qt),c=o.l,a=o.t+N(Qt).h),c+u.w>i.w&&(c=i.w-u.w),a+u.h>i.h&&(a=i.h-u.h),z(St,{left:c+"px",top:a+"px"}),h($t,lt,Q),t},st.bubble=function(e,n){return st.exit(),R(lt,j(Zt,!1,{"class":At+"-bubble "+e})),r(n)&&n(Zt),t},st.tools={"|":1,undo:{i:"undo",click:function(){return t.undo(),!1}},redo:{i:"repeat",click:function(){return t.redo(),!1}}},st.keys={"control+y":"redo","control+z":"undo"},st.parent=t,st.dom={container:Dt,header:Pt,body:Rt,footer:Ut,overlay:Bt,modal:Kt,drop:St,bubble:Zt},t.config=yt,t.ui=st,ht(t._,{format:x,el:j,event:{set:h,reset:y,fire:g},hooks:dt,hook:{set:a,reset:s,fire:f}}),t.create(),st};TE.prototype.create=function(e){return new TE_ui(e,this)};