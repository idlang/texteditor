/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 0.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
var TE_ui=function(e,t){function n(e){return e instanceof HTMLElement}function r(e){return void 0!==e}function o(e){return"function"==typeof e}function i(e){return"string"==typeof e}function u(e){return"object"==typeof e}function l(e){return"number"==typeof e}function a(e,n,o){return r(e)?r(n)?(r(at[e])||(at[e]={}),r(o)||(o=Object.keys(at[e]).length),at[e][o]=n,t):at[e]:at}function c(e,n){return r(e)?r(n)&&r(at[e])?(delete at[e][n],t):(at[e]={},t):(at={},t)}function s(e,n,o){if(!r(at[e]))return t;if(r(o))r(at[e][o])&&at[e][o].apply(t,n);else for(var i in at[e])at[e][i].apply(t,n);return t}function f(e){return e&&e.preventDefault(),!1}function p(e,t,n){t.addEventListener(e,n,!1),a("on:"+e,n,N(t))}function d(e,t,n){t.removeEventListener(e,n,!1),c("on:"+e,N(t))}function g(e,t,n){s("on:"+e,t,N(n))}function h(e,t,n){e=k(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)p(e[r],t,n)}function v(e,t,n){e=k(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)d(e[r],t,n)}function m(e,t,n){e=k(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)g(e[r],t,n)}function y(e,t){ot.setTimeout(e,t)}function b(e){ot.clearTimeout(e)}function k(e){return e.replace(/^\s*|\s*$/g,"")}function w(e,t,n){return t>e?t:e>n?n:e}function $(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,r(t[n])?t[n]:e})}function x(e){return k(e.toLowerCase().replace(/[^ \/a-z\d-]/g,"-").replace(/([ -])+/g,"$1").replace(/^-|-$/g,""))}function T(e,t){return RegExp(e,t)}function E(e,t){for(var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,o=_(e).l,i=_(e).t;e=e.offsetParent;)o+=_(e).l,i+=_(e).t;return{x:n-o,y:r-i}}function _(e){return{l:e.offsetLeft,t:e.offsetTop}}function L(e){return{w:e.offsetWidth,h:e.offsetHeight}}function C(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function N(e){var t=e.id;return t||(t=Nt+"-dom:"+(new Date).getTime(),e.id=t),t}function j(e,t,l){if(e=i(e)?it.createElement(e):e,u(l)){var a,c;for(c in l)a=l[c],"style"===c?i(a)?e.setAttribute(c,a):null===a?e.removeAttribute(c):e=z(e,a):o(a)?e[c]=a:null===a?e.removeAttribute(c):e.setAttribute(c,u(a)?a.join(" "):""+a)}if(n(t))e.appendChild(t);else if(u(t)){var a,c;for(c in t)a=t[c],n(a)?e.appendChild(a):a!==!1&&(e.innerHTML=a)}else r(t)&&t!==!1&&(e.innerHTML=t);return e}function z(e,t){e=j(e);for(var n in t)e.style[n.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})]=t[n];return e}function A(e,t){return T("(^|\\s)"+t+"(\\s|$)").test(e.className)}function H(e,t){A(e,t)||(e.className=k(e.className+" "+t))}function q(e,t){e.className=k(e.className.replace(T("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function O(e,t){e.innerHTML=t}function S(e,t){if(t!==!1){var n,r=e.children;for(n in r)S(r[n])}O(e,"")}function R(e,t){return 1===arguments.length?e.parentNode||!1:e&&t.parentNode===e?t.parentNode:!1}function M(e,t){e.parentNode.insertBefore(t,e)}function U(e,t){e.appendChild(t)}function Y(e,t){var n=R(e);if(n){if(t!==!1)for(var r=e.firstChild;r;)Y(r);n.removeChild(e)}}function B(e){S(j(e,!1,{style:""})),Y(e)}function W(e,t,n){return j(t||"div",n,{"class":e})}function I(){var e=(Ut.value||"").replace(/<[^<>]+?>/g,""),t=(e.match(/(\w+)/g)||[]).length;O(Xt,$(At["_word"+(1===t?"":"s")],[t]))}function P(e){I(),s("change",[e,t])}function D(e){function n(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var r,o,u,l,a=e.TE.key,c=ut.keys,s=TE.keys_alt;Zt[a()]=1,y(function(){t.record()},1);for(r in c){var p=0;u=n(r);for(o in u)o=u[o],Zt[s[o]||o]&&++p;p===u.length&&(i(c[r])&&(c[r]=ut.tools[c[r]].click),l=c[r](e,t),l===!1&&f(e))}}function X(e){u(e)?Zt[e.TE.key()]=0:Zt={}}function K(e){/^focus|blur$/.test(e.type)&&X(1),b(Ft),Ft=y(P,1e3)}function Q(e){var n=this.hash.replace("#","");return ut.tools[n]&&ut.tools[n].click?(ut.tools[n].click(e,t,n),s("change",[e,t,n]),f(e)):void 0}function Z(){B(Bt),d(wt,Bt,Z),t.select()}function F(){e=L(Wt),en=e.w,tn=e.h,e=L(Bt),nn=e.w,rn=e.h}function G(){g(wt,[],Bt)}function J(t){Gt=t.target,e=E(Wt,t),Jt=e.x,Vt=e.y,F()}function V(t){var n,r,o=on.header,i=on.resize;(Gt===o||C(Gt,o)===o)&&(e=E(St,t),n=e.x-Jt,r=e.y-Vt,z(Wt,{left:w(n,0,nn-en)+"px",top:w(r,0,rn-tn)+"px"})),(Gt===i||C(Gt,i)===i)&&(e=E(Wt,t),z(Wt,{width:e.x+"px",height:e.y+"px"}))}function et(){Gt=0}function tt(e,t,n){return{header:e,body:t,footer:n}}var nt="\u2318",rt="\u2026",ot=window,it=document,ut=this,lt=(it.documentElement,it.head,it.body),at={},ct=t.target,st=function(){},ft=t._.extend,pt=ft({keys:1,tools:"undo redo",languages:{tools:{undo:"Undo ("+nt+"+Z)",redo:"Redo ("+nt+"+Y)"},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},others:{placeholder:"text here"+rt,preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{editor:"text-editor",i:"fa fa-%1"},tab:"  "},e),dt="keydown",gt="keyup",ht="copy",vt="cut",mt="paste",yt="mousedown",bt="mouseup",kt="mousemove",wt="click",$t="focus",xt="blur",Tt="input",Et=xt+" "+ht+" "+vt+" "+$t+" "+Tt+" "+dt+" "+mt,_t=pt.languages;t.gap=function(e,n){var o=t.$(),i=o.before.length?e:"",u=o.after.length?r(n)?n:e:"";return t.trim(i,u)},t.format=function(e,n,o,i){r(o)||(o=" "),r(i)||(i="");var u=t[0]().$(),l="<"+e+">"+i,a=i+"</"+e.split(" ")[0]+">",c=t._.esc(l),s=t._.esc(a),f=T("^"+c+"([\\s\\S]*?)"+s+"$"),p=T(c+"$"),d=T("^"+s),g=o,h=o,v=u.before,m=u.after;return/<[^\/<>]+?>$/.test(v)&&(g=""),/^<\/[^<>]+?>/.test(m)&&(h=""),u.length||t.insert(At.placeholder),t.toggle(n?!f.test(u.value):!p.test(v)&&!d.test(m),[function(e){e.unwrap(l,a,1).gap(g,h).wrap(l,a,n)[1]()},function(e){e.unwrap(l,a,n)[1]()}])};var Lt,Ct=pt.classes,Nt=Ct.editor,jt=_t.tools,zt=_t.buttons,At=_t.others,Ht=Nt+"-textarea "+Nt+"-content",qt=W(Nt),Ot=W(Nt+"-header"),St=W(Nt+"-body"),Rt=W(Nt+"-footer"),Mt=W(Nt+"-tool"),Ut=ct,Yt=W(Nt+"-description"),Bt=W(Nt+"-overlay"),Wt=W(Nt+"-modal"),It=W(Nt+"-drop"),Pt=W(Nt+"-bubble"),Dt=W("left","span"),Xt=W("right","span"),Kt=W(Nt+"-preview","span"),Qt=null;p(wt,Kt,function(e){var n=t.get();return!R(Bt)&&n.length?ut.overlay(n,0,function(){p(wt,Bt,Z),s("on:preview",[n,Bt.firstChild])}):Z(),f(e)});var Zt={},Ft=null;t.create=function(e,n){u(e)&&(pt=ft(pt,e)),H(Ut,Ht);var r,l,a,c,f,d,g=i(pt.tools)?k(pt.tools).split(/\s+/):pt.tools,v=R(Ut),m=Nt+"-button",y=Nt+"-separator";if(pt.tools=g,v&&"p"===v.tagName.toLowerCase()?(M(v,qt),Qt=v,Y(v,!1)):M(Ut,qt),U(qt,Ot),U(qt,St),U(qt,Rt),U(St,Ut),pt.tools&&(U(Ot,Mt),U(Rt,Yt),U(Yt,Dt),U(Yt,Xt)),pt.tools)for(f in g){if(d=g[f],!ut.tools[d])return!0;l=ut.tools[d],o(l)&&(ut.tools[d].click=l),"|"!==(a=l.i||d)&&(a=x(a)),c="|"!==a,Lt=W(c?m:y,c?"a":"span"),c&&(r=m+":"+d,Lt.href="#"+d,Lt.id=r,a='<i class="'+$(Ct.i,[a])+" "+r+'"></i>',l.text&&(a=$(l.text,[a])),O(Lt,a),l.title&&(Lt.title=l.title),u(l.attributes)&&j(Lt,!1,l.attributes),p(wt,Lt,Q)),U(Mt,Lt)}return pt.keys&&(ut.keys=function(){var e,t=Object.keys(ut.keys).sort().reverse(),n={};for(e=0,len=t.length;len>e;++e)n[t[e]]=ut.keys[t[e]];return n}(),p(dt,Ut,D),p(gt,Ut,X)),h(Et,Ut,K),U(Dt,Kt),O(Kt,At.preview),P(),0!==n?s("create",[t]):t},t.update=function(e,n){return A(Ut,Ht)&&t.destroy(0),(0!==n?s("update",[t]):t).create(e,0)},t.destroy=function(e){return A(Ut,Ht)?(q(Ut,Ht),pt.tools=pt.tools.join(" "),pt.keys&&(d(dt,Ut,D),d(gt,Ut,X)),v(Et,Ut,K),Qt?(M(qt,Qt),U(Qt,Ut),Qt=null):M(qt,Ut),B(qt),0!==e?s("destroy",[t]):t):t},ut.tool=function(e,n,r){return n===!1?(delete ut.tools[e],pt.tools=pt.tools.filter(function(t){return t!==e})):(ut.tools[e]=n,l(r)?pt.tools.splice(r,0,e):pt.tools.push(e)),t.update(0)},ut.key=function(e,n){return n===!1?delete ut.keys[e]:ut.keys[e]=n,t.update(0)};var e,Gt=0,Jt=0,Vt=0,en=0,tn=0,nn=0,rn=0,on={};ut.exit=function(e,n){var r,o={overlay:Z,modal:function(){d(yt,St,J),d(kt,St,V),d(bt,lt,et),d(wt,on.x,G),B(Wt)},drop:function(){B(It)},bubble:function(){B(Pt)}};if(n)if(u(n))for(r in n)o[n[r]]&&o[n[r]]();else o[n]&&o[n]();else for(r in o)o[r]();return e&&t.select(),t},ut.overlay=function(e,n,r){function i(){ut.exit(1),d(wt,Bt,i)}return X(1),U(St,j(Bt,e.length?W(Nt+"-overlay-content","div",e):"")),n&&p(wt,Bt,i),o(r)&&r(Bt),t},ut.modal=function(){var e,n=arguments,i=n[0],l=n[1],a=n[2],c=Nt+"-modal";u(i)&&(i="default",l=n[0],a=n[1]),H(Wt,i),r(l.body)&&(l.body=j("div",l.body,{"class":c+"-content "+i}));for(e in l)c[1]=e,on[e]=W(c+"-"+$(e,c)+" "+i,0,l[e]);on.x=W(c+"-x "+i),on.resize=W(c+"-resize "+i),S(Wt),U(St,j(Wt,on,{style:""})),ut.overlay("",1),F();var s=rn/2-tn/2,d=nn/2-en/2;return z(Wt,{top:s+"px",left:d+"px"}),p(wt,on.x,G),p(yt,on.header,f),p(yt,on.resize,f),p(yt,St,J),p(kt,St,V),p(bt,lt,et),o(a)&&(on.overlay=Bt,on.modal=Wt,a(on)),t};var un={"class":Nt+"-button"};return ut.alert=function(e,t){var n=j("button",zt.okay,un);return p(wt,n,G),p(dt,n,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(G(),f(e)):void 0}),y(function(){n.focus()},1),ut.modal("alert",tt(e,t,n))},ut.confirm=function(e,n,r,i){function u(e){return o(r)&&r(e,t),G(),f(e)}function l(e){return o(i)&&i(e,t),G(),f(e)}var a,c=j("button",zt.okay,un),s=j("button",zt.cancel,un);return p(wt,c,u),p(wt,s,l),p(dt,c,function(e){return a=e.TE.key,a("arrowright")?(s.focus(),f(e)):a("arrowleft")?f(e):a(/^escape|enter$/)?(u(e),f(e)):void 0}),p(dt,s,function(e){return a=e.TE.key,a("arrowright")?f(e):a("arrowleft")?(c.focus(),f(e)):a(/^escape|enter$/)?(l(e),f(e)):void 0}),y(function(){s.focus()},1),ut.modal("confirm",tt(e,n,[c,s]))},ut.prompt=function(e,n,r,o){function i(){g.focus(),g.select()}function u(e){return!r||k(g.value).length&&g.value!==n?(l(e),o(e,t,g.value)):(i(),a(e))}function l(e){return G(),f(e)}function a(e){return f(e)}var c,s=j("button",zt.okay,un),d=j("button",zt.cancel,un),g=j("input",!1,{type:"text",value:n,placeholder:n,"class":Nt+"-input block"});return o=o||st,p(dt,g,function(e){return c=e.TE.key,c("enter")?u(e):c("escape")?l(e):c("arrowup")?a(e):c("arrowdown")?(s.focus(),f(e)):void 0}),p(dt,s,function(e){return c=e.TE.key,c("enter")?u(e):c("escape")?l(e):c("arrowup")?(g.focus(),f(e)):c("arrowright")?(d.focus(),f(e)):c(/arrow(down|left)/)?a(e):void 0}),p(dt,d,function(e){return c=e.TE.key,c(/^enter|escape$/)?l(e):c("arrowup")?(g.focus(),f(e)):c(/arrow(right|down)/)?a(e):c("arrowleft")?(s.focus(),f(e)):void 0}),p(wt,s,u),p(wt,d,l),y(i,.4),ut.modal("prompt",tt(e,g,[s,d]))},ut.drop=function(e,n){return U(lt,j(It,e)),ut.overlay("",1),o(n)&&n(It),t},ut.bubble=function(e,n){return U(lt,j(Pt,e)),ut.overlay("",1),o(n)&&n(Pt),t},ut.tools={undo:{i:"undo",title:jt.undo,click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",title:jt.redo,click:function(e,t){return t.redo(),!1}},"|":1},ut.keys={"control+y":"redo","control+z":"undo"},ut.parent=t,ut.dom={container:qt,header:Ot,body:St,footer:Rt,overlay:Bt,modal:Wt,drop:It,bubble:Pt},t.config=pt,t.ui=ut,ft(t._,{format:$,el:j,event:{set:h,reset:v,fire:m},hooks:at,hook:{set:a,reset:c,fire:s}}),t.create(),ut};TE.prototype.create=function(e){return new TE_ui(e,this)};