/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 0.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
var TE_ui=function(e,t){function n(e){return e instanceof HTMLElement}function r(e){return void 0!==e}function o(e){return"function"==typeof e}function i(e){return"string"==typeof e}function u(e){return"object"==typeof e}function a(e,t,n){return r(e)?r(t)?(r(ut[e])||(ut[e]={}),r(n)||(n=Object.keys(ut[e]).length),ut[e][n]=t,ot):ut[e]:ut}function c(e,t){return r(e)?r(t)&&r(ut[e])?(delete ut[e][t],ot):(ut[e]={},ot):(ut={},ot)}function l(e,t,n){if(!r(ut[e]))return ot;if(r(n))r(ut[e][n])&&ut[e][n].apply(ot,t);else for(var o in ut[e])ut[e][o].apply(ot,t);return ot}function s(e){return e&&e.preventDefault(),!1}function f(e,t,n){t.addEventListener(e,n,!1),a("on:"+e,n,L(t))}function p(e,t,n){t.removeEventListener(e,n,!1),c("on:"+e,L(t))}function d(e,t,n){l("on:"+e,t,L(n))}function g(e,t,n){e=y(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)f(e[r],t,n)}function h(e,t,n){e=y(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)p(e[r],t,n)}function v(e,t,n){e=y(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)d(e[r],t,n)}function m(e,t){nt.setTimeout(e,t)}function b(e){nt.clearTimeout(e)}function y(e){return e.replace(/^\s*|\s*$/g,"")}function w(e,t,n){return t>e?t:e>n?n:e}function k(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,r(t[n])?t[n]:e})}function $(e){return y(e.toLowerCase().replace(/[^ \/a-z\d-]/g,"-").replace(/([ -])+/g,"$1").replace(/^-|-$/g,""))}function x(e,t){return RegExp(e,t)}function E(e,t){for(var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,o=T(e).l,i=T(e).t;e=e.offsetParent;)o+=T(e).l,i+=T(e).t;return{x:n-o,y:r-i}}function T(e){return{l:e.offsetLeft,t:e.offsetTop}}function C(e){return{w:e.offsetWidth,h:e.offsetHeight}}function _(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function L(e){var t=e.id;return t||(t=_t+"-dom:"+(new Date).getTime(),e.id=t),t}function S(e,t,a){return e=i(e)?rt.createElement(e):e,u(a)&&st(a,function(t,n){"style"===n?i(t)?e.setAttribute(n,t):null===t?e.removeAttribute(n):e=z(e,t):o(t)?e[n]=t:null===t?e.removeAttribute(n):e.setAttribute(n,u(t)?t.join(" "):""+t)}),n(t)?e.appendChild(t):u(t)?st(t,function(t){n(t)?e.appendChild(t):t!==!1&&(e.innerHTML=t)}):r(t)&&t!==!1&&(e.innerHTML=t),e}function z(e,t){return e=S(e),st(t,function(t,n){e.style[n.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})]=t}),e}function N(e,t){return x("(^|\\s)"+t+"(\\s|$)").test(e.className)}function j(e,t){N(e,t)||(e.className=y(e.className+" "+t))}function H(e,t){e.className=y(e.className.replace(x("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function M(e,t){e.innerHTML=t}function R(e,t){if(t!==!1){var n=e.children;st(n,function(e){R(e)})}M(e,"")}function q(e,t){return 1===arguments.length?e.parentNode||!1:e&&t.parentNode===e?t.parentNode:!1}function O(e,t){e.parentNode.insertBefore(t,e)}function K(e,t){e.appendChild(t)}function U(e,t){var n=q(e);if(n){if(t!==!1)for(var r=e.firstChild;r;)U(r);n.removeChild(e)}}function A(e){R(S(e,!1,{style:""})),U(e)}function Y(e,t,n){return S(t||"div",n,{"class":e})}function D(){var e=(Kt.value||"").replace(/<[^<>]+?>/g,"");M(Bt,k(Nt._words,[(e.match(/(\w+)/g)||[]).length]))}function W(e){D(),l("change",[e,ot])}function I(e){function n(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var r,o,u,a,c=e.TE.key,l=ot.keys,f=TE.keys_alt;Ft[c()]=1,m(function(){t.record()},1);for(r in l){var p=0;u=n(r);for(o in u)o=u[o],Ft[f[o]||o]&&++p;p===u.length&&(i(l[r])&&(l[r]=ot.tools[l[r]].click),a=l[r](e,t),a===!1&&s(e))}}function B(e){u(e)?Ft[e.TE.key()]=0:Ft={}}function P(){b(Qt),Qt=m(W,1e3)}function X(e){var n=this.hash.replace("#","");return ot.tools[n]&&ot.tools[n].click?(ot.tools[n].click(e,t,n),l("change",[e,ot,n]),s(e)):void 0}function F(){A(At),p(wt,At,F),t.select()}function Q(){e=C(Yt),Vt=e.w,en=e.h,e=C(At),tn=e.w,nn=e.h}function Z(){d(wt,[],At)}function G(t){Zt=t.target,e=E(Yt,t),Gt=e.x,Jt=e.y,Q()}function J(t){var n,r,o=rn.header,i=rn.resize;(Zt===o||_(Zt,o)===o)&&(e=E(Rt,t),n=e.x-Gt,r=e.y-Jt,z(Yt,{left:w(n,0,tn-Vt)+"px",top:w(r,0,nn-en)+"px"})),(Zt===i||_(Zt,i)===i)&&(e=E(Yt,t),z(Yt,{width:e.x+"px",height:e.y+"px"}))}function V(){Zt=0}function et(e,t,n){return{header:e,body:t,footer:n}}var tt="\u2318",nt=window,rt=document,ot=this,it=(rt.documentElement,rt.head,rt.body),ut={},at=t.target,ct=function(){},lt=t._.extend,st=t._.each,ft=lt({tools:"undo redo",languages:{tools:{undo:"Undo ("+tt+"+Z)",redo:"Redo ("+tt+"+Y)"},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},others:{preview:"Preview",_words:"%1 Words"}},classes:{editor:"text-editor",i:"fa fa-%1"},tab:"  "},e),pt="keydown",dt="keyup",gt="copy",ht="cut",vt="paste",mt="mousedown",bt="mouseup",yt="mousemove",wt="click",kt="focus",$t="blur",xt="input",Et=$t+" "+gt+" "+ht+" "+kt+" "+xt+" "+pt+" "+vt;t.gap=function(e,n){var o=t.$(),i=o.before.length?e:"",u=o.after.length?r(n)?n:e:"";return t.trim(i,u)},t.format=function(e,n,o,i){r(o)||(o=" "),r(i)||(i="");var u=t.$(),a="<"+e+">"+i,c=i+"</"+e.split(" ")[0]+">",l=t._.esc(a),s=t._.esc(c),f=x("^"+l+"([\\s\\S]*?)"+s+"$"),p=x(l+"$"),d=x("^"+s),g=o,h=o;return/<[^\/<>]+?>$/.test(u.before)&&(g=""),/^<\/[^<>]+?>/.test(u.after)&&(h=""),t.toggle(n?!f.test(u.value):!p.test(u.before)&&!d.test(u.after),[function(e){e[0]().unwrap(a,c,1).gap(g,h).wrap(a,c,n)[1]()},function(e){e[0]().unwrap(a,c,n).gap(g,h)[1]()}])};var Tt,Ct=ft.classes,_t=Ct.editor,Lt=ft.languages,St=Lt.tools,zt=Lt.buttons,Nt=Lt.others,jt=_t+"-textarea "+_t+"-content",Ht=Y(_t),Mt=Y(_t+"-header"),Rt=Y(_t+"-body"),qt=Y(_t+"-footer"),Ot=Y(_t+"-tool"),Kt=at,Ut=Y(_t+"-description"),At=Y(_t+"-overlay"),Yt=Y(_t+"-modal"),Dt=Y(_t+"-drop"),Wt=Y(_t+"-bubble"),It=Y("left","span"),Bt=Y("right","span"),Pt=Y(_t+"-preview","span"),Xt=null;f(wt,Pt,function(e){var n=t.get();return!q(At)&&n.length?ot.overlay(n,0,function(){f(wt,At,F),l("on:preview",[n,At.firstChild])}):F(),s(e)});var Ft={},Qt=null;t.create=function(e,n){u(e)&&(ft=lt(ft,e)),j(Kt,jt);var r,a,c,s,p=i(ft.tools)?y(ft.tools).split(/\s+/):ft.tools,d=q(Kt),h=_t+"-button",v=_t+"-separator";return ot.keys=function(){var e,t=Object.keys(ot.keys).sort().reverse(),n={};for(e=0,len=t.length;len>e;++e)n[t[e]]=ot.keys[t[e]];return n}(),d&&"p"===d.tagName.toLowerCase()?(O(d,Ht),Xt=d,U(d,!1)):O(Kt,Ht),K(Ht,Mt),K(Ht,Rt),K(Ht,qt),K(Mt,Ot),K(Rt,Kt),K(qt,Ut),K(Ut,It),K(Ut,Bt),st(p,function(e){return ot.tools[e]?(a=ot.tools[e],o(a)&&(ot.tools[e].click=a),"|"!==(c=a.i||e)&&(c=$(c)),s="|"!==c,Tt=Y(s?h:v,s?"a":"span"),s&&(r=h+":"+e,Tt.href="#"+e,Tt.id=r,M(Tt,'<i class="'+k(Ct.i,[c])+" "+r+'"></i>'),a.title&&(Tt.title=a.title),f(wt,Tt,X)),void K(Ot,Tt)):!0}),f(pt,Kt,I),f(dt,Kt,B),g(Et,Kt,P),K(It,Pt),M(Pt,Nt.preview),W(),null!==n?(l("create",[ot]),t):t},t.refresh=function(e){return N(Kt,jt)&&t.destroy(null),l("refresh",[ot]),t.create(e,null)},t.destroy=function(e){return N(Kt,jt)?(H(Kt,jt),h(Et,Kt,P),Xt?(O(Ht,Xt),K(Xt,Kt),Xt=null):O(Ht,Kt),A(Ht),null!==e?(l("destroy",[ot]),t):t):ot};var e,Zt=0,Gt=0,Jt=0,Vt=0,en=0,tn=0,nn=0,rn={};ot.exit=function(e,n){var r,o={overlay:F,modal:function(){p(mt,Rt,G),p(yt,Rt,J),p(bt,it,V),p(wt,rn.x,Z),A(Yt)},drop:function(){A(Dt)},bubble:function(){A(Wt)}};if(n)if(u(n))for(r in n)o[n[r]]&&o[n[r]]();else o[n]&&o[n]();else for(r in o)o[r]();e&&t.select()},ot.overlay=function(e,t,n){function r(){ot.exit(1),p(wt,At,r)}B(1),K(Rt,S(At,e.length?Y(_t+"-overlay-content","div",e):"")),t&&f(wt,At,r),o(n)&&n(At)},ot.modal=function(){var e,t=arguments,n=t[0],i=t[1],a=t[2],c=_t+"-modal";u(n)&&(n="default",i=t[0],a=t[1]),j(Yt,n),r(i.body)&&(i.body=S("div",i.body,{"class":c+"-content "+n}));for(e in i)c[1]=e,rn[e]=Y(c+"-"+k(e,c)+" "+n,0,i[e]);rn.x=Y(c+"-x "+n),rn.resize=Y(c+"-resize "+n),R(Yt),K(Rt,S(Yt,rn,{style:""})),ot.overlay("",1),Q();var l=nn/2-en/2,p=tn/2-Vt/2;return z(Yt,{top:l+"px",left:p+"px"}),f(wt,rn.x,Z),f(mt,rn.header,s),f(mt,rn.resize,s),f(mt,Rt,G),f(yt,Rt,J),f(bt,it,V),o(a)&&(rn.overlay=At,rn.modal=Yt,a(rn)),ot};var on={"class":_t+"-button"};return ot.alert=function(e,t){var n=S("button",zt.okay,on);return f(wt,n,Z),f(pt,n,function(e){var t=e.TE.key;return t(/^escape|enter$/)?(Z(),s(e)):void 0}),m(function(){n.focus()},1),ot.modal("alert",et(e,t,n))},ot.confirm=function(e,n,r,i){function u(e){return o(r)&&r(e,t),Z(),s(e)}function a(e){return o(i)&&i(e,t),Z(),s(e)}var c,l=S("button",zt.okay,on),p=S("button",zt.cancel,on);return f(wt,l,u),f(wt,p,a),f(pt,l,function(e){return c=e.TE.key,c("arrowright")?(p.focus(),s(e)):c("arrowleft")?s(e):c(/^escape|enter$/)?(u(e),s(e)):void 0}),f(pt,p,function(e){return c=e.TE.key,c("arrowright")?s(e):c("arrowleft")?(l.focus(),s(e)):c(/^escape|enter$/)?(a(e),s(e)):void 0}),m(function(){p.focus()},1),ot.modal("confirm",et(e,n,[l,p]))},ot.prompt=function(e,n,r,o){function i(){g.focus(),g.select()}function u(e){return!r||y(g.value).length&&g.value!==n?(a(e),o(e,t,g.value)):(i(),c(e))}function a(e){return Z(),s(e)}function c(e){return s(e)}var l,p=S("button",zt.okay,on),d=S("button",zt.cancel,on),g=S("input",!1,{type:"text",value:n,"class":_t+"-input block"});return o=o||ct,f(pt,g,function(e){return l=e.TE.key,l("enter")?u(e):l("escape")?a(e):l("arrowup")?c(e):l("arrowdown")?(p.focus(),s(e)):void 0}),f(pt,p,function(e){return l=e.TE.key,l("enter")?u(e):l("escape")?a(e):l("arrowup")?(g.focus(),s(e)):l("arrowright")?(d.focus(),s(e)):l(/arrow(down|left)/)?c(e):void 0}),f(pt,d,function(e){return l=e.TE.key,l(/^enter|escape$/)?a(e):l("arrowup")?(g.focus(),s(e)):l(/arrow(right|down)/)?c(e):l("arrowleft")?(p.focus(),s(e)):void 0}),f(wt,p,u),f(wt,d,a),m(i,1),ot.modal("prompt",et(e,g,[p,d]))},ot.drop=function(e,t){K(it,S(Dt,e)),ot.overlay("",1),o(t)&&t(Dt)},ot.bubble=function(e,t){K(it,S(Wt,e)),ot.overlay("",1),o(t)&&t(Wt)},ot.tools={undo:{i:"undo",title:St.undo,click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",title:St.redo,click:function(e,t){return t.redo(),!1}},"|":1},ot.keys={"control+y":"redo","control+z":"undo"},ot.parent=t,ot.dom={container:Ht,header:Mt,body:Rt,footer:qt,overlay:At,modal:Yt,drop:Dt,bubble:Wt},t.config=ft,t.ui=ot,lt(t._,{format:k,el:S,event:{set:g,reset:h,fire:v},hooks:ut,hook:{set:a,reset:c,fire:l}}),t.create(),ot};TE.prototype.create=function(e){return new TE_ui(e,this)};