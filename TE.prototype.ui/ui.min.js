/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 0.0.0
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
var TE_ui=function(e,t){function n(e){return e instanceof HTMLElement}function r(e){return void 0!==e}function o(e){return"function"==typeof e}function i(e){return"string"==typeof e}function u(e){return"object"==typeof e}function c(e){return"number"==typeof e}function a(e,n,o){return r(e)?r(n)?(r(ht[e])||(ht[e]={}),r(o)||(o=Object.keys(ht[e]).length),ht[e][o]=n,t):ht[e]:ht}function s(e,n){return r(e)?r(n)&&r(ht[e])?(delete ht[e][n],t):(ht[e]={},t):(ht={},t)}function f(e,n,o){if(!r(ht[e]))return t;if(r(o))r(ht[e][o])&&ht[e][o].apply(t,n);else for(var i in ht[e])ht[e][i].apply(t,n);return t}function l(e){return e&&e.preventDefault(),!1}function d(e,t,n){t&&(t.addEventListener(e,n,!1),a("on:"+e,n,L(t)))}function p(e,t,n){t&&(t.removeEventListener(e,n,!1),s("on:"+e,L(t)))}function v(e,t,n){f("on:"+e,t,L(n))}function h(e,t,n){e=w(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)d(e[r],t,n)}function y(e,t,n){e=w(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)p(e[r],t,n)}function g(e,t,n){e=w(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)v(e[r],t,n)}function b(e,t){ft.setTimeout(e,t)}function m(e){ft.clearTimeout(e)}function w(e){return e.replace(/^\s*|\s*$/g,"")}function x(e,t,n){return r(t)&&t>e?t:r(n)&&e>n?n:e}function k(e,t){return e.replace(/%(\d+)/g,function(e,n){return--n,r(t[n])?t[n]:e})}function T(e){return w(e.toLowerCase().replace(/[^ \/a-z\d-]/g,"-").replace(/([ -])+/g,"$1").replace(/^-|-$/g,""))}function E(e,t){return RegExp(e,t)}function $(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,o=C(e);return{x:n-o.l,y:r-o.t}}function C(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{l:t,t:n}}function N(e){return{w:e.offsetWidth,h:e.offsetHeight}}function _(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function L(e){var t=e.id;return t||(t=Mt+"-dom:"+(new Date).getTime(),e.id=t),t}function z(e,t,c){if(e=i(e)?lt.createElement(e):e,u(c)){var a,s;for(s in c)a=c[s],"style"===s?i(a)?e.setAttribute(s,a):null===a?e.removeAttribute(s):e=j(e,a):o(a)?e[s]=a:null===a?e.removeAttribute(s):e.setAttribute(s,u(a)?a.join(" "):""+a)}if(n(t))e.appendChild(t);else if(u(t)){var a,s;for(s in t)a=t[s],n(a)?e.appendChild(a):a!==!1&&(e.innerHTML=a)}else r(t)&&t!==!1&&(e.innerHTML=t);return e}function j(e,t){e=z(e);for(var n in t)e.style[n.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})]=t[n];return e}function O(e,t){return E("(^|\\s)"+t+"(\\s|$)").test(e.className)}function A(e,t){O(e,t)||(e.className=w(e.className+" "+t))}function H(e,t){e.className=w(e.className.replace(E("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function Y(e,t){e.innerHTML=t}function M(e,t){if(t!==!1){var n,r=e.children;for(n in r)M(r[n])}Y(e,"")}function D(e,t){return 1===arguments.length?e.parentNode||!1:e&&t.parentNode===e?t.parentNode:!1}function I(e,t){e.parentNode.insertBefore(t,e)}function P(e,t){e.appendChild(t)}function R(e,t){var n=D(e);if(n){if(t!==!1)for(var r=e.firstChild;r;)R(r);n.removeChild(e)}}function U(e){M(z(e,!1,{style:""})),R(e)}function W(e,t,n){return z(t||"div",n,{"class":e})}function X(){var e=(Kt.value||"").replace(/<[^<>]+?>/g,""),t=(e.match(/(\w+)/g)||[]).length;Y(Vt,k(It["_word"+(1===t?"":"s")],[t]))}function B(){M(Bt,!1);var e,t,n,c,a,s,f=i(mt.tools)?w(mt.tools).split(/\s+/):mt.tools,l=Mt+"-button",d=Mt+"-separator";mt.tools=f;for(a in f)s=f[a],dt.tools[s]&&(t=dt.tools[s],o(t)&&(dt.tools[s].click=t),"|"!==(n=t.i||s)&&(n=T(n)),c="|"!==n,Ht=W(c?l:d,c?"a":"span"),c&&(e=l+":"+T(s).replace(/\s/g,""),Ht.href="javascript:;",Ht.id=e,Ht.setAttribute("data-tool-id",s),n='<i class="'+k(Yt.i,[n])+" "+e+'"></i>',r(t.active)?t.active||A(Ht,"x"):t.active=1,t.text&&(n=k(t.text,[n])),Y(Ht,n),t.title&&(Ht.title=t.title),u(t.attributes)&&z(Ht,!1,t.attributes),h(_t,Ht,G)),P(Bt,Ht))}function K(){dt.keys=function(){var e,t=Object.keys(dt.keys).sort().reverse(),n={};for(e=0,len=t.length;len>e;++e)n[t[e]]=dt.keys[t[e]];return n}(),q(1)}function S(e){X(),f("change",[e,t])}function Z(e){function n(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var r,o,u,c,a=e.TE.key,s=dt.keys,f=TE.keys_alt;rn[a()]=1,b(function(){t.record()},1);for(r in s){var d=0;u=n(r);for(o in u)o=u[o],rn[f[o]||o]&&++d;u=u.length,d===u&&Object.keys(rn).length===u&&(i(s[r])&&(s[r]=dt.tools[s[r]].click),c=s[r](e,t),c===!1&&l(e))}}function q(e){u(e)?delete rn[e.TE.key()]:rn={}}function F(e){/^focus|blur$/.test(e.type)&&q(1),m(on),on=b(S,1e3)}function G(e){var n=this.getAttribute("data-tool-id"),r=dt.tools;return nn=e.currentTarget||e.target,r[n]&&r[n].click&&r[n].active?(r[n].click(e,t,n),f("change",[e,t,n])):t.select(),l(e)}function J(e){return cn=St,un=N(Xt),l(e)}function Q(e){cn===St&&j(Kt,{height:$(Wt,e).y-un.h+"px"})}function V(){cn=0}function et(){dt.exit(1)}function tt(){e=N(Ft),fn=e.w,ln=e.h,e=N(qt),dn=e.w,pn=e.h}function nt(){g(_t,[],qt)}function rt(t){cn=t.target,e=$(Ft,t),an=e.x,sn=e.y,tt()}function ot(t){var n,r,o=vn.header,i=vn.resize;cn===o||_(cn,o)===o?(e=$(Wt,t),n=e.x-an,r=e.y-sn,j(Ft,{left:(fn>dn?n:x(n,0,dn-fn))+"px",top:(ln>pn?r:x(r,0,pn-ln))+"px"})):cn===i&&(e=$(Ft,t),j(Ft,{width:e.x+"px",height:e.y+"px"}))}function it(){cn=0}function ut(e,t,n){return{header:e,body:t,footer:n}}function ct(e){var t=nn,n=e&&e.target||0;(!n||n!==t&&_(n,t)!==t)&&(nn=0,U(Gt),y(_t,vt,ct),dt.exit(1))}var at="\u2318",st="\u2026",ft=window,lt=document,dt=this,pt=lt.documentElement,vt=(lt.head,lt.body),ht={},yt=t.target,gt=function(){},bt=t._.extend,mt=bt({tab:"  ",dir:"ltr",keys:1,tools:"undo redo",css:"html,body{background:#fff;color:#000}",languages:{tools:{undo:"Undo ("+at+"+Z)",redo:"Redo ("+at+"+Y)"},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},others:{placeholder:"text here"+st,preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{editor:"text-editor",i:"fa fa-%1"}},e),wt="keydown",xt="keyup",kt="copy",Tt="cut",Et="paste",$t="mousedown touchstart",Ct="mouseup touchend",Nt="mousemove touchmove",_t="click",Lt="focus",zt="blur",jt="input",Ot=zt+" "+kt+" "+Tt+" "+Lt+" "+jt+" "+wt+" "+Et,At=mt.languages;t.gap=function(e,n){var o=t.$(),i=o.before.length?e:"",u=o.after.length?r(n)?n:e:"";return t.trim(i,u)},t.format=function(e,n,o,i){r(o)||(o=" "),r(i)||(i="");var u=t[0]().$(),c="<"+e+">"+i,a=i+"</"+e.split(" ")[0]+">",s=t._.x(c),f=t._.x(a),l=E("^"+s+"([\\s\\S]*?)"+f+"$"),d=E(s+"$"),p=E("^"+f),v=o,h=o,y=u.before,g=u.after;return/<[^\/<>]+?>$/.test(y)&&(v=""),/^<\/[^<>]+?>/.test(g)&&(h=""),u.length||t.insert(It.placeholder),t.toggle(n?!l.test(u.value):!d.test(y)&&!p.test(g),[function(e){e.unwrap(c,a,1).gap(v,h).wrap(c,a,n)[1]()},function(e){e.unwrap(c,a,n)[1]()}])};var Ht,Yt=mt.classes,Mt=Yt.editor,Dt=(At.tools,At.buttons),It=At.others,Pt=Mt+"-textarea "+Mt+"-content",Rt=W(Mt),Ut=W(Mt+"-header"),Wt=W(Mt+"-body"),Xt=W(Mt+"-footer"),Bt=W(Mt+"-tool"),Kt=yt,St=W(Mt+"-resize s"),Zt=W(Mt+"-description"),qt=W(Mt+"-overlay"),Ft=z("div"),Gt=z("div"),Jt=z("div"),Qt=W("left","span"),Vt=W("right","span"),en=W(Mt+"-preview","span"),tn=0,nn=0;h(_t,en,function(e){var n=t.get();if(!D(qt)&&n.length){-1===n.indexOf("</html>")&&(n='<!DOCTYPE html><html dir="'+mt.dir+'"><head><meta charset="utf-8"><style>'+mt.css+"</style></head><body>"+n+"</body></html>");var r=z("iframe",!1,{"class":Mt+"-portal",src:"data:text/html,"+encodeURIComponent(n)});dt.overlay(r,1,function(){f("on:preview",[n,qt.firstChild])})}else et();return l(e)});var rn={},on=null;t.create=function(e,n){u(e)&&(mt=bt(mt,e)),A(Kt,Pt);var r=D(Kt);return r&&"p"===r.tagName.toLowerCase()?(I(r,Rt),tn=r,R(r,!1)):I(Kt,Rt),Rt.dir=mt.dir,P(Rt,Ut),P(Rt,Wt),P(Rt,Xt),P(Rt,St),P(Wt,Kt),mt.tools&&(P(Ut,Bt),P(Xt,Zt),P(Zt,Qt),P(Zt,Vt)),mt.keys&&(h(wt,Kt,Z),h(xt,Kt,q)),h(Ot,Kt,F),h($t,St,J),h(Nt,vt,Q),h(Ct,vt,V),P(Qt,en),Y(en,It.preview),S(),B(),K(),0!==n?f("create",[t]):t},t.update=function(e,n){return O(Kt,Pt)&&t.destroy(0),(0!==n?f("update",[t]):t).create(e,0)},t.destroy=function(e){return O(Kt,Pt)?(dt.exit(),H(Kt,Pt),mt.tools=mt.tools.join(" "),mt.keys&&(y(wt,Kt,Z),y(xt,Kt,q)),y($t,St,J),y(Nt,vt,Q),y(Ct,vt,V),y(Ot,Kt,F),tn?(I(Rt,tn),P(tn,Kt),tn=0):I(Rt,Kt),U(Rt),0!==e?f("destroy",[t]):t):t};var e,un,cn=0,an=0,sn=0,fn=0,ln=0,dn=0,pn=0,vn={};dt.exit=function(e,n){var r,o={overlay:function(){y(_t,qt,et),U(qt)},modal:function(){y($t,Wt,rt),y(Nt,Wt,ot),y(Ct,vt,it),y(_t,vn.x,nt),U(Ft)},drop:function(){U(Gt)},bubble:function(){U(Jt)}};if(n)if(u(n))for(r in n)o[n[r]]&&o[n[r]]();else o[n]&&o[n]();else for(r in o)o[r]();return e&&t.select(),t},dt.overlay=function(e,r,i){return dt.exit(0,"bubble"),q(1),P(Wt,z(qt,e.length||n(e)?W(Mt+"-overlay-content","div",e):"")),r&&h(_t,qt,et),o(i)?i(qt):z(qt,i),t},dt.modal=function(){dt.exit();var e,n=arguments,i=n[0],c=n[1],a=n[2],s=Mt+"-modal";u(i)&&(i="default",c=n[0],a=n[1]),z(Ft,!1,{"class":s+" "+i}),r(c.body)&&(c.body=z("div",c.body,{"class":s+"-content "+i}));for(e in c)s[1]=e,vn[e]=W(s+"-"+k(e,s)+" "+i,0,c[e]);vn.x=W(Mt+"-x "+i),vn.resize=W(Mt+"-resize se "+i),M(Ft),P(Wt,z(Ft,vn,{style:""})),dt.overlay("",1),tt();var f=pn/2-ln/2,d=dn/2-fn/2;return j(Ft,{top:f+"px",left:d+"px"}),h(_t,vn.x,nt),h($t,vn.header,l),h($t,vn.resize,l),h($t,Wt,rt),h(Nt,Wt,ot),h(Ct,vt,it),o(a)&&(vn.overlay=qt,vn.modal=Ft,a(vn)),t};var hn={"class":Mt+"-button"};return dt.alert=function(e,n,r,o){var i=z("button",Dt.okay,hn);return r=r||gt,h(_t,i,function(e){return r(e,t),nt(),l(e)}),h(wt,i,function(e){var n=e.TE.key;return n(/^escape|enter$/)?g(_t,[e,t],i):void 0}),b(function(){i.focus()},1),dt.modal("alert",ut(e,n,i),o)},dt.confirm=function(e,n,r,i,u){function c(e){return o(r)&&r(e,t),nt(),l(e)}function a(e){return o(i)&&i(e,t),nt(),l(e)}var s,f=z("button",Dt.okay,hn),d=z("button",Dt.cancel,hn);return h(_t,f,c),h(_t,d,a),h(wt,f,function(e){return s=e.TE.key,s("arrowright")?(d.focus(),l(e)):s("arrowleft")?l(e):s("enter")?(c(e),l(e)):s("escape")?(nt(),l(e)):void 0}),h(wt,d,function(e){return s=e.TE.key,s(/^escape|arrowright$/)?l(e):s("arrowleft")?(f.focus(),l(e)):s("enter")?(a(e),l(e)):s("escape")?(nt(),l(e)):void 0}),b(function(){d.focus()},1),dt.modal("confirm",ut(e,n,[f,d]),u)},dt.prompt=function(e,n,r,o,i){function u(){v.focus(),v.select()}function c(e){return!r||w(v.value).length&&v.value!==n?(a(e),o(e,t,v.value)):(u(),s(e))}function a(e){return nt(),l(e)}function s(e){return l(e)}var f,d=z("button",Dt.okay,hn),p=z("button",Dt.cancel,hn),v=z("input",!1,{type:"text",value:n,placeholder:n,"class":Mt+"-input block"});return o=o||gt,h(wt,v,function(e){return f=e.TE.key,f("enter")?c(e):f("escape")?a(e):f("arrowup")?s(e):f("arrowdown")?(d.focus(),l(e)):void 0}),h(wt,d,function(e){return f=e.TE.key,f("enter")?c(e):f("escape")?a(e):f("arrowup")?(v.focus(),l(e)):f("arrowright")?(p.focus(),l(e)):f(/arrow(down|left)/)?s(e):void 0}),h(wt,p,function(e){return f=e.TE.key,f(/^enter|escape$/)?a(e):f("arrowup")?(v.focus(),l(e)):f(/arrow(right|down)/)?s(e):f("arrowleft")?(d.focus(),l(e)):void 0}),h(_t,d,c),h(_t,p,a),b(u,.4),dt.modal("prompt",ut(e,v,[d,p]),i)},dt.drop=function(e,n){dt.exit(),P(vt,z(Gt,!1,{"class":Mt+"-drop "+e})),o(n)?n(Gt):z(Gt,n);var r,i=N(pt),u=N(Gt),c=i.w/2-u.w/2,a=i.h/2-u.h/2;return nn&&(r=C(nn),c=r.l,a=r.t+N(nn).h),c+u.w>i.w&&(c=x(i.w-u.w,0)),a+u.h>i.h&&(a=x(i.h-u.h,0)),j(Gt,{left:c+"px",top:a+"px"}),h(_t,vt,ct),t},dt.bubble=function(e,n){dt.exit();var r,i=t.$(!0),u=C(Kt),c=parseInt(t._.css(Kt,"line-height"),10);return o(n)?n(Jt):z(Jt,n),P(vt,z(Jt,!1,{"class":Mt+"-bubble "+e})),r=i.caret[1].y+u.t+c-Kt.scrollTop,r>u.t+N(Kt).h-c?r=C(Xt).t-N(Jt).h:r<u.t&&(r=u.t),j(Jt,{left:i.caret[0].x+u.l+"px",top:r+"px"}),t},dt.tool=function(e,n,o){var i="";return mt.tools=mt.tools.filter(function(t,n){return t===e?(i=n,!1):!0}),n===!1?delete dt.tools[e]:(dt.tools[e]=bt(dt.tools[e]||{},n),r(o)||""===i||(o=i),c(o)?mt.tools.splice(o,0,e):mt.tools.push(e)),B(),t},dt.key=function(e,n){return n===!1?delete dt.keys[e]:dt.keys[e]=n,K(),t},dt.tools={"|":1,undo:{i:"undo",click:function(){return t.undo(),!1}},redo:{i:"repeat",click:function(){return t.redo(),!1}}},dt.keys={"control+y":"redo","control+z":"undo"},dt.parent=t,dt.dom={container:Rt,header:Ut,body:Wt,footer:Xt,overlay:qt,modal:Ft,drop:Gt,bubble:Jt},t.config=mt,t.ui=dt,bt(t._,{format:k,el:z,event:{set:h,reset:y,fire:g},hooks:ht,hook:{set:a,reset:s,fire:f}}),t.create(),dt};TE.prototype.create=function(e){return new TE_ui(e,this)};