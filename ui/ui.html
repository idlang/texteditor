<!DOCTYPE html>
<html dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Text Editor</title>
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <style>
    body {
      background:#fff;
      font-family:Helmet,FreeSans,Sans-Serif;
      font-size:14px;
      color:#000;
    }
    .TE-content {height:300px}
    .text-h1 {font-size:175%}
    .text-h2 {font-size:150%}
    .text-h3 {font-size:115%}
    .text-em {font-style:italic}
    .TE-current.menu * {font-size:100%}
    input,
    button,
    select,
    textarea {font:inherit}
    </style>
  </head>
  <body>
    <form action="#">
      <p><textarea></textarea></p>
      <p>
        <strong>Theme:</strong>
        <select id="select-css">
          <option value="../ui/ui.min.css">Default</option>
          <option value="../ui/ui.1960.min.css">1960</option>
        </select>
      </p>
      <script>
      // dynamic stylesheet
      var css = document.querySelector('#select-css');
      function select_css() {
          var link = document.createElement('link'), o;
          link.id = 'the-css';
          link.rel = 'stylesheet';
          link.href = this.value || css.value;
          if (o = document.querySelector('#the-css')) {
              o.parentNode.removeChild(o);
          }
          document.querySelector('head').appendChild(link);
      }
      select_css();
      css.onchange = select_css;
      </script>
      <h2>Tests</h2>
      <p>
        <button onclick="return this.disabled = true, this.nextElementSibling.disabled = false, editor.create(), false;" disabled>Create</button>
        <button onclick="return this.disabled = true, this.previousElementSibling.disabled = false, editor.destroy(), false;">Destroy</button>
      </p>
      <p>
        <button onclick="return editor.ui.tools.bold.click(null, editor), false;">Trigger Bold Button</button>
        <button onclick="return editor.ui.tool('bold', {active:false}), false;">Disable Bold Button</button>
        <button onclick="return editor.ui.tool('bold', {active:true}), false;">Enable Bold Button</button>
        <button onclick="return editor.ui.tool('bold', {}, 1), false;">Move Bold Button to 2 from Left</button>
        <button onclick="return editor.ui.tool('bold', {}, -1), false;">Move Bold Button to 2 from Right</button>
        <button onclick="return editor.ui.tool('bold', {}, 0), false;">Move Bold Button to 1 From Left</button>
        <button onclick="return editor.ui.tool('bold', {}, true), false;">Move Bold Button to 1 From Right</button>
      </p>
    </form>
    <script src="../text-editor.min.js"></script>
    <script src="../ui/ui.min.js"></script>
    <script>

    var editor = new TE(document.querySelector('textarea')),
        ui = editor.ui({
            tab: '  '
        });

    // add custom tool(s)
    editor._.extend(ui.tools, {
        bold: function(e, $) {
            $.format('strong');
        },
        italic: function(e, $) {
            $.format('em');
        },
        alert_button: {
            i: 'exclamation-triangle',
            title: 'Show Alert Modal',
            click: function(e, $) {
                $.ui.alert('Alert', 'Lorem ipsum dolor sit amet.');
            }
        },
        confirm_button: {
            i: 'question-circle',
            title: 'Show Confirm Modal',
            click: function(e, $) {
                $.ui.confirm(
                    'Confirm', // title
                    'Are you sure?', // description
                    function(e, $) { // if yes ...
                        $.insert('[yes]');
                    },
                    function(e, $) { // if no ...
                        $.insert('[no]');
                    }
                );
            }
        },
        prompt_button: {
            i: 'pencil',
            title: 'Show Prompt Modal',
            click: function(e, $) {
                $.ui.prompt(
                    'Name', // title
                    'Anonymous', // placeholder
                    true, // is required?
                    function(e, $, value) { // if yes ...
                        $.insert('Your name is: ' + value);
                    }
                );
            }
        },
        drop_button: {
            i: 'paint-brush',
            title: 'Test Drop',
            click: function(e, $) {
                $.ui.drop('my-drop', function(body) {
                    body.innerHTML = "";
                    var colors = ['red', 'orange', 'yellow', 'lime', 'green'],
                        i, j, k;
                    for (i in colors) {
                        j = colors[i];
                        k = $._.el('span', "", {
                            title: j,
                            style: {
                                width: '2em',
                                height: '2em',
                                display: 'block',
                                'float': 'left',
                                cursor: 'pointer',
                                background: j
                            }
                        });
                        $._.event.set('click', k, function() {
                            $[0]()
                                .unwrap(/<span style="color:\s*.*?">/, '</span>')
                                .format('span style="color: ' + this.title + ';"')
                            $[1]();
                        });
                        body.appendChild(k);
                    }
                });
            }
        }
    });

    // put the custom tool(s) to the editor toolbar
    editor.update({
        tools: 'bold italic | indent outdent | undo redo | alert_button confirm_button prompt_button | drop_button'
    });

    // test menu button(s)
    editor.ui.menu('styles', '<span class="text-p">Paragraph</span>', {
        '<span class="text-h1">Heading 1</span>': function(e, $) {
            $.unwrap(/<[^\/<>]*?>/, /<\/[^<>]*?>/).format('h1');
        },
        '<span class="text-h2">Heading 2</span>': function(e, $) {
            $.unwrap(/<[^\/<>]*?>/, /<\/[^<>]*?>/).format('h2');
        },
        '<span class="text-h3">Heading 3</span>': function(e, $) {
            $.unwrap(/<[^\/<>]*?>/, /<\/[^<>]*?>/).format('h3');
        },
        '<span class="text-p">Paragraph</span>': function(e, $) {
            $.unwrap(/<[^\/<>]*?>/, /<\/[^<>]*?>/).format('p');
        },
        '<span class="text-em">Test Italic</span>': 'italic'
    });

    // custom hook(s)
    editor._.hook.set('enter.overlay.preview', function(e, $, value, container) {
        var x = /<(script|iframe)(\s[^<>]*?)?>(.*?<\/(script|iframe)>)?/gi,
            y = x.exec(value[0]);
        if (y) {
            container.innerHTML = ""; // stop XSS
            $.ui.alert('Forbidden Tags', 'Tag <code>&lt;' + y[1] + '&gt;</code> is not allowed.', function(e, $) {
                $.set($.get().replace(x, ""));
            });
        }
    });

    // test bubble
    var events = 'blur focus keyup mouseup touchend';
    function test_bubble() {
        setTimeout(function() {
            if (editor.$().length) {
                editor.ui.bubble('my-bubble', function(bubble) {
                    bubble.innerHTML = '<a href="#">Test bubble&hellip;</a>';
                });
            } else {
                editor.ui.exit(0, 'bubble');
            }
        }, 1);
    }

    editor._.hook.set('create', function() {
        editor.set('create!');
        // set all "bubble" events on editor create
        apply_bubble_on_create();
    });

    editor._.hook.set('destroy', function() {
        editor.set('destroy!');
        // reset all "bubble" events on editor destroy
        editor._.event.reset(events, editor.target, test_bubble);
    });

    function apply_bubble_on_create() {
        editor._.event.set(events, editor.target, test_bubble);
    }

    // start "bubble" events
    apply_bubble_on_create();

    </script>
  </body>
</html>