/*!
 * ==========================================================
 *  USER INTERFACE MODULE FOR TEXT EDITOR PLUGIN 1.1.1
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
TE.prototype.create=function(e){function t(e){return e instanceof HTMLElement}function n(e){return void 0!==e}function r(e){return"function"==typeof e}function o(e){return"string"==typeof e}function i(e){return"object"==typeof e}function u(e){return"number"==typeof e}function a(e,t,r){return n(e)?n(t)?(n(yt[e])||(yt[e]={}),n(r)||(r=Object.keys(yt[e]).length),yt[e][r]=t,pt):yt[e]:yt}function c(e,t){return n(e)?n(t)&&n(yt[e])?(delete yt[e][t],pt):(yt[e]={},pt):(yt={},pt)}function s(e,t,r){if(!n(yt[e]))return yt[e]={},pt;if(n(r))n(yt[e][r])&&yt[e][r].apply(pt,t);else for(var o in yt[e])yt[e][o].apply(pt,t);return pt}function l(e){return e&&e.preventDefault(),!1}function f(e,t,n){return t?(t.addEventListener(e,n,!1),a("on:"+e,n,N(t)),pt):void 0}function d(e,t,n){return t?(t.removeEventListener(e,n,!1),c("on:"+e,N(t)),pt):void 0}function p(e,t,n){return s("on:"+e,t,N(n)),pt}function v(e,t,n){e=m(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)f(e[r],t,n);return pt}function h(e,t,n){e=m(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)d(e[r],t,n);return pt}function y(e,t,n){e=m(e).split(/\s+/);for(var r=0,o=e.length;o>r;++r)p(e[r],t,n);return pt}function b(e,t){ft.setTimeout(e,t)}function g(e){ft.clearTimeout(e)}function m(e){return e.replace(/^\s*|\s*$/g,"")}function x(e,t,r){return n(t)&&t>e?t:n(r)&&e>r?r:e}function w(e,t){return e.replace(/%(\d+)/g,function(e,r){return--r,n(t[r])?t[r]:e})}function k(e){return m(e.toLowerCase().replace(/[^ \/a-z\d-]/g,"-").replace(/([ -])+/g,"$1").replace(/^-|-$/g,""))}function T(e,t){return RegExp(e,t)}function $(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,r=t.touches?t.touches[0].pageY:t.pageY,o=E(e);return{x:n-o.l,y:r-o.t}}function E(e){for(var t=e.offsetLeft,n=e.offsetTop;e=e.offsetParent;)t+=e.offsetLeft,n+=e.offsetTop;return{l:t,t:n}}function C(e){return{w:e.offsetWidth,h:e.offsetHeight}}function _(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function L(e){var t,n=pt.get();if(!D(nn)&&n){-1===n.indexOf("</html>")&&(t='<!DOCTYPE html><html dir="'+kt.dir+'"><head><meta charset="utf-8"><style>'+kt.css+"</style></head><body>"+n+"</body></html>");var r=z("iframe",!1,{"class":St+"-portal",src:"data:text/html,"+encodeURIComponent(t)});pt.ui.overlay(r,1,function(){s("enter.overlay.preview",[e,pt,[n,t],nn.firstChild])})}else et();return l(e)}function N(e){var t=e.id;return t||(t=St+"-dom:"+(new Date).getTime(),e.id=t),t}function z(e,u,a){if(e=o(e)?dt.createElement(e):e,i(a)){var c,s;for(s in a)c=a[s],"style"===s?o(c)?e.setAttribute(s,c):null===c?e.removeAttribute(s):e=M(e,c):r(c)?e[s]=c:null===c?e.removeAttribute(s):e.setAttribute(s,i(c)?c.join(" "):""+c)}if(t(u))e.appendChild(u);else if(i(u)){var c,s;for(s in u)c=u[s],t(c)?e.appendChild(c):c!==!1&&(e.innerHTML=c)}else n(u)&&u!==!1&&(e.innerHTML=u);return e}function M(e,t){e=z(e);for(var n in t)e.style[n.replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})]=t[n];return e}function A(e,t){return T("(^|\\s)"+t+"(\\s|$)").test(e.className)}function H(e,t){A(e,t)||(e.className=m(e.className+" "+t))}function O(e,t){e.className=m(e.className.replace(T("(^|\\s)"+t+"(\\s|$)"),"$1$2"))}function j(e,t){e.innerHTML=t}function Y(e,t){if(t!==!1){var n,r=e.children;for(n in r)Y(r[n])}j(e,"")}function D(e,t){return 1===arguments.length?e.parentNode||!1:e&&t.parentNode===e?t.parentNode:!1}function I(e,t){e.parentNode.insertBefore(t,e)}function P(e,t){e.appendChild(t)}function R(e,t){var n=D(e);if(n){if(t!==!1)for(var r=e.firstChild;r;)R(r);n.removeChild(e)}}function U(e){Y(z(e,!1,{style:""})),R(e)}function W(e,t,n){return z(t||"div",n,{"class":e})}function S(){if(Ft._word&&Ft._words){var e=(Qt.value||"").replace(/<[^<>]+?>/g,""),t=(e.match(/(\w+)/g)||[]).length;j(cn,w(Ft["_word"+(1===t?"":"s")],[t]))}}function X(){Y(Jt,!1);var e,t,u,a,c,l,f=o(kt.tools)?m(kt.tools).split(/\s+/):kt.tools,d=St+"-button",p=St+"-separator";kt.tools=f;for(c in f)l=f[c],pt.ui.tools[l]&&(t=pt.ui.tools[l],r(t)&&(pt.ui.tools[l].click=t),"|"!==(u=t.i||l)&&(u=k(u)),a="|"!==u,Ut=W(a?d:p,a?"a":"span"),a&&(e=d+":"+k(l).replace(/\s/g,""),Ut.href="",Ut.id=e,Ut.tabIndex=-1,Ut.setAttribute(Rt,l),u='<i class="'+w(Wt.i,[u])+" "+e+'"></i>',n(t.active)?t.active||H(Ut,"x"):t.active=1,t.text&&(u=w('<span class="'+St+'-text">'+t.text+"</span>",[u]),H(Ut,"text")),j(Ut,u),t.title&&(Ut.title=t.title),i(t.attributes)&&z(Ut,!1,t.attributes),v(Mt,Ut,q)),P(Jt,Ut));s("update.tools",[pt])}function B(){pt.ui.keys=function(){var e,t=Object.keys(pt.ui.keys).sort().reverse(),n={};for(e=0,len=t.length;len>e;++e)n[t[e]]=pt.ui.keys[t[e]];return n}(),V(1),s("update.keys",[pt])}function F(e){S(),s("on:change",[e,pt])}function K(e){function t(e){return e.replace(/\+/g,"\n").replace(/\n\n/g,"\n+").split("\n")}var r,i,u,a,c,s=pt.$(),f=s.before,d=s.after,p=f.slice(-1),v=d[0],h=s.length,y=e.TE.key,g=pt.ui.keys,m=TE.keys_alt,x=(f.match(/(?:^|\n)([\t ]*).*$/)||[""]).pop(),w=y();dn[w]=1,b(function(){pt.record()},1);for(r in g){var k=0;u=t(r);for(i in u)i=u[i],dn[m[i]||i]&&++k;if(u=u.length,k===u&&Object.keys(dn).length===u&&(o(g[r])&&(g[r]=pt.ui.tools[g[r]].click),a=g[r]&&g[r](e,pt),a===!1))return l(e)}if(Pt)for(r in Pt)if(c=Pt[r],c!==!1){if(v===w&&n(Pt[w]))return"\\"===p?(pt.insert(w,-1),l(e)):(pt.select(s.end+1),l(e));if(r===w)return pt.wrap(r,c),l(e);if(p===r&&v===c){if("backspace"===w&&f.slice(-2)!=="\\"+r)return pt.unwrap(r,c),l(e);if(It&&"enter"===w&&r!==c)return pt.tidy("\n"+x+Dt,"\n"+x),l(e)}}if(It&&!h){if("backspace"===w&&T(mt(Dt)+"$").test(f))return pt.outdent(Dt),l(e);if("enter"===w&&T("(^|\\n)("+mt(Dt)+")+.*$").test(f))return pt.insert("\n"+x,-1),l(e)}}function V(e){i(e)?delete dn[e.TE.key()]:dn={}}function Z(e){/^focus|blur$/.test(e.type)&&V(1),g(pn),pn=b(function(){F(e)},1e3)}function q(e){pt.ui.exit(0,0,0);var t=this.getAttribute(Rt),n=pt.ui.tools;return fn=e.currentTarget||e.target,n[t]&&n[t].click&&n[t].active?(n[t].click(e,pt,t),s("on:change",[e,pt,t])):pt.select(),l(e)}function G(e){return hn=en,vn=C(Gt),l(e)}function J(e){hn===en&&M(Qt,{height:$(qt,e).y-vn.h+"px"})}function Q(){hn=0}function et(){pt.ui.exit(1)}function tt(){e=C(rn),gn=e.w,mn=e.h,e=C(nn),xn=e.w,wn=e.h}function nt(e,t){t&&s("exit.modal."+t,[pt]),y(Mt,[e],nn)}function rt(t){hn=t.target,e=$(rn,t),yn=e.x,bn=e.y,tt()}function ot(t){var n,r,o=kn.header,i=kn.resize;hn===o||_(hn,o)===o?(e=$(qt,t),n=e.x-yn,r=e.y-bn,M(rn,{left:(gn>xn?n:x(n,0,xn-gn))+"px",top:(mn>wn?r:x(r,0,wn-mn))+"px"})):hn===i&&(e=$(rn,t),M(rn,{width:e.x+"px",height:e.y+"px"}))}function it(){hn=0}function ut(e,t,n){return{header:e,body:t,footer:n}}function at(e){var t=fn,n=e&&e.target||0;(!n||n!==t&&_(n,t)!==t)&&(fn=0,U(on),h(Mt,ht,at),pt.ui.exit(1))}var ct="\u2318",st="\u2026",lt="\u2325",ft=window,dt=document,pt=this,vt=dt.documentElement,ht=(dt.head,dt.body),yt={},bt=pt.target,gt=function(){},mt=pt._.x,xt=pt._.extend,wt=pt._.css,kt=xt({tab:"  ",dir:"ltr",keys:1,tools:"indent outdent | undo redo",attributes:{spellcheck:"false"},css:"html,body{background:#fff;color:#000}",auto_tab:1,auto_close:{'"':'"',"'":"'","(":")","{":"}","[":"]","<":">"},languages:{tools:{undo:"Undo ("+ct+"+Z)",redo:"Redo ("+ct+"+Y)",preview:"Preview ("+ct+"+"+lt+"+V)"},buttons:{okay:"OK",cancel:"Cancel",yes:"Yes",no:"No",enter:"Enter",exit:"Exit",open:"Open",close:"Close",ignore:"Ignore"},placeholders:{"":"text here"+st},others:{preview:"Preview",_word:"%1 Word",_words:"%1 Words"}},classes:{editor:"text-editor",i:"fa fa-%1"}},e),Tt="keydown",$t="keyup",Et="copy",Ct="cut",_t="paste",Lt="mousedown touchstart",Nt="mouseup touchend",zt="mousemove touchmove",Mt="click",At="focus",Ht="blur",Ot="input",jt=Ht+" "+Et+" "+Ct+" "+At+" "+Ot+" "+Tt+" "+_t,Yt=kt.languages,Dt=kt.tab,It=kt.auto_tab,Pt=kt.auto_close,Rt="data-tool-id";pt.ui={},pt.tidy=function(e,t){var r=pt.$(),o=r.before?e:"",i=r.after?n(t)?t:e:"";return pt.trim(o,i)},pt.i=function(){return editor.replace(/\s+/g," ")},pt.format=function(e,t,r,o){n(r)||(r=" "),n(o)||(o="");var i=pt[0]().$(),u="<"+e+">"+o,a=o+"</"+e.split(" ")[0]+">",c=mt(u),s=mt(a),l=T("^"+c+"([\\s\\S]*?)"+s+"$"),f=T(c+"$"),d=T("^"+s),p=i.before,v=i.after;return i.length?r=!1:pt.insert(Yt.placeholders[""]),pt.toggle(t?!l.test(i.value):!f.test(p)&&!d.test(v),[function(e){e.unwrap(u,a,1).tidy(/<[^\/<>]+?>$/.test(p)?"":r,/^<\/[^<>]+?>/.test(v)?"":r).wrap(u,a,t)[1]()},function(e){e.unwrap(u,a,t)[1]()}])};var Ut,Wt=kt.classes,St=Wt.editor,Xt=Yt.tools,Bt=Yt.buttons,Ft=Yt.others,Kt=St+"-textarea "+St+"-content",Vt=W(St),Zt=W(St+"-header"),qt=W(St+"-body"),Gt=W(St+"-footer"),Jt=W(St+"-tool"),Qt=z(bt,!1,kt.attributes),en=W(St+"-resize s"),tn=W(St+"-description"),nn=W(St+"-overlay"),rn=z("div"),on=z("div"),un=z("div"),an=W("left","span"),cn=W("right","span"),sn=W(St+"-preview","a"),ln=0,fn=0;sn.href="",sn.title=Xt.preview,v(Mt,sn,L);var dn={},pn=null;pt.create=function(e,t){i(e)&&(kt=xt(kt,e)),H(Qt,Kt);var n=D(Qt);return n&&"p"===n.tagName.toLowerCase()?(I(n,Vt),ln=n,R(n,!1)):I(Qt,Vt),Vt.dir=kt.dir,P(Vt,Zt),P(Vt,qt),P(Vt,Gt),P(Vt,en),P(qt,Qt),kt.tools&&(P(Zt,Jt),P(Gt,tn),P(tn,an),P(tn,cn)),v(Tt,Qt,K),v($t,Qt,V),v(jt,Qt,Z),v(Lt,en,G),v(zt,ht,J),v(Nt,ht,Q),Ft.preview&&(P(an,sn),j(sn,Ft.preview)),F(null),X(),B(),0!==t?s("create",[pt]):pt},pt.update=function(e,t){return A(Qt,Kt)&&pt.destroy(0),(0!==t?s("update",[pt]):pt).create(e,0)},pt.destroy=function(e){return A(Qt,Kt)?(pt.ui.exit(0,0,0),O(Qt,Kt),i(kt.tools)&&(kt.tools=kt.tools.join(" ")),kt.keys&&(h(Tt,Qt,K),h($t,Qt,V)),h(Lt,en,G),h(zt,ht,J),h(Nt,ht,Q),h(jt,Qt,Z),ln?(I(Vt,ln),P(ln,Qt),ln=0):I(Vt,Qt),U(Vt),0!==e?s("destroy",[pt]):pt):pt};var e,vn,hn=0,yn=0,bn=0,gn=0,mn=0,xn=0,wn=0,kn={};pt.ui.exit=function(e,t,n){var r,o={overlay:function(){h(Mt,nn,et),U(nn)},modal:function(){h(Lt,qt,rt),h(zt,qt,ot),h(Nt,ht,it),h(Mt,kn.x,nt),U(rn)},drop:function(){U(on)},bubble:function(){U(un)}};if(t)if(i(t))for(r in t)r=t[r],o[r]&&o[r](),0!==n&&s("exit."+r,[pt]);else o[t]&&o[t](),0!==n&&s("exit."+r,[pt]);else for(r in o)o[r]();return e&&pt.select(),0!==n&&s("exit",[pt]),pt},pt.ui.overlay=function(e,n,o){return pt.ui.exit(0,"bubble",0),V(1),P(qt,z(nn,e.length||t(e)?W(St+"-overlay-content","div",e):"")),n&&v(Mt,nn,et),r(o)?o(nn):z(nn,o),s("enter.overlay",[pt])},pt.ui.modal=function(){pt.ui.exit(0,0,0);var e,t=arguments,o=t[0],u=t[1],a=t[2],c=St+"-modal";i(o)&&(o="default",u=t[0],a=t[1]),z(rn,!1,{"class":c+" "+o}),n(u.body)&&(u.body=z("div",u.body,{"class":c+"-content "+o}));for(e in u)c[1]=e,kn[e]=W(c+"-"+w(e,c)+" "+o,0,u[e]);kn.x=W(St+"-x "+o),kn.resize=W(St+"-resize se "+o),Y(rn),P(qt,z(rn,kn,{style:""})),pt.ui.overlay("",1),tt();var f=wn/2-mn/2,d=xn/2-gn/2;return M(rn,{top:f+"px",left:d+"px"}),v(Mt,kn.x,nt),v(Lt,kn.header,l),v(Lt,kn.resize,l),v(Lt,qt,rt),v(zt,qt,ot),v(Nt,ht,it),r(a)&&(kn.overlay=nn,kn.modal=rn,a(kn)),s("enter.modal."+o,[pt]),s("enter.modal",[pt]),pt};var Tn={"class":St+"-button"};return pt.ui.alert=function(e,t,n,r){var o=z("button",Bt.okay,Tn),u="alert";return n=n||gt,i(e)&&(u+=":"+e[0],e=e[1]||e[0]),v(Mt,o,function(e){return n(e,pt),nt(e,u+".y"),l(e)}),v(Tt,o,function(e){var t=e.TE.key;return t(/^escape|enter$/)?y(Mt,[e,pt],o):void 0}),b(function(){o.focus()},1),pt.ui.modal(u,ut(e,t,o),r)},pt.ui.confirm=function(e,t,n,o,u){function a(e){return r(n)&&n(e,pt),nt(e,p+".y"),l(e)}function c(e){return r(o)&&o(e,pt),nt(e,p+".n"),l(e)}var s,f=z("button",Bt.okay,Tn),d=z("button",Bt.cancel,Tn),p="confirm";return i(e)&&(p+=":"+e[0],e=e[1]||e[0]),v(Mt,f,a),v(Mt,d,c),v(Tt,f,function(e){return s=e.TE.key,s("arrowright")?(d.focus(),l(e)):s("arrowleft")?l(e):s("enter")?(a(e),l(e)):s("escape")?(nt(e,p+".y"),l(e)):void 0}),v(Tt,d,function(e){return s=e.TE.key,s("arrowright")?l(e):s("arrowleft")?(f.focus(),l(e)):s("enter")?(c(e),l(e)):s("escape")?(nt(e,p+".n"),l(e)):void 0}),b(function(){d.focus()},1),pt.ui.modal(p,ut(e,t,[f,d]),u)},pt.ui.prompt=function(e,t,n,o,u,a){function c(){w.focus(),"placeholder"in w&&w.select()}function s(e){return y=w.value,!n||m(y)&&y!==t?(nt(e,k+".y"),l(e),o(e,pt,y!==t?y:"",t)):(c(),d(e))}function f(e){return nt(e,k+".n"),l(e)}function d(e){return l(e)}var p,h,y,g=z("button",Bt.okay,Tn),x=z("button",Bt.cancel,Tn),w=z("input",!1,{type:"text",value:t,placeholder:t,"class":St+"-input block"}),k="prompt",T=[];if(i(e)&&(k+=":"+e[0],e=e[1]||e[0]),r(u)&&(a=u,u=0),1===u)w=z("textarea",t,{placeholder:t.split("\n")[0],"class":St+"-textarea block"});else if(2===u){for(h in t)T.push(z("option",t[h],{value:h,selected:h===n||null}));w=z("select",T,{"class":St+"-select block"})}return o=o||gt,v(Tt,w,function(e){return p=e.TE.key,p("enter")?s(e):p("escape")||p("backspace")&&!this.value?f(e):p("arrowup")?d(e):p("arrowdown")?(g.focus(),l(e)):void 0}),v(Tt,g,function(e){return p=e.TE.key,p("enter")?s(e):p("escape")?f(e):p("arrowup")?(w.focus(),l(e)):p("arrowright")?(x.focus(),l(e)):p(/^arrow(down|left)$/)?d(e):void 0}),v(Tt,x,function(e){return p=e.TE.key,p(/^enter|escape$/)?f(e):p("arrowup")?(w.focus(),l(e)):p(/^arrow(right|down)$/)?d(e):p("arrowleft")?(g.focus(),l(e)):void 0}),v(Mt,g,s),v(Mt,x,f),b(c,.4),pt.ui.modal(k,ut(e,w,[g,x]),a)},pt.ui.drop=function(){pt.ui.exit(0,0,0);var e=arguments,t=e[0],n=e[1];1===e.length&&(t="default",n=e[0]),P(ht,z(on,!1,{"class":St+"-drop "+t})),r(n)?n(on):z(on,n);var o,i=C(vt),u=C(on),a=i.w/2-u.w/2,c=i.h/2-u.h/2;return fn&&(o=E(fn),a=o.l,c=o.t+C(fn).h),M(on,{left:x(a,0,i.w-u.w)+"px",top:x(c,0,i.h-u.h)+"px"}),v(Mt,ht,at),s("enter.drop."+t,[pt]),s("enter.drop",[pt]),pt},pt.ui.menu=function(e,t,n,r){var u='<span class="'+St+'-current menu">%1</span>',a="";return t===!1?pt.ui.tool(e,t):(i(t)&&(a=t[0],t=t[1],u='<i class="'+w(Wt.i,[a])+'"></i> '+u),pt.ui.tool(e,{i:a,text:w(u,[t,a]),click:function(){var e,t,r,i,c={"class":St+"-button"};pt.ui.drop("menu",function(s){Y(s);for(t in n)c[Rt]=t,e=z("span",t,c),n[t]&&v(Mt,e,function(e){return i=n[this.getAttribute(Rt)],o(i)&&(i=pt.ui.tools[i].click),r=i&&i(e,pt),fn&&j(fn.firstChild||fn,w(u,[this.innerHTML,a])),r===!1?l(e):void 0}),P(s,e)})}},r),s("update.menus",[pt]),pt)},pt.ui.bubble=function(){pt.ui.exit(0,0,0);var e,t,n,o=arguments,i=o[0],u=o[1],a=pt.$(1),c=E(Qt),l=parseInt(wt(Qt,"line-height"),10);return 1===o.length&&(i="default",u=o[0]),r(u)?u(un):z(un,u),P(ht,z(un,!1,{"class":St+"-bubble "+i})),e=a.caret[0].x+c.l,t=a.caret[1].y+c.t+l-Qt.scrollTop,n=C(un),M(un,{left:x(e,c.l,c.l+C(qt).w-n.w)+"px",top:x(t,c.t,E(Gt).t-n.h)+"px"}),s("enter.bubble."+i,[pt]),s("enter.bubble",[pt]),pt},pt.ui.tool=function(e,t,r){var o="";return"|"!==e&&(kt.tools=kt.tools.filter(function(t,n){return t===e?(o=n,!1):!0})),t===!1?delete pt.ui.tools[e]:("|"===e?(r=t,t={}):(pt.ui.tools[e]=xt(pt.ui.tools[e]||{},t),n(r)||""===o||(r=o)),u(r)?kt.tools.splice(r,0,e):kt.tools.push(e)),X(),pt},pt.ui.key=function(e,t){return kt.keys?(t===!1?delete pt.ui.keys[e]:pt.ui.keys[e]=t,B(),pt):pt},pt.ui.tools={"|":1,undo:{i:"undo",click:function(e,t){return t.undo(),!1}},redo:{i:"repeat",click:function(e,t){return t.redo(),!1}},indent:function(e,t){return t.indent(Dt),!1},outdent:function(e,t){return t.outdent(Dt),!1}},pt.ui.keys={"control+y":"redo","control+z":"undo","control+option+v":function(e){return L(e),!1},"shift+tab":It?"outdent":0,tab:It?"indent":0,escape:function(){return sn.focus(),!1}},pt.ui.el={container:Vt,header:Zt,body:qt,footer:Gt,overlay:nn,modal:rn,drop:on,bubble:un},pt.config=kt,xt(pt._,{time:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),o=e.getHours(),i=e.getMinutes(),u=e.getSeconds(),a=e.getMilliseconds();return 10>n&&(n="0"+n),10>r&&(r="0"+r),10>o&&(o="0"+o),10>i&&(i="0"+i),10>u&&(u="0"+u),10>a&&(a="0"+a),[""+t,""+n,""+r,""+o,""+i,""+u,""+a]},format:w,el:z,event:{set:v,reset:h,fire:y,x:l},hooks:yt,hook:{set:a,reset:c,fire:s}}),pt.ui};